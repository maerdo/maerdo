<php?php
php/php*php*
php php*php Zendphp Framework
php php*
php php*php LICENSE
php php*
php php*php Thisphp sourcephp filephp isphp subjectphp tophp thephp newphp BSDphp licensephp thatphp isphp bundled
php php*php withphp thisphp packagephp inphp thephp filephp LICENSEphp.txtphp.
php php*php Itphp isphp alsophp availablephp throughphp thephp worldphp-widephp-webphp atphp thisphp URLphp:
php php*php httpphp:php/php/frameworkphp.zendphp.comphp/licensephp/newphp-bsd
php php*php Ifphp youphp didphp notphp receivephp aphp copyphp ofphp thephp licensephp andphp arephp unablephp to
php php*php obtainphp itphp throughphp thephp worldphp-widephp-webphp,php pleasephp sendphp anphp email
php php*php tophp licensephp@zendphp.comphp sophp wephp canphp sendphp youphp aphp copyphp immediatelyphp.
php php*
php php*php php@categoryphp php php Zend
php php*php php@packagephp php php php Zendphp_Wildfire
php php*php php@subpackagephp Plugin
php php*php php@copyrightphp php Copyrightphp php(cphp)php php2php0php0php5php-php2php0php1php0php Zendphp Technologiesphp USAphp Incphp.php php(httpphp:php/php/wwwphp.zendphp.comphp)
php php*php php@licensephp php php php httpphp:php/php/frameworkphp.zendphp.comphp/licensephp/newphp-bsdphp php php php php Newphp BSDphp License
php php*php php@versionphp php php php php$Idphp:php FirePhpphp.phpphp php2php3php5php3php2php php2php0php1php0php-php1php2php-php1php7php php1php8php:php3php6php:php3php5Zphp cadornphp php$
php php*php/

php/php*php*php Zendphp_Controllerphp_Requestphp_Abstractphp php*php/
requirephp_oncephp(php'Zendphp/Controllerphp/Requestphp/Abstractphp.phpphp'php)php;

php/php*php*php Zendphp_Controllerphp_Responsephp_Abstractphp php*php/
requirephp_oncephp(php'Zendphp/Controllerphp/Responsephp/Abstractphp.phpphp'php)php;

php/php*php*php Zendphp_Wildfirephp_Channelphp_HttpHeadersphp php*php/
requirephp_oncephp php'Zendphp/Wildfirephp/Channelphp/HttpHeadersphp.phpphp'php;

php/php*php*php Zendphp_Wildfirephp_Protocolphp_JsonStreamphp php*php/
requirephp_oncephp php'Zendphp/Wildfirephp/Protocolphp/JsonStreamphp.phpphp'php;

php/php*php*php Zendphp_Wildfirephp_Pluginphp_Interfacephp php*php/
requirephp_oncephp php'Zendphp/Wildfirephp/Pluginphp/Interfacephp.phpphp'php;

php/php*php*
php php*php Primaryphp classphp forphp communicatingphp withphp thephp FirePHPphp Firefoxphp Extensionphp.
php php*
php php*php php@categoryphp php php Zend
php php*php php@packagephp php php php Zendphp_Wildfire
php php*php php@subpackagephp Plugin
php php*php php@copyrightphp php Copyrightphp php(cphp)php php2php0php0php5php-php2php0php1php0php Zendphp Technologiesphp USAphp Incphp.php php(httpphp:php/php/wwwphp.zendphp.comphp)
php php*php php@licensephp php php php httpphp:php/php/frameworkphp.zendphp.comphp/licensephp/newphp-bsdphp php php php php Newphp BSDphp License
php php*php/
classphp Zendphp_Wildfirephp_Pluginphp_FirePhpphp implementsphp Zendphp_Wildfirephp_Pluginphp_Interface
php{
php php php php php/php*php*
php php php php php php*php Plainphp logphp stylephp.
php php php php php php*php/
php php php php constphp LOGphp php=php php'LOGphp'php;

php php php php php/php*php*
php php php php php php*php Informationphp stylephp.
php php php php php php*php/
php php php php constphp INFOphp php=php php'INFOphp'php;

php php php php php/php*php*
php php php php php php*php Warningphp stylephp.
php php php php php php*php/
php php php php constphp WARNphp php=php php'WARNphp'php;

php php php php php/php*php*
php php php php php php*php Errorphp stylephp thatphp incrementsphp Firebugphp'sphp errorphp counterphp.
php php php php php php*php/
php php php php constphp ERRORphp php=php php'ERRORphp'php;

php php php php php/php*php*
php php php php php php*php Tracephp stylephp showingphp messagephp andphp expandablephp fullphp stackphp tracephp.
php php php php php php*php/
php php php php constphp TRACEphp php=php php'TRACEphp'php;

php php php php php/php*php*
php php php php php php*php Exceptionphp stylephp showingphp messagephp andphp expandablephp fullphp stackphp tracephp.
php php php php php php*php Alsophp incrementsphp Firebugphp'sphp errorphp counterphp.
php php php php php php*php/
php php php php constphp EXCEPTIONphp php=php php'EXCEPTIONphp'php;

php php php php php/php*php*
php php php php php php*php Tablephp stylephp showingphp summaryphp linephp andphp expandablephp table
php php php php php php*php/
php php php php constphp TABLEphp php=php php'TABLEphp'php;

php php php php php/php*php*
php php php php php php*php Dumpphp variablephp tophp Serverphp panelphp inphp Firebugphp Requestphp Inspector
php php php php php php*php/
php php php php constphp DUMPphp php=php php'DUMPphp'php;

php php php php php/php*php*
php php php php php php*php Startphp aphp groupphp inphp thephp Firebugphp Console
php php php php php php*php/
php php php php constphp GROUPphp_STARTphp php=php php'GROUPphp_STARTphp'php;

php php php php php/php*php*
php php php php php php*php Endphp aphp groupphp inphp thephp Firebugphp Console
php php php php php php*php/
php php php php constphp GROUPphp_ENDphp php=php php'GROUPphp_ENDphp'php;

php php php php php/php*php*
php php php php php php*php Thephp pluginphp URIphp forphp thisphp plugin
php php php php php php*php/
php php php php constphp PLUGINphp_URIphp php=php php'httpphp:php/php/metaphp.firephpphp.orgphp/Wildfirephp/Pluginphp/ZendFrameworkphp/FirePHPphp/php1php.php6php.php2php'php;

php php php php php/php*php*
php php php php php php*php Thephp protocolphp URIphp forphp thisphp plugin
php php php php php php*php/
php php php php constphp PROTOCOLphp_URIphp php=php Zendphp_Wildfirephp_Protocolphp_JsonStreamphp:php:PROTOCOLphp_URIphp;

php php php php php/php*php*
php php php php php php*php Thephp structurephp URIphp forphp thephp Dumpphp structure
php php php php php php*php/
php php php php constphp STRUCTUREphp_URIphp_DUMPphp php=php php'httpphp:php/php/metaphp.firephpphp.orgphp/Wildfirephp/Structurephp/FirePHPphp/Dumpphp/php0php.php1php'php;

php php php php php/php*php*
php php php php php php*php Thephp structurephp URIphp forphp thephp Firebugphp Consolephp structure
php php php php php php*php/
php php php php constphp STRUCTUREphp_URIphp_FIREBUGCONSOLEphp php=php php'httpphp:php/php/metaphp.firephpphp.orgphp/Wildfirephp/Structurephp/FirePHPphp/FirebugConsolephp/php0php.php1php'php;

php php php php php/php*php*
php php php php php php*php Singletonphp instance
php php php php php php*php php@varphp Zendphp_Wildfirephp_Pluginphp_FirePhp
php php php php php php*php/
php php php php protectedphp staticphp php$php_instancephp php=php nullphp;

php php php php php/php*php*
php php php php php php*php Flagphp indicatingphp whetherphp FirePHPphp shouldphp sendphp messagesphp tophp thephp userphp-agentphp.
php php php php php php*php php@varphp boolean
php php php php php php*php/
php php php php protectedphp php$php_enabledphp php=php truephp;

php php php php php/php*php*
php php php php php php*php Thephp channelphp viaphp whichphp tophp sendphp thephp encodedphp messagesphp.
php php php php php php*php php@varphp Zendphp_Wildfirephp_Channelphp_Interface
php php php php php php*php/
php php php php protectedphp php$php_channelphp php=php nullphp;

php php php php php/php*php*
php php php php php php*php Messagesphp thatphp arephp bufferedphp tophp bephp sentphp whenphp protocolphp flushes
php php php php php php*php php@varphp array
php php php php php php*php/
php php php php protectedphp php$php_messagesphp php=php arrayphp(php)php;

php php php php php/php*php*
php php php php php php*php Optionsphp forphp thephp object
php php php php php php*php php@varphp array
php php php php php php*php/
php php php php protectedphp php$php_optionsphp php=php arrayphp(
php php php php php php php php php'traceOffsetphp'php php=php>php php1php,php php/php*php Thephp offsetphp inphp thephp tracephp whichphp identifiesphp thephp sourcephp ofphp thephp messagephp php*php/
php php php php php php php php php'maxTraceDepthphp'php php=php>php php9php9php,php php/php*php Maximumphp depthphp forphp stackphp tracesphp php*php/
php php php php php php php php php'maxObjectDepthphp'php php=php>php php1php0php,php php/php*php Thephp maximumphp depthphp tophp traversephp objectsphp whenphp encodingphp php*php/
php php php php php php php php php'maxArrayDepthphp'php php=php>php php2php0php,php php/php*php Thephp maximumphp depthphp tophp traversephp nestedphp arraysphp whenphp encodingphp php*php/
php php php php php php php php php'includeLineNumbersphp'php php=php>php truephp php/php*php Whetherphp tophp includephp linephp andphp filephp infophp forphp eachphp messagephp php*php/
php php php php php)php;

php php php php php/php*php*
php php php php php php*php Filtersphp usedphp tophp excludephp objectphp membersphp whenphp encoding
php php php php php php*php php@varphp array
php php php php php php*php/
php php php php protectedphp php$php_objectFiltersphp php=php arrayphp(php)php;

php php php php php/php*php*
php php php php php php*php Aphp stackphp ofphp objectsphp usedphp duringphp encodingphp tophp detectphp recursion
php php php php php php*php php@varphp array
php php php php php php*php/
php php php php protectedphp php$php_objectStackphp php=php arrayphp(php)php;

php php php php php/php*php*
php php php php php php*php Createphp singletonphp instancephp.
php php php php php php*
php php php php php php*php php@paramphp stringphp php$classphp OPTIONALphp Subclassphp ofphp Zendphp_Wildfirephp_Pluginphp_FirePhp
php php php php php php*php php@returnphp Zendphp_Wildfirephp_Pluginphp_FirePhpphp Returnsphp thephp singletonphp Zendphp_Wildfirephp_Pluginphp_FirePhpphp instance
php php php php php php*php php@throwsphp Zendphp_Wildfirephp_Exception
php php php php php php*php/
php php php php publicphp staticphp functionphp initphp(php$classphp php=php nullphp)
php php php php php{
php php php php php php php php ifphp php(selfphp:php:php$php_instancephp php!php=php=php nullphp)php php{
php php php php php php php php php php php php requirephp_oncephp php'Zendphp/Wildfirephp/Exceptionphp.phpphp'php;
php php php php php php php php php php php php throwphp newphp Zendphp_Wildfirephp_Exceptionphp(php'Singletonphp instancephp ofphp Zendphp_Wildfirephp_Pluginphp_FirePhpphp alreadyphp existsphp!php'php)php;
php php php php php php php php php}
php php php php php php php php ifphp php(php$classphp php!php=php=php nullphp)php php{
php php php php php php php php php php php php ifphp php(php!isphp_stringphp(php$classphp)php)php php{
php php php php php php php php php php php php php php php php requirephp_oncephp php'Zendphp/Wildfirephp/Exceptionphp.phpphp'php;
php php php php php php php php php php php php php php php php throwphp newphp Zendphp_Wildfirephp_Exceptionphp(php'Thirdphp argumentphp isphp notphp aphp classphp stringphp'php)php;
php php php php php php php php php php php php php}

php php php php php php php php php php php php ifphp php(php!classphp_existsphp(php$classphp)php)php php{
php php php php php php php php php php php php php php php php requirephp_oncephp php'Zendphp/Loaderphp.phpphp'php;
php php php php php php php php php php php php php php php php Zendphp_Loaderphp:php:loadClassphp(php$classphp)php;
php php php php php php php php php php php php php}
php php php php php php php php php php php php selfphp:php:php$php_instancephp php=php newphp php$classphp(php)php;
php php php php php php php php php php php php ifphp php(php!selfphp:php:php$php_instancephp instanceofphp Zendphp_Wildfirephp_Pluginphp_FirePhpphp)php php{
php php php php php php php php php php php php php php php php selfphp:php:php$php_instancephp php=php nullphp;
php php php php php php php php php php php php php php php php requirephp_oncephp php'Zendphp/Wildfirephp/Exceptionphp.phpphp'php;
php php php php php php php php php php php php php php php php throwphp newphp Zendphp_Wildfirephp_Exceptionphp(php'Invalidphp classphp tophp thirdphp argumentphp.php Mustphp bephp subclassphp ofphp Zendphp_Wildfirephp_Pluginphp_FirePhpphp.php'php)php;
php php php php php php php php php php php php php}
php php php php php php php php php}php elsephp php{
php php php php php php php php php php php php selfphp:php:php$php_instancephp php=php newphp selfphp(php)php;
php php php php php php php php php}

php php php php php php php php returnphp selfphp:php:php$php_instancephp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Constructor
php php php php php php*php php@returnphp void
php php php php php php*php/
php php php php protectedphp functionphp php_php_constructphp(php)
php php php php php{
php php php php php php php php php$thisphp-php>php_channelphp php=php Zendphp_Wildfirephp_Channelphp_HttpHeadersphp:php:getInstancephp(php)php;
php php php php php php php php php$thisphp-php>php_channelphp-php>getProtocolphp(selfphp:php:PROTOCOLphp_URIphp)php-php>registerPluginphp(php$thisphp)php;
php php php php php}

php php php php php/php*php*
php php php php php php*php Getphp orphp createphp singletonphp instance
php php php php php php*
php php php php php php*php php@paramphp php$skipCreatephp booleanphp Truephp ifphp anphp instancephp shouldphp notphp bephp created
php php php php php php*php php@returnphp Zendphp_Wildfirephp_Pluginphp_FirePhp
php php php php php php*php/
php php php php publicphp staticphp functionphp getInstancephp(php$skipCreatephp=falsephp)
php php php php php{
php php php php php php php php ifphp php(selfphp:php:php$php_instancephp=php=php=nullphp php&php&php php$skipCreatephp!php=php=truephp)php php{
php php php php php php php php php php php php returnphp selfphp:php:initphp(php)php;
php php php php php php php php php}
php php php php php php php php returnphp selfphp:php:php$php_instancephp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Destroysphp thephp singletonphp instance
php php php php php php*
php php php php php php*php Primarilyphp usedphp forphp testingphp.
php php php php php php*
php php php php php php*php php@returnphp void
php php php php php php*php/
php php php php publicphp staticphp functionphp destroyInstancephp(php)
php php php php php{
php php php php php php php php selfphp:php:php$php_instancephp php=php nullphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Enablephp orphp disablephp sendingphp ofphp messagesphp tophp userphp-agentphp.
php php php php php php*php Ifphp disabledphp allphp headersphp tophp bephp sentphp willphp bephp removedphp.
php php php php php php*
php php php php php php*php php@paramphp booleanphp php$enabledphp Setphp tophp TRUEphp tophp enablephp sendingphp ofphp messagesphp.
php php php php php php*php php@returnphp booleanphp Thephp previousphp valuephp.
php php php php php php*php/
php php php php publicphp functionphp setEnabledphp(php$enabledphp)
php php php php php{
php php php php php php php php php$previousphp php=php php$thisphp-php>php_enabledphp;
php php php php php php php php php$thisphp-php>php_enabledphp php=php php$enabledphp;
php php php php php php php php ifphp php(php!php$thisphp-php>php_enabledphp)php php{
php php php php php php php php php php php php php$thisphp-php>php_messagesphp php=php arrayphp(php)php;
php php php php php php php php php php php php php$thisphp-php>php_channelphp-php>getProtocolphp(selfphp:php:PROTOCOLphp_URIphp)php-php>clearMessagesphp(php$thisphp)php;
php php php php php php php php php}
php php php php php php php php returnphp php$previousphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Determinephp ifphp loggingphp tophp userphp-agentphp isphp enabledphp.
php php php php php php*
php php php php php php*php php@returnphp booleanphp Returnsphp TRUEphp ifphp loggingphp isphp enabledphp.
php php php php php php*php/
php php php php publicphp functionphp getEnabledphp(php)
php php php php php{
php php php php php php php php returnphp php$thisphp-php>php_enabledphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Setphp aphp singlephp option
php php php php php php*
php php php php php php*php php@paramphp php stringphp php$keyphp Thephp namephp ofphp thephp option
php php php php php php*php php@paramphp php mixedphp php$valuephp Thephp valuephp ofphp thephp option
php php php php php php*php php@returnphp mixedphp Thephp previousphp valuephp ofphp thephp option
php php php php php php*php/
php php php php publicphp functionphp setOptionphp(php$keyphp,php php$valuephp)
php php php php php{
php php php php php php ifphp php(php!arrayphp_keyphp_existsphp(php$keyphp,php$thisphp-php>php_optionsphp)php)php php{
php php php php php php php php throwphp newphp Zendphp_Wildfirephp_Exceptionphp(php'Optionphp withphp namephp php"php'php.php$keyphp.php'php"php doesphp notphp existphp!php'php)php;
php php php php php php php}
php php php php php php php$previousphp php=php php$thisphp-php>php_optionsphp[php$keyphp]php;
php php php php php php php$thisphp-php>php_optionsphp[php$keyphp]php php=php php$valuephp;
php php php php php php returnphp php$previousphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Retrievephp aphp singlephp option
php php php php php php*
php php php php php php*php php@paramphp php stringphp php$keyphp Thephp namephp ofphp thephp option
php php php php php php*php php@returnphp mixedphp Thephp valuephp ofphp thephp option
php php php php php php*php/
php php php php publicphp functionphp getOptionphp(php$keyphp)
php php php php php{
php php php php php php ifphp php(php!arrayphp_keyphp_existsphp(php$keyphp,php$thisphp-php>php_optionsphp)php)php php{
php php php php php php php php throwphp newphp Zendphp_Wildfirephp_Exceptionphp(php'Optionphp withphp namephp php"php'php.php$keyphp.php'php"php doesphp notphp existphp!php'php)php;
php php php php php php php}
php php php php php php returnphp php$thisphp-php>php_optionsphp[php$keyphp]php;
php php php php php}

php php php php php/php*php*
php php php php php php*php Retrievephp allphp options
php php php php php php*
php php php php php php*php php@returnphp arrayphp Allphp options
php php php php php php*php/
php php php php publicphp functionphp getOptionsphp(php)
php php php php php{
php php php php php php returnphp php$thisphp-php>php_optionsphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Specifyphp aphp filterphp tophp bephp usedphp whenphp encodingphp anphp object
php php php php php php*
php php php php php php*php Filtersphp arephp usedphp tophp excludephp objectphp membersphp.
php php php php php php*
php php php php php php*php php@paramphp stringphp php$Classphp Thephp classphp namephp ofphp thephp object
php php php php php php*php php@paramphp arrayphp php$Filterphp Anphp arrayphp ofphp membersphp tophp exclude
php php php php php php*php php@returnphp void
php php php php php php*php/
php php php php publicphp functionphp setObjectFilterphp(php$classphp,php php$filterphp)php php{
php php php php php php php$thisphp-php>php_objectFiltersphp[php$classphp]php php=php php$filterphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Startsphp aphp groupphp inphp thephp Firebugphp Console
php php php php php php*
php php php php php php*php php@paramphp stringphp php$titlephp Thephp titlephp ofphp thephp group
php php php php php php*php php@paramphp arrayphp php$optionsphp OPTIONALphp Settingphp php'Collapsedphp'php tophp truephp willphp initializephp groupphp collapsedphp insteadphp ofphp expanded
php php php php php php*php php@returnphp TRUEphp ifphp thephp groupphp instructionphp wasphp addedphp tophp thephp responsephp headersphp orphp bufferedphp.
php php php php php php*php/
php php php php publicphp staticphp functionphp groupphp(php$titlephp,php php$optionsphp=arrayphp(php)php)
php php php php php{
php php php php php php php php returnphp selfphp:php:sendphp(nullphp,php php$titlephp,php selfphp:php:GROUPphp_STARTphp,php php$optionsphp)php;
php php php php php}

php php php php php/php*php*
php php php php php php*php Endsphp aphp groupphp inphp thephp Firebugphp Console
php php php php php php*
php php php php php php*php php@returnphp TRUEphp ifphp thephp groupphp instructionphp wasphp addedphp tophp thephp responsephp headersphp orphp bufferedphp.
php php php php php php*php/
php php php php publicphp staticphp functionphp groupEndphp(php)
php php php php php{
php php php php php php php php returnphp selfphp:php:sendphp(nullphp,php nullphp,php selfphp:php:GROUPphp_ENDphp)php;
php php php php php}

php php php php php/php*php*
php php php php php php*php Logsphp variablesphp tophp thephp Firebugphp Console
php php php php php php*php viaphp HTTPphp responsephp headersphp andphp thephp FirePHPphp Firefoxphp Extensionphp.
php php php php php php*
php php php php php php*php php@paramphp php mixedphp php php$varphp php php Thephp variablephp tophp logphp.
php php php php php php*php php@paramphp php stringphp php php$labelphp OPTIONALphp Labelphp tophp prependphp tophp thephp logphp eventphp.
php php php php php php*php php@paramphp php stringphp php php$stylephp php OPTIONALphp Stylephp ofphp thephp logphp eventphp.
php php php php php php*php php@paramphp php arrayphp php php$optionsphp OPTIONALphp Optionsphp tophp changephp howphp messagesphp arephp processedphp andphp sent
php php php php php php*php php@returnphp booleanphp Returnsphp TRUEphp ifphp thephp variablephp wasphp addedphp tophp thephp responsephp headersphp orphp bufferedphp.
php php php php php php*php php@throwsphp Zendphp_Wildfirephp_Exception
php php php php php php*php/
php php php php publicphp staticphp functionphp sendphp(php$varphp,php php$labelphp=nullphp,php php$stylephp=nullphp,php php$optionsphp=arrayphp(php)php)
php php php php php{
php php php php php php php php php$firephpphp php=php selfphp:php:getInstancephp(php)php;

php php php php php php php php ifphp php(php!php$firephpphp-php>getEnabledphp(php)php)php php{
php php php php php php php php php php php php returnphp falsephp;
php php php php php php php php php}

php php php php php php php php ifphp php(php$varphp instanceofphp Zendphp_Wildfirephp_Pluginphp_FirePhpphp_Messagephp)php php{

php php php php php php php php php php php php ifphp php(php$varphp-php>getBufferedphp(php)php)php php{
php php php php php php php php php php php php php php php php ifphp php(php!inphp_arrayphp(php$varphp,php selfphp:php:php$php_instancephp-php>php_messagesphp)php)php php{
php php php php php php php php php php php php php php php php php php php php selfphp:php:php$php_instancephp-php>php_messagesphp[php]php php=php php$varphp;
php php php php php php php php php php php php php php php php php}
php php php php php php php php php php php php php php php php returnphp truephp;
php php php php php php php php php php php php php}

php php php php php php php php php php php php ifphp php(php$varphp-php>getDestroyphp(php)php)php php{
php php php php php php php php php php php php php php php php returnphp falsephp;
php php php php php php php php php php php php php}

php php php php php php php php php php php php php$stylephp php=php php$varphp-php>getStylephp(php)php;
php php php php php php php php php php php php php$labelphp php=php php$varphp-php>getLabelphp(php)php;
php php php php php php php php php php php php php$optionsphp php=php php$varphp-php>getOptionsphp(php)php;
php php php php php php php php php php php php php$varphp php=php php$varphp-php>getMessagephp(php)php;
php php php php php php php php php}

php php php php php php php php ifphp php(php!selfphp:php:php$php_instancephp-php>php_channelphp-php>isReadyphp(php)php)php php{
php php php php php php php php php php php php returnphp falsephp;
php php php php php php php php php}

php php php php php php php php foreachphp php(php$optionsphp asphp php$namephp php=php>php php$valuephp)php php{
php php php php php php php php php php php php ifphp php(php$valuephp=php=php=nullphp)php php{
php php php php php php php php php php php php php php php php unsetphp(php$optionsphp[php$namephp]php)php;
php php php php php php php php php php php php php}
php php php php php php php php php}
php php php php php php php php php$optionsphp php=php arrayphp_mergephp(php$firephpphp-php>getOptionsphp(php)php,php php$optionsphp)php;

php php php php php php php php php$tracephp php=php nullphp;

php php php php php php php php php$skipFinalEncodephp php=php falsephp;

php php php php php php php php php$metaphp php=php arrayphp(php)php;
php php php php php php php php php$metaphp[php'Typephp'php]php php=php php$stylephp;

php php php php php php php php ifphp php(php$varphp instanceofphp Exceptionphp)php php{

php php php php php php php php php php php php php$eTracephp php=php php$varphp-php>getTracephp(php)php;
php php php php php php php php php php php php php$eTracephp php=php arrayphp_splicephp(php$eTracephp,php php0php,php php$optionsphp[php'maxTraceDepthphp'php]php)php;

php php php php php php php php php php php php php$varphp php=php arrayphp(php'Classphp'php=php>getphp_classphp(php$varphp)php,
php php php php php php php php php php php php php php php php php php php php php php php php php php'Messagephp'php=php>php$varphp-php>getMessagephp(php)php,
php php php php php php php php php php php php php php php php php php php php php php php php php php'Filephp'php=php>php$varphp-php>getFilephp(php)php,
php php php php php php php php php php php php php php php php php php php php php php php php php php'Linephp'php=php>php$varphp-php>getLinephp(php)php,
php php php php php php php php php php php php php php php php php php php php php php php php php php'Typephp'php=php>php'throwphp'php,
php php php php php php php php php php php php php php php php php php php php php php php php php php'Tracephp'php=php>php$firephpphp-php>php_encodeTracephp(php$eTracephp)php)php;

php php php php php php php php php php php php php$metaphp[php'Typephp'php]php php=php selfphp:php:EXCEPTIONphp;

php php php php php php php php php php php php php$skipFinalEncodephp php=php truephp;

php php php php php php php php php}php else
php php php php php php php php ifphp php(php$metaphp[php'Typephp'php]php=php=selfphp:php:TRACEphp)php php{

php php php php php php php php php php php php ifphp php(php!php$labelphp php&php&php php$varphp)php php{
php php php php php php php php php php php php php php php php php$labelphp php=php php$varphp;
php php php php php php php php php php php php php php php php php$varphp php=php nullphp;
php php php php php php php php php php php php php}

php php php php php php php php php php php php ifphp php(php!php$tracephp)php php{
php php php php php php php php php php php php php php php php php$tracephp php=php php$firephpphp-php>php_getStackTracephp(arrayphp_mergephp(php$optionsphp,
php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php arrayphp(php'maxTraceDepthphp'php=php>php$optionsphp[php'maxTraceDepthphp'php]php+php1php)php)php)php;
php php php php php php php php php php php php php}

php php php php php php php php php php php php php$varphp php=php arrayphp(php'Classphp'php=php>php$tracephp[php0php]php[php'classphp'php]php,
php php php php php php php php php php php php php php php php php php php php php php php php php php'Typephp'php=php>php$tracephp[php0php]php[php'typephp'php]php,
php php php php php php php php php php php php php php php php php php php php php php php php php php'Functionphp'php=php>php$tracephp[php0php]php[php'functionphp'php]php,
php php php php php php php php php php php php php php php php php php php php php php php php php php'Messagephp'php=php>php$labelphp,
php php php php php php php php php php php php php php php php php php php php php php php php php php'Filephp'php=php>issetphp(php$tracephp[php0php]php[php'filephp'php]php)php?php$tracephp[php0php]php[php'filephp'php]php:php'php'php,
php php php php php php php php php php php php php php php php php php php php php php php php php php'Linephp'php=php>issetphp(php$tracephp[php0php]php[php'linephp'php]php)php?php$tracephp[php0php]php[php'linephp'php]php:php'php'php,
php php php php php php php php php php php php php php php php php php php php php php php php php php'Argsphp'php=php>issetphp(php$tracephp[php0php]php[php'argsphp'php]php)php?php$firephpphp-php>php_encodeObjectphp(php$tracephp[php0php]php[php'argsphp'php]php)php:php'php'php,
php php php php php php php php php php php php php php php php php php php php php php php php php php'Tracephp'php=php>php$firephpphp-php>php_encodeTracephp(arrayphp_splicephp(php$tracephp,php1php)php)php)php;

php php php php php php php php php php php$skipFinalEncodephp php=php truephp;

php php php php php php php php php}php else
php php php php php php php php ifphp php(php$metaphp[php'Typephp'php]php=php=selfphp:php:TABLEphp)php php{

php php php php php php php php php php php$varphp php=php php$firephpphp-php>php_encodeTablephp(php$varphp)php;

php php php php php php php php php php php$skipFinalEncodephp php=php truephp;

php php php php php php php php php}php elsephp php{
php php php php php php php php php php php php ifphp php(php$metaphp[php'Typephp'php]php=php=php=nullphp)php php{
php php php php php php php php php php php php php php php php php$metaphp[php'Typephp'php]php php=php selfphp:php:LOGphp;
php php php php php php php php php php php php php}
php php php php php php php php php}

php php php php php php php php ifphp php(php$labelphp!php=nullphp)php php{
php php php php php php php php php php php php php$metaphp[php'Labelphp'php]php php=php php$labelphp;
php php php php php php php php php}

php php php php php php php php switchphp php(php$metaphp[php'Typephp'php]php)php php{
php php php php php php php php php php php php casephp selfphp:php:LOGphp:
php php php php php php php php php php php php casephp selfphp:php:INFOphp:
php php php php php php php php php php php php casephp selfphp:php:WARNphp:
php php php php php php php php php php php php casephp selfphp:php:ERRORphp:
php php php php php php php php php php php php casephp selfphp:php:EXCEPTIONphp:
php php php php php php php php php php php php casephp selfphp:php:TRACEphp:
php php php php php php php php php php php php casephp selfphp:php:TABLEphp:
php php php php php php php php php php php php casephp selfphp:php:DUMPphp:
php php php php php php php php php php php php casephp selfphp:php:GROUPphp_STARTphp:
php php php php php php php php php php php php casephp selfphp:php:GROUPphp_ENDphp:
php php php php php php php php php php php php php php php php breakphp;
php php php php php php php php php php php php defaultphp:
php php php php php php php php php php php php php php php php requirephp_oncephp php'Zendphp/Wildfirephp/Exceptionphp.phpphp'php;
php php php php php php php php php php php php php php php php throwphp newphp Zendphp_Wildfirephp_Exceptionphp(php'Logphp stylephp php"php'php.php$metaphp[php'Typephp'php]php.php'php"php notphp recognizedphp!php'php)php;
php php php php php php php php php php php php php php php php breakphp;
php php php php php php php php php}

php php php php php php php php ifphp php(php$metaphp[php'Typephp'php]php php!php=php selfphp:php:DUMPphp php&php&php php$optionsphp[php'includeLineNumbersphp'php]php)php php{
php php php php php php php php php php php php ifphp php(php!issetphp(php$metaphp[php'Filephp'php]php)php php|php|php php!issetphp(php$metaphp[php'Linephp'php]php)php)php php{

php php php php php php php php php php php php php php php php ifphp php(php!php$tracephp)php php{
php php php php php php php php php php php php php php php php php php php php php$tracephp php=php php$firephpphp-php>php_getStackTracephp(arrayphp_mergephp(php$optionsphp,
php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php arrayphp(php'maxTraceDepthphp'php=php>php$optionsphp[php'maxTraceDepthphp'php]php+php1php)php)php)php;
php php php php php php php php php php php php php php php php php}

php php php php php php php php php php php php php php php php php$metaphp[php'Filephp'php]php php=php issetphp(php$tracephp[php0php]php[php'filephp'php]php)php?php$tracephp[php0php]php[php'filephp'php]php:php'php'php;
php php php php php php php php php php php php php php php php php$metaphp[php'Linephp'php]php php=php issetphp(php$tracephp[php0php]php[php'linephp'php]php)php?php$tracephp[php0php]php[php'linephp'php]php:php'php'php;

php php php php php php php php php php php php php}
php php php php php php php php php}php elsephp php{
php php php php php php php php php php php php unsetphp(php$metaphp[php'Filephp'php]php)php;
php php php php php php php php php php php php unsetphp(php$metaphp[php'Linephp'php]php)php;
php php php php php php php php php}

php php php php php php php php ifphp php(php$metaphp[php'Typephp'php]php php=php=php selfphp:php:GROUPphp_STARTphp)php php{
php php php php php php php php php php php php ifphp php(issetphp(php$optionsphp[php'Collapsedphp'php]php)php)php php{
php php php php php php php php php php php php php php php php php$metaphp[php'Collapsedphp'php]php php=php php(php$optionsphp[php'Collapsedphp'php]php)php?php'truephp'php:php'falsephp'php;
php php php php php php php php php php php php php}
php php php php php php php php php}

php php php php php php php php ifphp php(php$metaphp[php'Typephp'php]php php=php=php selfphp:php:DUMPphp)php php{

php php php php php php php php php php returnphp php$firephpphp-php>php_recordMessagephp(selfphp:php:STRUCTUREphp_URIphp_DUMPphp,
php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php arrayphp(php'keyphp'php=php>php$metaphp[php'Labelphp'php]php,
php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php'dataphp'php=php>php$varphp)php,
php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php$skipFinalEncodephp)php;

php php php php php php php php php}php elsephp php{

php php php php php php php php php php returnphp php$firephpphp-php>php_recordMessagephp(selfphp:php:STRUCTUREphp_URIphp_FIREBUGCONSOLEphp,
php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php arrayphp(php'dataphp'php=php>php$varphp,
php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php'metaphp'php=php>php$metaphp)php,
php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php$skipFinalEncodephp)php;
php php php php php php php php php}
php php php php php}

php php php php php/php*php*
php php php php php php*php Getsphp aphp stackphp trace
php php php php php php*
php php php php php php*php php@paramphp arrayphp php$optionsphp Optionsphp tophp changephp howphp thephp stackphp tracephp isphp returned
php php php php php php*php php@returnphp arrayphp Thephp stackphp trace
php php php php php php*php/
php php php php protectedphp functionphp php_getStackTracephp(php$optionsphp)
php php php php php{
php php php php php php php php php$tracephp php=php debugphp_backtracephp(php)php;

php php php php php php php php php$tracephp php=php arrayphp_splicephp(php$tracephp,php php$optionsphp[php'traceOffsetphp'php]php)php;

php php php php php php php php ifphp php(php!countphp(php$tracephp)php)php php{
php php php php php php php php php php php php returnphp php$tracephp;
php php php php php php php php php}

php php php php php php php php ifphp php(issetphp(php$optionsphp[php'fixZendLogOffsetIfApplicablephp'php]php)php php&php&php php$optionsphp[php'fixZendLogOffsetIfApplicablephp'php]php)php php{
php php php php php php php php php php php php ifphp php(countphp(php$tracephp)php php>php=php3php php&php&
php php php php php php php php php php php php php php php php issetphp(php$tracephp[php0php]php[php'filephp'php]php)php php&php&php substrphp(php$tracephp[php0php]php[php'filephp'php]php,php php-php7php,php php7php)php=php=php'Logphp.phpphp'php php&php&
php php php php php php php php php php php php php php php php issetphp(php$tracephp[php1php]php[php'functionphp'php]php)php php&php&php php$tracephp[php1php]php[php'functionphp'php]php=php=php'php_php_callphp'php)php php{

php php php php php php php php php php php php php php php php php$tracephp php=php arrayphp_splicephp(php$tracephp,php php2php)php;
php php php php php php php php php php php php php}
php php php php php php php php php}

php php php php php php php php returnphp arrayphp_splicephp(php$tracephp,php php0php,php php$optionsphp[php'maxTraceDepthphp'php]php)php;
php php php php php}

php php php php php/php*php*
php php php php php php*php Recordphp aphp messagephp withphp thephp givenphp dataphp inphp thephp givenphp structure
php php php php php php*
php php php php php php*php php@paramphp stringphp php$structurephp Thephp structurephp tophp bephp usedphp forphp thephp data
php php php php php php*php php@paramphp arrayphp php$dataphp Thephp dataphp tophp bephp recorded
php php php php php php*php php@paramphp booleanphp php$skipEncodephp TRUEphp ifphp variablephp encodingphp shouldphp bephp skipped
php php php php php php*php php@returnphp booleanphp Returnsphp TRUEphp ifphp messagephp wasphp recorded
php php php php php php*php php@throwsphp Zendphp_Wildfirephp_Exception
php php php php php php*php/
php php php php protectedphp functionphp php_recordMessagephp(php$structurephp,php php$dataphp,php php$skipEncodephp=falsephp)
php php php php php{
php php php php php php php php switchphp(php$structurephp)php php{

php php php php php php php php php php php php casephp selfphp:php:STRUCTUREphp_URIphp_DUMPphp:

php php php php php php php php php php php php php php php php ifphp php(php!issetphp(php$dataphp[php'keyphp'php]php)php)php php{
php php php php php php php php php php php php php php php php php php php php requirephp_oncephp php'Zendphp/Wildfirephp/Exceptionphp.phpphp'php;
php php php php php php php php php php php php php php php php php php php php throwphp newphp Zendphp_Wildfirephp_Exceptionphp(php'Youphp mustphp supplyphp aphp keyphp.php'php)php;
php php php php php php php php php php php php php php php php php}
php php php php php php php php php php php php php php php php ifphp php(php!arrayphp_keyphp_existsphp(php'dataphp'php,php$dataphp)php)php php{
php php php php php php php php php php php php php php php php php php php php requirephp_oncephp php'Zendphp/Wildfirephp/Exceptionphp.phpphp'php;
php php php php php php php php php php php php php php php php php php php php throwphp newphp Zendphp_Wildfirephp_Exceptionphp(php'Youphp mustphp supplyphp dataphp.php'php)php;
php php php php php php php php php php php php php php php php php}

php php php php php php php php php php php php php php php php php$valuephp php=php php$dataphp[php'dataphp'php]php;
php php php php php php php php php php php php php php php php ifphp php(php!php$skipEncodephp)php php{
php php php php php php php php php php php php php php php php php php php$valuephp php=php php$thisphp-php>php_encodeObjectphp(php$dataphp[php'dataphp'php]php)php;
php php php php php php php php php php php php php php php php php}

php php php php php php php php php php php php php php php php returnphp php$thisphp-php>php_channelphp-php>getProtocolphp(selfphp:php:PROTOCOLphp_URIphp)php-php>
php php php php php php php php php php php php php php php php php php php php php php php php php php php recordMessagephp(php$thisphp,
php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php$structurephp,
php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php arrayphp(php$dataphp[php'keyphp'php]php=php>php$valuephp)php)php;

php php php php php php php php php php php php casephp selfphp:php:STRUCTUREphp_URIphp_FIREBUGCONSOLEphp:

php php php php php php php php php php php php php php php php ifphp php(php!issetphp(php$dataphp[php'metaphp'php]php)php php|php|
php php php php php php php php php php php php php php php php php php php php php!isphp_arrayphp(php$dataphp[php'metaphp'php]php)php php|php|
php php php php php php php php php php php php php php php php php php php php php!arrayphp_keyphp_existsphp(php'Typephp'php,php$dataphp[php'metaphp'php]php)php)php php{

php php php php php php php php php php php php php php php php php php php php requirephp_oncephp php'Zendphp/Wildfirephp/Exceptionphp.phpphp'php;
php php php php php php php php php php php php php php php php php php php php throwphp newphp Zendphp_Wildfirephp_Exceptionphp(php'Youphp mustphp supplyphp aphp php"Typephp"php inphp thephp metaphp informationphp.php'php)php;
php php php php php php php php php php php php php php php php php}
php php php php php php php php php php php php php php php php ifphp php(php!arrayphp_keyphp_existsphp(php'dataphp'php,php$dataphp)php)php php{
php php php php php php php php php php php php php php php php php php php php requirephp_oncephp php'Zendphp/Wildfirephp/Exceptionphp.phpphp'php;
php php php php php php php php php php php php php php php php php php php php throwphp newphp Zendphp_Wildfirephp_Exceptionphp(php'Youphp mustphp supplyphp dataphp.php'php)php;
php php php php php php php php php php php php php php php php php}

php php php php php php php php php php php php php php php php php$valuephp php=php php$dataphp[php'dataphp'php]php;
php php php php php php php php php php php php php php php php ifphp php(php!php$skipEncodephp)php php{
php php php php php php php php php php php php php php php php php php php$valuephp php=php php$thisphp-php>php_encodeObjectphp(php$dataphp[php'dataphp'php]php)php;
php php php php php php php php php php php php php php php php php}

php php php php php php php php php php php php php php php php returnphp php$thisphp-php>php_channelphp-php>getProtocolphp(selfphp:php:PROTOCOLphp_URIphp)php-php>
php php php php php php php php php php php php php php php php php php php php php php php php php php php recordMessagephp(php$thisphp,
php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php$structurephp,
php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php arrayphp(php$dataphp[php'metaphp'php]php,
php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php$valuephp)php)php;

php php php php php php php php php php php php defaultphp:
php php php php php php php php php php php php php php php php requirephp_oncephp php'Zendphp/Wildfirephp/Exceptionphp.phpphp'php;
php php php php php php php php php php php php php php php php throwphp newphp Zendphp_Wildfirephp_Exceptionphp(php'Structurephp ofphp namephp php"php'php.php$structurephp.php'php"php isphp notphp recognizedphp.php'php)php;
php php php php php php php php php php php php php php php php breakphp;
php php php php php php php php php}
php php php php php php php php returnphp falsephp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Encodesphp aphp tablephp byphp encodingphp eachphp rowphp andphp columnphp withphp php_encodeObjectphp(php)
php php php php php php*
php php php php php php*php php@paramphp arrayphp php$Tablephp Thephp tablephp tophp bephp encoded
php php php php php php*php php@returnphp array
php php php php php php*php/
php php php php protectedphp functionphp php_encodeTablephp(php$tablephp)
php php php php php{
php php php php php php ifphp php(php!php$tablephp)php php{
php php php php php php php php php php returnphp php$tablephp;
php php php php php php php}
php php php php php php forphp php(php$iphp=php0php php;php php$iphp<countphp(php$tablephp)php php;php php$iphp+php+php)php php{
php php php php php php php php php php ifphp php(isphp_arrayphp(php$tablephp[php$iphp]php)php)php php{
php php php php php php php php php php php php php php forphp php(php$jphp=php0php php;php php$jphp<countphp(php$tablephp[php$iphp]php)php php;php php$jphp+php+php)php php{
php php php php php php php php php php php php php php php php php php php$tablephp[php$iphp]php[php$jphp]php php=php php$thisphp-php>php_encodeObjectphp(php$tablephp[php$iphp]php[php$jphp]php)php;
php php php php php php php php php php php php php php php}
php php php php php php php php php php php}
php php php php php php php php php}
php php php php php php returnphp php$tablephp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Encodesphp aphp tracephp byphp encodingphp allphp php"argsphp"php withphp php_encodeObjectphp(php)
php php php php php php*
php php php php php php*php php@paramphp arrayphp php$Tracephp Thephp tracephp tophp bephp encoded
php php php php php php*php php@returnphp arrayphp Thephp encodedphp trace
php php php php php php*php/
php php php php protectedphp functionphp php_encodeTracephp(php$tracephp)
php php php php php{
php php php php php php ifphp php(php!php$tracephp)php php{
php php php php php php php php php php returnphp php$tracephp;
php php php php php php php}
php php php php php php forphp php(php$iphp=php0php php;php php$iphp<sizeofphp(php$tracephp)php php;php php$iphp+php+php)php php{
php php php php php php php php php php ifphp php(issetphp(php$tracephp[php$iphp]php[php'argsphp'php]php)php)php php{
php php php php php php php php php php php php php php php$tracephp[php$iphp]php[php'argsphp'php]php php=php php$thisphp-php>php_encodeObjectphp(php$tracephp[php$iphp]php[php'argsphp'php]php)php;
php php php php php php php php php php php}
php php php php php php php}
php php php php php php returnphp php$tracephp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Encodephp anphp objectphp byphp generatingphp anphp arrayphp containingphp allphp objectphp membersphp.
php php php php php php*
php php php php php php*php Allphp privatephp andphp protectedphp membersphp arephp includedphp.php Somephp metaphp infophp about
php php php php php php*php thephp objectphp classphp isphp addedphp.
php php php php php php*
php php php php php php*php php@paramphp mixedphp php$objectphp Thephp objectphp/arrayphp/valuephp tophp bephp encoded
php php php php php php*php php@returnphp arrayphp Thephp encodedphp object
php php php php php php*php/
php php php php protectedphp functionphp php_encodeObjectphp(php$objectphp,php php$objectDepthphp php=php php1php,php php$arrayDepthphp php=php php1php)
php php php php php{
php php php php php php php php php$returnphp php=php arrayphp(php)php;

php php php php php php php php ifphp php(isphp_resourcephp(php$objectphp)php)php php{

php php php php php php php php php php php php returnphp php'php*php*php php'php.php(stringphp)php$objectphp.php'php php*php*php'php;

php php php php php php php php php}php else
php php php php php php php php ifphp php(isphp_objectphp(php$objectphp)php)php php{

php php php php php php php php php php php php ifphp php(php$objectDepthphp php>php php$thisphp-php>php_optionsphp[php'maxObjectDepthphp'php]php)php php{
php php php php php php php php php php php php php php returnphp php'php*php*php Maxphp Objectphp Depthphp php(php'php.php$thisphp-php>php_optionsphp[php'maxObjectDepthphp'php]php.php'php)php php*php*php'php;
php php php php php php php php php php php php php}

php php php php php php php php php php php php foreachphp php(php$thisphp-php>php_objectStackphp asphp php$refValphp)php php{
php php php php php php php php php php php php php php php php ifphp php(php$refValphp php=php=php=php php$objectphp)php php{
php php php php php php php php php php php php php php php php php php php php returnphp php'php*php*php Recursionphp php(php'php.getphp_classphp(php$objectphp)php.php'php)php php*php*php'php;
php php php php php php php php php php php php php php php php php}
php php php php php php php php php php php php php}
php php php php php php php php php php php php arrayphp_pushphp(php$thisphp-php>php_objectStackphp,php php$objectphp)php;

php php php php php php php php php php php php php$returnphp[php'php_php_classNamephp'php]php php=php php$classphp php=php getphp_classphp(php$objectphp)php;

php php php php php php php php php php php php php$reflectionClassphp php=php newphp ReflectionClassphp(php$classphp)php;
php php php php php php php php php php php php php$propertiesphp php=php arrayphp(php)php;
php php php php php php php php php php php php foreachphp php(php php$reflectionClassphp-php>getPropertiesphp(php)php asphp php$propertyphp)php php{
php php php php php php php php php php php php php php php php php$propertiesphp[php$propertyphp-php>getNamephp(php)php]php php=php php$propertyphp;
php php php php php php php php php php php php php}

php php php php php php php php php php php php php$membersphp php=php php(arrayphp)php$objectphp;

php php php php php php php php php php php php foreachphp php(php$propertiesphp asphp php$justphp_namephp php=php>php php$propertyphp)php php{

php php php php php php php php php php php php php php php php php$namephp php=php php$rawphp_namephp php=php php$justphp_namephp;

php php php php php php php php php php php php php php php php ifphp php(php$propertyphp-php>isStaticphp(php)php)php php{
php php php php php php php php php php php php php php php php php php php php php$namephp php=php php'staticphp:php'php.php$namephp;
php php php php php php php php php php php php php php php php php}
php php php php php php php php php php php php php php php php ifphp php(php$propertyphp-php>isPublicphp(php)php)php php{
php php php php php php php php php php php php php php php php php php php php php$namephp php=php php'publicphp:php'php.php$namephp;
php php php php php php php php php php php php php php php php php}php else
php php php php php php php php php php php php php php php php ifphp php(php$propertyphp-php>isPrivatephp(php)php)php php{
php php php php php php php php php php php php php php php php php php php php php$namephp php=php php'privatephp:php'php.php$namephp;
php php php php php php php php php php php php php php php php php php php php php$rawphp_namephp php=php php"php\php0php"php.php$classphp.php"php\php0php"php.php$rawphp_namephp;
php php php php php php php php php php php php php php php php php}php else
php php php php php php php php php php php php php php php php ifphp php(php$propertyphp-php>isProtectedphp(php)php)php php{
php php php php php php php php php php php php php php php php php php php php php$namephp php=php php'protectedphp:php'php.php$namephp;
php php php php php php php php php php php php php php php php php php php php php$rawphp_namephp php=php php"php\php0php"php.php'php*php'php.php"php\php0php"php.php$rawphp_namephp;
php php php php php php php php php php php php php php php php php}

php php php php php php php php php php php php php php php php ifphp php(php!php(issetphp(php$thisphp-php>php_objectFiltersphp[php$classphp]php)
php php php php php php php php php php php php php php php php php php php php php php php&php&php isphp_arrayphp(php$thisphp-php>php_objectFiltersphp[php$classphp]php)
php php php php php php php php php php php php php php php php php php php php php php php&php&php inphp_arrayphp(php$justphp_namephp,php$thisphp-php>php_objectFiltersphp[php$classphp]php)php)php)php php{

php php php php php php php php php php php php php php php php php php php php ifphp php(arrayphp_keyphp_existsphp(php$rawphp_namephp,php$membersphp)
php php php php php php php php php php php php php php php php php php php php php php php php php&php&php php!php$propertyphp-php>isStaticphp(php)php)php php{

php php php php php php php php php php php php php php php php php php php php php php php php php$returnphp[php$namephp]php php=php php$thisphp-php>php_encodeObjectphp(php$membersphp[php$rawphp_namephp]php,php php$objectDepthphp php+php php1php,php php1php)php;

php php php php php php php php php php php php php php php php php php php php php}php elsephp php{
php php php php php php php php php php php php php php php php php php php php php php php php ifphp php(methodphp_existsphp(php$propertyphp,php'setAccessiblephp'php)php)php php{
php php php php php php php php php php php php php php php php php php php php php php php php php php php php php$propertyphp-php>setAccessiblephp(truephp)php;
php php php php php php php php php php php php php php php php php php php php php php php php php php php php php$returnphp[php$namephp]php php=php php$thisphp-php>php_encodeObjectphp(php$propertyphp-php>getValuephp(php$objectphp)php,php php$objectDepthphp php+php php1php,php php1php)php;
php php php php php php php php php php php php php php php php php php php php php php php php php}php else
php php php php php php php php php php php php php php php php php php php php php php php php ifphp php(php$propertyphp-php>isPublicphp(php)php)php php{
php php php php php php php php php php php php php php php php php php php php php php php php php php php php php$returnphp[php$namephp]php php=php php$thisphp-php>php_encodeObjectphp(php$propertyphp-php>getValuephp(php$objectphp)php,php php$objectDepthphp php+php php1php,php php1php)php;
php php php php php php php php php php php php php php php php php php php php php php php php php}php elsephp php{
php php php php php php php php php php php php php php php php php php php php php php php php php php php php php$returnphp[php$namephp]php php=php php'php*php*php Needphp PHPphp php5php.php3php tophp getphp valuephp php*php*php'php;
php php php php php php php php php php php php php php php php php php php php php php php php php}
php php php php php php php php php php php php php php php php php php php php php}
php php php php php php php php php php php php php php php php php}php elsephp php{
php php php php php php php php php php php php php php php php php php php$returnphp[php$namephp]php php=php php'php*php*php Excludedphp byphp Filterphp php*php*php'php;
php php php php php php php php php php php php php php php php php}
php php php php php php php php php php php php php}

php php php php php php php php php php php php php/php/php Includephp allphp membersphp thatphp arephp notphp definedphp inphp thephp class
php php php php php php php php php php php php php/php/php butphp existphp inphp thephp object
php php php php php php php php php php php php foreachphp(php$membersphp asphp php$justphp_namephp php=php>php php$valuephp)php php{

php php php php php php php php php php php php php php php php php$namephp php=php php$rawphp_namephp php=php php$justphp_namephp;

php php php php php php php php php php php php php php php php ifphp php(php$namephp{php0php}php php=php=php php"php\php0php"php)php php{
php php php php php php php php php php php php php php php php php php php php php$partsphp php=php explodephp(php"php\php0php"php,php php$namephp)php;
php php php php php php php php php php php php php php php php php php php php php$namephp php=php php$partsphp[php2php]php;
php php php php php php php php php php php php php php php php php}
php php php php php php php php php php php php php php php php ifphp php(php!issetphp(php$propertiesphp[php$namephp]php)php)php php{
php php php php php php php php php php php php php php php php php php php php php$namephp php=php php'undeclaredphp:php'php.php$namephp;

php php php php php php php php php php php php php php php php php php php php ifphp php(php!php(issetphp(php$thisphp-php>objectFiltersphp[php$classphp]php)
php php php php php php php php php php php php php php php php php php php php php php php php php php php&php&php isphp_arrayphp(php$thisphp-php>objectFiltersphp[php$classphp]php)
php php php php php php php php php php php php php php php php php php php php php php php php php php php&php&php inphp_arrayphp(php$justphp_namephp,php$thisphp-php>objectFiltersphp[php$classphp]php)php)php)php php{

php php php php php php php php php php php php php php php php php php php php php php php$returnphp[php$namephp]php php=php php$thisphp-php>php_encodeObjectphp(php$valuephp,php php$objectDepthphp php+php php1php,php php1php)php;
php php php php php php php php php php php php php php php php php php php php php}php elsephp php{
php php php php php php php php php php php php php php php php php php php php php php php$returnphp[php$namephp]php php=php php'php*php*php Excludedphp byphp Filterphp php*php*php'php;
php php php php php php php php php php php php php php php php php php php php php}
php php php php php php php php php php php php php php php php php}
php php php php php php php php php php php php php}

php php php php php php php php php php php php arrayphp_popphp(php$thisphp-php>php_objectStackphp)php;

php php php php php php php php php}php elseifphp php(isphp_arrayphp(php$objectphp)php)php php{

php php php php php php php php php php php php ifphp php(php$arrayDepthphp php>php php$thisphp-php>php_optionsphp[php'maxArrayDepthphp'php]php)php php{
php php php php php php php php php php php php php php returnphp php'php*php*php Maxphp Arrayphp Depthphp php(php'php.php$thisphp-php>php_optionsphp[php'maxArrayDepthphp'php]php.php'php)php php*php*php'php;
php php php php php php php php php php php php php}

php php php php php php php php php php php php foreachphp php(php$objectphp asphp php$keyphp php=php>php php$valphp)php php{

php php php php php php php php php php php php php php php/php/php Encodingphp thephp php$GLOBALSphp PHPphp arrayphp causesphp anphp infinitephp loop
php php php php php php php php php php php php php php php/php/php ifphp thephp recursionphp isphp notphp resetphp herephp asphp itphp contains
php php php php php php php php php php php php php php php/php/php aphp referencephp tophp itselfphp.php Thisphp isphp thephp onlyphp wayphp Iphp havephp comephp up
php php php php php php php php php php php php php php php/php/php withphp tophp stopphp infinitephp recursionphp inphp thisphp casephp.
php php php php php php php php php php php php php php ifphp php(php$keyphp=php=php'GLOBALSphp'
php php php php php php php php php php php php php php php php php php php&php&php isphp_arrayphp(php$valphp)
php php php php php php php php php php php php php php php php php php php&php&php arrayphp_keyphp_existsphp(php'GLOBALSphp'php,php$valphp)php)php php{

php php php php php php php php php php php php php php php php php php php$valphp[php'GLOBALSphp'php]php php=php php'php*php*php Recursionphp php(GLOBALSphp)php php*php*php'php;
php php php php php php php php php php php php php php php}
php php php php php php php php php php php php php php php$returnphp[php$keyphp]php php=php php$thisphp-php>php_encodeObjectphp(php$valphp,php php1php,php php$arrayDepthphp php+php php1php)php;
php php php php php php php php php php php php php}
php php php php php php php php php}php elsephp php{
php php php php php php php php php php php php returnphp php$objectphp;
php php php php php php php php php}
php php php php php php php php returnphp php$returnphp;
php php php php php}

php php php php php/php*
php php php php php php*php Zendphp_Wildfirephp_Pluginphp_Interface
php php php php php php*php/

php php php php php/php*php*
php php php php php php*php Getphp thephp uniquephp indentifierphp forphp thisphp pluginphp.
php php php php php php*
php php php php php php*php php@returnphp stringphp Returnsphp thephp URIphp ofphp thephp pluginphp.
php php php php php php*php/
php php php php publicphp functionphp getUriphp(php)
php php php php php{
php php php php php php php php returnphp selfphp:php:PLUGINphp_URIphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Flushphp anyphp bufferedphp dataphp.
php php php php php php*
php php php php php php*php php@paramphp stringphp php$protocolUriphp Thephp URIphp ofphp thephp protocolphp thatphp shouldphp bephp flushedphp to
php php php php php php*php php@returnphp void
php php php php php php*php/
php php php php publicphp functionphp flushMessagesphp(php$protocolUriphp)
php php php php php{
php php php php php php php php ifphp php(php!php$thisphp-php>php_messagesphp php|php|php php$protocolUriphp!php=selfphp:php:PROTOCOLphp_URIphp)php php{
php php php php php php php php php php php php returnphp;
php php php php php php php php php}

php php php php php php php php foreachphp(php php$thisphp-php>php_messagesphp asphp php$messagephp php)php php{
php php php php php php php php php php php php ifphp php(php!php$messagephp-php>getDestroyphp(php)php)php php{
php php php php php php php php php php php php php php php php php$thisphp-php>sendphp(php$messagephp-php>getMessagephp(php)php,
php php php php php php php php php php php php php php php php php php php php php php php php php php php php php$messagephp-php>getLabelphp(php)php,
php php php php php php php php php php php php php php php php php php php php php php php php php php php php php$messagephp-php>getStylephp(php)php,
php php php php php php php php php php php php php php php php php php php php php php php php php php php php php$messagephp-php>getOptionsphp(php)php)php;
php php php php php php php php php php php php php}
php php php php php php php php php}

php php php php php php php php php$thisphp-php>php_messagesphp php=php arrayphp(php)php;
php php php php php}
php}
