<php?php
php/php*php*
php php*php Zendphp Framework
php php*
php php*php LICENSE
php php*
php php*php Thisphp sourcephp filephp isphp subjectphp tophp thephp newphp BSDphp licensephp thatphp isphp bundled
php php*php withphp thisphp packagephp inphp thephp filephp LICENSEphp.txtphp.
php php*php Itphp isphp alsophp availablephp throughphp thephp worldphp-widephp-webphp atphp thisphp URLphp:
php php*php httpphp:php/php/frameworkphp.zendphp.comphp/licensephp/newphp-bsd
php php*php Ifphp youphp didphp notphp receivephp aphp copyphp ofphp thephp licensephp andphp arephp unablephp to
php php*php obtainphp itphp throughphp thephp worldphp-widephp-webphp,php pleasephp sendphp anphp email
php php*php tophp licensephp@zendphp.comphp sophp wephp canphp sendphp youphp aphp copyphp immediatelyphp.
php php*
php php*php php@categoryphp php php Zend
php php*php php@packagephp php php php Zendphp_Locale
php php*php php@subpackagephp Format
php php*php php@copyrightphp php Copyrightphp php(cphp)php php2php0php0php5php-php2php0php1php0php Zendphp Technologiesphp USAphp Incphp.php php(httpphp:php/php/wwwphp.zendphp.comphp)
php php*php php@versionphp php php php php$Idphp:php Formatphp.phpphp php2php2php8php0php8php php2php0php1php0php-php0php8php-php0php8php php0php9php:php3php8php:php4php2Zphp thomasphp php$
php php*php php@licensephp php php php httpphp:php/php/frameworkphp.zendphp.comphp/licensephp/newphp-bsdphp php php php php Newphp BSDphp License
php php*php/

php/php*php*
php php*php includephp neededphp classes
php php*php/
requirephp_oncephp php'Zendphp/Localephp/Dataphp.phpphp'php;

php/php*php*
php php*php php@categoryphp php php Zend
php php*php php@packagephp php php php Zendphp_Locale
php php*php php@subpackagephp Format
php php*php php@copyrightphp php Copyrightphp php(cphp)php php2php0php0php5php-php2php0php1php0php Zendphp Technologiesphp USAphp Incphp.php php(httpphp:php/php/wwwphp.zendphp.comphp)
php php*php php@licensephp php php php httpphp:php/php/frameworkphp.zendphp.comphp/licensephp/newphp-bsdphp php php php php Newphp BSDphp License
php php*php/
classphp Zendphp_Localephp_Format
php{
php php php php constphp STANDARDphp php php php=php php'autophp'php;

php php php php privatephp staticphp php$php_optionsphp php=php arrayphp(php'datephp_formatphp'php php php php=php>php nullphp,
php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php'numberphp_formatphp'php php=php>php nullphp,
php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php'formatphp_typephp'php php php php=php>php php'isophp'php,
php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php'fixphp_datephp'php php php php php php php=php>php falsephp,
php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php'localephp'php php php php php php php php php=php>php nullphp,
php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php'cachephp'php php php php php php php php php php=php>php nullphp,
php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php'disableCachephp'php php php=php>php falsephp,
php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php'precisionphp'php php php php php php=php>php nullphp)php;

php php php php php/php*php*
php php php php php php*php Setsphp classphp widephp optionsphp,php ifphp nophp optionphp wasphp givenphp,php thephp actualphp setphp optionsphp willphp bephp returned
php php php php php php*php Thephp php'precisionphp'php optionphp ofphp aphp valuephp isphp usedphp tophp truncatephp orphp stretchphp extraphp digitsphp.php php-php1php meansphp notphp tophp touchphp thephp extraphp digitsphp.
php php php php php php*php Thephp php'localephp'php optionphp helpsphp whenphp parsingphp numbersphp andphp datesphp usingphp separatorsphp andphp monthphp namesphp.
php php php php php php*php Thephp datephp formatphp php'formatphp_typephp'php optionphp selectsphp betweenphp CLDRphp/ISOphp datephp formatphp specifierphp tokensphp andphp PHPphp'sphp datephp(php)php tokensphp.
php php php php php php*php Thephp php'fixphp_datephp'php optionphp enablesphp orphp disablesphp heuristicsphp thatphp attemptphp tophp correctphp invalidphp datesphp.
php php php php php php*php Thephp php'numberphp_formatphp'php optionphp canphp bephp usedphp tophp specifyphp aphp defaultphp numberphp formatphp string
php php php php php php*php Thephp php'datephp_formatphp'php optionphp canphp bephp usedphp tophp specifyphp aphp defaultphp datephp formatphp stringphp,php butphp bewarephp ofphp usingphp getDatephp(php)php,
php php php php php php*php checkDateFormatphp(php)php andphp getTimephp(php)php afterphp usingphp setOptionsphp(php)php withphp aphp php'formatphp'php.php php Tophp usephp thesephp fourphp methods
php php php php php php*php withphp thephp defaultphp datephp formatphp forphp aphp localephp,php usephp arrayphp(php'datephp_formatphp'php php=php>php nullphp,php php'localephp'php php=php>php php$localephp)php forphp theirphp optionsphp.
php php php php php php*
php php php php php php*php php@paramphp php arrayphp php php$optionsphp php Arrayphp ofphp optionsphp,php keyedphp byphp optionphp namephp:php formatphp_typephp php=php php'isophp'php php|php php'phpphp'php,php fixphp_datephp php=php truephp php|php falsephp,
php php php php php php*php php php php php php php php php php php php php php php php php php php php php php php php php php localephp php=php Zendphp_Localephp php|php localephp stringphp,php precisionphp php=php wholephp numberphp betweenphp php-php1php andphp php3php0
php php php php php php*php php@throwsphp Zendphp_Localephp_Exception
php php php php php php*php php@returnphp Optionsphp arrayphp ifphp nophp optionphp wasphp given
php php php php php php*php/
php php php php publicphp staticphp functionphp setOptionsphp(arrayphp php$optionsphp php=php arrayphp(php)php)
php php php php php{
php php php php php php php php selfphp:php:php$php_optionsphp php=php selfphp:php:php_checkOptionsphp(php$optionsphp)php php+php selfphp:php:php$php_optionsphp;
php php php php php php php php returnphp selfphp:php:php$php_optionsphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Internalphp functionphp forphp checkingphp thephp optionsphp arrayphp ofphp properphp inputphp values
php php php php php php*php Seephp php{php@linkphp setOptionsphp(php)php}php forphp detailsphp.
php php php php php php*
php php php php php php*php php@paramphp php arrayphp php php$optionsphp php Arrayphp ofphp optionsphp,php keyedphp byphp optionphp namephp:php formatphp_typephp php=php php'isophp'php php|php php'phpphp'php,php fixphp_datephp php=php truephp php|php falsephp,
php php php php php php*php php php php php php php php php php php php php php php php php php php php php php php php php php localephp php=php Zendphp_Localephp php|php localephp stringphp,php precisionphp php=php wholephp numberphp betweenphp php-php1php andphp php3php0
php php php php php php*php php@throwsphp Zendphp_Localephp_Exception
php php php php php php*php php@returnphp Optionsphp arrayphp ifphp nophp optionphp wasphp given
php php php php php php*php/
php php php php privatephp staticphp functionphp php_checkOptionsphp(arrayphp php$optionsphp php=php arrayphp(php)php)
php php php php php{
php php php php php php php php ifphp php(countphp(php$optionsphp)php php=php=php php0php)php php{
php php php php php php php php php php php php returnphp selfphp:php:php$php_optionsphp;
php php php php php php php php php}
php php php php php php php php foreachphp php(php$optionsphp asphp php$namephp php=php>php php$valuephp)php php{
php php php php php php php php php php php php php$namephp php php=php strtolowerphp(php$namephp)php;
php php php php php php php php php php php php ifphp php(php$namephp php!php=php=php php'localephp'php)php php{
php php php php php php php php php php php php php php php php ifphp php(gettypephp(php$valuephp)php php=php=php=php php'stringphp'php)php php{
php php php php php php php php php php php php php php php php php php php php php$valuephp php=php strtolowerphp(php$valuephp)php;
php php php php php php php php php php php php php php php php php}
php php php php php php php php php php php php php}

php php php php php php php php php php php php switchphp(php$namephp)php php{
php php php php php php php php php php php php php php php php casephp php'numberphp_formatphp'php php:
php php php php php php php php php php php php php php php php php php php php ifphp php(php$valuephp php=php=php Zendphp_Localephp_Formatphp:php:STANDARDphp)php php{
php php php php php php php php php php php php php php php php php php php php php php php php php$localephp php=php selfphp:php:php$php_optionsphp[php'localephp'php]php;
php php php php php php php php php php php php php php php php php php php php php php php php ifphp php(issetphp(php$optionsphp[php'localephp'php]php)php)php php{
php php php php php php php php php php php php php php php php php php php php php php php php php php php php php$localephp php=php php$optionsphp[php'localephp'php]php;
php php php php php php php php php php php php php php php php php php php php php php php php php}
php php php php php php php php php php php php php php php php php php php php php php php php php$optionsphp[php'numberphp_formatphp'php]php php=php Zendphp_Localephp_Dataphp:php:getContentphp(php$localephp,php php'decimalnumberphp'php)php;
php php php php php php php php php php php php php php php php php php php php php}php elsephp ifphp php(php(gettypephp(php$valuephp)php php!php=php=php php'stringphp'php)php andphp php(php$valuephp php!php=php=php NULLphp)php)php php{
php php php php php php php php php php php php php php php php php php php php php php php php requirephp_oncephp php'Zendphp/Localephp/Exceptionphp.phpphp'php;
php php php php php php php php php php php php php php php php php php php php php php php php throwphp newphp Zendphp_Localephp_Exceptionphp(php"Unknownphp numberphp formatphp typephp php'php"php php.php gettypephp(php$valuephp)php php.php php"php'php.php php"
php php php php php php php php php php php php php php php php php php php php php php php php php php php php php.php php"Formatphp php'php$valuephp'php mustphp bephp aphp validphp numberphp formatphp stringphp.php"php)php;
php php php php php php php php php php php php php php php php php php php php php}
php php php php php php php php php php php php php php php php php php php php breakphp;

php php php php php php php php php php php php php php php php casephp php'datephp_formatphp'php php:
php php php php php php php php php php php php php php php php php php php php ifphp php(php$valuephp php=php=php Zendphp_Localephp_Formatphp:php:STANDARDphp)php php{
php php php php php php php php php php php php php php php php php php php php php php php php php$localephp php=php selfphp:php:php$php_optionsphp[php'localephp'php]php;
php php php php php php php php php php php php php php php php php php php php php php php php ifphp php(issetphp(php$optionsphp[php'localephp'php]php)php)php php{
php php php php php php php php php php php php php php php php php php php php php php php php php php php php php$localephp php=php php$optionsphp[php'localephp'php]php;
php php php php php php php php php php php php php php php php php php php php php php php php php}
php php php php php php php php php php php php php php php php php php php php php php php php php$optionsphp[php'datephp_formatphp'php]php php=php Zendphp_Localephp_Formatphp:php:getDateFormatphp(php$localephp)php;
php php php php php php php php php php php php php php php php php php php php php}php elsephp ifphp php(php(gettypephp(php$valuephp)php php!php=php=php php'stringphp'php)php andphp php(php$valuephp php!php=php=php NULLphp)php)php php{
php php php php php php php php php php php php php php php php php php php php php php php php requirephp_oncephp php'Zendphp/Localephp/Exceptionphp.phpphp'php;
php php php php php php php php php php php php php php php php php php php php php php php php throwphp newphp Zendphp_Localephp_Exceptionphp(php"Unknownphp dateformatphp typephp php'php"php php.php gettypephp(php$valuephp)php php.php php"php'php.php php"
php php php php php php php php php php php php php php php php php php php php php php php php php php php php php.php php"Formatphp php'php$valuephp'php mustphp bephp aphp validphp ISOphp orphp PHPphp datephp formatphp stringphp.php"php)php;
php php php php php php php php php php php php php php php php php php php php php}php elsephp php{
php php php php php php php php php php php php php php php php php php php php php php php php ifphp php(php(php(issetphp(php$optionsphp[php'formatphp_typephp'php]php)php php=php=php=php truephp)php andphp php(php$optionsphp[php'formatphp_typephp'php]php php=php=php php'phpphp'php)php)php or
php php php php php php php php php php php php php php php php php php php php php php php php php php php php php(php(issetphp(php$optionsphp[php'formatphp_typephp'php]php)php php=php=php=php falsephp)php andphp php(selfphp:php:php$php_optionsphp[php'formatphp_typephp'php]php php=php=php php'phpphp'php)php)php)php php{
php php php php php php php php php php php php php php php php php php php php php php php php php php php php php$optionsphp[php'datephp_formatphp'php]php php=php Zendphp_Localephp_Formatphp:php:convertPhpToIsoFormatphp(php$valuephp)php;
php php php php php php php php php php php php php php php php php php php php php php php php php}
php php php php php php php php php php php php php php php php php php php php php}
php php php php php php php php php php php php php php php php php php php php breakphp;

php php php php php php php php php php php php php php php php casephp php'formatphp_typephp'php php:
php php php php php php php php php php php php php php php php php php php php ifphp php(php(php$valuephp php!php=php php'phpphp'php)php php&php&php php(php$valuephp php!php=php php'isophp'php)php)php php{
php php php php php php php php php php php php php php php php php php php php php php php php requirephp_oncephp php'Zendphp/Localephp/Exceptionphp.phpphp'php;
php php php php php php php php php php php php php php php php php php php php php php php php throwphp newphp Zendphp_Localephp_Exceptionphp(php"Unknownphp datephp formatphp typephp php'php$valuephp'php.php Onlyphp php'isophp'php andphp php'phpphp'php"
php php php php php php php php php php php php php php php php php php php php php php php php php php php php.php php"php arephp supportedphp.php"php)php;
php php php php php php php php php php php php php php php php php php php php php}
php php php php php php php php php php php php php php php php php php php php breakphp;

php php php php php php php php php php php php php php php php casephp php'fixphp_datephp'php php:
php php php php php php php php php php php php php php php php php php php php ifphp php(php(php$valuephp php!php=php=php truephp)php php&php&php php(php$valuephp php!php=php=php falsephp)php)php php{
php php php php php php php php php php php php php php php php php php php php php php php php requirephp_oncephp php'Zendphp/Localephp/Exceptionphp.phpphp'php;
php php php php php php php php php php php php php php php php php php php php php php php php throwphp newphp Zendphp_Localephp_Exceptionphp(php"Enablingphp correctionphp ofphp datesphp mustphp bephp eitherphp truephp orphp falsephp"
php php php php php php php php php php php php php php php php php php php php php php php php php php php php php.php php"php(fixphp_datephp=php'php$valuephp'php)php.php"php)php;
php php php php php php php php php php php php php php php php php php php php php}
php php php php php php php php php php php php php php php php php php php php breakphp;

php php php php php php php php php php php php php php php php casephp php'localephp'php php:
php php php php php php php php php php php php php php php php php php php php php$optionsphp[php'localephp'php]php php=php Zendphp_Localephp:php:findLocalephp(php$valuephp)php;
php php php php php php php php php php php php php php php php php php php php breakphp;

php php php php php php php php php php php php php php php php casephp php'cachephp'php php:
php php php php php php php php php php php php php php php php php php php php ifphp php(php$valuephp instanceofphp Zendphp_Cachephp_Corephp)php php{
php php php php php php php php php php php php php php php php php php php php php php php php Zendphp_Localephp_Dataphp:php:setCachephp(php$valuephp)php;
php php php php php php php php php php php php php php php php php php php php php}
php php php php php php php php php php php php php php php php php php php php breakphp;

php php php php php php php php php php php php php php php php casephp php'disablecachephp'php php:
php php php php php php php php php php php php php php php php php php php php Zendphp_Localephp_Dataphp:php:disableCachephp(php$valuephp)php;
php php php php php php php php php php php php php php php php php php php php breakphp;

php php php php php php php php php php php php php php php php casephp php'precisionphp'php php:
php php php php php php php php php php php php php php php php php php php php ifphp php(php$valuephp php=php=php=php NULLphp)php php{
php php php php php php php php php php php php php php php php php php php php php php php php php$valuephp php=php php-php1php;
php php php php php php php php php php php php php php php php php php php php php}

php php php php php php php php php php php php php php php php php php php php ifphp php(php(php$valuephp <php php-php1php)php php|php|php php(php$valuephp php>php php3php0php)php)php php{
php php php php php php php php php php php php php php php php php php php php php php php php requirephp_oncephp php'Zendphp/Localephp/Exceptionphp.phpphp'php;
php php php php php php php php php php php php php php php php php php php php php php php php throwphp newphp Zendphp_Localephp_Exceptionphp(php"php'php$valuephp'php precisionphp isphp notphp aphp wholephp numberphp lessphp thanphp php3php0php.php"php)php;
php php php php php php php php php php php php php php php php php php php php php}
php php php php php php php php php php php php php php php php php php php php breakphp;

php php php php php php php php php php php php php php php php defaultphp:
php php php php php php php php php php php php php php php php php php php php requirephp_oncephp php'Zendphp/Localephp/Exceptionphp.phpphp'php;
php php php php php php php php php php php php php php php php php php php php throwphp newphp Zendphp_Localephp_Exceptionphp(php"Unknownphp optionphp:php php'php$namephp'php php=php php'php$valuephp'php"php)php;
php php php php php php php php php php php php php php php php php php php php breakphp;

php php php php php php php php php php php php php}
php php php php php php php php php}

php php php php php php php php returnphp php$optionsphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Changesphp thephp numbersphp/digitsphp withinphp aphp givenphp stringphp fromphp onephp scriptphp tophp another
php php php php php php*php php'Decimalphp'php representatedphp thephp stardardphp numbersphp php0php-php9php,php ifphp aphp scriptphp doesphp notphp exist
php php php php php php*php anphp exceptionphp willphp bephp thrownphp.
php php php php php php*
php php php php php php*php Examplesphp forphp conversionphp fromphp Arabicphp tophp Latinphp numeralsphp:
php php php php php php*php php php convertNumeralsphp(php'php١php١php٠php Testsphp'php,php php'Arabphp'php)php;php php-php>php returnsphp php'php1php0php0php Testsphp'
php php php php php php*php Examplephp forphp conversionphp fromphp Latinphp tophp Arabicphp numeralsphp:
php php php php php php*php php php convertNumeralsphp(php'php1php0php0php Testsphp'php,php php'Latnphp'php,php php'Arabphp'php)php;php php-php>php returnsphp php'php١php١php٠php Testsphp'
php php php php php php*
php php php php php php*php php@paramphp php stringphp php php$inputphp php Stringphp tophp convert
php php php php php php*php php@paramphp php stringphp php php$fromphp php php Scriptphp tophp parsephp,php seephp php{php@linkphp Zendphp_Localephp:php:getScriptListphp(php)php}php forphp detailsphp.
php php php php php php*php php@paramphp php stringphp php php$tophp php php php php OPTIONALphp Scriptphp tophp convertphp to
php php php php php php*php php@returnphp stringphp php Returnsphp thephp convertedphp input
php php php php php php*php php@throwsphp Zendphp_Localephp_Exception
php php php php php php*php/
php php php php publicphp staticphp functionphp convertNumeralsphp(php$inputphp,php php$fromphp,php php$tophp php=php nullphp)
php php php php php{
php php php php php php php php ifphp php(php!selfphp:php:php_getUniCodeSupportphp(php)php)php php{
php php php php php php php php php php php php triggerphp_errorphp(php"Sorryphp,php yourphp PCREphp extensionphp doesphp notphp supportphp UTFphp8php whichphp isphp neededphp forphp thephp Iphp1php8Nphp corephp"php,php Ephp_USERphp_NOTICEphp)php;
php php php php php php php php php}

php php php php php php php php php$fromphp php php php=php strtolowerphp(php$fromphp)php;
php php php php php php php php php$sourcephp php=php Zendphp_Localephp_Dataphp:php:getContentphp(php'enphp'php,php php'numberingsystemphp'php,php php$fromphp)php;
php php php php php php php php ifphp php(emptyphp(php$sourcephp)php)php php{
php php php php php php php php php php php php requirephp_oncephp php'Zendphp/Localephp/Exceptionphp.phpphp'php;
php php php php php php php php php php php php throwphp newphp Zendphp_Localephp_Exceptionphp(php"Unknownphp scriptphp php'php$fromphp'php.php Usephp php'Latnphp'php forphp digitsphp php0php,php1php,php2php,php3php,php4php,php5php,php6php,php7php,php8php,php9php.php"php)php;
php php php php php php php php php}

php php php php php php php php ifphp php(php$tophp php!php=php=php nullphp)php php{
php php php php php php php php php php php php php$tophp php php php php php=php strtolowerphp(php$tophp)php;
php php php php php php php php php php php php php$targetphp php=php Zendphp_Localephp_Dataphp:php:getContentphp(php'enphp'php,php php'numberingsystemphp'php,php php$tophp)php;
php php php php php php php php php php php php ifphp php(emptyphp(php$targetphp)php)php php{
php php php php php php php php php php php php php php php php requirephp_oncephp php'Zendphp/Localephp/Exceptionphp.phpphp'php;
php php php php php php php php php php php php php php php php throwphp newphp Zendphp_Localephp_Exceptionphp(php"Unknownphp scriptphp php'php$tophp'php.php Usephp php'Latnphp'php forphp digitsphp php0php,php1php,php2php,php3php,php4php,php5php,php6php,php7php,php8php,php9php.php"php)php;
php php php php php php php php php php php php php}
php php php php php php php php php}php elsephp php{
php php php php php php php php php php php php php$targetphp php=php php'php0php1php2php3php4php5php6php7php8php9php'php;
php php php php php php php php php}

php php php php php php php php forphp php(php$xphp php=php php0php;php php$xphp <php php1php0php;php php+php+php$xphp)php php{
php php php php php php php php php php php php php$asourcephp[php$xphp]php php=php php"php/php"php php.php iconvphp_substrphp(php$sourcephp,php php$xphp,php php1php,php php'UTFphp-php8php'php)php php.php php"php/uphp"php;
php php php php php php php php php php php php php$atargetphp[php$xphp]php php=php iconvphp_substrphp(php$targetphp,php php$xphp,php php1php,php php'UTFphp-php8php'php)php;
php php php php php php php php php}

php php php php php php php php returnphp pregphp_replacephp(php$asourcephp,php php$atargetphp,php php$inputphp)php;
php php php php php}

php php php php php/php*php*
php php php php php php*php Returnsphp thephp normalizedphp numberphp fromphp aphp localizedphp one
php php php php php php*php Parsingphp dependsphp onphp givenphp localephp php(groupingphp andphp decimalphp)
php php php php php php*
php php php php php php*php Examplesphp forphp inputphp:
php php php php php php*php php'php2php3php4php5php.php4php3php5php6php,php1php2php3php4php'php php=php php2php3php4php5php5php4php5php6php.php1php2php3php4
php php php php php php*php php'php+php2php3php,php3php4php5php2php.php1php2php3php'php php=php php2php3php3php4php5php2php.php1php2php3
php php php php php php*php php'php1php2php3php4php3php php'php php=php php1php2php3php4php3
php php php php php php*php php'php-php9php4php5php6php'php php=php php-php9php4php5php6
php php php php php php*php php'php0php'php php=php php0
php php php php php php*
php php php php php php*php php@paramphp php stringphp php$inputphp php php php Inputphp stringphp tophp parsephp forphp numbers
php php php php php php*php php@paramphp php arrayphp php php$optionsphp php Optionsphp:php localephp,php precisionphp.php Seephp php{php@linkphp setOptionsphp(php)php}php forphp detailsphp.
php php php php php php*php php@returnphp stringphp Returnsphp thephp extractedphp number
php php php php php php*php php@throwsphp Zendphp_Localephp_Exception
php php php php php php*php/
php php php php publicphp staticphp functionphp getNumberphp(php$inputphp,php arrayphp php$optionsphp php=php arrayphp(php)php)
php php php php php{
php php php php php php php php php$optionsphp php=php selfphp:php:php_checkOptionsphp(php$optionsphp)php php+php selfphp:php:php$php_optionsphp;
php php php php php php php php ifphp php(php!isphp_stringphp(php$inputphp)php)php php{
php php php php php php php php php php php php returnphp php$inputphp;
php php php php php php php php php}

php php php php php php php php ifphp php(php!selfphp:php:isNumberphp(php$inputphp,php php$optionsphp)php)php php{
php php php php php php php php php php php php requirephp_oncephp php'Zendphp/Localephp/Exceptionphp.phpphp'php;
php php php php php php php php php php php php throwphp newphp Zendphp_Localephp_Exceptionphp(php'Nophp localizedphp valuephp inphp php'php php.php php$inputphp php.php php'php foundphp,php orphp thephp givenphp numberphp doesphp notphp matchphp thephp localizedphp formatphp'php)php;
php php php php php php php php php}

php php php php php php php php php/php/php Getphp correctphp signsphp forphp thisphp locale
php php php php php php php php php$symbolsphp php=php Zendphp_Localephp_Dataphp:php:getListphp(php$optionsphp[php'localephp'php]php,php'symbolsphp'php)php;
php php php php php php php php php/php/php Changephp localephp inputphp tophp bephp defaultphp number
php php php php php php php php ifphp php(php(strposphp(php$inputphp,php php$symbolsphp[php'minusphp'php]php)php php!php=php=php falsephp)php php|php|
php php php php php php php php php php php php php(strposphp(php$inputphp,php php'php-php'php)php php!php=php=php falsephp)php)php php{
php php php php php php php php php php php php php$inputphp php=php strtrphp(php$inputphp,php arrayphp(php$symbolsphp[php'minusphp'php]php php=php>php php'php'php,php php'php-php'php php=php>php php'php'php)php)php;
php php php php php php php php php php php php php$inputphp php=php php'php-php'php php.php php$inputphp;
php php php php php php php php php}

php php php php php php php php php$inputphp php=php strphp_replacephp(php$symbolsphp[php'groupphp'php]php,php'php'php,php php$inputphp)php;
php php php php php php php php ifphp php(strposphp(php$inputphp,php php$symbolsphp[php'decimalphp'php]php)php php!php=php=php falsephp)php php{
php php php php php php php php php php php php ifphp php(php$symbolsphp[php'decimalphp'php]php php!php=php php'php.php'php)php php{
php php php php php php php php php php php php php php php php php$inputphp php=php strphp_replacephp(php$symbolsphp[php'decimalphp'php]php,php php"php.php"php,php php$inputphp)php;
php php php php php php php php php php php php php}

php php php php php php php php php php php php php$prephp php=php substrphp(php$inputphp,php strposphp(php$inputphp,php php'php.php'php)php php+php php1php)php;
php php php php php php php php php php php php ifphp php(php$optionsphp[php'precisionphp'php]php php=php=php=php nullphp)php php{
php php php php php php php php php php php php php php php php php$optionsphp[php'precisionphp'php]php php=php strlenphp(php$prephp)php;
php php php php php php php php php php php php php}

php php php php php php php php php php php php ifphp php(strlenphp(php$prephp)php php>php=php php$optionsphp[php'precisionphp'php]php)php php{
php php php php php php php php php php php php php php php php php$inputphp php=php substrphp(php$inputphp,php php0php,php strlenphp(php$inputphp)php php-php strlenphp(php$prephp)php php+php php$optionsphp[php'precisionphp'php]php)php;
php php php php php php php php php php php php php}

php php php php php php php php php php php php ifphp php(php(php$optionsphp[php'precisionphp'php]php php=php=php php0php)php php&php&php php(php$inputphp[strlenphp(php$inputphp)php php-php php1php]php php=php=php php'php.php'php)php)php php{
php php php php php php php php php php php php php php php php php$inputphp php=php substrphp(php$inputphp,php php0php,php php-php1php)php;
php php php php php php php php php php php php php}
php php php php php php php php php}

php php php php php php php php returnphp php$inputphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Returnsphp aphp localephp formattedphp numberphp dependingphp onphp thephp givenphp optionsphp.
php php php php php php*php Thephp seperationphp andphp fractionphp signphp isphp usedphp fromphp thephp setphp localephp.
php php php php php php*php php#php#php0php.php#php php php-php>php php1php2php3php4php5php.php1php2php3php4php5php php-php>php php1php2php3php4php5php.php1php2php3php4php5
php php php php php php*php php#php#php0php.php0php0php php-php>php php1php2php3php4php5php.php1php2php3php4php5php php-php>php php1php2php3php4php5php.php1php2
php php php php php php*php php#php#php,php#php#php0php.php0php0php php-php>php php1php2php3php4php5php.php1php2php3php4php5php php-php>php php1php2php,php3php4php5php.php1php2
php php php php php php*
php php php php php php*php php@paramphp php php stringphp php php$inputphp php php php Localizedphp numberphp string
php php php php php php*php php@paramphp php php arrayphp php php php$optionsphp php Optionsphp:php numberphp_formatphp,php localephp,php precisionphp.php Seephp php{php@linkphp setOptionsphp(php)php}php forphp detailsphp.
php php php php php php*php php@returnphp php stringphp php localephp formattedphp number
php php php php php php*php php@throwsphp Zendphp_Localephp_Exception
php php php php php php*php/
php php php php publicphp staticphp functionphp toNumberphp(php$valuephp,php arrayphp php$optionsphp php=php arrayphp(php)php)
php php php php php{
php php php php php php php php php/php/php loadphp classphp withinphp methodphp forphp speed
php php php php php php php php requirephp_oncephp php'Zendphp/Localephp/Mathphp.phpphp'php;

php php php php php php php php php$valuephp php php php php php php php php php php php php php=php Zendphp_Localephp_Mathphp:php:normalizephp(php$valuephp)php;
php php php php php php php php php$valuephp php php php php php php php php php php php php php=php Zendphp_Localephp_Mathphp:php:floatalizephp(php$valuephp)php;
php php php php php php php php php$optionsphp php php php php php php php php php php php=php selfphp:php:php_checkOptionsphp(php$optionsphp)php php+php selfphp:php:php$php_optionsphp;
php php php php php php php php php$optionsphp[php'localephp'php]php php=php php(stringphp)php php$optionsphp[php'localephp'php]php;

php php php php php php php php php/php/php Getphp correctphp signsphp forphp thisphp locale
php php php php php php php php php$symbolsphp php=php Zendphp_Localephp_Dataphp:php:getListphp(php$optionsphp[php'localephp'php]php,php php'symbolsphp'php)php;
php php php php php php php php php$oencphp php=php iconvphp_getphp_encodingphp(php'internalphp_encodingphp'php)php;
php php php php php php php php iconvphp_setphp_encodingphp(php'internalphp_encodingphp'php,php php'UTFphp-php8php'php)php;

php php php php php php php php php/php/php Getphp format
php php php php php php php php php$formatphp php=php php$optionsphp[php'numberphp_formatphp'php]php;
php php php php php php php php ifphp php(php$formatphp php=php=php=php nullphp)php php{
php php php php php php php php php php php php php$formatphp php php=php Zendphp_Localephp_Dataphp:php:getContentphp(php$optionsphp[php'localephp'php]php,php php'decimalnumberphp'php)php;
php php php php php php php php php php php php php$formatphp php php=php selfphp:php:php_seperateFormatphp(php$formatphp,php php$valuephp,php php$optionsphp[php'precisionphp'php]php)php;

php php php php php php php php php php php php ifphp php(php$optionsphp[php'precisionphp'php]php php!php=php=php nullphp)php php{
php php php php php php php php php php php php php php php php php$valuephp php php php=php Zendphp_Localephp_Mathphp:php:normalizephp(Zendphp_Localephp_Mathphp:php:roundphp(php$valuephp,php php$optionsphp[php'precisionphp'php]php)php)php;
php php php php php php php php php php php php php}
php php php php php php php php php}php elsephp php{
php php php php php php php php php php php php php/php/php seperatephp negativephp formatphp patternphp whenphp available
php php php php php php php php php php php php php$formatphp php php=php selfphp:php:php_seperateFormatphp(php$formatphp,php php$valuephp,php php$optionsphp[php'precisionphp'php]php)php;
php php php php php php php php php php php php ifphp php(strposphp(php$formatphp,php php'php.php'php)php)php php{
php php php php php php php php php php php php php php php php ifphp php(isphp_numericphp(php$optionsphp[php'precisionphp'php]php)php)php php{
php php php php php php php php php php php php php php php php php php php php php$valuephp php=php Zendphp_Localephp_Mathphp:php:roundphp(php$valuephp,php php$optionsphp[php'precisionphp'php]php)php;
php php php php php php php php php php php php php php php php php}php elsephp php{
php php php php php php php php php php php php php php php php php php php php ifphp php(substrphp(php$formatphp,php iconvphp_strposphp(php$formatphp,php php'php.php'php)php php+php php1php,php php3php)php php=php=php php'php#php#php#php'php)php php{
php php php php php php php php php php php php php php php php php php php php php php php php php$optionsphp[php'precisionphp'php]php php=php nullphp;
php php php php php php php php php php php php php php php php php php php php php}php elsephp php{
php php php php php php php php php php php php php php php php php php php php php php php php php$optionsphp[php'precisionphp'php]php php=php iconvphp_strlenphp(iconvphp_substrphp(php$formatphp,php iconvphp_strposphp(php$formatphp,php php'php.php'php)php php+php php1php,
php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php iconvphp_strrposphp(php$formatphp,php php'php0php'php)php php-php iconvphp_strposphp(php$formatphp,php php'php.php'php)php)php)php;
php php php php php php php php php php php php php php php php php php php php php php php php php$formatphp php=php iconvphp_substrphp(php$formatphp,php php0php,php iconvphp_strposphp(php$formatphp,php php'php.php'php)php php+php php1php)php php.php php'php#php#php#php'
php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php.php iconvphp_substrphp(php$formatphp,php iconvphp_strrposphp(php$formatphp,php php'php0php'php)php php+php php1php)php;
php php php php php php php php php php php php php php php php php php php php php}
php php php php php php php php php php php php php php php php php}
php php php php php php php php php php php php php}php elsephp php{
php php php php php php php php php php php php php php php php php$valuephp php=php Zendphp_Localephp_Mathphp:php:roundphp(php$valuephp,php php0php)php;
php php php php php php php php php php php php php php php php php$optionsphp[php'precisionphp'php]php php=php php0php;
php php php php php php php php php php php php php}
php php php php php php php php php php php php php$valuephp php=php Zendphp_Localephp_Mathphp:php:normalizephp(php$valuephp)php;
php php php php php php php php php}

php php php php php php php php ifphp php(iconvphp_strposphp(php$formatphp,php php'php0php'php)php php=php=php=php falsephp)php php{
php php php php php php php php php php php php iconvphp_setphp_encodingphp(php'internalphp_encodingphp'php,php php$oencphp)php;
php php php php php php php php php php php php requirephp_oncephp php'Zendphp/Localephp/Exceptionphp.phpphp'php;
php php php php php php php php php php php php throwphp newphp Zendphp_Localephp_Exceptionphp(php'Wrongphp formatphp.php.php.php missingphp php0php'php)php;
php php php php php php php php php}

php php php php php php php php php/php/php getphp numberphp parts
php php php php php php php php php$posphp php=php iconvphp_strposphp(php$valuephp,php php'php.php'php)php;
php php php php php php php php ifphp php(php$posphp php!php=php=php falsephp)php php{
php php php php php php php php php php php php ifphp php(php$optionsphp[php'precisionphp'php]php php=php=php=php nullphp)php php{
php php php php php php php php php php php php php php php php php$precstrphp php=php iconvphp_substrphp(php$valuephp,php php$posphp php+php php1php)php;
php php php php php php php php php php php php php}php elsephp php{
php php php php php php php php php php php php php php php php php$precstrphp php=php iconvphp_substrphp(php$valuephp,php php$posphp php+php php1php,php php$optionsphp[php'precisionphp'php]php)php;
php php php php php php php php php php php php php php php php ifphp php(iconvphp_strlenphp(php$precstrphp)php <php php$optionsphp[php'precisionphp'php]php)php php{
php php php php php php php php php php php php php php php php php php php php php$precstrphp php=php php$precstrphp php.php strphp_padphp(php"php0php"php,php php(php$optionsphp[php'precisionphp'php]php php-php iconvphp_strlenphp(php$precstrphp)php)php,php php"php0php"php)php;
php php php php php php php php php php php php php php php php php}
php php php php php php php php php php php php php}
php php php php php php php php php}php elsephp php{
php php php php php php php php php php php php ifphp php(php$optionsphp[php'precisionphp'php]php php>php php0php)php php{
php php php php php php php php php php php php php php php php php$precstrphp php=php strphp_padphp(php"php0php"php,php php(php$optionsphp[php'precisionphp'php]php)php,php php"php0php"php)php;
php php php php php php php php php php php php php}
php php php php php php php php php}

php php php php php php php php ifphp php(php$optionsphp[php'precisionphp'php]php php=php=php=php nullphp)php php{
php php php php php php php php php php php php ifphp php(issetphp(php$precstrphp)php)php php{
php php php php php php php php php php php php php php php php php$optionsphp[php'precisionphp'php]php php=php iconvphp_strlenphp(php$precstrphp)php;
php php php php php php php php php php php php php}php elsephp php{
php php php php php php php php php php php php php php php php php$optionsphp[php'precisionphp'php]php php=php php0php;
php php php php php php php php php php php php php}
php php php php php php php php php}

php php php php php php php php php/php/php getphp fractionphp andphp formatphp lengths
php php php php php php php php ifphp php(strposphp(php$valuephp,php php'php.php'php)php php!php=php=php falsephp)php php{
php php php php php php php php php php php php php$numberphp php=php substrphp(php(stringphp)php php$valuephp,php php0php,php strposphp(php$valuephp,php php'php.php'php)php)php;
php php php php php php php php php}php elsephp php{
php php php php php php php php php php php php php$numberphp php=php php$valuephp;
php php php php php php php php php}

php php php php php php php php php$precphp php=php callphp_userphp_funcphp(Zendphp_Localephp_Mathphp:php:php$subphp,php php$valuephp,php php$numberphp,php php$optionsphp[php'precisionphp'php]php)php;
php php php php php php php php php$precphp php=php Zendphp_Localephp_Mathphp:php:floatalizephp(php$precphp)php;
php php php php php php php php php$precphp php=php Zendphp_Localephp_Mathphp:php:normalizephp(php$precphp)php;
php php php php php php php php ifphp php(iconvphp_strposphp(php$precphp,php php'php-php'php)php php!php=php=php falsephp)php php{
php php php php php php php php php php php php php$precphp php=php iconvphp_substrphp(php$precphp,php php1php)php;
php php php php php php php php php}

php php php php php php php php ifphp php(php(php$precphp php=php=php php0php)php andphp php(php$optionsphp[php'precisionphp'php]php php>php php0php)php)php php{
php php php php php php php php php php php php php$precphp php=php php"php0php.php0php"php;
php php php php php php php php php}

php php php php php php php php ifphp php(php(php$optionsphp[php'precisionphp'php]php php+php php2php)php php>php iconvphp_strlenphp(php$precphp)php)php php{
php php php php php php php php php php php php php$precphp php=php strphp_padphp(php(stringphp)php php$precphp,php php$optionsphp[php'precisionphp'php]php php+php php2php,php php"php0php"php,php STRphp_PADphp_RIGHTphp)php;
php php php php php php php php php}

php php php php php php php php ifphp php(iconvphp_strposphp(php$numberphp,php php'php-php'php)php php!php=php=php falsephp)php php{
php php php php php php php php php php php php php$numberphp php=php iconvphp_substrphp(php$numberphp,php php1php)php;
php php php php php php php php php}
php php php php php php php php php$groupphp php php=php iconvphp_strrposphp(php$formatphp,php php'php,php'php)php;
php php php php php php php php php$groupphp2php php=php iconvphp_strposphp php(php$formatphp,php php'php,php'php)php;
php php php php php php php php php$pointphp php php=php iconvphp_strposphp php(php$formatphp,php php'php0php'php)php;
php php php php php php php php php/php/php Addphp fraction
php php php php php php php php php$restphp php=php php"php"php;
php php php php php php php php ifphp php(iconvphp_strposphp(php$formatphp,php php'php.php'php)php)php php{
php php php php php php php php php php php php php$restphp php php php=php iconvphp_substrphp(php$formatphp,php iconvphp_strposphp(php$formatphp,php php'php.php'php)php php+php php1php)php;
php php php php php php php php php php php php php$lengthphp php=php iconvphp_strlenphp(php$restphp)php;
php php php php php php php php php php php php forphp(php$xphp php=php php0php;php php$xphp <php php$lengthphp;php php+php+php$xphp)php php{
php php php php php php php php php php php php php php php php ifphp php(php(php$restphp[php0php]php php=php=php php'php0php'php)php php|php|php php(php$restphp[php0php]php php=php=php php'php#php'php)php)php php{
php php php php php php php php php php php php php php php php php php php php php$restphp php=php iconvphp_substrphp(php$restphp,php php1php)php;
php php php php php php php php php php php php php php php php php}
php php php php php php php php php php php php php}
php php php php php php php php php php php php php$formatphp php=php iconvphp_substrphp(php$formatphp,php php0php,php iconvphp_strlenphp(php$formatphp)php php-php iconvphp_strlenphp(php$restphp)php)php;
php php php php php php php php php}

php php php php php php php php ifphp php(php$optionsphp[php'precisionphp'php]php php=php=php php'php0php'php)php php{
php php php php php php php php php php php php ifphp php(iconvphp_strrposphp(php$formatphp,php php'php-php'php)php php!php=php php0php)php php{
php php php php php php php php php php php php php php php php php$formatphp php=php iconvphp_substrphp(php$formatphp,php php0php,php php$pointphp)
php php php php php php php php php php php php php php php php php php php php php php php php php.php iconvphp_substrphp(php$formatphp,php iconvphp_strrposphp(php$formatphp,php php'php#php'php)php php+php php2php)php;
php php php php php php php php php php php php php}php elsephp php{
php php php php php php php php php php php php php php php php php$formatphp php=php iconvphp_substrphp(php$formatphp,php php0php,php php$pointphp)php;
php php php php php php php php php php php php php}
php php php php php php php php php}php elsephp php{
php php php php php php php php php php php php php$formatphp php=php iconvphp_substrphp(php$formatphp,php php0php,php php$pointphp)php php.php php$symbolsphp[php'decimalphp'php]
php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php.php iconvphp_substrphp(php$precphp,php php2php)php;
php php php php php php php php php}

php php php php php php php php php$formatphp php.php=php php$restphp;
php php php php php php php php php/php/php Addphp seperation
php php php php php php php php ifphp php(php$groupphp php=php=php php0php)php php{
php php php php php php php php php php php php php/php/php nophp seperation
php php php php php php php php php php php php php$formatphp php=php php$numberphp php.php iconvphp_substrphp(php$formatphp,php php$pointphp)php;
php php php php php php php php php}php elsephp ifphp php(php$groupphp php=php=php php$groupphp2php)php php{
php php php php php php php php php php php php php/php/php onlyphp php1php seperation
php php php php php php php php php php php php php$seperationphp php=php php(php$pointphp php-php php$groupphp)php;
php php php php php php php php php php php php forphp php(php$xphp php=php iconvphp_strlenphp(php$numberphp)php;php php$xphp php>php php$seperationphp;php php$xphp php-php=php php$seperationphp)php php{
php php php php php php php php php php php php php php php php ifphp php(iconvphp_substrphp(php$numberphp,php php0php,php php$xphp php-php php$seperationphp)php php!php=php=php php"php"php)php php{
php php php php php php php php php php php php php php php php php php php php php$numberphp php=php iconvphp_substrphp(php$numberphp,php php0php,php php$xphp php-php php$seperationphp)php php.php php$symbolsphp[php'groupphp'php]
php php php php php php php php php php php php php php php php php php php php php php php php php php php php php.php iconvphp_substrphp(php$numberphp,php php$xphp php-php php$seperationphp)php;
php php php php php php php php php php php php php php php php php}
php php php php php php php php php php php php php}
php php php php php php php php php php php php php$formatphp php=php iconvphp_substrphp(php$formatphp,php php0php,php iconvphp_strposphp(php$formatphp,php php'php#php'php)php)php php.php php$numberphp php.php iconvphp_substrphp(php$formatphp,php php$pointphp)php;
php php php php php php php php php}php elsephp php{

php php php php php php php php php php php php php/php/php php2php seperations
php php php php php php php php php php php php ifphp php(iconvphp_strlenphp(php$numberphp)php php>php php(php$pointphp php-php php$groupphp)php)php php{
php php php php php php php php php php php php php php php php php$seperationphp php=php php(php$pointphp php-php php$groupphp)php;
php php php php php php php php php php php php php php php php php$numberphp php=php iconvphp_substrphp(php$numberphp,php php0php,php iconvphp_strlenphp(php$numberphp)php php-php php$seperationphp)php php.php php$symbolsphp[php'groupphp'php]
php php php php php php php php php php php php php php php php php php php php php php php php php.php iconvphp_substrphp(php$numberphp,php iconvphp_strlenphp(php$numberphp)php php-php php$seperationphp)php;

php php php php php php php php php php php php php php php php ifphp php(php(iconvphp_strlenphp(php$numberphp)php php-php php1php)php php>php php(php$pointphp php-php php$groupphp php+php php1php)php)php php{
php php php php php php php php php php php php php php php php php php php php php$seperationphp2php php=php php(php$groupphp php-php php$groupphp2php php-php php1php)php;
php php php php php php php php php php php php php php php php php php php php forphp php(php$xphp php=php iconvphp_strlenphp(php$numberphp)php php-php php$seperationphp2php php-php php2php;php php$xphp php>php php$seperationphp2php;php php$xphp php-php=php php$seperationphp2php)php php{
php php php php php php php php php php php php php php php php php php php php php php php php php$numberphp php=php iconvphp_substrphp(php$numberphp,php php0php,php php$xphp php-php php$seperationphp2php)php php.php php$symbolsphp[php'groupphp'php]
php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php.php iconvphp_substrphp(php$numberphp,php php$xphp php-php php$seperationphp2php)php;
php php php php php php php php php php php php php php php php php php php php php}
php php php php php php php php php php php php php php php php php}

php php php php php php php php php php php php php}
php php php php php php php php php php php php php$formatphp php=php iconvphp_substrphp(php$formatphp,php php0php,php iconvphp_strposphp(php$formatphp,php php'php#php'php)php)php php.php php$numberphp php.php iconvphp_substrphp(php$formatphp,php php$pointphp)php;
php php php php php php php php php}
php php php php php php php php php/php/php setphp negativephp sign
php php php php php php php php ifphp php(callphp_userphp_funcphp(Zendphp_Localephp_Mathphp:php:php$compphp,php php$valuephp,php php0php,php php$optionsphp[php'precisionphp'php]php)php <php php0php)php php{
php php php php php php php php php php php php ifphp php(iconvphp_strposphp(php$formatphp,php php'php-php'php)php php=php=php=php falsephp)php php{
php php php php php php php php php php php php php php php php php$formatphp php=php php$symbolsphp[php'minusphp'php]php php.php php$formatphp;
php php php php php php php php php php php php php}php elsephp php{
php php php php php php php php php php php php php php php php php$formatphp php=php strphp_replacephp(php'php-php'php,php php$symbolsphp[php'minusphp'php]php,php php$formatphp)php;
php php php php php php php php php php php php php}
php php php php php php php php php}

php php php php php php php php iconvphp_setphp_encodingphp(php'internalphp_encodingphp'php,php php$oencphp)php;
php php php php php php php php returnphp php(stringphp)php php$formatphp;
php php php php php}

php php php php privatephp staticphp functionphp php_seperateFormatphp(php$formatphp,php php$valuephp,php php$precisionphp)
php php php php php{
php php php php php php php php ifphp php(iconvphp_strposphp(php$formatphp,php php'php;php'php)php php!php=php=php falsephp)php php{
php php php php php php php php php php php php ifphp php(callphp_userphp_funcphp(Zendphp_Localephp_Mathphp:php:php$compphp,php php$valuephp,php php0php,php php$precisionphp)php <php php0php)php php{
php php php php php php php php php php php php php php php php php$tmpformatphp php=php iconvphp_substrphp(php$formatphp,php iconvphp_strposphp(php$formatphp,php php'php;php'php)php php+php php1php)php;
php php php php php php php php php php php php php php php php ifphp php(php$tmpformatphp[php0php]php php=php=php php'php(php'php)php php{
php php php php php php php php php php php php php php php php php php php php php$formatphp php=php iconvphp_substrphp(php$formatphp,php php0php,php iconvphp_strposphp(php$formatphp,php php'php;php'php)php)php;
php php php php php php php php php php php php php php php php php}php elsephp php{
php php php php php php php php php php php php php php php php php php php php php$formatphp php=php php$tmpformatphp;
php php php php php php php php php php php php php php php php php}
php php php php php php php php php php php php php}php elsephp php{
php php php php php php php php php php php php php php php php php$formatphp php=php iconvphp_substrphp(php$formatphp,php php0php,php iconvphp_strposphp(php$formatphp,php php'php;php'php)php)php;
php php php php php php php php php php php php php}
php php php php php php php php php}

php php php php php php php php returnphp php$formatphp;
php php php php php}


php php php php php/php*php*
php php php php php php*php Checksphp ifphp thephp inputphp containsphp aphp normalizedphp orphp localizedphp number
php php php php php php*
php php php php php php*php php@paramphp php php stringphp php php$inputphp php php php Localizedphp numberphp string
php php php php php php*php php@paramphp php php arrayphp php php php$optionsphp php Optionsphp:php localephp.php Seephp php{php@linkphp setOptionsphp(php)php}php forphp detailsphp.
php php php php php php*php php@returnphp php booleanphp php php php php php php php php php php Returnsphp truephp ifphp aphp numberphp wasphp found
php php php php php php*php/
php php php php publicphp staticphp functionphp isNumberphp(php$inputphp,php arrayphp php$optionsphp php=php arrayphp(php)php)
php php php php php{
php php php php php php php php ifphp php(php!selfphp:php:php_getUniCodeSupportphp(php)php)php php{
php php php php php php php php php php php php triggerphp_errorphp(php"Sorryphp,php yourphp PCREphp extensionphp doesphp notphp supportphp UTFphp8php whichphp isphp neededphp forphp thephp Iphp1php8Nphp corephp"php,php Ephp_USERphp_NOTICEphp)php;
php php php php php php php php php}

php php php php php php php php php$optionsphp php=php selfphp:php:php_checkOptionsphp(php$optionsphp)php php+php selfphp:php:php$php_optionsphp;

php php php php php php php php php/php/php Getphp correctphp signsphp forphp thisphp locale
php php php php php php php php php$symbolsphp php=php Zendphp_Localephp_Dataphp:php:getListphp(php$optionsphp[php'localephp'php]php,php'symbolsphp'php)php;

php php php php php php php php php$regexsphp php=php Zendphp_Localephp_Formatphp:php:php_getRegexForTypephp(php'decimalnumberphp'php,php php$optionsphp)php;
php php php php php php php php php$regexsphp php=php arrayphp_mergephp(php$regexsphp,php Zendphp_Localephp_Formatphp:php:php_getRegexForTypephp(php'scientificnumberphp'php,php php$optionsphp)php)php;
php php php php php php php php ifphp php(php!emptyphp(php$inputphp)php php&php&php php(php$inputphp[php0php]php php=php=php php$symbolsphp[php'decimalphp'php]php)php)php php{
php php php php php php php php php php php php php$inputphp php=php php0php php.php php$inputphp;
php php php php php php php php php}
php php php php php php php php foreachphp php(php$regexsphp asphp php$regexphp)php php{
php php php php php php php php php php php php pregphp_matchphp(php$regexphp,php php$inputphp,php php$foundphp)php;
php php php php php php php php php php php php ifphp php(issetphp(php$foundphp[php0php]php)php)php php{
php php php php php php php php php php php php php php php php returnphp truephp;
php php php php php php php php php php php php php}
php php php php php php php php php}

php php php php php php php php returnphp falsephp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Internalphp methodphp tophp convertphp cldrphp numberphp syntaxphp intophp regex
php php php php php php*
php php php php php php*php php@paramphp php stringphp php$type
php php php php php php*php php@returnphp string
php php php php php php*php/
php php php php privatephp staticphp functionphp php_getRegexForTypephp(php$typephp,php php$optionsphp)
php php php php php{
php php php php php php php php php$decimalphp php php=php Zendphp_Localephp_Dataphp:php:getContentphp(php$optionsphp[php'localephp'php]php,php php$typephp)php;
php php php php php php php php php$decimalphp php php=php pregphp_replacephp(php'php/php[php^php#php0php,php;php\php.php\php-Eephp]php/uphp'php,php php'php'php,php$decimalphp)php;
php php php php php php php php php$patternsphp php=php explodephp(php'php;php'php,php php$decimalphp)php;

php php php php php php php php ifphp php(countphp(php$patternsphp)php php=php=php php1php)php php{
php php php php php php php php php php php php php$patternsphp[php1php]php php=php php'php-php'php php.php php$patternsphp[php0php]php;
php php php php php php php php php}

php php php php php php php php php$symbolsphp php=php Zendphp_Localephp_Dataphp:php:getListphp(php$optionsphp[php'localephp'php]php,php'symbolsphp'php)php;

php php php php php php php php foreachphp(php$patternsphp asphp php$pkeyphp php=php>php php$patternphp)php php{
php php php php php php php php php php php php php$regexphp[php$pkeyphp]php php php=php php'php/php^php'php;
php php php php php php php php php php php php php$restphp php php php=php php0php;
php php php php php php php php php php php php php$endphp php php php php=php nullphp;
php php php php php php php php php php php php ifphp php(strposphp(php$patternphp,php php'php.php'php)php php!php=php=php falsephp)php php{
php php php php php php php php php php php php php php php php php$endphp php php php php php=php substrphp(php$patternphp,php strposphp(php$patternphp,php php'php.php'php)php php+php php1php)php;
php php php php php php php php php php php php php php php php php$patternphp php=php substrphp(php$patternphp,php php0php,php php-strlenphp(php$endphp)php php-php php1php)php;
php php php php php php php php php php php php php}

php php php php php php php php php php php php ifphp php(strposphp(php$patternphp,php php'php,php'php)php php!php=php=php falsephp)php php{
php php php php php php php php php php php php php php php php php$partsphp php=php explodephp(php'php,php'php,php php$patternphp)php;
php php php php php php php php php php php php php php php php php$countphp php=php countphp(php$partsphp)php;
php php php php php php php php php php php php php php php php foreachphp(php$partsphp asphp php$keyphp php=php>php php$partphp)php php{
php php php php php php php php php php php php php php php php php php php php switchphp php(php$partphp)php php{
php php php php php php php php php php php php php php php php php php php php php php php php casephp php'php#php'php:
php php php php php php php php php php php php php php php php php php php php php php php php casephp php'php-php#php'php:
php php php php php php php php php php php php php php php php php php php php php php php php php php php php ifphp php(php$partphp[php0php]php php=php=php php'php-php'php)php php{
php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php$regexphp[php$pkeyphp]php php.php=php php'php[php'php php.php php$symbolsphp[php'minusphp'php]php php.php php'php-php]php{php0php,php1php}php'php;
php php php php php php php php php php php php php php php php php php php php php php php php php php php php php}php elsephp php{
php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php$regexphp[php$pkeyphp]php php.php=php php'php[php'php php.php php$symbolsphp[php'plusphp'php]php php.php php'php+php]php{php0php,php1php}php'php;
php php php php php php php php php php php php php php php php php php php php php php php php php php php php php}

php php php php php php php php php php php php php php php php php php php php php php php php php php php php ifphp php(php(php$partsphp[php$keyphp php+php php1php]php)php php=php=php php'php#php#php0php'php)php php php{
php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php$regexphp[php$pkeyphp]php php.php=php php'php[php0php-php9php]php{php1php,php3php}php'php;
php php php php php php php php php php php php php php php php php php php php php php php php php php php php php}php elsephp ifphp php(php(php$partsphp[php$keyphp php+php php1php]php)php php=php=php php'php#php#php'php)php php{
php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php$regexphp[php$pkeyphp]php php.php=php php'php[php0php-php9php]php{php1php,php2php}php'php;
php php php php php php php php php php php php php php php php php php php php php php php php php php php php php}php elsephp php{
php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php throwphp newphp Zendphp_Localephp_Exceptionphp(php'Unsupportedphp tokenphp forphp numberformatphp php(Posphp php1php)php:php"php'php php.php php$patternphp php.php php'php"php'php)php;
php php php php php php php php php php php php php php php php php php php php php php php php php php php php php}
php php php php php php php php php php php php php php php php php php php php php php php php php php php php breakphp;
php php php php php php php php php php php php php php php php php php php php php php php php casephp php'php#php#php'php:
php php php php php php php php php php php php php php php php php php php php php php php php php php php php ifphp php(php$partsphp[php$keyphp php+php php1php]php php=php=php php'php#php#php0php'php)php php{
php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php$regexphp[php$pkeyphp]php php.php=php php php'php(php\php\php'php php.php php$symbolsphp[php'groupphp'php]php php.php php'php{php0php,php1php}php[php0php-php9php]php{php2php}php)php*php'php;
php php php php php php php php php php php php php php php php php php php php php php php php php php php php php}php elsephp php{
php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php throwphp newphp Zendphp_Localephp_Exceptionphp(php'Unsupportedphp tokenphp forphp numberformatphp php(Posphp php2php)php:php"php'php php.php php$patternphp php.php php'php"php'php)php;
php php php php php php php php php php php php php php php php php php php php php php php php php php php php php}
php php php php php php php php php php php php php php php php php php php php php php php php php php php php breakphp;
php php php php php php php php php php php php php php php php php php php php php php php php casephp php'php#php#php0php'php:
php php php php php php php php php php php php php php php php php php php php php php php php php php php php ifphp php(php$partsphp[php$keyphp php-php php1php]php php=php=php php'php#php#php'php)php php{
php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php$regexphp[php$pkeyphp]php php.php=php php'php[php0php-php9php]php'php;
php php php php php php php php php php php php php php php php php php php php php php php php php php php php php}php elsephp ifphp php(php(php$partsphp[php$keyphp php-php php1php]php php=php=php php'php#php'php)php php|php|php php(php$partsphp[php$keyphp php-php php1php]php php=php=php php'php-php#php'php)php)php php{
php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php$regexphp[php$pkeyphp]php php.php=php php'php(php\php\php'php php.php php$symbolsphp[php'groupphp'php]php php.php php'php{php0php,php1php}php[php0php-php9php]php{php3php}php)php*php'php;
php php php php php php php php php php php php php php php php php php php php php php php php php php php php php}php elsephp php{
php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php throwphp newphp Zendphp_Localephp_Exceptionphp(php'Unsupportedphp tokenphp forphp numberformatphp php(Posphp php3php)php:php"php'php php.php php$patternphp php.php php'php"php'php)php;
php php php php php php php php php php php php php php php php php php php php php php php php php php php php php}
php php php php php php php php php php php php php php php php php php php php php php php php php php php php breakphp;
php php php php php php php php php php php php php php php php php php php php php php php php casephp php'php#php0php'php:
php php php php php php php php php php php php php php php php php php php php php php php php php php php php ifphp php(php$keyphp php=php=php php0php)php php{
php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php$regexphp[php$pkeyphp]php php.php=php php'php[php0php-php9php]php*php'php;
php php php php php php php php php php php php php php php php php php php php php php php php php php php php php}php elsephp php{
php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php throwphp newphp Zendphp_Localephp_Exceptionphp(php'Unsupportedphp tokenphp forphp numberformatphp php(Posphp php4php)php:php"php'php php.php php$patternphp php.php php'php"php'php)php;
php php php php php php php php php php php php php php php php php php php php php php php php php php php php php}
php php php php php php php php php php php php php php php php php php php php php php php php php php php php breakphp;
php php php php php php php php php php php php php php php php php php php php php}
php php php php php php php php php php php php php php php php php}
php php php php php php php php php php php php php}

php php php php php php php php php php php php ifphp php(strposphp(php$patternphp,php php'Ephp'php)php php!php=php=php falsephp)php php{
php php php php php php php php php php php php php php php php ifphp php(php(php$patternphp php=php=php php'php#Ephp0php'php)php php|php|php php(php$patternphp php=php=php php'php#Ephp0php0php'php)php)php php{
php php php php php php php php php php php php php php php php php php php php php$regexphp[php$pkeyphp]php php.php=php php'php[php'php php.php php$symbolsphp[php'plusphp'php]php.php php'php+php]php{php0php,php1php}php[php0php-php9php]php{php1php,php}php(php\php\php'php php.php php$symbolsphp[php'decimalphp'php]php php.php php'php[php0php-php9php]php{php1php,php}php)php*php[eEphp]php[php'php php.php php$symbolsphp[php'plusphp'php]php.php php'php+php]php{php0php,php1php}php[php0php-php9php]php{php1php,php}php'php;
php php php php php php php php php php php php php php php php php}php elsephp ifphp php(php(php$patternphp php=php=php php'php-php#Ephp0php'php)php php|php|php php(php$patternphp php=php=php php'php-php#Ephp0php0php'php)php)php php{
php php php php php php php php php php php php php php php php php php php php php$regexphp[php$pkeyphp]php php.php=php php'php[php'php php.php php$symbolsphp[php'minusphp'php]php.php php'php-php]php{php0php,php1php}php[php0php-php9php]php{php1php,php}php(php\php\php'php php.php php$symbolsphp[php'decimalphp'php]php php.php php'php[php0php-php9php]php{php1php,php}php)php*php[eEphp]php[php'php php.php php$symbolsphp[php'minusphp'php]php.php php'php-php]php{php0php,php1php}php[php0php-php9php]php{php1php,php}php'php;
php php php php php php php php php php php php php php php php php}php elsephp php{
php php php php php php php php php php php php php php php php php php php php throwphp newphp Zendphp_Localephp_Exceptionphp(php'Unsupportedphp tokenphp forphp numberformatphp php(Posphp php5php)php:php"php'php php.php php$patternphp php.php php'php"php'php)php;
php php php php php php php php php php php php php php php php php}
php php php php php php php php php php php php php}

php php php php php php php php php php php php ifphp php(php!emptyphp(php$endphp)php)php php{
php php php php php php php php php php php php php php php php ifphp php(php$endphp php=php=php php'php#php#php#php'php)php php{
php php php php php php php php php php php php php php php php php php php php php$regexphp[php$pkeyphp]php php.php=php php'php(php\php\php'php php.php php$symbolsphp[php'decimalphp'php]php php.php php'php{php1php}php[php0php-php9php]php{php1php,php}php)php{php0php,php1php}php'php;
php php php php php php php php php php php php php php php php php}php elsephp ifphp php(php$endphp php=php=php php'php#php#php#php-php'php)php php{
php php php php php php php php php php php php php php php php php php php php php$regexphp[php$pkeyphp]php php.php=php php'php(php\php\php'php php.php php$symbolsphp[php'decimalphp'php]php php.php php'php{php1php}php[php0php-php9php]php{php1php,php}php)php{php0php,php1php}php[php'php php.php php$symbolsphp[php'minusphp'php]php.php php'php-php]php'php;
php php php php php php php php php php php php php php php php php}php elsephp php{
php php php php php php php php php php php php php php php php php php php php throwphp newphp Zendphp_Localephp_Exceptionphp(php'Unsupportedphp tokenphp forphp numberformatphp php(Posphp php6php)php:php"php'php php.php php$patternphp php.php php'php"php'php)php;
php php php php php php php php php php php php php php php php php}
php php php php php php php php php php php php php}

php php php php php php php php php php php php php$regexphp[php$pkeyphp]php php.php=php php'php$php/uphp'php;
php php php php php php php php php}

php php php php php php php php returnphp php$regexphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Aliasphp forphp getNumber
php php php php php php*
php php php php php php*php php@paramphp php php stringphp php php$valuephp php php php Numberphp tophp localize
php php php php php php*php php@paramphp php php arrayphp php php php$optionsphp php Optionsphp:php localephp,php precisionphp.php Seephp php{php@linkphp setOptionsphp(php)php}php forphp detailsphp.
php php php php php php*php php@returnphp php float
php php php php php php*php/
php php php php publicphp staticphp functionphp getFloatphp(php$inputphp,php arrayphp php$optionsphp php=php arrayphp(php)php)
php php php php php{
php php php php php php php php returnphp floatvalphp(selfphp:php:getNumberphp(php$inputphp,php php$optionsphp)php)php;
php php php php php}

php php php php php/php*php*
php php php php php php*php Returnsphp aphp localephp formattedphp integerphp number
php php php php php php*php Aliasphp forphp toNumberphp(php)
php php php php php php*
php php php php php php*php php@paramphp php php stringphp php php$valuephp php php php Numberphp tophp normalize
php php php php php php*php php@paramphp php php arrayphp php php php$optionsphp php Optionsphp:php localephp,php precisionphp.php Seephp php{php@linkphp setOptionsphp(php)php}php forphp detailsphp.
php php php php php php*php php@returnphp php stringphp php Localephp formattedphp number
php php php php php php*php/
php php php php publicphp staticphp functionphp toFloatphp(php$valuephp,php arrayphp php$optionsphp php=php arrayphp(php)php)
php php php php php{
php php php php php php php php php$optionsphp[php'numberphp_formatphp'php]php php=php Zendphp_Localephp_Formatphp:php:STANDARDphp;
php php php php php php php php returnphp selfphp:php:toNumberphp(php$valuephp,php php$optionsphp)php;
php php php php php}

php php php php php/php*php*
php php php php php php*php Returnsphp ifphp aphp floatphp wasphp found
php php php php php php*php Aliasphp forphp isNumberphp(php)
php php php php php php*
php php php php php php*php php@paramphp php php stringphp php php$inputphp php php php Localizedphp numberphp string
php php php php php php*php php@paramphp php php arrayphp php php php$optionsphp php Optionsphp:php localephp.php Seephp php{php@linkphp setOptionsphp(php)php}php forphp detailsphp.
php php php php php php*php php@returnphp php booleanphp php php php php php php php php php php Returnsphp truephp ifphp aphp numberphp wasphp found
php php php php php php*php/
php php php php publicphp staticphp functionphp isFloatphp(php$valuephp,php arrayphp php$optionsphp php=php arrayphp(php)php)
php php php php php{
php php php php php php php php returnphp selfphp:php:isNumberphp(php$valuephp,php php$optionsphp)php;
php php php php php}

php php php php php/php*php*
php php php php php php*php Returnsphp thephp firstphp foundphp integerphp fromphp anphp string
php php php php php php*php Parsingphp dependsphp onphp givenphp localephp php(groupingphp andphp decimalphp)
php php php php php php*
php php php php php php*php Examplesphp forphp inputphp:
php php php php php php*php php'php php php2php3php4php5php.php4php3php5php6php,php1php2php3php4php'php php=php php2php3php4php5php5php4php5php6
php php php php php php*php php'php+php2php3php,php3php4php5php2php.php1php2php3php'php php=php php2php3php3php4php5php2
php php php php php php*php php'php php1php2php3php4php3php php'php php=php php1php2php3php4php3
php php php php php php*php php'php-php9php4php5php6kmphp'php php=php php-php9php4php5php6
php php php php php php*php php'php0php'php php=php php0
php php php php php php*php php'php(php-php)php{php0php,php1php}php(php\dphp+php(php\php.php)php{php0php,php1php}php)php*php(php\php,php)php{php0php,php1php}php)php\dphp+php'
php php php php php php*
php php php php php php*php php@paramphp php php stringphp php php php$inputphp php php php Inputphp stringphp tophp parsephp forphp numbers
php php php php php php*php php@paramphp php php arrayphp php php php php$optionsphp php Optionsphp:php localephp.php Seephp php{php@linkphp setOptionsphp(php)php}php forphp detailsphp.
php php php php php php*php php@returnphp php integerphp php php php php php php php php php php php Returnsphp thephp extractedphp number
php php php php php php*php/
php php php php publicphp staticphp functionphp getIntegerphp(php$inputphp,php arrayphp php$optionsphp php=php arrayphp(php)php)
php php php php php{
php php php php php php php php php$optionsphp[php'precisionphp'php]php php=php php0php;
php php php php php php php php returnphp intvalphp(selfphp:php:getFloatphp(php$inputphp,php php$optionsphp)php)php;
php php php php php}

php php php php php/php*php*
php php php php php php*php Returnsphp aphp localizedphp number
php php php php php php*
php php php php php php*php php@paramphp php php stringphp php php$valuephp php php php Numberphp tophp normalize
php php php php php php*php php@paramphp php php arrayphp php php php$optionsphp php Optionsphp:php localephp.php Seephp php{php@linkphp setOptionsphp(php)php}php forphp detailsphp.
php php php php php php*php php@returnphp php stringphp php php php php php php php php php php php Localephp formattedphp number
php php php php php php*php/
php php php php publicphp staticphp functionphp toIntegerphp(php$valuephp,php arrayphp php$optionsphp php=php arrayphp(php)php)
php php php php php{
php php php php php php php php php$optionsphp[php'precisionphp'php]php php=php php0php;
php php php php php php php php php$optionsphp[php'numberphp_formatphp'php]php php=php Zendphp_Localephp_Formatphp:php:STANDARDphp;
php php php php php php php php returnphp selfphp:php:toNumberphp(php$valuephp,php php$optionsphp)php;
php php php php php}

php php php php php/php*php*
php php php php php php*php Returnsphp ifphp aphp integerphp wasphp found
php php php php php php*
php php php php php php*php php@paramphp php php stringphp php php$inputphp php php php Localizedphp numberphp string
php php php php php php*php php@paramphp php php arrayphp php php php$optionsphp php Optionsphp:php localephp.php Seephp php{php@linkphp setOptionsphp(php)php}php forphp detailsphp.
php php php php php php*php php@returnphp php booleanphp php php php php php php php php php php Returnsphp truephp ifphp aphp integerphp wasphp found
php php php php php php*php/
php php php php publicphp staticphp functionphp isIntegerphp(php$valuephp,php arrayphp php$optionsphp php=php arrayphp(php)php)
php php php php php{
php php php php php php php php ifphp php(php!selfphp:php:isNumberphp(php$valuephp,php php$optionsphp)php)php php{
php php php php php php php php php php php php returnphp falsephp;
php php php php php php php php php}

php php php php php php php php ifphp php(selfphp:php:getIntegerphp(php$valuephp,php php$optionsphp)php php=php=php selfphp:php:getFloatphp(php$valuephp,php php$optionsphp)php)php php{
php php php php php php php php php php php php returnphp truephp;
php php php php php php php php php}

php php php php php php php php returnphp falsephp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Convertsphp aphp formatphp stringphp fromphp PHPphp'sphp datephp formatphp tophp ISOphp format
php php php php php php*php Rememberphp thatphp Zendphp Datephp alwaysphp returnsphp localizedphp stringphp,php sophp aphp monthphp namephp whichphp returnsphp thephp english
php php php php php php*php monthphp inphp phpphp'sphp datephp(php)php willphp returnphp thephp translatedphp monthphp namephp withphp thisphp functionphp.php.php.php usephp php'enphp'php asphp locale
php php php php php php*php ifphp youphp arephp inphp needphp ofphp thephp originalphp englishphp names
php php php php php php*
php php php php php php*php Thephp conversionphp hasphp thephp followingphp restrictionsphp:
php php php php php php*php php'aphp'php,php php'Aphp'php php-php Meridiemphp isphp notphp explicitphp upperphp/lowercasephp,php youphp havephp tophp upperphp/lowercasephp thephp translatedphp valuephp yourself
php php php php php php*
php php php php php php*php php@paramphp php stringphp php php$formatphp php Formatphp stringphp inphp PHPphp'sphp datephp format
php php php php php php*php php@returnphp stringphp php php php php php php php php php php Formatphp stringphp inphp ISOphp format
php php php php php php*php/
php php php php publicphp staticphp functionphp convertPhpToIsoFormatphp(php$formatphp)
php php php php php{
php php php php php php php php ifphp php(php$formatphp php=php=php=php nullphp)php php{
php php php php php php php php php php php php returnphp nullphp;
php php php php php php php php php}

php php php php php php php php php$convertphp php=php arrayphp(php'dphp'php php=php>php php'ddphp'php php php,php php'Dphp'php php=php>php php'EEphp'php php php,php php'jphp'php php=php>php php'dphp'php php php php,php php'lphp'php php=php>php php'EEEEphp'php,php php'Nphp'php php=php>php php'eeephp'php php,php php'Sphp'php php=php>php php'SSphp'php php php,
php php php php php php php php php php php php php php php php php php php php php php php php php php'wphp'php php=php>php php'ephp'php php php php,php php'zphp'php php=php>php php'Dphp'php php php php,php php'Wphp'php php=php>php php'wwphp'php php php,php php'Fphp'php php=php>php php'MMMMphp'php,php php'mphp'php php=php>php php'MMphp'php php php,php php'Mphp'php php=php>php php'MMMphp'php php,
php php php php php php php php php php php php php php php php php php php php php php php php php php'nphp'php php=php>php php'Mphp'php php php php,php php'tphp'php php=php>php php'dddphp'php php,php php'Lphp'php php=php>php php'lphp'php php php php,php php'ophp'php php=php>php php'YYYYphp'php,php php'Yphp'php php=php>php php'yyyyphp'php,php php'yphp'php php=php>php php'yyphp'php php php,
php php php php php php php php php php php php php php php php php php php php php php php php php php'aphp'php php=php>php php'aphp'php php php php,php php'Aphp'php php=php>php php'aphp'php php php php,php php'Bphp'php php=php>php php'Bphp'php php php php,php php'gphp'php php=php>php php'hphp'php php php php,php php'Gphp'php php=php>php php'Hphp'php php php php,php php'hphp'php php=php>php php'hhphp'php php php,
php php php php php php php php php php php php php php php php php php php php php php php php php php'Hphp'php php=php>php php'HHphp'php php php,php php'iphp'php php=php>php php'mmphp'php php php,php php'sphp'php php=php>php php'ssphp'php php php,php php'ephp'php php=php>php php'zzzzphp'php,php php'Iphp'php php=php>php php'Iphp'php php php php,php php'Ophp'php php=php>php php'Zphp'php php php php,
php php php php php php php php php php php php php php php php php php php php php php php php php php'Pphp'php php=php>php php'ZZZZphp'php,php php'Tphp'php php=php>php php'zphp'php php php php,php php'Zphp'php php=php>php php'Xphp'php php php php,php php'cphp'php php=php>php php'yyyyphp-MMphp-ddTHHphp:mmphp:ssZZZZphp'php,
php php php php php php php php php php php php php php php php php php php php php php php php php php'rphp'php php=php>php php'rphp'php php php php,php php'Uphp'php php=php>php php'Uphp'php)php;
php php php php php php php php php$valuesphp php=php strphp_splitphp(php$formatphp)php;
php php php php php php php php foreachphp php(php$valuesphp asphp php$keyphp php=php>php php$valuephp)php php{
php php php php php php php php php php php php ifphp php(issetphp(php$convertphp[php$valuephp]php)php php=php=php=php truephp)php php{
php php php php php php php php php php php php php php php php php$valuesphp[php$keyphp]php php=php php$convertphp[php$valuephp]php;
php php php php php php php php php php php php php}
php php php php php php php php php}

php php php php php php php php returnphp joinphp(php$valuesphp)php;
php php php php php}

php php php php php/php*php*
php php php php php php*php Parsephp datephp andphp splitphp inphp namedphp arrayphp fields
php php php php php php*
php php php php php php*php php@paramphp php php stringphp php php$datephp php php php php Datephp stringphp tophp parse
php php php php php php*php php@paramphp php php arrayphp php php php$optionsphp php Optionsphp:php formatphp_typephp,php fixphp_datephp,php localephp,php datephp_formatphp.php Seephp php{php@linkphp setOptionsphp(php)php}php forphp detailsphp.
php php php php php php*php php@returnphp php arrayphp php php php php php php php php php php php php Possiblephp arrayphp membersphp:php dayphp,php monthphp,php yearphp,php hourphp,php minutephp,php secondphp,php fixedphp,php format
php php php php php php*php/
php php php php privatephp staticphp functionphp php_parseDatephp(php$datephp,php php$optionsphp)
php php php php php{
php php php php php php php php ifphp php(php!selfphp:php:php_getUniCodeSupportphp(php)php)php php{
php php php php php php php php php php php php triggerphp_errorphp(php"Sorryphp,php yourphp PCREphp extensionphp doesphp notphp supportphp UTFphp8php whichphp isphp neededphp forphp thephp Iphp1php8Nphp corephp"php,php Ephp_USERphp_NOTICEphp)php;
php php php php php php php php php}

php php php php php php php php php$optionsphp php=php selfphp:php:php_checkOptionsphp(php$optionsphp)php php+php selfphp:php:php$php_optionsphp;
php php php php php php php php php$testphp php=php arrayphp(php'hphp'php,php php'Hphp'php,php php'mphp'php,php php'sphp'php,php php'yphp'php,php php'Yphp'php,php php'Mphp'php,php php'dphp'php,php php'Dphp'php,php php'Ephp'php,php php'Sphp'php,php php'lphp'php,php php'Bphp'php,php php'Iphp'php,
php php php php php php php php php php php php php php php php php php php php php php php php'Xphp'php,php php'rphp'php,php php'Uphp'php,php php'Gphp'php,php php'wphp'php,php php'ephp'php,php php'aphp'php,php php'Aphp'php,php php'Zphp'php,php php'zphp'php,php php'vphp'php)php;

php php php php php php php php php$formatphp php=php php$optionsphp[php'datephp_formatphp'php]php;
php php php php php php php php php$numberphp php=php php$datephp;php php/php/php workingphp copy
php php php php php php php php php$resultphp[php'datephp_formatphp'php]php php=php php$formatphp;php php/php/php savephp thephp formatphp usedphp tophp normalizephp php$numberphp php(conveniencephp)
php php php php php php php php php$resultphp[php'localephp'php]php php=php php$optionsphp[php'localephp'php]php;php php/php/php savephp thephp localephp usedphp tophp normalizephp php$numberphp php(conveniencephp)

php php php php php php php php php$oencphp php=php iconvphp_getphp_encodingphp(php'internalphp_encodingphp'php)php;
php php php php php php php php iconvphp_setphp_encodingphp(php'internalphp_encodingphp'php,php php'UTFphp-php8php'php)php;
php php php php php php php php php$dayphp php php php=php iconvphp_strposphp(php$formatphp,php php'dphp'php)php;
php php php php php php php php php$monthphp php=php iconvphp_strposphp(php$formatphp,php php'Mphp'php)php;
php php php php php php php php php$yearphp php php=php iconvphp_strposphp(php$formatphp,php php'yphp'php)php;
php php php php php php php php php$hourphp php php=php iconvphp_strposphp(php$formatphp,php php'Hphp'php)php;
php php php php php php php php php$minphp php php php=php iconvphp_strposphp(php$formatphp,php php'mphp'php)php;
php php php php php php php php php$secphp php php php=php iconvphp_strposphp(php$formatphp,php php'sphp'php)php;
php php php php php php php php php$amphp php php php php=php nullphp;
php php php php php php php php ifphp php(php$hourphp php=php=php=php falsephp)php php{
php php php php php php php php php php php php php$hourphp php=php iconvphp_strposphp(php$formatphp,php php'hphp'php)php;
php php php php php php php php php}
php php php php php php php php ifphp php(php$yearphp php=php=php=php falsephp)php php{
php php php php php php php php php php php php php$yearphp php=php iconvphp_strposphp(php$formatphp,php php'Yphp'php)php;
php php php php php php php php php}
php php php php php php php php ifphp php(php$dayphp php=php=php=php falsephp)php php{
php php php php php php php php php php php php php$dayphp php=php iconvphp_strposphp(php$formatphp,php php'Ephp'php)php;
php php php php php php php php php php php php ifphp php(php$dayphp php=php=php=php falsephp)php php{
php php php php php php php php php php php php php php php php php$dayphp php=php iconvphp_strposphp(php$formatphp,php php'Dphp'php)php;
php php php php php php php php php php php php php}
php php php php php php php php php}

php php php php php php php php ifphp php(php$dayphp php!php=php=php falsephp)php php{
php php php php php php php php php php php php php$parsephp[php$dayphp]php php php php=php php'dphp'php;
php php php php php php php php php php php php ifphp php(php!emptyphp(php$optionsphp[php'localephp'php]php)php php&php&php php(php$optionsphp[php'localephp'php]php php!php=php=php php'rootphp'php)php php&php&
php php php php php php php php php php php php php php php php php(php!isphp_objectphp(php$optionsphp[php'localephp'php]php)php php|php|php php(php(stringphp)php php$optionsphp[php'localephp'php]php php!php=php=php php'rootphp'php)php)php)php php{
php php php php php php php php php php php php php php php php php/php/php erasephp dayphp string
php php php php php php php php php php php php php php php php php php php php php$daylistphp php=php Zendphp_Localephp_Dataphp:php:getListphp(php$optionsphp[php'localephp'php]php,php php'dayphp'php)php;
php php php php php php php php php php php php php php php php foreachphp(php$daylistphp asphp php$keyphp php=php>php php$namephp)php php{
php php php php php php php php php php php php php php php php php php php php ifphp php(iconvphp_strposphp(php$numberphp,php php$namephp)php php!php=php=php falsephp)php php{
php php php php php php php php php php php php php php php php php php php php php php php php php$numberphp php=php strphp_replacephp(php$namephp,php php"EEEEphp"php,php php$numberphp)php;
php php php php php php php php php php php php php php php php php php php php php php php php breakphp;
php php php php php php php php php php php php php php php php php php php php php}
php php php php php php php php php php php php php php php php php}
php php php php php php php php php php php php php}
php php php php php php php php php}
php php php php php php php php php$positionphp php=php falsephp;

php php php php php php php php ifphp php(php$monthphp php!php=php=php falsephp)php php{
php php php php php php php php php php php php php$parsephp[php$monthphp]php php=php php'Mphp'php;
php php php php php php php php php php php php ifphp php(php!emptyphp(php$optionsphp[php'localephp'php]php)php php&php&php php(php$optionsphp[php'localephp'php]php php!php=php=php php'rootphp'php)php php&php&
php php php php php php php php php php php php php php php php php(php!isphp_objectphp(php$optionsphp[php'localephp'php]php)php php|php|php php(php(stringphp)php php$optionsphp[php'localephp'php]php php!php=php=php php'rootphp'php)php)php)php php{
php php php php php php php php php php php php php php php php php php php php php/php/php preparephp tophp convertphp monthphp namephp tophp theirphp numericphp equivalentsphp,php ifphp requestedphp,
php php php php php php php php php php php php php php php php php php php php php/php/php andphp wephp havephp aphp php$optionsphp[php'localephp'php]
php php php php php php php php php php php php php php php php php php php php php$positionphp php=php selfphp:php:php_replaceMonthphp(php$numberphp,php Zendphp_Localephp_Dataphp:php:getListphp(php$optionsphp[php'localephp'php]php,
php php php php php php php php php php php php php php php php php php php php php php php php php'monthphp'php)php)php;
php php php php php php php php php php php php php php php php ifphp php(php$positionphp php=php=php=php falsephp)php php{
php php php php php php php php php php php php php php php php php php php php php$positionphp php=php selfphp:php:php_replaceMonthphp(php$numberphp,php Zendphp_Localephp_Dataphp:php:getListphp(php$optionsphp[php'localephp'php]php,
php php php php php php php php php php php php php php php php php php php php php php php php php'monthphp'php,php arrayphp(php'gregorianphp'php,php php'formatphp'php,php php'abbreviatedphp'php)php)php)php;
php php php php php php php php php php php php php php php php php}
php php php php php php php php php php php php php}
php php php php php php php php php}
php php php php php php php php ifphp php(php$yearphp php!php=php=php falsephp)php php{
php php php php php php php php php php php php php$parsephp[php$yearphp]php php php=php php'yphp'php;
php php php php php php php php php}
php php php php php php php php ifphp php(php$hourphp php!php=php=php falsephp)php php{
php php php php php php php php php php php php php$parsephp[php$hourphp]php php=php php'Hphp'php;
php php php php php php php php php}
php php php php php php php php ifphp php(php$minphp php!php=php=php falsephp)php php{
php php php php php php php php php php php php php$parsephp[php$minphp]php php=php php'mphp'php;
php php php php php php php php php}
php php php php php php php php ifphp php(php$secphp php!php=php=php falsephp)php php{
php php php php php php php php php php php php php$parsephp[php$secphp]php php=php php'sphp'php;
php php php php php php php php php}

php php php php php php php php ifphp php(emptyphp(php$parsephp)php)php php{
php php php php php php php php php php php php iconvphp_setphp_encodingphp(php'internalphp_encodingphp'php,php php$oencphp)php;
php php php php php php php php php php php php requirephp_oncephp php'Zendphp/Localephp/Exceptionphp.phpphp'php;
php php php php php php php php php php php php throwphp newphp Zendphp_Localephp_Exceptionphp(php"Unknownphp datephp formatphp,php neitherphp datephp norphp timephp inphp php'php"php php.php php$formatphp php.php php"php'php foundphp"php)php;
php php php php php php php php php}
php php php php php php php php ksortphp(php$parsephp)php;

php php php php php php php php php/php/php getphp daytime
php php php php php php php php ifphp php(iconvphp_strposphp(php$formatphp,php php'aphp'php)php php!php=php=php falsephp)php php{
php php php php php php php php php php php php ifphp php(iconvphp_strposphp(strtoupperphp(php$numberphp)php,php strtoupperphp(Zendphp_Localephp_Dataphp:php:getContentphp(php$optionsphp[php'localephp'php]php,php php'amphp'php)php)php)php php!php=php=php falsephp)php php{
php php php php php php php php php php php php php php php php php$amphp php=php truephp;
php php php php php php php php php php php php php}php elsephp ifphp php(iconvphp_strposphp(strtoupperphp(php$numberphp)php,php strtoupperphp(Zendphp_Localephp_Dataphp:php:getContentphp(php$optionsphp[php'localephp'php]php,php php'pmphp'php)php)php)php php!php=php=php falsephp)php php{
php php php php php php php php php php php php php php php php php$amphp php=php falsephp;
php php php php php php php php php php php php php}
php php php php php php php php php}

php php php php php php php php php/php/php splitphp numberphp parts
php php php php php php php php php$splitphp php=php falsephp;
php php php php php php php php pregphp_matchphp_allphp(php'php/php\dphp+php/uphp'php,php php$numberphp,php php$splittedphp)php;

php php php php php php php php ifphp php(countphp(php$splittedphp[php0php]php)php php=php=php php0php)php php{
php php php php php php php php php php php php iconvphp_setphp_encodingphp(php'internalphp_encodingphp'php,php php$oencphp)php;
php php php php php php php php php php php php requirephp_oncephp php'Zendphp/Localephp/Exceptionphp.phpphp'php;
php php php php php php php php php php php php throwphp newphp Zendphp_Localephp_Exceptionphp(php"Nophp datephp partphp inphp php'php$datephp'php foundphp.php"php)php;
php php php php php php php php php}
php php php php php php php php ifphp php(countphp(php$splittedphp[php0php]php)php php=php=php php1php)php php{
php php php php php php php php php php php php php$splitphp php=php php0php;
php php php php php php php php php}
php php php php php php php php php$cntphp php=php php0php;
php php php php php php php php foreachphp(php$parsephp asphp php$keyphp php=php>php php$valuephp)php php{

php php php php php php php php php php php php switchphp(php$valuephp)php php{
php php php php php php php php php php php php php php php php casephp php'dphp'php:
php php php php php php php php php php php php php php php php php php php php ifphp php(php$splitphp php=php=php=php falsephp)php php{
php php php php php php php php php php php php php php php php php php php php php php php php ifphp php(countphp(php$splittedphp[php0php]php)php php>php php$cntphp)php php{
php php php php php php php php php php php php php php php php php php php php php php php php php php php php php$resultphp[php'dayphp'php]php php php php php=php php$splittedphp[php0php]php[php$cntphp]php;
php php php php php php php php php php php php php php php php php php php php php php php php php}
php php php php php php php php php php php php php php php php php php php php php}php elsephp php{
php php php php php php php php php php php php php php php php php php php php php php php php php$resultphp[php'dayphp'php]php php=php iconvphp_substrphp(php$splittedphp[php0php]php[php0php]php,php php$splitphp,php php2php)php;
php php php php php php php php php php php php php php php php php php php php php php php php php$splitphp php+php=php php2php;
php php php php php php php php php php php php php php php php php php php php php}
php php php php php php php php php php php php php php php php php php php php php+php+php$cntphp;
php php php php php php php php php php php php php php php php php php php php breakphp;
php php php php php php php php php php php php php php php php casephp php'Mphp'php:
php php php php php php php php php php php php php php php php php php php php ifphp php(php$splitphp php=php=php=php falsephp)php php{
php php php php php php php php php php php php php php php php php php php php php php php php ifphp php(countphp(php$splittedphp[php0php]php)php php>php php$cntphp)php php{
php php php php php php php php php php php php php php php php php php php php php php php php php php php php php$resultphp[php'monthphp'php]php php php=php php$splittedphp[php0php]php[php$cntphp]php;
php php php php php php php php php php php php php php php php php php php php php php php php php}
php php php php php php php php php php php php php php php php php php php php php}php elsephp php{
php php php php php php php php php php php php php php php php php php php php php php php php php$resultphp[php'monthphp'php]php php=php iconvphp_substrphp(php$splittedphp[php0php]php[php0php]php,php php$splitphp,php php2php)php;
php php php php php php php php php php php php php php php php php php php php php php php php php$splitphp php+php=php php2php;
php php php php php php php php php php php php php php php php php php php php php}
php php php php php php php php php php php php php php php php php php php php php+php+php$cntphp;
php php php php php php php php php php php php php php php php php php php php breakphp;
php php php php php php php php php php php php php php php php casephp php'yphp'php:
php php php php php php php php php php php php php php php php php php php php php$lengthphp php=php php2php;
php php php php php php php php php php php php php php php php php php php php ifphp php(php(iconvphp_substrphp(php$formatphp,php php$yearphp,php php4php)php php=php=php php'yyyyphp'php)
php php php php php php php php php php php php php php php php php php php php php php|php|php php(iconvphp_substrphp(php$formatphp,php php$yearphp,php php4php)php php=php=php php'YYYYphp'php)php)php php{
php php php php php php php php php php php php php php php php php php php php php php php php php$lengthphp php=php php4php;
php php php php php php php php php php php php php php php php php php php php php}

php php php php php php php php php php php php php php php php php php php php ifphp php(php$splitphp php=php=php=php falsephp)php php{
php php php php php php php php php php php php php php php php php php php php php php php php ifphp php(countphp(php$splittedphp[php0php]php)php php>php php$cntphp)php php{
php php php php php php php php php php php php php php php php php php php php php php php php php php php php php$resultphp[php'yearphp'php]php php php php=php php$splittedphp[php0php]php[php$cntphp]php;
php php php php php php php php php php php php php php php php php php php php php php php php php}
php php php php php php php php php php php php php php php php php php php php php}php elsephp php{
php php php php php php php php php php php php php php php php php php php php php php php php php$resultphp[php'yearphp'php]php php php php=php iconvphp_substrphp(php$splittedphp[php0php]php[php0php]php,php php$splitphp,php php$lengthphp)php;
php php php php php php php php php php php php php php php php php php php php php php php php php$splitphp php+php=php php$lengthphp;
php php php php php php php php php php php php php php php php php php php php php}

php php php php php php php php php php php php php php php php php php php php php+php+php$cntphp;
php php php php php php php php php php php php php php php php php php php php breakphp;
php php php php php php php php php php php php php php php php casephp php'Hphp'php:
php php php php php php php php php php php php php php php php php php php php ifphp php(php$splitphp php=php=php=php falsephp)php php{
php php php php php php php php php php php php php php php php php php php php php php php php ifphp php(countphp(php$splittedphp[php0php]php)php php>php php$cntphp)php php{
php php php php php php php php php php php php php php php php php php php php php php php php php php php php php$resultphp[php'hourphp'php]php php php php=php php$splittedphp[php0php]php[php$cntphp]php;
php php php php php php php php php php php php php php php php php php php php php php php php php}
php php php php php php php php php php php php php php php php php php php php php}php elsephp php{
php php php php php php php php php php php php php php php php php php php php php php php php php$resultphp[php'hourphp'php]php php php php=php iconvphp_substrphp(php$splittedphp[php0php]php[php0php]php,php php$splitphp,php php2php)php;
php php php php php php php php php php php php php php php php php php php php php php php php php$splitphp php+php=php php2php;
php php php php php php php php php php php php php php php php php php php php php}
php php php php php php php php php php php php php php php php php php php php php+php+php$cntphp;
php php php php php php php php php php php php php php php php php php php php breakphp;
php php php php php php php php php php php php php php php php casephp php'mphp'php:
php php php php php php php php php php php php php php php php php php php php ifphp php(php$splitphp php=php=php=php falsephp)php php{
php php php php php php php php php php php php php php php php php php php php php php php php ifphp php(countphp(php$splittedphp[php0php]php)php php>php php$cntphp)php php{
php php php php php php php php php php php php php php php php php php php php php php php php php php php php php$resultphp[php'minutephp'php]php php=php php$splittedphp[php0php]php[php$cntphp]php;
php php php php php php php php php php php php php php php php php php php php php php php php php}
php php php php php php php php php php php php php php php php php php php php php}php elsephp php{
php php php php php php php php php php php php php php php php php php php php php php php php php$resultphp[php'minutephp'php]php php=php iconvphp_substrphp(php$splittedphp[php0php]php[php0php]php,php php$splitphp,php php2php)php;
php php php php php php php php php php php php php php php php php php php php php php php php php$splitphp php+php=php php2php;
php php php php php php php php php php php php php php php php php php php php php}
php php php php php php php php php php php php php php php php php php php php php+php+php$cntphp;
php php php php php php php php php php php php php php php php php php php php breakphp;
php php php php php php php php php php php php php php php php casephp php'sphp'php:
php php php php php php php php php php php php php php php php php php php php ifphp php(php$splitphp php=php=php=php falsephp)php php{
php php php php php php php php php php php php php php php php php php php php php php php php ifphp php(countphp(php$splittedphp[php0php]php)php php>php php$cntphp)php php{
php php php php php php php php php php php php php php php php php php php php php php php php php php php php php$resultphp[php'secondphp'php]php php=php php$splittedphp[php0php]php[php$cntphp]php;
php php php php php php php php php php php php php php php php php php php php php php php php php}
php php php php php php php php php php php php php php php php php php php php php}php elsephp php{
php php php php php php php php php php php php php php php php php php php php php php php php php$resultphp[php'secondphp'php]php php=php iconvphp_substrphp(php$splittedphp[php0php]php[php0php]php,php php$splitphp,php php2php)php;
php php php php php php php php php php php php php php php php php php php php php php php php php$splitphp php+php=php php2php;
php php php php php php php php php php php php php php php php php php php php php}
php php php php php php php php php php php php php php php php php php php php php+php+php$cntphp;
php php php php php php php php php php php php php php php php php php php php breakphp;
php php php php php php php php php php php php php}
php php php php php php php php php}

php php php php php php php php php/php/php AMphp/PMphp correction
php php php php php php php php ifphp php(php$hourphp php!php=php=php falsephp)php php{
php php php php php php php php php php php php ifphp php(php(php$amphp php=php=php=php truephp)php andphp php(php$resultphp[php'hourphp'php]php php=php=php php1php2php)php)php{
php php php php php php php php php php php php php php php php php$resultphp[php'hourphp'php]php php=php php0php;
php php php php php php php php php php php php php}php elsephp ifphp php(php(php$amphp php=php=php=php falsephp)php andphp php(php$resultphp[php'hourphp'php]php php!php=php php1php2php)php)php php{
php php php php php php php php php php php php php php php php php$resultphp[php'hourphp'php]php php+php=php php1php2php;
php php php php php php php php php php php php php}
php php php php php php php php php}

php php php php php php php php ifphp php(php$optionsphp[php'fixphp_datephp'php]php php=php=php=php truephp)php php{
php php php php php php php php php php php php php$resultphp[php'fixedphp'php]php php=php php0php;php php/php/php nothingphp hasphp beenphp php"fixedphp"php byphp swappingphp datephp partsphp aroundphp php(yetphp)
php php php php php php php php php}

php php php php php php php php ifphp php(php$dayphp php!php=php=php falsephp)php php{
php php php php php php php php php php php php php/php/php fixphp falsephp month
php php php php php php php php php php php php ifphp php(issetphp(php$resultphp[php'dayphp'php]php)php andphp issetphp(php$resultphp[php'monthphp'php]php)php)php php{
php php php php php php php php php php php php php php php php ifphp php(php(php$positionphp php!php=php=php falsephp)php andphp php(php(iconvphp_strposphp(php$datephp,php php$resultphp[php'dayphp'php]php)php php=php=php=php falsephp)php or
php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php(issetphp(php$resultphp[php'yearphp'php]php)php andphp php(iconvphp_strposphp(php$datephp,php php$resultphp[php'yearphp'php]php)php php=php=php=php falsephp)php)php)php)php php{
php php php php php php php php php php php php php php php php php php php php ifphp php(php$optionsphp[php'fixphp_datephp'php]php php!php=php=php truephp)php php{
php php php php php php php php php php php php php php php php php php php php php php php php iconvphp_setphp_encodingphp(php'internalphp_encodingphp'php,php php$oencphp)php;
php php php php php php php php php php php php php php php php php php php php php php php php requirephp_oncephp php'Zendphp/Localephp/Exceptionphp.phpphp'php;
php php php php php php php php php php php php php php php php php php php php php php php php throwphp newphp Zendphp_Localephp_Exceptionphp(php"Unablephp tophp parsephp datephp php'php$datephp'php usingphp php'php"php php.php php$format
php php php php php php php php php php php php php php php php php php php php php php php php php php php php php.php php"php'php php(falsephp monthphp,php php$positionphp,php php$monthphp)php"php)php;
php php php php php php php php php php php php php php php php php php php php php}
php php php php php php php php php php php php php php php php php php php php php$tempphp php=php php$resultphp[php'dayphp'php]php;
php php php php php php php php php php php php php php php php php php php php php$resultphp[php'dayphp'php]php php php php=php php$resultphp[php'monthphp'php]php;
php php php php php php php php php php php php php php php php php php php php php$resultphp[php'monthphp'php]php php=php php$tempphp;
php php php php php php php php php php php php php php php php php php php php php$resultphp[php'fixedphp'php]php php=php php1php;
php php php php php php php php php php php php php php php php php}
php php php php php php php php php php php php php}

php php php php php php php php php php php php php/php/php fixphp switchedphp valuesphp dphp <php>php y
php php php php php php php php php php php php ifphp php(issetphp(php$resultphp[php'dayphp'php]php)php andphp issetphp(php$resultphp[php'yearphp'php]php)php)php php{
php php php php php php php php php php php php php php php php ifphp php(php$resultphp[php'dayphp'php]php php>php php3php1php)php php{
php php php php php php php php php php php php php php php php php php php php ifphp php(php$optionsphp[php'fixphp_datephp'php]php php!php=php=php truephp)php php{
php php php php php php php php php php php php php php php php php php php php php php php php iconvphp_setphp_encodingphp(php'internalphp_encodingphp'php,php php$oencphp)php;
php php php php php php php php php php php php php php php php php php php php php php php php requirephp_oncephp php'Zendphp/Localephp/Exceptionphp.phpphp'php;
php php php php php php php php php php php php php php php php php php php php php php php php throwphp newphp Zendphp_Localephp_Exceptionphp(php"Unablephp tophp parsephp datephp php'php$datephp'php usingphp php'php"
php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php.php php$formatphp php.php php"php'php php(dphp <php>php yphp)php"php)php;
php php php php php php php php php php php php php php php php php php php php php}
php php php php php php php php php php php php php php php php php php php php php$tempphp php=php php$resultphp[php'yearphp'php]php;
php php php php php php php php php php php php php php php php php php php php php$resultphp[php'yearphp'php]php php=php php$resultphp[php'dayphp'php]php;
php php php php php php php php php php php php php php php php php php php php php$resultphp[php'dayphp'php]php php php=php php$tempphp;
php php php php php php php php php php php php php php php php php php php php php$resultphp[php'fixedphp'php]php php=php php2php;
php php php php php php php php php php php php php php php php php}
php php php php php php php php php php php php php}

php php php php php php php php php php php php php/php/php fixphp switchedphp valuesphp Mphp <php>php y
php php php php php php php php php php php php ifphp php(issetphp(php$resultphp[php'monthphp'php]php)php andphp issetphp(php$resultphp[php'yearphp'php]php)php)php php{
php php php php php php php php php php php php php php php php ifphp php(php$resultphp[php'monthphp'php]php php>php php3php1php)php php{
php php php php php php php php php php php php php php php php php php php php ifphp php(php$optionsphp[php'fixphp_datephp'php]php php!php=php=php truephp)php php{
php php php php php php php php php php php php php php php php php php php php php php php php iconvphp_setphp_encodingphp(php'internalphp_encodingphp'php,php php$oencphp)php;
php php php php php php php php php php php php php php php php php php php php php php php php requirephp_oncephp php'Zendphp/Localephp/Exceptionphp.phpphp'php;
php php php php php php php php php php php php php php php php php php php php php php php php throwphp newphp Zendphp_Localephp_Exceptionphp(php"Unablephp tophp parsephp datephp php'php$datephp'php usingphp php'php"
php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php.php php$formatphp php.php php"php'php php(Mphp <php>php yphp)php"php)php;
php php php php php php php php php php php php php php php php php php php php php}
php php php php php php php php php php php php php php php php php php php php php$tempphp php=php php$resultphp[php'yearphp'php]php;
php php php php php php php php php php php php php php php php php php php php php$resultphp[php'yearphp'php]php php php=php php$resultphp[php'monthphp'php]php;
php php php php php php php php php php php php php php php php php php php php php$resultphp[php'monthphp'php]php php=php php$tempphp;
php php php php php php php php php php php php php php php php php php php php php$resultphp[php'fixedphp'php]php php=php php3php;
php php php php php php php php php php php php php php php php php}
php php php php php php php php php php php php php}

php php php php php php php php php php php php php/php/php fixphp switchedphp valuesphp Mphp <php>php d
php php php php php php php php php php php php ifphp php(issetphp(php$resultphp[php'monthphp'php]php)php andphp issetphp(php$resultphp[php'dayphp'php]php)php)php php{
php php php php php php php php php php php php php php php php ifphp php(php$resultphp[php'monthphp'php]php php>php php1php2php)php php{
php php php php php php php php php php php php php php php php php php php php ifphp php(php$optionsphp[php'fixphp_datephp'php]php php!php=php=php truephp php|php|php php$resultphp[php'monthphp'php]php php>php php3php1php)php php{
php php php php php php php php php php php php php php php php php php php php php php php php iconvphp_setphp_encodingphp(php'internalphp_encodingphp'php,php php$oencphp)php;
php php php php php php php php php php php php php php php php php php php php php php php php requirephp_oncephp php'Zendphp/Localephp/Exceptionphp.phpphp'php;
php php php php php php php php php php php php php php php php php php php php php php php php throwphp newphp Zendphp_Localephp_Exceptionphp(php"Unablephp tophp parsephp datephp php'php$datephp'php usingphp php'php"
php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php.php php$formatphp php.php php"php'php php(Mphp <php>php dphp)php"php)php;
php php php php php php php php php php php php php php php php php php php php php}
php php php php php php php php php php php php php php php php php php php php php$tempphp php=php php$resultphp[php'dayphp'php]php;
php php php php php php php php php php php php php php php php php php php php php$resultphp[php'dayphp'php]php php php php=php php$resultphp[php'monthphp'php]php;
php php php php php php php php php php php php php php php php php php php php php$resultphp[php'monthphp'php]php php=php php$tempphp;
php php php php php php php php php php php php php php php php php php php php php$resultphp[php'fixedphp'php]php php=php php4php;
php php php php php php php php php php php php php php php php php}
php php php php php php php php php php php php php}
php php php php php php php php php}

php php php php php php php php ifphp php(issetphp(php$resultphp[php'yearphp'php]php)php)php php{
php php php php php php php php php php php php ifphp php(php(php(iconvphp_strlenphp(php$resultphp[php'yearphp'php]php)php php=php=php php2php)php php&php&php php(php$resultphp[php'yearphp'php]php <php php1php0php)php)php php|php|
php php php php php php php php php php php php php php php php php(php(php(iconvphp_strposphp(php$formatphp,php php'yyphp'php)php php!php=php=php falsephp)php php&php&php php(iconvphp_strposphp(php$formatphp,php php'yyyyphp'php)php php=php=php=php falsephp)php)php php|php|
php php php php php php php php php php php php php php php php php(php(iconvphp_strposphp(php$formatphp,php php'YYphp'php)php php!php=php=php falsephp)php php&php&php php(iconvphp_strposphp(php$formatphp,php php'YYYYphp'php)php php=php=php=php falsephp)php)php)php)php php{
php php php php php php php php php php php php php php php php ifphp php(php(php$resultphp[php'yearphp'php]php php>php=php php0php)php php&php&php php(php$resultphp[php'yearphp'php]php <php php1php0php0php)php)php php{
php php php php php php php php php php php php php php php php php php php php ifphp php(php$resultphp[php'yearphp'php]php <php php7php0php)php php{
php php php php php php php php php php php php php php php php php php php php php php php php php$resultphp[php'yearphp'php]php php=php php(intphp)php php$resultphp[php'yearphp'php]php php+php php1php0php0php;
php php php php php php php php php php php php php php php php php php php php php}

php php php php php php php php php php php php php php php php php php php php php$resultphp[php'yearphp'php]php php=php php(intphp)php php$resultphp[php'yearphp'php]php php+php php1php9php0php0php;
php php php php php php php php php php php php php php php php php}
php php php php php php php php php php php php php}
php php php php php php php php php}

php php php php php php php php iconvphp_setphp_encodingphp(php'internalphp_encodingphp'php,php php$oencphp)php;
php php php php php php php php returnphp php$resultphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Searchphp php$numberphp forphp aphp monthphp namephp foundphp inphp php$monthlistphp,php andphp replacephp ifphp foundphp.
php php php php php php*
php php php php php php*php php@paramphp php stringphp php php$numberphp php php php php Datephp stringphp php(modifiedphp)
php php php php php php*php php@paramphp php arrayphp php php php$monthlistphp php Listphp ofphp monthphp names
php php php php php php*
php php php php php php*php php@returnphp intphp|falsephp php php php php php php php php php php Positionphp ofphp replacedphp stringphp php(falsephp ifphp nothingphp replacedphp)
php php php php php php*php/
php php php php protectedphp staticphp functionphp php_replaceMonthphp(php&php$numberphp,php php$monthlistphp)
php php php php php{
php php php php php php php php php/php/php Ifphp php$localephp wasphp invalidphp,php php$monthlistphp willphp defaultphp tophp aphp php"rootphp"php identity
php php php php php php php php php/php/php mappingphp forphp eachphp monthphp numberphp fromphp php1php tophp php1php2php.
php php php php php php php php php/php/php Ifphp nophp php$localephp wasphp givenphp,php orphp php$localephp wasphp invalidphp,php dophp notphp usephp thisphp identityphp mappingphp tophp normalizephp.
php php php php php php php php php/php/php Otherwisephp,php translatephp localephp awarephp monthphp namesphp inphp php$numberphp tophp theirphp numericphp equivalentsphp.
php php php php php php php php php$positionphp php=php falsephp;
php php php php php php php php ifphp php(php$monthlistphp php&php&php php$monthlistphp[php1php]php php!php=php php1php)php php{
php php php php php php php php php php php php foreachphp(php$monthlistphp asphp php$keyphp php=php>php php$namephp)php php{
php php php php php php php php php php php php php php php php ifphp php(php(php$positionphp php=php iconvphp_strposphp(php$numberphp,php php$namephp,php php0php,php php'UTFphp-php8php'php)php)php php!php=php=php falsephp)php php{
php php php php php php php php php php php php php php php php php php php php php$numberphp php php php=php strphp_ireplacephp(php$namephp,php php$keyphp,php php$numberphp)php;
php php php php php php php php php php php php php php php php php php php php returnphp php$positionphp;
php php php php php php php php php php php php php php php php php}
php php php php php php php php php php php php php}
php php php php php php php php php}

php php php php php php php php returnphp falsephp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Returnsphp thephp defaultphp datephp formatphp forphp php$localephp.
php php php php php php*
php php php php php php*php php@paramphp php stringphp|Zendphp_Localephp php php$localephp php OPTIONALphp Localephp ofphp php$numberphp,php possiblyphp inphp stringphp formphp php(ephp.gphp.php php'dephp_ATphp'php)
php php php php php php*php php@returnphp stringphp php format
php php php php php php*php php@throwsphp Zendphp_Localephp_Exceptionphp php throwsphp anphp exceptionphp whenphp localephp dataphp isphp broken
php php php php php php*php/
php php php php publicphp staticphp functionphp getDateFormatphp(php$localephp php=php nullphp)
php php php php php{
php php php php php php php php php$formatphp php=php Zendphp_Localephp_Dataphp:php:getContentphp(php$localephp,php php'datephp'php)php;
php php php php php php php php ifphp php(emptyphp(php$formatphp)php)php php{
php php php php php php php php php php php php requirephp_oncephp php'Zendphp/Localephp/Exceptionphp.phpphp'php;
php php php php php php php php php php php php throwphp newphp Zendphp_Localephp_Exceptionphp(php"failedphp tophp receivephp dataphp fromphp localephp php$localephp"php)php;
php php php php php php php php php}

php php php php php php php php returnphp php$formatphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Returnsphp anphp arrayphp withphp thephp normalizedphp datephp fromphp anphp localephp date
php php php php php php*php aphp inputphp ofphp php1php0php.php0php1php.php2php0php0php6php withoutphp aphp php$localephp wouldphp returnphp:
php php php php php php*php arrayphp php(php'dayphp'php php=php>php php1php0php,php php'monthphp'php php=php>php php1php,php php'yearphp'php php=php>php php2php0php0php6php)
php php php php php php*php Thephp php'localephp'php optionphp isphp onlyphp usedphp tophp convertphp humanphp readablephp day
php php php php php php*php andphp monthphp namesphp tophp theirphp numericphp equivalentsphp.
php php php php php php*php Thephp php'formatphp'php optionphp allowsphp specificationphp ofphp selfphp-definedphp datephp formatsphp,
php php php php php php*php whenphp notphp usingphp thephp defaultphp formatphp forphp thephp php'localephp'php.
php php php php php php*
php php php php php php*php php@paramphp php php stringphp php php$datephp php php php php Datephp string
php php php php php php*php php@paramphp php php arrayphp php php php$optionsphp php Optionsphp:php formatphp_typephp,php fixphp_datephp,php localephp,php datephp_formatphp.php Seephp php{php@linkphp setOptionsphp(php)php}php forphp detailsphp.
php php php php php php*php php@returnphp php arrayphp php php php php php php php php php php php php Possiblephp arrayphp membersphp:php dayphp,php monthphp,php yearphp,php hourphp,php minutephp,php secondphp,php fixedphp,php format
php php php php php php*php/
php php php php publicphp staticphp functionphp getDatephp(php$datephp,php arrayphp php$optionsphp php=php arrayphp(php)php)
php php php php php{
php php php php php php php php php$optionsphp php=php selfphp:php:php_checkOptionsphp(php$optionsphp)php php+php selfphp:php:php$php_optionsphp;
php php php php php php php php ifphp php(emptyphp(php$optionsphp[php'datephp_formatphp'php]php)php)php php{
php php php php php php php php php php php php php$optionsphp[php'formatphp_typephp'php]php php=php php'isophp'php;
php php php php php php php php php php php php php$optionsphp[php'datephp_formatphp'php]php php=php selfphp:php:getDateFormatphp(php$optionsphp[php'localephp'php]php)php;
php php php php php php php php php}

php php php php php php php php returnphp selfphp:php:php_parseDatephp(php$datephp,php php$optionsphp)php;
php php php php php}

php php php php php/php*php*
php php php php php php*php Returnsphp ifphp thephp givenphp datestringphp containsphp allphp datephp partsphp fromphp thephp givenphp formatphp.
php php php php php php*php Ifphp nophp formatphp isphp givenphp,php thephp defaultphp datephp formatphp fromphp thephp localephp isphp used
php php php php php php*php Ifphp youphp wantphp tophp checkphp ifphp thephp datephp isphp aphp properphp datephp youphp shouldphp usephp Zendphp_Datephp:php:isDatephp(php)
php php php php php php*
php php php php php php*php php@paramphp php php stringphp php php$datephp php php php php Datephp string
php php php php php php*php php@paramphp php php arrayphp php php php$optionsphp php Optionsphp:php formatphp_typephp,php fixphp_datephp,php localephp,php datephp_formatphp.php Seephp php{php@linkphp setOptionsphp(php)php}php forphp detailsphp.
php php php php php php*php php@returnphp php boolean
php php php php php php*php/
php php php php publicphp staticphp functionphp checkDateFormatphp(php$datephp,php arrayphp php$optionsphp php=php arrayphp(php)php)
php php php php php{
php php php php php php php php tryphp php{
php php php php php php php php php php php php php$datephp php=php selfphp:php:getDatephp(php$datephp,php php$optionsphp)php;
php php php php php php php php php}php catchphp php(Exceptionphp php$ephp)php php{
php php php php php php php php php php php php returnphp falsephp;
php php php php php php php php php}

php php php php php php php php ifphp php(emptyphp(php$optionsphp[php'datephp_formatphp'php]php)php)php php{
php php php php php php php php php php php php php$optionsphp[php'formatphp_typephp'php]php php=php php'isophp'php;
php php php php php php php php php php php php php$optionsphp[php'datephp_formatphp'php]php php=php selfphp:php:getDateFormatphp(php$optionsphp[php'localephp'php]php)php;
php php php php php php php php php}
php php php php php php php php php$optionsphp php=php selfphp:php:php_checkOptionsphp(php$optionsphp)php php+php selfphp:php:php$php_optionsphp;

php php php php php php php php php/php/php dayphp expectedphp butphp notphp parsed
php php php php php php php php ifphp php(php(iconvphp_strposphp(php$optionsphp[php'datephp_formatphp'php]php,php php'dphp'php,php php0php,php php'UTFphp-php8php'php)php php!php=php=php falsephp)php andphp php(php!issetphp(php$datephp[php'dayphp'php]php)php orphp php(php$datephp[php'dayphp'php]php php=php=php=php php"php"php)php)php)php php{
php php php php php php php php php php php php returnphp falsephp;
php php php php php php php php php}

php php php php php php php php php/php/php monthphp expectedphp butphp notphp parsed
php php php php php php php php ifphp php(php(iconvphp_strposphp(php$optionsphp[php'datephp_formatphp'php]php,php php'Mphp'php,php php0php,php php'UTFphp-php8php'php)php php!php=php=php falsephp)php andphp php(php!issetphp(php$datephp[php'monthphp'php]php)php orphp php(php$datephp[php'monthphp'php]php php=php=php=php php"php"php)php)php)php php{
php php php php php php php php php php php php returnphp falsephp;
php php php php php php php php php}

php php php php php php php php php/php/php yearphp expectedphp butphp notphp parsed
php php php php php php php php ifphp php(php(php(iconvphp_strposphp(php$optionsphp[php'datephp_formatphp'php]php,php php'Yphp'php,php php0php,php php'UTFphp-php8php'php)php php!php=php=php falsephp)php or
php php php php php php php php php php php php php php(iconvphp_strposphp(php$optionsphp[php'datephp_formatphp'php]php,php php'yphp'php,php php0php,php php'UTFphp-php8php'php)php php!php=php=php falsephp)php)php andphp php(php!issetphp(php$datephp[php'yearphp'php]php)php orphp php(php$datephp[php'yearphp'php]php php=php=php=php php"php"php)php)php)php php{
php php php php php php php php php php php php returnphp falsephp;
php php php php php php php php php}

php php php php php php php php php/php/php secondphp expectedphp butphp notphp parsed
php php php php php php php php ifphp php(php(iconvphp_strposphp(php$optionsphp[php'datephp_formatphp'php]php,php php'sphp'php,php php0php,php php'UTFphp-php8php'php)php php!php=php=php falsephp)php andphp php(php!issetphp(php$datephp[php'secondphp'php]php)php orphp php(php$datephp[php'secondphp'php]php php=php=php=php php"php"php)php)php)php php{
php php php php php php php php php php php php returnphp falsephp;
php php php php php php php php php}

php php php php php php php php php/php/php minutephp expectedphp butphp notphp parsed
php php php php php php php php ifphp php(php(iconvphp_strposphp(php$optionsphp[php'datephp_formatphp'php]php,php php'mphp'php,php php0php,php php'UTFphp-php8php'php)php php!php=php=php falsephp)php andphp php(php!issetphp(php$datephp[php'minutephp'php]php)php orphp php(php$datephp[php'minutephp'php]php php=php=php=php php"php"php)php)php)php php{
php php php php php php php php php php php php returnphp falsephp;
php php php php php php php php php}

php php php php php php php php php/php/php hourphp expectedphp butphp notphp parsed
php php php php php php php php ifphp php(php(php(iconvphp_strposphp(php$optionsphp[php'datephp_formatphp'php]php,php php'Hphp'php,php php0php,php php'UTFphp-php8php'php)php php!php=php=php falsephp)php or
php php php php php php php php php php php php php php(iconvphp_strposphp(php$optionsphp[php'datephp_formatphp'php]php,php php'hphp'php,php php0php,php php'UTFphp-php8php'php)php php!php=php=php falsephp)php)php andphp php(php!issetphp(php$datephp[php'hourphp'php]php)php orphp php(php$datephp[php'hourphp'php]php php=php=php=php php"php"php)php)php)php php{
php php php php php php php php php php php php returnphp falsephp;
php php php php php php php php php}

php php php php php php php php returnphp truephp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Returnsphp thephp defaultphp timephp formatphp forphp php$localephp.
php php php php php php*
php php php php php php*php php@paramphp php stringphp|Zendphp_Localephp php php$localephp php OPTIONALphp Localephp ofphp php$numberphp,php possiblyphp inphp stringphp formphp php(ephp.gphp.php php'dephp_ATphp'php)
php php php php php php*php php@returnphp stringphp php format
php php php php php php*php/
php php php php publicphp staticphp functionphp getTimeFormatphp(php$localephp php=php nullphp)
php php php php php{
php php php php php php php php php$formatphp php=php Zendphp_Localephp_Dataphp:php:getContentphp(php$localephp,php php'timephp'php)php;
php php php php php php php php ifphp php(emptyphp(php$formatphp)php)php php{
php php php php php php php php php php php php requirephp_oncephp php'Zendphp/Localephp/Exceptionphp.phpphp'php;
php php php php php php php php php php php php throwphp newphp Zendphp_Localephp_Exceptionphp(php"failedphp tophp receivephp dataphp fromphp localephp php$localephp"php)php;
php php php php php php php php php}
php php php php php php php php returnphp php$formatphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Returnsphp anphp arrayphp withphp php'hourphp'php,php php'minutephp'php,php andphp php'secondphp'php elementsphp extractedphp fromphp php$time
php php php php php php*php accordingphp tophp thephp orderphp describedphp inphp php$formatphp.php php Forphp aphp formatphp ofphp php'Hphp:mphp:sphp'php,php and
php php php php php php*php anphp inputphp ofphp php1php1php:php2php0php:php5php5php,php getTimephp(php)php wouldphp returnphp:
php php php php php php*php arrayphp php(php'hourphp'php php=php>php php1php1php,php php'minutephp'php php=php>php php2php0php,php php'secondphp'php php=php>php php5php5php)
php php php php php php*php Thephp optionalphp php$localephp parameterphp mayphp bephp usedphp tophp helpphp extractphp timesphp fromphp strings
php php php php php php*php containingphp bothphp aphp timephp andphp aphp dayphp orphp monthphp namephp.
php php php php php php*
php php php php php php*php php@paramphp php php stringphp php php$timephp php php php php Timephp string
php php php php php php*php php@paramphp php php arrayphp php php php$optionsphp php Optionsphp:php formatphp_typephp,php fixphp_datephp,php localephp,php datephp_formatphp.php Seephp php{php@linkphp setOptionsphp(php)php}php forphp detailsphp.
php php php php php php*php php@returnphp php arrayphp php php php php php php php php php php php php Possiblephp arrayphp membersphp:php dayphp,php monthphp,php yearphp,php hourphp,php minutephp,php secondphp,php fixedphp,php format
php php php php php php*php/
php php php php publicphp staticphp functionphp getTimephp(php$timephp,php arrayphp php$optionsphp php=php arrayphp(php)php)
php php php php php{
php php php php php php php php php$optionsphp php=php selfphp:php:php_checkOptionsphp(php$optionsphp)php php+php selfphp:php:php$php_optionsphp;
php php php php php php php php ifphp php(emptyphp(php$optionsphp[php'datephp_formatphp'php]php)php)php php{
php php php php php php php php php php php php php$optionsphp[php'formatphp_typephp'php]php php=php php'isophp'php;
php php php php php php php php php php php php php$optionsphp[php'datephp_formatphp'php]php php=php selfphp:php:getTimeFormatphp(php$optionsphp[php'localephp'php]php)php;
php php php php php php php php php}
php php php php php php php php returnphp selfphp:php:php_parseDatephp(php$timephp,php php$optionsphp)php;
php php php php php}

php php php php php/php*php*
php php php php php php*php Returnsphp thephp defaultphp datetimephp formatphp forphp php$localephp.
php php php php php php*
php php php php php php*php php@paramphp php stringphp|Zendphp_Localephp php php$localephp php OPTIONALphp Localephp ofphp php$numberphp,php possiblyphp inphp stringphp formphp php(ephp.gphp.php php'dephp_ATphp'php)
php php php php php php*php php@returnphp stringphp php format
php php php php php php*php/
php php php php publicphp staticphp functionphp getDateTimeFormatphp(php$localephp php=php nullphp)
php php php php php{
php php php php php php php php php$formatphp php=php Zendphp_Localephp_Dataphp:php:getContentphp(php$localephp,php php'datetimephp'php)php;
php php php php php php php php ifphp php(emptyphp(php$formatphp)php)php php{
php php php php php php php php php php php php requirephp_oncephp php'Zendphp/Localephp/Exceptionphp.phpphp'php;
php php php php php php php php php php php php throwphp newphp Zendphp_Localephp_Exceptionphp(php"failedphp tophp receivephp dataphp fromphp localephp php$localephp"php)php;
php php php php php php php php php}
php php php php php php php php returnphp php$formatphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Returnsphp anphp arrayphp withphp php'yearphp'php,php php'monthphp'php,php php'dayphp'php,php php'hourphp'php,php php'minutephp'php,php andphp php'secondphp'php elements
php php php php php php*php extractedphp fromphp php$datetimephp accordingphp tophp thephp orderphp describedphp inphp php$formatphp.php php Forphp aphp formatphp ofphp php'dphp.Mphp.yphp Hphp:mphp:sphp'php,
php php php php php php*php andphp anphp inputphp ofphp php1php0php.php0php5php.php1php9php8php5php php1php1php:php2php0php:php5php5php,php getDateTimephp(php)php wouldphp returnphp:
php php php php php php*php arrayphp php(php'yearphp'php php=php>php php1php9php8php5php,php php'monthphp'php php=php>php php5php,php php'dayphp'php php=php>php php1php0php,php php'hourphp'php php=php>php php1php1php,php php'minutephp'php php=php>php php2php0php,php php'secondphp'php php=php>php php5php5php)
php php php php php php*php Thephp optionalphp php$localephp parameterphp mayphp bephp usedphp tophp helpphp extractphp timesphp fromphp strings
php php php php php php*php containingphp bothphp aphp timephp andphp aphp dayphp orphp monthphp namephp.
php php php php php php*
php php php php php php*php php@paramphp php php stringphp php php$datetimephp DateTimephp string
php php php php php php*php php@paramphp php php arrayphp php php php$optionsphp php Optionsphp:php formatphp_typephp,php fixphp_datephp,php localephp,php datephp_formatphp.php Seephp php{php@linkphp setOptionsphp(php)php}php forphp detailsphp.
php php php php php php*php php@returnphp php arrayphp php php php php php php php php php php php php Possiblephp arrayphp membersphp:php dayphp,php monthphp,php yearphp,php hourphp,php minutephp,php secondphp,php fixedphp,php format
php php php php php php*php/
php php php php publicphp staticphp functionphp getDateTimephp(php$datetimephp,php arrayphp php$optionsphp php=php arrayphp(php)php)
php php php php php{
php php php php php php php php php$optionsphp php=php selfphp:php:php_checkOptionsphp(php$optionsphp)php php+php selfphp:php:php$php_optionsphp;
php php php php php php php php ifphp php(emptyphp(php$optionsphp[php'datephp_formatphp'php]php)php)php php{
php php php php php php php php php php php php php$optionsphp[php'formatphp_typephp'php]php php=php php'isophp'php;
php php php php php php php php php php php php php$optionsphp[php'datephp_formatphp'php]php php=php selfphp:php:getDateTimeFormatphp(php$optionsphp[php'localephp'php]php)php;
php php php php php php php php php}
php php php php php php php php returnphp selfphp:php:php_parseDatephp(php$datetimephp,php php$optionsphp)php;
php php php php php}

php php php php php/php*php*
php php php php php php*php Internalphp methodphp tophp detectphp ofphp Unicodephp supportsphp UTFphp8
php php php php php php*php whichphp shouldphp bephp enabledphp withinphp vanillaphp phpphp installations
php php php php php php*
php php php php php php*php php@returnphp boolean
php php php php php php*php/
php php php php protectedphp staticphp functionphp php_getUniCodeSupportphp(php)
php php php php php{
php php php php php php php php returnphp php(php@pregphp_matchphp(php'php/php\pLphp/uphp'php,php php'aphp'php)php)php php?php truephp php:php falsephp;
php php php php php}
php}
