<php?php
php/php*php*
php php*php Zendphp Framework
php php*
php php*php LICENSE
php php*
php php*php Thisphp sourcephp filephp isphp subjectphp tophp thephp newphp BSDphp licensephp thatphp isphp bundled
php php*php withphp thisphp packagephp inphp thephp filephp LICENSEphp.txtphp.
php php*php Itphp isphp alsophp availablephp throughphp thephp worldphp-widephp-webphp atphp thisphp URLphp:
php php*php httpphp:php/php/frameworkphp.zendphp.comphp/licensephp/newphp-bsd
php php*php Ifphp youphp didphp notphp receivephp aphp copyphp ofphp thephp licensephp andphp arephp unablephp to
php php*php obtainphp itphp throughphp thephp worldphp-widephp-webphp,php pleasephp sendphp anphp email
php php*php tophp licensephp@zendphp.comphp sophp wephp canphp sendphp youphp aphp copyphp immediatelyphp.
php php*
php php*php php@categoryphp php php Zend
php php*php php@packagephp php php php Zendphp_View
php php*php php@subpackagephp Helper
php php*php php@copyrightphp php Copyrightphp php(cphp)php php2php0php0php5php-php2php0php0php9php Zendphp Technologiesphp USAphp Incphp.php php(httpphp:php/php/wwwphp.zendphp.comphp)
php php*php php@versionphp php php php php$Idphp:php Doctypephp.phpphp php1php6php9php7php1php php2php0php0php9php-php0php7php-php2php2php php1php8php:php0php5php:php4php5Zphp mikaelkaelphp php$
php php*php php@licensephp php php php httpphp:php/php/frameworkphp.zendphp.comphp/licensephp/newphp-bsdphp php php php php Newphp BSDphp License
php php*php/

php/php*php*php Zendphp_Viewphp_Helperphp_HtmlElementphp php*php/
requirephp_oncephp php'Zendphp/Viewphp/Helperphp/HtmlElementphp.phpphp'php;

php/php*php*
php php*php Helperphp forphp retrievingphp avatarsphp fromphp gravatarphp.com
php php*
php php*php php@packagephp php php php Zendphp_View
php php*php php@subpackagephp Helper
php php*php php@copyrightphp php Copyrightphp php(cphp)php php2php0php0php5php-php2php0php0php9php Zendphp Technologiesphp USAphp Incphp.php php(httpphp:php/php/wwwphp.zendphp.comphp)
php php*php php@licensephp php php php httpphp:php/php/frameworkphp.zendphp.comphp/licensephp/newphp-bsdphp php php php php Newphp BSDphp License
php php*php php@linkphp httpphp:php/php/plphp.gravatarphp.comphp/sitephp/implementphp/url
php php*php/
classphp Zendphp_Viewphp_Helperphp_Gravatarphp extendsphp Zendphp_Viewphp_Helperphp_HtmlElement
php{

php php php php php/php*php*
php php php php php php*php URLphp tophp gravatarphp service
php php php php php php*php/
php php php php constphp GRAVATARphp_URLphp php=php php'httpphp:php/php/wwwphp.gravatarphp.comphp/avatarphp'php;
php php php php php/php*php*
php php php php php php*php Securephp URLphp tophp gravatarphp service
php php php php php php*php/
php php php php constphp GRAVATARphp_URLphp_SECUREphp php=php php'httpsphp:php/php/securephp.gravatarphp.comphp/avatarphp'php;

php php php php php/php*php*
php php php php php php*php Gravatarphp rating
php php php php php php*php/
php php php php constphp RATINGphp_Gphp php php=php php'gphp'php;
php php php php constphp RATINGphp_PGphp php=php php'pgphp'php;
php php php php constphp RATINGphp_Rphp php php=php php'rphp'php;
php php php php constphp RATINGphp_Xphp php php=php php'xphp'php;

php php php php php/php*php*
php php php php php php*php Defaultphp gravatarphp imagephp valuephp constants
php php php php php php*php/
php php php php constphp DEFAULTphp_php4php0php4php php php php php php php php=php php'php4php0php4php'php;
php php php php constphp DEFAULTphp_MMphp php php php php php php php php=php php'mmphp'php;
php php php php constphp DEFAULTphp_IDENTICONphp php=php php'identiconphp'php;
php php php php constphp DEFAULTphp_MONSTERIDphp php=php php'monsteridphp'php;
php php php php constphp DEFAULTphp_WAVATARphp php php php=php php'wavatarphp'php;

php php php php php/php*php*
php php php php php php*php Options
php php php php php php*
php php php php php php*php php@varphp array
php php php php php php*php/
php php php php protectedphp php$php_optionsphp php=php arrayphp(
php php php php php php php php php'imgphp_sizephp'php php php php php=php>php php8php0php,
php php php php php php php php php'defaultphp_imgphp'php php=php>php selfphp:php:DEFAULTphp_MMphp,
php php php php php php php php php'ratingphp'php php php php php php php=php>php selfphp:php:RATINGphp_Gphp,
php php php php php php php php php'securephp'php php php php php php php=php>php nullphp,
php php php php php)php;

php php php php php/php*php*
php php php php php php*php Emailphp Adress
php php php php php php*
php php php php php php*php php@varphp string
php php php php php php*php/
php php php php protectedphp php$php_emailphp;

php php php php php/php*php*
php php php php php php*php Attributesphp forphp HTMLphp imagephp tag
php php php php php php*
php php php php php php*php php@varphp array
php php php php php php*php/
php php php php protectedphp php$php_attribsphp;

php php php php php/php*php*
php php php php php php*php Returnsphp anphp avatarphp fromphp gravatarphp'sphp servicephp.
php php php php php php*
php php php php php php*php php$optionsphp mayphp includephp thephp followingphp:
php php php php php php*php php-php php'imgphp_sizephp'php intphp heightphp ofphp imgphp tophp return
php php php php php php*php php-php php'defaultphp_imgphp'php stringphp imgphp tophp returnphp ifphp emailphp adressphp hasphp notphp found
php php php php php php*php php-php php'ratingphp'php stringphp ratingphp parameterphp forphp avatar
php php php php php php*php php-php php'securephp'php boolphp loadphp fromphp thephp SSLphp orphp Nonphp-SSLphp location
php php php php php php*
php php php php php php*php php@seephp php php php httpphp:php/php/plphp.gravatarphp.comphp/sitephp/implementphp/url
php php php php php php*php php@seephp php php php httpphp:php/php/plphp.gravatarphp.comphp/sitephp/implementphp/urlphp Morephp informationphp aboutphp gravatarphp'sphp servicephp.
php php php php php php*php php@paramphp php stringphp|nullphp php$emailphp Emailphp adressphp.
php php php php php php*php php@paramphp php nullphp|arrayphp php$optionsphp Options
php php php php php php*php php@paramphp php arrayphp php$attribsphp Attributesphp forphp imagephp tagphp php(titlephp,php altphp etcphp.php)
php php php php php php*php php@returnphp Zendphp_Viewphp_Helperphp_Gravatar
php php php php php php*php/
php php php php publicphp functionphp gravatarphp(php$emailphp php=php php"php"php,php php$optionsphp php=php arrayphp(php)php,php php$attribsphp php=php arrayphp(php)php)
php php php php php{
php php php php php php php php php$thisphp-php>setEmailphp(php$emailphp)php;
php php php php php php php php php$thisphp-php>setOptionsphp(php$optionsphp)php;
php php php php php php php php php$thisphp-php>setAttribsphp(php$attribsphp)php;
php php php php php php php php returnphp php$thisphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Configurephp state
php php php php php php*
php php php php php php*php php@paramphp php arrayphp php$options
php php php php php php*php php@returnphp Zendphp_Viewphp_Helperphp_Gravatar
php php php php php php*php/
php php php php publicphp functionphp setOptionsphp(arrayphp php$optionsphp)
php php php php php{
php php php php php php php php foreachphp php(php$optionsphp asphp php$keyphp php=php>php php$valuephp)php php{
php php php php php php php php php php php php php$methodphp php=php php'setphp'php php.php strphp_replacephp(php'php php'php,php php'php'php,php ucwordsphp(strphp_replacephp(php'php_php'php,php php'php php'php,php php$keyphp)php)php)php;
php php php php php php php php php php php php ifphp php(methodphp_existsphp(php$thisphp,php php$methodphp)php)php php{
php php php php php php php php php php php php php php php php php$thisphp-php>php{php$methodphp}php(php$valuephp)php;
php php php php php php php php php php php php php}
php php php php php php php php php}
php php php php php php php php returnphp php$thisphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Getphp imgphp size
php php php php php php*
php php php php php php*php php@returnphp intphp Thephp imgphp size
php php php php php php*php/
php php php php publicphp functionphp getImgSizephp(php)
php php php php php{
php php php php php php php php returnphp php$thisphp-php>php_optionsphp[php'imgphp_sizephp'php]php;
php php php php php}

php php php php php/php*php*
php php php php php php*php Setphp imgphp sizephp inphp pixels
php php php php php php*
php php php php php php*php php@paramphp intphp php$imgSizephp Sizephp ofphp imgphp mustphp bephp betweenphp php1php andphp php5php1php2
php php php php php php*php php@returnphp Zendphp_Viewphp_Helperphp_Gravatar
php php php php php php*php/
php php php php publicphp functionphp setImgSizephp(php$imgSizephp)
php php php php php{
php php php php php php php php php$thisphp-php>php_optionsphp[php'imgphp_sizephp'php]php php=php php(intphp)php php$imgSizephp;
php php php php php php php php returnphp php$thisphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Getphp defaultphp img
php php php php php php*
php php php php php php*php php@returnphp string
php php php php php php*php/
php php php php publicphp functionphp getDefaultImgphp(php)
php php php php php{
php php php php php php php php returnphp php$thisphp-php>php_optionsphp[php'defaultphp_imgphp'php]php;
php php php php php}

php php php php php/php*php*
php php php php php php*php Setphp defaultphp img
php php php php php php*
php php php php php php*php Canphp bephp eitherphp anphp absolutephp URLphp tophp anphp imagephp,php orphp onephp ofphp thephp DEFAULTphp_php*php constants
php php php php php php*
php php php php php php*php php@paramphp stringphp php$defaultImg
php php php php php php*php php@linkphp httpphp:php/php/plphp.gravatarphp.comphp/sitephp/implementphp/urlphp Morephp informationphp aboutphp defaultphp imagephp.
php php php php php php*php php@returnphp Zendphp_Viewphp_Helperphp_Gravatar
php php php php php php*php/
php php php php publicphp functionphp setDefaultImgphp(php$defaultImgphp)
php php php php php{
php php php php php php php php php$thisphp-php>php_optionsphp[php'defaultphp_imgphp'php]php php=php urlencodephp(php$defaultImgphp)php;
php php php php php php php php returnphp php$thisphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php php Setphp ratingphp value
php php php php php php*
php php php php php php*php Mustphp bephp onephp ofphp thephp RATINGphp_php*php constants
php php php php php php*
php php php php php php*php php@paramphp stringphp php$ratingphp Valuephp forphp ratingphp.php Allowedphp valuesphp arephp:php gphp,php pxphp,php rphp,x
php php php php php php*php php@linkphp httpphp:php/php/plphp.gravatarphp.comphp/sitephp/implementphp/urlphp Morephp informationphp aboutphp ratingphp.
php php php php php php*php php@throwsphp Zendphp_Viewphp_Exception
php php php php php php*php/
php php php php publicphp functionphp setRatingphp(php$ratingphp)
php php php php php{
php php php php php php php php switchphp php(php$ratingphp)php php{
php php php php php php php php php php php php casephp selfphp:php:RATINGphp_Gphp:
php php php php php php php php php php php php casephp selfphp:php:RATINGphp_PGphp:
php php php php php php php php php php php php casephp selfphp:php:RATINGphp_Rphp:
php php php php php php php php php php php php casephp selfphp:php:RATINGphp_Xphp:
php php php php php php php php php php php php php php php php php$thisphp-php>php_optionsphp[php'ratingphp'php]php php=php php$ratingphp;
php php php php php php php php php php php php php php php php breakphp;
php php php php php php php php php php php php defaultphp:
php php php php php php php php php php php php php php php php requirephp_oncephp php'Zendphp/Viewphp/Exceptionphp.phpphp'php;
php php php php php php php php php php php php php php php php throwphp newphp Zendphp_Viewphp_Exceptionphp(sprintfphp(
php php php php php php php php php php php php php php php php php php php php php'Thephp ratingphp valuephp php"php%sphp"php isphp notphp allowedphp'php,
php php php php php php php php php php php php php php php php php php php php php$rating
php php php php php php php php php php php php php php php php php)php)php;
php php php php php php php php php}
php php php php php php php php returnphp php$thisphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Getphp ratingphp value
php php php php php php*
php php php php php php*php php@returnphp string
php php php php php php*php/
php php php php publicphp functionphp getRatingphp(php)
php php php php php{
php php php php php php php php returnphp php$thisphp-php>php_optionsphp[php'ratingphp'php]php;
php php php php php}

php php php php php/php*php*
php php php php php php*php Setphp emailphp adress
php php php php php php*
php php php php php php*php php@paramphp stringphp php$email
php php php php php php*php php@returnphp Zendphp_Viewphp_Helperphp_Gravatar
php php php php php php*php/
php php php php publicphp functionphp setEmailphp(php php$emailphp php)
php php php php php{
php php php php php php php php php$thisphp-php>php_emailphp php=php php$emailphp;
php php php php php php php php returnphp php$thisphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Getphp emailphp adress
php php php php php php*
php php php php php php*php php@returnphp string
php php php php php php*php/
php php php php publicphp functionphp getEmailphp(php)
php php php php php{
php php php php php php php php returnphp php$thisphp-php>php_emailphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Loadphp fromphp anphp SSLphp orphp Nophp-SSLphp locationphp?
php php php php php php*
php php php php php php*php php@paramphp boolphp php$flag
php php php php php php*php php@returnphp Zendphp_Viewphp_Helperphp_Gravatar
php php php php php php*php/
php php php php publicphp functionphp setSecurephp(php$flagphp)
php php php php php{
php php php php php php php php php$thisphp-php>php_optionsphp[php'securephp'php]php php=php php(php$flagphp php=php=php=php nullphp)php php?php nullphp php:php php(boolphp)php php$flagphp;
php php php php php php php php returnphp php$thisphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Getphp anphp SSLphp orphp aphp Nophp-SSLphp location
php php php php php php*
php php php php php php*php php@returnphp bool
php php php php php php*php/
php php php php publicphp functionphp getSecurephp(php)
php php php php php{
php php php php php php php php ifphp php(php$thisphp-php>php_optionsphp[php'securephp'php]php php=php=php=php nullphp)php php{
php php php php php php php php php php php php returnphp php(issetphp(php$php_SERVERphp[php'HTTPSphp'php]php)php php&php&php php$php_SERVERphp[php'HTTPSphp'php]php php!php=php=php php'offphp'php)php;
php php php php php php php php php}
php php php php php php php php returnphp php$thisphp-php>php_optionsphp[php'securephp'php]php;
php php php php php}

php php php php php/php*php*
php php php php php php*php Getphp attribsphp ofphp image
php php php php php php*
php php php php php php*php Warningphp!
php php php php php php*php Ifphp youphp setphp srcphp attribphp,php youphp getphp itphp,php butphp thisphp valuephp willphp bephp overwrittenphp in
php php php php php php*php protectedphp methodphp php_setSrcAttribForImgphp(php)php.php Andphp finallyphp yourphp getphp otherphp src
php php php php php php*php valuephp!
php php php php php php*
php php php php php php*php php@returnphp array
php php php php php php*php/
php php php php publicphp functionphp getAttribsphp(php)
php php php php php{
php php php php php php php php returnphp php$thisphp-php>php_attribsphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Setphp attribsphp forphp imagephp tag
php php php php php php*
php php php php php php*php Warningphp!php Youphp shouldnphp'tphp setphp srcphp attribphp forphp imagephp tagphp.
php php php php php php*php Thisphp attribphp isphp overwrittenphp inphp protectedphp methodphp php_setSrcAttribForImgphp(php)php.
php php php php php php*php Thisphp methodphp(php_setSrcAttribForImgphp)php isphp calledphp inphp publicphp methodphp getImgTagphp(php)php.

php php php php php php*php php@paramphp arrayphp php$attribs
php php php php php php*php php@returnphp Zendphp_Viewphp_Helperphp_Gravatar
php php php php php php*php/
php php php php publicphp functionphp setAttribsphp(arrayphp php$attribsphp)
php php php php php{
php php php php php php php php php$thisphp-php>php_attribsphp php=php php$attribsphp;
php php php php php php php php returnphp php$thisphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Getphp URLphp tophp gravatarphp'sphp servicephp.
php php php php php php*
php php php php php php*php php@returnphp stringphp URL
php php php php php php*php/
php php php php protectedphp functionphp php_getGravatarUrlphp(php)
php php php php php{
php php php php php php php php returnphp php(php$thisphp-php>getSecurephp(php)php php=php=php=php falsephp)php php?php selfphp:php:GRAVATARphp_URLphp php:php selfphp:php:GRAVATARphp_URLphp_SECUREphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Getphp avatarphp urlphp php(includingphp sizephp,php ratingphp andphp defaultphp imagephp oprionsphp)
php php php php php php*
php php php php php php*php php@returnphp string
php php php php php php*php/
php php php php protectedphp functionphp php_getAvatarUrlphp(php)
php php php php php{
php php php php php php php php php$srcphp php=php php$thisphp-php>php_getGravatarUrlphp(php)
php php php php php php php php php php php php php php.php php'php/php'
php php php php php php php php php php php php php php.php mdphp5php(php$thisphp-php>getEmailphp(php)php)
php php php php php php php php php php php php php php.php php'php?sphp=php'
php php php php php php php php php php php php php php.php php$thisphp-php>getImgSizephp(php)
php php php php php php php php php php php php php php.php php'php&dphp=php'
php php php php php php php php php php php php php php.php php$thisphp-php>getDefaultImgphp(php)
php php php php php php php php php php php php php php.php php'php&rphp=php'
php php php php php php php php php php php php php php.php php$thisphp-php>getRatingphp(php)php;
php php php php php php php php returnphp php$srcphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Setphp srcphp attribphp forphp imagephp.
php php php php php php*
php php php php php php*php Youphp shouldnphp'tphp setphp aphp ownphp urlphp valuephp!
php php php php php php*php Itphp setsphp valuephp,php usesphp protectedphp methodphp php_getAvatarUrlphp.
php php php php php php*
php php php php php php*php Ifphp alreadyphp exsistphp overwrittenphp.
php php php php php php*php/
php php php php protectedphp functionphp php_setSrcAttribForImgphp(php)
php php php php php{
php php php php php php php php php$attribsphp php php php php php php php php=php php$thisphp-php>getAttribsphp(php)php;
php php php php php php php php php$attribsphp[php'srcphp'php]php php=php php$thisphp-php>php_getAvatarUrlphp(php)php;
php php php php php php php php php$thisphp-php>setAttribsphp(php$attribsphp)php;
php php php php php}

php php php php php/php*php*
php php php php php php*php Returnphp validphp imagephp tag
php php php php php php*
php php php php php php*php php@returnphp string
php php php php php php*php/
php php php php publicphp functionphp getImgTagphp(php)
php php php php php{
php php php php php php php php php$thisphp-php>php_setSrcAttribForImgphp(php)php;
php php php php php php php php php$htmlphp php=php php'php<imgphp'
php php php php php php php php php php php php php php php.php php$thisphp-php>php_htmlAttribsphp(php$thisphp-php>getAttribsphp(php)php)
php php php php php php php php php php php php php php php.php php$thisphp-php>getClosingBracketphp(php)php;

php php php php php php php php returnphp php$htmlphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Returnphp validphp imagephp tag
php php php php php php*
php php php php php php*php php@returnphp string
php php php php php php*php/
php php php php publicphp functionphp php php_php_toStringphp(php)
php php php php php{
php php php php php php php php returnphp php$thisphp-php>getImgTagphp(php)php;

php php php php php}
php}
