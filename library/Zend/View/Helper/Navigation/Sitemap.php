<php?php
php/php*php*
php php*php Zendphp Framework
php php*
php php*php LICENSE
php php*
php php*php Thisphp sourcephp filephp isphp subjectphp tophp thephp newphp BSDphp licensephp thatphp isphp bundled
php php*php withphp thisphp packagephp inphp thephp filephp LICENSEphp.txtphp.
php php*php Itphp isphp alsophp availablephp throughphp thephp worldphp-widephp-webphp atphp thisphp URLphp:
php php*php httpphp:php/php/frameworkphp.zendphp.comphp/licensephp/newphp-bsd
php php*php Ifphp youphp didphp notphp receivephp aphp copyphp ofphp thephp licensephp andphp arephp unablephp to
php php*php obtainphp itphp throughphp thephp worldphp-widephp-webphp,php pleasephp sendphp anphp email
php php*php tophp licensephp@zendphp.comphp sophp wephp canphp sendphp youphp aphp copyphp immediatelyphp.
php php*
php php*php php@categoryphp php php Zend
php php*php php@packagephp php php php Zendphp_View
php php*php php@subpackagephp Helper
php php*php php@copyrightphp php Copyrightphp php(cphp)php php2php0php0php5php-php2php0php1php0php Zendphp Technologiesphp USAphp Incphp.php php(httpphp:php/php/wwwphp.zendphp.comphp)
php php*php php@licensephp php php php httpphp:php/php/frameworkphp.zendphp.comphp/licensephp/newphp-bsdphp php php php php Newphp BSDphp License
php php*php php@versionphp php php php php$Idphp:php Sitemapphp.phpphp php2php0php1php0php4php php2php0php1php0php-php0php1php-php0php6php php2php1php:php2php6php:php0php1Zphp matthewphp php$
php php*php/

php/php*php*
php php*php php@seephp Zendphp_Viewphp_Helperphp_Navigationphp_HelperAbstract
php php*php/
requirephp_oncephp php'Zendphp/Viewphp/Helperphp/Navigationphp/HelperAbstractphp.phpphp'php;

php/php*php*
php php*php Helperphp forphp printingphp sitemaps
php php*
php php*php php@linkphp httpphp:php/php/wwwphp.sitemapsphp.orgphp/protocolphp.php
php php*
php php*php php@categoryphp php php Zend
php php*php php@packagephp php php php Zendphp_View
php php*php php@subpackagephp Helper
php php*php php@copyrightphp php Copyrightphp php(cphp)php php2php0php0php5php-php2php0php1php0php Zendphp Technologiesphp USAphp Incphp.php php(httpphp:php/php/wwwphp.zendphp.comphp)
php php*php php@licensephp php php php httpphp:php/php/frameworkphp.zendphp.comphp/licensephp/newphp-bsdphp php php php php Newphp BSDphp License
php php*php/
classphp Zendphp_Viewphp_Helperphp_Navigationphp_Sitemap
php php php php extendsphp Zendphp_Viewphp_Helperphp_Navigationphp_HelperAbstract
php{
php php php php php/php*php*
php php php php php php*php Namespacephp forphp thephp php<urlsetphp>php tag
php php php php php php*
php php php php php php*php php@varphp string
php php php php php php*php/
php php php php constphp SITEMAPphp_NSphp php=php php'httpphp:php/php/wwwphp.sitemapsphp.orgphp/schemasphp/sitemapphp/php0php.php9php'php;

php php php php php/php*php*
php php php php php php*php Schemaphp URL
php php php php php php*
php php php php php php*php php@varphp string
php php php php php php*php/
php php php php constphp SITEMAPphp_XSDphp php=php php'httpphp:php/php/wwwphp.sitemapsphp.orgphp/schemasphp/sitemapphp/php0php.php9php/sitemapphp.xsdphp'php;

php php php php php/php*php*
php php php php php php*php Whetherphp XMLphp outputphp shouldphp bephp formatted
php php php php php php*
php php php php php php*php php@varphp bool
php php php php php php*php/
php php php php protectedphp php$php_formatOutputphp php=php falsephp;

php php php php php/php*php*
php php php php php php*php Whetherphp thephp XMLphp declarationphp shouldphp bephp includedphp inphp XMLphp output
php php php php php php*
php php php php php php*php php@varphp bool
php php php php php php*php/
php php php php protectedphp php$php_useXmlDeclarationphp php=php truephp;

php php php php php/php*php*
php php php php php php*php Whetherphp sitemapphp shouldphp bephp validatedphp usingphp Zendphp_Validatephp_Sitemapphp_php*
php php php php php php*
php php php php php php*php php@varphp bool
php php php php php php*php/
php php php php protectedphp php$php_useSitemapValidatorsphp php=php truephp;

php php php php php/php*php*
php php php php php php*php Whetherphp sitemapphp shouldphp bephp schemaphp validatedphp whenphp generated
php php php php php php*
php php php php php php*php php@varphp bool
php php php php php php*php/
php php php php protectedphp php$php_useSchemaValidationphp php=php falsephp;

php php php php php/php*php*
php php php php php php*php Serverphp url
php php php php php php*
php php php php php php*php php@varphp string
php php php php php php*php/
php php php php protectedphp php$php_serverUrlphp;

php php php php php/php*php*
php php php php php php*php Viewphp helperphp entryphp pointphp:
php php php php php php*php Retrievesphp helperphp andphp optionallyphp setsphp containerphp tophp operatephp on
php php php php php php*
php php php php php php*php php@paramphp php Zendphp_Navigationphp_Containerphp php$containerphp php php[optionalphp]php containerphp to
php php php php php php*php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php operatephp on
php php php php php php*php php@returnphp Zendphp_Viewphp_Helperphp_Navigationphp_Sitemapphp php php fluentphp interfacephp,php returns
php php php php php php*php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php self
php php php php php php*php/
php php php php publicphp functionphp sitemapphp(Zendphp_Navigationphp_Containerphp php$containerphp php=php nullphp)
php php php php php{
php php php php php php php php ifphp php(nullphp php!php=php=php php$containerphp)php php{
php php php php php php php php php php php php php$thisphp-php>setContainerphp(php$containerphp)php;
php php php php php php php php php}

php php php php php php php php returnphp php$thisphp;
php php php php php}

php php php php php/php/php Accessorsphp:

php php php php php/php*php*
php php php php php php*php Setsphp whetherphp XMLphp outputphp shouldphp bephp formatted
php php php php php php*
php php php php php php*php php@paramphp php boolphp php$formatOutputphp php php php php php php php php php php php php php php php php php php php[optionalphp]php whetherphp output
php php php php php php*php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php shouldphp bephp formattedphp.php Default
php php php php php php*php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php isphp truephp.
php php php php php php*php php@returnphp Zendphp_Viewphp_Helperphp_Navigationphp_Sitemapphp php fluentphp interfacephp,php returns
php php php php php php*php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php self
php php php php php php*php/
php php php php publicphp functionphp setFormatOutputphp(php$formatOutputphp php=php truephp)
php php php php php{
php php php php php php php php php$thisphp-php>php_formatOutputphp php=php php(boolphp)php php$formatOutputphp;
php php php php php php php php returnphp php$thisphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Returnsphp whetherphp XMLphp outputphp shouldphp bephp formatted
php php php php php php*
php php php php php php*php php@returnphp boolphp php whetherphp XMLphp outputphp shouldphp bephp formatted
php php php php php php*php/
php php php php publicphp functionphp getFormatOutputphp(php)
php php php php php{
php php php php php php php php returnphp php$thisphp-php>php_formatOutputphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Setsphp whetherphp thephp XMLphp declarationphp shouldphp bephp usedphp inphp output
php php php php php php*
php php php php php php*php php@paramphp php boolphp php$useXmlDeclphp php php php php php php php php php php php php php php php php php php php php whetherphp XMLphp delcaration
php php php php php php*php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php shouldphp bephp rendered
php php php php php php*php php@returnphp Zendphp_Viewphp_Helperphp_Navigationphp_Sitemapphp php fluentphp interfacephp,php returns
php php php php php php*php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php self
php php php php php php*php/
php php php php publicphp functionphp setUseXmlDeclarationphp(php$useXmlDeclphp)
php php php php php{
php php php php php php php php php$thisphp-php>php_useXmlDeclarationphp php=php php(boolphp)php php$useXmlDeclphp;
php php php php php php php php returnphp php$thisphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Returnsphp whetherphp thephp XMLphp declarationphp shouldphp bephp usedphp inphp output
php php php php php php*
php php php php php php*php php@returnphp boolphp php whetherphp thephp XMLphp declarationphp shouldphp bephp usedphp inphp output
php php php php php php*php/
php php php php publicphp functionphp getUseXmlDeclarationphp(php)
php php php php php{
php php php php php php php php returnphp php$thisphp-php>php_useXmlDeclarationphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Setsphp whetherphp sitemapphp shouldphp bephp validatedphp usingphp Zendphp_Validatephp_Sitemapphp_php*
php php php php php php*
php php php php php php*php php@paramphp php boolphp php$useSitemapValidatorsphp php php php php php php php php php php whetherphp sitemapphp validators
php php php php php php*php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php shouldphp bephp used
php php php php php php*php php@returnphp Zendphp_Viewphp_Helperphp_Navigationphp_Sitemapphp php fluentphp interfacephp,php returns
php php php php php php*php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php self
php php php php php php*php/
php php php php publicphp functionphp setUseSitemapValidatorsphp(php$useSitemapValidatorsphp)
php php php php php{
php php php php php php php php php$thisphp-php>php_useSitemapValidatorsphp php=php php(boolphp)php php$useSitemapValidatorsphp;
php php php php php php php php returnphp php$thisphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Returnsphp whetherphp sitemapphp shouldphp bephp validatedphp usingphp Zendphp_Validatephp_Sitemapphp_php*
php php php php php php*
php php php php php php*php php@returnphp boolphp php whetherphp sitemapphp shouldphp bephp validatedphp usingphp validators
php php php php php php*php/
php php php php publicphp functionphp getUseSitemapValidatorsphp(php)
php php php php php{
php php php php php php php php returnphp php$thisphp-php>php_useSitemapValidatorsphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Setsphp whetherphp sitemapphp shouldphp bephp schemaphp validatedphp whenphp generated
php php php php php php*
php php php php php php*php php@paramphp php boolphp php$schemaValidationphp php php php php php php php php php php php php php php whetherphp sitemapphp should
php php php php php php*php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php validatedphp usingphp XSDphp Schema
php php php php php php*php php@returnphp Zendphp_Viewphp_Helperphp_Navigationphp_Sitemapphp php fluentphp interfacephp,php returns
php php php php php php*php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php self
php php php php php php*php/
php php php php publicphp functionphp setUseSchemaValidationphp(php$schemaValidationphp)
php php php php php{
php php php php php php php php php$thisphp-php>php_useSchemaValidationphp php=php php(boolphp)php php$schemaValidationphp;
php php php php php php php php returnphp php$thisphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Returnsphp truephp ifphp sitemapphp shouldphp bephp schemaphp validatedphp whenphp generated
php php php php php php*
php php php php php php*php php@returnphp bool
php php php php php php*php/
php php php php publicphp functionphp getUseSchemaValidationphp(php)
php php php php php{
php php php php php php php php returnphp php$thisphp-php>php_useSchemaValidationphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Setsphp serverphp urlphp php(schemephp andphp hostphp-relatedphp stuffphp withoutphp requestphp URIphp)
php php php php php php*
php php php php php php*php Ephp.gphp.php httpphp:php/php/wwwphp.examplephp.com
php php php php php php*
php php php php php php*php php@paramphp php stringphp php$serverUrlphp php php php php php php php php php php php php php php php php php php php serverphp URLphp tophp setphp php(only
php php php php php php*php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php schemephp andphp hostphp)
php php php php php php*php php@throwsphp Zendphp_Uriphp_Exceptionphp php php php php php php php php php php php php php php php php php php ifphp invalidphp serverphp URL
php php php php php php*php php@returnphp Zendphp_Viewphp_Helperphp_Navigationphp_Sitemapphp php fluentphp interfacephp,php returns
php php php php php php*php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php self
php php php php php php*php/
php php php php publicphp functionphp setServerUrlphp(php$serverUrlphp)
php php php php php{
php php php php php php php php requirephp_oncephp php'Zendphp/Uriphp.phpphp'php;
php php php php php php php php php$uriphp php=php Zendphp_Uriphp:php:factoryphp(php$serverUrlphp)php;
php php php php php php php php php$uriphp-php>setFragmentphp(php'php'php)php;
php php php php php php php php php$uriphp-php>setPathphp(php'php'php)php;
php php php php php php php php php$uriphp-php>setQueryphp(php'php'php)php;

php php php php php php php php ifphp php(php$uriphp-php>validphp(php)php)php php{
php php php php php php php php php php php php php$thisphp-php>php_serverUrlphp php=php php$uriphp-php>getUriphp(php)php;
php php php php php php php php php}php elsephp php{
php php php php php php php php php php php php requirephp_oncephp php'Zendphp/Uriphp/Exceptionphp.phpphp'php;
php php php php php php php php php php php php php$ephp php=php newphp Zendphp_Uriphp_Exceptionphp(sprintfphp(
php php php php php php php php php php php php php php php php php php php php php'Invalidphp serverphp URLphp:php php"php%sphp"php'php,
php php php php php php php php php php php php php php php php php php php php php$serverUrlphp)php)php;
php php php php php php php php php php php php php$ephp-php>setViewphp(php$thisphp-php>viewphp)php;
php php php php php php php php php php php php throwphp php$ephp;
php php php php php php php php php}

php php php php php php php php returnphp php$thisphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Returnsphp serverphp URL
php php php php php php*
php php php php php php*php php@returnphp stringphp php serverphp URL
php php php php php php*php/
php php php php publicphp functionphp getServerUrlphp(php)
php php php php php{
php php php php php php php php ifphp php(php!issetphp(php$thisphp-php>php_serverUrlphp)php)php php{
php php php php php php php php php php php php php$thisphp-php>php_serverUrlphp php=php php$thisphp-php>viewphp-php>serverUrlphp(php)php;
php php php php php php php php php}

php php php php php php php php returnphp php$thisphp-php>php_serverUrlphp;
php php php php php}

php php php php php/php/php Helperphp methodsphp:

php php php php php/php*php*
php php php php php php*php Escapesphp stringphp forphp XMLphp usage
php php php php php php*
php php php php php php*php php@paramphp php stringphp php$stringphp php stringphp tophp escape
php php php php php php*php php@returnphp stringphp php php php php php php php php php escapedphp string
php php php php php php*php/
php php php php protectedphp functionphp php_xmlEscapephp(php$stringphp)
php php php php php{
php php php php php php php php php$encphp php=php php'UTFphp-php8php'php;
php php php php php php php php ifphp php(php$thisphp-php>viewphp instanceofphp Zendphp_Viewphp_Interface
php php php php php php php php php php php php php&php&php methodphp_existsphp(php$thisphp-php>viewphp,php php'getEncodingphp'php)
php php php php php php php php php)php php{
php php php php php php php php php php php php php$encphp php=php php$thisphp-php>viewphp-php>getEncodingphp(php)php;
php php php php php php php php php}

php php php php php php php php php/php/php TODOphp:php removephp checkphp whenphp minimumphp PHPphp versionphp isphp php>php=php php5php.php2php.php3
php php php php php php php php ifphp php(versionphp_comparephp(PHPphp_VERSIONphp,php php'php5php.php2php.php3php'php,php php'php>php=php'php)php)php php{
php php php php php php php php php php php php php/php/php dophp notphp encodephp existingphp HTMLphp entities
php php php php php php php php php php php php returnphp htmlspecialcharsphp(php$stringphp,php ENTphp_QUOTESphp,php php$encphp,php falsephp)php;
php php php php php php php php php}php elsephp php{
php php php php php php php php php php php php php$stringphp php=php pregphp_replacephp(php'php/php&php(php?php!php(php?php:php#php\dphp+php+php|php[aphp-zphp]php+php+php)php;php)php/uiphp'php,php php'php&ampphp;php'php,php php$stringphp)php;
php php php php php php php php php php php php php$stringphp php=php strphp_replacephp(arrayphp(php'<php'php,php php'php>php'php,php php'php\php'php'php,php php'php"php'php)php,php arrayphp(php'php&ltphp;php'php,php php'php&gtphp;php'php,php php'php&php#php3php9php;php'php,php php'php&quotphp;php'php)php,php php$stringphp)php;
php php php php php php php php php php php php returnphp php$stringphp;
php php php php php php php php php}
php php php php php}

php php php php php/php/php Publicphp methodsphp:

php php php php php/php*php*
php php php php php php*php Returnsphp anphp escapedphp absolutephp URLphp forphp thephp givenphp page
php php php php php php*
php php php php php php*php php@paramphp php Zendphp_Navigationphp_Pagephp php$pagephp php pagephp tophp getphp URLphp from
php php php php php php*php php@returnphp string
php php php php php php*php/
php php php php publicphp functionphp urlphp(Zendphp_Navigationphp_Pagephp php$pagephp)
php php php php php{
php php php php php php php php php$hrefphp php=php php$pagephp-php>getHrefphp(php)php;

php php php php php php php php ifphp php(php!issetphp(php$hrefphp{php0php}php)php)php php{
php php php php php php php php php php php php php/php/php nophp href
php php php php php php php php php php php php returnphp php'php'php;
php php php php php php php php php}php elseifphp php(php$hrefphp{php0php}php php=php=php php'php/php'php)php php{
php php php php php php php php php php php php php/php/php hrefphp isphp relativephp tophp rootphp;php usephp serverUrlphp helper
php php php php php php php php php php php php php$urlphp php=php php$thisphp-php>getServerUrlphp(php)php php.php php$hrefphp;
php php php php php php php php php}php elseifphp php(pregphp_matchphp(php'php/php^php[aphp-zphp]php+php:php/imphp'php,php php(stringphp)php php$hrefphp)php)php php{
php php php php php php php php php php php php php/php/php schemephp isphp givenphp inphp hrefphp;php assumephp absolutephp URLphp already
php php php php php php php php php php php php php$urlphp php=php php(stringphp)php php$hrefphp;
php php php php php php php php php}php elsephp php{
php php php php php php php php php php php php php/php/php hrefphp isphp relativephp tophp currentphp documentphp;php usephp urlphp helpers
php php php php php php php php php php php php php$urlphp php=php php$thisphp-php>getServerUrlphp(php)
php php php php php php php php php php php php php php php php php php.php rtrimphp(php$thisphp-php>viewphp-php>urlphp(php)php,php php'php/php'php)php php.php php'php/php'
php php php php php php php php php php php php php php php php php php.php php$hrefphp;
php php php php php php php php php}

php php php php php php php php returnphp php$thisphp-php>php_xmlEscapephp(php$urlphp)php;
php php php php php}

php php php php php/php*php*
php php php php php php*php Returnsphp aphp DOMDocumentphp containingphp thephp Sitemapphp XMLphp forphp thephp givenphp container
php php php php php php*
php php php php php php*php php@paramphp php Zendphp_Navigationphp_Containerphp php$containerphp php php[optionalphp]php containerphp tophp get
php php php php php php*php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php breadcrumbsphp fromphp,php defaults
php php php php php php*php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php tophp whatphp isphp registeredphp inphp the
php php php php php php*php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php helper
php php php php php php*php php@returnphp DOMDocumentphp php php php php php php php php php php php php php php php php php php php php php php php php php php DOMphp representationphp ofphp the
php php php php php php*php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php container
php php php php php php*php php@throwsphp Zendphp_Viewphp_Exceptionphp php php php php php php php php php php php php php php php php php php ifphp schemaphp validationphp isphp on
php php php php php php*php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php andphp thephp sitemapphp isphp invalid
php php php php php php*php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php accordingphp tophp thephp sitemap
php php php php php php*php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php schemaphp,php orphp ifphp sitemap
php php php php php php*php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php validatorsphp arephp usedphp andphp the
php php php php php php*php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php locphp elementphp failsphp validation
php php php php php php*php/
php php php php publicphp functionphp getDomSitemapphp(Zendphp_Navigationphp_Containerphp php$containerphp php=php nullphp)
php php php php php{
php php php php php php php php ifphp php(nullphp php=php=php=php php$containerphp)php php{
php php php php php php php php php php php php php$containerphp php=php php$thisphp-php>getContainerphp(php)php;
php php php php php php php php php}

php php php php php php php php php/php/php checkphp ifphp wephp shouldphp validatephp usingphp ourphp ownphp validators
php php php php php php php php ifphp php(php$thisphp-php>getUseSitemapValidatorsphp(php)php)php php{
php php php php php php php php php php php php requirephp_oncephp php'Zendphp/Validatephp/Sitemapphp/Changefreqphp.phpphp'php;
php php php php php php php php php php php php requirephp_oncephp php'Zendphp/Validatephp/Sitemapphp/Lastmodphp.phpphp'php;
php php php php php php php php php php php php requirephp_oncephp php'Zendphp/Validatephp/Sitemapphp/Locphp.phpphp'php;
php php php php php php php php php php php php requirephp_oncephp php'Zendphp/Validatephp/Sitemapphp/Priorityphp.phpphp'php;

php php php php php php php php php php php php php/php/php createphp validators
php php php php php php php php php php php php php$locValidatorphp php php php php php php php php=php newphp Zendphp_Validatephp_Sitemapphp_Locphp(php)php;
php php php php php php php php php php php php php$lastmodValidatorphp php php php php=php newphp Zendphp_Validatephp_Sitemapphp_Lastmodphp(php)php;
php php php php php php php php php php php php php$changefreqValidatorphp php=php newphp Zendphp_Validatephp_Sitemapphp_Changefreqphp(php)php;
php php php php php php php php php php php php php$priorityValidatorphp php php php=php newphp Zendphp_Validatephp_Sitemapphp_Priorityphp(php)php;
php php php php php php php php php}

php php php php php php php php php/php/php createphp document
php php php php php php php php php$domphp php=php newphp DOMDocumentphp(php'php1php.php0php'php,php php'UTFphp-php8php'php)php;
php php php php php php php php php$domphp-php>formatOutputphp php=php php$thisphp-php>getFormatOutputphp(php)php;

php php php php php php php php php/php/php php.php.php.andphp urlsetphp php(rootphp)php element
php php php php php php php php php$urlSetphp php=php php$domphp-php>createElementNSphp(selfphp:php:SITEMAPphp_NSphp,php php'urlsetphp'php)php;
php php php php php php php php php$domphp-php>appendChildphp(php$urlSetphp)php;

php php php php php php php php php/php/php createphp iterator
php php php php php php php php php$iteratorphp php=php newphp RecursiveIteratorIteratorphp(php$containerphp,
php php php php php php php php php php php php RecursiveIteratorIteratorphp:php:SELFphp_FIRSTphp)php;

php php php php php php php php php$maxDepthphp php=php php$thisphp-php>getMaxDepthphp(php)php;
php php php php php php php php ifphp php(isphp_intphp(php$maxDepthphp)php)php php{
php php php php php php php php php php php php php$iteratorphp-php>setMaxDepthphp(php$maxDepthphp)php;
php php php php php php php php php}
php php php php php php php php php$minDepthphp php=php php$thisphp-php>getMinDepthphp(php)php;
php php php php php php php php ifphp php(php!isphp_intphp(php$minDepthphp)php php|php|php php$minDepthphp <php php0php)php php{
php php php php php php php php php php php php php$minDepthphp php=php php0php;
php php php php php php php php php}

php php php php php php php php php/php/php iteratephp container
php php php php php php php php foreachphp php(php$iteratorphp asphp php$pagephp)php php{
php php php php php php php php php php php php ifphp php(php$iteratorphp-php>getDepthphp(php)php <php php$minDepthphp php|php|php php!php$thisphp-php>acceptphp(php$pagephp)php)php php{
php php php php php php php php php php php php php php php php php/php/php pagephp shouldphp notphp bephp included
php php php php php php php php php php php php php php php php continuephp;
php php php php php php php php php php php php php}

php php php php php php php php php php php php php/php/php getphp absolutephp urlphp fromphp page
php php php php php php php php php php php php ifphp php(php!php$urlphp php=php php$thisphp-php>urlphp(php$pagephp)php)php php{
php php php php php php php php php php php php php php php php php/php/php skipphp pagephp ifphp itphp hasphp nophp urlphp php(rarephp casephp)
php php php php php php php php php php php php php php php php continuephp;
php php php php php php php php php php php php php}

php php php php php php php php php php php php php/php/php createphp urlphp nodephp forphp thisphp page
php php php php php php php php php php php php php$urlNodephp php=php php$domphp-php>createElementNSphp(selfphp:php:SITEMAPphp_NSphp,php php'urlphp'php)php;
php php php php php php php php php php php php php$urlSetphp-php>appendChildphp(php$urlNodephp)php;

php php php php php php php php php php php php ifphp php(php$thisphp-php>getUseSitemapValidatorsphp(php)php php&php&
php php php php php php php php php php php php php php php php php!php$locValidatorphp-php>isValidphp(php$urlphp)php)php php{
php php php php php php php php php php php php php php php php requirephp_oncephp php'Zendphp/Viewphp/Exceptionphp.phpphp'php;
php php php php php php php php php php php php php php php php php$ephp php=php newphp Zendphp_Viewphp_Exceptionphp(sprintfphp(
php php php php php php php php php php php php php php php php php php php php php php php php php'Encounteredphp anphp invalidphp URLphp forphp Sitemapphp XMLphp:php php"php%sphp"php'php,
php php php php php php php php php php php php php php php php php php php php php php php php php$urlphp)php)php;
php php php php php php php php php php php php php php php php php$ephp-php>setViewphp(php$thisphp-php>viewphp)php;
php php php php php php php php php php php php php php php php throwphp php$ephp;
php php php php php php php php php php php php php}

php php php php php php php php php php php php php/php/php putphp urlphp inphp php'locphp'php element
php php php php php php php php php php php php php$urlNodephp-php>appendChildphp(php$domphp-php>createElementNSphp(selfphp:php:SITEMAPphp_NSphp,
php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php'locphp'php,php php$urlphp)php)php;

php php php php php php php php php php php php php/php/php addphp php'lastmodphp'php elementphp ifphp aphp validphp lastmodphp isphp setphp inphp page
php php php php php php php php php php php php ifphp php(issetphp(php$pagephp-php>lastmodphp)php)php php{
php php php php php php php php php php php php php php php php php$lastmodphp php=php strtotimephp(php(stringphp)php php$pagephp-php>lastmodphp)php;

php php php php php php php php php php php php php php php php php/php/php preventphp php1php9php7php0php-php0php1php-php0php1php.php.php.
php php php php php php php php php php php php php php php php ifphp php(php$lastmodphp php!php=php=php falsephp)php php{
php php php php php php php php php php php php php php php php php php php php php$lastmodphp php=php datephp(php'cphp'php,php php$lastmodphp)php;
php php php php php php php php php php php php php php php php php}

php php php php php php php php php php php php php php php php ifphp php(php!php$thisphp-php>getUseSitemapValidatorsphp(php)php php|php|
php php php php php php php php php php php php php php php php php php php php php$lastmodValidatorphp-php>isValidphp(php$lastmodphp)php)php php{
php php php php php php php php php php php php php php php php php php php php php$urlNodephp-php>appendChildphp(
php php php php php php php php php php php php php php php php php php php php php php php php php$domphp-php>createElementNSphp(selfphp:php:SITEMAPphp_NSphp,php php'lastmodphp'php,
php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php$lastmodphp)
php php php php php php php php php php php php php php php php php php php php php)php;
php php php php php php php php php php php php php php php php php}
php php php php php php php php php php php php php}

php php php php php php php php php php php php php/php/php addphp php'changefreqphp'php elementphp ifphp aphp validphp changefreqphp isphp setphp inphp page
php php php php php php php php php php php php ifphp php(issetphp(php$pagephp-php>changefreqphp)php)php php{
php php php php php php php php php php php php php php php php php$changefreqphp php=php php$pagephp-php>changefreqphp;
php php php php php php php php php php php php php php php php ifphp php(php!php$thisphp-php>getUseSitemapValidatorsphp(php)php php|php|
php php php php php php php php php php php php php php php php php php php php php$changefreqValidatorphp-php>isValidphp(php$changefreqphp)php)php php{
php php php php php php php php php php php php php php php php php php php php php$urlNodephp-php>appendChildphp(
php php php php php php php php php php php php php php php php php php php php php php php php php$domphp-php>createElementNSphp(selfphp:php:SITEMAPphp_NSphp,php php'changefreqphp'php,
php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php$changefreqphp)
php php php php php php php php php php php php php php php php php php php php php)php;
php php php php php php php php php php php php php php php php php}
php php php php php php php php php php php php php}

php php php php php php php php php php php php php/php/php addphp php'priorityphp'php elementphp ifphp aphp validphp priorityphp isphp setphp inphp page
php php php php php php php php php php php php ifphp php(issetphp(php$pagephp-php>priorityphp)php)php php{
php php php php php php php php php php php php php php php php php$priorityphp php=php php$pagephp-php>priorityphp;
php php php php php php php php php php php php php php php php ifphp php(php!php$thisphp-php>getUseSitemapValidatorsphp(php)php php|php|
php php php php php php php php php php php php php php php php php php php php php$priorityValidatorphp-php>isValidphp(php$priorityphp)php)php php{
php php php php php php php php php php php php php php php php php php php php php$urlNodephp-php>appendChildphp(
php php php php php php php php php php php php php php php php php php php php php php php php php$domphp-php>createElementNSphp(selfphp:php:SITEMAPphp_NSphp,php php'priorityphp'php,
php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php$priorityphp)
php php php php php php php php php php php php php php php php php php php php php)php;
php php php php php php php php php php php php php php php php php}
php php php php php php php php php php php php php}
php php php php php php php php php}

php php php php php php php php php/php/php validatephp usingphp schemaphp ifphp specified
php php php php php php php php ifphp php(php$thisphp-php>getUseSchemaValidationphp(php)php)php php{
php php php php php php php php php php php php ifphp php(php!php@php$domphp-php>schemaValidatephp(selfphp:php:SITEMAPphp_XSDphp)php)php php{
php php php php php php php php php php php php php php php php requirephp_oncephp php'Zendphp/Viewphp/Exceptionphp.phpphp'php;
php php php php php php php php php php php php php php php php php$ephp php=php newphp Zendphp_Viewphp_Exceptionphp(sprintfphp(
php php php php php php php php php php php php php php php php php php php php php php php php php'Sitemapphp isphp invalidphp accordingphp tophp XMLphp Schemaphp atphp php"php%sphp"php'php,
php php php php php php php php php php php php php php php php php php php php php php php php selfphp:php:SITEMAPphp_XSDphp)php)php;
php php php php php php php php php php php php php php php php php$ephp-php>setViewphp(php$thisphp-php>viewphp)php;
php php php php php php php php php php php php php php php php throwphp php$ephp;
php php php php php php php php php php php php php}
php php php php php php php php php}

php php php php php php php php returnphp php$domphp;
php php php php php}

php php php php php/php/php Zendphp_Viewphp_Helperphp_Navigationphp_Helperphp:

php php php php php/php*php*
php php php php php php*php Rendersphp helper
php php php php php php*
php php php php php php*php Implementsphp php{php@linkphp Zendphp_Viewphp_Helperphp_Navigationphp_Helperphp:php:renderphp(php)php}php.
php php php php php php*
php php php php php php*php php@paramphp php Zendphp_Navigationphp_Containerphp php$containerphp php php[optionalphp]php containerphp to
php php php php php php*php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php renderphp.php Defaultphp isphp to
php php php php php php*php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php renderphp thephp container
php php php php php php*php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php registeredphp inphp thephp helperphp.
php php php php php php*php php@returnphp stringphp php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php helperphp output
php php php php php php*php/
php php php php publicphp functionphp renderphp(Zendphp_Navigationphp_Containerphp php$containerphp php=php nullphp)
php php php php php{
php php php php php php php php php$domphp php=php php$thisphp-php>getDomSitemapphp(php$containerphp)php;

php php php php php php php php php$xmlphp php=php php$thisphp-php>getUseXmlDeclarationphp(php)php php?
php php php php php php php php php php php php php php php php$domphp-php>saveXMLphp(php)php php:
php php php php php php php php php php php php php php php php$domphp-php>saveXMLphp(php$domphp-php>documentElementphp)php;

php php php php php php php php returnphp rtrimphp(php$xmlphp,php PHPphp_EOLphp)php;
php php php php php}
php}
