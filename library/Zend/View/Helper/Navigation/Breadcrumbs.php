<php?php
php/php*php*
php php*php Zendphp Framework
php php*
php php*php LICENSE
php php*
php php*php Thisphp sourcephp filephp isphp subjectphp tophp thephp newphp BSDphp licensephp thatphp isphp bundled
php php*php withphp thisphp packagephp inphp thephp filephp LICENSEphp.txtphp.
php php*php Itphp isphp alsophp availablephp throughphp thephp worldphp-widephp-webphp atphp thisphp URLphp:
php php*php httpphp:php/php/frameworkphp.zendphp.comphp/licensephp/newphp-bsd
php php*php Ifphp youphp didphp notphp receivephp aphp copyphp ofphp thephp licensephp andphp arephp unablephp to
php php*php obtainphp itphp throughphp thephp worldphp-widephp-webphp,php pleasephp sendphp anphp email
php php*php tophp licensephp@zendphp.comphp sophp wephp canphp sendphp youphp aphp copyphp immediatelyphp.
php php*
php php*php php@categoryphp php php Zend
php php*php php@packagephp php php php Zendphp_View
php php*php php@subpackagephp Helper
php php*php php@copyrightphp php Copyrightphp php(cphp)php php2php0php0php5php-php2php0php1php0php Zendphp Technologiesphp USAphp Incphp.php php(httpphp:php/php/wwwphp.zendphp.comphp)
php php*php php@licensephp php php php httpphp:php/php/frameworkphp.zendphp.comphp/licensephp/newphp-bsdphp php php php php Newphp BSDphp License
php php*php php@versionphp php php php php$Idphp:php Breadcrumbsphp.phpphp php2php3php4php8php4php php2php0php1php0php-php1php2php-php1php0php php0php3php:php5php7php:php5php9Zphp mjhphp_caphp php$
php php*php/

php/php*php*
php php*php php@seephp Zendphp_Viewphp_Helperphp_Navigationphp_HelperAbstract
php php*php/
requirephp_oncephp php'Zendphp/Viewphp/Helperphp/Navigationphp/HelperAbstractphp.phpphp'php;

php/php*php*
php php*php Helperphp forphp printingphp breadcrumbs
php php*
php php*php php@categoryphp php php Zend
php php*php php@packagephp php php php Zendphp_View
php php*php php@subpackagephp Helper
php php*php php@copyrightphp php Copyrightphp php(cphp)php php2php0php0php5php-php2php0php1php0php Zendphp Technologiesphp USAphp Incphp.php php(httpphp:php/php/wwwphp.zendphp.comphp)
php php*php php@licensephp php php php httpphp:php/php/frameworkphp.zendphp.comphp/licensephp/newphp-bsdphp php php php php Newphp BSDphp License
php php*php/
classphp Zendphp_Viewphp_Helperphp_Navigationphp_Breadcrumbs
php php php php extendsphp Zendphp_Viewphp_Helperphp_Navigationphp_HelperAbstract
php{
php php php php php/php*php*
php php php php php php*php Breadcrumbsphp separatorphp string
php php php php php php*
php php php php php php*php php@varphp string
php php php php php php*php/
php php php php protectedphp php$php_separatorphp php=php php'php php&gtphp;php php'php;

php php php php php/php*php*
php php php php php php*php Thephp minimumphp depthphp aphp pagephp mustphp havephp tophp bephp includedphp whenphp rendering
php php php php php php*
php php php php php php*php php@varphp int
php php php php php php*php/
php php php php protectedphp php$php_minDepthphp php=php php1php;

php php php php php/php*php*
php php php php php php*php Whetherphp lastphp pagephp inphp breadcrumbphp shouldphp bephp hyperlinked
php php php php php php*
php php php php php php*php php@varphp bool
php php php php php php*php/
php php php php protectedphp php$php_linkLastphp php=php falsephp;

php php php php php/php*php*
php php php php php php*php Partialphp viewphp scriptphp tophp usephp forphp renderingphp menu
php php php php php php*
php php php php php php*php php@varphp stringphp|array
php php php php php php*php/
php php php php protectedphp php$php_partialphp;

php php php php php/php*php*
php php php php php php*php Viewphp helperphp entryphp pointphp:
php php php php php php*php Retrievesphp helperphp andphp optionallyphp setsphp containerphp tophp operatephp on
php php php php php php*
php php php php php php*php php@paramphp php Zendphp_Navigationphp_Containerphp php$containerphp php php php php php[optionalphp]php containerphp to
php php php php php php*php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php operatephp on
php php php php php php*php php@returnphp Zendphp_Viewphp_Helperphp_Navigationphp_Breadcrumbsphp php fluentphp interfacephp,
php php php php php php*php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php returnsphp self
php php php php php php*php/
php php php php publicphp functionphp breadcrumbsphp(Zendphp_Navigationphp_Containerphp php$containerphp php=php nullphp)
php php php php php{
php php php php php php php php ifphp php(nullphp php!php=php=php php$containerphp)php php{
php php php php php php php php php php php php php$thisphp-php>setContainerphp(php$containerphp)php;
php php php php php php php php php}

php php php php php php php php returnphp php$thisphp;
php php php php php}

php php php php php/php/php Accessorsphp:

php php php php php/php*php*
php php php php php php*php Setsphp breadcrumbphp separator
php php php php php php*
php php php php php php*php php@paramphp php stringphp php$separatorphp php php php php php php php php php php php php php php php php php php php php php php php separatorphp string
php php php php php php*php php@returnphp Zendphp_Viewphp_Helperphp_Navigationphp_Breadcrumbsphp php fluentphp interfacephp,
php php php php php php*php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php returnsphp self
php php php php php php*php/
php php php php publicphp functionphp setSeparatorphp(php$separatorphp)
php php php php php{
php php php php php php php php ifphp php(isphp_stringphp(php$separatorphp)php)php php{
php php php php php php php php php php php php php$thisphp-php>php_separatorphp php=php php$separatorphp;
php php php php php php php php php}

php php php php php php php php returnphp php$thisphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Returnsphp breadcrumbphp separator
php php php php php php*
php php php php php php*php php@returnphp stringphp php breadcrumbphp separator
php php php php php php*php/
php php php php publicphp functionphp getSeparatorphp(php)
php php php php php{
php php php php php php php php returnphp php$thisphp-php>php_separatorphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Setsphp whetherphp lastphp pagephp inphp breadcrumbsphp shouldphp bephp hyperlinked
php php php php php php*
php php php php php php*php php@paramphp php boolphp php$linkLastphp php php php php php php php php php php php php php php php php php php php php php php php php php php whetherphp lastphp pagephp should
php php php php php php*php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php bephp hyperlinked
php php php php php php*php php@returnphp Zendphp_Viewphp_Helperphp_Navigationphp_Breadcrumbsphp php fluentphp interfacephp,
php php php php php php*php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php returnsphp self
php php php php php php*php/
php php php php publicphp functionphp setLinkLastphp(php$linkLastphp)
php php php php php{
php php php php php php php php php$thisphp-php>php_linkLastphp php=php php(boolphp)php php$linkLastphp;
php php php php php php php php returnphp php$thisphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Returnsphp whetherphp lastphp pagephp inphp breadcrumbsphp shouldphp bephp hyperlinked
php php php php php php*
php php php php php php*php php@returnphp boolphp php whetherphp lastphp pagephp inphp breadcrumbsphp shouldphp bephp hyperlinked
php php php php php php*php/
php php php php publicphp functionphp getLinkLastphp(php)
php php php php php{
php php php php php php php php returnphp php$thisphp-php>php_linkLastphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Setsphp whichphp partialphp viewphp scriptphp tophp usephp forphp renderingphp menu
php php php php php php*
php php php php php php*php php@paramphp php stringphp|arrayphp php$partialphp php php php php php php php php php php php php php php php php php php php partialphp viewphp scriptphp or
php php php php php php*php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php nullphp.php Ifphp anphp arrayphp is
php php php php php php*php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php givenphp,php itphp isphp expectedphp to
php php php php php php*php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php containphp twophp valuesphp;
php php php php php php*php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php thephp partialphp viewphp script
php php php php php php*php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php tophp usephp,php andphp thephp module
php php php php php php*php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php wherephp thephp scriptphp canphp be
php php php php php php*php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php foundphp.
php php php php php php*php php@returnphp Zendphp_Viewphp_Helperphp_Navigationphp_Breadcrumbsphp php fluentphp interfacephp,
php php php php php php*php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php returnsphp self
php php php php php php*php/
php php php php publicphp functionphp setPartialphp(php$partialphp)
php php php php php{
php php php php php php php php ifphp php(nullphp php=php=php=php php$partialphp php|php|php isphp_stringphp(php$partialphp)php php|php|php isphp_arrayphp(php$partialphp)php)php php{
php php php php php php php php php php php php php$thisphp-php>php_partialphp php=php php$partialphp;
php php php php php php php php php}

php php php php php php php php returnphp php$thisphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Returnsphp partialphp viewphp scriptphp tophp usephp forphp renderingphp menu
php php php php php php*
php php php php php php*php php@returnphp stringphp|arrayphp|null
php php php php php php*php/
php php php php publicphp functionphp getPartialphp(php)
php php php php php{
php php php php php php php php returnphp php$thisphp-php>php_partialphp;
php php php php php}

php php php php php/php/php Renderphp methodsphp:

php php php php php/php*php*
php php php php php php*php Rendersphp breadcrumbsphp byphp chainingphp php'aphp'php elementsphp withphp thephp separator
php php php php php php*php registeredphp inphp thephp helper
php php php php php php*
php php php php php php*php php@paramphp php Zendphp_Navigationphp_Containerphp php$containerphp php php[optionalphp]php containerphp to
php php php php php php*php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php renderphp.php Defaultphp isphp to
php php php php php php*php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php renderphp thephp container
php php php php php php*php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php registeredphp inphp thephp helperphp.
php php php php php php*php php@returnphp stringphp php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php helperphp output
php php php php php php*php/
php php php php publicphp functionphp renderStraightphp(Zendphp_Navigationphp_Containerphp php$containerphp php=php nullphp)
php php php php php{
php php php php php php php php ifphp php(nullphp php=php=php=php php$containerphp)php php{
php php php php php php php php php php php php php$containerphp php=php php$thisphp-php>getContainerphp(php)php;
php php php php php php php php php}

php php php php php php php php php/php/php findphp deepestphp active
php php php php php php php php ifphp php(php!php$activephp php=php php$thisphp-php>findActivephp(php$containerphp)php)php php{
php php php php php php php php php php php php returnphp php'php'php;
php php php php php php php php php}

php php php php php php php php php$activephp php=php php$activephp[php'pagephp'php]php;

php php php php php php php php php/php/php putphp thephp deepestphp activephp pagephp lastphp inphp breadcrumbs
php php php php php php php php ifphp php(php$thisphp-php>getLinkLastphp(php)php)php php{
php php php php php php php php php php php php php$htmlphp php=php php$thisphp-php>htmlifyphp(php$activephp)php;
php php php php php php php php php}php elsephp php{
php php php php php php php php php php php php php$htmlphp php=php php$activephp-php>getLabelphp(php)php;
php php php php php php php php php php php php ifphp php(php$thisphp-php>getUseTranslatorphp(php)php php&php&php php$tphp php=php php$thisphp-php>getTranslatorphp(php)php)php php{
php php php php php php php php php php php php php php php php php$htmlphp php=php php$tphp-php>translatephp(php$htmlphp)php;
php php php php php php php php php php php php php}
php php php php php php php php php php php php php$htmlphp php=php php$thisphp-php>viewphp-php>escapephp(php$htmlphp)php;
php php php php php php php php php}

php php php php php php php php php/php/php walkphp backphp tophp root
php php php php php php php php whilephp php(php$parentphp php=php php$activephp-php>getParentphp(php)php)php php{
php php php php php php php php php php php php ifphp php(php$parentphp instanceofphp Zendphp_Navigationphp_Pagephp)php php{
php php php php php php php php php php php php php php php php php/php/php prependphp crumbphp tophp html
php php php php php php php php php php php php php php php php php$htmlphp php=php php$thisphp-php>htmlifyphp(php$parentphp)
php php php php php php php php php php php php php php php php php php php php php php php.php php$thisphp-php>getSeparatorphp(php)
php php php php php php php php php php php php php php php php php php php php php php php.php php$htmlphp;
php php php php php php php php php php php php php}

php php php php php php php php php php php php ifphp php(php$parentphp php=php=php=php php$containerphp)php php{
php php php php php php php php php php php php php php php php php/php/php atphp thephp rootphp ofphp thephp givenphp container
php php php php php php php php php php php php php php php php breakphp;
php php php php php php php php php php php php php}

php php php php php php php php php php php php php$activephp php=php php$parentphp;
php php php php php php php php php}

php php php php php php php php returnphp strlenphp(php$htmlphp)php php?php php$thisphp-php>getIndentphp(php)php php.php php$htmlphp php:php php'php'php;
php php php php php}

php php php php php/php*php*
php php php php php php*php Rendersphp thephp givenphp php$containerphp byphp invokingphp thephp partialphp viewphp helper
php php php php php php*
php php php php php php*php Thephp containerphp willphp simplyphp bephp passedphp onphp asphp aphp modelphp tophp thephp viewphp scriptphp,
php php php php php php*php sophp inphp thephp scriptphp itphp willphp bephp availablephp inphp php<codephp>php$thisphp-php>container<php/codephp>php.
php php php php php php*
php php php php php php*php php@paramphp php Zendphp_Navigationphp_Containerphp php$containerphp php php[optionalphp]php containerphp to
php php php php php php*php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php passphp tophp viewphp scriptphp.
php php php php php php*php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php Defaultphp isphp tophp usephp the
php php php php php php*php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php containerphp registeredphp inphp the
php php php php php php*php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php helperphp.
php php php php php php*php php@paramphp php stringphp|arrayphp php php php php php php php php php php php php php$partialphp php php php php php[optionalphp]php partialphp view
php php php php php php*php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php scriptphp tophp usephp.php Defaultphp is
php php php php php php*php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php tophp usephp thephp partial
php php php php php php*php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php registeredphp inphp thephp helperphp.
php php php php php php*php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php Ifphp anphp arrayphp isphp givenphp,php itphp is
php php php php php php*php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php expectedphp tophp containphp two
php php php php php php*php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php valuesphp;php thephp partialphp view
php php php php php php*php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php scriptphp tophp usephp,php andphp the
php php php php php php*php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php modulephp wherephp thephp scriptphp can
php php php php php php*php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php bephp foundphp.
php php php php php php*php php@returnphp stringphp php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php helperphp output
php php php php php php*php/
php php php php publicphp functionphp renderPartialphp(Zendphp_Navigationphp_Containerphp php$containerphp php=php nullphp,
php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php$partialphp php=php nullphp)
php php php php php{
php php php php php php php php ifphp php(nullphp php=php=php=php php$containerphp)php php{
php php php php php php php php php php php php php$containerphp php=php php$thisphp-php>getContainerphp(php)php;
php php php php php php php php php}

php php php php php php php php ifphp php(nullphp php=php=php=php php$partialphp)php php{
php php php php php php php php php php php php php$partialphp php=php php$thisphp-php>getPartialphp(php)php;
php php php php php php php php php}

php php php php php php php php ifphp php(emptyphp(php$partialphp)php)php php{
php php php php php php php php php php php php requirephp_oncephp php'Zendphp/Viewphp/Exceptionphp.phpphp'php;
php php php php php php php php php php php php php$ephp php=php newphp Zendphp_Viewphp_Exceptionphp(
php php php php php php php php php php php php php php php php php'Unablephp tophp renderphp menuphp:php Nophp partialphp viewphp scriptphp providedphp'
php php php php php php php php php php php php php)php;
php php php php php php php php php php php php php$ephp-php>setViewphp(php$thisphp-php>viewphp)php;
php php php php php php php php php php php php throwphp php$ephp;
php php php php php php php php php}

php php php php php php php php php/php/php putphp breadcrumbphp pagesphp inphp model
php php php php php php php php php$modelphp php=php arrayphp(php'pagesphp'php php=php>php arrayphp(php)php)php;
php php php php php php php php ifphp php(php$activephp php=php php$thisphp-php>findActivephp(php$containerphp)php)php php{
php php php php php php php php php php php php php$activephp php=php php$activephp[php'pagephp'php]php;
php php php php php php php php php php php php php$modelphp[php'pagesphp'php]php[php]php php=php php$activephp;
php php php php php php php php php php php php whilephp php(php$parentphp php=php php$activephp-php>getParentphp(php)php)php php{
php php php php php php php php php php php php php php php php ifphp php(php$parentphp instanceofphp Zendphp_Navigationphp_Pagephp)php php{
php php php php php php php php php php php php php php php php php php php php php$modelphp[php'pagesphp'php]php[php]php php=php php$parentphp;
php php php php php php php php php php php php php php php php php}php elsephp php{
php php php php php php php php php php php php php php php php php php php php breakphp;
php php php php php php php php php php php php php php php php php}

php php php php php php php php php php php php php php php php ifphp php(php$parentphp php=php=php=php php$containerphp)php php{
php php php php php php php php php php php php php php php php php php php php php/php/php breakphp ifphp atphp thephp rootphp ofphp thephp givenphp container
php php php php php php php php php php php php php php php php php php php php breakphp;
php php php php php php php php php php php php php php php php php}

php php php php php php php php php php php php php php php php php$activephp php=php php$parentphp;
php php php php php php php php php php php php php}
php php php php php php php php php php php php php$modelphp[php'pagesphp'php]php php=php arrayphp_reversephp(php$modelphp[php'pagesphp'php]php)php;
php php php php php php php php php}

php php php php php php php php ifphp php(isphp_arrayphp(php$partialphp)php)php php{
php php php php php php php php php php php php ifphp php(countphp(php$partialphp)php php!php=php php2php)php php{
php php php php php php php php php php php php php php php php requirephp_oncephp php'Zendphp/Viewphp/Exceptionphp.phpphp'php;
php php php php php php php php php php php php php php php php php$ephp php=php newphp Zendphp_Viewphp_Exceptionphp(
php php php php php php php php php php php php php php php php php php php php php'Unablephp tophp renderphp menuphp:php Aphp viewphp partialphp suppliedphp asphp php'
php php php php php php php php php php php php php php php php php php php php php.php php php'anphp arrayphp mustphp containphp twophp valuesphp:php partialphp viewphp php'
php php php php php php php php php php php php php php php php php php php php php.php php php'scriptphp andphp modulephp wherephp scriptphp canphp bephp foundphp'
php php php php php php php php php php php php php php php php php)php;
php php php php php php php php php php php php php php php php php$ephp-php>setViewphp(php$thisphp-php>viewphp)php;
php php php php php php php php php php php php php php php php throwphp php$ephp;
php php php php php php php php php php php php php}

php php php php php php php php php php php php returnphp php$thisphp-php>viewphp-php>partialphp(php$partialphp[php0php]php,php php$partialphp[php1php]php,php php$modelphp)php;
php php php php php php php php php}

php php php php php php php php returnphp php$thisphp-php>viewphp-php>partialphp(php$partialphp,php nullphp,php php$modelphp)php;
php php php php php}

php php php php php/php/php Zendphp_Viewphp_Helperphp_Navigationphp_Helperphp:

php php php php php/php*php*
php php php php php php*php Rendersphp helper
php php php php php php*
php php php php php php*php Implementsphp php{php@linkphp Zendphp_Viewphp_Helperphp_Navigationphp_Helperphp:php:renderphp(php)php}php.
php php php php php php*
php php php php php php*php php@paramphp php Zendphp_Navigationphp_Containerphp php$containerphp php php[optionalphp]php containerphp to
php php php php php php*php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php renderphp.php Defaultphp isphp to
php php php php php php*php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php renderphp thephp container
php php php php php php*php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php registeredphp inphp thephp helperphp.
php php php php php php*php php@returnphp stringphp php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php helperphp output
php php php php php php*php/
php php php php publicphp functionphp renderphp(Zendphp_Navigationphp_Containerphp php$containerphp php=php nullphp)
php php php php php{
php php php php php php php php ifphp php(php$partialphp php=php php$thisphp-php>getPartialphp(php)php)php php{
php php php php php php php php php php php php returnphp php$thisphp-php>renderPartialphp(php$containerphp,php php$partialphp)php;
php php php php php php php php php}php elsephp php{
php php php php php php php php php php php php returnphp php$thisphp-php>renderStraightphp(php$containerphp)php;
php php php php php php php php php}
php php php php php}
php}
