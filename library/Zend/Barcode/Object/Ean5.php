<php?php
php/php*php*
php php*php Zendphp Framework
php php*
php php*php LICENSE
php php*
php php*php Thisphp sourcephp filephp isphp subjectphp tophp thephp newphp BSDphp licensephp thatphp isphp bundled
php php*php withphp thisphp packagephp inphp thephp filephp LICENSEphp.txtphp.
php php*php Itphp isphp alsophp availablephp throughphp thephp worldphp-widephp-webphp atphp thisphp URLphp:
php php*php httpphp:php/php/frameworkphp.zendphp.comphp/licensephp/newphp-bsd
php php*php Ifphp youphp didphp notphp receivephp aphp copyphp ofphp thephp licensephp andphp arephp unablephp to
php php*php obtainphp itphp throughphp thephp worldphp-widephp-webphp,php pleasephp sendphp anphp email
php php*php tophp licensephp@zendphp.comphp sophp wephp canphp sendphp youphp aphp copyphp immediatelyphp.
php php*
php php*php php@categoryphp php php Zend
php php*php php@packagephp php php php Zendphp_Barcode
php php*php php@subpackagephp Object
php php*php php@copyrightphp php Copyrightphp php(cphp)php php2php0php0php5php-php2php0php1php0php Zendphp Technologiesphp USAphp Incphp.php php(httpphp:php/php/wwwphp.zendphp.comphp)
php php*php php@licensephp php php php httpphp:php/php/frameworkphp.zendphp.comphp/licensephp/newphp-bsdphp php php php php Newphp BSDphp License
php php*php php@versionphp php php php php$Idphp:php Eanphp5php.phpphp php2php0php0php9php6php php2php0php1php0php-php0php1php-php0php6php php0php2php:php0php5php:php0php9Zphp bkarwinphp php$
php php*php/

php/php*php*
php php*php php@seephp Zendphp_Barcodephp_Objectphp_Eanphp1php3
php php*php/
requirephp_oncephp php'Zendphp/Barcodephp/Objectphp/Eanphp1php3php.phpphp'php;

php/php*php*
php php*php php@seephp Zendphp_Validatephp_Barcode
php php*php/
requirephp_oncephp php'Zendphp/Validatephp/Barcodephp.phpphp'php;

php/php*php*
php php*php Classphp forphp generatephp Eanphp5php barcode
php php*
php php*php php@categoryphp php php Zend
php php*php php@packagephp php php php Zendphp_Barcode
php php*php php@copyrightphp php Copyrightphp php(cphp)php php2php0php0php5php-php2php0php1php0php Zendphp Technologiesphp USAphp Incphp.php php(httpphp:php/php/wwwphp.zendphp.comphp)
php php*php php@licensephp php php php httpphp:php/php/frameworkphp.zendphp.comphp/licensephp/newphp-bsdphp php php php php Newphp BSDphp License
php php*php/
classphp Zendphp_Barcodephp_Objectphp_Eanphp5php extendsphp Zendphp_Barcodephp_Objectphp_Eanphp1php3
php{

php php php php protectedphp php$php_paritiesphp php=php arrayphp(
php php php php php php php php php0php php=php>php arrayphp(php'Bphp'php,php'Bphp'php,php'Aphp'php,php'Aphp'php,php'Aphp'php)php,
php php php php php php php php php1php php=php>php arrayphp(php'Bphp'php,php'Aphp'php,php'Bphp'php,php'Aphp'php,php'Aphp'php)php,
php php php php php php php php php2php php=php>php arrayphp(php'Bphp'php,php'Aphp'php,php'Aphp'php,php'Bphp'php,php'Aphp'php)php,
php php php php php php php php php3php php=php>php arrayphp(php'Bphp'php,php'Aphp'php,php'Aphp'php,php'Aphp'php,php'Bphp'php)php,
php php php php php php php php php4php php=php>php arrayphp(php'Aphp'php,php'Bphp'php,php'Bphp'php,php'Aphp'php,php'Aphp'php)php,
php php php php php php php php php5php php=php>php arrayphp(php'Aphp'php,php'Aphp'php,php'Bphp'php,php'Bphp'php,php'Aphp'php)php,
php php php php php php php php php6php php=php>php arrayphp(php'Aphp'php,php'Aphp'php,php'Aphp'php,php'Bphp'php,php'Bphp'php)php,
php php php php php php php php php7php php=php>php arrayphp(php'Aphp'php,php'Bphp'php,php'Aphp'php,php'Bphp'php,php'Aphp'php)php,
php php php php php php php php php8php php=php>php arrayphp(php'Aphp'php,php'Bphp'php,php'Aphp'php,php'Aphp'php,php'Bphp'php)php,
php php php php php php php php php9php php=php>php arrayphp(php'Aphp'php,php'Aphp'php,php'Bphp'php,php'Aphp'php,php'Bphp'php)
php php php php php)php;

php php php php php/php*php*
php php php php php php*php Defaultphp optionsphp forphp Eanphp5php barcode
php php php php php php*php php@returnphp void
php php php php php php*php/
php php php php protectedphp functionphp php_getDefaultOptionsphp(php)
php php php php php{
php php php php php php php php php$thisphp-php>php_barcodeLengthphp php=php php5php;
php php php php php}

php php php php php/php*php*
php php php php php php*php Widthphp ofphp thephp barcodephp php(inphp pixelsphp)
php php php php php php*php php@returnphp integer
php php php php php php*php/
php php php php protectedphp functionphp php_calculateBarcodeWidthphp(php)
php php php php php{
php php php php php php php php php$quietZonephp php php php php php php php=php php$thisphp-php>getQuietZonephp(php)php;
php php php php php php php php php$startCharacterphp php php=php php(php5php php*php php$thisphp-php>php_barThinWidthphp)php php*php php$thisphp-php>php_factorphp;
php php php php php php php php php$middleCharacterphp php=php php(php2php php*php php$thisphp-php>php_barThinWidthphp)php php*php php$thisphp-php>php_factorphp;
php php php php php php php php php$encodedDataphp php php php php php=php php(php7php php*php php$thisphp-php>php_barThinWidthphp)php php*php php$thisphp-php>php_factorphp;
php php php php php php php php returnphp php$quietZonephp php+php php$startCharacterphp php+php php(php$thisphp-php>php_barcodeLengthphp php-php php1php)php php*php php$middleCharacterphp php+php php$thisphp-php>php_barcodeLengthphp php*php php$encodedDataphp php+php php$quietZonephp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Preparephp arrayphp tophp drawphp barcode
php php php php php php*php php@returnphp array
php php php php php php*php/
php php php php protectedphp functionphp php_prepareBarcodephp(php)
php php php php php{
php php php php php php php php php$barcodeTablephp php=php arrayphp(php)php;

php php php php php php php php php/php/php Startphp characterphp php(php0php1php0php1php1php)
php php php php php php php php php$barcodeTablephp[php]php php=php arrayphp(php0php php,php php$thisphp-php>php_barThinWidthphp php,php php0php php,php php1php)php;
php php php php php php php php php$barcodeTablephp[php]php php=php arrayphp(php1php php,php php$thisphp-php>php_barThinWidthphp php,php php0php php,php php1php)php;
php php php php php php php php php$barcodeTablephp[php]php php=php arrayphp(php0php php,php php$thisphp-php>php_barThinWidthphp php,php php0php php,php php1php)php;
php php php php php php php php php$barcodeTablephp[php]php php=php arrayphp(php1php php,php php$thisphp-php>php_barThinWidthphp php,php php0php php,php php1php)php;
php php php php php php php php php$barcodeTablephp[php]php php=php arrayphp(php1php php,php php$thisphp-php>php_barThinWidthphp php,php php0php php,php php1php)php;

php php php php php php php php php$firstCharacterphp php=php truephp;
php php php php php php php php php$textTablephp php=php strphp_splitphp(php$thisphp-php>getTextphp(php)php)php;

php php php php php php php php php/php/php Characters
php php php php php php php php forphp php(php$iphp php=php php0php;php php$iphp <php php$thisphp-php>php_barcodeLengthphp;php php$iphp+php+php)php php{
php php php php php php php php php php php php ifphp php(php$firstCharacterphp)php php{
php php php php php php php php php php php php php php php php php$firstCharacterphp php=php falsephp;
php php php php php php php php php php php php php}php elsephp php{
php php php php php php php php php php php php php php php php php/php/php Intermediatephp characterphp php(php0php1php)
php php php php php php php php php php php php php php php php php$barcodeTablephp[php]php php=php arrayphp(php0php php,php php$thisphp-php>php_barThinWidthphp php,php php0php php,php php1php)php;
php php php php php php php php php php php php php php php php php$barcodeTablephp[php]php php=php arrayphp(php1php php,php php$thisphp-php>php_barThinWidthphp php,php php0php php,php php1php)php;
php php php php php php php php php php php php php}
php php php php php php php php php php php php php$barsphp php=php strphp_splitphp(php$thisphp-php>php_codingMapphp[php$thisphp-php>php_getParityphp(php$iphp)php]php[php$textTablephp[php$iphp]php]php)php;
php php php php php php php php php php php php foreachphp php(php$barsphp asphp php$bphp)php php{
php php php php php php php php php php php php php php php php php$barcodeTablephp[php]php php=php arrayphp(php$bphp php,php php$thisphp-php>php_barThinWidthphp php,php php0php php,php php1php)php;
php php php php php php php php php php php php php}
php php php php php php php php php}

php php php php php php php php returnphp php$barcodeTablephp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Getphp barcodephp checksum
php php php php php php*
php php php php php php*php php@paramphp php stringphp php$text
php php php php php php*php php@returnphp int
php php php php php php*php/
php php php php publicphp functionphp getChecksumphp(php$textphp)
php php php php php{
php php php php php php php php php$thisphp-php>php_checkTextphp(php$textphp)php;
php php php php php php php php php$checksumphp php=php php0php;

php php php php php php php php forphp php(php$iphp php=php php0php php;php php$iphp <php php$thisphp-php>php_barcodeLengthphp;php php$iphp php+php+php)php php{
php php php php php php php php php php php php php$checksumphp php+php=php intvalphp(php$textphp{php$iphp}php)php php*php php(php$iphp php%php php2php php?php php9php php:php php3php)php;
php php php php php php php php php}

php php php php php php php php returnphp php(php$checksumphp php%php php1php0php)php;
php php php php php}

php php php php protectedphp functionphp php_getParityphp(php$iphp)
php php php php php{
php php php php php php php php php$checksumphp php=php php$thisphp-php>getChecksumphp(php$thisphp-php>getTextphp(php)php)php;
php php php php php php php php returnphp php$thisphp-php>php_paritiesphp[php$checksumphp]php[php$iphp]php;
php php php php php}

php php php php php/php*php*
php php php php php php*php Retrievephp textphp tophp encode
php php php php php php*php php@returnphp string
php php php php php php*php/
php php php php publicphp functionphp getTextphp(php)
php php php php php{
php php php php php php php php returnphp php$thisphp-php>php_addLeadingZerosphp(php$thisphp-php>php_textphp)php;
php php php php php}
php}
