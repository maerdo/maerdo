<php?php
php/php*php*
php php*php Zendphp Framework
php php*
php php*php LICENSE
php php*
php php*php Thisphp sourcephp filephp isphp subjectphp tophp thephp newphp BSDphp licensephp thatphp isphp bundled
php php*php withphp thisphp packagephp inphp thephp filephp LICENSEphp.txtphp.
php php*php Itphp isphp alsophp availablephp throughphp thephp worldphp-widephp-webphp atphp thisphp URLphp:
php php*php httpphp:php/php/frameworkphp.zendphp.comphp/licensephp/newphp-bsd
php php*php Ifphp youphp didphp notphp receivephp aphp copyphp ofphp thephp licensephp andphp arephp unablephp to
php php*php obtainphp itphp throughphp thephp worldphp-widephp-webphp,php pleasephp sendphp anphp email
php php*php tophp licensephp@zendphp.comphp sophp wephp canphp sendphp youphp aphp copyphp immediatelyphp.
php php*
php php*php php@categoryphp php php Zend
php php*php php@packagephp php php php Zendphp_Servicephp_Amazon
php php*php php@subpackagephp Ecphp2
php php*php php@copyrightphp php Copyrightphp php(cphp)php php2php0php0php5php-php2php0php1php0php Zendphp Technologiesphp USAphp Incphp.php php(httpphp:php/php/wwwphp.zendphp.comphp)
php php*php php@licensephp php php php httpphp:php/php/frameworkphp.zendphp.comphp/licensephp/newphp-bsdphp php php php php Newphp BSDphp License
php php*php php@versionphp php php php php$Idphp:php CloudWatchphp.phpphp php2php3php4php8php4php php2php0php1php0php-php1php2php-php1php0php php0php3php:php5php7php:php5php9Zphp mjhphp_caphp php$
php php*php/

php/php*php*
php php*php php@seephp Zendphp_Servicephp_Amazonphp_Ecphp2php_Abstract
php php*php/
requirephp_oncephp php'Zendphp/Servicephp/Amazonphp/Ecphp2php/Abstractphp.phpphp'php;

php/php*php*
php php*php Anphp Amazonphp ECphp2php interfacephp thatphp allowsphp youtphp tophp runphp,php terminatephp,php rebootphp andphp describephp Amazon
php php*php Ecphp2php Instancesphp.
php php*
php php*php php@categoryphp php php Zend
php php*php php@packagephp php php php Zendphp_Servicephp_Amazon
php php*php php@subpackagephp Ecphp2
php php*php php@copyrightphp php Copyrightphp php(cphp)php php2php0php0php5php-php2php0php1php0php Zendphp Technologiesphp USAphp Incphp.php php(httpphp:php/php/wwwphp.zendphp.comphp)
php php*php php@licensephp php php php httpphp:php/php/frameworkphp.zendphp.comphp/licensephp/newphp-bsdphp php php php php Newphp BSDphp License
php php*php/
classphp Zendphp_Servicephp_Amazonphp_Ecphp2php_CloudWatchphp extendsphp Zendphp_Servicephp_Amazonphp_Ecphp2php_Abstract
php{
php php php php php/php*php*
php php php php php php*php Thephp HTTPphp queryphp server
php php php php php php*php/
php php php php protectedphp php$php_ecphp2Endpointphp php=php php'monitoringphp.amazonawsphp.comphp'php;

php php php php php/php*php*
php php php php php php*php Thephp APIphp versionphp tophp use
php php php php php php*php/
php php php php protectedphp php$php_ecphp2ApiVersionphp php=php php'php2php0php0php9php-php0php5php-php1php5php'php;

php php php php php/php*php*
php php php php php php*php XMLphp Namespacephp forphp thephp CloudWatchphp Stuff
php php php php php php*php/
php php php php protectedphp php$php_xmlNamespacephp php=php php'httpphp:php/php/monitoringphp.amazonawsphp.comphp/docphp/php2php0php0php9php-php0php5php-php1php5php/php'php;

php php php php php/php*php*
php php php php php php*php Thephp followingphp metricsphp arephp availablephp fromphp eachphp ECphp2php instancephp.
php php php php php php*
php php php php php php*php CPUUtilizationphp:php Thephp percentagephp ofphp allocatedphp ECphp2php computephp unitsphp thatphp are
php php php php php php*php php currentlyphp inphp usephp onphp thephp instancephp.php Thisphp metricphp identifiesphp thephp processing
php php php php php php*php php powerphp requiredphp tophp runphp anphp applicationphp uponphp aphp selectedphp instancephp.
php php php php php php*
php php php php php php*php NetworkInphp:php Thephp numberphp ofphp bytesphp receivedphp onphp allphp networkphp interfacesphp by
php php php php php php*php php thephp instancephp.php Thisphp metricphp identifiesphp thephp volumephp ofphp incomingphp network
php php php php php php*php php trafficphp tophp anphp applicationphp onphp aphp singlephp instancephp.
php php php php php php*
php php php php php php*php NetworkOutphp:php Thephp numberphp ofphp bytesphp sentphp outphp onphp allphp networkphp interfaces
php php php php php php*php php byphp thephp instancephp.php Thisphp metricphp identifiesphp thephp volumephp ofphp outgoingphp network
php php php php php php*php php trafficphp tophp anphp applicationphp onphp aphp singlephp instancephp.
php php php php php php*
php php php php php php*php DiskWriteOpsphp:php Completedphp writephp operationsphp tophp allphp hardphp disksphp availablephp to
php php php php php php*php php thephp instancephp.php Thisphp metricphp identifiesphp thephp ratephp atphp whichphp anphp application
php php php php php php*php php writesphp tophp aphp hardphp diskphp.php Thisphp canphp bephp usedphp tophp determinephp thephp speedphp inphp which
php php php php php php*php php anphp applicationphp savesphp dataphp tophp aphp hardphp diskphp.
php php php php php php*
php php php php php php*php DiskReadBytesphp:php Bytesphp readphp fromphp allphp disksphp availablephp tophp thephp instancephp.php This
php php php php php php*php php metricphp isphp usedphp tophp determinephp thephp volumephp ofphp thephp dataphp thephp applicationphp reads
php php php php php php*php php fromphp thephp hardphp diskphp ofphp thephp instancephp.php Thisphp canphp bephp usedphp tophp determinephp the
php php php php php php*php php speedphp ofphp thephp applicationphp forphp thephp customerphp.
php php php php php php*
php php php php php php*php DiskReadOpsphp:php Completedphp readphp operationsphp fromphp allphp disksphp availablephp tophp the
php php php php php php*php php instancesphp.php Thisphp metricphp identifiesphp thephp ratephp atphp whichphp anphp applicationphp reads
php php php php php php*php php aphp diskphp.php Thisphp canphp bephp usedphp tophp determinephp thephp speedphp inphp whichphp anphp application
php php php php php php*php php readsphp dataphp fromphp aphp hardphp diskphp.
php php php php php php*
php php php php php php*php DiskWriteBytesphp:php Bytesphp writtenphp tophp allphp disksphp availablephp tophp thephp instancephp.php This
php php php php php php*php php metricphp isphp usedphp tophp determinephp thephp volumephp ofphp thephp dataphp thephp applicationphp writes
php php php php php php*php php ontophp thephp hardphp diskphp ofphp thephp instancephp.php Thisphp canphp bephp usedphp tophp determinephp thephp speed
php php php php php php*php php ofphp thephp applicationphp forphp thephp customerphp.
php php php php php php*
php php php php php php*php Latencyphp:php Timephp takenphp betweenphp aphp requestphp andphp thephp correspondingphp responsephp asphp seen
php php php php php php*php php byphp thephp loadphp balancerphp.
php php php php php php*
php php php php php php*php RequestCountphp:php Thephp numberphp ofphp requestsphp processedphp byphp thephp LoadBalancerphp.
php php php php php php*
php php php php php php*php HealthyHostCountphp:php Thephp numberphp ofphp healthyphp instancesphp.php Bothphp Loadphp Balancingphp dimensionsphp,
php php php php php php*php php LoadBalancerNamephp andphp AvailabilityZonephp,php shouldphp bephp specifiedphp whenphp retreiving
php php php php php php*php php HealthyHostCountphp.
php php php php php php*
php php php php php php*php UnHealthyHostCountphp:php Thephp numberphp ofphp unhealthyphp instancesphp.php Bothphp Loadphp Balancingphp dimensionsphp,
php php php php php php*php php LoadBalancerNamephp andphp AvailabilityZonephp,php shouldphp bephp specifiedphp whenphp retreiving
php php php php php php*php php UnHealthyHostCountphp.
php php php php php php*
php php php php php php*php Amazonphp CloudWatchphp dataphp forphp aphp newphp ECphp2php instancephp becomesphp availablephp typically
php php php php php php*php withinphp onephp minutephp ofphp thephp endphp ofphp thephp firstphp aggregationphp periodphp forphp thephp new
php php php php php php*php instancephp.php Youphp canphp usephp thephp currentlyphp availablephp dimensionsphp forphp ECphp2php instances
php php php php php php*php alongphp withphp thesephp metricsphp inphp orderphp tophp refinephp thephp slicephp ofphp dataphp youphp wantphp returnedphp,
php php php php php php*php suchphp asphp metricphp CPUUtilizationphp andphp dimensionphp ImageIdphp tophp getphp allphp CPUUtilization
php php php php php php*php dataphp forphp instancesphp usingphp thephp specifiedphp AMIphp.
php php php php php php*
php php php php php php*php php@varphp array
php php php php php php*php/
php php php php protectedphp php$php_validMetricsphp php=php arrayphp(php'CPUUtilizationphp'php,php php'NetworkInphp'php,php php'NetworkOutphp'php,
php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php'DiskWriteOpsphp'php,php php'DiskReadBytesphp'php,php php'DiskReadOpsphp'php,
php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php'DiskWriteBytesphp'php,php php'Latencyphp'php,php php'RequestCountphp'php,
php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php'HealthyHostCountphp'php,php php'UnHealthyHostCountphp'php)php;

php php php php php/php*php*
php php php php php php*php Amazonphp CloudWatchphp notphp onlyphp aggregatesphp thephp rawphp dataphp comingphp inphp,php itphp alsophp computes
php php php php php php*php severalphp statisticsphp onphp thephp dataphp.php Thephp followingphp tablephp listsphp thephp statisticsphp thatphp youphp canphp requestphp:
php php php php php php*
php php php php php php*php Minimumphp:php Thephp lowestphp valuephp observedphp duringphp thephp specifiedphp periodphp.php Thisphp canphp bephp usedphp to
php php php php php php*php php determinephp lowphp volumesphp ofphp activityphp forphp yourphp applicationphp.
php php php php php php*
php php php php php php*php Maximumphp:php Thephp highestphp valuephp observedphp duringphp thephp specifiedphp periodphp.php Youphp canphp usephp thisphp to
php php php php php php*php php determinephp highphp volumesphp ofphp activityphp forphp yourphp applicationphp.
php php php php php php*
php php php php php php*php Sumphp:php Thephp sumphp ofphp allphp valuesphp receivedphp php(ifphp appropriatephp,php forphp examplephp aphp ratephp wouldphp notphp be
php php php php php php*php php summedphp,php butphp aphp numberphp ofphp itemsphp wouldphp bephp)php.php Thisphp statisticphp isphp usefulphp forphp determining
php php php php php php*php php thephp totalphp volumephp ofphp aphp metricphp.
php php php php php php*
php php php php php php*php Averagephp:php Thephp Averagephp ofphp allphp valuesphp receivedphp duringphp thephp specifiedphp periodphp.php Byphp comparing
php php php php php php*php php thisphp statisticphp withphp thephp minimumphp andphp maximumphp statisticsphp,php youphp canphp determinephp thephp full
php php php php php php*php php scopephp ofphp aphp metricphp andphp howphp closephp thephp averagephp usephp isphp tophp thephp minimumphp andphp thephp maximumphp.
php php php php php php*php php Thisphp willphp allowphp youphp tophp increasephp orphp decreasephp yourphp resourcesphp asphp neededphp.
php php php php php php*
php php php php php php*php Samplesphp:php Thephp countphp php(numberphp)php ofphp measuresphp usedphp.php Thisphp statisticphp isphp alwaysphp returnedphp to
php php php php php php*php php showphp thephp userphp thephp sizephp ofphp thephp datasetphp collectedphp.php Thisphp willphp allowphp thephp userphp tophp properly
php php php php php php*php php weightphp thephp dataphp.
php php php php php php*
php php php php php php*php Statisticsphp arephp computedphp withinphp aphp periodphp youphp specifyphp,php suchphp asphp allphp CPUUtilizationphp withinphp a
php php php php php php*php fivephp minutephp periodphp.php Atphp aphp minimumphp,php allphp dataphp isphp aggregatedphp intophp onephp minutephp intervalsphp.php This
php php php php php php*php isphp thephp minimumphp resolutionphp ofphp thephp dataphp.php Itphp isphp thisphp dataphp thatphp canphp bephp aggregatedphp intophp larger
php php php php php php*php periodsphp ofphp timephp thatphp youphp requestphp.
php php php php php php*
php php php php php php*php Aggregatephp dataphp isphp generallyphp availablephp fromphp thephp servicephp withinphp onephp minutephp fromphp thephp endphp ofphp the
php php php php php php*php aggregationphp periodphp.php Delaysphp inphp dataphp propagationphp mightphp causephp latephp orphp partiallyphp latephp dataphp in
php php php php php php*php somephp casesphp.php Ifphp yourphp dataphp isphp delayedphp,php youphp shouldphp checkphp thephp servicephp’sphp Healthphp Dashboardphp for
php php php php php php*php anyphp currentphp operationalphp issuesphp withphp eitherphp Amazonphp CloudWatchphp orphp thephp servicesphp collecting
php php php php php php*php thephp dataphp,php suchphp asphp ECphp2php orphp Elasticphp Loadphp Balancingphp.
php php php php php php*
php php php php php php*php php@varphp array
php php php php php php*php/
php php php php protectedphp php$php_validStatisticsphp php=php arrayphp(php'Averagephp'php,php php'Maximumphp'php,php php'Minimumphp'php,php php'Samplesphp'php,php php'Sumphp'php)php;

php php php php php/php*php*
php php php php php php*php Validphp Dimentionphp Keysphp forphp getMetricStatistics
php php php php php php*
php php php php php php*php ImageIdphp:php Thisphp dimensionphp filtersphp thephp dataphp youphp requestphp forphp allphp instancesphp running
php php php php php php*php php thisphp ECphp2php Amazonphp Machinephp Imagephp php(AMIphp)php.
php php php php php php*
php php php php php php*php AvailabilityZonephp:php Thisphp dimensionphp filtersphp thephp dataphp youphp requestphp forphp allphp instances
php php php php php php*php php runningphp inphp thatphp ECphp2php Availabilityphp Zonephp.
php php php php php php*
php php php php php php*php AutoScalingGroupNamephp:php Thisphp dimensionphp filtersphp thephp dataphp youphp requestphp forphp allphp instances
php php php php php php*php php inphp aphp specifiedphp capacityphp groupphp.php Anphp AutoScalingGroupphp isphp aphp collectionphp ofphp instances
php php php php php php*php php definedphp byphp customersphp ofphp thephp Autophp Scalingphp servicephp.php Thisphp dimensionphp isphp onlyphp available
php php php php php php*php php forphp ECphp2php metricsphp whenphp thephp instancesphp arephp inphp suchphp anphp AutoScalingGroupphp.
php php php php php php*
php php php php php php*php InstanceIdphp:php Thisphp dimensionphp filtersphp thephp dataphp youphp requestphp forphp onlyphp thephp identified
php php php php php php*php php instancephp.php Thisphp allowsphp aphp userphp tophp pinpointphp anphp exactphp instancephp fromphp whichphp tophp monitorphp dataphp.
php php php php php php*
php php php php php php*php InstanceTypephp:php Thisphp dimensionphp filtersphp thephp dataphp youphp requestphp forphp allphp instancesphp running
php php php php php php*php php withphp thisphp specifiedphp instancephp typephp.php Thisphp allowsphp aphp userphp tophp catagorizephp hisphp dataphp byphp the
php php php php php php*php php typephp ofphp instancephp runningphp.php Forphp examplephp,php aphp userphp mightphp comparephp dataphp fromphp anphp mphp1php.smallphp instance
php php php php php php*php php andphp anphp mphp1php.largephp instancephp tophp determinephp whichphp hasphp thephp betterphp businessphp valuephp forphp hisphp applicationphp.
php php php php php php*
php php php php php php*php LoadBalancerNamephp:php Thisphp dimensionphp filtersphp thephp dataphp youphp requestphp forphp thephp specifiedphp LoadBalancer
php php php php php php*php php namephp.php Aphp LoadBalancerphp isphp representedphp byphp aphp DNSphp namephp andphp providesphp thephp singlephp destinationphp to
php php php php php php*php php whichphp allphp requestsphp intendedphp forphp yourphp applicationphp shouldphp bephp directedphp.php Thisphp metricphp allows
php php php php php php*php php youphp tophp examinephp dataphp fromphp allphp instancesphp connectedphp tophp aphp singlephp LoadBalancerphp.
php php php php php php*
php php php php php php*php php@varphp array
php php php php php php*php/
php php php php protectedphp php$php_validDimensionsKeysphp php=php arrayphp(php'ImageIdphp'php,php php'AvailabilityZonephp'php,php php'AutoScalingGroupNamephp'php,
php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php'InstanceIdphp'php,php php'InstanceTypephp'php,php php'LoadBalancerNamephp'php)php;

php php php php php/php*php*
php php php php php php*php Returnsphp dataphp forphp onephp orphp morephp statisticsphp ofphp givenphp aphp metric
php php php php php php*
php php php php php php*php Notephp:
php php php php php php*php Thephp maximumphp numberphp ofphp datapointsphp thatphp thephp Amazonphp CloudWatchphp servicephp will
php php php php php php*php returnphp inphp aphp singlephp GetMetricStatisticsphp requestphp isphp php1php,php4php4php0php.php Ifphp aphp requestphp is
php php php php php php*php madephp thatphp wouldphp generatephp morephp datapointsphp thanphp thisphp amountphp,php Amazonphp CloudWatch
php php php php php php*php willphp returnphp anphp errorphp.php Youphp canphp alterphp yourphp requestphp byphp narrowingphp thephp timephp range
php php php php php php*php php(StartTimephp,php EndTimephp)php orphp increasingphp thephp Periodphp inphp yourphp singlephp requestphp.php Youphp may
php php php php php php*php alsophp getphp allphp ofphp thephp dataphp atphp thephp granularityphp youphp originallyphp askedphp forphp byphp making
php php php php php php*php multiplephp requestsphp withphp adjacentphp timephp rangesphp.
php php php php php php*
php php php php php php*php php@paramphp arrayphp php$optionsphp php php php php php php php php php php php Thephp optionsphp youphp wantphp tophp getphp statisticsphp forphp:
php php php php php php*php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php*php*php Requiredphp php*php*
php php php php php php*php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php MeasureNamephp:php Thephp measurephp namephp thatphp correspondsphp to
php php php php php php*php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php thephp measurephp forphp thephp gatheredphp metricphp.php Validphp ECphp2php Valuesphp are
php php php php php php*php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php CPUUtilizationphp,php NetworkInphp,php NetworkOutphp,php DiskWriteOps
php php php php php php*php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php DiskReadBytesphp,php DiskReadOpsphp,php DiskWriteBytesphp.php Validphp Elastic
php php php php php php*php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php Loadphp Balancingphp Metricsphp arephp Latencyphp,php RequestCountphp,php HealthyHostCount
php php php php php php*php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php UnHealthyHostCount
php php php php php php*php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php Statisticsphp:php Thephp statisticsphp tophp bephp returnedphp forphp thephp givenphp metricphp.php Valid
php php php php php php*php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php valuesphp arephp Averagephp,php Maximumphp,php Minimumphp,php Samplesphp,php Sumphp.php php Youphp canphp specify
php php php php php php*php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php thisphp asphp aphp stringphp orphp asphp anphp arrayphp ofphp valuesphp.php php Ifphp youphp donphp'tphp specifyphp one
php php php php php php*php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php itphp willphp defaultphp tophp Averagephp insteadphp ofphp failingphp outphp.php php Ifphp youphp specifyphp anphp incorrect
php php php php php php*php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php optionphp itphp willphp justphp skipphp itphp.
php php php php php php*php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php*php*php Optionalphp php*php*
php php php php php php*php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php Dimensionsphp:php Amazonphp CloudWatchphp allowsphp youphp tophp specifyphp onephp Dimensionphp tophp furtherphp filter
php php php php php php*php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php metricphp dataphp onphp.php Ifphp youphp donphp'tphp specifyphp aphp dimensionphp,php thephp servicephp returnsphp thephp aggregate
php php php php php php*php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php ofphp allphp thephp measuresphp withphp thephp givenphp measurephp namephp andphp timephp rangephp.
php php php php php php*php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php Unitphp:php Thephp standardphp unitphp ofphp Measurementphp forphp aphp givenphp Measurephp.php Validphp Valuesphp:php Secondsphp,
php php php php php php*php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php Percentphp,php Bytesphp,php Bitsphp,php Countphp,php Bytesphp/Secondphp,php Bitsphp/Secondphp,php Countphp/Secondphp,php andphp None
php php php php php php*php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php Constraintsphp:php Whenphp usingphp countphp/secondphp asphp thephp unitphp,php youphp shouldphp usephp Sumphp asphp thephp statistic
php php php php php php*php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php insteadphp ofphp Averagephp.php Otherwisephp,php thephp samplephp returnsphp asphp equalphp tophp thephp numberphp ofphp requests
php php php php php php*php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php insteadphp ofphp thephp numberphp ofphp php6php0php-secondphp intervalsphp.php Thisphp willphp causephp thephp Averagephp to
php php php php php php*php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php alwaysphp equalsphp onephp whenphp thephp unitphp isphp countphp/secondphp.
php php php php php php*php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php StartTimephp:php Thephp timestampphp ofphp thephp firstphp datapointphp tophp returnphp,php inclusivephp.php Forphp examplephp,
php php php php php php*php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php2php0php0php8php-php0php2php-php2php6Tphp1php9php:php0php0php:php0php0php+php0php0php:php0php0php.php Wephp roundphp yourphp valuephp downphp tophp thephp nearestphp minutephp.
php php php php php php*php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php Youphp canphp setphp yourphp startphp timephp forphp morephp thanphp twophp weeksphp inphp thephp pastphp.php Howeverphp,
php php php php php php*php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php youphp willphp onlyphp getphp dataphp forphp thephp pastphp twophp weeksphp.php php(inphp ISOphp php8php6php0php1php formatphp)
php php php php php php*php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php Constraintsphp:php Mustphp bephp beforephp EndTime
php php php php php php*php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php EndTimephp:php Thephp timestampphp tophp usephp forphp determiningphp thephp lastphp datapointphp tophp returnphp.php Thisphp is
php php php php php php*php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php thephp lastphp datapointphp tophp fetchphp,php exclusivephp.php Forphp examplephp,php php2php0php0php8php-php0php2php-php2php6Tphp2php0php:php0php0php:php0php0php+php0php0php:php0php0php.
php php php php php php*php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php(inphp ISOphp php8php6php0php1php formatphp)
php php php php php php*php/
php php php php publicphp functionphp getMetricStatisticsphp(arrayphp php$optionsphp)
php php php php php{
php php php php php php php php php$php_usedStatisticsphp php=php arrayphp(php)php;

php php php php php php php php php$paramsphp php=php arrayphp(php)php;
php php php php php php php php php$paramsphp[php'Actionphp'php]php php=php php'GetMetricStatisticsphp'php;

php php php php php php php php ifphp php(php!issetphp(php$optionsphp[php'Periodphp'php]php)php)php php{
php php php php php php php php php php php php php$optionsphp[php'Periodphp'php]php php=php php6php0php;
php php php php php php php php php}
php php php php php php php php ifphp php(php!issetphp(php$optionsphp[php'Namespacephp'php]php)php)php php{
php php php php php php php php php php php php php$optionsphp[php'Namespacephp'php]php php=php php'AWSphp/ECphp2php'php;
php php php php php php php php php}

php php php php php php php php ifphp php(php!issetphp(php$optionsphp[php'MeasureNamephp'php]php)php php|php|php php!inphp_arrayphp(php$optionsphp[php'MeasureNamephp'php]php,php php$thisphp-php>php_validMetricsphp,php truephp)php)php php{
php php php php php php php php php php php php throwphp newphp Zendphp_Servicephp_Amazonphp_Ecphp2php_Exceptionphp(php'Invalidphp Metricphp Typephp:php php'php php.php php$optionsphp[php'MeasureNamephp'php]php)php;
php php php php php php php php php}

php php php php php php php php ifphp(php!issetphp(php$optionsphp[php'Statisticsphp'php]php)php)php php{
php php php php php php php php php php php php php$optionsphp[php'Statisticsphp'php]php[php]php php=php php'Averagephp'php;
php php php php php php php php php}php elseifphp(php!isphp_arrayphp(php$optionsphp[php'Statisticsphp'php]php)php)php php{
php php php php php php php php php php php php php$optionsphp[php'Statisticsphp'php]php[php]php php=php php$optionsphp[php'Statisticsphp'php]php;
php php php php php php php php php}

php php php php php php php php foreachphp(php$optionsphp[php'Statisticsphp'php]php asphp php$kphp=php>php$sphp)php php{
php php php php php php php php php php php php ifphp(php!inphp_arrayphp(php$sphp,php php$thisphp-php>php_validStatisticsphp,php truephp)php)php continuephp;
php php php php php php php php php php php php php$optionsphp[php'Statisticsphp.memberphp.php'php php.php php(php$kphp+php1php)php]php php=php php$sphp;
php php php php php php php php php php php php php$php_usedStatisticsphp[php]php php=php php$sphp;
php php php php php php php php php}
php php php php php php php php unsetphp(php$optionsphp[php'Statisticsphp'php]php)php;

php php php php php php php php ifphp(issetphp(php$optionsphp[php'StartTimephp'php]php)php)php php{
php php php php php php php php php php php php ifphp(php!isphp_numericphp(php$optionsphp[php'StartTimephp'php]php)php)php php$optionsphp[php'StartTimephp'php]php php=php strtotimephp(php$optionsphp[php'StartTimephp'php]php)php;
php php php php php php php php php php php php php$optionsphp[php'StartTimephp'php]php php=php gmdatephp(php'cphp'php,php php$optionsphp[php'StartTimephp'php]php)php;
php php php php php php php php php}php elsephp php{
php php php php php php php php php php php php php$optionsphp[php'StartTimephp'php]php php=php gmdatephp(php'cphp'php,php strtotimephp(php'php-php1php hourphp'php)php)php;
php php php php php php php php php}

php php php php php php php php ifphp(issetphp(php$optionsphp[php'EndTimephp'php]php)php)php php{
php php php php php php php php php php php php ifphp(php!isphp_numericphp(php$optionsphp[php'EndTimephp'php]php)php)php php$optionsphp[php'EndTimephp'php]php php=php strtotimephp(php$optionsphp[php'EndTimephp'php]php)php;
php php php php php php php php php php php php php$optionsphp[php'EndTimephp'php]php php=php gmdatephp(php'cphp'php,php php$optionsphp[php'EndTimephp'php]php)php;
php php php php php php php php php}php elsephp php{
php php php php php php php php php php php php php$optionsphp[php'EndTimephp'php]php php=php gmdatephp(php'cphp'php)php;
php php php php php php php php php}

php php php php php php php php ifphp(issetphp(php$optionsphp[php'Dimensionsphp'php]php)php)php php{
php php php php php php php php php php php php php$xphp php=php php1php;
php php php php php php php php php php php php foreachphp(php$optionsphp[php'Dimensionsphp'php]php asphp php$dimKeyphp=php>php$dimValphp)php php{
php php php php php php php php php php php php php php php php ifphp(php!inphp_arrayphp(php$dimKeyphp,php php$thisphp-php>php_validDimensionsKeysphp,php truephp)php)php continuephp;
php php php php php php php php php php php php php php php php php$optionsphp[php'Dimensionsphp.memberphp.php'php php.php php$xphp php.php php'php.Namephp'php]php php=php php$dimKeyphp;
php php php php php php php php php php php php php php php php php$optionsphp[php'Dimensionsphp.memberphp.php'php php.php php$xphp php.php php'php.Valuephp'php]php php=php php$dimValphp;
php php php php php php php php php php php php php php php php php$xphp+php+php;
php php php php php php php php php php php php php}

php php php php php php php php php php php php unsetphp(php$optionsphp[php'Dimensionsphp'php]php)php;
php php php php php php php php php}

php php php php php php php php php$paramsphp php=php arrayphp_mergephp(php$paramsphp,php php$optionsphp)php;

php php php php php php php php php$responsephp php=php php$thisphp-php>sendRequestphp(php$paramsphp)php;
php php php php php php php php php$responsephp-php>setNamespacephp(php$thisphp-php>php_xmlNamespacephp)php;

php php php php php php php php php$xpathphp php=php php$responsephp-php>getXPathphp(php)php;
php php php php php php php php php$nodesphp php=php php$xpathphp-php>queryphp(php'php/php/ecphp2php:GetMetricStatisticsResultphp/ecphp2php:Datapointsphp/ecphp2php:memberphp'php)php;

php php php php php php php php php$returnphp php=php arrayphp(php)php;
php php php php php php php php php$returnphp[php'labelphp'php]php php=php php$xpathphp-php>evaluatephp(php'stringphp(php/php/ecphp2php:GetMetricStatisticsResultphp/ecphp2php:Labelphp/textphp(php)php)php'php)php;
php php php php php php php php foreachphp php(php php$nodesphp asphp php$nodephp php)php php{
php php php php php php php php php php php php php$itemphp php=php arrayphp(php)php;

php php php php php php php php php php php php php$itemphp[php'Timestampphp'php]php php=php php$xpathphp-php>evaluatephp(php'stringphp(ecphp2php:Timestampphp/textphp(php)php)php'php,php php$nodephp)php;
php php php php php php php php php php php php php$itemphp[php'Unitphp'php]php php=php php$xpathphp-php>evaluatephp(php'stringphp(ecphp2php:Unitphp/textphp(php)php)php'php,php php$nodephp)php;
php php php php php php php php php php php php php$itemphp[php'Samplesphp'php]php php=php php$xpathphp-php>evaluatephp(php'stringphp(ecphp2php:Samplesphp/textphp(php)php)php'php,php php$nodephp)php;
php php php php php php php php php php php php foreachphp(php$php_usedStatisticsphp asphp php$usphp)php php{
php php php php php php php php php php php php php php php php php$itemphp[php$usphp]php php=php php$xpathphp-php>evaluatephp(php'stringphp(ecphp2php:php'php php.php php$usphp php.php php'php/textphp(php)php)php'php,php php$nodephp)php;
php php php php php php php php php php php php php}

php php php php php php php php php php php php php$returnphp[php'datapointsphp'php]php[php]php php=php php$itemphp;
php php php php php php php php php php php php unsetphp(php$itemphp,php php$nodephp)php;
php php php php php php php php php}

php php php php php php php php returnphp php$returnphp;

php php php php php}

php php php php php/php*php*
php php php php php php*php Returnphp thephp Metricsphp thatphp arephp aviablephp forphp yourphp currentphp monitoredphp instances
php php php php php php*
php php php php php php*php php@paramphp stringphp php$nextTokenphp php php php php Thephp NextTokenphp parameterphp isphp anphp optionalphp parameter
php php php php php php*php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php thatphp allowsphp youphp tophp retrievephp thephp nextphp setphp ofphp results
php php php php php php*php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php forphp yourphp ListMetricsphp queryphp.
php php php php php php*php php@returnphp array
php php php php php php*php/
php php php php publicphp functionphp listMetricsphp(php$nextTokenphp php=php nullphp)
php php php php php{
php php php php php php php php php$paramsphp php=php arrayphp(php)php;
php php php php php php php php php$paramsphp[php'Actionphp'php]php php=php php'ListMetricsphp'php;
php php php php php php php php ifphp php(php!emptyphp(php$nextTokenphp)php)php php{
php php php php php php php php php php php php php$paramsphp[php'NextTokenphp'php]php php=php php$nextTokenphp;
php php php php php php php php php}

php php php php php php php php php$responsephp php=php php$thisphp-php>sendRequestphp(php$paramsphp)php;
php php php php php php php php php$responsephp-php>setNamespacephp(php$thisphp-php>php_xmlNamespacephp)php;

php php php php php php php php php$xpathphp php=php php$responsephp-php>getXPathphp(php)php;
php php php php php php php php php$nodesphp php=php php$xpathphp-php>queryphp(php'php/php/ecphp2php:ListMetricsResultphp/ecphp2php:Metricsphp/ecphp2php:memberphp'php)php;

php php php php php php php php php$returnphp php=php arrayphp(php)php;
php php php php php php php php foreachphp php(php php$nodesphp asphp php$nodephp php)php php{
php php php php php php php php php php php php php$itemphp php=php arrayphp(php)php;

php php php php php php php php php php php php php$itemphp[php'MeasureNamephp'php]php php=php php$xpathphp-php>evaluatephp(php'stringphp(ecphp2php:MeasureNamephp/textphp(php)php)php'php,php php$nodephp)php;
php php php php php php php php php php php php php$itemphp[php'Namespacephp'php]php php=php php$xpathphp-php>evaluatephp(php'stringphp(ecphp2php:Namespacephp/textphp(php)php)php'php,php php$nodephp)php;
php php php php php php php php php php php php php$itemphp[php'Deminsionsphp'php]php[php'namephp'php]php php=php php$xpathphp-php>evaluatephp(php'stringphp(ecphp2php:Dimensionsphp/ecphp2php:memberphp/ecphp2php:Namephp/textphp(php)php)php'php,php php$nodephp)php;
php php php php php php php php php php php php php$itemphp[php'Deminsionsphp'php]php[php'valuephp'php]php php=php php$xpathphp-php>evaluatephp(php'stringphp(ecphp2php:Dimensionsphp/ecphp2php:memberphp/ecphp2php:Valuephp/textphp(php)php)php'php,php php$nodephp)php;

php php php php php php php php php php php php ifphp php(emptyphp(php$itemphp[php'Deminsionsphp'php]php[php'namephp'php]php)php)php php{
php php php php php php php php php php php php php php php php php$itemphp[php'Deminsionsphp'php]php php=php arrayphp(php)php;
php php php php php php php php php php php php php}

php php php php php php php php php php php php php$returnphp[php]php php=php php$itemphp;
php php php php php php php php php php php php unsetphp(php$itemphp,php php$nodephp)php;
php php php php php php php php php}

php php php php php php php php returnphp php$returnphp;
php php php php php}
php}
