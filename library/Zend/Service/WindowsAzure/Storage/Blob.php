<php?php
php/php*php*
php php*php Zendphp Framework
php php*
php php*php LICENSE
php php*
php php*php Thisphp sourcephp filephp isphp subjectphp tophp thephp newphp BSDphp licensephp thatphp isphp bundled
php php*php withphp thisphp packagephp inphp thephp filephp LICENSEphp.txtphp.
php php*php Itphp isphp alsophp availablephp throughphp thephp worldphp-widephp-webphp atphp thisphp URLphp:
php php*php httpphp:php/php/frameworkphp.zendphp.comphp/licensephp/newphp-bsd
php php*php Ifphp youphp didphp notphp receivephp aphp copyphp ofphp thephp licensephp andphp arephp unablephp to
php php*php obtainphp itphp throughphp thephp worldphp-widephp-webphp,php pleasephp sendphp anphp email
php php*php tophp licensephp@zendphp.comphp sophp wephp canphp sendphp youphp aphp copyphp immediatelyphp.
php php*
php php*php php@categoryphp php php Zend
php php*php php@packagephp php php php Zendphp_Servicephp_WindowsAzure
php php*php php@subpackagephp Storage
php php*php php@copyrightphp php Copyrightphp php(cphp)php php2php0php0php5php-php2php0php1php0php Zendphp Technologiesphp USAphp Incphp.php php(httpphp:php/php/wwwphp.zendphp.comphp)
php php*php php@licensephp php php php httpphp:php/php/todophp php php php php namephp_todo
php php*php php@versionphp php php php php$Idphp:php Blobphp.phpphp php2php3php5php8php4php php2php0php1php0php-php1php2php-php2php8php php1php9php:php5php1php:php4php9Zphp matthewphp php$
php php*php/

php/php*php*
php php*php php@seephp Zendphp_Servicephp_WindowsAzurephp_Credentialsphp_CredentialsAbstractphp_SharedKey
php php*php/
requirephp_oncephp php'Zendphp/Servicephp/WindowsAzurephp/Credentialsphp/SharedKeyphp.phpphp'php;

php/php*php*
php php*php php@seephp Zendphp_Servicephp_WindowsAzurephp_Credentialsphp_SharedAccessSignature
php php*php/
requirephp_oncephp php'Zendphp/Servicephp/WindowsAzurephp/Credentialsphp/SharedAccessSignaturephp.phpphp'php;

php/php*php*
php php*php php@seephp Zendphp_Servicephp_WindowsAzurephp_RetryPolicyphp_RetryPolicyAbstract
php php*php/
requirephp_oncephp php'Zendphp/Servicephp/WindowsAzurephp/RetryPolicyphp/RetryPolicyAbstractphp.phpphp'php;

php/php*php*
php php*php php@seephp Zendphp_Httpphp_Client
php php*php/
requirephp_oncephp php'Zendphp/Httpphp/Clientphp.phpphp'php;

php/php*php*
php php*php php@seephp Zendphp_Httpphp_Response
php php*php/
requirephp_oncephp php'Zendphp/Httpphp/Responsephp.phpphp'php;

php/php*php*
php php*php php@seephp Zendphp_Servicephp_WindowsAzurephp_Storage
php php*php/
requirephp_oncephp php'Zendphp/Servicephp/WindowsAzurephp/Storagephp.phpphp'php;

php/php*php*
php php*php php@seephp Zendphp_Servicephp_WindowsAzurephp_Storagephp_BlobContainer
php php*php/
requirephp_oncephp php'Zendphp/Servicephp/WindowsAzurephp/Storagephp/BlobContainerphp.phpphp'php;

php/php*php*
php php*php php@seephp Zendphp_Servicephp_WindowsAzurephp_Storagephp_BlobInstance
php php*php/
requirephp_oncephp php'Zendphp/Servicephp/WindowsAzurephp/Storagephp/BlobInstancephp.phpphp'php;

php/php*php*
php php*php php@seephp Zendphp_Servicephp_WindowsAzurephp_Storagephp_PageRegionInstance
php php*php/
requirephp_oncephp php'Zendphp/Servicephp/WindowsAzurephp/Storagephp/PageRegionInstancephp.phpphp'php;

php/php*php*
php php*php php@seephp Zendphp_Servicephp_WindowsAzurephp_Storagephp_LeaseInstance
php php*php/
requirephp_oncephp php'Zendphp/Servicephp/WindowsAzurephp/Storagephp/LeaseInstancephp.phpphp'php;

php/php*php*
php php*php php@seephp Zendphp_Servicephp_WindowsAzurephp_Storagephp_SignedIdentifier
php php*php/
requirephp_oncephp php'Zendphp/Servicephp/WindowsAzurephp/Storagephp/SignedIdentifierphp.phpphp'php;

php/php*php*
php php*php php@seephp Zendphp_Servicephp_WindowsAzurephp_Exception
php php*php/
requirephp_oncephp php'Zendphp/Servicephp/WindowsAzurephp/Exceptionphp.phpphp'php;


php/php*php*
php php*php php@categoryphp php php Zend
php php*php php@packagephp php php php Zendphp_Servicephp_WindowsAzure
php php*php php@subpackagephp Storage
php php*php php@copyrightphp php Copyrightphp php(cphp)php php2php0php0php5php-php2php0php1php0php Zendphp Technologiesphp USAphp Incphp.php php(httpphp:php/php/wwwphp.zendphp.comphp)
php php*php php@licensephp php php php httpphp:php/php/frameworkphp.zendphp.comphp/licensephp/newphp-bsdphp php php php php Newphp BSDphp License
php php*php/
classphp Zendphp_Servicephp_WindowsAzurephp_Storagephp_Blobphp extendsphp Zendphp_Servicephp_WindowsAzurephp_Storage
php{
php	php/php*php*
php	php php*php ACLphp php-php Privatephp access
php	php php*php/
php	constphp ACLphp_PRIVATEphp php=php nullphp;

php	php/php*php*
php	php php*php ACLphp php-php Publicphp accessphp php(readphp allphp blobsphp)
php	php php*
php	php php*php php@deprecatedphp Usephp ACLphp_PUBLICphp_CONTAINERphp orphp ACLphp_PUBLICphp_BLOBphp insteadphp.
php	php php*php/
php	constphp ACLphp_PUBLICphp php=php php'containerphp'php;
php	
php	php/php*php*
php	php php*php ACLphp php-php Blobphp Publicphp accessphp php(readphp allphp blobsphp)
php	php php*php/
php	constphp ACLphp_PUBLICphp_BLOBphp php=php php'blobphp'php;

php	php/php*php*
php	php php*php ACLphp php-php Containerphp Publicphp accessphp php(enumeratephp andphp readphp allphp blobsphp)
php	php php*php/
php	constphp ACLphp_PUBLICphp_CONTAINERphp php=php php'containerphp'php;

php	php/php*php*
php	php php*php Blobphp leasephp constants
php	php php*php/
php	constphp LEASEphp_ACQUIREphp php=php php'acquirephp'php;
php	constphp LEASEphp_RENEWphp php php php=php php'renewphp'php;
php	constphp LEASEphp_RELEASEphp php=php php'releasephp'php;
php	constphp LEASEphp_BREAKphp php php php=php php'breakphp'php;

php	php/php*php*
php	php php*php Maximalphp blobphp sizephp php(inphp bytesphp)
php	php php*php/
php	constphp MAXphp_BLOBphp_SIZEphp php=php php6php7php1php0php8php8php6php4php;

php	php/php*php*
php	php php*php Maximalphp blobphp transferphp sizephp php(inphp bytesphp)
php	php php*php/
php	constphp MAXphp_BLOBphp_TRANSFERphp_SIZEphp php=php php4php1php9php4php3php0php4php;

php	php/php*php*
php	php php*php Blobphp types
php	php php*php/
php	constphp BLOBTYPEphp_BLOCKphp php=php php'BlockBlobphp'php;
php	constphp BLOBTYPEphp_PAGEphp php php=php php'PageBlobphp'php;

php	php/php*php*
php	php php*php Putphp pagephp writephp options
php	php php*php/
php	constphp PAGEphp_WRITEphp_UPDATEphp php=php php'updatephp'php;
php	constphp PAGEphp_WRITEphp_CLEARphp php php=php php'clearphp'php;

php	php/php*php*
php	php php*php Streamphp wrapperphp clients
php	php php*
php	php php*php php@varphp array
php	php php*php/
php	protectedphp staticphp php$php_wrapperClientsphp php=php arrayphp(php)php;

php	php/php*php*
php	php php*php SharedAccessSignaturephp credentials
php	php php*
php	php php*php php@varphp Zendphp_Servicephp_WindowsAzurephp_Credentialsphp_SharedAccessSignature
php	php php*php/
php	privatephp php$php_sharedAccessSignatureCredentialsphp php=php nullphp;

php	php/php*php*
php	php php*php Createsphp aphp newphp Zendphp_Servicephp_WindowsAzurephp_Storagephp_Blobphp instance
php	php php*
php	php php*php php@paramphp stringphp php$hostphp Storagephp hostphp name
php	php php*php php@paramphp stringphp php$accountNamephp Accountphp namephp forphp Windowsphp Azure
php	php php*php php@paramphp stringphp php$accountKeyphp Accountphp keyphp forphp Windowsphp Azure
php	php php*php php@paramphp booleanphp php$usePathStyleUriphp Usephp pathphp-stylephp URIphp's
php	php php*php php@paramphp Zendphp_Servicephp_WindowsAzurephp_RetryPolicyphp_RetryPolicyAbstractphp php$retryPolicyphp Retryphp policyphp tophp usephp whenphp makingphp requests
php	php php*php/
php	publicphp functionphp php_php_constructphp(php$hostphp php=php Zendphp_Servicephp_WindowsAzurephp_Storagephp:php:URLphp_DEVphp_BLOBphp,php php$accountNamephp php=php Zendphp_Servicephp_WindowsAzurephp_Credentialsphp_CredentialsAbstractphp:php:DEVSTOREphp_ACCOUNTphp,php php$accountKeyphp php=php Zendphp_Servicephp_WindowsAzurephp_Credentialsphp_CredentialsAbstractphp:php:DEVSTOREphp_KEYphp,php php$usePathStyleUriphp php=php falsephp,php Zendphp_Servicephp_WindowsAzurephp_RetryPolicyphp_RetryPolicyAbstractphp php$retryPolicyphp php=php nullphp)
php	php{
php	php	parentphp:php:php_php_constructphp(php$hostphp,php php$accountNamephp,php php$accountKeyphp,php php$usePathStyleUriphp,php php$retryPolicyphp)php;

php	php	php/php/php APIphp version
php	php	php$thisphp-php>php_apiVersionphp php=php php'php2php0php0php9php-php0php9php-php1php9php'php;

php	php	php/php/php SharedAccessSignaturephp credentials
php	php	php$thisphp-php>php_sharedAccessSignatureCredentialsphp php=php newphp Zendphp_Servicephp_WindowsAzurephp_Credentialsphp_SharedAccessSignaturephp(php$accountNamephp,php php$accountKeyphp,php php$usePathStyleUriphp)php;
php	php}

php	php/php*php*
php	php php*php Checkphp ifphp aphp blobphp exists
php	php php*
php	php php*php php@paramphp stringphp php$containerNamephp Containerphp name
php	php php*php php@paramphp stringphp php$blobNamephp php php php php php Blobphp name
php	php php*php php@paramphp stringphp php$snapshotIdphp php php php Snapshotphp identifier
php	php php*php php@returnphp boolean
php	php php*php/
php	publicphp functionphp blobExistsphp(php$containerNamephp php=php php'php'php,php php$blobNamephp php=php php'php'php,php php$snapshotIdphp php=php nullphp)
php	php{
php	php	ifphp php(php$containerNamephp php=php=php=php php'php'php)php php{
php	php	php	throwphp newphp Zendphp_Servicephp_WindowsAzurephp_Exceptionphp(php'Containerphp namephp isphp notphp specifiedphp.php'php)php;
php	php	php}
php	php	ifphp php(php!selfphp:php:isValidContainerNamephp(php$containerNamephp)php)php php{
php	php	php	throwphp newphp Zendphp_Servicephp_WindowsAzurephp_Exceptionphp(php'Containerphp namephp doesphp notphp adherephp tophp containerphp namingphp conventionsphp.php Seephp httpphp:php/php/msdnphp.microsoftphp.comphp/enphp-usphp/libraryphp/ddphp1php3php5php7php1php5php.aspxphp forphp morephp informationphp.php'php)php;
php	php	php}
php	php	ifphp php(php$blobNamephp php=php=php=php php'php'php)php php{
php	php	php	throwphp newphp Zendphp_Servicephp_WindowsAzurephp_Exceptionphp(php'Blobphp namephp isphp notphp specifiedphp.php'php)php;
php	php	php}

php	php	php/php/php Getphp blobphp instance
php	php	tryphp php{
php	php	php	php$thisphp-php>getBlobInstancephp(php$containerNamephp,php php$blobNamephp,php php$snapshotIdphp)php;
php	php	php}php catchphp php(Zendphp_Servicephp_WindowsAzurephp_Exceptionphp php$ephp)php php{
php	php	php	returnphp falsephp;
php	php	php}

php	php	returnphp truephp;
php	php}

php	php/php*php*
php	php php*php Checkphp ifphp aphp containerphp exists
php	php php*
php	php php*php php@paramphp stringphp php$containerNamephp Containerphp name
php	php php*php php@returnphp boolean
php	php php*php/
php	publicphp functionphp containerExistsphp(php$containerNamephp php=php php'php'php)
php	php{
php	php	ifphp php(php$containerNamephp php=php=php=php php'php'php)php php{
php	php	php	throwphp newphp Zendphp_Servicephp_WindowsAzurephp_Exceptionphp(php'Containerphp namephp isphp notphp specifiedphp.php'php)php;
php	php	php}
php	php	ifphp php(php!selfphp:php:isValidContainerNamephp(php$containerNamephp)php)php php{
php	php	php	throwphp newphp Zendphp_Servicephp_WindowsAzurephp_Exceptionphp(php'Containerphp namephp doesphp notphp adherephp tophp containerphp namingphp conventionsphp.php Seephp httpphp:php/php/msdnphp.microsoftphp.comphp/enphp-usphp/libraryphp/ddphp1php3php5php7php1php5php.aspxphp forphp morephp informationphp.php'php)php;
php	php	php}
php	php	php	
php	php	php/php/php Listphp containers
php	php	php$containersphp php=php php$thisphp-php>listContainersphp(php$containerNamephp,php php1php)php;
php	php	foreachphp php(php$containersphp asphp php$containerphp)php php{
php	php	php	ifphp php(php$containerphp-php>Namephp php=php=php php$containerNamephp)php php{
php	php	php	php	returnphp truephp;
php	php	php	php}
php	php	php}

php	php	returnphp falsephp;
php	php}

php	php/php*php*
php	php php*php Createphp container
php	php php*
php	php php*php php@paramphp stringphp php$containerNamephp Containerphp name
php	php php*php php@paramphp arrayphp php php$metadataphp php php php php php Keyphp/valuephp pairsphp ofphp metaphp data
php	php php*php php@returnphp objectphp Containerphp properties
php	php php*php php@throwsphp Zendphp_Servicephp_WindowsAzurephp_Exception
php	php php*php/
php	publicphp functionphp createContainerphp(php$containerNamephp php=php php'php'php,php php$metadataphp php=php arrayphp(php)php)
php	php{
php	php	ifphp php(php$containerNamephp php=php=php=php php'php'php)php php{
php	php	php	throwphp newphp Zendphp_Servicephp_WindowsAzurephp_Exceptionphp(php'Containerphp namephp isphp notphp specifiedphp.php'php)php;
php	php	php}
php	php	ifphp php(php!selfphp:php:isValidContainerNamephp(php$containerNamephp)php)php php{
php	php	php	throwphp newphp Zendphp_Servicephp_WindowsAzurephp_Exceptionphp(php'Containerphp namephp doesphp notphp adherephp tophp containerphp namingphp conventionsphp.php Seephp httpphp:php/php/msdnphp.microsoftphp.comphp/enphp-usphp/libraryphp/ddphp1php3php5php7php1php5php.aspxphp forphp morephp informationphp.php'php)php;
php	php	php}
php	php	ifphp php(php!isphp_arrayphp(php$metadataphp)php)php php{
php	php	php	throwphp newphp Zendphp_Servicephp_WindowsAzurephp_Exceptionphp(php'Metaphp dataphp shouldphp bephp anphp arrayphp ofphp keyphp andphp valuephp pairsphp.php'php)php;
php	php	php}
php	php	php	
php	php	php/php/php Createphp metadataphp headers
php	php	php$headersphp php=php arrayphp(php)php;
php	php	php$headersphp php=php arrayphp_mergephp(php$headersphp,php php$thisphp-php>php_generateMetadataHeadersphp(php$metadataphp)php)php;

php	php	php/php/php Performphp request
php	php	php$responsephp php=php php$thisphp-php>php_performRequestphp(php$containerNamephp,php php'php?restypephp=containerphp'php,php Zendphp_Httpphp_Clientphp:php:PUTphp,php php$headersphp,php falsephp,php nullphp,php Zendphp_Servicephp_WindowsAzurephp_Storagephp:php:RESOURCEphp_CONTAINERphp,php Zendphp_Servicephp_WindowsAzurephp_Credentialsphp_CredentialsAbstractphp:php:PERMISSIONphp_WRITEphp)php;
php	php	ifphp php(php$responsephp-php>isSuccessfulphp(php)php)php php{
php	php	php	returnphp newphp Zendphp_Servicephp_WindowsAzurephp_Storagephp_BlobContainerphp(
php	php	php	php$containerNamephp,
php	php	php	php$responsephp-php>getHeaderphp(php'Etagphp'php)php,
php	php	php	php$responsephp-php>getHeaderphp(php'Lastphp-modifiedphp'php)php,
php	php	php	php$metadata
php	php	php	php)php;
php	php	php}php elsephp php{
php	php	php	throwphp newphp Zendphp_Servicephp_WindowsAzurephp_Exceptionphp(php$thisphp-php>php_getErrorMessagephp(php$responsephp,php php'Resourcephp couldphp notphp bephp accessedphp.php'php)php)php;
php	php	php}
php	php}

php	php/php*php*
php	php php*php Getphp containerphp ACL
php	php php*
php	php php*php php@paramphp stringphp php$containerNamephp Containerphp name
php	php php*php php@paramphp boolphp php php php$signedIdentifiersphp Displayphp onlyphp privatephp/blobphp/containerphp orphp displayphp signedphp identifiersphp?
php	php php*php php@returnphp stringphp Aclphp,php tophp bephp comparedphp withphp Zendphp_Servicephp_WindowsAzurephp_Storagephp_Blobphp:php:ACLphp_php*
php	php php*php php@throwsphp Zendphp_Servicephp_WindowsAzurephp_Exception
php	php php*php/
php	publicphp functionphp getContainerAclphp(php$containerNamephp php=php php'php'php,php php$signedIdentifiersphp php=php falsephp)
php	php{
php	php	ifphp php(php$containerNamephp php=php=php=php php'php'php)php php{
php	php	php	throwphp newphp Zendphp_Servicephp_WindowsAzurephp_Exceptionphp(php'Containerphp namephp isphp notphp specifiedphp.php'php)php;
php	php	php}
php	php	ifphp php(php!selfphp:php:isValidContainerNamephp(php$containerNamephp)php)php php{
php	php	php	throwphp newphp Zendphp_Servicephp_WindowsAzurephp_Exceptionphp(php'Containerphp namephp doesphp notphp adherephp tophp containerphp namingphp conventionsphp.php Seephp httpphp:php/php/msdnphp.microsoftphp.comphp/enphp-usphp/libraryphp/ddphp1php3php5php7php1php5php.aspxphp forphp morephp informationphp.php'php)php;
php	php	php}

php	php	php/php/php Performphp request
php	php	php$responsephp php=php php$thisphp-php>php_performRequestphp(php$containerNamephp,php php'php?restypephp=containerphp&compphp=aclphp'php,php Zendphp_Httpphp_Clientphp:php:GETphp,php arrayphp(php)php,php falsephp,php nullphp,php Zendphp_Servicephp_WindowsAzurephp_Storagephp:php:RESOURCEphp_CONTAINERphp,php Zendphp_Servicephp_WindowsAzurephp_Credentialsphp_CredentialsAbstractphp:php:PERMISSIONphp_READphp)php;
php	php	ifphp php(php$responsephp-php>isSuccessfulphp(php)php)php php{
php	php	php	ifphp php(php$signedIdentifiersphp php=php=php falsephp)php php php{
php	php	php	php	php/php/php Onlyphp privatephp/blobphp/container
php	php	php	php	php$accessTypephp php=php php$responsephp-php>getHeaderphp(Zendphp_Servicephp_WindowsAzurephp_Storagephp:php:PREFIXphp_STORAGEphp_HEADERphp php.php php'blobphp-publicphp-accessphp'php)php;
php	php	php	php	ifphp php(strtolowerphp(php$accessTypephp)php php=php=php php'truephp'php)php php{
php	php	php	php	php	php$accessTypephp php=php selfphp:php:ACLphp_PUBLICphp_CONTAINERphp;
php	php	php	php	php}
php	php	php	php	returnphp php$accessTypephp;
php	php	php	php}php elsephp php{
php	php	php	php	php/php/php Parsephp result
php	php	php	php	php$resultphp php=php php$thisphp-php>php_parseResponsephp(php$responsephp)php;
php	php	php	php	ifphp php(php!php$resultphp)php php{
php	php	php	php	php	returnphp arrayphp(php)php;
php	php	php	php	php}

php	php	php	php	php$entriesphp php=php nullphp;
php	php	php	php	ifphp php(php$resultphp-php>SignedIdentifierphp)php php{
php	php	php	php	php	ifphp php(countphp(php$resultphp-php>SignedIdentifierphp)php php>php php1php)php php{
php	php	php	php	php	php	php$entriesphp php=php php$resultphp-php>SignedIdentifierphp;
php	php	php	php	php	php}php elsephp php{
php	php	php	php	php	php	php$entriesphp php=php arrayphp(php$resultphp-php>SignedIdentifierphp)php;
php	php	php	php	php	php}
php	php	php	php	php}

php	php	php	php	php/php/php Returnphp value
php	php	php	php	php$returnValuephp php=php arrayphp(php)php;
php	php	php	php	foreachphp php(php$entriesphp asphp php$entryphp)php php{
php	php	php	php	php	php$returnValuephp[php]php php=php newphp Zendphp_Servicephp_WindowsAzurephp_Storagephp_SignedIdentifierphp(
php	php	php	php	php	php$entryphp-php>Idphp,
php	php	php	php	php	php$entryphp-php>AccessPolicyphp php?php php$entryphp-php>AccessPolicyphp-php>Startphp php?php php$entryphp-php>AccessPolicyphp-php>Startphp php:php php'php'php php:php php'php'php,
php	php	php	php	php	php$entryphp-php>AccessPolicyphp php?php php$entryphp-php>AccessPolicyphp-php>Expiryphp php?php php$entryphp-php>AccessPolicyphp-php>Expiryphp php:php php'php'php php:php php'php'php,
php	php	php	php	php	php$entryphp-php>AccessPolicyphp php?php php$entryphp-php>AccessPolicyphp-php>Permissionphp php?php php$entryphp-php>AccessPolicyphp-php>Permissionphp php:php php'php'php php:php php'php'
php	php	php	php	php	php)php;
php	php	php	php	php}

php	php	php	php	php/php/php Return
php	php	php	php	returnphp php$returnValuephp;
php	php	php	php}
php	php	php}php elsephp php{
php	php	php	throwphp newphp Zendphp_Servicephp_WindowsAzurephp_Exceptionphp(php$thisphp-php>php_getErrorMessagephp(php$responsephp,php php'Resourcephp couldphp notphp bephp accessedphp.php'php)php)php;
php	php	php}
php	php}

php	php/php*php*
php	php php*php Setphp containerphp ACL
php	php php*
php	php php*php php@paramphp stringphp php$containerNamephp Containerphp name
php	php php*php php@paramphp boolphp php$aclphp Zendphp_Servicephp_WindowsAzurephp_Storagephp_Blobphp:php:ACLphp_php*
php	php php*php php@paramphp arrayphp php$signedIdentifiersphp Signedphp identifiers
php	php php*php php@throwsphp Zendphp_Servicephp_WindowsAzurephp_Exception
php	php php*php/
php	publicphp functionphp setContainerAclphp(php$containerNamephp php=php php'php'php,php php$aclphp php=php selfphp:php:ACLphp_PRIVATEphp,php php$signedIdentifiersphp php=php arrayphp(php)php)
php	php{
php	php	ifphp php(php$containerNamephp php=php=php=php php'php'php)php php{
php	php	php	throwphp newphp Zendphp_Servicephp_WindowsAzurephp_Exceptionphp(php'Containerphp namephp isphp notphp specifiedphp.php'php)php;
php	php	php}
php	php	ifphp php(php!selfphp:php:isValidContainerNamephp(php$containerNamephp)php)php php{
php	php	php	throwphp newphp Zendphp_Servicephp_WindowsAzurephp_Exceptionphp(php'Containerphp namephp doesphp notphp adherephp tophp containerphp namingphp conventionsphp.php Seephp httpphp:php/php/msdnphp.microsoftphp.comphp/enphp-usphp/libraryphp/ddphp1php3php5php7php1php5php.aspxphp forphp morephp informationphp.php'php)php;
php	php	php}

php	php	php/php/php Headers
php	php	php$headersphp php=php arrayphp(php)php;

php	php	php/php/php Aclphp specifiedphp?
php	php	ifphp php(php$aclphp php!php=php selfphp:php:ACLphp_PRIVATEphp php&php&php php$aclphp php!php=php=php nullphp php&php&php php$aclphp php!php=php php'php'php)php php{
php	php	php	php$headersphp[Zendphp_Servicephp_WindowsAzurephp_Storagephp:php:PREFIXphp_STORAGEphp_HEADERphp php.php php'blobphp-publicphp-accessphp'php]php php=php php$aclphp;
php	php	php}

php	php	php/php/php Policies
php	php	php$policiesphp php=php nullphp;
php	php	ifphp php(isphp_arrayphp(php$signedIdentifiersphp)php php&php&php countphp(php$signedIdentifiersphp)php php>php php0php)php php{
php	php	php	php$policiesphp php php=php php'php'php;
php	php	php	php$policiesphp php.php=php php'<php?xmlphp versionphp=php"php1php.php0php"php encodingphp=php"utfphp-php8php"php?php>php'php php.php php"php\rphp\nphp"php;
php	php	php	php$policiesphp php.php=php php'php<SignedIdentifiersphp>php'php php.php php"php\rphp\nphp"php;
php	php	php	foreachphp php(php$signedIdentifiersphp asphp php$signedIdentifierphp)php php{
php	php	php	php	php$policiesphp php.php=php php'php php php<SignedIdentifierphp>php'php php.php php"php\rphp\nphp"php;
php	php	php	php	php$policiesphp php.php=php php'php php php php php<Idphp>php'php php.php php$signedIdentifierphp-php>Idphp php.php php'<php/Idphp>php'php php.php php"php\rphp\nphp"php;
php	php	php	php	php$policiesphp php.php=php php'php php php php php<AccessPolicyphp>php'php php.php php"php\rphp\nphp"php;
php	php	php	php	ifphp php(php$signedIdentifierphp-php>Startphp php!php=php php'php'php)
php	php	php	php	php$policiesphp php.php=php php'php php php php php php php<Startphp>php'php php.php php$signedIdentifierphp-php>Startphp php.php php'<php/Startphp>php'php php.php php"php\rphp\nphp"php;
php	php	php	php	ifphp php(php$signedIdentifierphp-php>Expiryphp php!php=php php'php'php)
php	php	php	php	php$policiesphp php.php=php php'php php php php php php php<Expiryphp>php'php php.php php$signedIdentifierphp-php>Expiryphp php.php php'<php/Expiryphp>php'php php.php php"php\rphp\nphp"php;
php	php	php	php	ifphp php(php$signedIdentifierphp-php>Permissionsphp php!php=php php'php'php)
php	php	php	php	php$policiesphp php.php=php php'php php php php php php php<Permissionphp>php'php php.php php$signedIdentifierphp-php>Permissionsphp php.php php'<php/Permissionphp>php'php php.php php"php\rphp\nphp"php;
php	php	php	php	php$policiesphp php.php=php php'php php php php <php/AccessPolicyphp>php'php php.php php"php\rphp\nphp"php;
php	php	php	php	php$policiesphp php.php=php php'php php <php/SignedIdentifierphp>php'php php.php php"php\rphp\nphp"php;
php	php	php	php}
php	php	php	php$policiesphp php.php=php php'<php/SignedIdentifiersphp>php'php php.php php"php\rphp\nphp"php;
php	php	php}

php	php	php/php/php Performphp request
php	php	php$responsephp php=php php$thisphp-php>php_performRequestphp(php$containerNamephp,php php'php?restypephp=containerphp&compphp=aclphp'php,php Zendphp_Httpphp_Clientphp:php:PUTphp,php php$headersphp,php falsephp,php php$policiesphp,php Zendphp_Servicephp_WindowsAzurephp_Storagephp:php:RESOURCEphp_CONTAINERphp,php Zendphp_Servicephp_WindowsAzurephp_Credentialsphp_CredentialsAbstractphp:php:PERMISSIONphp_WRITEphp)php;
php	php	ifphp php(php!php$responsephp-php>isSuccessfulphp(php)php)php php{
php	php	php	throwphp newphp Zendphp_Servicephp_WindowsAzurephp_Exceptionphp(php$thisphp-php>php_getErrorMessagephp(php$responsephp,php php'Resourcephp couldphp notphp bephp accessedphp.php'php)php)php;
php	php	php}
php	php}

php	php/php*php*
php	php php*php Getphp container
php	php php*
php	php php*php php@paramphp stringphp php$containerNamephp php Containerphp name
php	php php*php php@returnphp Zendphp_Servicephp_WindowsAzurephp_Storagephp_BlobContainer
php	php php*php php@throwsphp Zendphp_Servicephp_WindowsAzurephp_Exception
php	php php*php/
php	publicphp functionphp getContainerphp(php$containerNamephp php=php php'php'php)
php	php{
php	php	ifphp php(php$containerNamephp php=php=php=php php'php'php)php php{
php	php	php	throwphp newphp Zendphp_Servicephp_WindowsAzurephp_Exceptionphp(php'Containerphp namephp isphp notphp specifiedphp.php'php)php;
php	php	php}
php	php	ifphp php(php!selfphp:php:isValidContainerNamephp(php$containerNamephp)php)php php{
php	php	php	throwphp newphp Zendphp_Servicephp_WindowsAzurephp_Exceptionphp(php'Containerphp namephp doesphp notphp adherephp tophp containerphp namingphp conventionsphp.php Seephp httpphp:php/php/msdnphp.microsoftphp.comphp/enphp-usphp/libraryphp/ddphp1php3php5php7php1php5php.aspxphp forphp morephp informationphp.php'php)php;
php	php	php}

php	php	php/php/php Performphp request
php	php	php$responsephp php=php php$thisphp-php>php_performRequestphp(php$containerNamephp,php php'php?restypephp=containerphp'php,php Zendphp_Httpphp_Clientphp:php:GETphp,php arrayphp(php)php,php falsephp,php nullphp,php Zendphp_Servicephp_WindowsAzurephp_Storagephp:php:RESOURCEphp_CONTAINERphp,php Zendphp_Servicephp_WindowsAzurephp_Credentialsphp_CredentialsAbstractphp:php:PERMISSIONphp_READphp)php;
php	php	ifphp php(php$responsephp-php>isSuccessfulphp(php)php)php php{
php	php	php	php/php/php Parsephp metadata
php	php	php	php$metadataphp php=php php$thisphp-php>php_parseMetadataHeadersphp(php$responsephp-php>getHeadersphp(php)php)php;

php	php	php	php/php/php Returnphp container
php	php	php	returnphp newphp Zendphp_Servicephp_WindowsAzurephp_Storagephp_BlobContainerphp(
php	php	php	php$containerNamephp,
php	php	php	php$responsephp-php>getHeaderphp(php'Etagphp'php)php,
php	php	php	php$responsephp-php>getHeaderphp(php'Lastphp-modifiedphp'php)php,
php	php	php	php$metadata
php	php	php	php)php;
php	php	php}php elsephp php{
php	php	php	throwphp newphp Zendphp_Servicephp_WindowsAzurephp_Exceptionphp(php$thisphp-php>php_getErrorMessagephp(php$responsephp,php php'Resourcephp couldphp notphp bephp accessedphp.php'php)php)php;
php	php	php}
php	php}

php	php/php*php*
php	php php*php Getphp containerphp metadata
php	php php*
php	php php*php php@paramphp stringphp php$containerNamephp php Containerphp name
php	php php*php php@returnphp arrayphp Keyphp/valuephp pairsphp ofphp metaphp data
php	php php*php php@throwsphp Zendphp_Servicephp_WindowsAzurephp_Exception
php	php php*php/
php	publicphp functionphp getContainerMetadataphp(php$containerNamephp php=php php'php'php)
php	php{
php	php	ifphp php(php$containerNamephp php=php=php=php php'php'php)php php{
php	php	php	throwphp newphp Zendphp_Servicephp_WindowsAzurephp_Exceptionphp(php'Containerphp namephp isphp notphp specifiedphp.php'php)php;
php	php	php}
php	php	ifphp php(php!selfphp:php:isValidContainerNamephp(php$containerNamephp)php)php php{
php	php	php	throwphp newphp Zendphp_Servicephp_WindowsAzurephp_Exceptionphp(php'Containerphp namephp doesphp notphp adherephp tophp containerphp namingphp conventionsphp.php Seephp httpphp:php/php/msdnphp.microsoftphp.comphp/enphp-usphp/libraryphp/ddphp1php3php5php7php1php5php.aspxphp forphp morephp informationphp.php'php)php;
php	php	php}

php	php	returnphp php$thisphp-php>getContainerphp(php$containerNamephp)php-php>Metadataphp;
php	php}

php	php/php*php*
php	php php*php Setphp containerphp metadata
php	php php*
php	php php*php Callingphp thephp Setphp Containerphp Metadataphp operationphp overwritesphp allphp existingphp metadataphp thatphp isphp associatedphp withphp thephp containerphp.php Itphp'sphp notphp possiblephp tophp modifyphp anphp individualphp namephp/valuephp pairphp.
php	php php*
php	php php*php php@paramphp stringphp php$containerNamephp php php php php php Containerphp name
php	php php*php php@paramphp arrayphp php php$metadataphp php php php php php php php php php php Keyphp/valuephp pairsphp ofphp metaphp data
php	php php*php php@paramphp arrayphp php php$additionalHeadersphp php Additionalphp headersphp.php Seephp httpphp:php/php/msdnphp.microsoftphp.comphp/enphp-usphp/libraryphp/ddphp1php7php9php3php7php1php.aspxphp forphp morephp informationphp.
php	php php*php php@throwsphp Zendphp_Servicephp_WindowsAzurephp_Exception
php	php php*php/
php	publicphp functionphp setContainerMetadataphp(php$containerNamephp php=php php'php'php,php php$metadataphp php=php arrayphp(php)php,php php$additionalHeadersphp php=php arrayphp(php)php)
php	php{
php	php	ifphp php(php$containerNamephp php=php=php=php php'php'php)php php{
php	php	php	throwphp newphp Zendphp_Servicephp_WindowsAzurephp_Exceptionphp(php'Containerphp namephp isphp notphp specifiedphp.php'php)php;
php	php	php}
php	php	ifphp php(php!selfphp:php:isValidContainerNamephp(php$containerNamephp)php)php php{
php	php	php	throwphp newphp Zendphp_Servicephp_WindowsAzurephp_Exceptionphp(php'Containerphp namephp doesphp notphp adherephp tophp containerphp namingphp conventionsphp.php Seephp httpphp:php/php/msdnphp.microsoftphp.comphp/enphp-usphp/libraryphp/ddphp1php3php5php7php1php5php.aspxphp forphp morephp informationphp.php'php)php;
php	php	php}
php	php	ifphp php(php!isphp_arrayphp(php$metadataphp)php)php php{
php	php	php	throwphp newphp Zendphp_Servicephp_WindowsAzurephp_Exceptionphp(php'Metaphp dataphp shouldphp bephp anphp arrayphp ofphp keyphp andphp valuephp pairsphp.php'php)php;
php	php	php}
php	php	ifphp php(countphp(php$metadataphp)php php=php=php php0php)php php{
php	php	php	returnphp;
php	php	php}

php	php	php/php/php Createphp metadataphp headers
php	php	php$headersphp php=php arrayphp(php)php;
php	php	php$headersphp php=php arrayphp_mergephp(php$headersphp,php php$thisphp-php>php_generateMetadataHeadersphp(php$metadataphp)php)php;

php	php	php/php/php Additionalphp headersphp?
php	php	foreachphp php(php$additionalHeadersphp asphp php$keyphp php=php>php php$valuephp)php php{
php	php	php	php$headersphp[php$keyphp]php php=php php$valuephp;
php	php	php}

php	php	php/php/php Performphp request
php	php	php$responsephp php=php php$thisphp-php>php_performRequestphp(php$containerNamephp,php php'php?restypephp=containerphp&compphp=metadataphp'php,php Zendphp_Httpphp_Clientphp:php:PUTphp,php php$headersphp,php falsephp,php nullphp,php Zendphp_Servicephp_WindowsAzurephp_Storagephp:php:RESOURCEphp_CONTAINERphp,php Zendphp_Servicephp_WindowsAzurephp_Credentialsphp_CredentialsAbstractphp:php:PERMISSIONphp_WRITEphp)php;
php	php	ifphp php(php!php$responsephp-php>isSuccessfulphp(php)php)php php{
php	php	php	throwphp newphp Zendphp_Servicephp_WindowsAzurephp_Exceptionphp(php$thisphp-php>php_getErrorMessagephp(php$responsephp,php php'Resourcephp couldphp notphp bephp accessedphp.php'php)php)php;
php	php	php}
php	php}

php	php/php*php*
php	php php*php Deletephp container
php	php php*
php	php php*php php@paramphp stringphp php$containerNamephp php php php php php Containerphp name
php	php php*php php@paramphp arrayphp php php$additionalHeadersphp php Additionalphp headersphp.php Seephp httpphp:php/php/msdnphp.microsoftphp.comphp/enphp-usphp/libraryphp/ddphp1php7php9php3php7php1php.aspxphp forphp morephp informationphp.
php	php php*php php@throwsphp Zendphp_Servicephp_WindowsAzurephp_Exception
php	php php*php/
php	publicphp functionphp deleteContainerphp(php$containerNamephp php=php php'php'php,php php$additionalHeadersphp php=php arrayphp(php)php)
php	php{
php	php	ifphp php(php$containerNamephp php=php=php=php php'php'php)php php{
php	php	php	throwphp newphp Zendphp_Servicephp_WindowsAzurephp_Exceptionphp(php'Containerphp namephp isphp notphp specifiedphp.php'php)php;
php	php	php}
php	php	ifphp php(php!selfphp:php:isValidContainerNamephp(php$containerNamephp)php)php php{
php	php	php	throwphp newphp Zendphp_Servicephp_WindowsAzurephp_Exceptionphp(php'Containerphp namephp doesphp notphp adherephp tophp containerphp namingphp conventionsphp.php Seephp httpphp:php/php/msdnphp.microsoftphp.comphp/enphp-usphp/libraryphp/ddphp1php3php5php7php1php5php.aspxphp forphp morephp informationphp.php'php)php;
php	php	php}
php	php	php	
php	php	php/php/php Additionalphp headersphp?
php	php	php$headersphp php=php arrayphp(php)php;
php	php	foreachphp php(php$additionalHeadersphp asphp php$keyphp php=php>php php$valuephp)php php{
php	php	php	php$headersphp[php$keyphp]php php=php php$valuephp;
php	php	php}

php	php	php/php/php Performphp request
php	php	php$responsephp php=php php$thisphp-php>php_performRequestphp(php$containerNamephp,php php'php?restypephp=containerphp'php,php Zendphp_Httpphp_Clientphp:php:DELETEphp,php php$headersphp,php falsephp,php nullphp,php Zendphp_Servicephp_WindowsAzurephp_Storagephp:php:RESOURCEphp_CONTAINERphp,php Zendphp_Servicephp_WindowsAzurephp_Credentialsphp_CredentialsAbstractphp:php:PERMISSIONphp_WRITEphp)php;
php	php	ifphp php(php!php$responsephp-php>isSuccessfulphp(php)php)php php{
php	php	php	throwphp newphp Zendphp_Servicephp_WindowsAzurephp_Exceptionphp(php$thisphp-php>php_getErrorMessagephp(php$responsephp,php php'Resourcephp couldphp notphp bephp accessedphp.php'php)php)php;
php	php	php}
php	php}

php	php/php*php*
php	php php*php Listphp containers
php	php php*
php	php php*php php@paramphp stringphp php$prefixphp php php php php Optionalphp.php Filtersphp thephp resultsphp tophp returnphp onlyphp containersphp whosephp namephp beginsphp withphp thephp specifiedphp prefixphp.
php	php php*php php@paramphp intphp php php php php$maxResultsphp Optionalphp.php Specifiesphp thephp maximumphp numberphp ofphp containersphp tophp returnphp perphp callphp tophp Azurephp storagephp.php Thisphp doesphp NOTphp affectphp listphp sizephp returnedphp byphp thisphp functionphp.php php(maximumphp:php php5php0php0php0php)
php	php php*php php@paramphp stringphp php$markerphp php php php php Optionalphp stringphp valuephp thatphp identifiesphp thephp portionphp ofphp thephp listphp tophp bephp returnedphp withphp thephp nextphp listphp operationphp.
php	php php*php php@paramphp stringphp php$includephp php php php Optionalphp.php Includephp thisphp parameterphp tophp specifyphp thatphp thephp containerphp'sphp metadataphp bephp returnedphp asphp partphp ofphp thephp responsephp bodyphp.php php(allowedphp valuesphp:php php'php'php,php php'metadataphp'php)
php	php php*php php@paramphp intphp php php php php$currentResultCountphp Currentphp resultphp countphp php(internalphp usephp)
php	php php*php php@returnphp array
php	php php*php php@throwsphp Zendphp_Servicephp_WindowsAzurephp_Exception
php	php php*php/
php	publicphp functionphp listContainersphp(php$prefixphp php=php nullphp,php php$maxResultsphp php=php nullphp,php php$markerphp php=php nullphp,php php$includephp php=php nullphp,php php$currentResultCountphp php=php php0php)
php	php{
php	php	php/php/php Buildphp queryphp string
php	php	php$queryStringphp php=php arrayphp(php'compphp=listphp'php)php;
php	php	ifphp php(php$prefixphp php!php=php=php nullphp)php php{
php	php	php	php$queryStringphp[php]php php=php php'prefixphp=php'php php.php php$prefixphp;
php	php	php}
php	php	ifphp php(php$maxResultsphp php!php=php=php nullphp)php php{
php	php	php	php$queryStringphp[php]php php=php php'maxresultsphp=php'php php.php php$maxResultsphp;
php	php	php}
php	php	ifphp php(php$markerphp php!php=php=php nullphp)php php{
php	php	php	php$queryStringphp[php]php php=php php'markerphp=php'php php.php php$markerphp;
php	php	php}
php	php	ifphp php(php$includephp php!php=php=php nullphp)php php{
php	php	php	php$queryStringphp[php]php php=php php'includephp=php'php php.php php$includephp;
php	php	php}
php	php	php$queryStringphp php=php selfphp:php:createQueryStringFromArrayphp(php$queryStringphp)php;
php	php	
php	php	php/php/php Performphp request
php	php	php$responsephp php=php php$thisphp-php>php_performRequestphp(php'php'php,php php$queryStringphp,php Zendphp_Httpphp_Clientphp:php:GETphp,php arrayphp(php)php,php falsephp,php nullphp,php Zendphp_Servicephp_WindowsAzurephp_Storagephp:php:RESOURCEphp_CONTAINERphp,php Zendphp_Servicephp_WindowsAzurephp_Credentialsphp_CredentialsAbstractphp:php:PERMISSIONphp_LISTphp)php;
php	php	ifphp php(php$responsephp-php>isSuccessfulphp(php)php)php php{
php	php	php	php$xmlContainersphp php=php php$thisphp-php>php_parseResponsephp(php$responsephp)php-php>Containersphp-php>Containerphp;
php	php	php	php$xmlMarkerphp php=php php(stringphp)php$thisphp-php>php_parseResponsephp(php$responsephp)php-php>NextMarkerphp;

php	php	php	php$containersphp php=php arrayphp(php)php;
php	php	php	ifphp php(php$xmlContainersphp php!php=php=php nullphp)php php{
php	php	php	php	forphp php(php$iphp php=php php0php;php php$iphp <php countphp(php$xmlContainersphp)php;php php$iphp+php+php)php php{
php	php	php	php	php	php$containersphp[php]php php=php newphp Zendphp_Servicephp_WindowsAzurephp_Storagephp_BlobContainerphp(
php	php	php	php	php	php(stringphp)php$xmlContainersphp[php$iphp]php-php>Namephp,
php	php	php	php	php	php(stringphp)php$xmlContainersphp[php$iphp]php-php>Etagphp,
php	php	php	php	php	php(stringphp)php$xmlContainersphp[php$iphp]php-php>LastModifiedphp,
php	php	php	php	php	php$thisphp-php>php_parseMetadataElementphp(php$xmlContainersphp[php$iphp]php)
php	php	php	php	php	php)php;
php	php	php	php	php}
php	php	php	php}
php	php	php	php$currentResultCountphp php=php php$currentResultCountphp php+php countphp(php$containersphp)php;
php	php	php	ifphp php(php$maxResultsphp php!php=php=php nullphp php&php&php php$currentResultCountphp <php php$maxResultsphp)php php{
php	php	php	php	ifphp php(php$xmlMarkerphp php!php=php=php nullphp php&php&php php$xmlMarkerphp php!php=php php'php'php)php php{
php	php	php	php	php	php$containersphp php=php arrayphp_mergephp(php$containersphp,php php$thisphp-php>listContainersphp(php$prefixphp,php php$maxResultsphp,php php$xmlMarkerphp,php php$includephp,php php$currentResultCountphp)php)php;
php	php	php	php	php}
php	php	php	php}
php	php	php	ifphp php(php$maxResultsphp php!php=php=php nullphp php&php&php countphp(php$containersphp)php php>php php$maxResultsphp)php php{
php	php	php	php	php$containersphp php=php arrayphp_slicephp(php$containersphp,php php0php,php php$maxResultsphp)php;
php	php	php	php}
php	php	php	
php	php	php	returnphp php$containersphp;
php	php	php}php elsephp php{
php	php	php	throwphp newphp Zendphp_Servicephp_WindowsAzurephp_Exceptionphp(php$thisphp-php>php_getErrorMessagephp(php$responsephp,php php'Resourcephp couldphp notphp bephp accessedphp.php'php)php)php;
php	php	php}
php	php}

php	php/php*php*
php	php php*php Putphp blob
php	php php*
php	php php*php php@paramphp stringphp php$containerNamephp php php php php php Containerphp name
php	php php*php php@paramphp stringphp php$blobNamephp php php php php php php php php php php Blobphp name
php	php php*php php@paramphp stringphp php$localFileNamephp php php php php php Localphp filephp namephp tophp bephp uploaded
php	php php*php php@paramphp arrayphp php php$metadataphp php php php php php php php php php php Keyphp/valuephp pairsphp ofphp metaphp data
php	php php*php php@paramphp stringphp php$leaseIdphp php php php php php php php php php php php Leasephp identifier
php	php php*php php@paramphp arrayphp php php$additionalHeadersphp php Additionalphp headersphp.php Seephp httpphp:php/php/msdnphp.microsoftphp.comphp/enphp-usphp/libraryphp/ddphp1php7php9php3php7php1php.aspxphp forphp morephp informationphp.
php	php php*php php@returnphp objectphp Partialphp blobphp properties
php	php php*php php@throwsphp Zendphp_Servicephp_WindowsAzurephp_Exception
php	php php*php/
php	publicphp functionphp putBlobphp(php$containerNamephp php=php php'php'php,php php$blobNamephp php=php php'php'php,php php$localFileNamephp php=php php'php'php,php php$metadataphp php=php arrayphp(php)php,php php$leaseIdphp php=php nullphp,php php$additionalHeadersphp php=php arrayphp(php)php)
php	php{
php	php	ifphp php(php$containerNamephp php=php=php=php php'php'php)php php{
php	php	php	throwphp newphp Zendphp_Servicephp_WindowsAzurephp_Exceptionphp(php'Containerphp namephp isphp notphp specifiedphp.php'php)php;
php	php	php}
php	php	ifphp php(php!selfphp:php:isValidContainerNamephp(php$containerNamephp)php)php php{
php	php	php	throwphp newphp Zendphp_Servicephp_WindowsAzurephp_Exceptionphp(php'Containerphp namephp doesphp notphp adherephp tophp containerphp namingphp conventionsphp.php Seephp httpphp:php/php/msdnphp.microsoftphp.comphp/enphp-usphp/libraryphp/ddphp1php3php5php7php1php5php.aspxphp forphp morephp informationphp.php'php)php;
php	php	php}
php	php	ifphp php(php$blobNamephp php=php=php=php php'php'php)php php{
php	php	php	throwphp newphp Zendphp_Servicephp_WindowsAzurephp_Exceptionphp(php'Blobphp namephp isphp notphp specifiedphp.php'php)php;
php	php	php}
php	php	ifphp php(php$localFileNamephp php=php=php=php php'php'php)php php{
php	php	php	throwphp newphp Zendphp_Servicephp_WindowsAzurephp_Exceptionphp(php'Localphp filephp namephp isphp notphp specifiedphp.php'php)php;
php	php	php}
php	php	ifphp php(php!filephp_existsphp(php$localFileNamephp)php)php php{
php	php	php	throwphp newphp Zendphp_Servicephp_WindowsAzurephp_Exceptionphp(php'Localphp filephp notphp foundphp.php'php)php;
php	php	php}
php	php	ifphp php(php$containerNamephp php=php=php=php php'php$rootphp'php php&php&php strposphp(php$blobNamephp,php php'php/php'php)php php!php=php=php falsephp)php php{
php	php	php	throwphp newphp Zendphp_Servicephp_WindowsAzurephp_Exceptionphp(php'Blobsphp storedphp inphp thephp rootphp containerphp canphp notphp havephp aphp namephp containingphp aphp forwardphp slashphp php(php/php)php.php'php)php;
php	php	php}
php	php	php	
php	php	php/php/php Checkphp filephp size
php	php	ifphp php(filesizephp(php$localFileNamephp)php php>php=php selfphp:php:MAXphp_BLOBphp_SIZEphp)php php{
php	php	php	returnphp php$thisphp-php>putLargeBlobphp(php$containerNamephp,php php$blobNamephp,php php$localFileNamephp,php php$metadataphp,php php$leaseIdphp)php;
php	php	php}

php	php	php/php/php Putphp thephp dataphp tophp Windowsphp Azurephp Storage
php	php	returnphp php$thisphp-php>putBlobDataphp(php$containerNamephp,php php$blobNamephp,php filephp_getphp_contentsphp(php$localFileNamephp)php,php php$metadataphp,php php$leaseIdphp,php php$additionalHeadersphp)php;
php	php}

php	php/php*php*
php	php php*php Putphp blobphp data
php	php php*
php	php php*php php@paramphp stringphp php$containerNamephp php php php php php Containerphp name
php	php php*php php@paramphp stringphp php$blobNamephp php php php php php php php php php php Blobphp name
php	php php*php php@paramphp mixedphp php php$dataphp php php php php php php	php	php Dataphp tophp store
php	php php*php php@paramphp arrayphp php php$metadataphp php php php php php php php php php php Keyphp/valuephp pairsphp ofphp metaphp data
php	php php*php php@paramphp stringphp php$leaseIdphp php php php php php php php php php php php Leasephp identifier
php	php php*php php@paramphp arrayphp php php$additionalHeadersphp php Additionalphp headersphp.php Seephp httpphp:php/php/msdnphp.microsoftphp.comphp/enphp-usphp/libraryphp/ddphp1php7php9php3php7php1php.aspxphp forphp morephp informationphp.
php	php php*php php@returnphp objectphp Partialphp blobphp properties
php	php php*php php@throwsphp Zendphp_Servicephp_WindowsAzurephp_Exception
php	php php*php/
php	publicphp functionphp putBlobDataphp(php$containerNamephp php=php php'php'php,php php$blobNamephp php=php php'php'php,php php$dataphp php=php php'php'php,php php$metadataphp php=php arrayphp(php)php,php php$leaseIdphp php=php nullphp,php php$additionalHeadersphp php=php arrayphp(php)php)
php	php{
php	php	ifphp php(php$containerNamephp php=php=php=php php'php'php)php php{
php	php	php	throwphp newphp Zendphp_Servicephp_WindowsAzurephp_Exceptionphp(php'Containerphp namephp isphp notphp specifiedphp.php'php)php;
php	php	php}
php	php	ifphp php(php!selfphp:php:isValidContainerNamephp(php$containerNamephp)php)php php{
php	php	php	throwphp newphp Zendphp_Servicephp_WindowsAzurephp_Exceptionphp(php'Containerphp namephp doesphp notphp adherephp tophp containerphp namingphp conventionsphp.php Seephp httpphp:php/php/msdnphp.microsoftphp.comphp/enphp-usphp/libraryphp/ddphp1php3php5php7php1php5php.aspxphp forphp morephp informationphp.php'php)php;
php	php	php}
php	php	ifphp php(php$blobNamephp php=php=php=php php'php'php)php php{
php	php	php	throwphp newphp Zendphp_Servicephp_WindowsAzurephp_Exceptionphp(php'Blobphp namephp isphp notphp specifiedphp.php'php)php;
php	php	php}
php	php	ifphp php(php$containerNamephp php=php=php=php php'php$rootphp'php php&php&php strposphp(php$blobNamephp,php php'php/php'php)php php!php=php=php falsephp)php php{
php	php	php	throwphp newphp Zendphp_Servicephp_WindowsAzurephp_Exceptionphp(php'Blobsphp storedphp inphp thephp rootphp containerphp canphp notphp havephp aphp namephp containingphp aphp forwardphp slashphp php(php/php)php.php'php)php;
php	php	php}

php	php	php/php/php Createphp metadataphp headers
php	php	php$headersphp php=php arrayphp(php)php;
php	php	ifphp php(php$leaseIdphp php!php=php=php nullphp)php php{
php	php	php	php$headersphp[php'xphp-msphp-leasephp-idphp'php]php php=php php$leaseIdphp;
php	php	php}
php	php	php$headersphp php=php arrayphp_mergephp(php$headersphp,php php$thisphp-php>php_generateMetadataHeadersphp(php$metadataphp)php)php;

php	php	php/php/php Additionalphp headersphp?
php	php	foreachphp php(php$additionalHeadersphp asphp php$keyphp php=php>php php$valuephp)php php{
php	php	php	php$headersphp[php$keyphp]php php=php php$valuephp;
php	php	php}

php	php	php/php/php Specifyphp blobphp type
php	php	php$headersphp[Zendphp_Servicephp_WindowsAzurephp_Storagephp:php:PREFIXphp_STORAGEphp_HEADERphp php.php php'blobphp-typephp'php]php php=php selfphp:php:BLOBTYPEphp_BLOCKphp;

php	php	php/php/php Resourcephp name
php	php	php$resourceNamephp php=php selfphp:php:createResourceNamephp(php$containerNamephp php,php php$blobNamephp)php;

php	php	php/php/php Performphp request
php	php	php$responsephp php=php php$thisphp-php>php_performRequestphp(php$resourceNamephp,php php'php'php,php Zendphp_Httpphp_Clientphp:php:PUTphp,php php$headersphp,php falsephp,php php$dataphp,php Zendphp_Servicephp_WindowsAzurephp_Storagephp:php:RESOURCEphp_BLOBphp,php Zendphp_Servicephp_WindowsAzurephp_Credentialsphp_CredentialsAbstractphp:php:PERMISSIONphp_WRITEphp)php;
php	php	ifphp php(php$responsephp-php>isSuccessfulphp(php)php)php php{
php	php	php	returnphp newphp Zendphp_Servicephp_WindowsAzurephp_Storagephp_BlobInstancephp(
php	php	php	php$containerNamephp,
php	php	php	php$blobNamephp,
php	php	php	nullphp,
php	php	php	php$responsephp-php>getHeaderphp(php'Etagphp'php)php,
php	php	php	php$responsephp-php>getHeaderphp(php'Lastphp-modifiedphp'php)php,
php	php	php	php$thisphp-php>getBaseUrlphp(php)php php.php php'php/php'php php.php php$containerNamephp php.php php'php/php'php php.php php$blobNamephp,
php	php	php	strlenphp(php$dataphp)php,
php	php	php	php	php'php'php,
php	php	php	php	php'php'php,
php	php	php	php	php'php'php,
php	php	php	falsephp,
php	php	php	php$metadata
php	php	php	php)php;
php	php	php}php elsephp php{
php	php	php	throwphp newphp Zendphp_Servicephp_WindowsAzurephp_Exceptionphp(php$thisphp-php>php_getErrorMessagephp(php$responsephp,php php'Resourcephp couldphp notphp bephp accessedphp.php'php)php)php;
php	php	php}
php	php}

php	php/php*php*
php	php php*php Putphp largephp blobphp php(php>php php6php4php MBphp)
php	php php*
php	php php*php php@paramphp stringphp php$containerNamephp Containerphp name
php	php php*php php@paramphp stringphp php$blobNamephp Blobphp name
php	php php*php php@paramphp stringphp php$localFileNamephp Localphp filephp namephp tophp bephp uploaded
php	php php*php php@paramphp arrayphp php php$metadataphp php php php php php Keyphp/valuephp pairsphp ofphp metaphp data
php	php php*php php@paramphp stringphp php$leaseIdphp php php php php php php Leasephp identifier
php	php php*php php@returnphp objectphp Partialphp blobphp properties
php	php php*php php@throwsphp Zendphp_Servicephp_WindowsAzurephp_Exception
php	php php*php/
php	publicphp functionphp putLargeBlobphp(php$containerNamephp php=php php'php'php,php php$blobNamephp php=php php'php'php,php php$localFileNamephp php=php php'php'php,php php$metadataphp php=php arrayphp(php)php,php php$leaseIdphp php=php nullphp)
php	php{
php	php	ifphp php(php$containerNamephp php=php=php=php php'php'php)php php{
php	php	php	throwphp newphp Zendphp_Servicephp_WindowsAzurephp_Exceptionphp(php'Containerphp namephp isphp notphp specifiedphp.php'php)php;
php	php	php}
php	php	ifphp php(php!selfphp:php:isValidContainerNamephp(php$containerNamephp)php)php php{
php	php	php	throwphp newphp Zendphp_Servicephp_WindowsAzurephp_Exceptionphp(php'Containerphp namephp doesphp notphp adherephp tophp containerphp namingphp conventionsphp.php Seephp httpphp:php/php/msdnphp.microsoftphp.comphp/enphp-usphp/libraryphp/ddphp1php3php5php7php1php5php.aspxphp forphp morephp informationphp.php'php)php;
php	php	php}
php	php	ifphp php(php$blobNamephp php=php=php=php php'php'php)php php{
php	php	php	throwphp newphp Zendphp_Servicephp_WindowsAzurephp_Exceptionphp(php'Blobphp namephp isphp notphp specifiedphp.php'php)php;
php	php	php}
php	php	ifphp php(php$localFileNamephp php=php=php=php php'php'php)php php{
php	php	php	throwphp newphp Zendphp_Servicephp_WindowsAzurephp_Exceptionphp(php'Localphp filephp namephp isphp notphp specifiedphp.php'php)php;
php	php	php}
php	php	ifphp php(php!filephp_existsphp(php$localFileNamephp)php)php php{
php	php	php	throwphp newphp Zendphp_Servicephp_WindowsAzurephp_Exceptionphp(php'Localphp filephp notphp foundphp.php'php)php;
php	php	php}
php	php	ifphp php(php$containerNamephp php=php=php=php php'php$rootphp'php php&php&php strposphp(php$blobNamephp,php php'php/php'php)php php!php=php=php falsephp)php php{
php	php	php	throwphp newphp Zendphp_Servicephp_WindowsAzurephp_Exceptionphp(php'Blobsphp storedphp inphp thephp rootphp containerphp canphp notphp havephp aphp namephp containingphp aphp forwardphp slashphp php(php/php)php.php'php)php;
php	php	php}
php	php	php	
php	php	php/php/php Checkphp filephp size
php	php	ifphp php(filesizephp(php$localFileNamephp)php <php selfphp:php:MAXphp_BLOBphp_SIZEphp)php php{
php	php	php	returnphp php$thisphp-php>putBlobphp(php$containerNamephp,php php$blobNamephp,php php$localFileNamephp,php php$metadataphp)php;
php	php	php}
php	php	php	
php	php	php/php/php Determinephp numberphp ofphp parts
php	php	php$numberOfPartsphp php=php ceilphp(php filesizephp(php$localFileNamephp)php php/php selfphp:php:MAXphp_BLOBphp_TRANSFERphp_SIZEphp php)php;

php	php	php/php/php Generatephp blockphp idphp's
php	php	php$blockIdentifiersphp php=php arrayphp(php)php;
php	php	forphp php(php$iphp php=php php0php;php php$iphp <php php$numberOfPartsphp;php php$iphp+php+php)php php{
php	php	php	php$blockIdentifiersphp[php]php php=php php$thisphp-php>php_generateBlockIdphp(php$iphp)php;
php	php	php}

php	php	php/php/php Openphp file
php	php	php$fpphp php=php fopenphp(php$localFileNamephp,php php'rphp'php)php;
php	php	ifphp php(php$fpphp php=php=php=php falsephp)php php{
php	php	php	throwphp newphp Zendphp_Servicephp_WindowsAzurephp_Exceptionphp(php'Couldphp notphp openphp localphp filephp.php'php)php;
php	php	php}
php	php	php	
php	php	php/php/php Uploadphp parts
php	php	forphp php(php$iphp php=php php0php;php php$iphp <php php$numberOfPartsphp;php php$iphp+php+php)php php{
php	php	php	php/php/php Seekphp positionphp inphp file
php	php	php	fseekphp(php$fpphp,php php$iphp php*php selfphp:php:MAXphp_BLOBphp_TRANSFERphp_SIZEphp)php;
php	php	php	php	
php	php	php	php/php/php Readphp contents
php	php	php	php$fileContentsphp php=php freadphp(php$fpphp,php selfphp:php:MAXphp_BLOBphp_TRANSFERphp_SIZEphp)php;
php	php	php	php	
php	php	php	php/php/php Putphp block
php	php	php	php$thisphp-php>putBlockphp(php$containerNamephp,php php$blobNamephp,php php$blockIdentifiersphp[php$iphp]php,php php$fileContentsphp,php php$leaseIdphp)php;
php	php	php	php	
php	php	php	php/php/php Disposephp filephp contents
php	php	php	php$fileContentsphp php=php nullphp;
php	php	php	unsetphp(php$fileContentsphp)php;
php	php	php}

php	php	php/php/php Closephp file
php	php	fclosephp(php$fpphp)php;

php	php	php/php/php Putphp blockphp list
php	php	php$thisphp-php>putBlockListphp(php$containerNamephp,php php$blobNamephp,php php$blockIdentifiersphp,php php$metadataphp,php php$leaseIdphp)php;

php	php	php/php/php Returnphp informationphp ofphp thephp blob
php	php	returnphp php$thisphp-php>getBlobInstancephp(php$containerNamephp,php php$blobNamephp,php nullphp,php php$leaseIdphp)php;
php	php}
php	php	
php	php/php*php*
php	php php*php Putphp largephp blobphp block
php	php php*
php	php php*php php@paramphp stringphp php$containerNamephp Containerphp name
php	php php*php php@paramphp stringphp php$blobNamephp php php php php php Blobphp name
php	php php*php php@paramphp stringphp php$identifierphp php php php Blockphp ID
php	php php*php php@paramphp arrayphp php php$contentsphp php php php php php Contentsphp ofphp thephp block
php	php php*php php@paramphp stringphp php$leaseIdphp php php php php php php Leasephp identifier
php	php php*php php@throwsphp Zendphp_Servicephp_WindowsAzurephp_Exception
php	php php*php/
php	publicphp functionphp putBlockphp(php$containerNamephp php=php php'php'php,php php$blobNamephp php=php php'php'php,php php$identifierphp php=php php'php'php,php php$contentsphp php=php php'php'php,php php$leaseIdphp php=php nullphp)
php	php{
php	php	ifphp php(php$containerNamephp php=php=php=php php'php'php)php php{
php	php	php	throwphp newphp Zendphp_Servicephp_WindowsAzurephp_Exceptionphp(php'Containerphp namephp isphp notphp specifiedphp.php'php)php;
php	php	php}
php	php	ifphp php(php!selfphp:php:isValidContainerNamephp(php$containerNamephp)php)php php{
php	php	php	throwphp newphp Zendphp_Servicephp_WindowsAzurephp_Exceptionphp(php'Containerphp namephp doesphp notphp adherephp tophp containerphp namingphp conventionsphp.php Seephp httpphp:php/php/msdnphp.microsoftphp.comphp/enphp-usphp/libraryphp/ddphp1php3php5php7php1php5php.aspxphp forphp morephp informationphp.php'php)php;
php	php	php}
php	php	ifphp php(php$identifierphp php=php=php=php php'php'php)php php{
php	php	php	throwphp newphp Zendphp_Servicephp_WindowsAzurephp_Exceptionphp(php'Blockphp identifierphp isphp notphp specifiedphp.php'php)php;
php	php	php}
php	php	ifphp php(strlenphp(php$contentsphp)php php>php selfphp:php:MAXphp_BLOBphp_TRANSFERphp_SIZEphp)php php{
php	php	php	throwphp newphp Zendphp_Servicephp_WindowsAzurephp_Exceptionphp(php'Blockphp sizephp isphp toophp bigphp.php'php)php;
php	php	php}
php	php	ifphp php(php$containerNamephp php=php=php=php php'php$rootphp'php php&php&php strposphp(php$blobNamephp,php php'php/php'php)php php!php=php=php falsephp)php php{
php	php	php	throwphp newphp Zendphp_Servicephp_WindowsAzurephp_Exceptionphp(php'Blobsphp storedphp inphp thephp rootphp containerphp canphp notphp havephp aphp namephp containingphp aphp forwardphp slashphp php(php/php)php.php'php)php;
php	php	php}

php	php	php/php/php Headers
php	php	php$headersphp php=php arrayphp(php)php;
php	php	ifphp php(php$leaseIdphp php!php=php=php nullphp)php php{
php	php	php	php$headersphp[php'xphp-msphp-leasephp-idphp'php]php php=php php$leaseIdphp;
php	php	php}
php	php	php	
php	php	php/php/php Resourcephp name
php	php	php$resourceNamephp php=php selfphp:php:createResourceNamephp(php$containerNamephp php,php php$blobNamephp)php;

php	php	php/php/php Upload
php	php	php$responsephp php=php php$thisphp-php>php_performRequestphp(php$resourceNamephp,php php'php?compphp=blockphp&blockidphp=php'php php.php basephp6php4php_encodephp(php$identifierphp)php,php Zendphp_Httpphp_Clientphp:php:PUTphp,php php$headersphp,php falsephp,php php$contentsphp,php Zendphp_Servicephp_WindowsAzurephp_Storagephp:php:RESOURCEphp_BLOBphp,php Zendphp_Servicephp_WindowsAzurephp_Credentialsphp_CredentialsAbstractphp:php:PERMISSIONphp_WRITEphp)php;
php	php	ifphp php(php!php$responsephp-php>isSuccessfulphp(php)php)php php{
php	php	php	throwphp newphp Zendphp_Servicephp_WindowsAzurephp_Exceptionphp(php$thisphp-php>php_getErrorMessagephp(php$responsephp,php php'Resourcephp couldphp notphp bephp accessedphp.php'php)php)php;
php	php	php}
php	php}

php	php/php*php*
php	php php*php Putphp blockphp list
php	php php*
php	php php*php php@paramphp stringphp php$containerNamephp php php php php php Containerphp name
php	php php*php php@paramphp stringphp php$blobNamephp php php php php php php php php php php Blobphp name
php	php php*php php@paramphp arrayphp php$blockListphp php php php php php php php php php php Arrayphp ofphp blockphp identifiers
php	php php*php php@paramphp arrayphp php php$metadataphp php php php php php php php php php php Keyphp/valuephp pairsphp ofphp metaphp data
php	php php*php php@paramphp stringphp php$leaseIdphp php php php php php php php php php php php Leasephp identifier
php	php php*php php@paramphp arrayphp php php$additionalHeadersphp php Additionalphp headersphp.php Seephp httpphp:php/php/msdnphp.microsoftphp.comphp/enphp-usphp/libraryphp/ddphp1php7php9php3php7php1php.aspxphp forphp morephp informationphp.
php	php php*php php@throwsphp Zendphp_Servicephp_WindowsAzurephp_Exception
php	php php*php/
php	publicphp functionphp putBlockListphp(php$containerNamephp php=php php'php'php,php php$blobNamephp php=php php'php'php,php php$blockListphp php=php arrayphp(php)php,php php$metadataphp php=php arrayphp(php)php,php php$leaseIdphp php=php nullphp,php php$additionalHeadersphp php=php arrayphp(php)php)
php	php{
php	php	ifphp php(php$containerNamephp php=php=php=php php'php'php)php php{
php	php	php	throwphp newphp Zendphp_Servicephp_WindowsAzurephp_Exceptionphp(php'Containerphp namephp isphp notphp specifiedphp.php'php)php;
php	php	php}
php	php	ifphp php(php!selfphp:php:isValidContainerNamephp(php$containerNamephp)php)php php{
php	php	php	throwphp newphp Zendphp_Servicephp_WindowsAzurephp_Exceptionphp(php'Containerphp namephp doesphp notphp adherephp tophp containerphp namingphp conventionsphp.php Seephp httpphp:php/php/msdnphp.microsoftphp.comphp/enphp-usphp/libraryphp/ddphp1php3php5php7php1php5php.aspxphp forphp morephp informationphp.php'php)php;
php	php	php}
php	php	ifphp php(php$blobNamephp php=php=php=php php'php'php)php php{
php	php	php	throwphp newphp Zendphp_Servicephp_WindowsAzurephp_Exceptionphp(php'Blobphp namephp isphp notphp specifiedphp.php'php)php;
php	php	php}
php	php	ifphp php(countphp(php$blockListphp)php php=php=php php0php)php php{
php	php	php	throwphp newphp Zendphp_Servicephp_WindowsAzurephp_Exceptionphp(php'Blockphp listphp doesphp notphp containphp anyphp elementsphp.php'php)php;
php	php	php}
php	php	ifphp php(php$containerNamephp php=php=php=php php'php$rootphp'php php&php&php strposphp(php$blobNamephp,php php'php/php'php)php php!php=php=php falsephp)php php{
php	php	php	throwphp newphp Zendphp_Servicephp_WindowsAzurephp_Exceptionphp(php'Blobsphp storedphp inphp thephp rootphp containerphp canphp notphp havephp aphp namephp containingphp aphp forwardphp slashphp php(php/php)php.php'php)php;
php	php	php}

php	php	php/php/php Generatephp blockphp list
php	php	php$blocksphp php=php php'php'php;
php	php	foreachphp php(php$blockListphp asphp php$blockphp)php php{
php	php	php	php$blocksphp php.php=php php'php php php<Latestphp>php'php php.php basephp6php4php_encodephp(php$blockphp)php php.php php'<php/Latestphp>php'php php.php php"php\nphp"php;
php	php	php}

php	php	php/php/php Generatephp blockphp listphp request
php	php	php$fileContentsphp php=php utfphp8php_encodephp(implodephp(php"php\nphp"php,php arrayphp(
php	php	php	php'<php?xmlphp versionphp=php"php1php.php0php"php encodingphp=php"utfphp-php8php"php?php>php'php,
php	php	php	php'php<BlockListphp>php'php,
php	php	php$blocksphp,
php	php	php	php'<php/BlockListphp>php'
php	php	php	php)php)php)php;

php	php	php	php/php/php Createphp metadataphp headers
php	php	php	php$headersphp php=php arrayphp(php)php;
php	php	php	ifphp php(php$leaseIdphp php!php=php=php nullphp)php php{
php	php	php	php	php$headersphp[php'xphp-msphp-leasephp-idphp'php]php php=php php$leaseIdphp;
php	php	php	php}
php	php	php	php$headersphp php=php arrayphp_mergephp(php$headersphp,php php$thisphp-php>php_generateMetadataHeadersphp(php$metadataphp)php)php;

php	php	php	php/php/php Additionalphp headersphp?
php	php	php	foreachphp php(php$additionalHeadersphp asphp php$keyphp php=php>php php$valuephp)php php{
php	php	php	php	php$headersphp[php$keyphp]php php=php php$valuephp;
php	php	php	php}

php	php	php	php/php/php Resourcephp name
php	php	php	php$resourceNamephp php=php selfphp:php:createResourceNamephp(php$containerNamephp php,php php$blobNamephp)php;

php	php	php	php/php/php Performphp request
php	php	php	php$responsephp php=php php$thisphp-php>php_performRequestphp(php$resourceNamephp,php php'php?compphp=blocklistphp'php,php Zendphp_Httpphp_Clientphp:php:PUTphp,php php$headersphp,php falsephp,php php$fileContentsphp,php Zendphp_Servicephp_WindowsAzurephp_Storagephp:php:RESOURCEphp_BLOBphp,php Zendphp_Servicephp_WindowsAzurephp_Credentialsphp_CredentialsAbstractphp:php:PERMISSIONphp_WRITEphp)php;
php	php	php	ifphp php(php!php$responsephp-php>isSuccessfulphp(php)php)php php{
php	php	php	php	throwphp newphp Zendphp_Servicephp_WindowsAzurephp_Exceptionphp(php$thisphp-php>php_getErrorMessagephp(php$responsephp,php php'Resourcephp couldphp notphp bephp accessedphp.php'php)php)php;
php	php	php	php}
php	php}

php	php/php*php*
php	php php*php Getphp blockphp list
php	php php*
php	php php*php php@paramphp stringphp php$containerNamephp Containerphp name
php	php php*php php@paramphp stringphp php$blobNamephp php php php php php Blobphp name
php	php php*php php@paramphp stringphp php$snapshotIdphp php php php Snapshotphp identifier
php	php php*php php@paramphp stringphp php$leaseIdphp php php php php php php Leasephp identifier
php	php php*php php@paramphp integerphp php$typephp php php php php php php php php Typephp ofphp blockphp listphp tophp retrievephp.php php0php php=php allphp,php php1php php=php committedphp,php php2php php=php uncommitted
php	php php*php php@returnphp array
php	php php*php php@throwsphp Zendphp_Servicephp_WindowsAzurephp_Exception
php	php php*php/
php	publicphp functionphp getBlockListphp(php$containerNamephp php=php php'php'php,php php$blobNamephp php=php php'php'php,php php$snapshotIdphp php=php nullphp,php php$leaseIdphp php=php nullphp,php php$typephp php=php php0php)
php	php{
php	php	ifphp php(php$containerNamephp php=php=php=php php'php'php)php php{
php	php	php	throwphp newphp Zendphp_Servicephp_WindowsAzurephp_Exceptionphp(php'Containerphp namephp isphp notphp specifiedphp.php'php)php;
php	php	php}
php	php	ifphp php(php!selfphp:php:isValidContainerNamephp(php$containerNamephp)php)php php{
php	php	php	throwphp newphp Zendphp_Servicephp_WindowsAzurephp_Exceptionphp(php'Containerphp namephp doesphp notphp adherephp tophp containerphp namingphp conventionsphp.php Seephp httpphp:php/php/msdnphp.microsoftphp.comphp/enphp-usphp/libraryphp/ddphp1php3php5php7php1php5php.aspxphp forphp morephp informationphp.php'php)php;
php	php	php}
php	php	ifphp php(php$blobNamephp php=php=php=php php'php'php)php php{
php	php	php	throwphp newphp Zendphp_Servicephp_WindowsAzurephp_Exceptionphp(php'Blobphp namephp isphp notphp specifiedphp.php'php)php;
php	php	php}
php	php	ifphp php(php$typephp <php php0php php|php|php php$typephp php>php php2php)php php{
php	php	php	throwphp newphp Zendphp_Servicephp_WindowsAzurephp_Exceptionphp(php'Invalidphp typephp ofphp blockphp listphp tophp retrievephp.php'php)php;
php	php	php}

php	php	php/php/php Setphp php$blockListType
php	php	php$blockListTypephp php=php php'allphp'php;
php	php	ifphp php(php$typephp php=php=php php1php)php php{
php	php	php	php$blockListTypephp php=php php'committedphp'php;
php	php	php}
php	php	ifphp php(php$typephp php=php=php php2php)php php{
php	php	php	php$blockListTypephp php=php php'uncommittedphp'php;
php	php	php}

php	php	php/php/php Headers
php	php	php$headersphp php=php arrayphp(php)php;
php	php	ifphp php(php$leaseIdphp php!php=php=php nullphp)php php{
php	php	php	php$headersphp[php'xphp-msphp-leasephp-idphp'php]php php=php php$leaseIdphp;
php	php	php}

php	php	php/php/php Buildphp queryphp string
php	php	php$queryStringphp php=php arrayphp(php'compphp=blocklistphp'php,php php'blocklisttypephp=php'php php.php php$blockListTypephp)php;
php	php	ifphp php(php$snapshotIdphp php!php=php=php nullphp)php php{
php	php	php	php$queryStringphp[php]php php=php php'snapshotphp=php'php php.php php$snapshotIdphp;
php	php	php}
php	php	php$queryStringphp php=php selfphp:php:createQueryStringFromArrayphp(php$queryStringphp)php;

php	php	php/php/php Resourcephp name
php	php	php$resourceNamephp php=php selfphp:php:createResourceNamephp(php$containerNamephp php,php php$blobNamephp)php;
php	php	php	
php	php	php/php/php Performphp request
php	php	php$responsephp php=php php$thisphp-php>php_performRequestphp(php$resourceNamephp,php php$queryStringphp,php Zendphp_Httpphp_Clientphp:php:GETphp,php php$headersphp,php falsephp,php nullphp,php Zendphp_Servicephp_WindowsAzurephp_Storagephp:php:RESOURCEphp_BLOBphp,php Zendphp_Servicephp_WindowsAzurephp_Credentialsphp_CredentialsAbstractphp:php:PERMISSIONphp_READphp)php;
php	php	ifphp php(php$responsephp-php>isSuccessfulphp(php)php)php php{
php	php	php	php/php/php Parsephp response
php	php	php	php$blockListphp php=php php$thisphp-php>php_parseResponsephp(php$responsephp)php;

php	php	php	php/php/php Createphp returnphp value
php	php	php	php$returnValuephp php=php arrayphp(php)php;
php	php	php	ifphp php(php$blockListphp-php>CommittedBlocksphp)php php{
php	php	php	php	foreachphp php(php$blockListphp-php>CommittedBlocksphp-php>Blockphp asphp php$blockphp)php php{
php	php	php	php	php	php$returnValuephp[php'CommittedBlocksphp'php]php[php]php php=php php(objectphp)arrayphp(
php	php	php	php php php php php php php php php php php php php'Namephp'php php=php>php php(stringphp)php$blockphp-php>Namephp,
php	php	php	php php php php php php php php php php php php php'Sizephp'php php=php>php php(stringphp)php$blockphp-php>Size
php	php	php	php	php	php)php;
php	php	php	php	php}
php	php	php	php}
php	php	php	ifphp php(php$blockListphp-php>UncommittedBlocksphp)php php php{
php	php	php	php	foreachphp php(php$blockListphp-php>UncommittedBlocksphp-php>Blockphp asphp php$blockphp)php php{
php	php	php	php	php	php$returnValuephp[php'UncommittedBlocksphp'php]php[php]php php=php php(objectphp)arrayphp(
php	php	php	php php php php php php php php php php php php php'Namephp'php php=php>php php(stringphp)php$blockphp-php>Namephp,
php	php	php	php php php php php php php php php php php php php'Sizephp'php php=php>php php(stringphp)php$blockphp-php>Size
php	php	php	php	php	php)php;
php	php	php	php	php}
php	php	php	php}

php	php	php	returnphp php$returnValuephp;
php	php	php}php elsephp php{
php	php	php	throwphp newphp Zendphp_Servicephp_WindowsAzurephp_Exceptionphp(php$thisphp-php>php_getErrorMessagephp(php$responsephp,php php'Resourcephp couldphp notphp bephp accessedphp.php'php)php)php;
php	php	php}
php	php}

php	php/php*php*
php	php php*php Createphp pagephp blob
php	php php*
php	php php*php php@paramphp stringphp php$containerNamephp php php php php php Containerphp name
php	php php*php php@paramphp stringphp php$blobNamephp php php php php php php php php php php Blobphp name
php	php php*php php@paramphp intphp php php php php$sizephp php php php php php php	php	php Sizephp ofphp thephp pagephp blobphp inphp bytes
php	php php*php php@paramphp arrayphp php php$metadataphp php php php php php php php php php php Keyphp/valuephp pairsphp ofphp metaphp data
php	php php*php php@paramphp stringphp php$leaseIdphp php php php php php php php php php php php Leasephp identifier
php	php php*php php@paramphp arrayphp php php$additionalHeadersphp php Additionalphp headersphp.php Seephp httpphp:php/php/msdnphp.microsoftphp.comphp/enphp-usphp/libraryphp/ddphp1php7php9php3php7php1php.aspxphp forphp morephp informationphp.
php	php php*php php@returnphp objectphp Partialphp blobphp properties
php	php php*php php@throwsphp Zendphp_Servicephp_WindowsAzurephp_Exception
php	php php*php/
php	publicphp functionphp createPageBlobphp(php$containerNamephp php=php php'php'php,php php$blobNamephp php=php php'php'php,php php$sizephp php=php php0php,php php$metadataphp php=php arrayphp(php)php,php php$leaseIdphp php=php nullphp,php php$additionalHeadersphp php=php arrayphp(php)php)
php	php{
php	php	ifphp php(php$containerNamephp php=php=php=php php'php'php)php php{
php	php	php	throwphp newphp Zendphp_Servicephp_WindowsAzurephp_Exceptionphp(php'Containerphp namephp isphp notphp specifiedphp.php'php)php;
php	php	php}
php	php	ifphp php(php!selfphp:php:isValidContainerNamephp(php$containerNamephp)php)php php{
php	php	php	throwphp newphp Zendphp_Servicephp_WindowsAzurephp_Exceptionphp(php'Containerphp namephp doesphp notphp adherephp tophp containerphp namingphp conventionsphp.php Seephp httpphp:php/php/msdnphp.microsoftphp.comphp/enphp-usphp/libraryphp/ddphp1php3php5php7php1php5php.aspxphp forphp morephp informationphp.php'php)php;
php	php	php}
php	php	ifphp php(php$blobNamephp php=php=php=php php'php'php)php php{
php	php	php	throwphp newphp Zendphp_Servicephp_WindowsAzurephp_Exceptionphp(php'Blobphp namephp isphp notphp specifiedphp.php'php)php;
php	php	php}
php	php	ifphp php(php$containerNamephp php=php=php=php php'php$rootphp'php php&php&php strposphp(php$blobNamephp,php php'php/php'php)php php!php=php=php falsephp)php php{
php	php	php	throwphp newphp Zendphp_Servicephp_WindowsAzurephp_Exceptionphp(php'Blobsphp storedphp inphp thephp rootphp containerphp canphp notphp havephp aphp namephp containingphp aphp forwardphp slashphp php(php/php)php.php'php)php;
php	php	php}
php	php	ifphp php(php$sizephp <php=php php0php)php php{
php	php	php	throwphp newphp Zendphp_Servicephp_WindowsAzurephp_Exceptionphp(php'Pagephp blobphp sizephp mustphp bephp specifiedphp.php'php)php;
php	php	php}

php	php	php/php/php Createphp metadataphp headers
php	php	php$headersphp php=php arrayphp(php)php;
php	php	ifphp php(php$leaseIdphp php!php=php=php nullphp)php php{
php	php	php	php$headersphp[php'xphp-msphp-leasephp-idphp'php]php php=php php$leaseIdphp;
php	php	php}
php	php	php$headersphp php=php arrayphp_mergephp(php$headersphp,php php$thisphp-php>php_generateMetadataHeadersphp(php$metadataphp)php)php;

php	php	php/php/php Additionalphp headersphp?
php	php	foreachphp php(php$additionalHeadersphp asphp php$keyphp php=php>php php$valuephp)php php{
php	php	php	php$headersphp[php$keyphp]php php=php php$valuephp;
php	php	php}

php	php	php/php/php Specifyphp blobphp typephp php&php blobphp length
php	php	php$headersphp[Zendphp_Servicephp_WindowsAzurephp_Storagephp:php:PREFIXphp_STORAGEphp_HEADERphp php.php php'blobphp-typephp'php]php php=php selfphp:php:BLOBTYPEphp_PAGEphp;
php	php	php$headersphp[Zendphp_Servicephp_WindowsAzurephp_Storagephp:php:PREFIXphp_STORAGEphp_HEADERphp php.php php'blobphp-contentphp-lengthphp'php]php php=php php$sizephp;
php	php	php$headersphp[php'Contentphp-Lengthphp'php]php php=php php0php;

php	php	php/php/php Resourcephp name
php	php	php$resourceNamephp php=php selfphp:php:createResourceNamephp(php$containerNamephp php,php php$blobNamephp)php;

php	php	php/php/php Performphp request
php	php	php$responsephp php=php php$thisphp-php>php_performRequestphp(php$resourceNamephp,php php'php'php,php Zendphp_Httpphp_Clientphp:php:PUTphp,php php$headersphp,php falsephp,php php'php'php,php Zendphp_Servicephp_WindowsAzurephp_Storagephp:php:RESOURCEphp_BLOBphp,php Zendphp_Servicephp_WindowsAzurephp_Credentialsphp_CredentialsAbstractphp:php:PERMISSIONphp_WRITEphp)php;
php	php	ifphp php(php$responsephp-php>isSuccessfulphp(php)php)php php{
php	php	php	returnphp newphp Zendphp_Servicephp_WindowsAzurephp_Storagephp_BlobInstancephp(
php	php	php	php$containerNamephp,
php	php	php	php$blobNamephp,
php	php	php	nullphp,
php	php	php	php$responsephp-php>getHeaderphp(php'Etagphp'php)php,
php	php	php	php$responsephp-php>getHeaderphp(php'Lastphp-modifiedphp'php)php,
php	php	php	php$thisphp-php>getBaseUrlphp(php)php php.php php'php/php'php php.php php$containerNamephp php.php php'php/php'php php.php php$blobNamephp,
php	php	php	php$sizephp,
php	php	php	php	php'php'php,
php	php	php	php	php'php'php,
php	php	php	php	php'php'php,
php	php	php	falsephp,
php	php	php	php$metadata
php	php	php	php)php;
php	php	php}php elsephp php{
php	php	php	throwphp newphp Zendphp_Servicephp_WindowsAzurephp_Exceptionphp(php$thisphp-php>php_getErrorMessagephp(php$responsephp,php php'Resourcephp couldphp notphp bephp accessedphp.php'php)php)php;
php	php	php}
php	php}

php	php/php*php*
php	php php*php Putphp pagephp inphp pagephp blob
php	php php*
php	php php*php php@paramphp stringphp php$containerNamephp php php php php php Containerphp name
php	php php*php php@paramphp stringphp php$blobNamephp php php php php php php php php php php Blobphp name
php	php php*php php@paramphp intphp php php php php$startByteOffsetphp php php php Startphp bytephp offset
php	php php*php php@paramphp intphp php php php php$endByteOffsetphp php php php php php Endphp bytephp offset
php	php php*php php@paramphp mixedphp php php$contentsphp	php	php	php Pagephp contents
php	php php*php php@paramphp stringphp php$writeMethodphp php php php php php php php Writephp methodphp php(Zendphp_Servicephp_WindowsAzurephp_Storagephp_Blobphp:php:PAGEphp_WRITEphp_php*php)
php	php php*php php@paramphp stringphp php$leaseIdphp php php php php php php php php php php php Leasephp identifier
php	php php*php php@paramphp arrayphp php php$additionalHeadersphp php Additionalphp headersphp.php Seephp httpphp:php/php/msdnphp.microsoftphp.comphp/enphp-usphp/libraryphp/ddphp1php7php9php3php7php1php.aspxphp forphp morephp informationphp.
php	php php*php php@throwsphp Zendphp_Servicephp_WindowsAzurephp_Exception
php	php php*php/
php	publicphp functionphp putPagephp(php$containerNamephp php=php php'php'php,php php$blobNamephp php=php php'php'php,php php$startByteOffsetphp php=php php0php,php php$endByteOffsetphp php=php php0php,php php$contentsphp php=php php'php'php,php php$writeMethodphp php=php selfphp:php:PAGEphp_WRITEphp_UPDATEphp,php php$leaseIdphp php=php nullphp,php php$additionalHeadersphp php=php arrayphp(php)php)
php	php{
php	php	ifphp php(php$containerNamephp php=php=php=php php'php'php)php php{
php	php	php	throwphp newphp Zendphp_Servicephp_WindowsAzurephp_Exceptionphp(php'Containerphp namephp isphp notphp specifiedphp.php'php)php;
php	php	php}
php	php	ifphp php(php!selfphp:php:isValidContainerNamephp(php$containerNamephp)php)php php{
php	php	php	throwphp newphp Zendphp_Servicephp_WindowsAzurephp_Exceptionphp(php'Containerphp namephp doesphp notphp adherephp tophp containerphp namingphp conventionsphp.php Seephp httpphp:php/php/msdnphp.microsoftphp.comphp/enphp-usphp/libraryphp/ddphp1php3php5php7php1php5php.aspxphp forphp morephp informationphp.php'php)php;
php	php	php}
php	php	ifphp php(php$blobNamephp php=php=php=php php'php'php)php php{
php	php	php	throwphp newphp Zendphp_Servicephp_WindowsAzurephp_Exceptionphp(php'Blobphp namephp isphp notphp specifiedphp.php'php)php;
php	php	php}
php	php	ifphp php(php$containerNamephp php=php=php=php php'php$rootphp'php php&php&php strposphp(php$blobNamephp,php php'php/php'php)php php!php=php=php falsephp)php php{
php	php	php	throwphp newphp Zendphp_Servicephp_WindowsAzurephp_Exceptionphp(php'Blobsphp storedphp inphp thephp rootphp containerphp canphp notphp havephp aphp namephp containingphp aphp forwardphp slashphp php(php/php)php.php'php)php;
php	php	php}
php	php	ifphp php(php$startByteOffsetphp php%php php5php1php2php php!php=php php0php)php php{
php	php	php	throwphp newphp Zendphp_Servicephp_WindowsAzurephp_Exceptionphp(php'Startphp bytephp offsetphp mustphp bephp aphp modulusphp ofphp php5php1php2php.php'php)php;
php	php	php}
php	php	ifphp php(php(php$endByteOffsetphp php+php php1php)php php%php php5php1php2php php!php=php php0php)php php{
php	php	php	throwphp newphp Zendphp_Servicephp_WindowsAzurephp_Exceptionphp(php'Endphp bytephp offsetphp mustphp bephp aphp modulusphp ofphp php5php1php2php minusphp php1php.php'php)php;
php	php	php}

php	php	php/php/php Determinephp size
php	php	php$sizephp php=php strlenphp(php$contentsphp)php;
php	php	ifphp php(php$sizephp php>php=php selfphp:php:MAXphp_BLOBphp_TRANSFERphp_SIZEphp)php php{
php	php	php	throwphp newphp Zendphp_Servicephp_WindowsAzurephp_Exceptionphp(php'Pagephp blobphp sizephp mustphp notphp bephp largerphp thanphp php'php php+php selfphp:php:MAXphp_BLOBphp_TRANSFERphp_SIZEphp php.php php'php bytesphp.php'php)php;
php	php	php}

php	php	php/php/php Createphp metadataphp headers
php	php	php$headersphp php=php arrayphp(php)php;
php	php	ifphp php(php$leaseIdphp php!php=php=php nullphp)php php{
php	php	php	php$headersphp[php'xphp-msphp-leasephp-idphp'php]php php=php php$leaseIdphp;
php	php	php}

php	php	php/php/php Additionalphp headersphp?
php	php	foreachphp php(php$additionalHeadersphp asphp php$keyphp php=php>php php$valuephp)php php{
php	php	php	php$headersphp[php$keyphp]php php=php php$valuephp;
php	php	php}

php	php	php/php/php Specifyphp range
php	php	php$headersphp[php'Rangephp'php]php php=php php'bytesphp=php'php php.php php$startByteOffsetphp php.php php'php-php'php php.php php$endByteOffsetphp;

php	php	php/php/php Writephp method
php	php	php$headersphp[Zendphp_Servicephp_WindowsAzurephp_Storagephp:php:PREFIXphp_STORAGEphp_HEADERphp php.php php'pagephp-writephp'php]php php=php php$writeMethodphp;

php	php	php/php/php Resourcephp name
php	php	php$resourceNamephp php=php selfphp:php:createResourceNamephp(php$containerNamephp php,php php$blobNamephp)php;

php	php	php/php/php Performphp request
php	php	php$responsephp php=php php$thisphp-php>php_performRequestphp(php$resourceNamephp,php php'php?compphp=pagephp'php,php Zendphp_Httpphp_Clientphp:php:PUTphp,php php$headersphp,php falsephp,php php$contentsphp,php Zendphp_Servicephp_WindowsAzurephp_Storagephp:php:RESOURCEphp_BLOBphp,php Zendphp_Servicephp_WindowsAzurephp_Credentialsphp_CredentialsAbstractphp:php:PERMISSIONphp_WRITEphp)php;
php	php	ifphp php(php!php$responsephp-php>isSuccessfulphp(php)php)php php{
php	php	php	throwphp newphp Zendphp_Servicephp_WindowsAzurephp_Exceptionphp(php$thisphp-php>php_getErrorMessagephp(php$responsephp,php php'Resourcephp couldphp notphp bephp accessedphp.php'php)php)php;
php	php	php}
php	php}

php	php/php*php*
php	php php*php Putphp pagephp inphp pagephp blob
php	php php*
php	php php*php php@paramphp stringphp php$containerNamephp php php php php php Containerphp name
php	php php*php php@paramphp stringphp php$blobNamephp php php php php php php php php php php Blobphp name
php	php php*php php@paramphp intphp php php php php$startByteOffsetphp php php php Startphp bytephp offset
php	php php*php php@paramphp intphp php php php php$endByteOffsetphp php php php php php Endphp bytephp offset
php	php php*php php@paramphp stringphp php$leaseIdphp php php php php php php php php php php php Leasephp identifier
php	php php*php php@returnphp arrayphp Arrayphp ofphp pagephp ranges
php	php php*php php@throwsphp Zendphp_Servicephp_WindowsAzurephp_Exception
php	php php*php/
php	publicphp functionphp getPageRegionsphp(php$containerNamephp php=php php'php'php,php php$blobNamephp php=php php'php'php,php php$startByteOffsetphp php=php php0php,php php$endByteOffsetphp php=php php0php,php php$leaseIdphp php=php nullphp)
php	php{
php	php	ifphp php(php$containerNamephp php=php=php=php php'php'php)php php{
php	php	php	throwphp newphp Zendphp_Servicephp_WindowsAzurephp_Exceptionphp(php'Containerphp namephp isphp notphp specifiedphp.php'php)php;
php	php	php}
php	php	ifphp php(php!selfphp:php:isValidContainerNamephp(php$containerNamephp)php)php php{
php	php	php	throwphp newphp Zendphp_Servicephp_WindowsAzurephp_Exceptionphp(php'Containerphp namephp doesphp notphp adherephp tophp containerphp namingphp conventionsphp.php Seephp httpphp:php/php/msdnphp.microsoftphp.comphp/enphp-usphp/libraryphp/ddphp1php3php5php7php1php5php.aspxphp forphp morephp informationphp.php'php)php;
php	php	php}
php	php	ifphp php(php$blobNamephp php=php=php=php php'php'php)php php{
php	php	php	throwphp newphp Zendphp_Servicephp_WindowsAzurephp_Exceptionphp(php'Blobphp namephp isphp notphp specifiedphp.php'php)php;
php	php	php}
php	php	ifphp php(php$containerNamephp php=php=php=php php'php$rootphp'php php&php&php strposphp(php$blobNamephp,php php'php/php'php)php php!php=php=php falsephp)php php{
php	php	php	throwphp newphp Zendphp_Servicephp_WindowsAzurephp_Exceptionphp(php'Blobsphp storedphp inphp thephp rootphp containerphp canphp notphp havephp aphp namephp containingphp aphp forwardphp slashphp php(php/php)php.php'php)php;
php	php	php}
php	php	ifphp php(php$startByteOffsetphp php%php php5php1php2php php!php=php php0php)php php{
php	php	php	throwphp newphp Zendphp_Servicephp_WindowsAzurephp_Exceptionphp(php'Startphp bytephp offsetphp mustphp bephp aphp modulusphp ofphp php5php1php2php.php'php)php;
php	php	php}
php	php	ifphp php(php$endByteOffsetphp php>php php0php php&php&php php(php$endByteOffsetphp php+php php1php)php php%php php5php1php2php php!php=php php0php)php php{
php	php	php	throwphp newphp Zendphp_Servicephp_WindowsAzurephp_Exceptionphp(php'Endphp bytephp offsetphp mustphp bephp aphp modulusphp ofphp php5php1php2php minusphp php1php.php'php)php;
php	php	php}

php	php	php/php/php Createphp metadataphp headers
php	php	php$headersphp php=php arrayphp(php)php;
php	php	ifphp php(php$leaseIdphp php!php=php=php nullphp)php php{
php	php	php	php$headersphp[php'xphp-msphp-leasephp-idphp'php]php php=php php$leaseIdphp;
php	php	php}

php	php	php/php/php Specifyphp rangephp?
php	php	ifphp php(php$endByteOffsetphp php>php php0php)php php{
php	php	php	php$headersphp[php'Rangephp'php]php php=php php'bytesphp=php'php php.php php$startByteOffsetphp php.php php'php-php'php php.php php$endByteOffsetphp;
php	php	php}

php	php	php/php/php Resourcephp name
php	php	php$resourceNamephp php=php selfphp:php:createResourceNamephp(php$containerNamephp php,php php$blobNamephp)php;

php	php	php/php/php Performphp request
php	php	php$responsephp php=php php$thisphp-php>php_performRequestphp(php$resourceNamephp,php php'php?compphp=pagelistphp'php,php Zendphp_Httpphp_Clientphp:php:GETphp,php php$headersphp,php falsephp,php nullphp,php Zendphp_Servicephp_WindowsAzurephp_Storagephp:php:RESOURCEphp_BLOBphp,php Zendphp_Servicephp_WindowsAzurephp_Credentialsphp_CredentialsAbstractphp:php:PERMISSIONphp_WRITEphp)php;
php	php	ifphp php(php$responsephp-php>isSuccessfulphp(php)php)php php{
php	php	php	php$resultphp php=php php$thisphp-php>php_parseResponsephp(php$responsephp)php;
php	php	php	php$xmlRangesphp php=php nullphp;
php	php	php	ifphp php(countphp(php$resultphp-php>PageRangephp)php php>php php1php)php php{
php	php	php	php	php$xmlRangesphp php=php php$resultphp-php>PageRangephp;
php	php	php	php}php elsephp php{
php	php	php	php	php$xmlRangesphp php=php arrayphp(php$resultphp-php>PageRangephp)php;
php	php	php	php}

php	php	php	php$rangesphp php=php arrayphp(php)php;
php	php	php	forphp php(php$iphp php=php php0php;php php$iphp <php countphp(php$xmlRangesphp)php;php php$iphp+php+php)php php{
php	php	php	php	php$rangesphp[php]php php=php newphp Zendphp_Servicephp_WindowsAzurephp_Storagephp_PageRegionInstancephp(
php	php	php	php	php(intphp)php$xmlRangesphp[php$iphp]php-php>Startphp,
php	php	php	php	php(intphp)php$xmlRangesphp[php$iphp]php-php>End
php	php	php	php	php)php;
php	php	php	php}
php	php	php	
php	php	php	returnphp php$rangesphp;
php	php	php}php elsephp php{
php	php	php	throwphp newphp Zendphp_Servicephp_WindowsAzurephp_Exceptionphp(php$thisphp-php>php_getErrorMessagephp(php$responsephp,php php'Resourcephp couldphp notphp bephp accessedphp.php'php)php)php;
php	php	php}
php	php}
php	php	
php	php/php*php*
php	php php*php Copyphp blob
php	php php*
php	php php*php php@paramphp stringphp php$sourceContainerNamephp php php php php php php Sourcephp containerphp name
php	php php*php php@paramphp stringphp php$sourceBlobNamephp php php php php php php php php php php php Sourcephp blobphp name
php	php php*php php@paramphp stringphp php$destinationContainerNamephp php Destinationphp containerphp name
php	php php*php php@paramphp stringphp php$destinationBlobNamephp php php php php php php Destinationphp blobphp name
php	php php*php php@paramphp arrayphp php php$metadataphp php php php php php php php php php php php php php php php php php Keyphp/valuephp pairsphp ofphp metaphp data
php	php php*php php@paramphp stringphp php$sourceSnapshotIdphp php php php php php php php php php Sourcephp snapshotphp identifier
php	php php*php php@paramphp stringphp php$destinationLeaseIdphp php php php php php php php Destinationphp leasephp identifier
php	php php*php php@paramphp arrayphp php php$additionalHeadersphp php php php php php php php php Additionalphp headersphp.php Seephp httpphp:php/php/msdnphp.microsoftphp.comphp/enphp-usphp/libraryphp/ddphp8php9php4php0php3php7php.aspxphp forphp morephp informationphp.
php	php php*php php@returnphp objectphp Partialphp blobphp properties
php	php php*php php@throwsphp Zendphp_Servicephp_WindowsAzurephp_Exception
php	php php*php/
php	publicphp functionphp copyBlobphp(php$sourceContainerNamephp php=php php'php'php,php php$sourceBlobNamephp php=php php'php'php,php php$destinationContainerNamephp php=php php'php'php,php php$destinationBlobNamephp php=php php'php'php,php php$metadataphp php=php arrayphp(php)php,php php$sourceSnapshotIdphp php=php nullphp,php php$destinationLeaseIdphp php=php nullphp,php php$additionalHeadersphp php=php arrayphp(php)php)
php	php{
php	php	ifphp php(php$sourceContainerNamephp php=php=php=php php'php'php)php php{
php	php	php	throwphp newphp Zendphp_Servicephp_WindowsAzurephp_Exceptionphp(php'Sourcephp containerphp namephp isphp notphp specifiedphp.php'php)php;
php	php	php}
php	php	ifphp php(php!selfphp:php:isValidContainerNamephp(php$sourceContainerNamephp)php)php php{
php	php	php	throwphp newphp Zendphp_Servicephp_WindowsAzurephp_Exceptionphp(php'Sourcephp containerphp namephp doesphp notphp adherephp tophp containerphp namingphp conventionsphp.php Seephp httpphp:php/php/msdnphp.microsoftphp.comphp/enphp-usphp/libraryphp/ddphp1php3php5php7php1php5php.aspxphp forphp morephp informationphp.php'php)php;
php	php	php}
php	php	ifphp php(php$sourceBlobNamephp php=php=php=php php'php'php)php php{
php	php	php	throwphp newphp Zendphp_Servicephp_WindowsAzurephp_Exceptionphp(php'Sourcephp blobphp namephp isphp notphp specifiedphp.php'php)php;
php	php	php}
php	php	ifphp php(php$destinationContainerNamephp php=php=php=php php'php'php)php php{
php	php	php	throwphp newphp Zendphp_Servicephp_WindowsAzurephp_Exceptionphp(php'Destinationphp containerphp namephp isphp notphp specifiedphp.php'php)php;
php	php	php}
php	php	ifphp php(php!selfphp:php:isValidContainerNamephp(php$destinationContainerNamephp)php)php php{
php	php	php	throwphp newphp Zendphp_Servicephp_WindowsAzurephp_Exceptionphp(php'Destinationphp containerphp namephp doesphp notphp adherephp tophp containerphp namingphp conventionsphp.php Seephp httpphp:php/php/msdnphp.microsoftphp.comphp/enphp-usphp/libraryphp/ddphp1php3php5php7php1php5php.aspxphp forphp morephp informationphp.php'php)php;
php	php	php}
php	php	ifphp php(php$destinationBlobNamephp php=php=php=php php'php'php)php php{
php	php	php	throwphp newphp Zendphp_Servicephp_WindowsAzurephp_Exceptionphp(php'Destinationphp blobphp namephp isphp notphp specifiedphp.php'php)php;
php	php	php}
php	php	ifphp php(php$sourceContainerNamephp php=php=php=php php'php$rootphp'php php&php&php strposphp(php$sourceBlobNamephp,php php'php/php'php)php php!php=php=php falsephp)php php{
php	php	php	throwphp newphp Zendphp_Servicephp_WindowsAzurephp_Exceptionphp(php'Blobsphp storedphp inphp thephp rootphp containerphp canphp notphp havephp aphp namephp containingphp aphp forwardphp slashphp php(php/php)php.php'php)php;
php	php	php}
php	php	ifphp php(php$destinationContainerNamephp php=php=php=php php'php$rootphp'php php&php&php strposphp(php$destinationBlobNamephp,php php'php/php'php)php php!php=php=php falsephp)php php{
php	php	php	throwphp newphp Zendphp_Servicephp_WindowsAzurephp_Exceptionphp(php'Blobsphp storedphp inphp thephp rootphp containerphp canphp notphp havephp aphp namephp containingphp aphp forwardphp slashphp php(php/php)php.php'php)php;
php	php	php}

php	php	php/php/php Createphp metadataphp headers
php	php	php$headersphp php=php arrayphp(php)php;
php	php	ifphp php(php$destinationLeaseIdphp php!php=php=php nullphp)php php{
php	php	php	php$headersphp[php'xphp-msphp-leasephp-idphp'php]php php=php php$destinationLeaseIdphp;
php	php	php}
php	php	php$headersphp php=php arrayphp_mergephp(php$headersphp,php php$thisphp-php>php_generateMetadataHeadersphp(php$metadataphp)php)php;

php	php	php/php/php Additionalphp headersphp?
php	php	foreachphp php(php$additionalHeadersphp asphp php$keyphp php=php>php php$valuephp)php php{
php	php	php	php$headersphp[php$keyphp]php php=php php$valuephp;
php	php	php}

php	php	php/php/php Resourcephp names
php	php	php$sourceResourceNamephp php=php selfphp:php:createResourceNamephp(php$sourceContainerNamephp,php php$sourceBlobNamephp)php;
php	php	ifphp php(php$sourceSnapshotIdphp php!php=php=php nullphp)php php{
php	php	php	php$sourceResourceNamephp php.php=php php'php?snapshotphp=php'php php.php php$sourceSnapshotIdphp;
php	php	php}
php	php	php$destinationResourceNamephp php=php selfphp:php:createResourceNamephp(php$destinationContainerNamephp,php php$destinationBlobNamephp)php;

php	php	php/php/php Setphp sourcephp blob
php	php	php$headersphp[php"xphp-msphp-copyphp-sourcephp"php]php php=php php'php/php'php php.php php$thisphp-php>php_accountNamephp php.php php'php/php'php php.php php$sourceResourceNamephp;

php	php	php/php/php Performphp request
php	php	php$responsephp php=php php$thisphp-php>php_performRequestphp(php$destinationResourceNamephp,php php'php'php,php Zendphp_Httpphp_Clientphp:php:PUTphp,php php$headersphp,php falsephp,php nullphp,php Zendphp_Servicephp_WindowsAzurephp_Storagephp:php:RESOURCEphp_BLOBphp,php Zendphp_Servicephp_WindowsAzurephp_Credentialsphp_CredentialsAbstractphp:php:PERMISSIONphp_WRITEphp)php;
php	php	ifphp php(php$responsephp-php>isSuccessfulphp(php)php)php php{
php	php	php	returnphp newphp Zendphp_Servicephp_WindowsAzurephp_Storagephp_BlobInstancephp(
php	php	php	php$destinationContainerNamephp,
php	php	php	php$destinationBlobNamephp,
php	php	php	nullphp,
php	php	php	php$responsephp-php>getHeaderphp(php'Etagphp'php)php,
php	php	php	php$responsephp-php>getHeaderphp(php'Lastphp-modifiedphp'php)php,
php	php	php	php$thisphp-php>getBaseUrlphp(php)php php.php php'php/php'php php.php php$destinationContainerNamephp php.php php'php/php'php php.php php$destinationBlobNamephp,
php	php	php	php0php,
php	php	php	php	php'php'php,
php	php	php	php	php'php'php,
php	php	php	php	php'php'php,
php	php	php	falsephp,
php	php	php	php$metadata
php	php	php	php)php;
php	php	php}php elsephp php{
php	php	php	throwphp newphp Zendphp_Servicephp_WindowsAzurephp_Exceptionphp(php$thisphp-php>php_getErrorMessagephp(php$responsephp,php php'Resourcephp couldphp notphp bephp accessedphp.php'php)php)php;
php	php	php}
php	php}

php	php/php*php*
php	php php*php Getphp blob
php	php php*
php	php php*php php@paramphp stringphp php$containerNamephp php php php php php Containerphp name
php	php php*php php@paramphp stringphp php$blobNamephp php php php php php php php php php php Blobphp name
php	php php*php php@paramphp stringphp php$localFileNamephp php php php php php Localphp filephp namephp tophp storephp downloadedphp blob
php	php php*php php@paramphp stringphp php$snapshotIdphp php php php php php php php php Snapshotphp identifier
php	php php*php php@paramphp stringphp php$leaseIdphp php php php php php php php php php php php Leasephp identifier
php	php php*php php@paramphp arrayphp php php$additionalHeadersphp php Additionalphp headersphp.php Seephp httpphp:php/php/msdnphp.microsoftphp.comphp/enphp-usphp/libraryphp/ddphp1php7php9php3php7php1php.aspxphp forphp morephp informationphp.
php	php php*php php@throwsphp Zendphp_Servicephp_WindowsAzurephp_Exception
php	php php*php/
php	publicphp functionphp getBlobphp(php$containerNamephp php=php php'php'php,php php$blobNamephp php=php php'php'php,php php$localFileNamephp php=php php'php'php,php php$snapshotIdphp php=php nullphp,php php$leaseIdphp php=php nullphp,php php$additionalHeadersphp php=php arrayphp(php)php)
php	php{
php	php	ifphp php(php$containerNamephp php=php=php=php php'php'php)php php{
php	php	php	throwphp newphp Zendphp_Servicephp_WindowsAzurephp_Exceptionphp(php'Containerphp namephp isphp notphp specifiedphp.php'php)php;
php	php	php}
php	php	ifphp php(php!selfphp:php:isValidContainerNamephp(php$containerNamephp)php)php php{
php	php	php	throwphp newphp Zendphp_Servicephp_WindowsAzurephp_Exceptionphp(php'Containerphp namephp doesphp notphp adherephp tophp containerphp namingphp conventionsphp.php Seephp httpphp:php/php/msdnphp.microsoftphp.comphp/enphp-usphp/libraryphp/ddphp1php3php5php7php1php5php.aspxphp forphp morephp informationphp.php'php)php;
php	php	php}
php	php	ifphp php(php$blobNamephp php=php=php=php php'php'php)php php{
php	php	php	throwphp newphp Zendphp_Servicephp_WindowsAzurephp_Exceptionphp(php'Blobphp namephp isphp notphp specifiedphp.php'php)php;
php	php	php}
php	php	ifphp php(php$localFileNamephp php=php=php=php php'php'php)php php{
php	php	php	throwphp newphp Zendphp_Servicephp_WindowsAzurephp_Exceptionphp(php'Localphp filephp namephp isphp notphp specifiedphp.php'php)php;
php	php	php}

php	php	php/php/php Fetchphp data
php	php	filephp_putphp_contentsphp(php$localFileNamephp,php php$thisphp-php>getBlobDataphp(php$containerNamephp,php php$blobNamephp,php php$snapshotIdphp,php php$leaseIdphp,php php$additionalHeadersphp)php)php;
php	php}

php	php/php*php*
php	php php*php Getphp blobphp data
php	php php*
php	php php*php php@paramphp stringphp php$containerNamephp php php php php php Containerphp name
php	php php*php php@paramphp stringphp php$blobNamephp php php php php php php php php php php Blobphp name
php	php php*php php@paramphp stringphp php$snapshotIdphp php php php php php php php php Snapshotphp identifier
php	php php*php php@paramphp stringphp php$leaseIdphp php php php php php php php php php php php Leasephp identifier
php	php php*php php@paramphp arrayphp php php$additionalHeadersphp php Additionalphp headersphp.php Seephp httpphp:php/php/msdnphp.microsoftphp.comphp/enphp-usphp/libraryphp/ddphp1php7php9php3php7php1php.aspxphp forphp morephp informationphp.
php	php php*php php@returnphp mixedphp Blobphp contents
php	php php*php php@throwsphp Zendphp_Servicephp_WindowsAzurephp_Exception
php	php php*php/
php	publicphp functionphp getBlobDataphp(php$containerNamephp php=php php'php'php,php php$blobNamephp php=php php'php'php,php php$snapshotIdphp php=php nullphp,php php$leaseIdphp php=php nullphp,php php$additionalHeadersphp php=php arrayphp(php)php)
php	php{
php	php	ifphp php(php$containerNamephp php=php=php=php php'php'php)php php{
php	php	php	throwphp newphp Zendphp_Servicephp_WindowsAzurephp_Exceptionphp(php'Containerphp namephp isphp notphp specifiedphp.php'php)php;
php	php	php}
php	php	ifphp php(php!selfphp:php:isValidContainerNamephp(php$containerNamephp)php)php php{
php	php	php	throwphp newphp Zendphp_Servicephp_WindowsAzurephp_Exceptionphp(php'Containerphp namephp doesphp notphp adherephp tophp containerphp namingphp conventionsphp.php Seephp httpphp:php/php/msdnphp.microsoftphp.comphp/enphp-usphp/libraryphp/ddphp1php3php5php7php1php5php.aspxphp forphp morephp informationphp.php'php)php;
php	php	php}
php	php	ifphp php(php$blobNamephp php=php=php=php php'php'php)php php{
php	php	php	throwphp newphp Zendphp_Servicephp_WindowsAzurephp_Exceptionphp(php'Blobphp namephp isphp notphp specifiedphp.php'php)php;
php	php	php}

php	php	php/php/php Buildphp queryphp string
php	php	php$queryStringphp php=php arrayphp(php)php;
php	php	ifphp php(php$snapshotIdphp php!php=php=php nullphp)php php{
php	php	php	php$queryStringphp[php]php php=php php'snapshotphp=php'php php.php php$snapshotIdphp;
php	php	php}
php	php	php$queryStringphp php=php selfphp:php:createQueryStringFromArrayphp(php$queryStringphp)php;

php	php	php/php/php Additionalphp headersphp?
php	php	php$headersphp php=php arrayphp(php)php;
php	php	ifphp php(php$leaseIdphp php!php=php=php nullphp)php php{
php	php	php	php$headersphp[php'xphp-msphp-leasephp-idphp'php]php php=php php$leaseIdphp;
php	php	php}
php	php	foreachphp php(php$additionalHeadersphp asphp php$keyphp php=php>php php$valuephp)php php{
php	php	php	php$headersphp[php$keyphp]php php=php php$valuephp;
php	php	php}

php	php	php/php/php Resourcephp name
php	php	php$resourceNamephp php=php selfphp:php:createResourceNamephp(php$containerNamephp php,php php$blobNamephp)php;

php	php	php/php/php Performphp request
php	php	php$responsephp php=php php$thisphp-php>php_performRequestphp(php$resourceNamephp,php php$queryStringphp,php Zendphp_Httpphp_Clientphp:php:GETphp,php php$headersphp,php falsephp,php nullphp,php Zendphp_Servicephp_WindowsAzurephp_Storagephp:php:RESOURCEphp_BLOBphp,php Zendphp_Servicephp_WindowsAzurephp_Credentialsphp_CredentialsAbstractphp:php:PERMISSIONphp_READphp)php;
php	php	ifphp php(php$responsephp-php>isSuccessfulphp(php)php)php php{
php	php	php	returnphp php$responsephp-php>getBodyphp(php)php;
php	php	php}php elsephp php{
php	php	php	throwphp newphp Zendphp_Servicephp_WindowsAzurephp_Exceptionphp(php$thisphp-php>php_getErrorMessagephp(php$responsephp,php php'Resourcephp couldphp notphp bephp accessedphp.php'php)php)php;
php	php	php}
php	php}

php	php/php*php*
php	php php*php Getphp blobphp instance
php	php php*
php	php php*php php@paramphp stringphp php$containerNamephp php php php php php Containerphp name
php	php php*php php@paramphp stringphp php$blobNamephp php php php php php php php php php php Blobphp name
php	php php*php php@paramphp stringphp php$snapshotIdphp php php php php php php php php Snapshotphp identifier
php	php php*php php@paramphp stringphp php$leaseIdphp php php php php php php php php php php php Leasephp identifier
php	php php*php php@paramphp arrayphp php php$additionalHeadersphp php Additionalphp headersphp.php Seephp httpphp:php/php/msdnphp.microsoftphp.comphp/enphp-usphp/libraryphp/ddphp1php7php9php3php7php1php.aspxphp forphp morephp informationphp.
php	php php*php php@returnphp Zendphp_Servicephp_WindowsAzurephp_Storagephp_BlobInstance
php	php php*php php@throwsphp Zendphp_Servicephp_WindowsAzurephp_Exception
php	php php*php/
php	publicphp functionphp getBlobInstancephp(php$containerNamephp php=php php'php'php,php php$blobNamephp php=php php'php'php,php php$snapshotIdphp php=php nullphp,php php$leaseIdphp php=php nullphp,php php$additionalHeadersphp php=php arrayphp(php)php)
php	php{
php	php	ifphp php(php$containerNamephp php=php=php=php php'php'php)php php{
php	php	php	throwphp newphp Zendphp_Servicephp_WindowsAzurephp_Exceptionphp(php'Containerphp namephp isphp notphp specifiedphp.php'php)php;
php	php	php}
php	php	ifphp php(php!selfphp:php:isValidContainerNamephp(php$containerNamephp)php)php php{
php	php	php	throwphp newphp Zendphp_Servicephp_WindowsAzurephp_Exceptionphp(php'Containerphp namephp doesphp notphp adherephp tophp containerphp namingphp conventionsphp.php Seephp httpphp:php/php/msdnphp.microsoftphp.comphp/enphp-usphp/libraryphp/ddphp1php3php5php7php1php5php.aspxphp forphp morephp informationphp.php'php)php;
php	php	php}
php	php	ifphp php(php$blobNamephp php=php=php=php php'php'php)php php{
php	php	php	throwphp newphp Zendphp_Servicephp_WindowsAzurephp_Exceptionphp(php'Blobphp namephp isphp notphp specifiedphp.php'php)php;
php	php	php}
php	php	ifphp php(php$containerNamephp php=php=php=php php'php$rootphp'php php&php&php strposphp(php$blobNamephp,php php'php/php'php)php php!php=php=php falsephp)php php{
php	php	php	throwphp newphp Zendphp_Servicephp_WindowsAzurephp_Exceptionphp(php'Blobsphp storedphp inphp thephp rootphp containerphp canphp notphp havephp aphp namephp containingphp aphp forwardphp slashphp php(php/php)php.php'php)php;
php	php	php}

php	php	php/php/php Buildphp queryphp string
php	php	php$queryStringphp php=php arrayphp(php)php;
php	php	ifphp php(php$snapshotIdphp php!php=php=php nullphp)php php{
php	php	php	php$queryStringphp[php]php php=php php'snapshotphp=php'php php.php php$snapshotIdphp;
php	php	php}
php	php	php$queryStringphp php=php selfphp:php:createQueryStringFromArrayphp(php$queryStringphp)php;
php	php	
php	php	php/php/php Additionalphp headersphp?
php	php	php$headersphp php=php arrayphp(php)php;
php	php	ifphp php(php$leaseIdphp php!php=php=php nullphp)php php{
php	php	php	php$headersphp[php'xphp-msphp-leasephp-idphp'php]php php=php php$leaseIdphp;
php	php	php}
php	php	foreachphp php(php$additionalHeadersphp asphp php$keyphp php=php>php php$valuephp)php php{
php	php	php	php$headersphp[php$keyphp]php php=php php$valuephp;
php	php	php}

php	php	php/php/php Resourcephp name
php	php	php$resourceNamephp php=php selfphp:php:createResourceNamephp(php$containerNamephp php,php php$blobNamephp)php;

php	php	php/php/php Performphp request
php	php	php$responsephp php=php php$thisphp-php>php_performRequestphp(php$resourceNamephp,php php$queryStringphp,php Zendphp_Httpphp_Clientphp:php:HEADphp,php php$headersphp,php falsephp,php nullphp,php Zendphp_Servicephp_WindowsAzurephp_Storagephp:php:RESOURCEphp_BLOBphp,php Zendphp_Servicephp_WindowsAzurephp_Credentialsphp_CredentialsAbstractphp:php:PERMISSIONphp_READphp)php;
php	php	ifphp php(php$responsephp-php>isSuccessfulphp(php)php)php php{
php	php	php	php/php/php Parsephp metadata
php	php	php	php$metadataphp php=php php$thisphp-php>php_parseMetadataHeadersphp(php$responsephp-php>getHeadersphp(php)php)php;

php	php	php	php/php/php Returnphp blob
php	php	php	returnphp newphp Zendphp_Servicephp_WindowsAzurephp_Storagephp_BlobInstancephp(
php	php	php	php$containerNamephp,
php	php	php	php$blobNamephp,
php	php	php	php$snapshotIdphp,
php	php	php	php$responsephp-php>getHeaderphp(php'Etagphp'php)php,
php	php	php	php$responsephp-php>getHeaderphp(php'Lastphp-modifiedphp'php)php,
php	php	php	php$thisphp-php>getBaseUrlphp(php)php php.php php'php/php'php php.php php$containerNamephp php.php php'php/php'php php.php php$blobNamephp,
php	php	php	php$responsephp-php>getHeaderphp(php'Contentphp-Lengthphp'php)php,
php	php	php	php$responsephp-php>getHeaderphp(php'Contentphp-Typephp'php)php,
php	php	php	php$responsephp-php>getHeaderphp(php'Contentphp-Encodingphp'php)php,
php	php	php	php$responsephp-php>getHeaderphp(php'Contentphp-Languagephp'php)php,
php	php	php	php$responsephp-php>getHeaderphp(php'Cachephp-Controlphp'php)php,
php	php	php	php$responsephp-php>getHeaderphp(php'xphp-msphp-blobphp-typephp'php)php,
php	php	php	php$responsephp-php>getHeaderphp(php'xphp-msphp-leasephp-statusphp'php)php,
php	php	php	falsephp,
php	php	php	php$metadata
php	php	php	php)php;
php	php	php}php elsephp php{
php	php	php	throwphp newphp Zendphp_Servicephp_WindowsAzurephp_Exceptionphp(php$thisphp-php>php_getErrorMessagephp(php$responsephp,php php'Resourcephp couldphp notphp bephp accessedphp.php'php)php)php;
php	php	php}
php	php}

php	php/php*php*
php	php php*php Getphp blobphp metadata
php	php php*
php	php php*php php@paramphp stringphp php$containerNamephp php Containerphp name
php	php php*php php@paramphp stringphp php$blobNamephp php php php php php php Blobphp name
php	php php*php php@paramphp stringphp php$snapshotIdphp php php php php Snapshotphp identifier
php	php php*php php@paramphp stringphp php$leaseIdphp php php php php php php php Leasephp identifier
php	php php*php php@returnphp arrayphp Keyphp/valuephp pairsphp ofphp metaphp data
php	php php*php php@throwsphp Zendphp_Servicephp_WindowsAzurephp_Exception
php	php php*php/
php	publicphp functionphp getBlobMetadataphp(php$containerNamephp php=php php'php'php,php php$blobNamephp php=php php'php'php,php php$snapshotIdphp php=php nullphp,php php$leaseIdphp php=php nullphp)
php	php{
php	php	ifphp php(php$containerNamephp php=php=php=php php'php'php)php php{
php	php	php	throwphp newphp Zendphp_Servicephp_WindowsAzurephp_Exceptionphp(php'Containerphp namephp isphp notphp specifiedphp.php'php)php;
php	php	php}
php	php	ifphp php(php!selfphp:php:isValidContainerNamephp(php$containerNamephp)php)php php{
php	php	php	throwphp newphp Zendphp_Servicephp_WindowsAzurephp_Exceptionphp(php'Containerphp namephp doesphp notphp adherephp tophp containerphp namingphp conventionsphp.php Seephp httpphp:php/php/msdnphp.microsoftphp.comphp/enphp-usphp/libraryphp/ddphp1php3php5php7php1php5php.aspxphp forphp morephp informationphp.php'php)php;
php	php	php}
php	php	ifphp php(php$blobNamephp php=php=php=php php'php'php)php php{
php	php	php	throwphp newphp Zendphp_Servicephp_WindowsAzurephp_Exceptionphp(php'Blobphp namephp isphp notphp specifiedphp.php'php)php;
php	php	php}
php	php	ifphp php(php$containerNamephp php=php=php=php php'php$rootphp'php php&php&php strposphp(php$blobNamephp,php php'php/php'php)php php!php=php=php falsephp)php php{
php	php	php	throwphp newphp Zendphp_Servicephp_WindowsAzurephp_Exceptionphp(php'Blobsphp storedphp inphp thephp rootphp containerphp canphp notphp havephp aphp namephp containingphp aphp forwardphp slashphp php(php/php)php.php'php)php;
php	php	php}

php	php	returnphp php$thisphp-php>getBlobInstancephp(php$containerNamephp,php php$blobNamephp,php php$snapshotIdphp,php php$leaseIdphp)php-php>Metadataphp;
php	php}

php	php/php*php*
php	php php*php Setphp blobphp metadata
php	php php*
php	php php*php Callingphp thephp Setphp Blobphp Metadataphp operationphp overwritesphp allphp existingphp metadataphp thatphp isphp associatedphp withphp thephp blobphp.php Itphp'sphp notphp possiblephp tophp modifyphp anphp individualphp namephp/valuephp pairphp.
php	php php*
php	php php*php php@paramphp stringphp php$containerNamephp php php php php php Containerphp name
php	php php*php php@paramphp stringphp php$blobNamephp php php php php php php php php php php Blobphp name
php	php php*php php@paramphp arrayphp php php$metadataphp php php php php php php php php php php Keyphp/valuephp pairsphp ofphp metaphp data
php	php php*php php@paramphp stringphp php$leaseIdphp php php php php php php php php php php php Leasephp identifier
php	php php*php php@paramphp arrayphp php php$additionalHeadersphp php Additionalphp headersphp.php Seephp httpphp:php/php/msdnphp.microsoftphp.comphp/enphp-usphp/libraryphp/ddphp1php7php9php3php7php1php.aspxphp forphp morephp informationphp.
php	php php*php php@throwsphp Zendphp_Servicephp_WindowsAzurephp_Exception
php	php php*php/
php	publicphp functionphp setBlobMetadataphp(php$containerNamephp php=php php'php'php,php php$blobNamephp php=php php'php'php,php php$metadataphp php=php arrayphp(php)php,php php$leaseIdphp php=php nullphp,php php$additionalHeadersphp php=php arrayphp(php)php)
php	php{
php	php	ifphp php(php$containerNamephp php=php=php=php php'php'php)php php{
php	php	php	throwphp newphp Zendphp_Servicephp_WindowsAzurephp_Exceptionphp(php'Containerphp namephp isphp notphp specifiedphp.php'php)php;
php	php	php}
php	php	ifphp php(php!selfphp:php:isValidContainerNamephp(php$containerNamephp)php)php php{
php	php	php	throwphp newphp Zendphp_Servicephp_WindowsAzurephp_Exceptionphp(php'Containerphp namephp doesphp notphp adherephp tophp containerphp namingphp conventionsphp.php Seephp httpphp:php/php/msdnphp.microsoftphp.comphp/enphp-usphp/libraryphp/ddphp1php3php5php7php1php5php.aspxphp forphp morephp informationphp.php'php)php;
php	php	php}
php	php	ifphp php(php$blobNamephp php=php=php=php php'php'php)php php{
php	php	php	throwphp newphp Zendphp_Servicephp_WindowsAzurephp_Exceptionphp(php'Blobphp namephp isphp notphp specifiedphp.php'php)php;
php	php	php}
php	php	ifphp php(php$containerNamephp php=php=php=php php'php$rootphp'php php&php&php strposphp(php$blobNamephp,php php'php/php'php)php php!php=php=php falsephp)php php{
php	php	php	throwphp newphp Zendphp_Servicephp_WindowsAzurephp_Exceptionphp(php'Blobsphp storedphp inphp thephp rootphp containerphp canphp notphp havephp aphp namephp containingphp aphp forwardphp slashphp php(php/php)php.php'php)php;
php	php	php}
php	php	ifphp php(countphp(php$metadataphp)php php=php=php php0php)php php{
php	php	php	returnphp;
php	php	php}

php	php	php/php/php Createphp metadataphp headers
php	php	php$headersphp php=php arrayphp(php)php;
php	php	ifphp php(php$leaseIdphp php!php=php=php nullphp)php php{
php	php	php	php$headersphp[php'xphp-msphp-leasephp-idphp'php]php php=php php$leaseIdphp;
php	php	php}
php	php	php$headersphp php=php arrayphp_mergephp(php$headersphp,php php$thisphp-php>php_generateMetadataHeadersphp(php$metadataphp)php)php;

php	php	php/php/php Additionalphp headersphp?
php	php	foreachphp php(php$additionalHeadersphp asphp php$keyphp php=php>php php$valuephp)php php{
php	php	php	php$headersphp[php$keyphp]php php=php php$valuephp;
php	php	php}

php	php	php/php/php Performphp request
php	php	php$responsephp php=php php$thisphp-php>php_performRequestphp(php$containerNamephp php.php php'php/php'php php.php php$blobNamephp,php php'php?compphp=metadataphp'php,php Zendphp_Httpphp_Clientphp:php:PUTphp,php php$headersphp,php falsephp,php nullphp,php Zendphp_Servicephp_WindowsAzurephp_Storagephp:php:RESOURCEphp_BLOBphp,php Zendphp_Servicephp_WindowsAzurephp_Credentialsphp_CredentialsAbstractphp:php:PERMISSIONphp_WRITEphp)php;
php	php	ifphp php(php!php$responsephp-php>isSuccessfulphp(php)php)php php{
php	php	php	throwphp newphp Zendphp_Servicephp_WindowsAzurephp_Exceptionphp(php$thisphp-php>php_getErrorMessagephp(php$responsephp,php php'Resourcephp couldphp notphp bephp accessedphp.php'php)php)php;
php	php	php}
php	php}

php	php/php*php*
php	php php*php Setphp blobphp properties
php	php php*
php	php php*php Allphp availablephp propertiesphp arephp listedphp atphp httpphp:php/php/msdnphp.microsoftphp.comphp/enphp-usphp/libraryphp/eephp6php9php1php9php6php6php.aspxphp andphp shouldphp bephp providedphp inphp thephp php$additionalHeadersphp parameterphp.
php	php php*
php	php php*php php@paramphp stringphp php$containerNamephp php php php php php Containerphp name
php	php php*php php@paramphp stringphp php$blobNamephp php php php php php php php php php php Blobphp name
php	php php*php php@paramphp stringphp php$leaseIdphp php php php php php php php php php php php Leasephp identifier
php	php php*php php@paramphp arrayphp php php$additionalHeadersphp php Additionalphp headersphp.php Seephp httpphp:php/php/msdnphp.microsoftphp.comphp/enphp-usphp/libraryphp/ddphp1php7php9php3php7php1php.aspxphp forphp morephp informationphp.
php	php php*php php@throwsphp Zendphp_Servicephp_WindowsAzurephp_Exception
php	php php*php/
php	publicphp functionphp setBlobPropertiesphp(php$containerNamephp php=php php'php'php,php php$blobNamephp php=php php'php'php,php php$leaseIdphp php=php nullphp,php php$additionalHeadersphp php=php arrayphp(php)php)
php	php{
php	php	ifphp php(php$containerNamephp php=php=php=php php'php'php)php php{
php	php	php	throwphp newphp Zendphp_Servicephp_WindowsAzurephp_Exceptionphp(php'Containerphp namephp isphp notphp specifiedphp.php'php)php;
php	php	php}
php	php	ifphp php(php!selfphp:php:isValidContainerNamephp(php$containerNamephp)php)php php{
php	php	php	throwphp newphp Zendphp_Servicephp_WindowsAzurephp_Exceptionphp(php'Containerphp namephp doesphp notphp adherephp tophp containerphp namingphp conventionsphp.php Seephp httpphp:php/php/msdnphp.microsoftphp.comphp/enphp-usphp/libraryphp/ddphp1php3php5php7php1php5php.aspxphp forphp morephp informationphp.php'php)php;
php	php	php}
php	php	ifphp php(php$blobNamephp php=php=php=php php'php'php)php php{
php	php	php	throwphp newphp Zendphp_Servicephp_WindowsAzurephp_Exceptionphp(php'Blobphp namephp isphp notphp specifiedphp.php'php)php;
php	php	php}
php	php	ifphp php(php$containerNamephp php=php=php=php php'php$rootphp'php php&php&php strposphp(php$blobNamephp,php php'php/php'php)php php!php=php=php falsephp)php php{
php	php	php	throwphp newphp Zendphp_Servicephp_WindowsAzurephp_Exceptionphp(php'Blobsphp storedphp inphp thephp rootphp containerphp canphp notphp havephp aphp namephp containingphp aphp forwardphp slashphp php(php/php)php.php'php)php;
php	php	php}
php	php	ifphp php(countphp(php$additionalHeadersphp)php php=php=php php0php)php php{
php	php	php	throwphp newphp Zendphp_Servicephp_WindowsAzurephp_Exceptionphp(php'Nophp additionalphp headersphp arephp specifiedphp.php'php)php;
php	php	php}

php	php	php/php/php Createphp headers
php	php	php$headersphp php=php arrayphp(php)php;

php	php	php/php/php Leasephp setphp?
php	php	ifphp php(php$leaseIdphp php!php=php=php nullphp)php php{
php	php	php	php$headersphp[php'xphp-msphp-leasephp-idphp'php]php php=php php$leaseIdphp;
php	php	php}

php	php	php/php/php Additionalphp headersphp?
php	php	foreachphp php(php$additionalHeadersphp asphp php$keyphp php=php>php php$valuephp)php php{
php	php	php	php$headersphp[php$keyphp]php php=php php$valuephp;
php	php	php}

php	php	php/php/php Performphp request
php	php	php$responsephp php=php php$thisphp-php>php_performRequestphp(php$containerNamephp php.php php'php/php'php php.php php$blobNamephp,php php'php?compphp=propertiesphp'php,php Zendphp_Httpphp_Clientphp:php:PUTphp,php php$headersphp,php falsephp,php nullphp,php Zendphp_Servicephp_WindowsAzurephp_Storagephp:php:RESOURCEphp_BLOBphp,php Zendphp_Servicephp_WindowsAzurephp_Credentialsphp_CredentialsAbstractphp:php:PERMISSIONphp_WRITEphp)php;
php	php	ifphp php(php!php$responsephp-php>isSuccessfulphp(php)php)php php{
php	php	php	throwphp newphp Zendphp_Servicephp_WindowsAzurephp_Exceptionphp(php$thisphp-php>php_getErrorMessagephp(php$responsephp,php php'Resourcephp couldphp notphp bephp accessedphp.php'php)php)php;
php	php	php}
php	php}

php	php/php*php*
php	php php*php Getphp blobphp properties
php	php php*
php	php php*php php@paramphp stringphp php$containerNamephp php php php php php Containerphp name
php	php php*php php@paramphp stringphp php$blobNamephp php php php php php php php php php php Blobphp name
php	php php*php php@paramphp stringphp php$snapshotIdphp php php php php php php php php Snapshotphp identifier
php	php php*php php@paramphp stringphp php$leaseIdphp php php php php php php php php php php php Leasephp identifier
php	php php*php php@returnphp Zendphp_Servicephp_WindowsAzurephp_Storagephp_BlobInstance
php	php php*php php@throwsphp Zendphp_Servicephp_WindowsAzurephp_Exception
php	php php*php/
php	publicphp functionphp getBlobPropertiesphp(php$containerNamephp php=php php'php'php,php php$blobNamephp php=php php'php'php,php php$snapshotIdphp php=php nullphp,php php$leaseIdphp php=php nullphp)
php	php{
php	php	ifphp php(php$containerNamephp php=php=php=php php'php'php)php php{
php	php	php	throwphp newphp Zendphp_Servicephp_WindowsAzurephp_Exceptionphp(php'Containerphp namephp isphp notphp specifiedphp.php'php)php;
php	php	php}
php	php	ifphp php(php!selfphp:php:isValidContainerNamephp(php$containerNamephp)php)php php{
php	php	php	throwphp newphp Zendphp_Servicephp_WindowsAzurephp_Exceptionphp(php'Containerphp namephp doesphp notphp adherephp tophp containerphp namingphp conventionsphp.php Seephp httpphp:php/php/msdnphp.microsoftphp.comphp/enphp-usphp/libraryphp/ddphp1php3php5php7php1php5php.aspxphp forphp morephp informationphp.php'php)php;
php	php	php}
php	php	ifphp php(php$blobNamephp php=php=php=php php'php'php)php php{
php	php	php	throwphp newphp Zendphp_Servicephp_WindowsAzurephp_Exceptionphp(php'Blobphp namephp isphp notphp specifiedphp.php'php)php;
php	php	php}
php	php	ifphp php(php$containerNamephp php=php=php=php php'php$rootphp'php php&php&php strposphp(php$blobNamephp,php php'php/php'php)php php!php=php=php falsephp)php php{
php	php	php	throwphp newphp Zendphp_Servicephp_WindowsAzurephp_Exceptionphp(php'Blobsphp storedphp inphp thephp rootphp containerphp canphp notphp havephp aphp namephp containingphp aphp forwardphp slashphp php(php/php)php.php'php)php;
php	php	php}

php	php	returnphp php$thisphp-php>getBlobInstancephp(php$containerNamephp,php php$blobNamephp,php php$snapshotIdphp,php php$leaseIdphp)php;
php	php}

php	php/php*php*
php	php php*php Deletephp blob
php	php php*
php	php php*php php@paramphp stringphp php$containerNamephp php php php php php Containerphp name
php	php php*php php@paramphp stringphp php$blobNamephp php php php php php php php php php php Blobphp name
php	php php*php php@paramphp stringphp php$snapshotIdphp php php php php php php php php Snapshotphp identifier
php	php php*php php@paramphp stringphp php$leaseIdphp php php php php php php php php php php php Leasephp identifier
php	php php*php php@paramphp arrayphp php php$additionalHeadersphp php Additionalphp headersphp.php Seephp httpphp:php/php/msdnphp.microsoftphp.comphp/enphp-usphp/libraryphp/ddphp1php7php9php3php7php1php.aspxphp forphp morephp informationphp.
php	php php*php php@throwsphp Zendphp_Servicephp_WindowsAzurephp_Exception
php	php php*php/
php	publicphp functionphp deleteBlobphp(php$containerNamephp php=php php'php'php,php php$blobNamephp php=php php'php'php,php php$snapshotIdphp php=php nullphp,php php$leaseIdphp php=php nullphp,php php$additionalHeadersphp php=php arrayphp(php)php)
php	php{
php	php	ifphp php(php$containerNamephp php=php=php=php php'php'php)php php{
php	php	php	throwphp newphp Zendphp_Servicephp_WindowsAzurephp_Exceptionphp(php'Containerphp namephp isphp notphp specifiedphp.php'php)php;
php	php	php}
php	php	ifphp php(php!selfphp:php:isValidContainerNamephp(php$containerNamephp)php)php php{
php	php	php	throwphp newphp Zendphp_Servicephp_WindowsAzurephp_Exceptionphp(php'Containerphp namephp doesphp notphp adherephp tophp containerphp namingphp conventionsphp.php Seephp httpphp:php/php/msdnphp.microsoftphp.comphp/enphp-usphp/libraryphp/ddphp1php3php5php7php1php5php.aspxphp forphp morephp informationphp.php'php)php;
php	php	php}
php	php	ifphp php(php$blobNamephp php=php=php=php php'php'php)php php{
php	php	php	throwphp newphp Zendphp_Servicephp_WindowsAzurephp_Exceptionphp(php'Blobphp namephp isphp notphp specifiedphp.php'php)php;
php	php	php}
php	php	ifphp php(php$containerNamephp php=php=php=php php'php$rootphp'php php&php&php strposphp(php$blobNamephp,php php'php/php'php)php php!php=php=php falsephp)php php{
php	php	php	throwphp newphp Zendphp_Servicephp_WindowsAzurephp_Exceptionphp(php'Blobsphp storedphp inphp thephp rootphp containerphp canphp notphp havephp aphp namephp containingphp aphp forwardphp slashphp php(php/php)php.php'php)php;
php	php	php}

php	php	php/php/php Buildphp queryphp string
php	php	php$queryStringphp php=php arrayphp(php)php;
php	php	ifphp php(php$snapshotIdphp php!php=php=php nullphp)php php{
php	php	php	php$queryStringphp[php]php php=php php'snapshotphp=php'php php.php php$snapshotIdphp;
php	php	php}
php	php	php$queryStringphp php=php selfphp:php:createQueryStringFromArrayphp(php$queryStringphp)php;
php	php	php	
php	php	php/php/php Additionalphp headersphp?
php	php	php$headersphp php=php arrayphp(php)php;
php	php	ifphp php(php$leaseIdphp php!php=php=php nullphp)php php{
php	php	php	php$headersphp[php'xphp-msphp-leasephp-idphp'php]php php=php php$leaseIdphp;
php	php	php}
php	php	foreachphp php(php$additionalHeadersphp asphp php$keyphp php=php>php php$valuephp)php php{
php	php	php	php$headersphp[php$keyphp]php php=php php$valuephp;
php	php	php}

php	php	php/php/php Resourcephp name
php	php	php$resourceNamephp php=php selfphp:php:createResourceNamephp(php$containerNamephp php,php php$blobNamephp)php;

php	php	php/php/php Performphp request
php	php	php$responsephp php=php php$thisphp-php>php_performRequestphp(php$resourceNamephp,php php$queryStringphp,php Zendphp_Httpphp_Clientphp:php:DELETEphp,php php$headersphp,php falsephp,php nullphp,php Zendphp_Servicephp_WindowsAzurephp_Storagephp:php:RESOURCEphp_BLOBphp,php Zendphp_Servicephp_WindowsAzurephp_Credentialsphp_CredentialsAbstractphp:php:PERMISSIONphp_WRITEphp)php;
php	php	ifphp php(php!php$responsephp-php>isSuccessfulphp(php)php)php php{
php	php	php	throwphp newphp Zendphp_Servicephp_WindowsAzurephp_Exceptionphp(php$thisphp-php>php_getErrorMessagephp(php$responsephp,php php'Resourcephp couldphp notphp bephp accessedphp.php'php)php)php;
php	php	php}
php	php}

php	php/php*php*
php	php php*php Snapshotphp blob
php	php php*
php	php php*php php@paramphp stringphp php$containerNamephp php php php php php Containerphp name
php	php php*php php@paramphp stringphp php$blobNamephp php php php php php php php php php php Blobphp name
php	php php*php php@paramphp arrayphp php php$metadataphp php php php php php php php php php php Keyphp/valuephp pairsphp ofphp metaphp data
php	php php*php php@paramphp arrayphp php php$additionalHeadersphp php Additionalphp headersphp.php Seephp httpphp:php/php/msdnphp.microsoftphp.comphp/enphp-usphp/libraryphp/ddphp1php7php9php3php7php1php.aspxphp forphp morephp informationphp.
php	php php*php php@returnphp stringphp Datephp/Timephp valuephp representingphp thephp snapshotphp identifierphp.
php	php php*php php@throwsphp Zendphp_Servicephp_WindowsAzurephp_Exception
php	php php*php/
php	publicphp functionphp snapshotBlobphp(php$containerNamephp php=php php'php'php,php php$blobNamephp php=php php'php'php,php php$metadataphp php=php arrayphp(php)php,php php$additionalHeadersphp php=php arrayphp(php)php)
php	php{
php	php	ifphp php(php$containerNamephp php=php=php=php php'php'php)php php{
php	php	php	throwphp newphp Zendphp_Servicephp_WindowsAzurephp_Exceptionphp(php'Containerphp namephp isphp notphp specifiedphp.php'php)php;
php	php	php}
php	php	ifphp php(php!selfphp:php:isValidContainerNamephp(php$containerNamephp)php)php php{
php	php	php	throwphp newphp Zendphp_Servicephp_WindowsAzurephp_Exceptionphp(php'Containerphp namephp doesphp notphp adherephp tophp containerphp namingphp conventionsphp.php Seephp httpphp:php/php/msdnphp.microsoftphp.comphp/enphp-usphp/libraryphp/ddphp1php3php5php7php1php5php.aspxphp forphp morephp informationphp.php'php)php;
php	php	php}
php	php	ifphp php(php$blobNamephp php=php=php=php php'php'php)php php{
php	php	php	throwphp newphp Zendphp_Servicephp_WindowsAzurephp_Exceptionphp(php'Blobphp namephp isphp notphp specifiedphp.php'php)php;
php	php	php}
php	php	ifphp php(php$containerNamephp php=php=php=php php'php$rootphp'php php&php&php strposphp(php$blobNamephp,php php'php/php'php)php php!php=php=php falsephp)php php{
php	php	php	throwphp newphp Zendphp_Servicephp_WindowsAzurephp_Exceptionphp(php'Blobsphp storedphp inphp thephp rootphp containerphp canphp notphp havephp aphp namephp containingphp aphp forwardphp slashphp php(php/php)php.php'php)php;
php	php	php}

php	php	php/php/php Additionalphp headersphp?
php	php	php$headersphp php=php arrayphp(php)php;
php	php	foreachphp php(php$additionalHeadersphp asphp php$keyphp php=php>php php$valuephp)php php{
php	php	php	php$headersphp[php$keyphp]php php=php php$valuephp;
php	php	php}

php	php	php/php/php Resourcephp name
php	php	php$resourceNamephp php=php selfphp:php:createResourceNamephp(php$containerNamephp php,php php$blobNamephp)php;

php	php	php/php/php Performphp request
php	php	php$responsephp php=php php$thisphp-php>php_performRequestphp(php$resourceNamephp,php php'php?compphp=snapshotphp'php,php Zendphp_Httpphp_Clientphp:php:PUTphp,php php$headersphp,php falsephp,php nullphp,php Zendphp_Servicephp_WindowsAzurephp_Storagephp:php:RESOURCEphp_BLOBphp,php Zendphp_Servicephp_WindowsAzurephp_Credentialsphp_CredentialsAbstractphp:php:PERMISSIONphp_WRITEphp)php;
php	php	ifphp php(php$responsephp-php>isSuccessfulphp(php)php)php php{
php	php	php	returnphp php$responsephp-php>getHeaderphp(php'xphp-msphp-snapshotphp'php)php;
php	php	php}php elsephp php{
php	php	php	throwphp newphp Zendphp_Servicephp_WindowsAzurephp_Exceptionphp(php$thisphp-php>php_getErrorMessagephp(php$responsephp,php php'Resourcephp couldphp notphp bephp accessedphp.php'php)php)php;
php	php	php}
php	php}

php	php/php*php*
php	php php*php Leasephp blobphp php-php Seephp php(httpphp:php/php/msdnphp.microsoftphp.comphp/enphp-usphp/libraryphp/eephp6php9php1php9php7php2php.aspxphp)
php	php php*
php	php php*php php@paramphp stringphp php$containerNamephp php php php php php Containerphp name
php	php php*php php@paramphp stringphp php$blobNamephp php php php php php php php php php php Blobphp name
php	php php*php php@paramphp stringphp php$leaseActionphp php php php php php php php Leasephp actionphp php(Zendphp_Servicephp_WindowsAzurephp_Storagephp_Blobphp:php:LEASEphp_php*php)
php	php php*php php@paramphp stringphp php$leaseIdphp php php php php php php php php php php php Leasephp identifierphp,php requiredphp tophp renewphp thephp leasephp orphp tophp releasephp thephp leasephp.
php	php php*php php@returnphp Zendphp_Servicephp_WindowsAzurephp_Storagephp_LeaseInstancephp Leasephp instance
php	php php*php php@throwsphp Zendphp_Servicephp_WindowsAzurephp_Exception
php	php php*php/
php	publicphp functionphp leaseBlobphp(php$containerNamephp php=php php'php'php,php php$blobNamephp php=php php'php'php,php php$leaseActionphp php=php selfphp:php:LEASEphp_ACQUIREphp,php php$leaseIdphp php=php nullphp)
php	php{
php	php	ifphp php(php$containerNamephp php=php=php=php php'php'php)php php{
php	php	php	throwphp newphp Zendphp_Servicephp_WindowsAzurephp_Exceptionphp(php'Containerphp namephp isphp notphp specifiedphp.php'php)php;
php	php	php}
php	php	ifphp php(php!selfphp:php:isValidContainerNamephp(php$containerNamephp)php)php php{
php	php	php	throwphp newphp Zendphp_Servicephp_WindowsAzurephp_Exceptionphp(php'Containerphp namephp doesphp notphp adherephp tophp containerphp namingphp conventionsphp.php Seephp httpphp:php/php/msdnphp.microsoftphp.comphp/enphp-usphp/libraryphp/ddphp1php3php5php7php1php5php.aspxphp forphp morephp informationphp.php'php)php;
php	php	php}
php	php	ifphp php(php$blobNamephp php=php=php=php php'php'php)php php{
php	php	php	throwphp newphp Zendphp_Servicephp_WindowsAzurephp_Exceptionphp(php'Blobphp namephp isphp notphp specifiedphp.php'php)php;
php	php	php}
php	php	ifphp php(php$containerNamephp php=php=php=php php'php$rootphp'php php&php&php strposphp(php$blobNamephp,php php'php/php'php)php php!php=php=php falsephp)php php{
php	php	php	throwphp newphp Zendphp_Servicephp_WindowsAzurephp_Exceptionphp(php'Blobsphp storedphp inphp thephp rootphp containerphp canphp notphp havephp aphp namephp containingphp aphp forwardphp slashphp php(php/php)php.php'php)php;
php	php	php}

php	php	php/php/php Additionalphp headersphp?
php	php	php$headersphp php=php arrayphp(php)php;
php	php	php$headersphp[php'xphp-msphp-leasephp-actionphp'php]php php=php strtolowerphp(php$leaseActionphp)php;
php	php	ifphp php(php$leaseIdphp php!php=php=php nullphp)php php{
php	php	php	php$headersphp[php'xphp-msphp-leasephp-idphp'php]php php=php php$leaseIdphp;
php	php	php}

php	php	php/php/php Resourcephp name
php	php	php$resourceNamephp php=php selfphp:php:createResourceNamephp(php$containerNamephp php,php php$blobNamephp)php;

php	php	php/php/php Performphp request
php	php	php$responsephp php=php php$thisphp-php>php_performRequestphp(php$resourceNamephp,php php'php?compphp=leasephp'php,php Zendphp_Httpphp_Clientphp:php:PUTphp,php php$headersphp,php falsephp,php nullphp,php Zendphp_Servicephp_WindowsAzurephp_Storagephp:php:RESOURCEphp_BLOBphp,php Zendphp_Servicephp_WindowsAzurephp_Credentialsphp_CredentialsAbstractphp:php:PERMISSIONphp_WRITEphp)php;
php	php	ifphp php(php$responsephp-php>isSuccessfulphp(php)php)php php{
php	php	php	returnphp newphp Zendphp_Servicephp_WindowsAzurephp_Storagephp_LeaseInstancephp(
php	php	php	php$containerNamephp,
php	php	php	php$blobNamephp,
php	php	php	php$responsephp-php>getHeaderphp(php'xphp-msphp-leasephp-idphp'php)php,
php	php	php	php$responsephp-php>getHeaderphp(php'xphp-msphp-leasephp-timephp'php)php)php;
php	php	php}php elsephp php{
php	php	php	throwphp newphp Zendphp_Servicephp_WindowsAzurephp_Exceptionphp(php$thisphp-php>php_getErrorMessagephp(php$responsephp,php php'Resourcephp couldphp notphp bephp accessedphp.php'php)php)php;
php	php	php}
php	php}

php	php/php*php*
php	php php*php Listphp blobs
php	php php*
php	php php*php php@paramphp stringphp php$containerNamephp Containerphp name
php	php php*php php@paramphp stringphp php$prefixphp php php php php Optionalphp.php Filtersphp thephp resultsphp tophp returnphp onlyphp blobsphp whosephp namephp beginsphp withphp thephp specifiedphp prefixphp.
php	php php*php php@paramphp stringphp php$delimiterphp php Optionalphp.php Delimiterphp,php iphp.ephp.php php'php/php'php,php forphp specifyingphp folderphp hierarchy
php	php php*php php@paramphp intphp php php php php$maxResultsphp Optionalphp.php Specifiesphp thephp maximumphp numberphp ofphp blobsphp tophp returnphp perphp callphp tophp Azurephp storagephp.php Thisphp doesphp NOTphp affectphp listphp sizephp returnedphp byphp thisphp functionphp.php php(maximumphp:php php5php0php0php0php)
php	php php*php php@paramphp stringphp php$markerphp php php php php Optionalphp stringphp valuephp thatphp identifiesphp thephp portionphp ofphp thephp listphp tophp bephp returnedphp withphp thephp nextphp listphp operationphp.
php	php php*php php@paramphp stringphp php$includephp php php php Optionalphp.php Specifiesphp thatphp thephp responsephp shouldphp includephp onephp orphp morephp ofphp thephp followingphp subsetsphp:php php'php'php,php php'metadataphp'php,php php'snapshotsphp'php,php php'uncommittedblobsphp'php)php.php Multiplephp valuesphp canphp bephp addedphp separatedphp withphp aphp commaphp php(php,php)
php	php php*php php@paramphp intphp php php php php$currentResultCountphp Currentphp resultphp countphp php(internalphp usephp)
php	php php*php php@returnphp array
php	php php*php php@throwsphp Zendphp_Servicephp_WindowsAzurephp_Exception
php	php php*php/
php	publicphp functionphp listBlobsphp(php$containerNamephp php=php php'php'php,php php$prefixphp php=php php'php'php,php php$delimiterphp php=php php'php'php,php php$maxResultsphp php=php nullphp,php php$markerphp php=php nullphp,php php$includephp php=php nullphp,php php$currentResultCountphp php=php php0php)
php	php{
php	php	ifphp php(php$containerNamephp php=php=php=php php'php'php)php php{
php	php	php	throwphp newphp Zendphp_Servicephp_WindowsAzurephp_Exceptionphp(php'Containerphp namephp isphp notphp specifiedphp.php'php)php;
php	php	php}
php	php	ifphp php(php!selfphp:php:isValidContainerNamephp(php$containerNamephp)php)php php{
php	php	php	throwphp newphp Zendphp_Servicephp_WindowsAzurephp_Exceptionphp(php'Containerphp namephp doesphp notphp adherephp tophp containerphp namingphp conventionsphp.php Seephp httpphp:php/php/msdnphp.microsoftphp.comphp/enphp-usphp/libraryphp/ddphp1php3php5php7php1php5php.aspxphp forphp morephp informationphp.php'php)php;
php	php	php}
php	php	php	
php	php	php/php/php Buildphp queryphp string
php	php	php$queryStringphp php=php arrayphp(php'restypephp=containerphp'php,php php'compphp=listphp'php)php;
php	php	ifphp php(php$prefixphp php!php=php=php nullphp)php php{
php	php	php	php$queryStringphp[php]php php=php php'prefixphp=php'php php.php php$prefixphp;
php	php	php}
php	php	ifphp php(php$delimiterphp php!php=php=php php'php'php)php php{
php	php	php	php$queryStringphp[php]php php=php php'delimiterphp=php'php php.php php$delimiterphp;
php	php	php}
php	php	ifphp php(php$maxResultsphp php!php=php=php nullphp)php php{
php	php	php	php$queryStringphp[php]php php=php php'maxresultsphp=php'php php.php php$maxResultsphp;
php	php	php}
php	php	ifphp php(php$markerphp php!php=php=php nullphp)php php{
php	php	php	php$queryStringphp[php]php php=php php'markerphp=php'php php.php php$markerphp;
php	php	php}
php	php	ifphp php(php$includephp php!php=php=php nullphp)php php{
php	php	php	php$queryStringphp[php]php php=php php'includephp=php'php php.php php$includephp;
php	php	php}
php	php	php$queryStringphp php=php selfphp:php:createQueryStringFromArrayphp(php$queryStringphp)php;

php	php	php/php/php Performphp request
php	php	php$responsephp php=php php$thisphp-php>php_performRequestphp(php$containerNamephp,php php$queryStringphp,php Zendphp_Httpphp_Clientphp:php:GETphp,php arrayphp(php)php,php falsephp,php nullphp,php Zendphp_Servicephp_WindowsAzurephp_Storagephp:php:RESOURCEphp_BLOBphp,php Zendphp_Servicephp_WindowsAzurephp_Credentialsphp_CredentialsAbstractphp:php:PERMISSIONphp_LISTphp)php;
php	php	ifphp php(php$responsephp-php>isSuccessfulphp(php)php)php php{
php	php	php	php/php/php Returnphp value
php	php	php	php$blobsphp php=php arrayphp(php)php;

php	php	php	php/php/php Blobs
php	php	php	php$xmlBlobsphp php=php php$thisphp-php>php_parseResponsephp(php$responsephp)php-php>Blobsphp-php>Blobphp;
php	php	php	ifphp php(php$xmlBlobsphp php!php=php=php nullphp)php php{
php	php	php	php	forphp php(php$iphp php=php php0php;php php$iphp <php countphp(php$xmlBlobsphp)php;php php$iphp+php+php)php php{
php	php	php	php	php	php$propertiesphp php=php php(arrayphp)php$xmlBlobsphp[php$iphp]php-php>Propertiesphp;
php	php	php	php	php	php	
php	php	php	php	php	php$blobsphp[php]php php=php newphp Zendphp_Servicephp_WindowsAzurephp_Storagephp_BlobInstancephp(
php	php	php	php	php	php$containerNamephp,
php	php	php	php	php	php(stringphp)php$xmlBlobsphp[php$iphp]php-php>Namephp,
php	php	php	php	php	php(stringphp)php$xmlBlobsphp[php$iphp]php-php>Snapshotphp,
php	php	php	php	php	php(stringphp)php$propertiesphp[php'Etagphp'php]php,
php	php	php	php	php	php(stringphp)php$propertiesphp[php'Lastphp-Modifiedphp'php]php,
php	php	php	php	php	php(stringphp)php$xmlBlobsphp[php$iphp]php-php>Urlphp,
php	php	php	php	php	php(stringphp)php$propertiesphp[php'Contentphp-Lengthphp'php]php,
php	php	php	php	php	php(stringphp)php$propertiesphp[php'Contentphp-Typephp'php]php,
php	php	php	php	php	php(stringphp)php$propertiesphp[php'Contentphp-Encodingphp'php]php,
php	php	php	php	php	php(stringphp)php$propertiesphp[php'Contentphp-Languagephp'php]php,
php	php	php	php	php	php(stringphp)php$propertiesphp[php'Cachephp-Controlphp'php]php,
php	php	php	php	php	php(stringphp)php$propertiesphp[php'BlobTypephp'php]php,
php	php	php	php	php	php(stringphp)php$propertiesphp[php'LeaseStatusphp'php]php,
php	php	php	php	php	falsephp,
php	php	php	php	php	php$thisphp-php>php_parseMetadataElementphp(php$xmlBlobsphp[php$iphp]php)
php	php	php	php	php	php)php;
php	php	php	php	php}
php	php	php	php}
php	php	php	php	
php	php	php	php/php/php Blobphp prefixesphp php(foldersphp)
php	php	php	php$xmlBlobsphp php=php php$thisphp-php>php_parseResponsephp(php$responsephp)php-php>Blobsphp-php>BlobPrefixphp;
php	php	php	php	
php	php	php	ifphp php(php$xmlBlobsphp php!php=php=php nullphp)php php{
php	php	php	php	forphp php(php$iphp php=php php0php;php php$iphp <php countphp(php$xmlBlobsphp)php;php php$iphp+php+php)php php{
php	php	php	php	php	php$blobsphp[php]php php=php newphp Zendphp_Servicephp_WindowsAzurephp_Storagephp_BlobInstancephp(
php	php	php	php	php	php$containerNamephp,
php	php	php	php	php	php(stringphp)php$xmlBlobsphp[php$iphp]php-php>Namephp,
php	php	php	php	php	nullphp,
php	php	php	php	php	php	php'php'php,
php	php	php	php	php	php	php'php'php,
php	php	php	php	php	php	php'php'php,
php	php	php	php	php	php0php,
php	php	php	php	php	php	php'php'php,
php	php	php	php	php	php	php'php'php,
php	php	php	php	php	php	php'php'php,
php	php	php	php	php	php	php'php'php,
php	php	php	php	php	php	php'php'php,
php	php	php	php	php	php	php'php'php,
php	php	php	php	php	truephp,
php	php	php	php	php	php$thisphp-php>php_parseMetadataElementphp(php$xmlBlobsphp[php$iphp]php)
php	php	php	php	php	php)php;
php	php	php	php	php}
php	php	php	php}
php	php	php	php	
php	php	php	php/php/php Morephp blobsphp?
php	php	php	php$xmlMarkerphp php=php php(stringphp)php$thisphp-php>php_parseResponsephp(php$responsephp)php-php>NextMarkerphp;
php	php	php	php$currentResultCountphp php=php php$currentResultCountphp php+php countphp(php$blobsphp)php;
php	php	php	ifphp php(php$maxResultsphp php!php=php=php nullphp php&php&php php$currentResultCountphp <php php$maxResultsphp)php php{
php	php	php	php	ifphp php(php$xmlMarkerphp php!php=php=php nullphp php&php&php php$xmlMarkerphp php!php=php php'php'php)php php{
php	php	php	php	php	php$blobsphp php=php arrayphp_mergephp(php$blobsphp,php php$thisphp-php>listBlobsphp(php$containerNamephp,php php$prefixphp,php php$delimiterphp,php php$maxResultsphp,php php$markerphp,php php$includephp,php php$currentResultCountphp)php)php;
php	php	php	php	php}
php	php	php	php}
php	php	php	ifphp php(php$maxResultsphp php!php=php=php nullphp php&php&php countphp(php$blobsphp)php php>php php$maxResultsphp)php php{
php	php	php	php	php$blobsphp php=php arrayphp_slicephp(php$blobsphp,php php0php,php php$maxResultsphp)php;
php	php	php	php}
php	php	php	php	
php	php	php	returnphp php$blobsphp;
php	php	php}php elsephp php{
php	php	php	throwphp newphp Zendphp_Servicephp_WindowsAzurephp_Exceptionphp(php$thisphp-php>php_getErrorMessagephp(php$responsephp,php php'Resourcephp couldphp notphp bephp accessedphp.php'php)php)php;
php	php	php}
php	php}

php	php/php*php*
php	php php*php Generatephp sharedphp accessphp URL
php	php php*
php	php php*php php@paramphp stringphp php$containerNamephp php Containerphp name
php	php php*php php@paramphp stringphp php$blobNamephp php php php php php php Blobphp name
php	php php*php php@paramphp stringphp php$resourcephp php php php php php php Signedphp resourcephp php-php containerphp php(cphp)php php-php blobphp php(bphp)
php	php php*php php@paramphp stringphp php$permissionsphp php php php Signedphp permissionsphp php-php readphp php(rphp)php,php writephp php(wphp)php,php deletephp php(dphp)php andphp listphp php(lphp)
php	php php*php php@paramphp stringphp php$startphp php php php php php php php php php Thephp timephp atphp whichphp thephp Sharedphp Accessphp Signaturephp becomesphp validphp.
php	php php*php php@paramphp stringphp php$expiryphp php php php php php php php php Thephp timephp atphp whichphp thephp Sharedphp Accessphp Signaturephp becomesphp invalidphp.
php	php php*php php@paramphp stringphp php$identifierphp php php php php Signedphp identifier
php	php php*php php@returnphp string
php	php php*php/
php	publicphp functionphp generateSharedAccessUrlphp(php$containerNamephp php=php php'php'php,php php$blobNamephp php=php php'php'php,php php$resourcephp php=php php'bphp'php,php php$permissionsphp php=php php'rphp'php,php php$startphp php=php php'php'php,php php$expiryphp php=php php'php'php,php php$identifierphp php=php php'php'php)
php	php{
php	php	ifphp php(php$containerNamephp php=php=php=php php'php'php)php php{
php	php	php	throwphp newphp Zendphp_Servicephp_WindowsAzurephp_Exceptionphp(php'Containerphp namephp isphp notphp specifiedphp.php'php)php;
php	php	php}
php	php	ifphp php(php!selfphp:php:isValidContainerNamephp(php$containerNamephp)php)php php{
php	php	php	throwphp newphp Zendphp_Servicephp_WindowsAzurephp_Exceptionphp(php'Containerphp namephp doesphp notphp adherephp tophp containerphp namingphp conventionsphp.php Seephp httpphp:php/php/msdnphp.microsoftphp.comphp/enphp-usphp/libraryphp/ddphp1php3php5php7php1php5php.aspxphp forphp morephp informationphp.php'php)php;
php	php	php}

php	php	php/php/php Resourcephp name
php	php	php$resourceNamephp php=php selfphp:php:createResourceNamephp(php$containerNamephp php,php php$blobNamephp)php;

php	php	php/php/php Generatephp URL
php	php	returnphp php$thisphp-php>getBaseUrlphp(php)php php.php php'php/php'php php.php php$resourceNamephp php.php php'php?php'php php.
php	php	php$thisphp-php>php_sharedAccessSignatureCredentialsphp-php>createSignedQueryStringphp(
php	php	php$resourceNamephp,
php	php	php php php php php php php php php'php'php,
php	php	php$resourcephp,
php	php	php$permissionsphp,
php	php	php$startphp,
php	php	php$expiryphp,
php	php	php$identifierphp)php;
php	php}

php	php/php*php*
php	php php*php Registerphp thisphp objectphp asphp streamphp wrapperphp client
php	php php*
php	php php*php php@paramphp php stringphp php$namephp Protocolphp name
php	php php*php php@returnphp Zendphp_Servicephp_WindowsAzurephp_Storagephp_Blob
php	php php*php/
php	publicphp functionphp registerAsClientphp(php$namephp)
php	php{
php	php	selfphp:php:php$php_wrapperClientsphp[php$namephp]php php=php php$thisphp;
php	php	returnphp php$thisphp;
php	php}

php	php/php*php*
php	php php*php Unregisterphp thisphp objectphp asphp streamphp wrapperphp client
php	php php*
php	php php*php php@paramphp php stringphp php$namephp Protocolphp name
php	php php*php php@returnphp Zendphp_Servicephp_WindowsAzurephp_Storagephp_Blob
php	php php*php/
php	publicphp functionphp unregisterAsClientphp(php$namephp)
php	php{
php	php	unsetphp(selfphp:php:php$php_wrapperClientsphp[php$namephp]php)php;
php	php	returnphp php$thisphp;
php	php}

php	php/php*php*
php	php php*php Getphp wrapperphp clientphp forphp streamphp type
php	php php*
php	php php*php php@paramphp php stringphp php$namephp Protocolphp name
php	php php*php php@returnphp Zendphp_Servicephp_WindowsAzurephp_Storagephp_Blob
php	php php*php/
php	publicphp staticphp functionphp getWrapperClientphp(php$namephp)
php	php{
php	php	returnphp selfphp:php:php$php_wrapperClientsphp[php$namephp]php;
php	php}

php	php/php*php*
php	php php*php Registerphp thisphp objectphp asphp streamphp wrapper
php	php php*
php	php php*php php@paramphp php stringphp php$namephp Protocolphp name
php	php php*php/
php	publicphp functionphp registerStreamWrapperphp(php$namephp php=php php'azurephp'php)
php	php{
php	php	php/php*php*
php	php	php php*php php@seephp Zendphp_Servicephp_WindowsAzurephp_Storagephp_Blobphp_Stream
php	php	php php*php/
php	php	requirephp_oncephp php'Zendphp/Servicephp/WindowsAzurephp/Storagephp/Blobphp/Streamphp.phpphp'php;

php	php	streamphp_registerphp_wrapperphp(php$namephp,php php'Zendphp_Servicephp_WindowsAzurephp_Storagephp_Blobphp_Streamphp'php)php;
php	php	php$thisphp-php>registerAsClientphp(php$namephp)php;
php	php}

php	php/php*php*
php	php php*php Unregisterphp thisphp objectphp asphp streamphp wrapper
php	php php*
php	php php*php php@paramphp php stringphp php$namephp Protocolphp name
php	php php*php php@returnphp Zendphp_Servicephp_WindowsAzurephp_Storagephp_Blob
php	php php*php/
php	publicphp functionphp unregisterStreamWrapperphp(php$namephp php=php php'azurephp'php)
php	php{
php	php	streamphp_wrapperphp_unregisterphp(php$namephp)php;
php	php	php$thisphp-php>unregisterAsClientphp(php$namephp)php;
php	php}

php	php/php*php*
php	php php*php Createphp resourcephp name
php	php php*
php	php php*php php@paramphp stringphp php$containerNamephp php Containerphp name
php	php php*php php@paramphp stringphp php$blobNamephp Blobphp name
php	php php*php php@returnphp string
php	php php*php/
php	publicphp staticphp functionphp createResourceNamephp(php$containerNamephp php=php php'php'php,php php$blobNamephp php=php php'php'php)
php	php{
php	php	php/php/php Resourcephp name
php	php	php$resourceNamephp php=php php$containerNamephp php.php php'php/php'php php.php php$blobNamephp;
php	php	ifphp php(php$containerNamephp php=php=php=php php'php'php php|php|php php$containerNamephp php=php=php=php php'php$rootphp'php)php php{
php	php	php	php$resourceNamephp php=php php$blobNamephp;
php	php	php}
php	php	ifphp php(php$blobNamephp php=php=php=php php'php'php)php php{
php	php	php	php$resourceNamephp php=php php$containerNamephp;
php	php	php}

php	php	returnphp php$resourceNamephp;
php	php}

php	php/php*php*
php	php php*php Isphp validphp containerphp namephp?
php	php php*
php	php php*php php@paramphp stringphp php$containerNamephp Containerphp name
php	php php*php php@returnphp boolean
php	php php*php/
php	publicphp staticphp functionphp isValidContainerNamephp(php$containerNamephp php=php php'php'php)
php	php{
php	php	ifphp php(php$containerNamephp php=php=php php'php$rootphp'php)php php{
php	php	php	returnphp truephp;
php	php	php}

php	php	ifphp php(pregphp_matchphp(php"php/php^php[aphp-zphp0php-php9php]php[aphp-zphp0php-php9php-php]php*php$php/php"php,php php$containerNamephp)php php=php=php=php php0php)php php{
php	php	php	returnphp falsephp;
php	php	php}

php	php	ifphp php(strposphp(php$containerNamephp,php php'php-php-php'php)php php!php=php=php falsephp)php php{
php	php	php	returnphp falsephp;
php	php	php}

php	php	ifphp php(strtolowerphp(php$containerNamephp)php php!php=php php$containerNamephp)php php{
php	php	php	returnphp falsephp;
php	php	php}

php	php	ifphp php(strlenphp(php$containerNamephp)php <php php3php php|php|php strlenphp(php$containerNamephp)php php>php php6php3php)php php{
php	php	php	returnphp falsephp;
php	php	php}

php	php	ifphp php(substrphp(php$containerNamephp,php php-php1php)php php=php=php php'php-php'php)php php{
php	php	php	returnphp falsephp;
php	php	php}

php	php	returnphp truephp;
php	php}

php	php/php*php*
php	php php*php Getphp errorphp messagephp fromphp Zendphp_Httpphp_Response
php	php php*
php	php php*php php@paramphp Zendphp_Httpphp_Responsephp php$responsephp Repsonse
php	php php*php php@paramphp stringphp php$alternativeErrorphp Alternativephp errorphp message
php	php php*php php@returnphp string
php	php php*php/
php	protectedphp functionphp php_getErrorMessagephp(Zendphp_Httpphp_Responsephp php$responsephp,php php$alternativeErrorphp php=php php'Unknownphp errorphp.php'php)
php	php{
php	php	php$responsephp php=php php$thisphp-php>php_parseResponsephp(php$responsephp)php;
php	php	ifphp php(php$responsephp php&php&php php$responsephp-php>Messagephp)php php{
php	php	php	returnphp php(stringphp)php$responsephp-php>Messagephp;
php	php	php}php elsephp php{
php	php	php	returnphp php$alternativeErrorphp;
php	php	php}
php	php}

php	php/php*php*
php	php php*php Generatephp blockphp id
php	php php*
php	php php*php php@paramphp intphp php$partphp Blockphp number
php	php php*php php@returnphp stringphp Windowsphp Azurephp Blobphp Storagephp blockphp number
php	php php*php/
php	protectedphp functionphp php_generateBlockIdphp(php$partphp php=php php0php)
php	php{
php	php	php$returnValuephp php=php php$partphp;
php	php	whilephp php(strlenphp(php$returnValuephp)php <php php6php4php)php php{
php	php	php	php$returnValuephp php=php php'php0php'php php.php php$returnValuephp;
php	php	php}

php	php	returnphp php$returnValuephp;
php	php}
php}
