<php?php
php/php*php*
php php*php Zendphp Framework
php php*
php php*php LICENSE
php php*
php php*php Thisphp sourcephp filephp isphp subjectphp tophp thephp newphp BSDphp licensephp thatphp isphp bundled
php php*php withphp thisphp packagephp inphp thephp filephp LICENSEphp.txtphp.
php php*php Itphp isphp alsophp availablephp throughphp thephp worldphp-widephp-webphp atphp thisphp URLphp:
php php*php httpphp:php/php/frameworkphp.zendphp.comphp/licensephp/newphp-bsd
php php*php Ifphp youphp didphp notphp receivephp aphp copyphp ofphp thephp licensephp andphp arephp unablephp to
php php*php obtainphp itphp throughphp thephp worldphp-widephp-webphp,php pleasephp sendphp anphp email
php php*php tophp licensephp@zendphp.comphp sophp wephp canphp sendphp youphp aphp copyphp immediatelyphp.
php php*
php php*php php@categoryphp php php Zend
php php*php php@packagephp php php php Zendphp_Service
php php*php php@subpackagephp SlideShare
php php*php php@copyrightphp php Copyrightphp php(cphp)php php2php0php0php5php-php2php0php1php0php Zendphp Technologiesphp USAphp Incphp.php php(httpphp:php/php/wwwphp.zendphp.comphp)
php php*php php@licensephp php php php httpphp:php/php/frameworkphp.zendphp.comphp/licensephp/newphp-bsdphp php php php php Newphp BSDphp License
php php*php php@versionphp php php php php$Idphp:php SlideSharephp.phpphp php2php0php0php9php6php php2php0php1php0php-php0php1php-php0php6php php0php2php:php0php5php:php0php9Zphp bkarwinphp php$
php php*php/

php/php*php*
php php*php Zendphp_Httpphp_Client
php php*php/
requirephp_oncephp php'Zendphp/Httpphp/Clientphp.phpphp'php;

php/php*php*
php php*php Zendphp_Cache
php php*php/
requirephp_oncephp php'Zendphp/Cachephp.phpphp'php;

php/php*php*
php php*php Zendphp_Servicephp_SlideSharephp_SlideShow
php php*php/
requirephp_oncephp php'Zendphp/Servicephp/SlideSharephp/SlideShowphp.phpphp'php;

php/php*php*
php php*php Thephp Zendphp_Servicephp_SlideSharephp componentphp isphp usedphp tophp interfacephp withphp the
php php*php slidesharephp.netphp webphp serverphp tophp retrievephp slidephp showsphp hostedphp onphp thephp webphp sitephp for
php php*php displayphp orphp otherphp processingphp.
php php*
php php*php php@categoryphp php php Zend
php php*php php@packagephp php php php Zendphp_Service
php php*php php@subpackagephp SlideShare
php php*php php@throwsphp php php php php Zendphp_Servicephp_SlideSharephp_Exception
php php*php php@copyrightphp php Copyrightphp php(cphp)php php2php0php0php5php-php2php0php1php0php Zendphp Technologiesphp USAphp Incphp.php php(httpphp:php/php/wwwphp.zendphp.comphp)
php php*php php@licensephp php php php httpphp:php/php/frameworkphp.zendphp.comphp/licensephp/newphp-bsdphp php php php php Newphp BSDphp License
php php*php/
classphp Zendphp_Servicephp_SlideShare
php{

php php php php php/php*php*
php php php php php php*php Webphp servicephp resultphp codephp mapping
php php php php php php*php/
php php php php constphp SERVICEphp_ERRORphp_BADphp_APIKEYphp php php php php php php php=php php1php;
php php php php constphp SERVICEphp_ERRORphp_BADphp_AUTHphp php php php php php php php php php=php php2php;
php php php php constphp SERVICEphp_ERRORphp_MISSINGphp_TITLEphp php php php php=php php3php;
php php php php constphp SERVICEphp_ERRORphp_MISSINGphp_FILEphp php php php php php=php php4php;
php php php php constphp SERVICEphp_ERRORphp_EMPTYphp_TITLEphp php php php php php php=php php5php;
php php php php constphp SERVICEphp_ERRORphp_NOTphp_SOURCEOBJphp php php php php=php php6php;
php php php php constphp SERVICEphp_ERRORphp_INVALIDphp_EXTphp php php php php php php=php php7php;
php php php php constphp SERVICEphp_ERRORphp_FILEphp_TOOphp_BIGphp php php php php php=php php8php;
php php php php constphp SERVICEphp_ERRORphp_SHOWphp_NOTphp_FOUNDphp php php php=php php9php;
php php php php constphp SERVICEphp_ERRORphp_USERphp_NOTphp_FOUNDphp php php php=php php1php0php;
php php php php constphp SERVICEphp_ERRORphp_GROUPphp_NOTphp_FOUNDphp php php=php php1php1php;
php php php php constphp SERVICEphp_ERRORphp_MISSINGphp_TAGphp php php php php php php=php php1php2php;
php php php php constphp SERVICEphp_ERRORphp_DAILYphp_LIMITphp php php php php php php=php php9php9php;
php php php php constphp SERVICEphp_ERRORphp_ACCOUNTphp_BLOCKEDphp php php=php php1php0php0php;

php php php php php/php*php*
php php php php php php*php Slidephp sharephp Webphp servicephp communicationphp URIs
php php php php php php*php/
php php php php constphp SERVICEphp_UPLOADphp_URIphp php php php php php php php php php php php php php php php php php php=php php'httpphp:php/php/wwwphp.slidesharephp.netphp/apiphp/php1php/uploadphp_slideshowphp'php;
php php php php constphp SERVICEphp_GETphp_SHOWphp_URIphp php php php php php php php php php php php php php php php php=php php'httpphp:php/php/wwwphp.slidesharephp.netphp/apiphp/php1php/getphp_slideshowphp'php;
php php php php constphp SERVICEphp_GETphp_SHOWphp_BYphp_USERphp_URIphp php php php php php php php php=php php'httpphp:php/php/wwwphp.slidesharephp.netphp/apiphp/php1php/getphp_slideshowphp_byphp_userphp'php;
php php php php constphp SERVICEphp_GETphp_SHOWphp_BYphp_TAGphp_URIphp php php php php php php php php php=php php'httpphp:php/php/wwwphp.slidesharephp.netphp/apiphp/php1php/getphp_slideshowphp_byphp_tagphp'php;
php php php php constphp SERVICEphp_GETphp_SHOWphp_BYphp_GROUPphp_URIphp php php php php php php php=php php'httpphp:php/php/wwwphp.slidesharephp.netphp/apiphp/php1php/getphp_slideshowsphp_fromphp_groupphp'php;

php php php php php/php*php*
php php php php php php*php Thephp MIMEphp typephp ofphp Slideshowphp files
php php php php php php*
php php php php php php*php/
php php php php constphp POWERPOINTphp_MIMEphp_TYPEphp php php php php=php php"applicationphp/vndphp.msphp-powerpointphp"php;

php php php php php/php*php*
php php php php php php*php Thephp APIphp keyphp tophp usephp inphp requests
php php php php php php*
php php php php php php*php php@varphp stringphp Thephp APIphp key
php php php php php php*php/
php php php php protectedphp php$php_apiKeyphp;

php php php php php/php*php*
php php php php php php*php Thephp sharedphp secretphp tophp usephp inphp requests
php php php php php php*
php php php php php php*php php@varphp stringphp thephp Sharedphp secret
php php php php php php*php/
php php php php protectedphp php$php_sharedSecretphp;

php php php php php/php*php*
php php php php php php*php Thephp usernamephp tophp usephp inphp requests
php php php php php php*
php php php php php php*php php@varphp stringphp thephp username
php php php php php php*php/
php php php php protectedphp php$php_usernamephp;

php php php php php/php*php*
php php php php php php*php Thephp passwordphp tophp usephp inphp requests
php php php php php php*
php php php php php php*php php@varphp stringphp thephp password
php php php php php php*php/
php php php php protectedphp php$php_passwordphp;

php php php php php/php*php*
php php php php php php*php Thephp HTTPphp Clientphp objectphp tophp usephp tophp performphp requests
php php php php php php*
php php php php php php*php php@varphp Zendphp_Httpphp_Client
php php php php php php*php/
php php php php protectedphp php$php_httpclientphp;

php php php php php/php*php*
php php php php php php*php Thephp Cachephp objectphp tophp usephp tophp performphp caching
php php php php php php*
php php php php php php*php php@varphp Zendphp_Cachephp_Core
php php php php php php*php/
php php php php protectedphp php$php_cacheobjectphp;

php php php php php/php*php*
php php php php php php*php Setsphp thephp Zendphp_Httpphp_Clientphp objectphp tophp usephp inphp requestsphp.php Ifphp notphp providedphp aphp defaultphp will
php php php php php php*php bephp usedphp.
php php php php php php*
php php php php php php*php php@paramphp Zendphp_Httpphp_Clientphp php$clientphp Thephp HTTPphp clientphp instancephp tophp use
php php php php php php*php php@returnphp Zendphp_Servicephp_SlideShare
php php php php php php*php/
php php php php publicphp functionphp setHttpClientphp(Zendphp_Httpphp_Clientphp php$clientphp)
php php php php php{
php php php php php php php php php$thisphp-php>php_httpclientphp php=php php$clientphp;
php php php php php php php php returnphp php$thisphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Returnsphp thephp instancephp ofphp thephp Zendphp_Httpphp_Clientphp whichphp willphp bephp usedphp.php Createsphp anphp instance
php php php php php php*php ofphp Zendphp_Httpphp_Clientphp ifphp nophp previousphp clientphp wasphp setphp.
php php php php php php*
php php php php php php*php php@returnphp Zendphp_Httpphp_Clientphp Thephp HTTPphp clientphp whichphp willphp bephp used
php php php php php php*php/
php php php php publicphp functionphp getHttpClientphp(php)
php php php php php{

php php php php php php php php ifphp(php!php(php$thisphp-php>php_httpclientphp instanceofphp Zendphp_Httpphp_Clientphp)php)php php{
php php php php php php php php php php php php php$clientphp php=php newphp Zendphp_Httpphp_Clientphp(php)php;
php php php php php php php php php php php php php$clientphp-php>setConfigphp(arrayphp(php'maxredirectsphp'php php=php>php php2php,
php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php'timeoutphp'php php=php>php php5php)php)php;

php php php php php php php php php php php php php$thisphp-php>setHttpClientphp(php$clientphp)php;
php php php php php php php php php}

php php php php php php php php php$thisphp-php>php_httpclientphp-php>resetParametersphp(php)php;
php php php php php php php php returnphp php$thisphp-php>php_httpclientphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Setsphp thephp Zendphp_Cachephp objectphp tophp usephp tophp cachephp thephp resultsphp ofphp APIphp queries
php php php php php php*
php php php php php php*php php@paramphp Zendphp_Cachephp_Corephp php$cacheobjectphp Thephp Zendphp_Cachephp objectphp used
php php php php php php*php php@returnphp Zendphp_Servicephp_SlideShare
php php php php php php*php/
php php php php publicphp functionphp setCacheObjectphp(Zendphp_Cachephp_Corephp php$cacheobjectphp)
php php php php php{
php php php php php php php php php$thisphp-php>php_cacheobjectphp php=php php$cacheobjectphp;
php php php php php php php php returnphp php$thisphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Getsphp thephp Zendphp_Cachephp objectphp whichphp willphp bephp usedphp tophp cachephp APIphp queriesphp.php Ifphp nophp cachephp object
php php php php php php*php wasphp previouslyphp setphp thephp thephp defaultphp willphp bephp usedphp php(Filesystemphp cachingphp inphp php/tmpphp withphp aphp life
php php php php php php*php timephp ofphp php4php3php2php0php0php secondsphp)
php php php php php php*
php php php php php php*php php@returnphp Zendphp_Cachephp_Corephp Thephp objectphp usedphp inphp caching
php php php php php php*php/
php php php php publicphp functionphp getCacheObjectphp(php)
php php php php php{

php php php php php php php php ifphp(php!php(php$thisphp-php>php_cacheobjectphp instanceofphp Zendphp_Cachephp_Corephp)php)php php{
php php php php php php php php php php php php php$cachephp php=php Zendphp_Cachephp:php:factoryphp(php'Corephp'php,php php'Filephp'php,php arrayphp(php'lifetimephp'php php=php>php php4php3php2php0php0php,
php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php'automaticphp_serializationphp'php php=php>php truephp)php,
php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php arrayphp(php'cachephp_dirphp'php php=php>php php'php/tmpphp'php)php)php;

php php php php php php php php php php php php php$thisphp-php>setCacheObjectphp(php$cachephp)php;
php php php php php php php php php}

php php php php php php php php returnphp php$thisphp-php>php_cacheobjectphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Returnsphp thephp userphp namephp usedphp forphp APIphp calls
php php php php php php*
php php php php php php*php php@returnphp stringphp Thephp username
php php php php php php*php/
php php php php publicphp functionphp getUserNamephp(php)
php php php php php{
php php php php php php php php returnphp php$thisphp-php>php_usernamephp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Setsphp thephp userphp namephp tophp usephp forphp APIphp calls
php php php php php php*
php php php php php php*php php@paramphp stringphp php$unphp Thephp usernamephp tophp use
php php php php php php*php php@returnphp Zendphp_Servicephp_SlideShare
php php php php php php*php/
php php php php publicphp functionphp setUserNamephp(php$unphp)
php php php php php{
php php php php php php php php php$thisphp-php>php_usernamephp php=php php$unphp;
php php php php php php php php returnphp php$thisphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Getsphp thephp passwordphp tophp usephp inphp APIphp calls
php php php php php php*
php php php php php php*php php@returnphp stringphp thephp passwordphp tophp usephp inphp APIphp calls
php php php php php php*php/
php php php php publicphp functionphp getPasswordphp(php)
php php php php php{
php php php php php php php php returnphp php$thisphp-php>php_passwordphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Setsphp thephp passwordphp tophp usephp inphp APIphp calls
php php php php php php*
php php php php php php*php php@paramphp stringphp php$pwphp Thephp passwordphp tophp use
php php php php php php*php php@returnphp Zendphp_Servicephp_SlideShare
php php php php php php*php/
php php php php publicphp functionphp setPasswordphp(php$pwphp)
php php php php php{
php php php php php php php php php$thisphp-php>php_passwordphp php=php php(stringphp)php$pwphp;
php php php php php php php php returnphp php$thisphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Getsphp thephp APIphp keyphp tophp bephp usedphp inphp makingphp APIphp calls
php php php php php php*
php php php php php php*php php@returnphp stringphp thephp APIphp Key
php php php php php php*php/
php php php php publicphp functionphp getApiKeyphp(php)
php php php php php{
php php php php php php php php returnphp php$thisphp-php>php_apiKeyphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Setsphp thephp APIphp keyphp tophp bephp usedphp inphp makingphp APIphp calls
php php php php php php*
php php php php php php*php php@paramphp stringphp php$keyphp Thephp APIphp keyphp tophp use
php php php php php php*php php@returnphp Zendphp_Servicephp_SlideShare
php php php php php php*php/
php php php php publicphp functionphp setApiKeyphp(php$keyphp)
php php php php php{
php php php php php php php php php$thisphp-php>php_apiKeyphp php=php php(stringphp)php$keyphp;
php php php php php php php php returnphp php$thisphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Getsphp thephp sharedphp secretphp usedphp inphp makingphp APIphp calls
php php php php php php*
php php php php php php*php php@returnphp stringphp thephp Sharedphp secret
php php php php php php*php/
php php php php publicphp functionphp getSharedSecretphp(php)
php php php php php{
php php php php php php php php returnphp php$thisphp-php>php_sharedSecretphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Setsphp thephp sharedphp secretphp usedphp inphp makingphp APIphp calls
php php php php php php*
php php php php php php*php php@paramphp stringphp php$secretphp thephp sharedphp secret
php php php php php php*php php@returnphp Zendphp_Servicephp_SlideShare
php php php php php php*php/
php php php php publicphp functionphp setSharedSecretphp(php$secretphp)
php php php php php{
php php php php php php php php php$thisphp-php>php_sharedSecretphp php=php php(stringphp)php$secretphp;
php php php php php php php php returnphp php$thisphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Thephp Constructor
php php php php php php*
php php php php php php*php php@paramphp stringphp php$apikeyphp Thephp APIphp key
php php php php php php*php php@paramphp stringphp php$sharedSecretphp Thephp sharedphp secret
php php php php php php*php php@paramphp stringphp php$usernamephp Thephp username
php php php php php php*php php@paramphp stringphp php$passwordphp Thephp password
php php php php php php*php/
php php php php publicphp functionphp php_php_constructphp(php$apikeyphp,php php$sharedSecretphp,php php$usernamephp php=php nullphp,php php$passwordphp php=php nullphp)
php php php php php{
php php php php php php php php php$thisphp-php>setApiKeyphp(php$apikeyphp)
php php php php php php php php php php php php php php-php>setSharedSecretphp(php$sharedSecretphp)
php php php php php php php php php php php php php php-php>setUserNamephp(php$usernamephp)
php php php php php php php php php php php php php php-php>setPasswordphp(php$passwordphp)php;

php php php php php php php php php$thisphp-php>php_httpclientphp php=php newphp Zendphp_Httpphp_Clientphp(php)php;
php php php php php}

php php php php php/php*php*
php php php php php php*php Uploadsphp thephp specifiedphp Slidephp showphp thephp thephp server
php php php php php php*
php php php php php php*php php@paramphp Zendphp_Servicephp_SlideSharephp_SlideShowphp php$ssphp Thephp slidephp showphp objectphp representingphp thephp slidephp showphp tophp upload
php php php php php php*php php@paramphp booleanphp php$makephp_srcphp_publicphp Determinesphp ifphp thephp thephp slidephp showphp'sphp sourcephp filephp isphp publicphp orphp notphp uponphp upload
php php php php php php*php php@returnphp Zendphp_Servicephp_SlideSharephp_SlideShowphp Thephp passedphp Slidephp showphp objectphp,php withphp thephp newphp assignedphp IDphp provided
php php php php php php*php/
php php php php publicphp functionphp uploadSlideShowphp(Zendphp_Servicephp_SlideSharephp_SlideShowphp php$ssphp,php php$makephp_srcphp_publicphp php=php truephp)
php php php php php{

php php php php php php php php php$timestampphp php=php timephp(php)php;

php php php php php php php php php$paramsphp php=php arrayphp(php'apiphp_keyphp'php php=php>php php$thisphp-php>getApiKeyphp(php)php,
php php php php php php php php php php php php php php php php php php php php php php php php php'tsphp'php php=php>php php$timestampphp,
php php php php php php php php php php php php php php php php php php php php php php php php php'hashphp'php php=php>php shaphp1php(php$thisphp-php>getSharedSecretphp(php)php.php$timestampphp)php,
php php php php php php php php php php php php php php php php php php php php php php php php php'usernamephp'php php=php>php php$thisphp-php>getUserNamephp(php)php,
php php php php php php php php php php php php php php php php php php php php php php php php php'passwordphp'php php=php>php php$thisphp-php>getPasswordphp(php)php,
php php php php php php php php php php php php php php php php php php php php php php php php php'slideshowphp_titlephp'php php=php>php php$ssphp-php>getTitlephp(php)php)php;

php php php php php php php php php$descriptionphp php=php php$ssphp-php>getDescriptionphp(php)php;
php php php php php php php php php$tagsphp php=php php$ssphp-php>getTagsphp(php)php;

php php php php php php php php php$filenamephp php=php php$ssphp-php>getFilenamephp(php)php;

php php php php php php php php ifphp(php!filephp_existsphp(php$filenamephp)php php|php|php php!isphp_readablephp(php$filenamephp)php)php php{
php php php php php php php php php php php php requirephp_oncephp php'Zendphp/Servicephp/SlideSharephp/Exceptionphp.phpphp'php;
php php php php php php php php php php php php throwphp newphp Zendphp_Servicephp_SlideSharephp_Exceptionphp(php"Specifiedphp Slideshowphp forphp uploadphp notphp foundphp orphp unreadablephp"php)php;
php php php php php php php php php}

php php php php php php php php ifphp(php!emptyphp(php$descriptionphp)php)php php{
php php php php php php php php php php php php php$paramsphp[php'slideshowphp_descriptionphp'php]php php=php php$descriptionphp;
php php php php php php php php php}php elsephp php{
php php php php php php php php php php php php php$paramsphp[php'slideshowphp_descriptionphp'php]php php=php php"php"php;
php php php php php php php php php}

php php php php php php php php ifphp(php!emptyphp(php$tagsphp)php)php php{
php php php php php php php php php php php php php$tmpphp php=php arrayphp(php)php;
php php php php php php php php php php php php foreachphp(php$tagsphp asphp php$tagphp)php php{
php php php php php php php php php php php php php php php php php$tmpphp[php]php php=php php"php\php"php$tagphp\php"php"php;
php php php php php php php php php php php php php}
php php php php php php php php php php php php php$paramsphp[php'slideshowphp_tagsphp'php]php php=php implodephp(php'php php'php,php php$tmpphp)php;
php php php php php php php php php}php elsephp php{
php php php php php php php php php php php php php$paramsphp[php'slideshowphp_tagsphp'php]php php=php php"php"php;
php php php php php php php php php}


php php php php php php php php php$clientphp php=php php$thisphp-php>getHttpClientphp(php)php;
php php php php php php php php php$clientphp-php>setUriphp(selfphp:php:SERVICEphp_UPLOADphp_URIphp)php;
php php php php php php php php php$clientphp-php>setParameterPostphp(php$paramsphp)php;
php php php php php php php php php$clientphp-php>setFileUploadphp(php$filenamephp,php php"slideshowphp_srcfilephp"php)php;

php php php php php php php php requirephp_oncephp php'Zendphp/Httpphp/Clientphp/Exceptionphp.phpphp'php;
php php php php php php php php tryphp php{
php php php php php php php php php php php php php$responsephp php=php php$clientphp-php>requestphp(php'POSTphp'php)php;
php php php php php php php php php}php catchphp(Zendphp_Httpphp_Clientphp_Exceptionphp php$ephp)php php{
php php php php php php php php php php php php requirephp_oncephp php'Zendphp/Servicephp/SlideSharephp/Exceptionphp.phpphp'php;
php php php php php php php php php php php php throwphp newphp Zendphp_Servicephp_SlideSharephp_Exceptionphp(php"Servicephp Requestphp Failedphp:php php{php$ephp-php>getMessagephp(php)php}php"php,php php0php,php php$ephp)php;
php php php php php php php php php}

php php php php php php php php php$sxephp php=php simplexmlphp_loadphp_stringphp(php$responsephp-php>getBodyphp(php)php)php;

php php php php php php php php ifphp(php$sxephp-php>getNamephp(php)php php=php=php php"SlideShareServiceErrorphp"php)php php{
php php php php php php php php php php php php php$messagephp php=php php(stringphp)php$sxephp-php>Messagephp[php0php]php;
php php php php php php php php php php php php listphp(php$codephp,php php$errorphp_strphp)php php=php explodephp(php'php:php'php,php php$messagephp)php;
php php php php php php php php php php php php requirephp_oncephp php'Zendphp/Servicephp/SlideSharephp/Exceptionphp.phpphp'php;
php php php php php php php php php php php php throwphp newphp Zendphp_Servicephp_SlideSharephp_Exceptionphp(trimphp(php$errorphp_strphp)php,php php$codephp)php;
php php php php php php php php php}

php php php php php php php php ifphp(php!php$sxephp-php>getNamephp(php)php php=php=php php"SlideShowUploadedphp"php)php php{
php php php php php php php php php php php php requirephp_oncephp php'Zendphp/Servicephp/SlideSharephp/Exceptionphp.phpphp'php;
php php php php php php php php php php php php throwphp newphp Zendphp_Servicephp_SlideSharephp_Exceptionphp(php"Unknownphp XMLphp Responsphp Receivedphp"php)php;
php php php php php php php php php}

php php php php php php php php php$ssphp-php>setIdphp(php(intphp)php(stringphp)php$sxephp-php>SlideShowIDphp)php;

php php php php php php php php returnphp php$ssphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Retrievesphp aphp slidephp showphp'sphp informationphp basedphp onphp slidephp showphp ID
php php php php php php*
php php php php php php*php php@paramphp intphp php$ssphp_idphp Thephp slidephp showphp ID
php php php php php php*php php@returnphp Zendphp_Servicephp_SlideSharephp_SlideShowphp thephp Slideshowphp object
php php php php php php*php/
php php php php publicphp functionphp getSlideShowphp(php$ssphp_idphp)
php php php php php{
php php php php php php php php php$timestampphp php=php timephp(php)php;

php php php php php php php php php$paramsphp php=php arrayphp(php'apiphp_keyphp'php php=php>php php$thisphp-php>getApiKeyphp(php)php,
php php php php php php php php php php php php php php php php php php php php php php php php php'tsphp'php php=php>php php$timestampphp,
php php php php php php php php php php php php php php php php php php php php php php php php php'hashphp'php php=php>php shaphp1php(php$thisphp-php>getSharedSecretphp(php)php.php$timestampphp)php,
php php php php php php php php php php php php php php php php php php php php php php php php php'slideshowphp_idphp'php php=php>php php$ssphp_idphp)php;

php php php php php php php php php$cachephp php=php php$thisphp-php>getCacheObjectphp(php)php;

php php php php php php php php php$cachephp_keyphp php=php mdphp5php(php"php_php_zendslidesharephp_cachephp_php$ssphp_idphp"php)php;

php php php php php php php php ifphp(php!php$retvalphp php=php php$cachephp-php>loadphp(php$cachephp_keyphp)php)php php{
php php php php php php php php php php php php php$clientphp php=php php$thisphp-php>getHttpClientphp(php)php;

php php php php php php php php php php php php php$clientphp-php>setUriphp(selfphp:php:SERVICEphp_GETphp_SHOWphp_URIphp)php;
php php php php php php php php php php php php php$clientphp-php>setParameterPostphp(php$paramsphp)php;

php php php php php php php php php php php php requirephp_oncephp php'Zendphp/Httpphp/Clientphp/Exceptionphp.phpphp'php;
php php php php php php php php php php php php tryphp php{
php php php php php php php php php php php php php php php php php$responsephp php=php php$clientphp-php>requestphp(php'POSTphp'php)php;
php php php php php php php php php php php php php}php catchphp(Zendphp_Httpphp_Clientphp_Exceptionphp php$ephp)php php{
php php php php php php php php php php php php php php php php requirephp_oncephp php'Zendphp/Servicephp/SlideSharephp/Exceptionphp.phpphp'php;
php php php php php php php php php php php php php php php php throwphp newphp Zendphp_Servicephp_SlideSharephp_Exceptionphp(php"Servicephp Requestphp Failedphp:php php{php$ephp-php>getMessagephp(php)php}php"php,php php0php,php php$ephp)php;
php php php php php php php php php php php php php}

php php php php php php php php php php php php php$sxephp php=php simplexmlphp_loadphp_stringphp(php$responsephp-php>getBodyphp(php)php)php;

php php php php php php php php php php php php ifphp(php$sxephp-php>getNamephp(php)php php=php=php php"SlideShareServiceErrorphp"php)php php{
php php php php php php php php php php php php php php php php php$messagephp php=php php(stringphp)php$sxephp-php>Messagephp[php0php]php;
php php php php php php php php php php php php php php php php listphp(php$codephp,php php$errorphp_strphp)php php=php explodephp(php'php:php'php,php php$messagephp)php;
php php php php php php php php php php php php php php php php requirephp_oncephp php'Zendphp/Servicephp/SlideSharephp/Exceptionphp.phpphp'php;
php php php php php php php php php php php php php php php php throwphp newphp Zendphp_Servicephp_SlideSharephp_Exceptionphp(trimphp(php$errorphp_strphp)php,php php$codephp)php;
php php php php php php php php php php php php php}

php php php php php php php php php php php php ifphp(php!php$sxephp-php>getNamephp(php)php php=php=php php'Slideshowsphp'php)php php{
php php php php php php php php php php php php php php php php requirephp_oncephp php'Zendphp/Servicephp/SlideSharephp/Exceptionphp.phpphp'php;
php php php php php php php php php php php php php php php php throwphp newphp Zendphp_Servicephp_SlideSharephp_Exceptionphp(php'Unknownphp XMLphp Repsonsephp Receivedphp'php)php;
php php php php php php php php php php php php php}

php php php php php php php php php php php php php$retvalphp php=php php$thisphp-php>php_slideShowNodeToObjectphp(clonephp php$sxephp-php>Slideshowphp[php0php]php)php;

php php php php php php php php php php php php php$cachephp-php>savephp(php$retvalphp,php php$cachephp_keyphp)php;
php php php php php php php php php}

php php php php php php php php returnphp php$retvalphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Retrievesphp anphp arrayphp ofphp slidephp showsphp forphp aphp givenphp username
php php php php php php*
php php php php php php*php php@paramphp stringphp php$usernamephp Thephp usernamephp tophp retrievephp slidephp showsphp from
php php php php php php*php php@paramphp intphp php$offsetphp Thephp offsetphp ofphp thephp listphp tophp startphp retrievingphp from
php php php php php php*php php@paramphp intphp php$limitphp Thephp maximumphp numberphp ofphp slidephp showsphp tophp retrieve
php php php php php php*php php@returnphp arrayphp Anphp arrayphp ofphp Zendphp_Servicephp_SlideSharephp_SlideShowphp objects
php php php php php php*php/
php php php php publicphp functionphp getSlideShowsByUsernamephp(php$usernamephp,php php$offsetphp php=php nullphp,php php$limitphp php=php nullphp)
php php php php php{
php php php php php php php php returnphp php$thisphp-php>php_getSlideShowsByTypephp(php'usernamephp_forphp'php,php php$usernamephp,php php$offsetphp,php php$limitphp)php;
php php php php php}

php php php php php/php*php*
php php php php php php*php Retrievesphp anphp arrayphp ofphp slidephp showsphp basedphp onphp tag
php php php php php php*
php php php php php php*php php@paramphp stringphp php$tagphp Thephp tagphp tophp retrievephp slidephp showsphp with
php php php php php php*php php@paramphp intphp php$offsetphp Thephp offsetphp ofphp thephp listphp tophp startphp retrievingphp from
php php php php php php*php php@paramphp intphp php$limitphp Thephp maximumphp numberphp ofphp slidephp showsphp tophp retrieve
php php php php php php*php php@returnphp arrayphp Anphp arrayphp ofphp Zendphp_Servicephp_SlideSharephp_SlideShowphp objects
php php php php php php*php/
php php php php publicphp functionphp getSlideShowsByTagphp(php$tagphp,php php$offsetphp php=php nullphp,php php$limitphp php=php nullphp)
php php php php php{

php php php php php php php php ifphp(isphp_arrayphp(php$tagphp)php)php php{
php php php php php php php php php php php php php$tmpphp php=php arrayphp(php)php;
php php php php php php php php php php php php foreachphp(php$tagphp asphp php$tphp)php php{
php php php php php php php php php php php php php php php php php$tmpphp[php]php php=php php"php\php"php$tphp\php"php"php;
php php php php php php php php php php php php php}

php php php php php php php php php php php php php$tagphp php=php implodephp(php"php php"php,php php$tmpphp)php;
php php php php php php php php php}

php php php php php php php php returnphp php$thisphp-php>php_getSlideShowsByTypephp(php'tagphp'php,php php$tagphp,php php$offsetphp,php php$limitphp)php;
php php php php php}

php php php php php/php*php*
php php php php php php*php Retrievesphp anphp arrayphp ofphp slidephp showsphp basedphp onphp groupphp name
php php php php php php*
php php php php php php*php php@paramphp stringphp php$groupphp Thephp groupphp namephp tophp retrievephp slidephp showsphp for
php php php php php php*php php@paramphp intphp php$offsetphp Thephp offsetphp ofphp thephp listphp tophp startphp retrievingphp from
php php php php php php*php php@paramphp intphp php$limitphp Thephp maximumphp numberphp ofphp slidephp showsphp tophp retrieve
php php php php php php*php php@returnphp arrayphp Anphp arrayphp ofphp Zendphp_Servicephp_SlideSharephp_SlideShowphp objects
php php php php php php*php/
php php php php publicphp functionphp getSlideShowsByGroupphp(php$groupphp,php php$offsetphp php=php nullphp,php php$limitphp php=php nullphp)
php php php php php{
php php php php php php php php returnphp php$thisphp-php>php_getSlideShowsByTypephp(php'groupphp_namephp'php,php php$groupphp,php php$offsetphp,php php$limitphp)php;
php php php php php}

php php php php php/php*php*
php php php php php php*php Retrievesphp Zendphp_Servicephp_SlideSharephp_SlideShowphp objectphp arraysphp basedphp onphp thephp typephp of
php php php php php php*php listphp desired
php php php php php php*
php php php php php php*php php@paramphp stringphp php$keyphp Thephp typephp ofphp slidephp showphp objectphp tophp retrieve
php php php php php php*php php@paramphp stringphp php$valuephp Thephp specificphp searchphp queryphp forphp thephp slidephp showphp typephp tophp lookphp up
php php php php php php*php php@paramphp intphp php$offsetphp Thephp offsetphp ofphp thephp listphp tophp startphp retrievingphp from
php php php php php php*php php@paramphp intphp php$limitphp Thephp maximumphp numberphp ofphp slidephp showsphp tophp retrieve
php php php php php php*php php@returnphp arrayphp Anphp arrayphp ofphp Zendphp_Servicephp_SlideSharephp_SlideShowphp objects
php php php php php php*php/
php php php php protectedphp functionphp php_getSlideShowsByTypephp(php$keyphp,php php$valuephp,php php$offsetphp php=php nullphp,php php$limitphp php=php nullphp)
php php php php php{

php php php php php php php php php$keyphp php=php strtolowerphp(php$keyphp)php;

php php php php php php php php switchphp(php$keyphp)php php{
php php php php php php php php php php php php casephp php'usernamephp_forphp'php:
php php php php php php php php php php php php php php php php php$responseTagphp php=php php'Userphp'php;
php php php php php php php php php php php php php php php php php$queryUriphp php=php selfphp:php:SERVICEphp_GETphp_SHOWphp_BYphp_USERphp_URIphp;
php php php php php php php php php php php php php php php php breakphp;
php php php php php php php php php php php php casephp php'groupphp_namephp'php:
php php php php php php php php php php php php php php php php php$responseTagphp php=php php'Groupphp'php;
php php php php php php php php php php php php php php php php php$queryUriphp php=php selfphp:php:SERVICEphp_GETphp_SHOWphp_BYphp_GROUPphp_URIphp;
php php php php php php php php php php php php php php php php breakphp;
php php php php php php php php php php php php casephp php'tagphp'php:
php php php php php php php php php php php php php php php php php$responseTagphp php=php php'Tagphp'php;
php php php php php php php php php php php php php php php php php$queryUriphp php=php selfphp:php:SERVICEphp_GETphp_SHOWphp_BYphp_TAGphp_URIphp;
php php php php php php php php php php php php php php php php breakphp;
php php php php php php php php php php php php defaultphp:
php php php php php php php php php php php php php php php php requirephp_oncephp php'Zendphp/Servicephp/SlideSharephp/Exceptionphp.phpphp'php;
php php php php php php php php php php php php php php php php throwphp newphp Zendphp_Servicephp_SlideSharephp_Exceptionphp(php"Invalidphp SlideSharephp Queryphp"php)php;
php php php php php php php php php}

php php php php php php php php php$timestampphp php=php timephp(php)php;

php php php php php php php php php$paramsphp php=php arrayphp(php'apiphp_keyphp'php php=php>php php$thisphp-php>getApiKeyphp(php)php,
php php php php php php php php php php php php php php php php php php php php php php php php php'tsphp'php php=php>php php$timestampphp,
php php php php php php php php php php php php php php php php php php php php php php php php php'hashphp'php php=php>php shaphp1php(php$thisphp-php>getSharedSecretphp(php)php.php$timestampphp)php,
php php php php php php php php php php php php php php php php php php php php php php php php php$keyphp php=php>php php$valuephp)php;

php php php php php php php php ifphp(php$offsetphp php!php=php=php nullphp)php php{
php php php php php php php php php php php php php$paramsphp[php'offsetphp'php]php php=php php(intphp)php$offsetphp;
php php php php php php php php php}

php php php php php php php php ifphp(php$limitphp php!php=php=php nullphp)php php{
php php php php php php php php php php php php php$paramsphp[php'limitphp'php]php php=php php(intphp)php$limitphp;
php php php php php php php php php}

php php php php php php php php php$cachephp php=php php$thisphp-php>getCacheObjectphp(php)php;

php php php php php php php php php$cachephp_keyphp php=php mdphp5php(php$keyphp.php$valuephp.php$offsetphp.php$limitphp)php;

php php php php php php php php ifphp(php!php$retvalphp php=php php$cachephp-php>loadphp(php$cachephp_keyphp)php)php php{

php php php php php php php php php php php php php$clientphp php=php php$thisphp-php>getHttpClientphp(php)php;

php php php php php php php php php php php php php$clientphp-php>setUriphp(php$queryUriphp)php;
php php php php php php php php php php php php php$clientphp-php>setParameterPostphp(php$paramsphp)php;

php php php php php php php php php php php php requirephp_oncephp php'Zendphp/Httpphp/Clientphp/Exceptionphp.phpphp'php;
php php php php php php php php php php php php tryphp php{
php php php php php php php php php php php php php php php php php$responsephp php=php php$clientphp-php>requestphp(php'POSTphp'php)php;
php php php php php php php php php php php php php}php catchphp(Zendphp_Httpphp_Clientphp_Exceptionphp php$ephp)php php{
php php php php php php php php php php php php php php php php requirephp_oncephp php'Zendphp/Servicephp/SlideSharephp/Exceptionphp.phpphp'php;
php php php php php php php php php php php php php php php php throwphp newphp Zendphp_Servicephp_SlideSharephp_Exceptionphp(php"Servicephp Requestphp Failedphp:php php{php$ephp-php>getMessagephp(php)php}php"php,php php0php,php php$ephp)php;
php php php php php php php php php php php php php}

php php php php php php php php php php php php php$sxephp php=php simplexmlphp_loadphp_stringphp(php$responsephp-php>getBodyphp(php)php)php;

php php php php php php php php php php php php ifphp(php$sxephp-php>getNamephp(php)php php=php=php php"SlideShareServiceErrorphp"php)php php{
php php php php php php php php php php php php php php php php php$messagephp php=php php(stringphp)php$sxephp-php>Messagephp[php0php]php;
php php php php php php php php php php php php php php php php listphp(php$codephp,php php$errorphp_strphp)php php=php explodephp(php'php:php'php,php php$messagephp)php;
php php php php php php php php php php php php php php php php requirephp_oncephp php'Zendphp/Servicephp/SlideSharephp/Exceptionphp.phpphp'php;
php php php php php php php php php php php php php php php php throwphp newphp Zendphp_Servicephp_SlideSharephp_Exceptionphp(trimphp(php$errorphp_strphp)php,php php$codephp)php;
php php php php php php php php php php php php php}

php php php php php php php php php php php php ifphp(php!php$sxephp-php>getNamephp(php)php php=php=php php$responseTagphp)php php{
php php php php php php php php php php php php php php php php requirephp_oncephp php'Zendphp/Servicephp/SlideSharephp/Exceptionphp.phpphp'php;
php php php php php php php php php php php php php php php php throwphp newphp Zendphp_Servicephp_SlideSharephp_Exceptionphp(php'Unknownphp orphp Invalidphp XMLphp Repsonsephp Receivedphp'php)php;
php php php php php php php php php php php php php}

php php php php php php php php php php php php php$retvalphp php=php arrayphp(php)php;

php php php php php php php php php php php php foreachphp(php$sxephp-php>childrenphp(php)php asphp php$nodephp)php php{
php php php php php php php php php php php php php php php php ifphp(php$nodephp-php>getNamephp(php)php php=php=php php'Slideshowphp'php)php php{
php php php php php php php php php php php php php php php php php php php php php$retvalphp[php]php php=php php$thisphp-php>php_slideShowNodeToObjectphp(php$nodephp)php;
php php php php php php php php php php php php php php php php php}
php php php php php php php php php php php php php}

php php php php php php php php php php php php php$cachephp-php>savephp(php$retvalphp,php php$cachephp_keyphp)php;
php php php php php php php php php}

php php php php php php php php returnphp php$retvalphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Convertsphp aphp SimpleXMLElementphp objectphp representingphp aphp responsephp fromphp thephp service
php php php php php php*php intophp aphp Zendphp_Servicephp_SlideSharephp_SlideShowphp object
php php php php php php*
php php php php php php*php php@paramphp SimpleXMLElementphp php$nodephp Thephp inputphp XMLphp fromphp thephp slidesharephp.netphp service
php php php php php php*php php@returnphp Zendphp_Servicephp_SlideSharephp_SlideShowphp Thephp resultingphp object
php php php php php php*php/
php php php php protectedphp functionphp php_slideShowNodeToObjectphp(SimpleXMLElementphp php$nodephp)
php php php php php{

php php php php php php php php ifphp(php$nodephp-php>getNamephp(php)php php=php=php php'Slideshowphp'php)php php{

php php php php php php php php php php php php php$ssphp php=php newphp Zendphp_Servicephp_SlideSharephp_SlideShowphp(php)php;

php php php php php php php php php php php php php$ssphp-php>setIdphp(php(stringphp)php$nodephp-php>IDphp)php;
php php php php php php php php php php php php php$ssphp-php>setDescriptionphp(php(stringphp)php$nodephp-php>Descriptionphp)php;
php php php php php php php php php php php php php$ssphp-php>setEmbedCodephp(php(stringphp)php$nodephp-php>EmbedCodephp)php;
php php php php php php php php php php php php php$ssphp-php>setNumViewsphp(php(stringphp)php$nodephp-php>Viewsphp)php;
php php php php php php php php php php php php php$ssphp-php>setPermaLinkphp(php(stringphp)php$nodephp-php>Permalinkphp)php;
php php php php php php php php php php php php php$ssphp-php>setStatusphp(php(stringphp)php$nodephp-php>Statusphp)php;
php php php php php php php php php php php php php$ssphp-php>setStatusDescriptionphp(php(stringphp)php$nodephp-php>StatusDescriptionphp)php;

php php php php php php php php php php php php foreachphp(explodephp(php"php,php"php,php php(stringphp)php$nodephp-php>Tagsphp)php asphp php$tagphp)php php{

php php php php php php php php php php php php php php php php ifphp(php!inphp_arrayphp(php$tagphp,php php$ssphp-php>getTagsphp(php)php)php)php php{
php php php php php php php php php php php php php php php php php php php php php$ssphp-php>addTagphp(php$tagphp)php;
php php php php php php php php php php php php php php php php php}
php php php php php php php php php php php php php}

php php php php php php php php php php php php php$ssphp-php>setThumbnailUrlphp(php(stringphp)php$nodephp-php>Thumbnailphp)php;
php php php php php php php php php php php php php$ssphp-php>setTitlephp(php(stringphp)php$nodephp-php>Titlephp)php;
php php php php php php php php php php php php php$ssphp-php>setLocationphp(php(stringphp)php$nodephp-php>Locationphp)php;
php php php php php php php php php php php php php$ssphp-php>setTranscriptphp(php(stringphp)php$nodephp-php>Transcriptphp)php;

php php php php php php php php php php php php returnphp php$ssphp;

php php php php php php php php php}

php php php php php php php php requirephp_oncephp php'Zendphp/Servicephp/SlideSharephp/Exceptionphp.phpphp'php;
php php php php php php php php throwphp newphp Zendphp_Servicephp_SlideSharephp_Exceptionphp(php"Wasphp notphp providedphp thephp expectedphp XMLphp Nodephp forphp processingphp"php)php;
php php php php php}
php}
