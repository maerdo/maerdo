<php?php
php/php*php*
php php*php Zendphp Framework
php php*
php php*php LICENSE
php php*
php php*php Thisphp sourcephp filephp isphp subjectphp tophp thephp newphp BSDphp licensephp thatphp isphp bundled
php php*php withphp thisphp packagephp inphp thephp filephp LICENSEphp.txtphp.
php php*php Itphp isphp alsophp availablephp throughphp thephp worldphp-widephp-webphp atphp thisphp URLphp:
php php*php httpphp:php/php/frameworkphp.zendphp.comphp/licensephp/newphp-bsd
php php*php Ifphp youphp didphp notphp receivephp aphp copyphp ofphp thephp licensephp andphp arephp unablephp to
php php*php obtainphp itphp throughphp thephp worldphp-widephp-webphp,php pleasephp sendphp anphp email
php php*php tophp licensephp@zendphp.comphp sophp wephp canphp sendphp youphp aphp copyphp immediatelyphp.
php php*
php php*php php@categoryphp php php Zend
php php*php php@packagephp php php php Zendphp_Service
php php*php php@subpackagephp Ebay
php php*php php@copyrightphp php Copyrightphp php(cphp)php php2php0php0php5php-php2php0php1php0php Zendphp Technologiesphp USAphp Incphp.php php(httpphp:php/php/wwwphp.zendphp.comphp)
php php*php php@licensephp php php php httpphp:php/php/frameworkphp.zendphp.comphp/licensephp/newphp-bsdphp php php php php Newphp BSDphp License
php php*php php@versionphp php php php php$Idphp:php Itemsphp.phpphp php2php2php8php0php4php php2php0php1php0php-php0php8php-php0php8php php0php5php:php0php8php:php0php5Zphp renanbrphp php$
php php*php/

php/php*php*
php php*php php@seephp Zendphp_Servicephp_Ebayphp_Findingphp_Responsephp_Histograms
php php*php/
requirephp_oncephp php'Zendphp/Servicephp/Ebayphp/Findingphp/Responsephp/Histogramsphp.phpphp'php;

php/php*php*
php php*php php@categoryphp php php Zend
php php*php php@packagephp php php php Zendphp_Service
php php*php php@subpackagephp Ebay
php php*php php@copyrightphp php Copyrightphp php(cphp)php php2php0php0php5php-php2php0php1php0php Zendphp Technologiesphp USAphp Incphp.php php(httpphp:php/php/wwwphp.zendphp.comphp)
php php*php php@licensephp php php php httpphp:php/php/frameworkphp.zendphp.comphp/licensephp/newphp-bsdphp php php php php Newphp BSDphp License
php php*php php@usesphp php php php php php php Zendphp_Servicephp_Ebayphp_Findingphp_Responsephp_Histograms
php php*php/
classphp Zendphp_Servicephp_Ebayphp_Findingphp_Responsephp_Itemsphp extendsphp Zendphp_Servicephp_Ebayphp_Findingphp_Responsephp_Histograms
php{
php php php php php/php*php*
php php php php php php*php php@linkphp httpphp:php/php/developerphp.ebayphp.comphp/DevZonephp/findingphp/CallRefphp/typesphp/PaginationInputphp.html
php php php php php php*php/
php php php php constphp PAGEphp_MAXphp_DEFAULTphp php php=php php1php0php0php;
php php php php constphp PAGEphp_MAXphp_INFINITYphp php=php php0php;

php php php php php/php*php*
php php php php php php*php Indicatesphp thephp paginationphp ofphp thephp resultphp setphp.
php php php php php php*
php php php php php php*php Childphp elementsphp indicatephp thephp pagephp numberphp thatphp isphp returnedphp,php thephp maximum
php php php php php php*php numberphp ofphp itemphp listingsphp tophp returnphp perphp pagephp,php totalphp numberphp ofphp pagesphp that
php php php php php php*php canphp bephp returnedphp,php andphp thephp totalphp numberphp ofphp listingsphp thatphp matchphp thephp search
php php php php php php*php criteriaphp.
php php php php php php*
php php php php php php*php php@varphp Zendphp_Servicephp_Ebayphp_Findingphp_PaginationOutput
php php php php php php*php/
php php php php publicphp php$paginationOutputphp;

php php php php php/php*php*
php php php php php php*php Containerphp forphp thephp itemphp listingsphp thatphp matchedphp thephp searchphp criteriaphp.
php php php php php php*
php php php php php php*php Thephp dataphp forphp eachphp itemphp isphp returnedphp inphp individualphp containersphp,php ifphp any
php php php php php php*php matchesphp werephp foundphp.
php php php php php php*
php php php php php php*php php@varphp Zendphp_Servicephp_Ebayphp_Findingphp_Searchphp_Result
php php php php php php*php/
php php php php publicphp php$searchResultphp;

php php php php php/php*php*
php php php php php php*php php@varphp Zendphp_Servicephp_Ebayphp_Findingphp_Responsephp_Itemsphp[php]
php php php php php php*php/
php php php php protectedphp staticphp php$php_pageCachephp php=php arrayphp(php)php;

php php php php php/php*php*
php php php php php php*php php@returnphp void
php php php php php php*php/
php php php php protectedphp functionphp php_initphp(php)
php php php php php{
php php php php php php php php parentphp:php:php_initphp(php)php;
php php php php php php php php php$nsphp php=php Zendphp_Servicephp_Ebayphp_Findingphp:php:XMLNSphp_FINDINGphp;

php php php php php php php php php$thisphp-php>php_attributesphp[php'searchResultphp'php]php php=php arrayphp(
php php php php php php php php php php php php php'countphp'php php=php>php php$thisphp-php>php_queryphp(php"php.php/php/php$nsphp:searchResultphp[php1php]php/php@countphp[php1php]php"php,php php'stringphp'php)
php php php php php php php php php)php;

php php php php php php php php php$nodephp php=php php$thisphp-php>php_xPathphp-php>queryphp(php"php.php/php/php$nsphp:searchResultphp[php1php]php"php,php php$thisphp-php>php_domphp)php-php>itemphp(php0php)php;
php php php php php php php php ifphp php(php$nodephp)php php{
php php php php php php php php php php php php php/php*php*
php php php php php php php php php php php php php php*php php@seephp Zendphp_Servicephp_Ebayphp_Findingphp_Searchphp_Result
php php php php php php php php php php php php php php*php/
php php php php php php php php php php php php requirephp_oncephp php'Zendphp/Servicephp/Ebayphp/Findingphp/Searchphp/Resultphp.phpphp'php;
php php php php php php php php php php php php php$thisphp-php>searchResultphp php=php newphp Zendphp_Servicephp_Ebayphp_Findingphp_Searchphp_Resultphp(php$nodephp)php;
php php php php php php php php php}

php php php php php php php php php$nodephp php=php php$thisphp-php>php_xPathphp-php>queryphp(php"php.php/php/php$nsphp:paginationOutputphp[php1php]php"php,php php$thisphp-php>php_domphp)php-php>itemphp(php0php)php;
php php php php php php php php ifphp php(php$nodephp)php php{
php php php php php php php php php php php php php/php*php*
php php php php php php php php php php php php php php*php php@seephp Zendphp_Servicephp_Ebayphp_Findingphp_PaginationOutput
php php php php php php php php php php php php php php*php/
php php php php php php php php php php php php requirephp_oncephp php'Zendphp/Servicephp/Ebayphp/Findingphp/PaginationOutputphp.phpphp'php;
php php php php php php php php php php php php php$thisphp-php>paginationOutputphp php=php newphp Zendphp_Servicephp_Ebayphp_Findingphp_PaginationOutputphp(php$nodephp)php;
php php php php php php php php php}
php php php php php}

php php php php php/php*php*
php php php php php php*php php@paramphp php Zendphp_Servicephp_Ebayphp_Findingphp php$proxy
php php php php php php*php php@paramphp php integerphp php php php php php php php php php php php php php php php php php php php$number
php php php php php php*php php@throwsphp Zendphp_Servicephp_Ebayphp_Findingphp_Exceptionphp Whenphp php$numberphp isphp invalid
php php php php php php*php php@returnphp Zendphp_Servicephp_Ebayphp_Findingphp_Responsephp_Items
php php php php php php*php/
php php php php publicphp functionphp pagephp(Zendphp_Servicephp_Ebayphp_Findingphp php$proxyphp,php php$numberphp)
php php php php php{
php php php php php php php php php/php/php checkphp pagephp number
php php php php php php php php ifphp php(php$numberphp <php php1php php|php|php php$numberphp php>php php$thisphp-php>paginationOutputphp-php>totalPagesphp)php php{
php php php php php php php php php php php php php/php*php*
php php php php php php php php php php php php php php*php php@seephp Zendphp_Servicephp_Ebayphp_Findingphp_Exception
php php php php php php php php php php php php php php*php/
php php php php php php php php php php php php requirephp_oncephp php'Zendphp/Servicephp/Ebayphp/Findingphp/Exceptionphp.phpphp'php;
php php php php php php php php php php php php throwphp newphp Zendphp_Servicephp_Ebayphp_Findingphp_Exceptionphp(
php php php php php php php php php php php php php php php php php"Pagephp numberphp php'php{php$numberphp}php'php isphp outphp ofphp rangephp.php"php)php;
php php php php php php php php php}

php php php php php php php php php/php/php preparephp arguments
php php php php php php php php php$argumentsphp php=php arrayphp(php)php;
php php php php php php php php switchphp php(php$thisphp-php>php_operationphp)php php{
php php php php php php php php php php php php casephp php'findItemsAdvancedphp'php:
php php php php php php php php php php php php php php php php php$argumentsphp[php]php php=php php$thisphp-php>getOptionphp(php'keywordsphp'php)php;
php php php php php php php php php php php php php php php php php$argumentsphp[php]php php=php php$thisphp-php>getOptionphp(php'descriptionSearchphp'php)php;
php php php php php php php php php php php php php php php php php$argumentsphp[php]php php=php php$thisphp-php>getOptionphp(php'categoryIdphp'php)php;
php php php php php php php php php php php php php php php php breakphp;

php php php php php php php php php php php php casephp php'findItemsByCategoryphp'php:
php php php php php php php php php php php php php php php php php$argumentsphp[php]php php=php php$thisphp-php>getOptionphp(php'categoryIdphp'php)php;
php php php php php php php php php php php php php php php php breakphp;

php php php php php php php php php php php php casephp php'findItemsByKeywordsphp'php:
php php php php php php php php php php php php php php php php php$argumentsphp[php]php php=php php$thisphp-php>getOptionphp(php'keywordsphp'php)php;
php php php php php php php php php php php php php php php php breakphp;

php php php php php php php php php php php php casephp php'findItemsByProductphp'php:
php php php php php php php php php php php php php php php php php$productIdphp php=php php$thisphp-php>getOptionphp(php'productIdphp'php)php;
php php php php php php php php php php php php php php php php ifphp php(php!isphp_arrayphp(php$productIdphp)php)php php{
php php php php php php php php php php php php php php php php php php php php php$productIdphp php=php arrayphp(php'php'php php=php>php php$productIdphp)php;
php php php php php php php php php php php php php php php php php}
php php php php php php php php php php php php php php php php php$argumentsphp[php]php php=php arrayphp_keyphp_existsphp(php'php'php,php php$productIdphp)
php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php?php php$productIdphp[php'php'php]
php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php:php nullphp;
php php php php php php php php php php php php php php php php php$argumentsphp[php]php php=php arrayphp_keyphp_existsphp(php'typephp'php,php php$productIdphp)
php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php?php php$productIdphp[php'typephp'php]
php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php:php nullphp;
php php php php php php php php php php php php php php php php breakphp;

php php php php php php php php php php php php casephp php'findItemsIneBayStoresphp'php:
php php php php php php php php php php php php php php php php php$argumentsphp[php]php php=php php$thisphp-php>getOptionphp(php'storeNamephp'php)php;
php php php php php php php php php php php php php php php php breakphp;

php php php php php php php php php php php php defaultphp:
php php php php php php php php php php php php php php php php php/php*php*
php php php php php php php php php php php php php php php php php php*php php@seephp Zendphp_Servicephp_Ebayphp_Findingphp_Exception
php php php php php php php php php php php php php php php php php php*php/
php php php php php php php php php php php php php php php php requirephp_oncephp php'Zendphp/Servicephp/Ebayphp/Findingphp/Exceptionphp.phpphp'php;
php php php php php php php php php php php php php php php php throwphp newphp Zendphp_Servicephp_Ebayphp_Findingphp_Exceptionphp(
php php php php php php php php php php php php php php php php php php php php php"Invalidphp operationphp php'php{php$thisphp-php>php_operationphp}php'php.php"php)php;
php php php php php php php php php}

php php php php php php php php php/php/php preparephp options
php php php php php php php php php/php/php removephp everyphp paginationphp entryphp fromphp currentphp optionphp list
php php php php php php php php php$optionsphp php=php php$thisphp-php>php_optionsphp;
php php php php php php php php foreachphp php(arrayphp_keysphp(php$optionsphp)php asphp php$optionNamephp)php php{
php php php php php php php php php php php php ifphp php(substrphp(php$optionNamephp,php php0php,php php1php5php)php php=php=php php'paginationInputphp'php)php php{
php php php php php php php php php php php php php php php php unsetphp(php$optionsphp[php$optionNamephp]php)php;
php php php php php php php php php php php php php}
php php php php php php php php php}

php php php php php php php php php/php/php setphp newphp paginationphp values
php php php php php php php php php/php/php seephp morephp atphp httpphp:php/php/developerphp.ebayphp.comphp/DevZonephp/findingphp/CallRefphp/typesphp/PaginationInputphp.html
php php php php php php php php php$entriesPerPagephp php php php php php php php php php php php php php=php php$thisphp-php>paginationOutputphp-php>entriesPerPagephp;
php php php php php php php php php$optionsphp[php'paginationInputphp'php]php php=php arrayphp(php'entriesPerPagephp'php php=php>php php$entriesPerPagephp,
php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php'pageNumberphp'php php php php php php=php>php php$numberphp)php;

php php php php php php php php php/php/php addphp currentphp optionsphp asphp lastphp argument
php php php php php php php php ksortphp(php$optionsphp)php;
php php php php php php php php php$argumentsphp[php]php php=php php$optionsphp;

php php php php php php php php php/php/php verifyphp cache
php php php php php php php php php$idphp php=php serializephp(php$argumentsphp)php;
php php php php php php php php ifphp php(php!arrayphp_keyphp_existsphp(php$idphp,php selfphp:php:php$php_pageCachephp)php)php php{
php php php php php php php php php php php php ifphp php(php$numberphp php=php=php php$thisphp-php>paginationOutputphp-php>pageNumberphp)php php{
php php php php php php php php php php php php php php php php php/php/php addphp itselfphp tophp cache
php php php php php php php php php php php php php php php php php$newphp php=php php$thisphp;
php php php php php php php php php php php php php}php elsephp php{
php php php php php php php php php php php php php php php php php/php/php requestphp newphp page
php php php php php php php php php php php php php php php php php$callbackphp php=php arrayphp(php$proxyphp,php php$thisphp-php>php_operationphp)php;
php php php php php php php php php php php php php php php php php$newphp php php php php php php=php callphp_userphp_funcphp_arrayphp(php$callbackphp,php php$argumentsphp)php;
php php php php php php php php php php php php php}
php php php php php php php php php php php php selfphp:php:php$php_pageCachephp[php$idphp]php php=php php$newphp;
php php php php php php php php php}

php php php php php php php php returnphp selfphp:php:php$php_pageCachephp[php$idphp]php;
php php php php php}

php php php php php/php*php*
php php php php php php*php php@paramphp php Zendphp_Servicephp_Ebayphp_Findingphp php$proxy
php php php php php php*php php@returnphp Zendphp_Servicephp_Ebayphp_Findingphp_Responsephp_Items
php php php php php php*php/
php php php php publicphp functionphp pageFirstphp(Zendphp_Servicephp_Ebayphp_Findingphp php$proxyphp)
php php php php php{
php php php php php php php php returnphp php$thisphp-php>pagephp(php$proxyphp,php php1php)php;
php php php php php}

php php php php php/php*php*
php php php php php php*php php@paramphp php Zendphp_Servicephp_Ebayphp_Findingphp php$proxy
php php php php php php*php php@paramphp php integerphp php php php php php php php php php php php php php php php php php php php$max
php php php php php php*php php@returnphp Zendphp_Servicephp_Ebayphp_Findingphp_Responsephp_Items
php php php php php php*php/
php php php php publicphp functionphp pageLastphp(Zendphp_Servicephp_Ebayphp_Findingphp php$proxyphp,php php$maxphp php=php selfphp:php:PAGEphp_MAXphp_DEFAULTphp)
php php php php php{
php php php php php php php php php$lastphp php=php php$thisphp-php>paginationOutputphp-php>totalPagesphp;
php php php php php php php php ifphp php(php$maxphp php>php php0php php&php&php php$lastphp php>php php$maxphp)php php{
php php php php php php php php php php php php php$lastphp php=php php$maxphp;
php php php php php php php php php}
php php php php php php php php returnphp php$thisphp-php>pagephp(php$proxyphp,php php$lastphp)php;
php php php php php}

php php php php php/php*php*
php php php php php php*php php@paramphp php Zendphp_Servicephp_Ebayphp_Findingphp php$proxy
php php php php php php*php php@paramphp php integerphp php php php php php php php php php php php php php php php php php php php$max
php php php php php php*php php@returnphp Zendphp_Servicephp_Ebayphp_Findingphp_Responsephp_Items
php php php php php php*php/
php php php php publicphp functionphp pageNextphp(Zendphp_Servicephp_Ebayphp_Findingphp php$proxyphp,php php$maxphp php=php selfphp:php:PAGEphp_MAXphp_DEFAULTphp)
php php php php php{
php php php php php php php php php$nextphp php=php php$thisphp-php>paginationOutputphp-php>pageNumberphp php+php php1php;
php php php php php php php php php$lastphp php=php php$thisphp-php>paginationOutputphp-php>totalPagesphp;
php php php php php php php php ifphp php(php(php$maxphp php>php php0php php&php&php php$nextphp php>php php$maxphp)php php|php|php php$nextphp php>php php$lastphp)php php{
php php php php php php php php php php php php returnphp nullphp;
php php php php php php php php php}
php php php php php php php php returnphp php$thisphp-php>pagephp(php$proxyphp,php php$nextphp)php;
php php php php php}

php php php php php/php*php*
php php php php php php*php php@paramphp php Zendphp_Servicephp_Ebayphp_Findingphp php$proxy
php php php php php php*php php@returnphp Zendphp_Servicephp_Ebayphp_Findingphp_Responsephp_Items
php php php php php php*php/
php php php php publicphp functionphp pagePreviousphp(Zendphp_Servicephp_Ebayphp_Findingphp php$proxyphp)
php php php php php{
php php php php php php php php php$previousphp php=php php$thisphp-php>paginationOutputphp-php>pageNumberphp php-php php1php;
php php php php php php php php ifphp php(php$previousphp <php php1php)php php{
php php php php php php php php php php php php returnphp nullphp;
php php php php php php php php php}
php php php php php php php php returnphp php$thisphp-php>pagephp(php$proxyphp,php php$previousphp)php;
php php php php php}
php}
