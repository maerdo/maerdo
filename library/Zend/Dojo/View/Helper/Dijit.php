<php?php
php/php*php*
php php*php Zendphp Framework
php php*
php php*php LICENSE
php php*
php php*php Thisphp sourcephp filephp isphp subjectphp tophp thephp newphp BSDphp licensephp thatphp isphp bundled
php php*php withphp thisphp packagephp inphp thephp filephp LICENSEphp.txtphp.
php php*php Itphp isphp alsophp availablephp throughphp thephp worldphp-widephp-webphp atphp thisphp URLphp:
php php*php httpphp:php/php/frameworkphp.zendphp.comphp/licensephp/newphp-bsd
php php*php Ifphp youphp didphp notphp receivephp aphp copyphp ofphp thephp licensephp andphp arephp unablephp to
php php*php obtainphp itphp throughphp thephp worldphp-widephp-webphp,php pleasephp sendphp anphp email
php php*php tophp licensephp@zendphp.comphp sophp wephp canphp sendphp youphp aphp copyphp immediatelyphp.
php php*
php php*php php@categoryphp php php Zend
php php*php php@packagephp php php php Zendphp_Dojo
php php*php php@subpackagephp View
php php*php php@copyrightphp php Copyrightphp php(cphp)php php2php0php0php5php-php2php0php1php0php Zendphp Technologiesphp USAphp Incphp.php php(httpphp:php/php/wwwphp.zendphp.comphp)
php php*php php@licensephp php php php httpphp:php/php/frameworkphp.zendphp.comphp/licensephp/newphp-bsdphp php php php php Newphp BSDphp License
php php*php php@versionphp php php php php$Idphp:php Dijitphp.phpphp php2php0php0php9php6php php2php0php1php0php-php0php1php-php0php6php php0php2php:php0php5php:php0php9Zphp bkarwinphp php$
php php*php/

php/php*php*php Zendphp_Viewphp_Helperphp_HtmlElementphp php*php/
requirephp_oncephp php'Zendphp/Viewphp/Helperphp/HtmlElementphp.phpphp'php;

php/php*php*
php php*php Dojophp dijitphp basephp class
php php*
php php*php php@usesphp php php php php php php Zendphp_Viewphp_Helperphp_Abstract
php php*php php@packagephp php php php Zendphp_Dojo
php php*php php@subpackagephp View
php php*php php@copyrightphp php Copyrightphp php(cphp)php php2php0php0php5php-php2php0php1php0php Zendphp Technologiesphp USAphp Incphp.php php(httpphp:php/php/wwwphp.zendphp.comphp)
php php*php php@licensephp php php php httpphp:php/php/frameworkphp.zendphp.comphp/licensephp/newphp-bsdphp php php php php Newphp BSDphp License
php php php*php/
abstractphp classphp Zendphp_Dojophp_Viewphp_Helperphp_Dijitphp extendsphp Zendphp_Viewphp_Helperphp_HtmlElement
php{
php php php php php/php*php*
php php php php php php*php php@varphp Zendphp_Dojophp_Viewphp_Helperphp_Dojophp_Container
php php php php php php*php/
php php php php publicphp php$dojophp;

php php php php php/php*php*
php php php php php php*php Dijitphp beingphp used
php php php php php php*php php@varphp string
php php php php php php*php/
php php php php protectedphp php$php_dijitphp;

php php php php php/php*php*
php php php php php php*php Elementphp type
php php php php php php*php php@varphp string
php php php php php php*php/
php php php php protectedphp php$php_elementTypephp;

php php php php php/php*php*
php php php php php php*php Parametersphp thatphp shouldphp bephp JSONphp encoded
php php php php php php*php php@varphp array
php php php php php php*php/
php php php php protectedphp php$php_jsonParamsphp php=php arrayphp(php'constraintsphp'php)php;

php php php php php/php*php*
php php php php php php*php Dojophp modulephp tophp use
php php php php php php*php php@varphp string
php php php php php php*php/
php php php php protectedphp php$php_modulephp;

php php php php php/php*php*
php php php php php php*php Rootphp nodephp elementphp typephp forphp layoutphp elements
php php php php php php*php php@varphp string
php php php php php php*php/
php php php php protectedphp php$php_rootNodephp php=php php'divphp'php;

php php php php php/php*php*
php php php php php php*php Setphp view
php php php php php php*
php php php php php php*php Setphp viewphp andphp enablephp dojo
php php php php php php*
php php php php php php*php php@paramphp php Zendphp_Viewphp_Interfacephp php$view
php php php php php php*php php@returnphp Zendphp_Dojophp_Viewphp_Helperphp_Dijit
php php php php php php*php/
php php php php publicphp functionphp setViewphp(Zendphp_Viewphp_Interfacephp php$viewphp)
php php php php php{
php php php php php php php php parentphp:php:setViewphp(php$viewphp)php;
php php php php php php php php php$thisphp-php>dojophp php=php php$thisphp-php>viewphp-php>dojophp(php)php;
php php php php php php php php php$thisphp-php>dojophp-php>enablephp(php)php;
php php php php php php php php returnphp php$thisphp;
php php php php php}


php php php php php/php*php*
php php php php php php*php Getphp rootphp nodephp type
php php php php php php*
php php php php php php*php php@returnphp string
php php php php php php*php/
php php php php publicphp functionphp getRootNodephp(php)
php php php php php{
php php php php php php php php returnphp php$thisphp-php>php_rootNodephp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Setphp rootphp nodephp type
php php php php php php*
php php php php php php*php php@paramphp php stringphp php$value
php php php php php php*php php@returnphp Zendphp_Dojophp_Viewphp_Helperphp_Dijit
php php php php php php*php/
php php php php publicphp functionphp setRootNodephp(php$valuephp)
php php php php php{
php php php php php php php php php$thisphp-php>php_rootNodephp php=php php$valuephp;
php php php php php php php php returnphp php$thisphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Whetherphp orphp notphp tophp usephp declarativephp dijitphp creation
php php php php php php*
php php php php php php*php php@returnphp bool
php php php php php php*php/
php php php php protectedphp functionphp php_useDeclarativephp(php)
php php php php php{
php php php php php php php php returnphp Zendphp_Dojophp_Viewphp_Helperphp_Dojophp:php:useDeclarativephp(php)php;
php php php php php}

php php php php php/php*php*
php php php php php php*php Whetherphp orphp notphp tophp usephp programmaticphp dijitphp creation
php php php php php php*
php php php php php php*php php@returnphp bool
php php php php php php*php/
php php php php protectedphp functionphp php_useProgrammaticphp(php)
php php php php php{
php php php php php php php php returnphp Zendphp_Dojophp_Viewphp_Helperphp_Dojophp:php:useProgrammaticphp(php)php;
php php php php php}

php php php php php/php*php*
php php php php php php*php Whetherphp orphp notphp tophp usephp programmaticphp dijitphp creationphp wphp/ophp scriptphp creation
php php php php php php*
php php php php php php*php php@returnphp bool
php php php php php php*php/
php php php php protectedphp functionphp php_useProgrammaticNoScriptphp(php)
php php php php php{
php php php php php php php php returnphp Zendphp_Dojophp_Viewphp_Helperphp_Dojophp:php:useProgrammaticNoScriptphp(php)php;
php php php php php}

php php php php php/php*php*
php php php php php php*php Createphp aphp layoutphp container
php php php php php php*
php php php php php php*php php@paramphp php intphp php$id
php php php php php php*php php@paramphp php stringphp php$content
php php php php php php*php php@paramphp php arrayphp php$params
php php php php php php*php php@paramphp php arrayphp php$attribs
php php php php php php*php php@paramphp php stringphp|nullphp php$dijit
php php php php php php*php php@returnphp string
php php php php php php*php/
php php php php protectedphp functionphp php_createLayoutContainerphp(php$idphp,php php$contentphp,php arrayphp php$paramsphp,php arrayphp php$attribsphp,php php$dijitphp php=php nullphp)
php php php php php{
php php php php php php php php php$attribsphp[php'idphp'php]php php=php php$idphp;
php php php php php php php php php$attribsphp php=php php$thisphp-php>php_prepareDijitphp(php$attribsphp,php php$paramsphp,php php'layoutphp'php,php php$dijitphp)php;

php php php php php php php php php$nodeTypephp php=php php$thisphp-php>getRootNodephp(php)php;
php php php php php php php php php$htmlphp php=php php'<php'php php.php php$nodeTypephp php.php php$thisphp-php>php_htmlAttribsphp(php$attribsphp)php php.php php'php>php'
php php php php php php php php php php php php php php php.php php$content
php php php php php php php php php php php php php php php.php php"<php/php$nodeTypephp>php\nphp"php;

php php php php php php php php returnphp php$htmlphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Createphp HTMLphp representationphp ofphp aphp dijitphp formphp element
php php php php php php*
php php php php php php*php php@paramphp php stringphp php$id
php php php php php php*php php@paramphp php stringphp php$value
php php php php php php*php php@paramphp php arrayphp php$params
php php php php php php*php php@paramphp php arrayphp php$attribs
php php php php php php*php php@paramphp php stringphp|nullphp php$dijit
php php php php php php*php php@returnphp string
php php php php php php*php/
php php php php publicphp functionphp php_createFormElementphp(php$idphp,php php$valuephp,php arrayphp php$paramsphp,php arrayphp php$attribsphp,php php$dijitphp php=php nullphp)
php php php php php{
php php php php php php php php ifphp php(php!arrayphp_keyphp_existsphp(php'idphp'php,php php$attribsphp)php)php php{
php php php php php php php php php php php php php$attribsphp[php'idphp'php]php php=php php$idphp;
php php php php php php php php php}
php php php php php php php php php$attribsphp[php'namephp'php]php php php=php php$idphp;
php php php php php php php php php$attribsphp[php'valuephp'php]php php=php php(stringphp)php php$valuephp;
php php php php php php php php php$attribsphp[php'typephp'php]php php php=php php$thisphp-php>php_elementTypephp;

php php php php php php php php php$attribsphp php=php php$thisphp-php>php_prepareDijitphp(php$attribsphp,php php$paramsphp,php php'elementphp'php,php php$dijitphp)php;

php php php php php php php php php$htmlphp php=php php'php<inputphp'
php php php php php php php php php php php php php php php.php php$thisphp-php>php_htmlAttribsphp(php$attribsphp)
php php php php php php php php php php php php php php php.php php$thisphp-php>getClosingBracketphp(php)php;
php php php php php php php php returnphp php$htmlphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Mergephp attributesphp andphp parameters
php php php php php php*
php php php php php php*php Alsophp setsphp upphp requires
php php php php php php*
php php php php php php*php php@paramphp php arrayphp php$attribs
php php php php php php*php php@paramphp php arrayphp php$params
php php php php php php*php php@paramphp php stringphp php$type
php php php php php php*php php@paramphp php stringphp php$dijitphp Dijitphp typephp tophp usephp php(otherwisephp,php pullphp fromphp php$php_dijitphp)
php php php php php php*php php@returnphp array
php php php php php php*php/
php php php php protectedphp functionphp php_prepareDijitphp(arrayphp php$attribsphp,php arrayphp php$paramsphp,php php$typephp,php php$dijitphp php=php nullphp)
php php php php php{
php php php php php php php php php$thisphp-php>dojophp-php>requireModulephp(php$thisphp-php>php_modulephp)php;

php php php php php php php php switchphp php(php$typephp)php php{
php php php php php php php php php php php php casephp php'layoutphp'php:
php php php php php php php php php php php php php php php php php$stripParamsphp php=php arrayphp(php'idphp'php)php;
php php php php php php php php php php php php php php php php breakphp;
php php php php php php php php php php php php casephp php'elementphp'php:
php php php php php php php php php php php php php php php php php$stripParamsphp php=php arrayphp(php'idphp'php,php php'namephp'php,php php'valuephp'php,php php'typephp'php)php;
php php php php php php php php php php php php php php php php foreachphp php(arrayphp(php'checkedphp'php,php php'disabledphp'php,php php'readonlyphp'php)php asphp php$attribphp)php php{
php php php php php php php php php php php php php php php php php php php php ifphp php(arrayphp_keyphp_existsphp(php$attribphp,php php$attribsphp)php)php php{
php php php php php php php php php php php php php php php php php php php php php php php php ifphp php(php$attribsphp[php$attribphp]php)php php{
php php php php php php php php php php php php php php php php php php php php php php php php php php php php php$attribsphp[php$attribphp]php php=php php$attribphp;
php php php php php php php php php php php php php php php php php php php php php php php php php}php elsephp php{
php php php php php php php php php php php php php php php php php php php php php php php php php php php php unsetphp(php$attribsphp[php$attribphp]php)php;
php php php php php php php php php php php php php php php php php php php php php php php php php}
php php php php php php php php php php php php php php php php php php php php php}
php php php php php php php php php php php php php php php php php}
php php php php php php php php php php php php php php php php breakphp;
php php php php php php php php php php php php casephp php'textareaphp'php:
php php php php php php php php php php php php php php php php php$stripParamsphp php=php arrayphp(php'idphp'php,php php'namephp'php,php php'typephp'php,php php'degradephp'php)php;
php php php php php php php php php php php php php php php php breakphp;
php php php php php php php php php php php php defaultphp:
php php php php php php php php php}

php php php php php php php php foreachphp php(php$stripParamsphp asphp php$paramphp)php php{
php php php php php php php php php php php php ifphp php(arrayphp_keyphp_existsphp(php$paramphp,php php$paramsphp)php)php php{
php php php php php php php php php php php php php php php php unsetphp(php$paramsphp[php$paramphp]php)php;
php php php php php php php php php php php php php}
php php php php php php php php php}

php php php php php php php php php/php/php Normalizephp constraintsphp,php ifphp present
php php php php php php php php foreachphp php(php$thisphp-php>php_jsonParamsphp asphp php$paramphp)php php{
php php php php php php php php php php php php ifphp php(arrayphp_keyphp_existsphp(php$paramphp,php php$paramsphp)php)php php{
php php php php php php php php php php php php php php php php requirephp_oncephp php'Zendphp/Jsonphp.phpphp'php;

php php php php php php php php php php php php php php php php ifphp php(isphp_arrayphp(php$paramsphp[php$paramphp]php)php)php php{
php php php php php php php php php php php php php php php php php php php php php$valuesphp php=php arrayphp(php)php;
php php php php php php php php php php php php php php php php php php php php foreachphp php(php$paramsphp[php$paramphp]php asphp php$keyphp php=php>php php$valuephp)php php{
php php php php php php php php php php php php php php php php php php php php php php php php ifphp php(php!isphp_scalarphp(php$valuephp)php)php php{
php php php php php php php php php php php php php php php php php php php php php php php php php php php php continuephp;
php php php php php php php php php php php php php php php php php php php php php php php php php}
php php php php php php php php php php php php php php php php php php php php php php php php php$valuesphp[php$keyphp]php php=php php$valuephp;
php php php php php php php php php php php php php php php php php php php php php}
php php php php php php php php php php php php php php php php php}php elseifphp php(isphp_stringphp(php$paramsphp[php$paramphp]php)php)php php{
php php php php php php php php php php php php php php php php php php php php php$valuesphp php=php php(arrayphp)php php$paramsphp[php$paramphp]php;
php php php php php php php php php php php php php php php php php}php elsephp php{
php php php php php php php php php php php php php php php php php php php php php$valuesphp php=php arrayphp(php)php;
php php php php php php php php php php php php php php php php php}
php php php php php php php php php php php php php php php php php$valuesphp php=php Zendphp_Jsonphp:php:encodephp(php$valuesphp)php;
php php php php php php php php php php php php php php php php ifphp php(php$thisphp-php>php_useDeclarativephp(php)php)php php{
php php php php php php php php php php php php php php php php php php php php php$valuesphp php=php strphp_replacephp(php'php"php'php,php php"php'php"php,php php$valuesphp)php;
php php php php php php php php php php php php php php php php php}
php php php php php php php php php php php php php php php php php$paramsphp[php$paramphp]php php=php php$valuesphp;
php php php php php php php php php php php php php}
php php php php php php php php php}

php php php php php php php php php$dijitphp php=php php(nullphp php=php=php=php php$dijitphp)php php?php php$thisphp-php>php_dijitphp php:php php$dijitphp;
php php php php php php php php ifphp php(php$thisphp-php>php_useDeclarativephp(php)php)php php{
php php php php php php php php php php php php php$attribsphp php=php arrayphp_mergephp(php$attribsphp,php php$paramsphp)php;
php php php php php php php php php php php php ifphp php(issetphp(php$attribsphp[php'requiredphp'php]php)php)php php{
php php php php php php php php php php php php php php php php php$attribsphp[php'requiredphp'php]php php=php php(php$attribsphp[php'requiredphp'php]php)php php?php php'truephp'php php:php php'falsephp'php;
php php php php php php php php php php php php php}
php php php php php php php php php php php php php$attribsphp[php'dojoTypephp'php]php php=php php$dijitphp;
php php php php php php php php php}php elseifphp php(php!php$thisphp-php>php_useProgrammaticNoScriptphp(php)php)php php{
php php php php php php php php php php php php php$thisphp-php>php_createDijitphp(php$dijitphp,php php$attribsphp[php'idphp'php]php,php php$paramsphp)php;
php php php php php php php php php}

php php php php php php php php returnphp php$attribsphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Createphp aphp dijitphp programmatically
php php php php php php*
php php php php php php*php php@paramphp php stringphp php$dijit
php php php php php php*php php@paramphp php stringphp php$id
php php php php php php*php php@paramphp php arrayphp php$params
php php php php php php*php php@returnphp void
php php php php php php*php/
php php php php protectedphp functionphp php_createDijitphp(php$dijitphp,php php$idphp,php arrayphp php$paramsphp)
php php php php php{
php php php php php php php php php$paramsphp[php'dojoTypephp'php]php php=php php$dijitphp;

php php php php php php php php arrayphp_walkphp_recursivephp(php$paramsphp,php arrayphp(php$thisphp,php php'php_castBoolToStringphp'php)php)php;

php php php php php php php php php$thisphp-php>dojophp-php>setDijitphp(php$idphp,php php$paramsphp)php;
php php php php php}

php php php php php/php*php*
php php php php php php*php Castphp aphp booleanphp tophp aphp stringphp value
php php php php php php*
php php php php php php*php php@paramphp php mixedphp php$item
php php php php php php*php php@paramphp php stringphp php$key
php php php php php php*php php@returnphp void
php php php php php php*php/
php php php php protectedphp functionphp php_castBoolToStringphp(php&php$itemphp,php php$keyphp)
php php php php php{
php php php php php php php php ifphp php(php!isphp_boolphp(php$itemphp)php)php php{
php php php php php php php php php php php php returnphp;
php php php php php php php php php}
php php php php php php php php php$itemphp php=php php(php$itemphp)php php?php php"truephp"php php:php php"falsephp"php;
php php php php php}

php php php php php/php*php*
php php php php php php*php Renderphp aphp hiddenphp elementphp tophp holdphp aphp value
php php php php php php*
php php php php php php*php php@paramphp php stringphp php$id
php php php php php php*php php@paramphp php stringphp|intphp|floatphp php$value
php php php php php php*php php@returnphp string
php php php php php php*php/
php php php php protectedphp functionphp php_renderHiddenElementphp(php$idphp,php php$valuephp)
php php php php php{
php php php php php php php php php$hiddenAttribsphp php=php arrayphp(
php php php php php php php php php php php php php'namephp'php php php=php>php php$idphp,
php php php php php php php php php php php php php'valuephp'php php=php>php php(stringphp)php php$valuephp,
php php php php php php php php php php php php php'typephp'php php php=php>php php'hiddenphp'php,
php php php php php php php php php)php;
php php php php php php php php returnphp php'php<inputphp'php php.php php$thisphp-php>php_htmlAttribsphp(php$hiddenAttribsphp)php php.php php$thisphp-php>getClosingBracketphp(php)php;
php php php php php}

php php php php php/php*php*
php php php php php php*php Createphp JSphp functionphp forphp retrievingphp parentphp form
php php php php php php*
php php php php php php*php php@returnphp void
php php php php php php*php/
php php php php protectedphp functionphp php_createGetParentFormFunctionphp(php)
php php php php php{
php php php php php php php php php$functionphp php=<php<php<EOJ
ifphp php(zendphp php=php=php undefinedphp)php php{
php php php php varphp zendphp php=php php{php}php;
php}
zendphp.findParentFormphp php=php functionphp(elementNodephp)php php{
php php php php whilephp php(elementNodephp.nodeNamephp.toLowerCasephp(php)php php!php=php php'formphp'php)php php{
php php php php php php php php elementNodephp php=php elementNodephp.parentNodephp;
php php php php php}
php php php php returnphp elementNodephp;
php}php;
EOJphp;

php php php php php php php php php$thisphp-php>dojophp-php>addJavascriptphp(php$functionphp)php;
php php php php php}
php}
