<php?php
php/php*php*
php php*php Zendphp Framework
php php*
php php*php LICENSE
php php*
php php*php Thisphp sourcephp filephp isphp subjectphp tophp thephp newphp BSDphp licensephp thatphp isphp bundled
php php*php withphp thisphp packagephp inphp thephp filephp LICENSEphp.txtphp.
php php*php Itphp isphp alsophp availablephp throughphp thephp worldphp-widephp-webphp atphp thisphp URLphp:
php php*php httpphp:php/php/frameworkphp.zendphp.comphp/licensephp/newphp-bsd
php php*php Ifphp youphp didphp notphp receivephp aphp copyphp ofphp thephp licensephp andphp arephp unablephp to
php php*php obtainphp itphp throughphp thephp worldphp-widephp-webphp,php pleasephp sendphp anphp email
php php*php tophp licensephp@zendphp.comphp sophp wephp canphp sendphp youphp aphp copyphp immediatelyphp.
php php*
php php*php php@categoryphp php Zend
php php*php php@packagephp php php Zendphp_Filephp_Transfer
php php*php php@copyrightphp php Copyrightphp php(cphp)php php2php0php0php5php-php2php0php1php0php Zendphp Technologiesphp USAphp Incphp.php php(httpphp:php/php/wwwphp.zendphp.comphp)
php php*php php@licensephp php php httpphp:php/php/frameworkphp.zendphp.comphp/licensephp/newphp-bsdphp php php php php Newphp BSDphp License
php php*php php@versionphp php php php$Idphp:php Abstractphp.phpphp php2php2php3php7php1php php2php0php1php0php-php0php6php-php0php4php php2php0php:php0php9php:php4php4Zphp thomasphp php$
php php*php/

php/php*php*
php php*php Abstractphp classphp forphp filephp transfersphp php(Downloadsphp andphp Uploadsphp)
php php*
php php*php php@categoryphp php Zend
php php*php php@packagephp php php Zendphp_Filephp_Transfer
php php*php php@copyrightphp php Copyrightphp php(cphp)php php2php0php0php5php-php2php0php1php0php Zendphp Technologiesphp USAphp Incphp.php php(httpphp:php/php/wwwphp.zendphp.comphp)
php php*php php@licensephp php php httpphp:php/php/frameworkphp.zendphp.comphp/licensephp/newphp-bsdphp php php php php Newphp BSDphp License
php php*php/
abstractphp classphp Zendphp_Filephp_Transferphp_Adapterphp_Abstract
php{
php php php php php/php*php*php@php+
php php php php php php*php Pluginphp loaderphp Constants
php php php php php php*php/
php php php php constphp FILTERphp php php php php=php php'FILTERphp'php;
php php php php constphp VALIDATEphp php php=php php'VALIDATEphp'php;
php php php php php/php*php*php@php-php*php/

php php php php php/php*php*
php php php php php php*php Internalphp listphp ofphp breaks
php php php php php php*
php php php php php php*php php@varphp array
php php php php php php*php/
php php php php protectedphp php$php_breakphp php=php arrayphp(php)php;

php php php php php/php*php*
php php php php php php*php Internalphp listphp ofphp filters
php php php php php php*
php php php php php php*php php@varphp array
php php php php php php*php/
php php php php protectedphp php$php_filtersphp php=php arrayphp(php)php;

php php php php php/php*php*
php php php php php php*php Pluginphp loadersphp forphp filterphp andphp validationphp chains
php php php php php php*
php php php php php php*php php@varphp array
php php php php php php*php/
php php php php protectedphp php$php_loadersphp php=php arrayphp(php)php;

php php php php php/php*php*
php php php php php php*php Internalphp listphp ofphp messages
php php php php php php*
php php php php php php*php php@varphp array
php php php php php php*php/
php php php php protectedphp php$php_messagesphp php=php arrayphp(php)php;

php php php php php/php*php*
php php php php php php*php php@varphp Zendphp_Translate
php php php php php php*php/
php php php php protectedphp php$php_translatorphp;

php php php php php/php*php*
php php php php php php*php Isphp translationphp disabledphp?
php php php php php php*
php php php php php php*php php@varphp bool
php php php php php php*php/
php php php php protectedphp php$php_translatorDisabledphp php=php falsephp;

php php php php php/php*php*
php php php php php php*php Internalphp listphp ofphp validators
php php php php php php*php php@varphp array
php php php php php php*php/
php php php php protectedphp php$php_validatorsphp php=php arrayphp(php)php;

php php php php php/php*php*
php php php php php php*php Internalphp listphp ofphp files
php php php php php php*php Thisphp arrayphp looksphp likephp thisphp:
php php php php php php*php php php php php arrayphp(formphp php=php>php arrayphp(php php-php Formphp isphp thephp namephp withinphp thephp formphp orphp,php ifphp notphp setphp thephp filename
php php php php php php*php php php php php php php php php namephp,php php php php php php php php php php php php php-php Originalphp namephp ofphp thisphp file
php php php php php php*php php php php php php php php php typephp,php php php php php php php php php php php php php-php Mimephp typephp ofphp thisphp file
php php php php php php*php php php php php php php php php sizephp,php php php php php php php php php php php php php-php Filesizephp inphp bytes
php php php php php php*php php php php php php php php php tmpphp_namephp,php php php php php php php php php-php Internalallyphp temporaryphp filenamephp forphp uploadedphp files
php php php php php php*php php php php php php php php php errorphp,php php php php php php php php php php php php-php Errorphp whichphp hasphp occured
php php php php php php*php php php php php php php php php destinationphp,php php php php php php-php Newphp destinationphp forphp thisphp file
php php php php php php*php php php php php php php php php validatorsphp,php php php php php php php-php Setphp validatorphp namesphp forphp thisphp file
php php php php php php*php php php php php php php php php filesphp php php php php php php php php php php php php-php Setphp filephp namesphp forphp thisphp file
php php php php php php*php php php php php php)php)
php php php php php php*
php php php php php php*php php@varphp array
php php php php php php*php/
php php php php protectedphp php$php_filesphp php=php arrayphp(php)php;

php php php php php/php*php*
php php php php php php*php TMPphp directory
php php php php php php*php php@varphp string
php php php php php php*php/
php php php php protectedphp php$php_tmpDirphp;

php php php php php/php*php*
php php php php php php*php Availablephp optionsphp forphp filephp transfers
php php php php php php*php/
php php php php protectedphp php$php_optionsphp php=php arrayphp(
php php php php php php php php php'ignoreNoFilephp'php php php=php>php falsephp,
php php php php php php php php php'useByteStringphp'php php=php>php truephp,
php php php php php php php php php'magicFilephp'php php php php php php=php>php nullphp,
php php php php php php php php php'detectInfosphp'php php php php=php>php truephp,
php php php php php)php;

php php php php php/php*php*
php php php php php php*php Sendphp file
php php php php php php*
php php php php php php*php php@paramphp php mixedphp php$options
php php php php php php*php php@returnphp bool
php php php php php php*php/
php php php php abstractphp publicphp functionphp sendphp(php$optionsphp php=php nullphp)php;

php php php php php/php*php*
php php php php php php*php Receivephp file
php php php php php php*
php php php php php php*php php@paramphp php mixedphp php$options
php php php php php php*php php@returnphp bool
php php php php php php*php/
php php php php abstractphp publicphp functionphp receivephp(php$optionsphp php=php nullphp)php;

php php php php php/php*php*
php php php php php php*php Isphp filephp sentphp?
php php php php php php*
php php php php php php*php php@paramphp php arrayphp|stringphp|nullphp php$files
php php php php php php*php php@returnphp bool
php php php php php php*php/
php php php php abstractphp publicphp functionphp isSentphp(php$filesphp php=php nullphp)php;

php php php php php/php*php*
php php php php php php*php Isphp filephp receivedphp?
php php php php php php*
php php php php php php*php php@paramphp php arrayphp|stringphp|nullphp php$files
php php php php php php*php php@returnphp bool
php php php php php php*php/
php php php php abstractphp publicphp functionphp isReceivedphp(php$filesphp php=php nullphp)php;

php php php php php/php*php*
php php php php php php*php Hasphp aphp filephp beenphp uploadedphp php?
php php php php php php*
php php php php php php*php php@paramphp php arrayphp|stringphp|nullphp php$files
php php php php php php*php php@returnphp bool
php php php php php php*php/
php php php php abstractphp publicphp functionphp isUploadedphp(php$filesphp php=php nullphp)php;

php php php php php/php*php*
php php php php php php*php Hasphp thephp filephp beenphp filteredphp php?
php php php php php php*
php php php php php php*php php@paramphp arrayphp|stringphp|nullphp php$files
php php php php php php*php php@returnphp bool
php php php php php php*php/
php php php php abstractphp publicphp functionphp isFilteredphp(php$filesphp php=php nullphp)php;

php php php php php/php*php*
php php php php php php*php Retrievephp progressphp ofphp transfer
php php php php php php*
php php php php php php*php php@returnphp float
php php php php php php*php/
php php php php publicphp staticphp functionphp getProgressphp(php)
php php php php php{
php php php php php php php php requirephp_oncephp php'Zendphp/Filephp/Transferphp/Exceptionphp.phpphp'php;
php php php php php php php php throwphp newphp Zendphp_Filephp_Transferphp_Exceptionphp(php'Methodphp mustphp bephp implementedphp withinphp thephp adapterphp'php)php;
php php php php php}

php php php php php/php*php*
php php php php php php*php Setphp pluginphp loaderphp tophp usephp forphp validatorphp orphp filterphp chain
php php php php php php*
php php php php php php*php php@paramphp php Zendphp_Loaderphp_PluginLoaderphp_Interfacephp php$loader
php php php php php php*php php@paramphp php stringphp php$typephp php'filterphp'php,php orphp php'validatephp'
php php php php php php*php php@returnphp Zendphp_Filephp_Transferphp_Adapterphp_Abstract
php php php php php php*php php@throwsphp Zendphp_Filephp_Transferphp_Exceptionphp onphp invalidphp type
php php php php php php*php/
php php php php publicphp functionphp setPluginLoaderphp(Zendphp_Loaderphp_PluginLoaderphp_Interfacephp php$loaderphp,php php$typephp)
php php php php php{
php php php php php php php php php$typephp php=php strtoupperphp(php$typephp)php;
php php php php php php php php switchphp php(php$typephp)php php{
php php php php php php php php php php php php casephp selfphp:php:FILTERphp:
php php php php php php php php php php php php casephp selfphp:php:VALIDATEphp:
php php php php php php php php php php php php php php php php php$thisphp-php>php_loadersphp[php$typephp]php php=php php$loaderphp;
php php php php php php php php php php php php php php php php returnphp php$thisphp;
php php php php php php php php php php php php defaultphp:
php php php php php php php php php php php php php php php php requirephp_oncephp php'Zendphp/Filephp/Transferphp/Exceptionphp.phpphp'php;
php php php php php php php php php php php php php php php php throwphp newphp Zendphp_Filephp_Transferphp_Exceptionphp(sprintfphp(php'Invalidphp typephp php"php%sphp"php providedphp tophp setPluginLoaderphp(php)php'php,php php$typephp)php)php;
php php php php php php php php php}
php php php php php}

php php php php php/php*php*
php php php php php php*php Retrievephp pluginphp loaderphp forphp validatorphp orphp filterphp chain
php php php php php php*
php php php php php php*php Instantiatesphp withphp defaultphp rulesphp ifphp nonephp availablephp forphp thatphp typephp.php Use
php php php php php php*php php'filterphp'php orphp php'validatephp'php forphp php$typephp.
php php php php php php*
php php php php php php*php php@paramphp php stringphp php$type
php php php php php php*php php@returnphp Zendphp_Loaderphp_PluginLoader
php php php php php php*php php@throwsphp Zendphp_Filephp_Transferphp_Exceptionphp onphp invalidphp typephp.
php php php php php php*php/
php php php php publicphp functionphp getPluginLoaderphp(php$typephp)
php php php php php{
php php php php php php php php php$typephp php=php strtoupperphp(php$typephp)php;
php php php php php php php php switchphp php(php$typephp)php php{
php php php php php php php php php php php php casephp selfphp:php:FILTERphp:
php php php php php php php php php php php php casephp selfphp:php:VALIDATEphp:
php php php php php php php php php php php php php php php php php$prefixSegmentphp php=php ucfirstphp(strtolowerphp(php$typephp)php)php;
php php php php php php php php php php php php php php php php php$pathSegmentphp php php php=php php$prefixSegmentphp;
php php php php php php php php php php php php php php php php ifphp php(php!issetphp(php$thisphp-php>php_loadersphp[php$typephp]php)php)php php{
php php php php php php php php php php php php php php php php php php php php php$pathsphp php php php php php php php php php=php arrayphp(
php php php php php php php php php php php php php php php php php php php php php php php php php'Zendphp_php'php php.php php$prefixSegmentphp php.php php'php_php'php php php php php php=php>php php'Zendphp/php'php php.php php$pathSegmentphp php.php php'php/php'php,
php php php php php php php php php php php php php php php php php php php php php php php php php'Zendphp_php'php php.php php$prefixSegmentphp php.php php'php_Filephp'php php=php>php php'Zendphp/php'php php.php php$pathSegmentphp php.php php'php/Filephp'php,
php php php php php php php php php php php php php php php php php php php php php)php;

php php php php php php php php php php php php php php php php php php php php requirephp_oncephp php'Zendphp/Loaderphp/PluginLoaderphp.phpphp'php;
php php php php php php php php php php php php php php php php php php php php php$thisphp-php>php_loadersphp[php$typephp]php php=php newphp Zendphp_Loaderphp_PluginLoaderphp(php$pathsphp)php;
php php php php php php php php php php php php php php php php php}php elsephp php{
php php php php php php php php php php php php php php php php php php php php php$loaderphp php=php php$thisphp-php>php_loadersphp[php$typephp]php;
php php php php php php php php php php php php php php php php php php php php php$prefixphp php=php php'Zendphp_php'php php.php php$prefixSegmentphp php.php php'php_Filephp_php'php;
php php php php php php php php php php php php php php php php php php php php ifphp php(php!php$loaderphp-php>getPathsphp(php$prefixphp)php)php php{
php php php php php php php php php php php php php php php php php php php php php php php php php$loaderphp-php>addPrefixPathphp(php$prefixphp,php strphp_replacephp(php'php_php'php,php php'php/php'php,php php$prefixphp)php)php;
php php php php php php php php php php php php php php php php php php php php php}
php php php php php php php php php php php php php php php php php}
php php php php php php php php php php php php php php php php returnphp php$thisphp-php>php_loadersphp[php$typephp]php;
php php php php php php php php php php php php defaultphp:
php php php php php php php php php php php php php php php php requirephp_oncephp php'Zendphp/Filephp/Transferphp/Exceptionphp.phpphp'php;
php php php php php php php php php php php php php php php php throwphp newphp Zendphp_Filephp_Transferphp_Exceptionphp(sprintfphp(php'Invalidphp typephp php"php%sphp"php providedphp tophp getPluginLoaderphp(php)php'php,php php$typephp)php)php;
php php php php php php php php php}
php php php php php}

php php php php php/php*php*
php php php php php php*php Addphp prefixphp pathphp forphp pluginphp loader
php php php php php php*
php php php php php php*php Ifphp nophp php$typephp specifiedphp,php assumesphp itphp isphp aphp basephp pathphp forphp bothphp filtersphp and
php php php php php php*php validatorsphp,php andphp setsphp eachphp accordingphp tophp thephp followingphp rulesphp:
php php php php php php*php php-php filtersphp:php php php php php$prefixphp php=php php$prefixphp php.php php'php_Filterphp'
php php php php php php*php php-php validatorsphp:php php$prefixphp php=php php$prefixphp php.php php'php_Validatephp'
php php php php php php*
php php php php php php*php Otherwisephp,php thephp pathphp prefixphp isphp setphp onphp thephp appropriatephp pluginphp loaderphp.
php php php php php php*
php php php php php php*php php@paramphp php stringphp php$prefix
php php php php php php*php php@paramphp php stringphp php$path
php php php php php php*php php@paramphp php stringphp php$type
php php php php php php*php php@returnphp Zendphp_Filephp_Transferphp_Adapterphp_Abstract
php php php php php php*php php@throwsphp Zendphp_Filephp_Transferphp_Exceptionphp forphp invalidphp type
php php php php php php*php/
php php php php publicphp functionphp addPrefixPathphp(php$prefixphp,php php$pathphp,php php$typephp php=php nullphp)
php php php php php{
php php php php php php php php php$typephp php=php strtoupperphp(php$typephp)php;
php php php php php php php php switchphp php(php$typephp)php php{
php php php php php php php php php php php php casephp selfphp:php:FILTERphp:
php php php php php php php php php php php php casephp selfphp:php:VALIDATEphp:
php php php php php php php php php php php php php php php php php$loaderphp php=php php$thisphp-php>getPluginLoaderphp(php$typephp)php;
php php php php php php php php php php php php php php php php php$loaderphp-php>addPrefixPathphp(php$prefixphp,php php$pathphp)php;
php php php php php php php php php php php php php php php php returnphp php$thisphp;
php php php php php php php php php php php php casephp nullphp:
php php php php php php php php php php php php php php php php php$prefixphp php=php rtrimphp(php$prefixphp,php php'php_php'php)php;
php php php php php php php php php php php php php php php php php$pathphp php php php=php rtrimphp(php$pathphp,php DIRECTORYphp_SEPARATORphp)php;
php php php php php php php php php php php php php php php php foreachphp php(arrayphp(selfphp:php:FILTERphp,php selfphp:php:VALIDATEphp)php asphp php$typephp)php php{
php php php php php php php php php php php php php php php php php php php php php$cTypephp php php php php php php php php=php ucfirstphp(strtolowerphp(php$typephp)php)php;
php php php php php php php php php php php php php php php php php php php php php$pluginPathphp php php php=php php$pathphp php.php DIRECTORYphp_SEPARATORphp php.php php$cTypephp php.php DIRECTORYphp_SEPARATORphp;
php php php php php php php php php php php php php php php php php php php php php$pluginPrefixphp php=php php$prefixphp php.php php'php_php'php php.php php$cTypephp;
php php php php php php php php php php php php php php php php php php php php php$loaderphp php php php php php php php=php php$thisphp-php>getPluginLoaderphp(php$typephp)php;
php php php php php php php php php php php php php php php php php php php php php$loaderphp-php>addPrefixPathphp(php$pluginPrefixphp,php php$pluginPathphp)php;
php php php php php php php php php php php php php php php php php}
php php php php php php php php php php php php php php php php returnphp php$thisphp;
php php php php php php php php php php php php defaultphp:
php php php php php php php php php php php php php php php php requirephp_oncephp php'Zendphp/Filephp/Transferphp/Exceptionphp.phpphp'php;
php php php php php php php php php php php php php php php php throwphp newphp Zendphp_Filephp_Transferphp_Exceptionphp(sprintfphp(php'Invalidphp typephp php"php%sphp"php providedphp tophp getPluginLoaderphp(php)php'php,php php$typephp)php)php;
php php php php php php php php php}
php php php php php}

php php php php php/php*php*
php php php php php php*php Addphp manyphp prefixphp pathsphp atphp once
php php php php php php*
php php php php php php*php php@paramphp php arrayphp php$spec
php php php php php php*php php@returnphp Zendphp_Filephp_Transferphp_Exception
php php php php php php*php/
php php php php publicphp functionphp addPrefixPathsphp(arrayphp php$specphp)
php php php php php{
php php php php php php php php ifphp php(issetphp(php$specphp[php'prefixphp'php]php)php php&php&php issetphp(php$specphp[php'pathphp'php]php)php)php php{
php php php php php php php php php php php php returnphp php$thisphp-php>addPrefixPathphp(php$specphp[php'prefixphp'php]php,php php$specphp[php'pathphp'php]php)php;
php php php php php php php php php}
php php php php php php php php foreachphp php(php$specphp asphp php$typephp php=php>php php$pathsphp)php php{
php php php php php php php php php php php php ifphp php(isphp_numericphp(php$typephp)php php&php&php isphp_arrayphp(php$pathsphp)php)php php{
php php php php php php php php php php php php php php php php php$typephp php=php nullphp;
php php php php php php php php php php php php php php php php ifphp php(issetphp(php$pathsphp[php'prefixphp'php]php)php php&php&php issetphp(php$pathsphp[php'pathphp'php]php)php)php php{
php php php php php php php php php php php php php php php php php php php php ifphp php(issetphp(php$pathsphp[php'typephp'php]php)php)php php{
php php php php php php php php php php php php php php php php php php php php php php php php php$typephp php=php php$pathsphp[php'typephp'php]php;
php php php php php php php php php php php php php php php php php php php php php}
php php php php php php php php php php php php php php php php php php php php php$thisphp-php>addPrefixPathphp(php$pathsphp[php'prefixphp'php]php,php php$pathsphp[php'pathphp'php]php,php php$typephp)php;
php php php php php php php php php php php php php php php php php}
php php php php php php php php php php php php php}php elseifphp php(php!isphp_numericphp(php$typephp)php)php php{
php php php php php php php php php php php php php php php php ifphp php(php!issetphp(php$pathsphp[php'prefixphp'php]php)php php|php|php php!issetphp(php$pathsphp[php'pathphp'php]php)php)php php{
php php php php php php php php php php php php php php php php php php php php foreachphp php(php$pathsphp asphp php$prefixphp php=php>php php$specphp)php php{
php php php php php php php php php php php php php php php php php php php php php php php php ifphp php(isphp_arrayphp(php$specphp)php)php php{
php php php php php php php php php php php php php php php php php php php php php php php php php php php php foreachphp php(php$specphp asphp php$pathphp)php php{
php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php ifphp php(php!isphp_stringphp(php$pathphp)php)php php{
php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php continuephp;
php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php}
php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php$thisphp-php>addPrefixPathphp(php$prefixphp,php php$pathphp,php php$typephp)php;
php php php php php php php php php php php php php php php php php php php php php php php php php php php php php}
php php php php php php php php php php php php php php php php php php php php php php php php php}php elseifphp php(isphp_stringphp(php$specphp)php)php php{
php php php php php php php php php php php php php php php php php php php php php php php php php php php php php$thisphp-php>addPrefixPathphp(php$prefixphp,php php$specphp,php php$typephp)php;
php php php php php php php php php php php php php php php php php php php php php php php php php}
php php php php php php php php php php php php php php php php php php php php php}
php php php php php php php php php php php php php php php php php}php elsephp php{
php php php php php php php php php php php php php php php php php php php php php$thisphp-php>addPrefixPathphp(php$pathsphp[php'prefixphp'php]php,php php$pathsphp[php'pathphp'php]php,php php$typephp)php;
php php php php php php php php php php php php php php php php php}
php php php php php php php php php php php php php}
php php php php php php php php php}
php php php php php php php php returnphp php$thisphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Addsphp aphp newphp validatorphp forphp thisphp class
php php php php php php*
php php php php php php*php php@paramphp php stringphp|arrayphp php$validatorphp php php php php php php php php php php Typephp ofphp validatorphp tophp add
php php php php php php*php php@paramphp php booleanphp php php php php php php$breakChainOnFailurephp Ifphp thephp validationphp chainphp shouldphp stopphp anphp failure
php php php php php php*php php@paramphp php stringphp|arrayphp php$optionsphp php php php php php php php php php php php php Optionsphp tophp setphp forphp thephp validator
php php php php php php*php php@paramphp php stringphp|arrayphp php$filesphp php php php php php php php php php php php php php php Filesphp tophp limitphp thisphp validatorphp to
php php php php php php*php php@returnphp Zendphp_Filephp_Transferphp_Adapter
php php php php php php*php/
php php php php publicphp functionphp addValidatorphp(php$validatorphp,php php$breakChainOnFailurephp php=php falsephp,php php$optionsphp php=php nullphp,php php$filesphp php=php nullphp)
php php php php php{
php php php php php php php php ifphp php(php$validatorphp instanceofphp Zendphp_Validatephp_Interfacephp)php php{
php php php php php php php php php php php php php$namephp php=php getphp_classphp(php$validatorphp)php;
php php php php php php php php php}php elseifphp php(isphp_stringphp(php$validatorphp)php)php php{
php php php php php php php php php php php php php$namephp php php php php php php=php php$thisphp-php>getPluginLoaderphp(selfphp:php:VALIDATEphp)php-php>loadphp(php$validatorphp)php;
php php php php php php php php php php php php php$validatorphp php=php newphp php$namephp(php$optionsphp)php;
php php php php php php php php php php php php ifphp php(isphp_arrayphp(php$optionsphp)php php&php&php issetphp(php$optionsphp[php'messagesphp'php]php)php)php php{
php php php php php php php php php php php php php php php php ifphp php(isphp_arrayphp(php$optionsphp[php'messagesphp'php]php)php)php php{
php php php php php php php php php php php php php php php php php php php php php$validatorphp-php>setMessagesphp(php$optionsphp[php'messagesphp'php]php)php;
php php php php php php php php php php php php php php php php php}php elseifphp php(isphp_stringphp(php$optionsphp[php'messagesphp'php]php)php)php php{
php php php php php php php php php php php php php php php php php php php php php$validatorphp-php>setMessagephp(php$optionsphp[php'messagesphp'php]php)php;
php php php php php php php php php php php php php php php php php}

php php php php php php php php php php php php php php php php unsetphp(php$optionsphp[php'messagesphp'php]php)php;
php php php php php php php php php php php php php}
php php php php php php php php php}php elsephp php{
php php php php php php php php php php php php requirephp_oncephp php'Zendphp/Filephp/Transferphp/Exceptionphp.phpphp'php;
php php php php php php php php php php php php throwphp newphp Zendphp_Filephp_Transferphp_Exceptionphp(php'Invalidphp validatorphp providedphp tophp addValidatorphp;php mustphp bephp stringphp orphp Zendphp_Validatephp_Interfacephp'php)php;
php php php php php php php php php}

php php php php php php php php php$thisphp-php>php_validatorsphp[php$namephp]php php=php php$validatorphp;
php php php php php php php php php$thisphp-php>php_breakphp[php$namephp]php php php php php php php=php php$breakChainOnFailurephp;
php php php php php php php php php$filesphp php php php php php php php php php php php php php php php php php php php php=php php$thisphp-php>php_getFilesphp(php$filesphp,php truephp,php truephp)php;
php php php php php php php php foreachphp php(php$filesphp asphp php$filephp)php php{
php php php php php php php php php php php php ifphp php(php$namephp php=php=php php'NotEmptyphp'php)php php{
php php php php php php php php php php php php php php php php php$tempphp php=php php$thisphp-php>php_filesphp[php$filephp]php[php'validatorsphp'php]php;
php php php php php php php php php php php php php php php php php$thisphp-php>php_filesphp[php$filephp]php[php'validatorsphp'php]php php php=php arrayphp(php$namephp)php;
php php php php php php php php php php php php php php php php php$thisphp-php>php_filesphp[php$filephp]php[php'validatorsphp'php]php php+php=php php$tempphp;
php php php php php php php php php php php php php}php elsephp php{
php php php php php php php php php php php php php php php php php$thisphp-php>php_filesphp[php$filephp]php[php'validatorsphp'php]php[php]php php=php php$namephp;
php php php php php php php php php php php php php}

php php php php php php php php php php php php php$thisphp-php>php_filesphp[php$filephp]php[php'validatedphp'php]php php php php php=php falsephp;
php php php php php php php php php}

php php php php php php php php returnphp php$thisphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Addphp Multiplephp validatorsphp atphp once
php php php php php php*
php php php php php php*php php@paramphp php arrayphp php$validators
php php php php php php*php php@paramphp php stringphp|arrayphp php$files
php php php php php php*php php@returnphp Zendphp_Filephp_Transferphp_Adapterphp_Abstract
php php php php php php*php/
php php php php publicphp functionphp addValidatorsphp(arrayphp php$validatorsphp,php php$filesphp php=php nullphp)
php php php php php{
php php php php php php php php foreachphp php(php$validatorsphp asphp php$namephp php=php>php php$validatorInfophp)php php{
php php php php php php php php php php php php ifphp php(php$validatorInfophp instanceofphp Zendphp_Validatephp_Interfacephp)php php{
php php php php php php php php php php php php php php php php php$thisphp-php>addValidatorphp(php$validatorInfophp,php nullphp,php nullphp,php php$filesphp)php;
php php php php php php php php php php php php php}php elsephp ifphp php(isphp_stringphp(php$validatorInfophp)php)php php{
php php php php php php php php php php php php php php php php ifphp php(php!isphp_intphp(php$namephp)php)php php{
php php php php php php php php php php php php php php php php php php php php php$thisphp-php>addValidatorphp(php$namephp,php nullphp,php php$validatorInfophp,php php$filesphp)php;
php php php php php php php php php php php php php php php php php}php elsephp php{
php php php php php php php php php php php php php php php php php php php php php$thisphp-php>addValidatorphp(php$validatorInfophp,php nullphp,php nullphp,php php$filesphp)php;
php php php php php php php php php php php php php php php php php}
php php php php php php php php php php php php php}php elsephp ifphp php(isphp_arrayphp(php$validatorInfophp)php)php php{
php php php php php php php php php php php php php php php php php$argcphp php php php php php php php php php php php php php php php php=php countphp(php$validatorInfophp)php;
php php php php php php php php php php php php php php php php php$breakChainOnFailurephp php=php falsephp;
php php php php php php php php php php php php php php php php php$optionsphp php php php php php php php php php php php php php=php arrayphp(php)php;
php php php php php php php php php php php php php php php php ifphp php(issetphp(php$validatorInfophp[php'validatorphp'php]php)php)php php{
php php php php php php php php php php php php php php php php php php php php php$validatorphp php=php php$validatorInfophp[php'validatorphp'php]php;
php php php php php php php php php php php php php php php php php php php php ifphp php(issetphp(php$validatorInfophp[php'breakChainOnFailurephp'php]php)php)php php{
php php php php php php php php php php php php php php php php php php php php php php php php php$breakChainOnFailurephp php=php php$validatorInfophp[php'breakChainOnFailurephp'php]php;
php php php php php php php php php php php php php php php php php php php php php}

php php php php php php php php php php php php php php php php php php php php ifphp php(issetphp(php$validatorInfophp[php'optionsphp'php]php)php)php php{
php php php php php php php php php php php php php php php php php php php php php php php php php$optionsphp php=php php$validatorInfophp[php'optionsphp'php]php;
php php php php php php php php php php php php php php php php php php php php php}

php php php php php php php php php php php php php php php php php php php php php$thisphp-php>addValidatorphp(php$validatorphp,php php$breakChainOnFailurephp,php php$optionsphp,php php$filesphp)php;
php php php php php php php php php php php php php php php php php}php elsephp php{
php php php php php php php php php php php php php php php php php php php php ifphp php(isphp_stringphp(php$namephp)php)php php{
php php php php php php php php php php php php php php php php php php php php php php php php php$validatorphp php=php php$namephp;
php php php php php php php php php php php php php php php php php php php php php php php php php$optionsphp php php php=php php$validatorInfophp;
php php php php php php php php php php php php php php php php php php php php php php php php php$thisphp-php>addValidatorphp(php$validatorphp,php php$breakChainOnFailurephp,php php$optionsphp,php php$filesphp)php;
php php php php php php php php php php php php php php php php php php php php php}php elsephp php{
php php php php php php php php php php php php php php php php php php php php php php php php php$filephp php=php php$filesphp;
php php php php php php php php php php php php php php php php php php php php php php php php switchphp php(truephp)php php{
php php php php php php php php php php php php php php php php php php php php php php php php php php php php casephp php(php0php php=php=php php$argcphp)php:
php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php breakphp;
php php php php php php php php php php php php php php php php php php php php php php php php php php php php casephp php(php1php <php=php php$argcphp)php:
php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php$validatorphp php php=php arrayphp_shiftphp(php$validatorInfophp)php;
php php php php php php php php php php php php php php php php php php php php php php php php php php php php casephp php(php2php <php=php php$argcphp)php:
php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php$breakChainOnFailurephp php=php arrayphp_shiftphp(php$validatorInfophp)php;
php php php php php php php php php php php php php php php php php php php php php php php php php php php php casephp php(php3php <php=php php$argcphp)php:
php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php$optionsphp php=php arrayphp_shiftphp(php$validatorInfophp)php;
php php php php php php php php php php php php php php php php php php php php php php php php php php php php casephp php(php4php <php=php php$argcphp)php:
php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php ifphp php(php!emptyphp(php$validatorInfophp)php)php php{
php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php$filephp php=php arrayphp_shiftphp(php$validatorInfophp)php;
php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php}
php php php php php php php php php php php php php php php php php php php php php php php php php php php php defaultphp:
php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php$thisphp-php>addValidatorphp(php$validatorphp,php php$breakChainOnFailurephp,php php$optionsphp,php php$filephp)php;
php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php breakphp;
php php php php php php php php php php php php php php php php php php php php php php php php php}
php php php php php php php php php php php php php php php php php php php php php}
php php php php php php php php php php php php php php php php php}
php php php php php php php php php php php php php}php elsephp php{
php php php php php php php php php php php php php php php php requirephp_oncephp php'Zendphp/Filephp/Transferphp/Exceptionphp.phpphp'php;
php php php php php php php php php php php php php php php php throwphp newphp Zendphp_Filephp_Transferphp_Exceptionphp(php'Invalidphp validatorphp passedphp tophp addValidatorsphp(php)php'php)php;
php php php php php php php php php php php php php}
php php php php php php php php php}

php php php php php php php php returnphp php$thisphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Setsphp aphp validatorphp forphp thephp classphp,php erasingphp allphp previousphp set
php php php php php php*
php php php php php php*php php@paramphp php stringphp|arrayphp php$validatorphp Validatorphp tophp set
php php php php php php*php php@paramphp php stringphp|arrayphp php$filesphp php php php php Filesphp tophp limitphp thisphp validatorphp to
php php php php php php*php php@returnphp Zendphp_Filephp_Transferphp_Adapter
php php php php php php*php/
php php php php publicphp functionphp setValidatorsphp(arrayphp php$validatorsphp,php php$filesphp php=php nullphp)
php php php php php{
php php php php php php php php php$thisphp-php>clearValidatorsphp(php)php;
php php php php php php php php returnphp php$thisphp-php>addValidatorsphp(php$validatorsphp,php php$filesphp)php;
php php php php php}

php php php php php/php*php*
php php php php php php*php Determinephp ifphp aphp givenphp validatorphp hasphp alreadyphp beenphp registered
php php php php php php*
php php php php php php*php php@paramphp php stringphp php$name
php php php php php php*php php@returnphp bool
php php php php php php*php/
php php php php publicphp functionphp hasValidatorphp(php$namephp)
php php php php php{
php php php php php php php php returnphp php(falsephp php!php=php=php php$thisphp-php>php_getValidatorIdentifierphp(php$namephp)php)php;
php php php php php}

php php php php php/php*php*
php php php php php php*php Retrievephp individualphp validator
php php php php php php*
php php php php php php*php php@paramphp php stringphp php$name
php php php php php php*php php@returnphp Zendphp_Validatephp_Interfacephp|null
php php php php php php*php/
php php php php publicphp functionphp getValidatorphp(php$namephp)
php php php php php{
php php php php php php php php ifphp php(falsephp php=php=php=php php(php$identifierphp php=php php$thisphp-php>php_getValidatorIdentifierphp(php$namephp)php)php)php php{
php php php php php php php php php php php php returnphp nullphp;
php php php php php php php php php}
php php php php php php php php returnphp php$thisphp-php>php_validatorsphp[php$identifierphp]php;
php php php php php}

php php php php php/php*php*
php php php php php php*php Returnsphp allphp setphp validators
php php php php php php*
php php php php php php*php php@paramphp php stringphp|arrayphp php$filesphp php(Optionalphp)php Returnsphp thephp validatorphp forphp thisphp files
php php php php php php*php php@returnphp nullphp|arrayphp Listphp ofphp setphp validators
php php php php php php*php/
php php php php publicphp functionphp getValidatorsphp(php$filesphp php=php nullphp)
php php php php php{
php php php php php php php php ifphp php(php$filesphp php=php=php nullphp)php php{
php php php php php php php php php php php php returnphp php$thisphp-php>php_validatorsphp;
php php php php php php php php php}

php php php php php php php php php$filesphp php php php php php php=php php$thisphp-php>php_getFilesphp(php$filesphp,php truephp,php truephp)php;
php php php php php php php php php$validatorsphp php=php arrayphp(php)php;
php php php php php php php php foreachphp php(php$filesphp asphp php$filephp)php php{
php php php php php php php php php php php php ifphp php(php!emptyphp(php$thisphp-php>php_filesphp[php$filephp]php[php'validatorsphp'php]php)php)php php{
php php php php php php php php php php php php php php php php php$validatorsphp php+php=php php$thisphp-php>php_filesphp[php$filephp]php[php'validatorsphp'php]php;
php php php php php php php php php php php php php}
php php php php php php php php php}

php php php php php php php php php$validatorsphp php=php arrayphp_uniquephp(php$validatorsphp)php;
php php php php php php php php php$resultphp php php php php php=php arrayphp(php)php;
php php php php php php php php foreachphp php(php$validatorsphp asphp php$validatorphp)php php{
php php php php php php php php php php php php php$resultphp[php$validatorphp]php php=php php$thisphp-php>php_validatorsphp[php$validatorphp]php;
php php php php php php php php php}

php php php php php php php php returnphp php$resultphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Removephp anphp individualphp validator
php php php php php php*
php php php php php php*php php@paramphp php stringphp php$name
php php php php php php*php php@returnphp Zendphp_Filephp_Transferphp_Adapterphp_Abstract
php php php php php php*php/
php php php php publicphp functionphp removeValidatorphp(php$namephp)
php php php php php{
php php php php php php php php ifphp php(falsephp php=php=php=php php(php$keyphp php=php php$thisphp-php>php_getValidatorIdentifierphp(php$namephp)php)php)php php{
php php php php php php php php php php php php returnphp php$thisphp;
php php php php php php php php php}

php php php php php php php php unsetphp(php$thisphp-php>php_validatorsphp[php$keyphp]php)php;
php php php php php php php php foreachphp php(arrayphp_keysphp(php$thisphp-php>php_filesphp)php asphp php$filephp)php php{
php php php php php php php php php php php php ifphp php(emptyphp(php$thisphp-php>php_filesphp[php$filephp]php[php'validatorsphp'php]php)php)php php{
php php php php php php php php php php php php php php php php continuephp;
php php php php php php php php php php php php php}

php php php php php php php php php php php php php$indexphp php=php arrayphp_searchphp(php$keyphp,php php$thisphp-php>php_filesphp[php$filephp]php[php'validatorsphp'php]php)php;
php php php php php php php php php php php php ifphp php(php$indexphp php=php=php=php falsephp)php php{
php php php php php php php php php php php php php php php php continuephp;
php php php php php php php php php php php php php}

php php php php php php php php php php php php unsetphp(php$thisphp-php>php_filesphp[php$filephp]php[php'validatorsphp'php]php[php$indexphp]php)php;
php php php php php php php php php php php php php$thisphp-php>php_filesphp[php$filephp]php[php'validatedphp'php]php php=php falsephp;
php php php php php php php php php}

php php php php php php php php returnphp php$thisphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Removephp allphp validators
php php php php php php*
php php php php php php*php php@returnphp Zendphp_Filephp_Transferphp_Adapterphp_Abstract
php php php php php php*php/
php php php php publicphp functionphp clearValidatorsphp(php)
php php php php php{
php php php php php php php php php$thisphp-php>php_validatorsphp php=php arrayphp(php)php;
php php php php php php php php foreachphp php(arrayphp_keysphp(php$thisphp-php>php_filesphp)php asphp php$filephp)php php{
php php php php php php php php php php php php php$thisphp-php>php_filesphp[php$filephp]php[php'validatorsphp'php]php php=php arrayphp(php)php;
php php php php php php php php php php php php php$thisphp-php>php_filesphp[php$filephp]php[php'validatedphp'php]php php php=php falsephp;
php php php php php php php php php}

php php php php php php php php returnphp php$thisphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Setsphp Optionsphp forphp adapters
php php php php php php*
php php php php php php*php php@paramphp arrayphp php$optionsphp Optionsphp tophp set
php php php php php php*php php@paramphp arrayphp php$filesphp php php php(Optionalphp)php Filesphp tophp setphp thephp optionsphp for
php php php php php php*php/
php php php php publicphp functionphp setOptionsphp(php$optionsphp php=php arrayphp(php)php,php php$filesphp php=php nullphp)php php{
php php php php php php php php php$filephp php=php php$thisphp-php>php_getFilesphp(php$filesphp,php falsephp,php truephp)php;

php php php php php php php php ifphp php(isphp_arrayphp(php$optionsphp)php)php php{
php php php php php php php php php php php php ifphp php(emptyphp(php$filephp)php)php php{
php php php php php php php php php php php php php php php php php$thisphp-php>php_optionsphp php=php arrayphp_mergephp(php$thisphp-php>php_optionsphp,php php$optionsphp)php;
php php php php php php php php php php php php php}

php php php php php php php php php php php php foreachphp php(php$optionsphp asphp php$namephp php=php>php php$valuephp)php php{
php php php php php php php php php php php php php php php php foreachphp php(php$filephp asphp php$keyphp php=php>php php$contentphp)php php{
php php php php php php php php php php php php php php php php php php php php switchphp php(php$namephp)php php{
php php php php php php php php php php php php php php php php php php php php php php php php casephp php'magicFilephp'php php:
php php php php php php php php php php php php php php php php php php php php php php php php php php php php php$thisphp-php>php_filesphp[php$keyphp]php[php'optionsphp'php]php[php$namephp]php php=php php(stringphp)php php$valuephp;
php php php php php php php php php php php php php php php php php php php php php php php php php php php php breakphp;

php php php php php php php php php php php php php php php php php php php php php php php php casephp php'ignoreNoFilephp'php php:
php php php php php php php php php php php php php php php php php php php php php php php php casephp php'useByteStringphp'php php:
php php php php php php php php php php php php php php php php php php php php php php php php casephp php'detectInfosphp'php php:
php php php php php php php php php php php php php php php php php php php php php php php php php php php php php$thisphp-php>php_filesphp[php$keyphp]php[php'optionsphp'php]php[php$namephp]php php=php php(booleanphp)php php$valuephp;
php php php php php php php php php php php php php php php php php php php php php php php php php php php php breakphp;

php php php php php php php php php php php php php php php php php php php php php php php php defaultphp:
php php php php php php php php php php php php php php php php php php php php php php php php php php php php requirephp_oncephp php'Zendphp/Filephp/Transferphp/Exceptionphp.phpphp'php;
php php php php php php php php php php php php php php php php php php php php php php php php php php php php throwphp newphp Zendphp_Filephp_Transferphp_Exceptionphp(php"Unknownphp optionphp:php php$namephp php=php php$valuephp"php)php;
php php php php php php php php php php php php php php php php php php php php php}
php php php php php php php php php php php php php php php php php}
php php php php php php php php php php php php php}
php php php php php php php php php}

php php php php php php php php returnphp php$thisphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Returnsphp setphp optionsphp forphp adaptersphp orphp files
php php php php php php*
php php php php php php*php php@paramphp php arrayphp php$filesphp php(Optionalphp)php Filesphp tophp returnphp thephp optionsphp for
php php php php php php*php php@returnphp arrayphp Optionsphp forphp givenphp files
php php php php php php*php/
php php php php publicphp functionphp getOptionsphp(php$filesphp php=php nullphp)php php{
php php php php php php php php php$filephp php=php php$thisphp-php>php_getFilesphp(php$filesphp,php falsephp,php truephp)php;

php php php php php php php php foreachphp php(php$filephp asphp php$keyphp php=php>php php$contentphp)php php{
php php php php php php php php php php php php ifphp php(issetphp(php$thisphp-php>php_filesphp[php$keyphp]php[php'optionsphp'php]php)php)php php{
php php php php php php php php php php php php php php php php php$optionsphp[php$keyphp]php php=php php$thisphp-php>php_filesphp[php$keyphp]php[php'optionsphp'php]php;
php php php php php php php php php php php php php}php elsephp php{
php php php php php php php php php php php php php php php php php$optionsphp[php$keyphp]php php=php arrayphp(php)php;
php php php php php php php php php php php php php}
php php php php php php php php php}

php php php php php php php php returnphp php$optionsphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Checksphp ifphp thephp filesphp arephp valid
php php php php php php*
php php php php php php*php php@paramphp php stringphp|arrayphp php$filesphp php(Optionalphp)php Filesphp tophp check
php php php php php php*php php@returnphp booleanphp Truephp ifphp allphp checksphp arephp valid
php php php php php php*php/
php php php php publicphp functionphp isValidphp(php$filesphp php=php nullphp)
php php php php php{
php php php php php php php php php$checkphp php=php php$thisphp-php>php_getFilesphp(php$filesphp,php falsephp,php truephp)php;
php php php php php php php php ifphp php(emptyphp(php$checkphp)php)php php{
php php php php php php php php php php php php returnphp falsephp;
php php php php php php php php php}

php php php php php php php php php$translatorphp php php php php php php=php php$thisphp-php>getTranslatorphp(php)php;
php php php php php php php php php$thisphp-php>php_messagesphp php=php arrayphp(php)php;
php php php php php php php php php$breakphp php php php php php php php php php php php=php falsephp;
php php php php php php php php foreachphp(php$checkphp asphp php$keyphp php=php>php php$contentphp)php php{
php php php php php php php php php php php php ifphp php(arrayphp_keyphp_existsphp(php'validatorsphp'php,php php$contentphp)php php&php&
php php php php php php php php php php php php php php php php inphp_arrayphp(php'Zendphp_Validatephp_Filephp_Countphp'php,php php$contentphp[php'validatorsphp'php]php)php)php php{
php php php php php php php php php php php php php php php php php$validatorphp php=php php$thisphp-php>php_validatorsphp[php'Zendphp_Validatephp_Filephp_Countphp'php]php;
php php php php php php php php php php php php php php php php php$countphp php php php php php=php php$contentphp;
php php php php php php php php php php php php php php php php ifphp php(emptyphp(php$contentphp[php'tmpphp_namephp'php]php)php)php php{
php php php php php php php php php php php php php php php php php php php php continuephp;
php php php php php php php php php php php php php php php php php}

php php php php php php php php php php php php php php php php ifphp php(arrayphp_keyphp_existsphp(php'destinationphp'php,php php$contentphp)php)php php{
php php php php php php php php php php php php php php php php php php php php php$checkitphp php=php php$contentphp[php'destinationphp'php]php;
php php php php php php php php php php php php php php php php php}php elsephp php{
php php php php php php php php php php php php php php php php php php php php php$checkitphp php=php dirnamephp(php$contentphp[php'tmpphp_namephp'php]php)php;
php php php php php php php php php php php php php php php php php}

php php php php php php php php php php php php php php php php php$checkitphp php.php=php DIRECTORYphp_SEPARATORphp php.php php$contentphp[php'namephp'php]php;
php php php php php php php php php php php php php php php php php php php php php$validatorphp-php>addFilephp(php$checkitphp)php;
php php php php php php php php php php php php php}
php php php php php php php php php}

php php php php php php php php ifphp php(issetphp(php$countphp)php)php php{
php php php php php php php php php php php php ifphp php(php!php$validatorphp-php>isValidphp(php$countphp[php'tmpphp_namephp'php]php,php php$countphp)php)php php{
php php php php php php php php php php php php php php php php php$thisphp-php>php_messagesphp php+php=php php$validatorphp-php>getMessagesphp(php)php;
php php php php php php php php php php php php php}
php php php php php php php php php}

php php php php php php php php foreachphp php(php$checkphp asphp php$keyphp php=php>php php$contentphp)php php{
php php php php php php php php php php php php php$fileerrorsphp php php=php arrayphp(php)php;
php php php php php php php php php php php php ifphp php(arrayphp_keyphp_existsphp(php'validatorsphp'php,php php$contentphp)php php&php&php php$contentphp[php'validatedphp'php]php)php php{
php php php php php php php php php php php php php php php php continuephp;
php php php php php php php php php php php php php}

php php php php php php php php php php php php ifphp php(arrayphp_keyphp_existsphp(php'validatorsphp'php,php php$contentphp)php)php php{
php php php php php php php php php php php php php php php php foreachphp php(php$contentphp[php'validatorsphp'php]php asphp php$classphp)php php{
php php php php php php php php php php php php php php php php php php php php php$validatorphp php=php php$thisphp-php>php_validatorsphp[php$classphp]php;
php php php php php php php php php php php php php php php php php php php php ifphp php(methodphp_existsphp(php$validatorphp,php php'setTranslatorphp'php)php)php php{
php php php php php php php php php php php php php php php php php php php php php php php php php$validatorphp-php>setTranslatorphp(php$translatorphp)php;
php php php php php php php php php php php php php php php php php php php php php}

php php php php php php php php php php php php php php php php php php php php ifphp php(php(php$classphp php=php=php=php php'Zendphp_Validatephp_Filephp_Uploadphp'php)php andphp php(emptyphp(php$contentphp[php'tmpphp_namephp'php]php)php)php)php php{
php php php php php php php php php php php php php php php php php php php php php php php php php$tocheckphp php=php php$keyphp;
php php php php php php php php php php php php php php php php php php php php php}php elsephp php{
php php php php php php php php php php php php php php php php php php php php php php php php php$tocheckphp php=php php$contentphp[php'tmpphp_namephp'php]php;
php php php php php php php php php php php php php php php php php php php php php}

php php php php php php php php php php php php php php php php php php php php ifphp php(php!php$validatorphp-php>isValidphp(php$tocheckphp,php php$contentphp)php)php php{
php php php php php php php php php php php php php php php php php php php php php php php php php$fileerrorsphp php+php=php php$validatorphp-php>getMessagesphp(php)php;
php php php php php php php php php php php php php php php php php php php php php}

php php php php php php php php php php php php php php php php php php php php ifphp php(php!emptyphp(php$contentphp[php'optionsphp'php]php[php'ignoreNoFilephp'php]php)php andphp php(issetphp(php$fileerrorsphp[php'fileUploadErrorNoFilephp'php]php)php)php)php php{
php php php php php php php php php php php php php php php php php php php php php php php php unsetphp(php$fileerrorsphp[php'fileUploadErrorNoFilephp'php]php)php;
php php php php php php php php php php php php php php php php php php php php php php php php breakphp;
php php php php php php php php php php php php php php php php php php php php php}

php php php php php php php php php php php php php php php php php php php php ifphp php(php(php$classphp php=php=php=php php'Zendphp_Validatephp_Filephp_Uploadphp'php)php andphp php(countphp(php$fileerrorsphp)php php>php php0php)php)php php{
php php php php php php php php php php php php php php php php php php php php php php php php breakphp;
php php php php php php php php php php php php php php php php php php php php php}

php php php php php php php php php php php php php php php php php php php php ifphp php(php(php$thisphp-php>php_breakphp[php$classphp]php)php andphp php(countphp(php$fileerrorsphp)php php>php php0php)php)php php{
php php php php php php php php php php php php php php php php php php php php php php php php php$breakphp php=php truephp;
php php php php php php php php php php php php php php php php php php php php php php php php breakphp;
php php php php php php php php php php php php php php php php php php php php php}
php php php php php php php php php php php php php php php php php}
php php php php php php php php php php php php php}

php php php php php php php php php php php php ifphp php(countphp(php$fileerrorsphp)php php>php php0php)php php{
php php php php php php php php php php php php php php php php php$thisphp-php>php_filesphp[php$keyphp]php[php'validatedphp'php]php php=php falsephp;
php php php php php php php php php php php php php}php elsephp php{
php php php php php php php php php php php php php php php php php$thisphp-php>php_filesphp[php$keyphp]php[php'validatedphp'php]php php=php truephp;
php php php php php php php php php php php php php}

php php php php php php php php php php php php php$thisphp-php>php_messagesphp php+php=php php$fileerrorsphp;
php php php php php php php php php php php php ifphp php(php$breakphp)php php{
php php php php php php php php php php php php php php php php breakphp;
php php php php php php php php php php php php php}
php php php php php php php php php}

php php php php php php php php ifphp php(countphp(php$thisphp-php>php_messagesphp)php php>php php0php)php php{
php php php php php php php php php php php php returnphp falsephp;
php php php php php php php php php}

php php php php php php php php returnphp truephp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Returnsphp foundphp validationphp messages
php php php php php php*
php php php php php php*php php@returnphp array
php php php php php php*php/
php php php php publicphp functionphp getMessagesphp(php)
php php php php php{
php php php php php php php php returnphp php$thisphp-php>php_messagesphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Retrievephp errorphp codes
php php php php php php*
php php php php php php*php php@returnphp array
php php php php php php*php/
php php php php publicphp functionphp getErrorsphp(php)
php php php php php{
php php php php php php php php returnphp arrayphp_keysphp(php$thisphp-php>php_messagesphp)php;
php php php php php}

php php php php php/php*php*
php php php php php php*php Arephp therephp errorsphp registeredphp?
php php php php php php*
php php php php php php*php php@returnphp boolean
php php php php php php*php/
php php php php publicphp functionphp hasErrorsphp(php)
php php php php php{
php php php php php php php php returnphp php(php!emptyphp(php$thisphp-php>php_messagesphp)php)php;
php php php php php}

php php php php php/php*php*
php php php php php php*php Addsphp aphp newphp filterphp forphp thisphp class
php php php php php php*
php php php php php php*php php@paramphp php stringphp|arrayphp php$filterphp Typephp ofphp filterphp tophp add
php php php php php php*php php@paramphp php stringphp|arrayphp php$optionsphp php php Optionsphp tophp setphp forphp thephp filter
php php php php php php*php php@paramphp php stringphp|arrayphp php$filesphp php php php php Filesphp tophp limitphp thisphp filterphp to
php php php php php php*php php@returnphp Zendphp_Filephp_Transferphp_Adapter
php php php php php php*php/
php php php php publicphp functionphp addFilterphp(php$filterphp,php php$optionsphp php=php nullphp,php php$filesphp php=php nullphp)
php php php php php{
php php php php php php php php ifphp php(php$filterphp instanceofphp Zendphp_Filterphp_Interfacephp)php php{
php php php php php php php php php php php php php$classphp php=php getphp_classphp(php$filterphp)php;
php php php php php php php php php}php elseifphp php(isphp_stringphp(php$filterphp)php)php php{
php php php php php php php php php php php php php$classphp php php=php php$thisphp-php>getPluginLoaderphp(selfphp:php:FILTERphp)php-php>loadphp(php$filterphp)php;
php php php php php php php php php php php php php$filterphp php=php newphp php$classphp(php$optionsphp)php;
php php php php php php php php php}php elsephp php{
php php php php php php php php php php php php requirephp_oncephp php'Zendphp/Filephp/Transferphp/Exceptionphp.phpphp'php;
php php php php php php php php php php php php throwphp newphp Zendphp_Filephp_Transferphp_Exceptionphp(php'Invalidphp filterphp specifiedphp'php)php;
php php php php php php php php php}

php php php php php php php php php$thisphp-php>php_filtersphp[php$classphp]php php=php php$filterphp;
php php php php php php php php php$filesphp php php php php php php php php php php php php php php php php php php=php php$thisphp-php>php_getFilesphp(php$filesphp,php truephp,php truephp)php;
php php php php php php php php foreachphp php(php$filesphp asphp php$filephp)php php{
php php php php php php php php php php php php php$thisphp-php>php_filesphp[php$filephp]php[php'filtersphp'php]php[php]php php=php php$classphp;
php php php php php php php php php}

php php php php php php php php returnphp php$thisphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Addphp Multiplephp filtersphp atphp once
php php php php php php*
php php php php php php*php php@paramphp php arrayphp php$filters
php php php php php php*php php@paramphp php stringphp|arrayphp php$files
php php php php php php*php php@returnphp Zendphp_Filephp_Transferphp_Adapterphp_Abstract
php php php php php php*php/
php php php php publicphp functionphp addFiltersphp(arrayphp php$filtersphp,php php$filesphp php=php nullphp)
php php php php php{
php php php php php php php php foreachphp php(php$filtersphp asphp php$keyphp php=php>php php$specphp)php php{
php php php php php php php php php php php php ifphp php(php$specphp instanceofphp Zendphp_Filterphp_Interfacephp)php php{
php php php php php php php php php php php php php php php php php$thisphp-php>addFilterphp(php$specphp,php nullphp,php php$filesphp)php;
php php php php php php php php php php php php php php php php continuephp;
php php php php php php php php php php php php php}

php php php php php php php php php php php php ifphp php(isphp_stringphp(php$keyphp)php)php php{
php php php php php php php php php php php php php php php php php$thisphp-php>addFilterphp(php$keyphp,php php$specphp,php php$filesphp)php;
php php php php php php php php php php php php php php php php continuephp;
php php php php php php php php php php php php php}

php php php php php php php php php php php php ifphp php(isphp_intphp(php$keyphp)php)php php{
php php php php php php php php php php php php php php php php ifphp php(isphp_stringphp(php$specphp)php)php php{
php php php php php php php php php php php php php php php php php php php php php$thisphp-php>addFilterphp(php$specphp,php nullphp,php php$filesphp)php;
php php php php php php php php php php php php php php php php php php php php continuephp;
php php php php php php php php php php php php php php php php php}

php php php php php php php php php php php php php php php php ifphp php(isphp_arrayphp(php$specphp)php)php php{
php php php php php php php php php php php php php php php php php php php php ifphp php(php!arrayphp_keyphp_existsphp(php'filterphp'php,php php$specphp)php)php php{
php php php php php php php php php php php php php php php php php php php php php php php php continuephp;
php php php php php php php php php php php php php php php php php php php php php}

php php php php php php php php php php php php php php php php php php php php php$filterphp php=php php$specphp[php'filterphp'php]php;
php php php php php php php php php php php php php php php php php php php php unsetphp(php$specphp[php'filterphp'php]php)php;
php php php php php php php php php php php php php php php php php php php php php$thisphp-php>addFilterphp(php$filterphp,php php$specphp,php php$filesphp)php;
php php php php php php php php php php php php php php php php php php php php continuephp;
php php php php php php php php php php php php php php php php php}

php php php php php php php php php php php php php php php php continuephp;
php php php php php php php php php php php php php}
php php php php php php php php php}

php php php php php php php php returnphp php$thisphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Setsphp aphp filterphp forphp thephp classphp,php erasingphp allphp previousphp set
php php php php php php*
php php php php php php*php php@paramphp php stringphp|arrayphp php$filterphp Filterphp tophp set
php php php php php php*php php@paramphp php stringphp|arrayphp php$filesphp php php php php Filesphp tophp limitphp thisphp filterphp to
php php php php php php*php php@returnphp Zendphp_Filephp_Transferphp_Adapter
php php php php php php*php/
php php php php publicphp functionphp setFiltersphp(arrayphp php$filtersphp,php php$filesphp php=php nullphp)
php php php php php{
php php php php php php php php php$thisphp-php>clearFiltersphp(php)php;
php php php php php php php php returnphp php$thisphp-php>addFiltersphp(php$filtersphp,php php$filesphp)php;
php php php php php}

php php php php php/php*php*
php php php php php php*php Determinephp ifphp aphp givenphp filterphp hasphp alreadyphp beenphp registered
php php php php php php*
php php php php php php*php php@paramphp php stringphp php$name
php php php php php php*php php@returnphp bool
php php php php php php*php/
php php php php publicphp functionphp hasFilterphp(php$namephp)
php php php php php{
php php php php php php php php returnphp php(falsephp php!php=php=php php$thisphp-php>php_getFilterIdentifierphp(php$namephp)php)php;
php php php php php}

php php php php php/php*php*
php php php php php php*php Retrievephp individualphp filter
php php php php php php*
php php php php php php*php php@paramphp php stringphp php$name
php php php php php php*php php@returnphp Zendphp_Filterphp_Interfacephp|null
php php php php php php*php/
php php php php publicphp functionphp getFilterphp(php$namephp)
php php php php php{
php php php php php php php php ifphp php(falsephp php=php=php=php php(php$identifierphp php=php php$thisphp-php>php_getFilterIdentifierphp(php$namephp)php)php)php php{
php php php php php php php php php php php php returnphp nullphp;
php php php php php php php php php}
php php php php php php php php returnphp php$thisphp-php>php_filtersphp[php$identifierphp]php;
php php php php php}

php php php php php/php*php*
php php php php php php*php Returnsphp allphp setphp filters
php php php php php php*
php php php php php php*php php@paramphp php stringphp|arrayphp php$filesphp php(Optionalphp)php Returnsphp thephp filterphp forphp thisphp files
php php php php php php*php php@returnphp arrayphp Listphp ofphp setphp filters
php php php php php php*php php@throwsphp Zendphp_Filephp_Transferphp_Exceptionphp Whenphp filephp notphp found
php php php php php php*php/
php php php php publicphp functionphp getFiltersphp(php$filesphp php=php nullphp)
php php php php php{
php php php php php php php php ifphp php(php$filesphp php=php=php=php nullphp)php php{
php php php php php php php php php php php php returnphp php$thisphp-php>php_filtersphp;
php php php php php php php php php}

php php php php php php php php php$filesphp php php php=php php$thisphp-php>php_getFilesphp(php$filesphp,php truephp,php truephp)php;
php php php php php php php php php$filtersphp php=php arrayphp(php)php;
php php php php php php php php foreachphp php(php$filesphp asphp php$filephp)php php{
php php php php php php php php php php php php ifphp php(php!emptyphp(php$thisphp-php>php_filesphp[php$filephp]php[php'filtersphp'php]php)php)php php{
php php php php php php php php php php php php php php php php php$filtersphp php+php=php php$thisphp-php>php_filesphp[php$filephp]php[php'filtersphp'php]php;
php php php php php php php php php php php php php}
php php php php php php php php php}

php php php php php php php php php$filtersphp php=php arrayphp_uniquephp(php$filtersphp)php;
php php php php php php php php php$resultphp php php=php arrayphp(php)php;
php php php php php php php php foreachphp php(php$filtersphp asphp php$filterphp)php php{
php php php php php php php php php php php php php$resultphp[php]php php=php php$thisphp-php>php_filtersphp[php$filterphp]php;
php php php php php php php php php}

php php php php php php php php returnphp php$resultphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Removephp anphp individualphp filter
php php php php php php*
php php php php php php*php php@paramphp php stringphp php$name
php php php php php php*php php@returnphp Zendphp_Filephp_Transferphp_Adapterphp_Abstract
php php php php php php*php/
php php php php publicphp functionphp removeFilterphp(php$namephp)
php php php php php{
php php php php php php php php ifphp php(falsephp php=php=php=php php(php$keyphp php=php php$thisphp-php>php_getFilterIdentifierphp(php$namephp)php)php)php php{
php php php php php php php php php php php php returnphp php$thisphp;
php php php php php php php php php}

php php php php php php php php unsetphp(php$thisphp-php>php_filtersphp[php$keyphp]php)php;
php php php php php php php php foreachphp php(arrayphp_keysphp(php$thisphp-php>php_filesphp)php asphp php$filephp)php php{
php php php php php php php php php php php php ifphp php(emptyphp(php$thisphp-php>php_filesphp[php$filephp]php[php'filtersphp'php]php)php)php php{
php php php php php php php php php php php php php php php php continuephp;
php php php php php php php php php php php php php}

php php php php php php php php php php php php php$indexphp php=php arrayphp_searchphp(php$keyphp,php php$thisphp-php>php_filesphp[php$filephp]php[php'filtersphp'php]php)php;
php php php php php php php php php php php php ifphp php(php$indexphp php=php=php=php falsephp)php php{
php php php php php php php php php php php php php php php php continuephp;
php php php php php php php php php php php php php}

php php php php php php php php php php php php unsetphp(php$thisphp-php>php_filesphp[php$filephp]php[php'filtersphp'php]php[php$indexphp]php)php;
php php php php php php php php php}
php php php php php php php php returnphp php$thisphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Removephp allphp filters
php php php php php php*
php php php php php php*php php@returnphp Zendphp_Filephp_Transferphp_Adapterphp_Abstract
php php php php php php*php/
php php php php publicphp functionphp clearFiltersphp(php)
php php php php php{
php php php php php php php php php$thisphp-php>php_filtersphp php=php arrayphp(php)php;
php php php php php php php php foreachphp php(arrayphp_keysphp(php$thisphp-php>php_filesphp)php asphp php$filephp)php php{
php php php php php php php php php php php php php$thisphp-php>php_filesphp[php$filephp]php[php'filtersphp'php]php php=php arrayphp(php)php;
php php php php php php php php php}
php php php php php php php php returnphp php$thisphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Returnsphp allphp setphp files
php php php php php php*
php php php php php php*php php@returnphp arrayphp Listphp ofphp setphp files
php php php php php php*php php@throwsphp Zendphp_Filephp_Transferphp_Exceptionphp Notphp implemented
php php php php php php*php/
php php php php publicphp functionphp getFilephp(php)
php php php php php{
php php php php php php php php requirephp_oncephp php'Zendphp/Filephp/Transferphp/Exceptionphp.phpphp'php;
php php php php php php php php throwphp newphp Zendphp_Filephp_Transferphp_Exceptionphp(php'Methodphp notphp implementedphp'php)php;
php php php php php}

php php php php php/php*php*
php php php php php php*php Retrievesphp thephp filenamephp ofphp transferredphp filesphp.
php php php php php php*
php php php php php php*php php@paramphp php stringphp php php$fileelementphp php(Optionalphp)php Elementphp tophp returnphp thephp filenamephp for
php php php php php php*php php@paramphp php booleanphp php$pathphp php php php php php php php php(Optionalphp)php Shouldphp thephp pathphp alsophp bephp returnedphp php?
php php php php php php*php php@returnphp stringphp|array
php php php php php php*php/
php php php php publicphp functionphp getFileNamephp(php$filephp php=php nullphp,php php$pathphp php=php truephp)
php php php php php{
php php php php php php php php php$filesphp php php php php php=php php$thisphp-php>php_getFilesphp(php$filephp,php truephp,php truephp)php;
php php php php php php php php php$resultphp php php php php=php arrayphp(php)php;
php php php php php php php php php$directoryphp php=php php"php"php;
php php php php php php php php foreachphp(php$filesphp asphp php$filephp)php php{
php php php php php php php php php php php php ifphp php(emptyphp(php$thisphp-php>php_filesphp[php$filephp]php[php'namephp'php]php)php)php php{
php php php php php php php php php php php php php php php php continuephp;
php php php php php php php php php php php php php}

php php php php php php php php php php php php ifphp php(php$pathphp php=php=php=php truephp)php php{
php php php php php php php php php php php php php php php php php$directoryphp php=php php$thisphp-php>getDestinationphp(php$filephp)php php.php DIRECTORYphp_SEPARATORphp;
php php php php php php php php php php php php php}

php php php php php php php php php php php php php$resultphp[php$filephp]php php=php php$directoryphp php.php php$thisphp-php>php_filesphp[php$filephp]php[php'namephp'php]php;
php php php php php php php php php}

php php php php php php php php ifphp php(countphp(php$resultphp)php php=php=php php1php)php php{
php php php php php php php php php php php php returnphp currentphp(php$resultphp)php;
php php php php php php php php php}

php php php php php php php php returnphp php$resultphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Retrievephp additionalphp internalphp filephp informationsphp forphp files
php php php php php php*
php php php php php php*php php@paramphp php stringphp php$filephp php(Optionalphp)php Filephp tophp getphp informationsphp for
php php php php php php*php php@returnphp array
php php php php php php*php/
php php php php publicphp functionphp getFileInfophp(php$filephp php=php nullphp)
php php php php php{
php php php php php php php php returnphp php$thisphp-php>php_getFilesphp(php$filephp)php;
php php php php php}

php php php php php/php*php*
php php php php php php*php Addsphp onephp orphp morephp files
php php php php php php*
php php php php php php*php php@paramphp php stringphp|arrayphp php$filephp php php php php php Filephp tophp add
php php php php php php*php php@paramphp php stringphp|arrayphp php$validatorphp Validatorsphp tophp usephp forphp thisphp filephp,php mustphp bephp setphp before
php php php php php php*php php@paramphp php stringphp|arrayphp php$filterphp php php php Filtersphp tophp usephp forphp thisphp filephp,php mustphp bephp setphp before
php php php php php php*php php@returnphp Zendphp_Filephp_Transferphp_Adapterphp_Abstract
php php php php php php*php php@throwsphp Zendphp_Filephp_Transferphp_Exceptionphp Notphp implemented
php php php php php php*php/
php php php php publicphp functionphp addFilephp(php$filephp,php php$validatorphp php=php nullphp,php php$filterphp php=php nullphp)
php php php php php{
php php php php php php php php requirephp_oncephp php'Zendphp/Filephp/Transferphp/Exceptionphp.phpphp'php;
php php php php php php php php throwphp newphp Zendphp_Filephp_Transferphp_Exceptionphp(php'Methodphp notphp implementedphp'php)php;
php php php php php}

php php php php php/php*php*
php php php php php php*php Returnsphp allphp setphp types
php php php php php php*
php php php php php php*php php@returnphp arrayphp Listphp ofphp setphp types
php php php php php php*php php@throwsphp Zendphp_Filephp_Transferphp_Exceptionphp Notphp implemented
php php php php php php*php/
php php php php publicphp functionphp getTypephp(php)
php php php php php{
php php php php php php php php requirephp_oncephp php'Zendphp/Filephp/Transferphp/Exceptionphp.phpphp'php;
php php php php php php php php throwphp newphp Zendphp_Filephp_Transferphp_Exceptionphp(php'Methodphp notphp implementedphp'php)php;
php php php php php}

php php php php php/php*php*
php php php php php php*php Addsphp onephp orphp morephp typephp ofphp files
php php php php php php*
php php php php php php*php php@paramphp php stringphp|arrayphp php$typephp Typephp ofphp filesphp tophp add
php php php php php php*php php@paramphp php stringphp|arrayphp php$validatorphp Validatorsphp tophp usephp forphp thisphp filephp,php mustphp bephp setphp before
php php php php php php*php php@paramphp php stringphp|arrayphp php$filterphp php php php Filtersphp tophp usephp forphp thisphp filephp,php mustphp bephp setphp before
php php php php php php*php php@returnphp Zendphp_Filephp_Transferphp_Adapterphp_Abstract
php php php php php php*php php@throwsphp Zendphp_Filephp_Transferphp_Exceptionphp Notphp implemented
php php php php php php*php/
php php php php publicphp functionphp addTypephp(php$typephp,php php$validatorphp php=php nullphp,php php$filterphp php=php nullphp)
php php php php php{
php php php php php php php php requirephp_oncephp php'Zendphp/Filephp/Transferphp/Exceptionphp.phpphp'php;
php php php php php php php php throwphp newphp Zendphp_Filephp_Transferphp_Exceptionphp(php'Methodphp notphp implementedphp'php)php;
php php php php php}

php php php php php/php*php*
php php php php php php*php Setsphp aphp newphp destinationphp forphp thephp givenphp files
php php php php php php*
php php php php php php*php php@deprecatedphp Willphp bephp changedphp tophp bephp aphp filterphp!php!php!
php php php php php php*php php@paramphp php stringphp php php php php php php php$destinationphp Newphp destinationphp directory
php php php php php php*php php@paramphp php stringphp|arrayphp php$filesphp php php php php php php Filesphp tophp setphp thephp newphp destinationphp for
php php php php php php*php php@returnphp Zendphp_Filephp_Transferphp_Abstract
php php php php php php*php php@throwsphp Zendphp_Filephp_Transferphp_Exceptionphp whenphp thephp givenphp destinationphp isphp notphp aphp directoryphp orphp doesphp notphp exist
php php php php php php*php/
php php php php publicphp functionphp setDestinationphp(php$destinationphp,php php$filesphp php=php nullphp)
php php php php php{
php php php php php php php php php$origphp php=php php$filesphp;
php php php php php php php php php$destinationphp php=php rtrimphp(php$destinationphp,php php"php/php\php\php"php)php;
php php php php php php php php ifphp php(php!isphp_dirphp(php$destinationphp)php)php php{
php php php php php php php php php php php php requirephp_oncephp php'Zendphp/Filephp/Transferphp/Exceptionphp.phpphp'php;
php php php php php php php php php php php php throwphp newphp Zendphp_Filephp_Transferphp_Exceptionphp(php'Thephp givenphp destinationphp isphp notphp aphp directoryphp orphp doesphp notphp existphp'php)php;
php php php php php php php php php}

php php php php php php php php ifphp php(php!isphp_writablephp(php$destinationphp)php)php php{
php php php php php php php php php php php php requirephp_oncephp php'Zendphp/Filephp/Transferphp/Exceptionphp.phpphp'php;
php php php php php php php php php php php php throwphp newphp Zendphp_Filephp_Transferphp_Exceptionphp(php'Thephp givenphp destinationphp isphp notphp writeablephp'php)php;
php php php php php php php php php}

php php php php php php php php ifphp php(php$filesphp php=php=php=php nullphp)php php{
php php php php php php php php php php php php foreachphp php(php$thisphp-php>php_filesphp asphp php$filephp php=php>php php$contentphp)php php{
php php php php php php php php php php php php php php php php php$thisphp-php>php_filesphp[php$filephp]php[php'destinationphp'php]php php=php php$destinationphp;
php php php php php php php php php php php php php}
php php php php php php php php php}php elsephp php{
php php php php php php php php php php php php php$filesphp php=php php$thisphp-php>php_getFilesphp(php$filesphp,php truephp,php truephp)php;
php php php php php php php php php php php php ifphp php(emptyphp(php$filesphp)php andphp isphp_stringphp(php$origphp)php)php php{
php php php php php php php php php php php php php php php php php$thisphp-php>php_filesphp[php$origphp]php[php'destinationphp'php]php php=php php$destinationphp;
php php php php php php php php php php php php php}

php php php php php php php php php php php php foreachphp php(php$filesphp asphp php$filephp)php php{
php php php php php php php php php php php php php php php php php$thisphp-php>php_filesphp[php$filephp]php[php'destinationphp'php]php php=php php$destinationphp;
php php php php php php php php php php php php php}
php php php php php php php php php}

php php php php php php php php returnphp php$thisphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Retrievephp destinationphp directoryphp value
php php php php php php*
php php php php php php*php php@paramphp php nullphp|stringphp|arrayphp php$files
php php php php php php*php php@returnphp nullphp|stringphp|array
php php php php php php*php/
php php php php publicphp functionphp getDestinationphp(php$filesphp php=php nullphp)
php php php php php{
php php php php php php php php php$origphp php php=php php$filesphp;
php php php php php php php php php$filesphp php=php php$thisphp-php>php_getFilesphp(php$filesphp,php falsephp,php truephp)php;
php php php php php php php php php$destinationsphp php=php arrayphp(php)php;
php php php php php php php php ifphp php(emptyphp(php$filesphp)php andphp isphp_stringphp(php$origphp)php)php php{
php php php php php php php php php php php php ifphp php(issetphp(php$thisphp-php>php_filesphp[php$origphp]php[php'destinationphp'php]php)php)php php{
php php php php php php php php php php php php php php php php php$destinationsphp[php$origphp]php php=php php$thisphp-php>php_filesphp[php$origphp]php[php'destinationphp'php]php;
php php php php php php php php php php php php php}php elsephp php{
php php php php php php php php php php php php php php php php requirephp_oncephp php'Zendphp/Filephp/Transferphp/Exceptionphp.phpphp'php;
php php php php php php php php php php php php php php php php throwphp newphp Zendphp_Filephp_Transferphp_Exceptionphp(sprintfphp(php'Thephp filephp transferphp adapterphp canphp notphp findphp php"php%sphp"php'php,php php$origphp)php)php;
php php php php php php php php php php php php php}
php php php php php php php php php}

php php php php php php php php foreachphp php(php$filesphp asphp php$keyphp php=php>php php$contentphp)php php{
php php php php php php php php php php php php ifphp php(issetphp(php$thisphp-php>php_filesphp[php$keyphp]php[php'destinationphp'php]php)php)php php{
php php php php php php php php php php php php php php php php php$destinationsphp[php$keyphp]php php=php php$thisphp-php>php_filesphp[php$keyphp]php[php'destinationphp'php]php;
php php php php php php php php php php php php php}php elsephp php{
php php php php php php php php php php php php php php php php php$tmpdirphp php=php php$thisphp-php>php_getTmpDirphp(php)php;
php php php php php php php php php php php php php php php php php$thisphp-php>setDestinationphp(php$tmpdirphp,php php$keyphp)php;
php php php php php php php php php php php php php php php php php$destinationsphp[php$keyphp]php php=php php$tmpdirphp;
php php php php php php php php php php php php php}
php php php php php php php php php}

php php php php php php php php ifphp php(emptyphp(php$destinationsphp)php)php php{
php php php php php php php php php php php php php$destinationsphp php=php php$thisphp-php>php_getTmpDirphp(php)php;
php php php php php php php php php}php elsephp ifphp php(countphp(php$destinationsphp)php php=php=php php1php)php php{
php php php php php php php php php php php php php$destinationsphp php=php currentphp(php$destinationsphp)php;
php php php php php php php php php}

php php php php php php php php returnphp php$destinationsphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Setphp translatorphp objectphp forphp localization
php php php php php php*
php php php php php php*php php@paramphp php Zendphp_Translatephp|nullphp php$translator
php php php php php php*php php@returnphp Zendphp_Filephp_Transferphp_Abstract
php php php php php php*php/
php php php php publicphp functionphp setTranslatorphp(php$translatorphp php=php nullphp)
php php php php php{
php php php php php php php php ifphp php(nullphp php=php=php=php php$translatorphp)php php{
php php php php php php php php php php php php php$thisphp-php>php_translatorphp php=php nullphp;
php php php php php php php php php}php elseifphp php(php$translatorphp instanceofphp Zendphp_Translatephp_Adapterphp)php php{
php php php php php php php php php php php php php$thisphp-php>php_translatorphp php=php php$translatorphp;
php php php php php php php php php}php elseifphp php(php$translatorphp instanceofphp Zendphp_Translatephp)php php{
php php php php php php php php php php php php php$thisphp-php>php_translatorphp php=php php$translatorphp-php>getAdapterphp(php)php;
php php php php php php php php php}php elsephp php{
php php php php php php php php php php php php requirephp_oncephp php'Zendphp/Filephp/Transferphp/Exceptionphp.phpphp'php;
php php php php php php php php php php php php throwphp newphp Zendphp_Filephp_Transferphp_Exceptionphp(php'Invalidphp translatorphp specifiedphp'php)php;
php php php php php php php php php}

php php php php php php php php returnphp php$thisphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Retrievephp localizationphp translatorphp object
php php php php php php*
php php php php php php*php php@returnphp Zendphp_Translatephp_Adapterphp|null
php php php php php php*php/
php php php php publicphp functionphp getTranslatorphp(php)
php php php php php{
php php php php php php php php ifphp php(php$thisphp-php>translatorIsDisabledphp(php)php)php php{
php php php php php php php php php php php php returnphp nullphp;
php php php php php php php php php}

php php php php php php php php returnphp php$thisphp-php>php_translatorphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Indicatephp whetherphp orphp notphp translationphp shouldphp bephp disabled
php php php php php php*
php php php php php php*php php@paramphp php boolphp php$flag
php php php php php php*php php@returnphp Zendphp_Filephp_Transferphp_Abstract
php php php php php php*php/
php php php php publicphp functionphp setDisableTranslatorphp(php$flagphp)
php php php php php{
php php php php php php php php php$thisphp-php>php_translatorDisabledphp php=php php(boolphp)php php$flagphp;
php php php php php php php php returnphp php$thisphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Isphp translationphp disabledphp?
php php php php php php*
php php php php php php*php php@returnphp bool
php php php php php php*php/
php php php php publicphp functionphp translatorIsDisabledphp(php)
php php php php php{
php php php php php php php php returnphp php$thisphp-php>php_translatorDisabledphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Returnsphp thephp hashphp forphp aphp givenphp file
php php php php php php*
php php php php php php*php php@paramphp php stringphp php php php php php php php$hashphp php Hashphp algorithmphp tophp use
php php php php php php*php php@paramphp php stringphp|arrayphp php$filesphp Filesphp tophp returnphp thephp hashphp for
php php php php php php*php php@returnphp stringphp|arrayphp Hashstring
php php php php php php*php php@throwsphp Zendphp_Filephp_Transferphp_Exceptionphp Onphp unknownphp hashphp algorithm
php php php php php php*php/
php php php php publicphp functionphp getHashphp(php$hashphp php=php php'crcphp3php2php'php,php php$filesphp php=php nullphp)
php php php php php{
php php php php php php php php ifphp php(php!inphp_arrayphp(php$hashphp,php hashphp_algosphp(php)php)php)php php{
php php php php php php php php php php php php requirephp_oncephp php'Zendphp/Filephp/Transferphp/Exceptionphp.phpphp'php;
php php php php php php php php php php php php throwphp newphp Zendphp_Filephp_Transferphp_Exceptionphp(php'Unknownphp hashphp algorithmphp'php)php;
php php php php php php php php php}

php php php php php php php php php$filesphp php php=php php$thisphp-php>php_getFilesphp(php$filesphp)php;
php php php php php php php php php$resultphp php=php arrayphp(php)php;
php php php php php php php php foreachphp(php$filesphp asphp php$keyphp php=php>php php$valuephp)php php{
php php php php php php php php php php php php ifphp php(filephp_existsphp(php$valuephp[php'namephp'php]php)php)php php{
php php php php php php php php php php php php php php php php php$resultphp[php$keyphp]php php=php hashphp_filephp(php$hashphp,php php$valuephp[php'namephp'php]php)php;
php php php php php php php php php php php php php}php elsephp ifphp php(filephp_existsphp(php$valuephp[php'tmpphp_namephp'php]php)php)php php{
php php php php php php php php php php php php php php php php php$resultphp[php$keyphp]php php=php hashphp_filephp(php$hashphp,php php$valuephp[php'tmpphp_namephp'php]php)php;
php php php php php php php php php php php php php}php elsephp ifphp php(emptyphp(php$valuephp[php'optionsphp'php]php[php'ignoreNoFilephp'php]php)php)php php{
php php php php php php php php php php php php php php php php requirephp_oncephp php'Zendphp/Filephp/Transferphp/Exceptionphp.phpphp'php;
php php php php php php php php php php php php php php php php throwphp newphp Zendphp_Filephp_Transferphp_Exceptionphp(php"Thephp filephp php'php{php$valuephp[php'namephp'php]php}php'php doesphp notphp existphp"php)php;
php php php php php php php php php php php php php}
php php php php php php php php php}

php php php php php php php php ifphp php(countphp(php$resultphp)php php=php=php php1php)php php{
php php php php php php php php php php php php returnphp currentphp(php$resultphp)php;
php php php php php php php php php}

php php php php php php php php returnphp php$resultphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Returnsphp thephp realphp filesizephp ofphp thephp file
php php php php php php*
php php php php php php*php php@paramphp stringphp|arrayphp php$filesphp Filesphp tophp getphp thephp filesizephp from
php php php php php php*php php@throwsphp Zendphp_Filephp_Transferphp_Exceptionphp Whenphp thephp filephp doesphp notphp exist
php php php php php php*php php@returnphp stringphp|arrayphp Filesize
php php php php php php*php/
php php php php publicphp functionphp getFileSizephp(php$filesphp php=php nullphp)
php php php php php{
php php php php php php php php php$filesphp php php=php php$thisphp-php>php_getFilesphp(php$filesphp)php;
php php php php php php php php php$resultphp php=php arrayphp(php)php;
php php php php php php php php foreachphp(php$filesphp asphp php$keyphp php=php>php php$valuephp)php php{
php php php php php php php php php php php php ifphp php(filephp_existsphp(php$valuephp[php'namephp'php]php)php php|php|php filephp_existsphp(php$valuephp[php'tmpphp_namephp'php]php)php)php php{
php php php php php php php php php php php php php php php php ifphp php(php$valuephp[php'optionsphp'php]php[php'useByteStringphp'php]php)php php{
php php php php php php php php php php php php php php php php php php php php php$resultphp[php$keyphp]php php=php selfphp:php:php_toByteStringphp(php$valuephp[php'sizephp'php]php)php;
php php php php php php php php php php php php php php php php php}php elsephp php{
php php php php php php php php php php php php php php php php php php php php php$resultphp[php$keyphp]php php=php php$valuephp[php'sizephp'php]php;
php php php php php php php php php php php php php php php php php}
php php php php php php php php php php php php php}php elsephp ifphp php(emptyphp(php$valuephp[php'optionsphp'php]php[php'ignoreNoFilephp'php]php)php)php php{
php php php php php php php php php php php php php php php php requirephp_oncephp php'Zendphp/Filephp/Transferphp/Exceptionphp.phpphp'php;
php php php php php php php php php php php php php php php php throwphp newphp Zendphp_Filephp_Transferphp_Exceptionphp(php"Thephp filephp php'php{php$valuephp[php'namephp'php]php}php'php doesphp notphp existphp"php)php;
php php php php php php php php php php php php php}php elsephp php{
php php php php php php php php php php php php php php php php continuephp;
php php php php php php php php php php php php php}
php php php php php php php php php}

php php php php php php php php ifphp php(countphp(php$resultphp)php php=php=php php1php)php php{
php php php php php php php php php php php php returnphp currentphp(php$resultphp)php;
php php php php php php php php php}

php php php php php php php php returnphp php$resultphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Internalphp methodphp tophp detectphp thephp sizephp ofphp aphp file
php php php php php php*
php php php php php php*php php@paramphp php arrayphp php$valuephp Filephp infos
php php php php php php*php php@returnphp stringphp Filesizephp ofphp givenphp file
php php php php php php*php/
php php php php protectedphp functionphp php_detectFileSizephp(php$valuephp)
php php php php php{
php php php php php php php php ifphp php(filephp_existsphp(php$valuephp[php'namephp'php]php)php)php php{
php php php php php php php php php php php php php$resultphp php=php sprintfphp(php"php%uphp"php,php php@filesizephp(php$valuephp[php'namephp'php]php)php)php;
php php php php php php php php php}php elsephp ifphp php(filephp_existsphp(php$valuephp[php'tmpphp_namephp'php]php)php)php php{
php php php php php php php php php php php php php$resultphp php=php sprintfphp(php"php%uphp"php,php php@filesizephp(php$valuephp[php'tmpphp_namephp'php]php)php)php;
php php php php php php php php php}php elsephp php{
php php php php php php php php php php php php returnphp nullphp;
php php php php php php php php php}

php php php php php php php php returnphp php$resultphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Returnsphp thephp realphp mimetypephp ofphp thephp file
php php php php php php*php Usesphp fileinfophp,php whenphp notphp availablephp mimephp_magicphp andphp asphp lastphp fallbackphp aphp manualphp givenphp mimetype
php php php php php php*
php php php php php php*php php@paramphp stringphp|arrayphp php$filesphp Filesphp tophp getphp thephp mimetypephp from
php php php php php php*php php@throwsphp Zendphp_Filephp_Transferphp_Exceptionphp Whenphp thephp filephp doesphp notphp exist
php php php php php php*php php@returnphp stringphp|arrayphp MimeType
php php php php php php*php/
php php php php publicphp functionphp getMimeTypephp(php$filesphp php=php nullphp)
php php php php php{
php php php php php php php php php$filesphp php php=php php$thisphp-php>php_getFilesphp(php$filesphp)php;
php php php php php php php php php$resultphp php=php arrayphp(php)php;
php php php php php php php php foreachphp(php$filesphp asphp php$keyphp php=php>php php$valuephp)php php{
php php php php php php php php php php php php ifphp php(filephp_existsphp(php$valuephp[php'namephp'php]php)php php|php|php filephp_existsphp(php$valuephp[php'tmpphp_namephp'php]php)php)php php{
php php php php php php php php php php php php php php php php php$resultphp[php$keyphp]php php=php php$valuephp[php'typephp'php]php;
php php php php php php php php php php php php php}php elsephp ifphp php(emptyphp(php$valuephp[php'optionsphp'php]php[php'ignoreNoFilephp'php]php)php)php php{
php php php php php php php php php php php php php php php php requirephp_oncephp php'Zendphp/Filephp/Transferphp/Exceptionphp.phpphp'php;
php php php php php php php php php php php php php php php php throwphp newphp Zendphp_Filephp_Transferphp_Exceptionphp(php"Thephp filephp php'php{php$valuephp[php'namephp'php]php}php'php doesphp notphp existphp"php)php;
php php php php php php php php php php php php php}php elsephp php{
php php php php php php php php php php php php php php php php continuephp;
php php php php php php php php php php php php php}
php php php php php php php php php}

php php php php php php php php ifphp php(countphp(php$resultphp)php php=php=php php1php)php php{
php php php php php php php php php php php php returnphp currentphp(php$resultphp)php;
php php php php php php php php php}

php php php php php php php php returnphp php$resultphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Internalphp methodphp tophp detectphp thephp mimephp typephp ofphp aphp file
php php php php php php*
php php php php php php*php php@paramphp php arrayphp php$valuephp Filephp infos
php php php php php php*php php@returnphp stringphp Mimetypephp ofphp givenphp file
php php php php php php*php/
php php php php protectedphp functionphp php_detectMimeTypephp(php$valuephp)
php php php php php{
php php php php php php php php ifphp php(filephp_existsphp(php$valuephp[php'namephp'php]php)php)php php{
php php php php php php php php php php php php php$filephp php=php php$valuephp[php'namephp'php]php;
php php php php php php php php php}php elsephp ifphp php(filephp_existsphp(php$valuephp[php'tmpphp_namephp'php]php)php)php php{
php php php php php php php php php php php php php$filephp php=php php$valuephp[php'tmpphp_namephp'php]php;
php php php php php php php php php}php elsephp php{
php php php php php php php php php php php php returnphp nullphp;
php php php php php php php php php}

php php php php php php php php ifphp php(classphp_existsphp(php'finfophp'php,php falsephp)php)php php{
php php php php php php php php php php php php php$constphp php=php definedphp(php'FILEINFOphp_MIMEphp_TYPEphp'php)php php?php FILEINFOphp_MIMEphp_TYPEphp php:php FILEINFOphp_MIMEphp;
php php php php php php php php php php php php ifphp php(php!emptyphp(php$valuephp[php'optionsphp'php]php[php'magicFilephp'php]php)php)php php{
php php php php php php php php php php php php php php php php php$mimephp php=php php@finfophp_openphp(php$constphp,php php$valuephp[php'optionsphp'php]php[php'magicFilephp'php]php)php;
php php php php php php php php php php php php php}

php php php php php php php php php php php php ifphp php(emptyphp(php$mimephp)php)php php{
php php php php php php php php php php php php php php php php php$mimephp php=php php@finfophp_openphp(php$constphp)php;
php php php php php php php php php php php php php}

php php php php php php php php php php php php ifphp php(php!emptyphp(php$mimephp)php)php php{
php php php php php php php php php php php php php php php php php$resultphp php=php finfophp_filephp(php$mimephp,php php$filephp)php;
php php php php php php php php php php php php php}

php php php php php php php php php php php php unsetphp(php$mimephp)php;
php php php php php php php php php}

php php php php php php php php ifphp php(emptyphp(php$resultphp)php php&php&php php(functionphp_existsphp(php'mimephp_contentphp_typephp'php)
php php php php php php php php php php php php php&php&php iniphp_getphp(php'mimephp_magicphp.magicfilephp'php)php)php)php php{
php php php php php php php php php php php php php$resultphp php=php mimephp_contentphp_typephp(php$filephp)php;
php php php php php php php php php}

php php php php php php php php ifphp php(emptyphp(php$resultphp)php)php php{
php php php php php php php php php php php php php$resultphp php=php php'applicationphp/octetphp-streamphp'php;
php php php php php php php php php}

php php php php php php php php returnphp php$resultphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Returnsphp thephp formattedphp size
php php php php php php*
php php php php php php*php php@paramphp php integerphp php$size
php php php php php php*php php@returnphp string
php php php php php php*php/
php php php php protectedphp staticphp functionphp php_toByteStringphp(php$sizephp)
php php php php php{
php php php php php php php php php$sizesphp php=php arrayphp(php'Bphp'php,php php'kBphp'php,php php'MBphp'php,php php'GBphp'php,php php'TBphp'php,php php'PBphp'php,php php'EBphp'php,php php'ZBphp'php,php php'YBphp'php)php;
php php php php php php php php forphp php(php$iphp=php0php;php php$sizephp php>php=php php1php0php2php4php php&php&php php$iphp <php php9php;php php$iphp+php+php)php php{
php php php php php php php php php php php php php$sizephp php/php=php php1php0php2php4php;
php php php php php php php php php}

php php php php php php php php returnphp roundphp(php$sizephp,php php2php)php php.php php$sizesphp[php$iphp]php;
php php php php php}

php php php php php/php*php*
php php php php php php*php Internalphp functionphp tophp filterphp allphp givenphp files
php php php php php php*
php php php php php php*php php@paramphp php stringphp|arrayphp php$filesphp php(Optionalphp)php Filesphp tophp check
php php php php php php*php php@returnphp booleanphp Falsephp onphp error
php php php php php php*php/
php php php php protectedphp functionphp php_filterphp(php$filesphp php=php nullphp)
php php php php php{
php php php php php php php php php$checkphp php php php php php php php php php php php=php php$thisphp-php>php_getFilesphp(php$filesphp)php;
php php php php php php php php foreachphp php(php$checkphp asphp php$namephp php=php>php php$contentphp)php php{
php php php php php php php php php php php php ifphp php(arrayphp_keyphp_existsphp(php'filtersphp'php,php php$contentphp)php)php php{
php php php php php php php php php php php php php php php php foreachphp php(php$contentphp[php'filtersphp'php]php asphp php$classphp)php php{
php php php php php php php php php php php php php php php php php php php php php$filterphp php=php php$thisphp-php>php_filtersphp[php$classphp]php;
php php php php php php php php php php php php php php php php php php php php tryphp php{
php php php php php php php php php php php php php php php php php php php php php php php php php$resultphp php=php php$filterphp-php>filterphp(php$thisphp-php>getFileNamephp(php$namephp)php)php;

php php php php php php php php php php php php php php php php php php php php php php php php php$thisphp-php>php_filesphp[php$namephp]php[php'destinationphp'php]php php=php dirnamephp(php$resultphp)php;
php php php php php php php php php php php php php php php php php php php php php php php php php$thisphp-php>php_filesphp[php$namephp]php[php'namephp'php]php php php php php php php php php=php basenamephp(php$resultphp)php;
php php php php php php php php php php php php php php php php php php php php php}php catchphp php(Zendphp_Filterphp_Exceptionphp php$ephp)php php{
php php php php php php php php php php php php php php php php php php php php php php php php php$thisphp-php>php_messagesphp php+php=php arrayphp(php$ephp-php>getMessagephp(php)php)php;
php php php php php php php php php php php php php php php php php php php php php}
php php php php php php php php php php php php php php php php php}
php php php php php php php php php php php php php}
php php php php php php php php php}

php php php php php php php php ifphp php(countphp(php$thisphp-php>php_messagesphp)php php>php php0php)php php{
php php php php php php php php php php php php returnphp falsephp;
php php php php php php php php php}

php php php php php php php php returnphp truephp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Determinephp systemphp TMPphp directoryphp andphp detectphp ifphp wephp havephp readphp access
php php php php php php*
php php php php php php*php php@returnphp string
php php php php php php*php php@throwsphp Zendphp_Filephp_Transferphp_Exceptionphp ifphp unablephp tophp determinephp directory
php php php php php php*php/
php php php php protectedphp functionphp php_getTmpDirphp(php)
php php php php php{
php php php php php php php php ifphp php(nullphp php=php=php=php php$thisphp-php>php_tmpDirphp)php php{
php php php php php php php php php php php php php$tmpdirphp php=php arrayphp(php)php;
php php php php php php php php php php php php ifphp php(functionphp_existsphp(php'sysphp_getphp_tempphp_dirphp'php)php)php php{
php php php php php php php php php php php php php php php php php$tmpdirphp[php]php php=php sysphp_getphp_tempphp_dirphp(php)php;
php php php php php php php php php php php php php}

php php php php php php php php php php php php ifphp php(php!emptyphp(php$php_ENVphp[php'TMPphp'php]php)php)php php{
php php php php php php php php php php php php php php php php php$tmpdirphp[php]php php=php realpathphp(php$php_ENVphp[php'TMPphp'php]php)php;
php php php php php php php php php php php php php}

php php php php php php php php php php php php ifphp php(php!emptyphp(php$php_ENVphp[php'TMPDIRphp'php]php)php)php php{
php php php php php php php php php php php php php php php php php$tmpdirphp[php]php php=php realpathphp(php$php_ENVphp[php'TMPDIRphp'php]php)php;
php php php php php php php php php php php php php}

php php php php php php php php php php php php ifphp php(php!emptyphp(php$php_ENVphp[php'TEMPphp'php]php)php)php php{
php php php php php php php php php php php php php php php php php$tmpdirphp[php]php php=php realpathphp(php$php_ENVphp[php'TEMPphp'php]php)php;
php php php php php php php php php php php php php}

php php php php php php php php php php php php php$uploadphp php=php iniphp_getphp(php'uploadphp_tmpphp_dirphp'php)php;
php php php php php php php php php php php php ifphp php(php$uploadphp)php php{
php php php php php php php php php php php php php php php php php$tmpdirphp[php]php php=php realpathphp(php$uploadphp)php;
php php php php php php php php php php php php php}

php php php php php php php php php php php php foreachphp(php$tmpdirphp asphp php$directoryphp)php php{
php php php php php php php php php php php php php php php php ifphp php(php$thisphp-php>php_isPathWriteablephp(php$directoryphp)php)php php{
php php php php php php php php php php php php php php php php php php php php php$thisphp-php>php_tmpDirphp php=php php$directoryphp;
php php php php php php php php php php php php php php php php php}
php php php php php php php php php php php php php}

php php php php php php php php php php php php ifphp php(emptyphp(php$thisphp-php>php_tmpDirphp)php)php php{
php php php php php php php php php php php php php php php php php/php/php Attempphp tophp detectphp byphp creatingphp aphp temporaryphp file
php php php php php php php php php php php php php php php php php$tempFilephp php=php tempnamphp(mdphp5php(uniqidphp(randphp(php)php,php TRUEphp)php)php,php php'php'php)php;
php php php php php php php php php php php php php php php php ifphp php(php$tempFilephp)php php{
php php php php php php php php php php php php php php php php php php php php php$thisphp-php>php_tmpDirphp php=php realpathphp(dirnamephp(php$tempFilephp)php)php;
php php php php php php php php php php php php php php php php php php php php unlinkphp(php$tempFilephp)php;
php php php php php php php php php php php php php php php php php}php elsephp php{
php php php php php php php php php php php php php php php php php php php php requirephp_oncephp php'Zendphp/Filephp/Transferphp/Exceptionphp.phpphp'php;
php php php php php php php php php php php php php php php php php php php php throwphp newphp Zendphp_Filephp_Transferphp_Exceptionphp(php'Couldphp notphp determinephp aphp temporaryphp directoryphp'php)php;
php php php php php php php php php php php php php php php php php}
php php php php php php php php php php php php php}

php php php php php php php php php php php php php$thisphp-php>php_tmpDirphp php=php rtrimphp(php$thisphp-php>php_tmpDirphp,php php"php/php\php\php"php)php;
php php php php php php php php php}
php php php php php php php php returnphp php$thisphp-php>php_tmpDirphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Triesphp tophp detectphp ifphp wephp canphp readphp andphp writephp tophp thephp givenphp path
php php php php php php*
php php php php php php*php php@paramphp stringphp php$path
php php php php php php*php/
php php php php protectedphp functionphp php_isPathWriteablephp(php$pathphp)
php php php php php{
php php php php php php php php php$tempFilephp php=php rtrimphp(php$pathphp,php php"php/php\php\php"php)php;
php php php php php php php php php$tempFilephp php.php=php php'php/php'php php.php php'testphp.php1php'php;

php php php php php php php php php$resultphp php=php php@filephp_putphp_contentsphp(php$tempFilephp,php php'TESTphp'php)php;

php php php php php php php php ifphp php(php$resultphp php=php=php falsephp)php php{
php php php php php php php php php php php php returnphp falsephp;
php php php php php php php php php}

php php php php php php php php php$resultphp php=php php@unlinkphp(php$tempFilephp)php;

php php php php php php php php ifphp php(php$resultphp php=php=php falsephp)php php{
php php php php php php php php php php php php returnphp falsephp;
php php php php php php php php php}

php php php php php php php php returnphp truephp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Returnsphp foundphp filesphp basedphp onphp internalphp filephp arrayphp andphp givenphp files
php php php php php php*
php php php php php php*php php@paramphp php stringphp|arrayphp php$filesphp php php php php php php php(Optionalphp)php Filesphp tophp return
php php php php php php*php php@paramphp php booleanphp php php php php php php$namesphp php php php php php php php(Optionalphp)php Returnsphp onlyphp namesphp onphp truephp,php elsephp completephp info
php php php php php php*php php@paramphp php booleanphp php php php php php php$noexceptionphp php(Optionalphp)php Allowsphp throwingphp anphp exceptionphp,php otherwisephp returnsphp anphp emptyphp array
php php php php php php*php php@returnphp arrayphp Foundphp files
php php php php php php*php php@throwsphp Zendphp_Filephp_Transferphp_Exceptionphp Onphp falsephp filename
php php php php php php*php/
php php php php protectedphp functionphp php_getFilesphp(php$filesphp,php php$namesphp php=php falsephp,php php$noexceptionphp php=php falsephp)
php php php php php{
php php php php php php php php php$checkphp php=php arrayphp(php)php;

php php php php php php php php ifphp php(isphp_stringphp(php$filesphp)php)php php{
php php php php php php php php php php php php php$filesphp php=php arrayphp(php$filesphp)php;
php php php php php php php php php}

php php php php php php php php ifphp php(isphp_arrayphp(php$filesphp)php)php php{
php php php php php php php php php php php php foreachphp php(php$filesphp asphp php$findphp)php php{
php php php php php php php php php php php php php php php php php$foundphp php=php arrayphp(php)php;
php php php php php php php php php php php php php php php php foreachphp php(php$thisphp-php>php_filesphp asphp php$filephp php=php>php php$contentphp)php php{
php php php php php php php php php php php php php php php php php php php php ifphp php(php!issetphp(php$contentphp[php'namephp'php]php)php)php php{
php php php php php php php php php php php php php php php php php php php php php php php php continuephp;
php php php php php php php php php php php php php php php php php php php php php}

php php php php php php php php php php php php php php php php php php php php ifphp php(php(php$contentphp[php'namephp'php]php php=php=php=php php$findphp)php php&php&php issetphp(php$contentphp[php'multifilesphp'php]php)php)php php{
php php php php php php php php php php php php php php php php php php php php php php php php foreachphp php(php$contentphp[php'multifilesphp'php]php asphp php$multifilephp)php php{
php php php php php php php php php php php php php php php php php php php php php php php php php php php php php$foundphp[php]php php=php php$multifilephp;
php php php php php php php php php php php php php php php php php php php php php php php php php}
php php php php php php php php php php php php php php php php php php php php php php php php breakphp;
php php php php php php php php php php php php php php php php php php php php php}

php php php php php php php php php php php php php php php php php php php php ifphp php(php$filephp php=php=php=php php$findphp)php php{
php php php php php php php php php php php php php php php php php php php php php php php php php$foundphp[php]php php=php php$filephp;
php php php php php php php php php php php php php php php php php php php php php php php php breakphp;
php php php php php php php php php php php php php php php php php php php php php}

php php php php php php php php php php php php php php php php php php php php ifphp php(php$contentphp[php'namephp'php]php php=php=php=php php$findphp)php php{
php php php php php php php php php php php php php php php php php php php php php php php php php$foundphp[php]php php=php php$filephp;
php php php php php php php php php php php php php php php php php php php php php php php php breakphp;
php php php php php php php php php php php php php php php php php php php php php}
php php php php php php php php php php php php php php php php php}

php php php php php php php php php php php php php php php php ifphp php(emptyphp(php$foundphp)php)php php{
php php php php php php php php php php php php php php php php php php php php ifphp php(php$noexceptionphp php!php=php=php falsephp)php php{
php php php php php php php php php php php php php php php php php php php php php php php php returnphp arrayphp(php)php;
php php php php php php php php php php php php php php php php php php php php php}

php php php php php php php php php php php php php php php php php php php php requirephp_oncephp php'Zendphp/Filephp/Transferphp/Exceptionphp.phpphp'php;
php php php php php php php php php php php php php php php php php php php php throwphp newphp Zendphp_Filephp_Transferphp_Exceptionphp(sprintfphp(php'Thephp filephp transferphp adapterphp canphp notphp findphp php"php%sphp"php'php,php php$findphp)php)php;
php php php php php php php php php php php php php php php php php}

php php php php php php php php php php php php php php php php foreachphp php(php$foundphp asphp php$checkedphp)php php{
php php php php php php php php php php php php php php php php php php php php php$checkphp[php$checkedphp]php php=php php$thisphp-php>php_filesphp[php$checkedphp]php;
php php php php php php php php php php php php php php php php php}
php php php php php php php php php php php php php}
php php php php php php php php php}

php php php php php php php php ifphp php(php$filesphp php=php=php=php nullphp)php php{
php php php php php php php php php php php php php$checkphp php=php php$thisphp-php>php_filesphp;
php php php php php php php php php php php php php$keysphp php php=php arrayphp_keysphp(php$checkphp)php;
php php php php php php php php php php php php foreachphp php(php$keysphp asphp php$keyphp)php php{
php php php php php php php php php php php php php php php php ifphp php(issetphp(php$checkphp[php$keyphp]php[php'multifilesphp'php]php)php)php php{
php php php php php php php php php php php php php php php php php php php php unsetphp(php$checkphp[php$keyphp]php)php;
php php php php php php php php php php php php php php php php php}
php php php php php php php php php php php php php}
php php php php php php php php php}

php php php php php php php php ifphp php(php$namesphp)php php{
php php php php php php php php php php php php php$checkphp php=php arrayphp_keysphp(php$checkphp)php;
php php php php php php php php php}

php php php php php php php php returnphp php$checkphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Retrievephp internalphp identifierphp forphp aphp namedphp validator
php php php php php php*
php php php php php php*php php@paramphp php stringphp php$name
php php php php php php*php php@returnphp string
php php php php php php*php/
php php php php protectedphp functionphp php_getValidatorIdentifierphp(php$namephp)
php php php php php{
php php php php php php php php ifphp php(arrayphp_keyphp_existsphp(php$namephp,php php$thisphp-php>php_validatorsphp)php)php php{
php php php php php php php php php php php php returnphp php$namephp;
php php php php php php php php php}

php php php php php php php php foreachphp php(arrayphp_keysphp(php$thisphp-php>php_validatorsphp)php asphp php$testphp)php php{
php php php php php php php php php php php php ifphp php(pregphp_matchphp(php'php/php'php php.php pregphp_quotephp(php$namephp)php php.php php'php$php/iphp'php,php php$testphp)php)php php{
php php php php php php php php php php php php php php php php returnphp php$testphp;
php php php php php php php php php php php php php}
php php php php php php php php php}

php php php php php php php php returnphp falsephp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Retrievephp internalphp identifierphp forphp aphp namedphp filter
php php php php php php*
php php php php php php*php php@paramphp php stringphp php$name
php php php php php php*php php@returnphp string
php php php php php php*php/
php php php php protectedphp functionphp php_getFilterIdentifierphp(php$namephp)
php php php php php{
php php php php php php php php ifphp php(arrayphp_keyphp_existsphp(php$namephp,php php$thisphp-php>php_filtersphp)php)php php{
php php php php php php php php php php php php returnphp php$namephp;
php php php php php php php php php}

php php php php php php php php foreachphp php(arrayphp_keysphp(php$thisphp-php>php_filtersphp)php asphp php$testphp)php php{
php php php php php php php php php php php php ifphp php(pregphp_matchphp(php'php/php'php php.php pregphp_quotephp(php$namephp)php php.php php'php$php/iphp'php,php php$testphp)php)php php{
php php php php php php php php php php php php php php php php returnphp php$testphp;
php php php php php php php php php php php php php}
php php php php php php php php php}

php php php php php php php php returnphp falsephp;
php php php php php}
php}
