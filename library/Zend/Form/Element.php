<php?php
php/php*php*
php php*php Zendphp Framework
php php*
php php*php LICENSE
php php*
php php*php Thisphp sourcephp filephp isphp subjectphp tophp thephp newphp BSDphp licensephp thatphp isphp bundled
php php*php withphp thisphp packagephp inphp thephp filephp LICENSEphp.txtphp.
php php*php Itphp isphp alsophp availablephp throughphp thephp worldphp-widephp-webphp atphp thisphp URLphp:
php php*php httpphp:php/php/frameworkphp.zendphp.comphp/licensephp/newphp-bsd
php php*php Ifphp youphp didphp notphp receivephp aphp copyphp ofphp thephp licensephp andphp arephp unablephp to
php php*php obtainphp itphp throughphp thephp worldphp-widephp-webphp,php pleasephp sendphp anphp email
php php*php tophp licensephp@zendphp.comphp sophp wephp canphp sendphp youphp aphp copyphp immediatelyphp.
php php*
php php*php php@categoryphp php php Zend
php php*php php@packagephp php php php Zendphp_Form
php php*php php@copyrightphp php Copyrightphp php(cphp)php php2php0php0php5php-php2php0php1php0php Zendphp Technologiesphp USAphp Incphp.php php(httpphp:php/php/wwwphp.zendphp.comphp)
php php*php php@licensephp php php php httpphp:php/php/frameworkphp.zendphp.comphp/licensephp/newphp-bsdphp php php php php Newphp BSDphp License
php php*php/

php/php*php*php php@seephp Zendphp_Filterphp php*php/
requirephp_oncephp php'Zendphp/Filterphp.phpphp'php;

php/php*php*php php@seephp Zendphp_Formphp php*php/
requirephp_oncephp php'Zendphp/Formphp.phpphp'php;

php/php*php*php php@seephp Zendphp_Validatephp_Interfacephp php*php/
requirephp_oncephp php'Zendphp/Validatephp/Interfacephp.phpphp'php;

php/php*php*php php@seephp Zendphp_Validatephp_Abstractphp php*php/
requirephp_oncephp php'Zendphp/Validatephp/Abstractphp.phpphp'php;

php/php*php*
php php*php Zendphp_Formphp_Element
php php*
php php*php php@categoryphp php php Zend
php php*php php@packagephp php php php Zendphp_Form
php php*php php@subpackagephp Element
php php*php php@copyrightphp php Copyrightphp php(cphp)php php2php0php0php5php-php2php0php1php0php Zendphp Technologiesphp USAphp Incphp.php php(httpphp:php/php/wwwphp.zendphp.comphp)
php php*php php@licensephp php php php httpphp:php/php/frameworkphp.zendphp.comphp/licensephp/newphp-bsdphp php php php php Newphp BSDphp License
php php*php php@versionphp php php php php$Idphp:php Elementphp.phpphp php2php2php4php6php4php php2php0php1php0php-php0php6php-php1php9php php1php7php:php3php1php:php2php1Zphp alabphp php$
php php*php/
classphp Zendphp_Formphp_Elementphp implementsphp Zendphp_Validatephp_Interface
php{
php php php php php/php*php*
php php php php php php*php Elementphp Constants
php php php php php php*php/
php php php php constphp DECORATORphp php=php php'DECORATORphp'php;
php php php php constphp FILTERphp php php php php=php php'FILTERphp'php;
php php php php constphp VALIDATEphp php php=php php'VALIDATEphp'php;

php php php php php/php*php*
php php php php php php*php Defaultphp viewphp helperphp tophp use
php php php php php php*php php@varphp string
php php php php php php*php/
php php php php publicphp php$helperphp php=php php'formTextphp'php;

php php php php php/php*php*
php php php php php php*php php'Allowphp emptyphp'php flag
php php php php php php*php php@varphp bool
php php php php php php*php/
php php php php protectedphp php$php_allowEmptyphp php=php truephp;

php php php php php/php*php*
php php php php php php*php Flagphp indicatingphp whetherphp orphp notphp tophp insertphp NotEmptyphp validatorphp whenphp elementphp isphp required
php php php php php php*php php@varphp bool
php php php php php php*php/
php php php php protectedphp php$php_autoInsertNotEmptyValidatorphp php=php truephp;

php php php php php/php*php*
php php php php php php*php Arrayphp tophp whichphp elementphp belongs
php php php php php php*php php@varphp string
php php php php php php*php/
php php php php protectedphp php$php_belongsTophp;

php php php php php/php*php*
php php php php php php*php Elementphp decorators
php php php php php php*php php@varphp array
php php php php php php*php/
php php php php protectedphp php$php_decoratorsphp php=php arrayphp(php)php;

php php php php php/php*php*
php php php php php php*php Elementphp description
php php php php php php*php php@varphp string
php php php php php php*php/
php php php php protectedphp php$php_descriptionphp;

php php php php php/php*php*
php php php php php php*php Shouldphp wephp disablephp loadingphp thephp defaultphp decoratorsphp?
php php php php php php*php php@varphp bool
php php php php php php*php/
php php php php protectedphp php$php_disableLoadDefaultDecoratorsphp php=php falsephp;

php php php php php/php*php*
php php php php php php*php Customphp errorphp messages
php php php php php php*php php@varphp array
php php php php php php*php/
php php php php protectedphp php$php_errorMessagesphp php=php arrayphp(php)php;

php php php php php/php*php*
php php php php php php*php Validationphp errors
php php php php php php*php php@varphp array
php php php php php php*php/
php php php php protectedphp php$php_errorsphp php=php arrayphp(php)php;

php php php php php/php*php*
php php php php php php*php Separatorphp tophp usephp whenphp concatenatingphp aggregatephp errorphp messagesphp php(for
php php php php php php*php elementsphp havingphp arrayphp valuesphp)
php php php php php php*php php@varphp string
php php php php php php*php/
php php php php protectedphp php$php_errorMessageSeparatorphp php=php php'php;php php'php;

php php php php php/php*php*
php php php php php php*php Elementphp filters
php php php php php php*php php@varphp array
php php php php php php*php/
php php php php protectedphp php$php_filtersphp php=php arrayphp(php)php;

php php php php php/php*php*
php php php php php php*php Ignorephp flagphp php(usedphp whenphp retrievingphp valuesphp atphp formphp levelphp)
php php php php php php*php php@varphp bool
php php php php php php*php/
php php php php protectedphp php$php_ignorephp php=php falsephp;

php php php php php/php*php*
php php php php php php*php Doesphp thephp elementphp representphp anphp arrayphp?
php php php php php php*php php@varphp bool
php php php php php php*php/
php php php php protectedphp php$php_isArrayphp php=php falsephp;

php php php php php/php*php*
php php php php php php*php Isphp thephp errorphp markedphp asphp inphp anphp invalidphp statephp?
php php php php php php*php php@varphp bool
php php php php php php*php/
php php php php protectedphp php$php_isErrorphp php=php falsephp;

php php php php php/php*php*
php php php php php php*php Hasphp thephp elementphp beenphp manuallyphp markedphp asphp invalidphp?
php php php php php php*php php@varphp bool
php php php php php php*php/
php php php php protectedphp php$php_isErrorForcedphp php=php falsephp;

php php php php php/php*php*
php php php php php php*php Elementphp label
php php php php php php*php php@varphp string
php php php php php php*php/
php php php php protectedphp php$php_labelphp;

php php php php php/php*php*
php php php php php php*php Pluginphp loadersphp forphp filterphp andphp validatorphp chains
php php php php php php*php php@varphp array
php php php php php php*php/
php php php php protectedphp php$php_loadersphp php=php arrayphp(php)php;

php php php php php/php*php*
php php php php php php*php Formattedphp validationphp errorphp messages
php php php php php php*php php@varphp array
php php php php php php*php/
php php php php protectedphp php$php_messagesphp php=php arrayphp(php)php;

php php php php php/php*php*
php php php php php php*php Elementphp name
php php php php php php*php php@varphp string
php php php php php php*php/
php php php php protectedphp php$php_namephp;

php php php php php/php*php*
php php php php php php*php Orderphp ofphp element
php php php php php php*php php@varphp int
php php php php php php*php/
php php php php protectedphp php$php_orderphp;

php php php php php/php*php*
php php php php php php*php Requiredphp flag
php php php php php php*php php@varphp bool
php php php php php php*php/
php php php php protectedphp php$php_requiredphp php=php falsephp;

php php php php php/php*php*
php php php php php php*php php@varphp Zendphp_Translate
php php php php php php*php/
php php php php protectedphp php$php_translatorphp;

php php php php php/php*php*
php php php php php php*php Isphp translationphp disabledphp?
php php php php php php*php php@varphp bool
php php php php php php*php/
php php php php protectedphp php$php_translatorDisabledphp php=php falsephp;

php php php php php/php*php*
php php php php php php*php Elementphp type
php php php php php php*php php@varphp string
php php php php php php*php/
php php php php protectedphp php$php_typephp;

php php php php php/php*php*
php php php php php php*php Arrayphp ofphp initializedphp validators
php php php php php php*php php@varphp arrayphp Validators
php php php php php php*php/
php php php php protectedphp php$php_validatorsphp php=php arrayphp(php)php;

php php php php php/php*php*
php php php php php php*php Arrayphp ofphp unphp-initializedphp validators
php php php php php php*php php@varphp array
php php php php php php*php/
php php php php protectedphp php$php_validatorRulesphp php=php arrayphp(php)php;

php php php php php/php*php*
php php php php php php*php Elementphp value
php php php php php php*php php@varphp mixed
php php php php php php*php/
php php php php protectedphp php$php_valuephp;

php php php php php/php*php*
php php php php php php*php php@varphp Zendphp_Viewphp_Interface
php php php php php php*php/
php php php php protectedphp php$php_viewphp;

php php php php php/php*php*
php php php php php php*php Isphp aphp specificphp decoratorphp beingphp renderedphp viaphp thephp magicphp renderDecoratorphp(php)php?
php php php php php php*
php php php php php php*php Thisphp isphp tophp allowphp executionphp ofphp logicphp insidephp thephp renderphp(php)php methodsphp ofphp child
php php php php php php*php elementsphp duringphp thephp magicphp callphp whilephp skippingphp thephp parentphp renderphp(php)php methodphp.
php php php php php php*
php php php php php php*php php@varphp bool
php php php php php php*php/
php php php php protectedphp php$php_isPartialRenderingphp php=php falsephp;

php php php php php/php*php*
php php php php php php*php Constructor
php php php php php php*
php php php php php php*php php$specphp mayphp bephp:
php php php php php php*php php-php stringphp:php namephp ofphp element
php php php php php php*php php-php arrayphp:php optionsphp withphp whichphp tophp configurephp element
php php php php php php*php php-php Zendphp_Configphp:php Zendphp_Configphp withphp optionsphp forphp configuringphp element
php php php php php php*
php php php php php php*php php@paramphp php stringphp|arrayphp|Zendphp_Configphp php$spec
php php php php php php*php php@paramphp php arrayphp|Zendphp_Configphp php$options
php php php php php php*php php@returnphp void
php php php php php php*php php@throwsphp Zendphp_Formphp_Exceptionphp ifphp nophp elementphp namephp afterphp initialization
php php php php php php*php/
php php php php publicphp functionphp php_php_constructphp(php$specphp,php php$optionsphp php=php nullphp)
php php php php php{
php php php php php php php php ifphp php(isphp_stringphp(php$specphp)php)php php{
php php php php php php php php php php php php php$thisphp-php>setNamephp(php$specphp)php;
php php php php php php php php php}php elseifphp php(isphp_arrayphp(php$specphp)php)php php{
php php php php php php php php php php php php php$thisphp-php>setOptionsphp(php$specphp)php;
php php php php php php php php php}php elseifphp php(php$specphp instanceofphp Zendphp_Configphp)php php{
php php php php php php php php php php php php php$thisphp-php>setConfigphp(php$specphp)php;
php php php php php php php php php}

php php php php php php php php ifphp php(isphp_stringphp(php$specphp)php php&php&php isphp_arrayphp(php$optionsphp)php)php php{
php php php php php php php php php php php php php$thisphp-php>setOptionsphp(php$optionsphp)php;
php php php php php php php php php}php elseifphp php(isphp_stringphp(php$specphp)php php&php&php php(php$optionsphp instanceofphp Zendphp_Configphp)php)php php{
php php php php php php php php php php php php php$thisphp-php>setConfigphp(php$optionsphp)php;
php php php php php php php php php}

php php php php php php php php ifphp php(nullphp php=php=php=php php$thisphp-php>getNamephp(php)php)php php{
php php php php php php php php php php php php requirephp_oncephp php'Zendphp/Formphp/Exceptionphp.phpphp'php;
php php php php php php php php php php php php throwphp newphp Zendphp_Formphp_Exceptionphp(php'Zendphp_Formphp_Elementphp requiresphp eachphp elementphp tophp havephp aphp namephp'php)php;
php php php php php php php php php}

php php php php php php php php php/php*php*
php php php php php php php php php php*php Extensions
php php php php php php php php php php*php/
php php php php php php php php php$thisphp-php>initphp(php)php;

php php php php php php php php php/php*php*
php php php php php php php php php php*php Registerphp ViewHelperphp decoratorphp byphp default
php php php php php php php php php php*php/
php php php php php php php php php$thisphp-php>loadDefaultDecoratorsphp(php)php;
php php php php php}

php php php php php/php*php*
php php php php php php*php Initializephp objectphp;php usedphp byphp extendingphp classes
php php php php php php*
php php php php php php*php php@returnphp void
php php php php php php*php/
php php php php publicphp functionphp initphp(php)
php php php php php{
php php php php php}

php php php php php/php*php*
php php php php php php*php Setphp flagphp tophp disablephp loadingphp defaultphp decorators
php php php php php php*
php php php php php php*php php@paramphp php boolphp php$flag
php php php php php php*php php@returnphp Zendphp_Formphp_Element
php php php php php php*php/
php php php php publicphp functionphp setDisableLoadDefaultDecoratorsphp(php$flagphp)
php php php php php{
php php php php php php php php php$thisphp-php>php_disableLoadDefaultDecoratorsphp php=php php(boolphp)php php$flagphp;
php php php php php php php php returnphp php$thisphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Shouldphp wephp loadphp thephp defaultphp decoratorsphp?
php php php php php php*
php php php php php php*php php@returnphp bool
php php php php php php*php/
php php php php publicphp functionphp loadDefaultDecoratorsIsDisabledphp(php)
php php php php php{
php php php php php php php php returnphp php$thisphp-php>php_disableLoadDefaultDecoratorsphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Loadphp defaultphp decorators
php php php php php php*
php php php php php php*php php@returnphp Zendphp_Formphp_Element
php php php php php php*php/
php php php php publicphp functionphp loadDefaultDecoratorsphp(php)
php php php php php{
php php php php php php php php ifphp php(php$thisphp-php>loadDefaultDecoratorsIsDisabledphp(php)php)php php{
php php php php php php php php php php php php returnphp php$thisphp;
php php php php php php php php php}

php php php php php php php php php$decoratorsphp php=php php$thisphp-php>getDecoratorsphp(php)php;
php php php php php php php php ifphp php(emptyphp(php$decoratorsphp)php)php php{
php php php php php php php php php php php php php$getIdphp php=php createphp_functionphp(php'php$decoratorphp'php,
php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php'returnphp php$decoratorphp-php>getElementphp(php)php-php>getIdphp(php)
php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php.php php"php-elementphp"php;php'php)php;
php php php php php php php php php php php php php$thisphp-php>addDecoratorphp(php'ViewHelperphp'php)
php php php php php php php php php php php php php php php php php php-php>addDecoratorphp(php'Errorsphp'php)
php php php php php php php php php php php php php php php php php php-php>addDecoratorphp(php'Descriptionphp'php,php arrayphp(php'tagphp'php php=php>php php'pphp'php,php php'classphp'php php=php>php php'descriptionphp'php)php)
php php php php php php php php php php php php php php php php php php-php>addDecoratorphp(php'HtmlTagphp'php,php arrayphp(php'tagphp'php php=php>php php'ddphp'php,
php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php'idphp'php php php=php>php arrayphp(php'callbackphp'php php=php>php php$getIdphp)php)php)
php php php php php php php php php php php php php php php php php php-php>addDecoratorphp(php'Labelphp'php,php arrayphp(php'tagphp'php php=php>php php'dtphp'php)php)php;
php php php php php php php php php}
php php php php php php php php returnphp php$thisphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Setphp objectphp statephp fromphp optionsphp array
php php php php php php*
php php php php php php*php php@paramphp php arrayphp php$options
php php php php php php*php php@returnphp Zendphp_Formphp_Element
php php php php php php*php/
php php php php publicphp functionphp setOptionsphp(arrayphp php$optionsphp)
php php php php php{
php php php php php php php php ifphp php(issetphp(php$optionsphp[php'prefixPathphp'php]php)php)php php{
php php php php php php php php php php php php php$thisphp-php>addPrefixPathsphp(php$optionsphp[php'prefixPathphp'php]php)php;
php php php php php php php php php php php php unsetphp(php$optionsphp[php'prefixPathphp'php]php)php;
php php php php php php php php php}

php php php php php php php php ifphp php(issetphp(php$optionsphp[php'disableTranslatorphp'php]php)php)php php{
php php php php php php php php php php php php php$thisphp-php>setDisableTranslatorphp(php$optionsphp[php'disableTranslatorphp'php]php)php;
php php php php php php php php php php php php unsetphp(php$optionsphp[php'disableTranslatorphp'php]php)php;
php php php php php php php php php}

php php php php php php php php unsetphp(php$optionsphp[php'optionsphp'php]php)php;
php php php php php php php php unsetphp(php$optionsphp[php'configphp'php]php)php;

php php php php php php php php foreachphp php(php$optionsphp asphp php$keyphp php=php>php php$valuephp)php php{
php php php php php php php php php php php php php$methodphp php=php php'setphp'php php.php ucfirstphp(php$keyphp)php;

php php php php php php php php php php php php ifphp php(inphp_arrayphp(php$methodphp,php arrayphp(php'setTranslatorphp'php,php php'setPluginLoaderphp'php,php php'setViewphp'php)php)php)php php{
php php php php php php php php php php php php php php php php ifphp php(php!isphp_objectphp(php$valuephp)php)php php{
php php php php php php php php php php php php php php php php php php php php continuephp;
php php php php php php php php php php php php php php php php php}
php php php php php php php php php php php php php}

php php php php php php php php php php php php ifphp php(methodphp_existsphp(php$thisphp,php php$methodphp)php)php php{
php php php php php php php php php php php php php php php php php/php/php Setterphp existsphp;php usephp it
php php php php php php php php php php php php php php php php php$thisphp-php>php$methodphp(php$valuephp)php;
php php php php php php php php php php php php php}php elsephp php{
php php php php php php php php php php php php php php php php php/php/php Assumephp itphp'sphp metadata
php php php php php php php php php php php php php php php php php$thisphp-php>setAttribphp(php$keyphp,php php$valuephp)php;
php php php php php php php php php php php php php}
php php php php php php php php php}
php php php php php php php php returnphp php$thisphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Setphp objectphp statephp fromphp Zendphp_Configphp object
php php php php php php*
php php php php php php*php php@paramphp php Zendphp_Configphp php$config
php php php php php php*php php@returnphp Zendphp_Formphp_Element
php php php php php php*php/
php php php php publicphp functionphp setConfigphp(Zendphp_Configphp php$configphp)
php php php php php{
php php php php php php php php returnphp php$thisphp-php>setOptionsphp(php$configphp-php>toArrayphp(php)php)php;
php php php php php}


php php php php php/php/php Localizationphp:

php php php php php/php*php*
php php php php php php*php Setphp translatorphp objectphp forphp localization
php php php php php php*
php php php php php php*php php@paramphp php Zendphp_Translatephp|nullphp php$translator
php php php php php php*php php@returnphp Zendphp_Formphp_Element
php php php php php php*php/
php php php php publicphp functionphp setTranslatorphp(php$translatorphp php=php nullphp)
php php php php php{
php php php php php php php php ifphp php(nullphp php=php=php=php php$translatorphp)php php{
php php php php php php php php php php php php php$thisphp-php>php_translatorphp php=php nullphp;
php php php php php php php php php}php elseifphp php(php$translatorphp instanceofphp Zendphp_Translatephp_Adapterphp)php php{
php php php php php php php php php php php php php$thisphp-php>php_translatorphp php=php php$translatorphp;
php php php php php php php php php}php elseifphp php(php$translatorphp instanceofphp Zendphp_Translatephp)php php{
php php php php php php php php php php php php php$thisphp-php>php_translatorphp php=php php$translatorphp-php>getAdapterphp(php)php;
php php php php php php php php php}php elsephp php{
php php php php php php php php php php php php requirephp_oncephp php'Zendphp/Formphp/Exceptionphp.phpphp'php;
php php php php php php php php php php php php throwphp newphp Zendphp_Formphp_Exceptionphp(php'Invalidphp translatorphp specifiedphp'php)php;
php php php php php php php php php}
php php php php php php php php returnphp php$thisphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Retrievephp localizationphp translatorphp object
php php php php php php*
php php php php php php*php php@returnphp Zendphp_Translatephp_Adapterphp|null
php php php php php php*php/
php php php php publicphp functionphp getTranslatorphp(php)
php php php php php{
php php php php php php php php ifphp php(php$thisphp-php>translatorIsDisabledphp(php)php)php php{
php php php php php php php php php php php php returnphp nullphp;
php php php php php php php php php}

php php php php php php php php ifphp php(nullphp php=php=php=php php$thisphp-php>php_translatorphp)php php{
php php php php php php php php php php php php returnphp Zendphp_Formphp:php:getDefaultTranslatorphp(php)php;
php php php php php php php php php}
php php php php php php php php returnphp php$thisphp-php>php_translatorphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Doesphp thisphp elementphp havephp itsphp ownphp specificphp translatorphp?
php php php php php php*
php php php php php php*php php@returnphp bool
php php php php php php*php/
php php php php publicphp functionphp hasTranslatorphp(php)
php php php php php{
php php php php php php php php returnphp php(boolphp)php$thisphp-php>php_translatorphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Indicatephp whetherphp orphp notphp translationphp shouldphp bephp disabled
php php php php php php*
php php php php php php*php php@paramphp php boolphp php$flag
php php php php php php*php php@returnphp Zendphp_Formphp_Element
php php php php php php*php/
php php php php publicphp functionphp setDisableTranslatorphp(php$flagphp)
php php php php php{
php php php php php php php php php$thisphp-php>php_translatorDisabledphp php=php php(boolphp)php php$flagphp;
php php php php php php php php returnphp php$thisphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Isphp translationphp disabledphp?
php php php php php php*
php php php php php php*php php@returnphp bool
php php php php php php*php/
php php php php publicphp functionphp translatorIsDisabledphp(php)
php php php php php{
php php php php php php php php returnphp php$thisphp-php>php_translatorDisabledphp;
php php php php php}

php php php php php/php/php Metadata

php php php php php/php*php*
php php php php php php*php Filterphp aphp namephp tophp onlyphp allowphp validphp variablephp characters
php php php php php php*
php php php php php php*php php@paramphp php stringphp php$value
php php php php php php*php php@paramphp php boolphp php$allowBrackets
php php php php php php*php php@returnphp string
php php php php php php*php/
php php php php publicphp functionphp filterNamephp(php$valuephp,php php$allowBracketsphp php=php falsephp)
php php php php php{
php php php php php php php php php$charsetphp php=php php'php^aphp-zAphp-Zphp0php-php9php_php\xphp7fphp-php\xffphp'php;
php php php php php php php php ifphp php(php$allowBracketsphp)php php{
php php php php php php php php php php php php php$charsetphp php.php=php php'php\php[php\php]php'php;
php php php php php php php php php}
php php php php php php php php returnphp pregphp_replacephp(php'php/php[php'php php.php php$charsetphp php.php php'php]php/php'php,php php'php'php,php php(stringphp)php php$valuephp)php;
php php php php php}

php php php php php/php*php*
php php php php php php*php Setphp elementphp name
php php php php php php*
php php php php php php*php php@paramphp php stringphp php$name
php php php php php php*php php@returnphp Zendphp_Formphp_Element
php php php php php php*php/
php php php php publicphp functionphp setNamephp(php$namephp)
php php php php php{
php php php php php php php php php$namephp php=php php$thisphp-php>filterNamephp(php$namephp)php;
php php php php php php php php ifphp php(php'php'php php=php=php=php php$namephp)php php{
php php php php php php php php php php php php requirephp_oncephp php'Zendphp/Formphp/Exceptionphp.phpphp'php;
php php php php php php php php php php php php throwphp newphp Zendphp_Formphp_Exceptionphp(php'Invalidphp namephp providedphp;php mustphp containphp onlyphp validphp variablephp charactersphp andphp bephp nonphp-emptyphp'php)php;
php php php php php php php php php}

php php php php php php php php php$thisphp-php>php_namephp php=php php$namephp;
php php php php php php php php returnphp php$thisphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Returnphp elementphp name
php php php php php php*
php php php php php php*php php@returnphp string
php php php php php php*php/
php php php php publicphp functionphp getNamephp(php)
php php php php php{
php php php php php php php php returnphp php$thisphp-php>php_namephp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Getphp fullyphp qualifiedphp name
php php php php php php*
php php php php php php*php Placesphp namephp asphp subitemphp ofphp arrayphp andphp/orphp appendsphp bracketsphp.
php php php php php php*
php php php php php php*php php@returnphp string
php php php php php php*php/
php php php php publicphp functionphp getFullyQualifiedNamephp(php)
php php php php php{
php php php php php php php php php$namephp php=php php$thisphp-php>getNamephp(php)php;

php php php php php php php php ifphp php(nullphp php!php=php=php php(php$belongsTophp php=php php$thisphp-php>getBelongsTophp(php)php)php)php php{
php php php php php php php php php php php php php$namephp php=php php$belongsTophp php.php php'php[php'php php.php php$namephp php.php php'php]php'php;
php php php php php php php php php}

php php php php php php php php ifphp php(php$thisphp-php>isArrayphp(php)php)php php{
php php php php php php php php php php php php php$namephp php.php=php php'php[php]php'php;
php php php php php php php php php}

php php php php php php php php returnphp php$namephp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Getphp elementphp id
php php php php php php*
php php php php php php*php php@returnphp string
php php php php php php*php/
php php php php publicphp functionphp getIdphp(php)
php php php php php{
php php php php php php php php ifphp php(issetphp(php$thisphp-php>idphp)php)php php{
php php php php php php php php php php php php returnphp php$thisphp-php>idphp;
php php php php php php php php php}

php php php php php php php php php$idphp php=php php$thisphp-php>getFullyQualifiedNamephp(php)php;

php php php php php php php php php/php/php Bailphp earlyphp ifphp nophp arrayphp notationphp detected
php php php php php php php php ifphp php(php!strstrphp(php$idphp,php php'php[php'php)php)php php{
php php php php php php php php php php php php returnphp php$idphp;
php php php php php php php php php}

php php php php php php php php php/php/php Stripphp arrayphp notation
php php php php php php php php ifphp php(php'php[php]php'php php=php=php substrphp(php$idphp,php php-php2php)php)php php{
php php php php php php php php php php php php php$idphp php=php substrphp(php$idphp,php php0php,php strlenphp(php$idphp)php php-php php2php)php;
php php php php php php php php php}
php php php php php php php php php$idphp php=php strphp_replacephp(php'php]php[php'php,php php'php-php'php,php php$idphp)php;
php php php php php php php php php$idphp php=php strphp_replacephp(arrayphp(php'php]php'php,php php'php[php'php)php,php php'php-php'php,php php$idphp)php;
php php php php php php php php php$idphp php=php trimphp(php$idphp,php php'php-php'php)php;

php php php php php php php php returnphp php$idphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Setphp elementphp value
php php php php php php*
php php php php php php*php php@paramphp php mixedphp php$value
php php php php php php*php php@returnphp Zendphp_Formphp_Element
php php php php php php*php/
php php php php publicphp functionphp setValuephp(php$valuephp)
php php php php php{
php php php php php php php php php$thisphp-php>php_valuephp php=php php$valuephp;
php php php php php php php php returnphp php$thisphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Filterphp aphp value
php php php php php php*
php php php php php php*php php@paramphp php stringphp php$value
php php php php php php*php php@paramphp php stringphp php$key
php php php php php php*php php@returnphp void
php php php php php php*php/
php php php php protectedphp functionphp php_filterValuephp(php&php$valuephp,php php&php$keyphp)
php php php php php{
php php php php php php php php foreachphp php(php$thisphp-php>getFiltersphp(php)php asphp php$filterphp)php php{
php php php php php php php php php php php php php$valuephp php=php php$filterphp-php>filterphp(php$valuephp)php;
php php php php php php php php php}
php php php php php}

php php php php php/php*php*
php php php php php php*php Retrievephp filteredphp elementphp value
php php php php php php*
php php php php php php*php php@returnphp mixed
php php php php php php*php/
php php php php publicphp functionphp getValuephp(php)
php php php php php{
php php php php php php php php php$valueFilteredphp php=php php$thisphp-php>php_valuephp;

php php php php php php php php ifphp php(php$thisphp-php>isArrayphp(php)php php&php&php isphp_arrayphp(php$valueFilteredphp)php)php php{
php php php php php php php php php php php php arrayphp_walkphp_recursivephp(php$valueFilteredphp,php arrayphp(php$thisphp,php php'php_filterValuephp'php)php)php;
php php php php php php php php php}php elsephp php{
php php php php php php php php php php php php php$thisphp-php>php_filterValuephp(php$valueFilteredphp,php php$valueFilteredphp)php;
php php php php php php php php php}

php php php php php php php php returnphp php$valueFilteredphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Retrievephp unfilteredphp elementphp value
php php php php php php*
php php php php php php*php php@returnphp mixed
php php php php php php*php/
php php php php publicphp functionphp getUnfilteredValuephp(php)
php php php php php{
php php php php php php php php returnphp php$thisphp-php>php_valuephp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Setphp elementphp label
php php php php php php*
php php php php php php*php php@paramphp php stringphp php$label
php php php php php php*php php@returnphp Zendphp_Formphp_Element
php php php php php php*php/
php php php php publicphp functionphp setLabelphp(php$labelphp)
php php php php php{
php php php php php php php php php$thisphp-php>php_labelphp php=php php(stringphp)php php$labelphp;
php php php php php php php php returnphp php$thisphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Retrievephp elementphp label
php php php php php php*
php php php php php php*php php@returnphp string
php php php php php php*php/
php php php php publicphp functionphp getLabelphp(php)
php php php php php{
php php php php php php php php php$translatorphp php=php php$thisphp-php>getTranslatorphp(php)php;
php php php php php php php php ifphp php(nullphp php!php=php=php php$translatorphp)php php{
php php php php php php php php php php php php returnphp php$translatorphp-php>translatephp(php$thisphp-php>php_labelphp)php;
php php php php php php php php php}

php php php php php php php php returnphp php$thisphp-php>php_labelphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Setphp elementphp order
php php php php php php*
php php php php php php*php php@paramphp php intphp php$order
php php php php php php*php php@returnphp Zendphp_Formphp_Element
php php php php php php*php/
php php php php publicphp functionphp setOrderphp(php$orderphp)
php php php php php{
php php php php php php php php php$thisphp-php>php_orderphp php=php php(intphp)php php$orderphp;
php php php php php php php php returnphp php$thisphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Retrievephp elementphp order
php php php php php php*
php php php php php php*php php@returnphp int
php php php php php php*php/
php php php php publicphp functionphp getOrderphp(php)
php php php php php{
php php php php php php php php returnphp php$thisphp-php>php_orderphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Setphp requiredphp flag
php php php php php php*
php php php php php php*php php@paramphp php boolphp php$flagphp Defaultphp valuephp isphp true
php php php php php php*php php@returnphp Zendphp_Formphp_Element
php php php php php php*php/
php php php php publicphp functionphp setRequiredphp(php$flagphp php=php truephp)
php php php php php{
php php php php php php php php php$thisphp-php>php_requiredphp php=php php(boolphp)php php$flagphp;
php php php php php php php php returnphp php$thisphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Isphp thephp elementphp requiredphp?
php php php php php php*
php php php php php php*php php@returnphp bool
php php php php php php*php/
php php php php publicphp functionphp isRequiredphp(php)
php php php php php{
php php php php php php php php returnphp php$thisphp-php>php_requiredphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Setphp flagphp indicatingphp whetherphp aphp NotEmptyphp validatorphp shouldphp bephp insertedphp whenphp elementphp isphp required
php php php php php php*
php php php php php php*php php@paramphp php boolphp php$flag
php php php php php php*php php@returnphp Zendphp_Formphp_Element
php php php php php php*php/
php php php php publicphp functionphp setAutoInsertNotEmptyValidatorphp(php$flagphp)
php php php php php{
php php php php php php php php php$thisphp-php>php_autoInsertNotEmptyValidatorphp php=php php(boolphp)php php$flagphp;
php php php php php php php php returnphp php$thisphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Getphp flagphp indicatingphp whetherphp aphp NotEmptyphp validatorphp shouldphp bephp insertedphp whenphp elementphp isphp required
php php php php php php*
php php php php php php*php php@returnphp bool
php php php php php php*php/
php php php php publicphp functionphp autoInsertNotEmptyValidatorphp(php)
php php php php php{
php php php php php php php php returnphp php$thisphp-php>php_autoInsertNotEmptyValidatorphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Setphp elementphp description
php php php php php php*
php php php php php php*php php@paramphp php stringphp php$description
php php php php php php*php php@returnphp Zendphp_Formphp_Element
php php php php php php*php/
php php php php publicphp functionphp setDescriptionphp(php$descriptionphp)
php php php php php{
php php php php php php php php php$thisphp-php>php_descriptionphp php=php php(stringphp)php php$descriptionphp;
php php php php php php php php returnphp php$thisphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Retrievephp elementphp description
php php php php php php*
php php php php php php*php php@returnphp string
php php php php php php*php/
php php php php publicphp functionphp getDescriptionphp(php)
php php php php php{
php php php php php php php php returnphp php$thisphp-php>php_descriptionphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Setphp php'allowphp emptyphp'php flag
php php php php php php*
php php php php php php*php Whenphp thephp allowphp emptyphp flagphp isphp enabledphp andphp thephp requiredphp flagphp isphp falsephp,php the
php php php php php php*php elementphp willphp validatephp withphp emptyphp valuesphp.
php php php php php php*
php php php php php php*php php@paramphp php boolphp php$flag
php php php php php php*php php@returnphp Zendphp_Formphp_Element
php php php php php php*php/
php php php php publicphp functionphp setAllowEmptyphp(php$flagphp)
php php php php php{
php php php php php php php php php$thisphp-php>php_allowEmptyphp php=php php(boolphp)php php$flagphp;
php php php php php php php php returnphp php$thisphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Getphp php'allowphp emptyphp'php flag
php php php php php php*
php php php php php php*php php@returnphp bool
php php php php php php*php/
php php php php publicphp functionphp getAllowEmptyphp(php)
php php php php php{
php php php php php php php php returnphp php$thisphp-php>php_allowEmptyphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Setphp ignorephp flagphp php(usedphp whenphp retrievingphp valuesphp atphp formphp levelphp)
php php php php php php*
php php php php php php*php php@paramphp php boolphp php$flag
php php php php php php*php php@returnphp Zendphp_Formphp_Element
php php php php php php*php/
php php php php publicphp functionphp setIgnorephp(php$flagphp)
php php php php php{
php php php php php php php php php$thisphp-php>php_ignorephp php=php php(boolphp)php php$flagphp;
php php php php php php php php returnphp php$thisphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Getphp ignorephp flagphp php(usedphp whenphp retrievingphp valuesphp atphp formphp levelphp)
php php php php php php*
php php php php php php*php php@returnphp bool
php php php php php php*php/
php php php php publicphp functionphp getIgnorephp(php)
php php php php php{
php php php php php php php php returnphp php$thisphp-php>php_ignorephp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Setphp flagphp indicatingphp ifphp elementphp representsphp anphp array
php php php php php php*
php php php php php php*php php@paramphp php boolphp php$flag
php php php php php php*php php@returnphp Zendphp_Formphp_Element
php php php php php php*php/
php php php php publicphp functionphp setIsArrayphp(php$flagphp)
php php php php php{
php php php php php php php php php$thisphp-php>php_isArrayphp php=php php(boolphp)php php$flagphp;
php php php php php php php php returnphp php$thisphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Isphp thephp elementphp representingphp anphp arrayphp?
php php php php php php*
php php php php php php*php php@returnphp bool
php php php php php php*php/
php php php php publicphp functionphp isArrayphp(php)
php php php php php{
php php php php php php php php returnphp php$thisphp-php>php_isArrayphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Setphp arrayphp tophp whichphp elementphp belongs
php php php php php php*
php php php php php php*php php@paramphp php stringphp php$array
php php php php php php*php php@returnphp Zendphp_Formphp_Element
php php php php php php*php/
php php php php publicphp functionphp setBelongsTophp(php$arrayphp)
php php php php php{
php php php php php php php php php$arrayphp php=php php$thisphp-php>filterNamephp(php$arrayphp,php truephp)php;
php php php php php php php php ifphp php(php!emptyphp(php$arrayphp)php)php php{
php php php php php php php php php php php php php$thisphp-php>php_belongsTophp php=php php$arrayphp;
php php php php php php php php php}

php php php php php php php php returnphp php$thisphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Returnphp arrayphp namephp tophp whichphp elementphp belongs
php php php php php php*
php php php php php php*php php@returnphp string
php php php php php php*php/
php php php php publicphp functionphp getBelongsTophp(php)
php php php php php{
php php php php php php php php returnphp php$thisphp-php>php_belongsTophp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Returnphp elementphp type
php php php php php php*
php php php php php php*php php@returnphp string
php php php php php php*php/
php php php php publicphp functionphp getTypephp(php)
php php php php php{
php php php php php php php php ifphp php(nullphp php=php=php=php php$thisphp-php>php_typephp)php php{
php php php php php php php php php php php php php$thisphp-php>php_typephp php=php getphp_classphp(php$thisphp)php;
php php php php php php php php php}

php php php php php php php php returnphp php$thisphp-php>php_typephp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Setphp elementphp attribute
php php php php php php*
php php php php php php*php php@paramphp php stringphp php$name
php php php php php php*php php@paramphp php mixedphp php$value
php php php php php php*php php@returnphp Zendphp_Formphp_Element
php php php php php php*php php@throwsphp Zendphp_Formphp_Exceptionphp forphp invalidphp php$namephp values
php php php php php php*php/
php php php php publicphp functionphp setAttribphp(php$namephp,php php$valuephp)
php php php php php{
php php php php php php php php php$namephp php=php php(stringphp)php php$namephp;
php php php php php php php php ifphp php(php'php_php'php php=php=php php$namephp[php0php]php)php php{
php php php php php php php php php php php php requirephp_oncephp php'Zendphp/Formphp/Exceptionphp.phpphp'php;
php php php php php php php php php php php php throwphp newphp Zendphp_Formphp_Exceptionphp(sprintfphp(php'Invalidphp attributephp php"php%sphp"php;php mustphp notphp containphp aphp leadingphp underscorephp'php,php php$namephp)php)php;
php php php php php php php php php}

php php php php php php php php ifphp php(nullphp php=php=php=php php$valuephp)php php{
php php php php php php php php php php php php unsetphp(php$thisphp-php>php$namephp)php;
php php php php php php php php php}php elsephp php{
php php php php php php php php php php php php php$thisphp-php>php$namephp php=php php$valuephp;
php php php php php php php php php}

php php php php php php php php returnphp php$thisphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Setphp multiplephp attributesphp atphp once
php php php php php php*
php php php php php php*php php@paramphp php arrayphp php$attribs
php php php php php php*php php@returnphp Zendphp_Formphp_Element
php php php php php php*php/
php php php php publicphp functionphp setAttribsphp(arrayphp php$attribsphp)
php php php php php{
php php php php php php php php foreachphp php(php$attribsphp asphp php$keyphp php=php>php php$valuephp)php php{
php php php php php php php php php php php php php$thisphp-php>setAttribphp(php$keyphp,php php$valuephp)php;
php php php php php php php php php}

php php php php php php php php returnphp php$thisphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Retrievephp elementphp attribute
php php php php php php*
php php php php php php*php php@paramphp php stringphp php$name
php php php php php php*php php@returnphp string
php php php php php php*php/
php php php php publicphp functionphp getAttribphp(php$namephp)
php php php php php{
php php php php php php php php php$namephp php=php php(stringphp)php php$namephp;
php php php php php php php php ifphp php(issetphp(php$thisphp-php>php$namephp)php)php php{
php php php php php php php php php php php php returnphp php$thisphp-php>php$namephp;
php php php php php php php php php}

php php php php php php php php returnphp nullphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Returnphp allphp attributes
php php php php php php*
php php php php php php*php php@returnphp array
php php php php php php*php/
php php php php publicphp functionphp getAttribsphp(php)
php php php php php{
php php php php php php php php php$attribsphp php=php getphp_objectphp_varsphp(php$thisphp)php;
php php php php php php php php foreachphp php(php$attribsphp asphp php$keyphp php=php>php php$valuephp)php php{
php php php php php php php php php php php php ifphp php(php'php_php'php php=php=php substrphp(php$keyphp,php php0php,php php1php)php)php php{
php php php php php php php php php php php php php php php php unsetphp(php$attribsphp[php$keyphp]php)php;
php php php php php php php php php php php php php}
php php php php php php php php php}

php php php php php php php php returnphp php$attribsphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Overloadingphp:php retrievephp objectphp property
php php php php php php*
php php php php php php*php Preventsphp accessphp tophp propertiesphp beginningphp withphp php'php_php'php.
php php php php php php*
php php php php php php*php php@paramphp php stringphp php$key
php php php php php php*php php@returnphp mixed
php php php php php php*php/
php php php php publicphp functionphp php_php_getphp(php$keyphp)
php php php php php{
php php php php php php php php ifphp php(php'php_php'php php=php=php php$keyphp[php0php]php)php php{
php php php php php php php php php php php php requirephp_oncephp php'Zendphp/Formphp/Exceptionphp.phpphp'php;
php php php php php php php php php php php php throwphp newphp Zendphp_Formphp_Exceptionphp(sprintfphp(php'Cannotphp retrievephp valuephp forphp protectedphp/privatephp propertyphp php"php%sphp"php'php,php php$keyphp)php)php;
php php php php php php php php php}

php php php php php php php php ifphp php(php!issetphp(php$thisphp-php>php$keyphp)php)php php{
php php php php php php php php php php php php returnphp nullphp;
php php php php php php php php php}

php php php php php php php php returnphp php$thisphp-php>php$keyphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Overloadingphp:php setphp objectphp property
php php php php php php*
php php php php php php*php php@paramphp php stringphp php$key
php php php php php php*php php@paramphp php mixedphp php$value
php php php php php php*php php@returnphp voide
php php php php php php*php/
php php php php publicphp functionphp php_php_setphp(php$keyphp,php php$valuephp)
php php php php php{
php php php php php php php php php$thisphp-php>setAttribphp(php$keyphp,php php$valuephp)php;
php php php php php}

php php php php php/php*php*
php php php php php php*php Overloadingphp:php allowphp renderingphp specificphp decorators
php php php php php php*
php php php php php php*php Callphp renderDecoratorNamephp(php)php tophp renderphp aphp specificphp decoratorphp.
php php php php php php*
php php php php php php*php php@paramphp php stringphp php$method
php php php php php php*php php@paramphp php arrayphp php$args
php php php php php php*php php@returnphp string
php php php php php php*php php@throwsphp Zendphp_Formphp_Exceptionphp forphp invalidphp decoratorphp orphp invalidphp methodphp call
php php php php php php*php/
php php php php publicphp functionphp php_php_callphp(php$methodphp,php php$argsphp)
php php php php php{
php php php php php php php php ifphp php(php'renderphp'php php=php=php substrphp(php$methodphp,php php0php,php php6php)php)php php{
php php php php php php php php php php php php php$thisphp-php>php_isPartialRenderingphp php=php truephp;
php php php php php php php php php php php php php$thisphp-php>renderphp(php)php;
php php php php php php php php php php php php php$thisphp-php>php_isPartialRenderingphp php=php falsephp;
php php php php php php php php php php php php php$decoratorNamephp php=php substrphp(php$methodphp,php php6php)php;
php php php php php php php php php php php php ifphp php(falsephp php!php=php=php php(php$decoratorphp php=php php$thisphp-php>getDecoratorphp(php$decoratorNamephp)php)php)php php{
php php php php php php php php php php php php php php php php php$decoratorphp-php>setElementphp(php$thisphp)php;
php php php php php php php php php php php php php php php php php$seedphp php=php php'php'php;
php php php php php php php php php php php php php php php php ifphp php(php0php <php countphp(php$argsphp)php)php php{
php php php php php php php php php php php php php php php php php php php php php$seedphp php=php arrayphp_shiftphp(php$argsphp)php;
php php php php php php php php php php php php php php php php php}
php php php php php php php php php php php php php php php php returnphp php$decoratorphp-php>renderphp(php$seedphp)php;
php php php php php php php php php php php php php}

php php php php php php php php php php php php requirephp_oncephp php'Zendphp/Formphp/Elementphp/Exceptionphp.phpphp'php;
php php php php php php php php php php php php throwphp newphp Zendphp_Formphp_Elementphp_Exceptionphp(sprintfphp(php'Decoratorphp byphp namephp php%sphp doesphp notphp existphp'php,php php$decoratorNamephp)php)php;
php php php php php php php php php}

php php php php php php php php requirephp_oncephp php'Zendphp/Formphp/Elementphp/Exceptionphp.phpphp'php;
php php php php php php php php throwphp newphp Zendphp_Formphp_Elementphp_Exceptionphp(sprintfphp(php'Methodphp php%sphp doesphp notphp existphp'php,php php$methodphp)php)php;
php php php php php}

php php php php php/php/php Loaders

php php php php php/php*php*
php php php php php php*php Setphp pluginphp loaderphp tophp usephp forphp validatorphp orphp filterphp chain
php php php php php php*
php php php php php php*php php@paramphp php Zendphp_Loaderphp_PluginLoaderphp_Interfacephp php$loader
php php php php php php*php php@paramphp php stringphp php$typephp php'decoratorphp'php,php php'filterphp'php,php orphp php'validatephp'
php php php php php php*php php@returnphp Zendphp_Formphp_Element
php php php php php php*php php@throwsphp Zendphp_Formphp_Exceptionphp onphp invalidphp type
php php php php php php*php/
php php php php publicphp functionphp setPluginLoaderphp(Zendphp_Loaderphp_PluginLoaderphp_Interfacephp php$loaderphp,php php$typephp)
php php php php php{
php php php php php php php php php$typephp php=php strtoupperphp(php$typephp)php;
php php php php php php php php switchphp php(php$typephp)php php{
php php php php php php php php php php php php casephp selfphp:php:DECORATORphp:
php php php php php php php php php php php php casephp selfphp:php:FILTERphp:
php php php php php php php php php php php php casephp selfphp:php:VALIDATEphp:
php php php php php php php php php php php php php php php php php$thisphp-php>php_loadersphp[php$typephp]php php=php php$loaderphp;
php php php php php php php php php php php php php php php php returnphp php$thisphp;
php php php php php php php php php php php php defaultphp:
php php php php php php php php php php php php php php php php requirephp_oncephp php'Zendphp/Formphp/Exceptionphp.phpphp'php;
php php php php php php php php php php php php php php php php throwphp newphp Zendphp_Formphp_Exceptionphp(sprintfphp(php'Invalidphp typephp php"php%sphp"php providedphp tophp setPluginLoaderphp(php)php'php,php php$typephp)php)php;
php php php php php php php php php}
php php php php php}

php php php php php/php*php*
php php php php php php*php Retrievephp pluginphp loaderphp forphp validatorphp orphp filterphp chain
php php php php php php*
php php php php php php*php Instantiatesphp withphp defaultphp rulesphp ifphp nonephp availablephp forphp thatphp typephp.php Use
php php php php php php*php php'decoratorphp'php,php php'filterphp'php,php orphp php'validatephp'php forphp php$typephp.
php php php php php php*
php php php php php php*php php@paramphp php stringphp php$type
php php php php php php*php php@returnphp Zendphp_Loaderphp_PluginLoader
php php php php php php*php php@throwsphp Zendphp_Loaderphp_Exceptionphp onphp invalidphp typephp.
php php php php php php*php/
php php php php publicphp functionphp getPluginLoaderphp(php$typephp)
php php php php php{
php php php php php php php php php$typephp php=php strtoupperphp(php$typephp)php;
php php php php php php php php switchphp php(php$typephp)php php{
php php php php php php php php php php php php casephp selfphp:php:FILTERphp:
php php php php php php php php php php php php casephp selfphp:php:VALIDATEphp:
php php php php php php php php php php php php php php php php php$prefixSegmentphp php=php ucfirstphp(strtolowerphp(php$typephp)php)php;
php php php php php php php php php php php php php php php php php$pathSegmentphp php php php=php php$prefixSegmentphp;
php php php php php php php php php php php php casephp selfphp:php:DECORATORphp:
php php php php php php php php php php php php php php php php ifphp php(php!issetphp(php$prefixSegmentphp)php)php php{
php php php php php php php php php php php php php php php php php php php php php$prefixSegmentphp php=php php'Formphp_Decoratorphp'php;
php php php php php php php php php php php php php php php php php php php php php$pathSegmentphp php php php=php php'Formphp/Decoratorphp'php;
php php php php php php php php php php php php php php php php php}
php php php php php php php php php php php php php php php php ifphp php(php!issetphp(php$thisphp-php>php_loadersphp[php$typephp]php)php)php php{
php php php php php php php php php php php php php php php php php php php php requirephp_oncephp php'Zendphp/Loaderphp/PluginLoaderphp.phpphp'php;
php php php php php php php php php php php php php php php php php php php php php$thisphp-php>php_loadersphp[php$typephp]php php=php newphp Zendphp_Loaderphp_PluginLoaderphp(
php php php php php php php php php php php php php php php php php php php php php php php php arrayphp(php'Zendphp_php'php php.php php$prefixSegmentphp php.php php'php_php'php php=php>php php'Zendphp/php'php php.php php$pathSegmentphp php.php php'php/php'php)
php php php php php php php php php php php php php php php php php php php php php)php;
php php php php php php php php php php php php php php php php php}
php php php php php php php php php php php php php php php php returnphp php$thisphp-php>php_loadersphp[php$typephp]php;
php php php php php php php php php php php php defaultphp:
php php php php php php php php php php php php php php php php requirephp_oncephp php'Zendphp/Formphp/Exceptionphp.phpphp'php;
php php php php php php php php php php php php php php php php throwphp newphp Zendphp_Formphp_Exceptionphp(sprintfphp(php'Invalidphp typephp php"php%sphp"php providedphp tophp getPluginLoaderphp(php)php'php,php php$typephp)php)php;
php php php php php php php php php}
php php php php php}

php php php php php/php*php*
php php php php php php*php Addphp prefixphp pathphp forphp pluginphp loader
php php php php php php*
php php php php php php*php Ifphp nophp php$typephp specifiedphp,php assumesphp itphp isphp aphp basephp pathphp forphp bothphp filtersphp and
php php php php php php*php validatorsphp,php andphp setsphp eachphp accordingphp tophp thephp followingphp rulesphp:
php php php php php php*php php-php decoratorsphp:php php$prefixphp php=php php$prefixphp php.php php'php_Decoratorphp'
php php php php php php*php php-php filtersphp:php php$prefixphp php=php php$prefixphp php.php php'php_Filterphp'
php php php php php php*php php-php validatorsphp:php php$prefixphp php=php php$prefixphp php.php php'php_Validatephp'
php php php php php php*
php php php php php php*php Otherwisephp,php thephp pathphp prefixphp isphp setphp onphp thephp appropriatephp pluginphp loaderphp.
php php php php php php*
php php php php php php*php php@paramphp php stringphp php$prefix
php php php php php php*php php@paramphp php stringphp php$path
php php php php php php*php php@paramphp php stringphp php$type
php php php php php php*php php@returnphp Zendphp_Formphp_Element
php php php php php php*php php@throwsphp Zendphp_Formphp_Exceptionphp forphp invalidphp type
php php php php php php*php/
php php php php publicphp functionphp addPrefixPathphp(php$prefixphp,php php$pathphp,php php$typephp php=php nullphp)
php php php php php{
php php php php php php php php php$typephp php=php strtoupperphp(php$typephp)php;
php php php php php php php php switchphp php(php$typephp)php php{
php php php php php php php php php php php php casephp selfphp:php:DECORATORphp:
php php php php php php php php php php php php casephp selfphp:php:FILTERphp:
php php php php php php php php php php php php casephp selfphp:php:VALIDATEphp:
php php php php php php php php php php php php php php php php php$loaderphp php=php php$thisphp-php>getPluginLoaderphp(php$typephp)php;
php php php php php php php php php php php php php php php php php$loaderphp-php>addPrefixPathphp(php$prefixphp,php php$pathphp)php;
php php php php php php php php php php php php php php php php returnphp php$thisphp;
php php php php php php php php php php php php casephp nullphp:
php php php php php php php php php php php php php php php php php$prefixphp php=php rtrimphp(php$prefixphp,php php'php_php'php)php;
php php php php php php php php php php php php php php php php php$pathphp php php php=php rtrimphp(php$pathphp,php DIRECTORYphp_SEPARATORphp)php;
php php php php php php php php php php php php php php php php foreachphp php(arrayphp(selfphp:php:DECORATORphp,php selfphp:php:FILTERphp,php selfphp:php:VALIDATEphp)php asphp php$typephp)php php{
php php php php php php php php php php php php php php php php php php php php php$cTypephp php php php php php php php php=php ucfirstphp(strtolowerphp(php$typephp)php)php;
php php php php php php php php php php php php php php php php php php php php php$pluginPathphp php php php=php php$pathphp php.php DIRECTORYphp_SEPARATORphp php.php php$cTypephp php.php DIRECTORYphp_SEPARATORphp;
php php php php php php php php php php php php php php php php php php php php php$pluginPrefixphp php=php php$prefixphp php.php php'php_php'php php.php php$cTypephp;
php php php php php php php php php php php php php php php php php php php php php$loaderphp php php php php php php php=php php$thisphp-php>getPluginLoaderphp(php$typephp)php;
php php php php php php php php php php php php php php php php php php php php php$loaderphp-php>addPrefixPathphp(php$pluginPrefixphp,php php$pluginPathphp)php;
php php php php php php php php php php php php php php php php php}
php php php php php php php php php php php php php php php php returnphp php$thisphp;
php php php php php php php php php php php php defaultphp:
php php php php php php php php php php php php php php php php requirephp_oncephp php'Zendphp/Formphp/Exceptionphp.phpphp'php;
php php php php php php php php php php php php php php php php throwphp newphp Zendphp_Formphp_Exceptionphp(sprintfphp(php'Invalidphp typephp php"php%sphp"php providedphp tophp getPluginLoaderphp(php)php'php,php php$typephp)php)php;
php php php php php php php php php}
php php php php php}

php php php php php/php*php*
php php php php php php*php Addphp manyphp prefixphp pathsphp atphp once
php php php php php php*
php php php php php php*php php@paramphp php arrayphp php$spec
php php php php php php*php php@returnphp Zendphp_Formphp_Element
php php php php php php*php/
php php php php publicphp functionphp addPrefixPathsphp(arrayphp php$specphp)
php php php php php{
php php php php php php php php ifphp php(issetphp(php$specphp[php'prefixphp'php]php)php php&php&php issetphp(php$specphp[php'pathphp'php]php)php)php php{
php php php php php php php php php php php php returnphp php$thisphp-php>addPrefixPathphp(php$specphp[php'prefixphp'php]php,php php$specphp[php'pathphp'php]php)php;
php php php php php php php php php}
php php php php php php php php foreachphp php(php$specphp asphp php$typephp php=php>php php$pathsphp)php php{
php php php php php php php php php php php php ifphp php(isphp_numericphp(php$typephp)php php&php&php isphp_arrayphp(php$pathsphp)php)php php{
php php php php php php php php php php php php php php php php php$typephp php=php nullphp;
php php php php php php php php php php php php php php php php ifphp php(issetphp(php$pathsphp[php'prefixphp'php]php)php php&php&php issetphp(php$pathsphp[php'pathphp'php]php)php)php php{
php php php php php php php php php php php php php php php php php php php php ifphp php(issetphp(php$pathsphp[php'typephp'php]php)php)php php{
php php php php php php php php php php php php php php php php php php php php php php php php php$typephp php=php php$pathsphp[php'typephp'php]php;
php php php php php php php php php php php php php php php php php php php php php}
php php php php php php php php php php php php php php php php php php php php php$thisphp-php>addPrefixPathphp(php$pathsphp[php'prefixphp'php]php,php php$pathsphp[php'pathphp'php]php,php php$typephp)php;
php php php php php php php php php php php php php php php php php}
php php php php php php php php php php php php php}php elseifphp php(php!isphp_numericphp(php$typephp)php)php php{
php php php php php php php php php php php php php php php php ifphp php(php!issetphp(php$pathsphp[php'prefixphp'php]php)php php|php|php php!issetphp(php$pathsphp[php'pathphp'php]php)php)php php{
php php php php php php php php php php php php php php php php php php php php foreachphp php(php$pathsphp asphp php$prefixphp php=php>php php$specphp)php php{
php php php php php php php php php php php php php php php php php php php php php php php php ifphp php(isphp_arrayphp(php$specphp)php)php php{
php php php php php php php php php php php php php php php php php php php php php php php php php php php php foreachphp php(php$specphp asphp php$pathphp)php php{
php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php ifphp php(php!isphp_stringphp(php$pathphp)php)php php{
php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php continuephp;
php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php}
php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php$thisphp-php>addPrefixPathphp(php$prefixphp,php php$pathphp,php php$typephp)php;
php php php php php php php php php php php php php php php php php php php php php php php php php php php php php}
php php php php php php php php php php php php php php php php php php php php php php php php php}php elseifphp php(isphp_stringphp(php$specphp)php)php php{
php php php php php php php php php php php php php php php php php php php php php php php php php php php php php$thisphp-php>addPrefixPathphp(php$prefixphp,php php$specphp,php php$typephp)php;
php php php php php php php php php php php php php php php php php php php php php php php php php}
php php php php php php php php php php php php php php php php php php php php php}
php php php php php php php php php php php php php php php php php}php elsephp php{
php php php php php php php php php php php php php php php php php php php php php$thisphp-php>addPrefixPathphp(php$pathsphp[php'prefixphp'php]php,php php$pathsphp[php'pathphp'php]php,php php$typephp)php;
php php php php php php php php php php php php php php php php php}
php php php php php php php php php php php php php}
php php php php php php php php php}
php php php php php php php php returnphp php$thisphp;
php php php php php}

php php php php php/php/php Validation

php php php php php/php*php*
php php php php php php*php Addphp validatorphp tophp validationphp chain
php php php php php php*
php php php php php php*php Notephp:php willphp overwritephp existingphp validatorsphp ifphp theyphp arephp ofphp thephp samephp classphp.
php php php php php php*
php php php php php php*php php@paramphp php stringphp|Zendphp_Validatephp_Interfacephp php$validator
php php php php php php*php php@paramphp php boolphp php$breakChainOnFailure
php php php php php php*php php@paramphp php arrayphp php$options
php php php php php php*php php@returnphp Zendphp_Formphp_Element
php php php php php php*php php@throwsphp Zendphp_Formphp_Exceptionphp ifphp invalidphp validatorphp type
php php php php php php*php/
php php php php publicphp functionphp addValidatorphp(php$validatorphp,php php$breakChainOnFailurephp php=php falsephp,php php$optionsphp php=php arrayphp(php)php)
php php php php php{
php php php php php php php php ifphp php(php$validatorphp instanceofphp Zendphp_Validatephp_Interfacephp)php php{
php php php php php php php php php php php php php$namephp php=php getphp_classphp(php$validatorphp)php;

php php php php php php php php php php php php ifphp php(php!issetphp(php$validatorphp-php>zfBreakChainOnFailurephp)php)php php{
php php php php php php php php php php php php php php php php php$validatorphp-php>zfBreakChainOnFailurephp php=php php$breakChainOnFailurephp;
php php php php php php php php php php php php php}
php php php php php php php php php}php elseifphp php(isphp_stringphp(php$validatorphp)php)php php{
php php php php php php php php php php php php php$namephp php php php php php php=php php$validatorphp;
php php php php php php php php php php php php php$validatorphp php=php arrayphp(
php php php php php php php php php php php php php php php php php'validatorphp'php php=php>php php$validatorphp,
php php php php php php php php php php php php php php php php php'breakChainOnFailurephp'php php=php>php php$breakChainOnFailurephp,
php php php php php php php php php php php php php php php php php'optionsphp'php php php php php php php php php php php php php php=php>php php$optionsphp,
php php php php php php php php php php php php php)php;
php php php php php php php php php}php elsephp php{
php php php php php php php php php php php php requirephp_oncephp php'Zendphp/Formphp/Exceptionphp.phpphp'php;
php php php php php php php php php php php php throwphp newphp Zendphp_Formphp_Exceptionphp(php'Invalidphp validatorphp providedphp tophp addValidatorphp;php mustphp bephp stringphp orphp Zendphp_Validatephp_Interfacephp'php)php;
php php php php php php php php php}


php php php php php php php php php$thisphp-php>php_validatorsphp[php$namephp]php php=php php$validatorphp;

php php php php php php php php returnphp php$thisphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Addphp multiplephp validators
php php php php php php*
php php php php php php*php php@paramphp php arrayphp php$validators
php php php php php php*php php@returnphp Zendphp_Formphp_Element
php php php php php php*php/
php php php php publicphp functionphp addValidatorsphp(arrayphp php$validatorsphp)
php php php php php{
php php php php php php php php foreachphp php(php$validatorsphp asphp php$validatorInfophp)php php{
php php php php php php php php php php php php ifphp php(isphp_stringphp(php$validatorInfophp)php)php php{
php php php php php php php php php php php php php php php php php$thisphp-php>addValidatorphp(php$validatorInfophp)php;
php php php php php php php php php php php php php}php elseifphp php(php$validatorInfophp instanceofphp Zendphp_Validatephp_Interfacephp)php php{
php php php php php php php php php php php php php php php php php$thisphp-php>addValidatorphp(php$validatorInfophp)php;
php php php php php php php php php php php php php}php elseifphp php(isphp_arrayphp(php$validatorInfophp)php)php php{
php php php php php php php php php php php php php php php php php$argcphp php php php php php php php php php php php php php php php php=php countphp(php$validatorInfophp)php;
php php php php php php php php php php php php php php php php php$breakChainOnFailurephp php=php falsephp;
php php php php php php php php php php php php php php php php php$optionsphp php php php php php php php php php php php php php=php arrayphp(php)php;
php php php php php php php php php php php php php php php php ifphp php(issetphp(php$validatorInfophp[php'validatorphp'php]php)php)php php{
php php php php php php php php php php php php php php php php php php php php php$validatorphp php=php php$validatorInfophp[php'validatorphp'php]php;
php php php php php php php php php php php php php php php php php php php php ifphp php(issetphp(php$validatorInfophp[php'breakChainOnFailurephp'php]php)php)php php{
php php php php php php php php php php php php php php php php php php php php php php php php php$breakChainOnFailurephp php=php php$validatorInfophp[php'breakChainOnFailurephp'php]php;
php php php php php php php php php php php php php php php php php php php php php}
php php php php php php php php php php php php php php php php php php php php ifphp php(issetphp(php$validatorInfophp[php'optionsphp'php]php)php)php php{
php php php php php php php php php php php php php php php php php php php php php php php php php$optionsphp php=php php$validatorInfophp[php'optionsphp'php]php;
php php php php php php php php php php php php php php php php php php php php php}
php php php php php php php php php php php php php php php php php php php php php$thisphp-php>addValidatorphp(php$validatorphp,php php$breakChainOnFailurephp,php php$optionsphp)php;
php php php php php php php php php php php php php php php php php}php elsephp php{
php php php php php php php php php php php php php php php php php php php php switchphp php(truephp)php php{
php php php php php php php php php php php php php php php php php php php php php php php php casephp php(php0php php=php=php php$argcphp)php:
php php php php php php php php php php php php php php php php php php php php php php php php php php php php breakphp;
php php php php php php php php php php php php php php php php php php php php php php php php casephp php(php1php <php=php php$argcphp)php:
php php php php php php php php php php php php php php php php php php php php php php php php php php php php php$validatorphp php php=php arrayphp_shiftphp(php$validatorInfophp)php;
php php php php php php php php php php php php php php php php php php php php php php php php casephp php(php2php <php=php php$argcphp)php:
php php php php php php php php php php php php php php php php php php php php php php php php php php php php php$breakChainOnFailurephp php=php arrayphp_shiftphp(php$validatorInfophp)php;
php php php php php php php php php php php php php php php php php php php php php php php php casephp php(php3php <php=php php$argcphp)php:
php php php php php php php php php php php php php php php php php php php php php php php php php php php php php$optionsphp php=php arrayphp_shiftphp(php$validatorInfophp)php;
php php php php php php php php php php php php php php php php php php php php php php php php defaultphp:
php php php php php php php php php php php php php php php php php php php php php php php php php php php php php$thisphp-php>addValidatorphp(php$validatorphp,php php$breakChainOnFailurephp,php php$optionsphp)php;
php php php php php php php php php php php php php php php php php php php php php php php php php php php php breakphp;
php php php php php php php php php php php php php php php php php php php php php}
php php php php php php php php php php php php php php php php php}
php php php php php php php php php php php php php}php elsephp php{
php php php php php php php php php php php php php php php php requirephp_oncephp php'Zendphp/Formphp/Exceptionphp.phpphp'php;
php php php php php php php php php php php php php php php php throwphp newphp Zendphp_Formphp_Exceptionphp(php'Invalidphp validatorphp passedphp tophp addValidatorsphp(php)php'php)php;
php php php php php php php php php php php php php}
php php php php php php php php php}

php php php php php php php php returnphp php$thisphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Setphp multiplephp validatorsphp,php overwritingphp previousphp validators
php php php php php php*
php php php php php php*php php@paramphp php arrayphp php$validators
php php php php php php*php php@returnphp Zendphp_Formphp_Element
php php php php php php*php/
php php php php publicphp functionphp setValidatorsphp(arrayphp php$validatorsphp)
php php php php php{
php php php php php php php php php$thisphp-php>clearValidatorsphp(php)php;
php php php php php php php php returnphp php$thisphp-php>addValidatorsphp(php$validatorsphp)php;
php php php php php}

php php php php php/php*php*
php php php php php php*php Retrievephp aphp singlephp validatorphp byphp name
php php php php php php*
php php php php php php*php php@paramphp php stringphp php$name
php php php php php php*php php@returnphp Zendphp_Validatephp_Interfacephp|falsephp Falsephp ifphp notphp foundphp,php validatorphp otherwise
php php php php php php*php/
php php php php publicphp functionphp getValidatorphp(php$namephp)
php php php php php{
php php php php php php php php ifphp php(php!issetphp(php$thisphp-php>php_validatorsphp[php$namephp]php)php)php php{
php php php php php php php php php php php php php$lenphp php=php strlenphp(php$namephp)php;
php php php php php php php php php php php php foreachphp php(php$thisphp-php>php_validatorsphp asphp php$localNamephp php=php>php php$validatorphp)php php{
php php php php php php php php php php php php php php php php ifphp php(php$lenphp php>php strlenphp(php$localNamephp)php)php php{
php php php php php php php php php php php php php php php php php php php php continuephp;
php php php php php php php php php php php php php php php php php}
php php php php php php php php php php php php php php php php ifphp php(php0php php=php=php=php substrphp_comparephp(php$localNamephp,php php$namephp,php php-php$lenphp,php php$lenphp,php truephp)php)php php{
php php php php php php php php php php php php php php php php php php php php ifphp php(isphp_arrayphp(php$validatorphp)php)php php{
php php php php php php php php php php php php php php php php php php php php php php php php returnphp php$thisphp-php>php_loadValidatorphp(php$validatorphp)php;
php php php php php php php php php php php php php php php php php php php php php}
php php php php php php php php php php php php php php php php php php php php returnphp php$validatorphp;
php php php php php php php php php php php php php php php php php}
php php php php php php php php php php php php php}
php php php php php php php php php php php php returnphp falsephp;
php php php php php php php php php}

php php php php php php php php ifphp php(isphp_arrayphp(php$thisphp-php>php_validatorsphp[php$namephp]php)php)php php{
php php php php php php php php php php php php returnphp php$thisphp-php>php_loadValidatorphp(php$thisphp-php>php_validatorsphp[php$namephp]php)php;
php php php php php php php php php}

php php php php php php php php returnphp php$thisphp-php>php_validatorsphp[php$namephp]php;
php php php php php}

php php php php php/php*php*
php php php php php php*php Retrievephp allphp validators
php php php php php php*
php php php php php php*php php@returnphp array
php php php php php php*php/
php php php php publicphp functionphp getValidatorsphp(php)
php php php php php{
php php php php php php php php php$validatorsphp php=php arrayphp(php)php;
php php php php php php php php foreachphp php(php$thisphp-php>php_validatorsphp asphp php$keyphp php=php>php php$valuephp)php php{
php php php php php php php php php php php php ifphp php(php$valuephp instanceofphp Zendphp_Validatephp_Interfacephp)php php{
php php php php php php php php php php php php php php php php php$validatorsphp[php$keyphp]php php=php php$valuephp;
php php php php php php php php php php php php php php php php continuephp;
php php php php php php php php php php php php php}
php php php php php php php php php php php php php$validatorphp php=php php$thisphp-php>php_loadValidatorphp(php$valuephp)php;
php php php php php php php php php php php php php$validatorsphp[getphp_classphp(php$validatorphp)php]php php=php php$validatorphp;
php php php php php php php php php}
php php php php php php php php returnphp php$validatorsphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Removephp aphp singlephp validatorphp byphp name
php php php php php php*
php php php php php php*php php@paramphp php stringphp php$name
php php php php php php*php php@returnphp bool
php php php php php php*php/
php php php php publicphp functionphp removeValidatorphp(php$namephp)
php php php php php{
php php php php php php php php ifphp php(issetphp(php$thisphp-php>php_validatorsphp[php$namephp]php)php)php php{
php php php php php php php php php php php php unsetphp(php$thisphp-php>php_validatorsphp[php$namephp]php)php;
php php php php php php php php php}php elsephp php{
php php php php php php php php php php php php php$lenphp php=php strlenphp(php$namephp)php;
php php php php php php php php php php php php foreachphp php(arrayphp_keysphp(php$thisphp-php>php_validatorsphp)php asphp php$validatorphp)php php{
php php php php php php php php php php php php php php php php ifphp php(php$lenphp php>php strlenphp(php$validatorphp)php)php php{
php php php php php php php php php php php php php php php php php php php php continuephp;
php php php php php php php php php php php php php php php php php}
php php php php php php php php php php php php php php php php ifphp php(php0php php=php=php=php substrphp_comparephp(php$validatorphp,php php$namephp,php php-php$lenphp,php php$lenphp,php truephp)php)php php{
php php php php php php php php php php php php php php php php php php php php unsetphp(php$thisphp-php>php_validatorsphp[php$validatorphp]php)php;
php php php php php php php php php php php php php php php php php php php php breakphp;
php php php php php php php php php php php php php php php php php}
php php php php php php php php php php php php php}
php php php php php php php php php}

php php php php php php php php returnphp php$thisphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Clearphp allphp validators
php php php php php php*
php php php php php php*php php@returnphp Zendphp_Formphp_Element
php php php php php php*php/
php php php php publicphp functionphp clearValidatorsphp(php)
php php php php php{
php php php php php php php php php$thisphp-php>php_validatorsphp php=php arrayphp(php)php;
php php php php php php php php returnphp php$thisphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Validatephp elementphp value
php php php php php php*
php php php php php php*php Ifphp aphp translationphp adapterphp isphp registeredphp,php anyphp errorphp messagesphp willphp be
php php php php php php*php translatedphp accordingphp tophp thephp currentphp localephp,php usingphp thephp givenphp errorphp codephp;
php php php php php php*php ifphp nophp matchingphp translationphp isphp foundphp,php thephp originalphp messagephp willphp be
php php php php php php*php utilizedphp.
php php php php php php*
php php php php php php*php Notephp:php Thephp php*filteredphp*php valuephp isphp validatedphp.
php php php php php php*
php php php php php php*php php@paramphp php mixedphp php$value
php php php php php php*php php@paramphp php mixedphp php$context
php php php php php php*php php@returnphp boolean
php php php php php php*php/
php php php php publicphp functionphp isValidphp(php$valuephp,php php$contextphp php=php nullphp)
php php php php php{
php php php php php php php php php$thisphp-php>setValuephp(php$valuephp)php;
php php php php php php php php php$valuephp php=php php$thisphp-php>getValuephp(php)php;

php php php php php php php php ifphp php(php(php(php'php'php php=php=php=php php$valuephp)php php|php|php php(nullphp php=php=php=php php$valuephp)php)
php php php php php php php php php php php php php&php&php php!php$thisphp-php>isRequiredphp(php)
php php php php php php php php php php php php php&php&php php$thisphp-php>getAllowEmptyphp(php)
php php php php php php php php php)php php{
php php php php php php php php php php php php returnphp truephp;
php php php php php php php php php}

php php php php php php php php ifphp php(php$thisphp-php>isRequiredphp(php)
php php php php php php php php php php php php php&php&php php$thisphp-php>autoInsertNotEmptyValidatorphp(php)
php php php php php php php php php php php php php&php&php php!php$thisphp-php>getValidatorphp(php'NotEmptyphp'php)php)
php php php php php php php php php{
php php php php php php php php php php php php php$validatorsphp php=php php$thisphp-php>getValidatorsphp(php)php;
php php php php php php php php php php php php php$notEmptyphp php php php=php arrayphp(php'validatorphp'php php=php>php php'NotEmptyphp'php,php php'breakChainOnFailurephp'php php=php>php truephp)php;
php php php php php php php php php php php php arrayphp_unshiftphp(php$validatorsphp,php php$notEmptyphp)php;
php php php php php php php php php php php php php$thisphp-php>setValidatorsphp(php$validatorsphp)php;
php php php php php php php php php}

php php php php php php php php php/php/php Findphp thephp correctphp translatorphp.php Zendphp_Validatephp_Abstractphp:php:getDefaultTranslatorphp(php)
php php php php php php php php php/php/php willphp getphp eitherphp thephp staticphp translatorphp attachedphp tophp Zendphp_Validatephp_Abstract
php php php php php php php php php/php/php orphp thephp php'Zendphp_Translatephp'php fromphp Zendphp_Registryphp.
php php php php php php php php ifphp php(Zendphp_Validatephp_Abstractphp:php:hasDefaultTranslatorphp(php)php php&php&
php php php php php php php php php php php php php!Zendphp_Formphp:php:hasDefaultTranslatorphp(php)php)
php php php php php php php php php{
php php php php php php php php php php php php php$translatorphp php=php Zendphp_Validatephp_Abstractphp:php:getDefaultTranslatorphp(php)php;
php php php php php php php php php php php php ifphp php(php$thisphp-php>hasTranslatorphp(php)php)php php{
php php php php php php php php php php php php php php php php php/php/php onlyphp pickphp upphp thisphp elementphp'sphp translatorphp ifphp itphp wasphp attachedphp directlyphp.
php php php php php php php php php php php php php php php php php$translatorphp php=php php$thisphp-php>getTranslatorphp(php)php;
php php php php php php php php php php php php php}
php php php php php php php php php}php elsephp php{
php php php php php php php php php php php php php$translatorphp php=php php$thisphp-php>getTranslatorphp(php)php;
php php php php php php php php php}

php php php php php php php php php$thisphp-php>php_messagesphp php=php arrayphp(php)php;
php php php php php php php php php$thisphp-php>php_errorsphp php php php=php arrayphp(php)php;
php php php php php php php php php$resultphp php php php php php php php php php php=php truephp;
php php php php php php php php php$isArrayphp php php php php php php php php php=php php$thisphp-php>isArrayphp(php)php;
php php php php php php php php foreachphp php(php$thisphp-php>getValidatorsphp(php)php asphp php$keyphp php=php>php php$validatorphp)php php{
php php php php php php php php php php php php ifphp php(methodphp_existsphp(php$validatorphp,php php'setTranslatorphp'php)php)php php{
php php php php php php php php php php php php php php php php ifphp php(methodphp_existsphp(php$validatorphp,php php'hasTranslatorphp'php)php)php php{
php php php php php php php php php php php php php php php php php php php php ifphp php(php!php$validatorphp-php>hasTranslatorphp(php)php)php php{
php php php php php php php php php php php php php php php php php php php php php php php php php$validatorphp-php>setTranslatorphp(php$translatorphp)php;
php php php php php php php php php php php php php php php php php php php php php}
php php php php php php php php php php php php php php php php php}php elsephp php{
php php php php php php php php php php php php php php php php php php php php php$validatorphp-php>setTranslatorphp(php$translatorphp)php;
php php php php php php php php php php php php php php php php php}
php php php php php php php php php php php php php}

php php php php php php php php php php php php ifphp php(methodphp_existsphp(php$validatorphp,php php'setDisableTranslatorphp'php)php)php php{
php php php php php php php php php php php php php php php php php$validatorphp-php>setDisableTranslatorphp(php$thisphp-php>translatorIsDisabledphp(php)php)php;
php php php php php php php php php php php php php}

php php php php php php php php php php php php ifphp php(php$isArrayphp php&php&php isphp_arrayphp(php$valuephp)php)php php{
php php php php php php php php php php php php php php php php php$messagesphp php=php arrayphp(php)php;
php php php php php php php php php php php php php php php php php$errorsphp php php php=php arrayphp(php)php;
php php php php php php php php php php php php php php php php foreachphp php(php$valuephp asphp php$valphp)php php{
php php php php php php php php php php php php php php php php php php php php ifphp php(php!php$validatorphp-php>isValidphp(php$valphp,php php$contextphp)php)php php{
php php php php php php php php php php php php php php php php php php php php php php php php php$resultphp php=php falsephp;
php php php php php php php php php php php php php php php php php php php php php php php php ifphp php(php$thisphp-php>php_hasErrorMessagesphp(php)php)php php{
php php php php php php php php php php php php php php php php php php php php php php php php php php php php php$messagesphp php=php php$thisphp-php>php_getErrorMessagesphp(php)php;
php php php php php php php php php php php php php php php php php php php php php php php php php php php php php$errorsphp php php php=php php$messagesphp;
php php php php php php php php php php php php php php php php php php php php php php php php php}php elsephp php{
php php php php php php php php php php php php php php php php php php php php php php php php php php php php php$messagesphp php=php arrayphp_mergephp(php$messagesphp,php php$validatorphp-php>getMessagesphp(php)php)php;
php php php php php php php php php php php php php php php php php php php php php php php php php php php php php$errorsphp php php php=php arrayphp_mergephp(php$errorsphp,php php php php$validatorphp-php>getErrorsphp(php)php)php;
php php php php php php php php php php php php php php php php php php php php php php php php php}
php php php php php php php php php php php php php php php php php php php php php}
php php php php php php php php php php php php php php php php php}
php php php php php php php php php php php php php php php php ifphp php(php$resultphp)php php{
php php php php php php php php php php php php php php php php php php php php continuephp;
php php php php php php php php php php php php php php php php php}
php php php php php php php php php php php php php}php elseifphp php(php$validatorphp-php>isValidphp(php$valuephp,php php$contextphp)php)php php{
php php php php php php php php php php php php php php php php continuephp;
php php php php php php php php php php php php php}php elsephp php{
php php php php php php php php php php php php php php php php php$resultphp php=php falsephp;
php php php php php php php php php php php php php php php php ifphp php(php$thisphp-php>php_hasErrorMessagesphp(php)php)php php{
php php php php php php php php php php php php php php php php php php php php php$messagesphp php=php php$thisphp-php>php_getErrorMessagesphp(php)php;
php php php php php php php php php php php php php php php php php php php php php$errorsphp php php php=php php$messagesphp;
php php php php php php php php php php php php php php php php php}php elsephp php{
php php php php php php php php php php php php php php php php php php php php php$messagesphp php=php php$validatorphp-php>getMessagesphp(php)php;
php php php php php php php php php php php php php php php php php php php php php$errorsphp php php php=php arrayphp_keysphp(php$messagesphp)php;
php php php php php php php php php php php php php php php php php}
php php php php php php php php php php php php php}

php php php php php php php php php php php php php$resultphp php php php php php php php php php php=php falsephp;
php php php php php php php php php php php php php$thisphp-php>php_messagesphp php=php arrayphp_mergephp(php$thisphp-php>php_messagesphp,php php$messagesphp)php;
php php php php php php php php php php php php php$thisphp-php>php_errorsphp php php php=php arrayphp_mergephp(php$thisphp-php>php_errorsphp,php php php php$errorsphp)php;

php php php php php php php php php php php php ifphp php(php$validatorphp-php>zfBreakChainOnFailurephp)php php{
php php php php php php php php php php php php php php php php breakphp;
php php php php php php php php php php php php php}
php php php php php php php php php}

php php php php php php php php php/php/php Ifphp elementphp manuallyphp flaggedphp asphp invalidphp,php returnphp false
php php php php php php php php ifphp php(php$thisphp-php>php_isErrorForcedphp)php php{
php php php php php php php php php php php php returnphp falsephp;
php php php php php php php php php}

php php php php php php php php returnphp php$resultphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Addphp aphp customphp errorphp messagephp tophp returnphp inphp thephp eventphp ofphp failedphp validation
php php php php php php*
php php php php php php*php php@paramphp php stringphp php$message
php php php php php php*php php@returnphp Zendphp_Formphp_Element
php php php php php php*php/
php php php php publicphp functionphp addErrorMessagephp(php$messagephp)
php php php php php{
php php php php php php php php php$thisphp-php>php_errorMessagesphp[php]php php=php php(stringphp)php php$messagephp;
php php php php php php php php returnphp php$thisphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Addphp multiplephp customphp errorphp messagesphp tophp returnphp inphp thephp eventphp ofphp failedphp validation
php php php php php php*
php php php php php php*php php@paramphp php arrayphp php$messages
php php php php php php*php php@returnphp Zendphp_Formphp_Element
php php php php php php*php/
php php php php publicphp functionphp addErrorMessagesphp(arrayphp php$messagesphp)
php php php php php{
php php php php php php php php foreachphp php(php$messagesphp asphp php$messagephp)php php{
php php php php php php php php php php php php php$thisphp-php>addErrorMessagephp(php$messagephp)php;
php php php php php php php php php}
php php php php php php php php returnphp php$thisphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Samephp asphp addErrorMessagesphp(php)php,php butphp clearsphp customphp errorphp messagephp stackphp first
php php php php php php*
php php php php php php*php php@paramphp php arrayphp php$messages
php php php php php php*php php@returnphp Zendphp_Formphp_Element
php php php php php php*php/
php php php php publicphp functionphp setErrorMessagesphp(arrayphp php$messagesphp)
php php php php php{
php php php php php php php php php$thisphp-php>clearErrorMessagesphp(php)php;
php php php php php php php php returnphp php$thisphp-php>addErrorMessagesphp(php$messagesphp)php;
php php php php php}

php php php php php/php*php*
php php php php php php*php Retrievephp customphp errorphp messages
php php php php php php*
php php php php php php*php php@returnphp array
php php php php php php*php/
php php php php publicphp functionphp getErrorMessagesphp(php)
php php php php php{
php php php php php php php php returnphp php$thisphp-php>php_errorMessagesphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Clearphp customphp errorphp messagesphp stack
php php php php php php*
php php php php php php*php php@returnphp Zendphp_Formphp_Element
php php php php php php*php/
php php php php publicphp functionphp clearErrorMessagesphp(php)
php php php php php{
php php php php php php php php php$thisphp-php>php_errorMessagesphp php=php arrayphp(php)php;
php php php php php php php php returnphp php$thisphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Getphp errorMessageSeparator
php php php php php php*
php php php php php php*php php@returnphp string
php php php php php php*php/
php php php php publicphp functionphp getErrorMessageSeparatorphp(php)
php php php php php{
php php php php php php php php returnphp php$thisphp-php>php_errorMessageSeparatorphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Setphp errorMessageSeparator
php php php php php php*
php php php php php php*php php@paramphp php stringphp php$separator
php php php php php php*php php@returnphp Zendphp_Formphp_Element
php php php php php php*php/
php php php php publicphp functionphp setErrorMessageSeparatorphp(php$separatorphp)
php php php php php{
php php php php php php php php php$thisphp-php>php_errorMessageSeparatorphp php=php php$separatorphp;
php php php php php php php php returnphp php$thisphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Markphp thephp elementphp asphp beingphp inphp aphp failedphp validationphp state
php php php php php php*
php php php php php php*php php@returnphp Zendphp_Formphp_Element
php php php php php php*php/
php php php php publicphp functionphp markAsErrorphp(php)
php php php php php{
php php php php php php php php php$messagesphp php php php php php php php=php php$thisphp-php>getMessagesphp(php)php;
php php php php php php php php php$customMessagesphp php=php php$thisphp-php>php_getErrorMessagesphp(php)php;
php php php php php php php php php$messagesphp php php php php php php php=php php$messagesphp php+php php$customMessagesphp;
php php php php php php php php ifphp php(emptyphp(php$messagesphp)php)php php{
php php php php php php php php php php php php php$thisphp-php>php_isErrorphp php=php truephp;
php php php php php php php php php}php elsephp php{
php php php php php php php php php php php php php$thisphp-php>php_messagesphp php=php php$messagesphp;
php php php php php php php php php}
php php php php php php php php php$thisphp-php>php_isErrorForcedphp php=php truephp;
php php php php php php php php returnphp php$thisphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Addphp anphp errorphp messagephp andphp markphp elementphp asphp failedphp validation
php php php php php php*
php php php php php php*php php@paramphp php stringphp php$message
php php php php php php*php php@returnphp Zendphp_Formphp_Element
php php php php php php*php/
php php php php publicphp functionphp addErrorphp(php$messagephp)
php php php php php{
php php php php php php php php php$thisphp-php>addErrorMessagephp(php$messagephp)php;
php php php php php php php php php$thisphp-php>markAsErrorphp(php)php;
php php php php php php php php returnphp php$thisphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Addphp multiplephp errorphp messagesphp andphp flagphp elementphp asphp failedphp validation
php php php php php php*
php php php php php php*php php@paramphp php arrayphp php$messages
php php php php php php*php php@returnphp Zendphp_Formphp_Element
php php php php php php*php/
php php php php publicphp functionphp addErrorsphp(arrayphp php$messagesphp)
php php php php php{
php php php php php php php php foreachphp php(php$messagesphp asphp php$messagephp)php php{
php php php php php php php php php php php php php$thisphp-php>addErrorphp(php$messagephp)php;
php php php php php php php php php}
php php php php php php php php returnphp php$thisphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Overwritephp anyphp previouslyphp setphp errorphp messagesphp andphp flagphp asphp failedphp validation
php php php php php php*
php php php php php php*php php@paramphp php arrayphp php$messages
php php php php php php*php php@returnphp Zendphp_Formphp_Element
php php php php php php*php/
php php php php publicphp functionphp setErrorsphp(arrayphp php$messagesphp)
php php php php php{
php php php php php php php php php$thisphp-php>clearErrorMessagesphp(php)php;
php php php php php php php php returnphp php$thisphp-php>addErrorsphp(php$messagesphp)php;
php php php php php}

php php php php php/php*php*
php php php php php php*php Arephp therephp errorsphp registeredphp?
php php php php php php*
php php php php php php*php php@returnphp bool
php php php php php php*php/
php php php php publicphp functionphp hasErrorsphp(php)
php php php php php{
php php php php php php php php returnphp php(php!emptyphp(php$thisphp-php>php_messagesphp)php php|php|php php$thisphp-php>php_isErrorphp)php;
php php php php php}

php php php php php/php*php*
php php php php php php*php Retrievephp validatorphp chainphp errors
php php php php php php*
php php php php php php*php php@returnphp array
php php php php php php*php/
php php php php publicphp functionphp getErrorsphp(php)
php php php php php{
php php php php php php php php returnphp php$thisphp-php>php_errorsphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Retrievephp errorphp messages
php php php php php php*
php php php php php php*php php@returnphp array
php php php php php php*php/
php php php php publicphp functionphp getMessagesphp(php)
php php php php php{
php php php php php php php php returnphp php$thisphp-php>php_messagesphp;
php php php php php}


php php php php php/php/php Filtering

php php php php php/php*php*
php php php php php php*php Addphp aphp filterphp tophp thephp element
php php php php php php*
php php php php php php*php php@paramphp php stringphp|Zendphp_Filterphp_Interfacephp php$filter
php php php php php php*php php@returnphp Zendphp_Formphp_Element
php php php php php php*php/
php php php php publicphp functionphp addFilterphp(php$filterphp,php php$optionsphp php=php arrayphp(php)php)
php php php php php{
php php php php php php php php ifphp php(php$filterphp instanceofphp Zendphp_Filterphp_Interfacephp)php php{
php php php php php php php php php php php php php$namephp php=php getphp_classphp(php$filterphp)php;
php php php php php php php php php}php elseifphp php(isphp_stringphp(php$filterphp)php)php php{
php php php php php php php php php php php php php$namephp php=php php$filterphp;
php php php php php php php php php php php php php$filterphp php=php arrayphp(
php php php php php php php php php php php php php php php php php'filterphp'php php php=php>php php$filterphp,
php php php php php php php php php php php php php php php php php'optionsphp'php php=php>php php$optionsphp,
php php php php php php php php php php php php php)php;
php php php php php php php php php php php php php$thisphp-php>php_filtersphp[php$namephp]php php=php php$filterphp;
php php php php php php php php php}php elsephp php{
php php php php php php php php php php php php requirephp_oncephp php'Zendphp/Formphp/Exceptionphp.phpphp'php;
php php php php php php php php php php php php throwphp newphp Zendphp_Formphp_Exceptionphp(php'Invalidphp filterphp providedphp tophp addFilterphp;php mustphp bephp stringphp orphp Zendphp_Filterphp_Interfacephp'php)php;
php php php php php php php php php}

php php php php php php php php php$thisphp-php>php_filtersphp[php$namephp]php php=php php$filterphp;

php php php php php php php php returnphp php$thisphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Addphp filtersphp tophp element
php php php php php php*
php php php php php php*php php@paramphp php arrayphp php$filters
php php php php php php*php php@returnphp Zendphp_Formphp_Element
php php php php php php*php/
php php php php publicphp functionphp addFiltersphp(arrayphp php$filtersphp)
php php php php php{
php php php php php php php php foreachphp php(php$filtersphp asphp php$filterInfophp)php php{
php php php php php php php php php php php php ifphp php(isphp_stringphp(php$filterInfophp)php)php php{
php php php php php php php php php php php php php php php php php$thisphp-php>addFilterphp(php$filterInfophp)php;
php php php php php php php php php php php php php}php elseifphp php(php$filterInfophp instanceofphp Zendphp_Filterphp_Interfacephp)php php{
php php php php php php php php php php php php php php php php php$thisphp-php>addFilterphp(php$filterInfophp)php;
php php php php php php php php php php php php php}php elseifphp php(isphp_arrayphp(php$filterInfophp)php)php php{
php php php php php php php php php php php php php php php php php$argcphp php php php php php php php php php php php php php php php php=php countphp(php$filterInfophp)php;
php php php php php php php php php php php php php php php php php$optionsphp php php php php php php php php php php php php php=php arrayphp(php)php;
php php php php php php php php php php php php php php php php ifphp php(issetphp(php$filterInfophp[php'filterphp'php]php)php)php php{
php php php php php php php php php php php php php php php php php php php php php$filterphp php=php php$filterInfophp[php'filterphp'php]php;
php php php php php php php php php php php php php php php php php php php php ifphp php(issetphp(php$filterInfophp[php'optionsphp'php]php)php)php php{
php php php php php php php php php php php php php php php php php php php php php php php php php$optionsphp php=php php$filterInfophp[php'optionsphp'php]php;
php php php php php php php php php php php php php php php php php php php php php}
php php php php php php php php php php php php php php php php php php php php php$thisphp-php>addFilterphp(php$filterphp,php php$optionsphp)php;
php php php php php php php php php php php php php php php php php}php elsephp php{
php php php php php php php php php php php php php php php php php php php php switchphp php(truephp)php php{
php php php php php php php php php php php php php php php php php php php php php php php php casephp php(php0php php=php=php php$argcphp)php:
php php php php php php php php php php php php php php php php php php php php php php php php php php php php breakphp;
php php php php php php php php php php php php php php php php php php php php php php php php casephp php(php1php <php=php php$argcphp)php:
php php php php php php php php php php php php php php php php php php php php php php php php php php php php php$filterphp php php=php arrayphp_shiftphp(php$filterInfophp)php;
php php php php php php php php php php php php php php php php php php php php php php php php casephp php(php2php <php=php php$argcphp)php:
php php php php php php php php php php php php php php php php php php php php php php php php php php php php php$optionsphp php=php arrayphp_shiftphp(php$filterInfophp)php;
php php php php php php php php php php php php php php php php php php php php php php php php defaultphp:
php php php php php php php php php php php php php php php php php php php php php php php php php php php php php$thisphp-php>addFilterphp(php$filterphp,php php$optionsphp)php;
php php php php php php php php php php php php php php php php php php php php php php php php php php php php breakphp;
php php php php php php php php php php php php php php php php php php php php php}
php php php php php php php php php php php php php php php php php}
php php php php php php php php php php php php php}php elsephp php{
php php php php php php php php php php php php php php php php requirephp_oncephp php'Zendphp/Formphp/Exceptionphp.phpphp'php;
php php php php php php php php php php php php php php php php throwphp newphp Zendphp_Formphp_Exceptionphp(php'Invalidphp filterphp passedphp tophp addFiltersphp(php)php'php)php;
php php php php php php php php php php php php php}
php php php php php php php php php}

php php php php php php php php returnphp php$thisphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Addphp filtersphp tophp elementphp,php overwritingphp anyphp alreadyphp existing
php php php php php php*
php php php php php php*php php@paramphp php arrayphp php$filters
php php php php php php*php php@returnphp Zendphp_Formphp_Element
php php php php php php*php/
php php php php publicphp functionphp setFiltersphp(arrayphp php$filtersphp)
php php php php php{
php php php php php php php php php$thisphp-php>clearFiltersphp(php)php;
php php php php php php php php returnphp php$thisphp-php>addFiltersphp(php$filtersphp)php;
php php php php php}

php php php php php/php*php*
php php php php php php*php Retrievephp aphp singlephp filterphp byphp name
php php php php php php*
php php php php php php*php php@paramphp php stringphp php$name
php php php php php php*php php@returnphp Zendphp_Filterphp_Interface
php php php php php php*php/
php php php php publicphp functionphp getFilterphp(php$namephp)
php php php php php{
php php php php php php php php ifphp php(php!issetphp(php$thisphp-php>php_filtersphp[php$namephp]php)php)php php{
php php php php php php php php php php php php php$lenphp php=php strlenphp(php$namephp)php;
php php php php php php php php php php php php foreachphp php(php$thisphp-php>php_filtersphp asphp php$localNamephp php=php>php php$filterphp)php php{
php php php php php php php php php php php php php php php php ifphp php(php$lenphp php>php strlenphp(php$localNamephp)php)php php{
php php php php php php php php php php php php php php php php php php php php continuephp;
php php php php php php php php php php php php php php php php php}

php php php php php php php php php php php php php php php php ifphp php(php0php php=php=php=php substrphp_comparephp(php$localNamephp,php php$namephp,php php-php$lenphp,php php$lenphp,php truephp)php)php php{
php php php php php php php php php php php php php php php php php php php php ifphp php(isphp_arrayphp(php$filterphp)php)php php{
php php php php php php php php php php php php php php php php php php php php php php php php returnphp php$thisphp-php>php_loadFilterphp(php$filterphp)php;
php php php php php php php php php php php php php php php php php php php php php}
php php php php php php php php php php php php php php php php php php php php returnphp php$filterphp;
php php php php php php php php php php php php php php php php php}
php php php php php php php php php php php php php}
php php php php php php php php php php php php returnphp falsephp;
php php php php php php php php php}

php php php php php php php php ifphp php(isphp_arrayphp(php$thisphp-php>php_filtersphp[php$namephp]php)php)php php{
php php php php php php php php php php php php returnphp php$thisphp-php>php_loadFilterphp(php$thisphp-php>php_filtersphp[php$namephp]php)php;
php php php php php php php php php}

php php php php php php php php returnphp php$thisphp-php>php_filtersphp[php$namephp]php;
php php php php php}

php php php php php/php*php*
php php php php php php*php Getphp allphp filters
php php php php php php*
php php php php php php*php php@returnphp array
php php php php php php*php/
php php php php publicphp functionphp getFiltersphp(php)
php php php php php{
php php php php php php php php php$filtersphp php=php arrayphp(php)php;
php php php php php php php php foreachphp php(php$thisphp-php>php_filtersphp asphp php$keyphp php=php>php php$valuephp)php php{
php php php php php php php php php php php php ifphp php(php$valuephp instanceofphp Zendphp_Filterphp_Interfacephp)php php{
php php php php php php php php php php php php php php php php php$filtersphp[php$keyphp]php php=php php$valuephp;
php php php php php php php php php php php php php php php php continuephp;
php php php php php php php php php php php php php}
php php php php php php php php php php php php php$filterphp php=php php$thisphp-php>php_loadFilterphp(php$valuephp)php;
php php php php php php php php php php php php php$filtersphp[getphp_classphp(php$filterphp)php]php php=php php$filterphp;
php php php php php php php php php}
php php php php php php php php returnphp php$filtersphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Removephp aphp filterphp byphp name
php php php php php php*
php php php php php php*php php@paramphp php stringphp php$name
php php php php php php*php php@returnphp Zendphp_Formphp_Element
php php php php php php*php/
php php php php publicphp functionphp removeFilterphp(php$namephp)
php php php php php{
php php php php php php php php ifphp php(issetphp(php$thisphp-php>php_filtersphp[php$namephp]php)php)php php{
php php php php php php php php php php php php unsetphp(php$thisphp-php>php_filtersphp[php$namephp]php)php;
php php php php php php php php php}php elsephp php{
php php php php php php php php php php php php php$lenphp php=php strlenphp(php$namephp)php;
php php php php php php php php php php php php foreachphp php(arrayphp_keysphp(php$thisphp-php>php_filtersphp)php asphp php$filterphp)php php{
php php php php php php php php php php php php php php php php ifphp php(php$lenphp php>php strlenphp(php$filterphp)php)php php{
php php php php php php php php php php php php php php php php php php php php continuephp;
php php php php php php php php php php php php php php php php php}
php php php php php php php php php php php php php php php php ifphp php(php0php php=php=php=php substrphp_comparephp(php$filterphp,php php$namephp,php php-php$lenphp,php php$lenphp,php truephp)php)php php{
php php php php php php php php php php php php php php php php php php php php unsetphp(php$thisphp-php>php_filtersphp[php$filterphp]php)php;
php php php php php php php php php php php php php php php php php php php php breakphp;
php php php php php php php php php php php php php php php php php}
php php php php php php php php php php php php php}
php php php php php php php php php}

php php php php php php php php returnphp php$thisphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Clearphp allphp filters
php php php php php php*
php php php php php php*php php@returnphp Zendphp_Formphp_Element
php php php php php php*php/
php php php php publicphp functionphp clearFiltersphp(php)
php php php php php{
php php php php php php php php php$thisphp-php>php_filtersphp php=php arrayphp(php)php;
php php php php php php php php returnphp php$thisphp;
php php php php php}

php php php php php/php/php Rendering

php php php php php/php*php*
php php php php php php*php Setphp viewphp object
php php php php php php*
php php php php php php*php php@paramphp php Zendphp_Viewphp_Interfacephp php$view
php php php php php php*php php@returnphp Zendphp_Formphp_Element
php php php php php php*php/
php php php php publicphp functionphp setViewphp(Zendphp_Viewphp_Interfacephp php$viewphp php=php nullphp)
php php php php php{
php php php php php php php php php$thisphp-php>php_viewphp php=php php$viewphp;
php php php php php php php php returnphp php$thisphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Retrievephp viewphp object
php php php php php php*
php php php php php php*php Retrievesphp fromphp ViewRendererphp ifphp nonephp previouslyphp setphp.
php php php php php php*
php php php php php php*php php@returnphp nullphp|Zendphp_Viewphp_Interface
php php php php php php*php/
php php php php publicphp functionphp getViewphp(php)
php php php php php{
php php php php php php php php ifphp php(nullphp php=php=php=php php$thisphp-php>php_viewphp)php php{
php php php php php php php php php php php php requirephp_oncephp php'Zendphp/Controllerphp/Actionphp/HelperBrokerphp.phpphp'php;
php php php php php php php php php php php php php$viewRendererphp php=php Zendphp_Controllerphp_Actionphp_HelperBrokerphp:php:getStaticHelperphp(php'viewRendererphp'php)php;
php php php php php php php php php php php php php$thisphp-php>setViewphp(php$viewRendererphp-php>viewphp)php;
php php php php php php php php php}
php php php php php php php php returnphp php$thisphp-php>php_viewphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Instantiatephp aphp decoratorphp basedphp onphp classphp namephp orphp classphp namephp fragment
php php php php php php*
php php php php php php*php php@paramphp php stringphp php$name
php php php php php php*php php@paramphp php nullphp|arrayphp php$options
php php php php php php*php php@returnphp Zendphp_Formphp_Decoratorphp_Interface
php php php php php php*php/
php php php php protectedphp functionphp php_getDecoratorphp(php$namephp,php php$optionsphp)
php php php php php{
php php php php php php php php php$classphp php=php php$thisphp-php>getPluginLoaderphp(selfphp:php:DECORATORphp)php-php>loadphp(php$namephp)php;
php php php php php php php php ifphp php(nullphp php=php=php=php php$optionsphp)php php{
php php php php php php php php php php php php php$decoratorphp php=php newphp php$classphp;
php php php php php php php php php}php elsephp php{
php php php php php php php php php php php php php$decoratorphp php=php newphp php$classphp(php$optionsphp)php;
php php php php php php php php php}

php php php php php php php php returnphp php$decoratorphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Addphp aphp decoratorphp forphp renderingphp thephp element
php php php php php php*
php php php php php php*php php@paramphp php stringphp|Zendphp_Formphp_Decoratorphp_Interfacephp php$decorator
php php php php php php*php php@paramphp php arrayphp|Zendphp_Configphp php$optionsphp Optionsphp withphp whichphp tophp initializephp decorator
php php php php php php*php php@returnphp Zendphp_Formphp_Element
php php php php php php*php/
php php php php publicphp functionphp addDecoratorphp(php$decoratorphp,php php$optionsphp php=php nullphp)
php php php php php{
php php php php php php php php ifphp php(php$decoratorphp instanceofphp Zendphp_Formphp_Decoratorphp_Interfacephp)php php{
php php php php php php php php php php php php php$namephp php=php getphp_classphp(php$decoratorphp)php;
php php php php php php php php php}php elseifphp php(isphp_stringphp(php$decoratorphp)php)php php{
php php php php php php php php php php php php php$namephp php php php php php php=php php$decoratorphp;
php php php php php php php php php php php php php$decoratorphp php=php arrayphp(
php php php php php php php php php php php php php php php php php'decoratorphp'php php=php>php php$namephp,
php php php php php php php php php php php php php php php php php'optionsphp'php php php php=php>php php$optionsphp,
php php php php php php php php php php php php php)php;
php php php php php php php php php}php elseifphp php(isphp_arrayphp(php$decoratorphp)php)php php{
php php php php php php php php php php php php foreachphp php(php$decoratorphp asphp php$namephp php=php>php php$specphp)php php{
php php php php php php php php php php php php php php php php breakphp;
php php php php php php php php php php php php php}
php php php php php php php php php php php php ifphp php(isphp_numericphp(php$namephp)php)php php{
php php php php php php php php php php php php php php php php requirephp_oncephp php'Zendphp/Formphp/Exceptionphp.phpphp'php;
php php php php php php php php php php php php php php php php throwphp newphp Zendphp_Formphp_Exceptionphp(php'Invalidphp aliasphp providedphp tophp addDecoratorphp;php mustphp bephp alphanumericphp stringphp'php)php;
php php php php php php php php php php php php php}
php php php php php php php php php php php php ifphp php(isphp_stringphp(php$specphp)php)php php{
php php php php php php php php php php php php php php php php php$decoratorphp php=php arrayphp(
php php php php php php php php php php php php php php php php php php php php php'decoratorphp'php php=php>php php$specphp,
php php php php php php php php php php php php php php php php php php php php php'optionsphp'php php php php=php>php php$optionsphp,
php php php php php php php php php php php php php php php php php)php;
php php php php php php php php php php php php php}php elseifphp php(php$specphp instanceofphp Zendphp_Formphp_Decoratorphp_Interfacephp)php php{
php php php php php php php php php php php php php php php php php$decoratorphp php=php php$specphp;
php php php php php php php php php php php php php}
php php php php php php php php php}php elsephp php{
php php php php php php php php php php php php requirephp_oncephp php'Zendphp/Formphp/Exceptionphp.phpphp'php;
php php php php php php php php php php php php throwphp newphp Zendphp_Formphp_Exceptionphp(php'Invalidphp decoratorphp providedphp tophp addDecoratorphp;php mustphp bephp stringphp orphp Zendphp_Formphp_Decoratorphp_Interfacephp'php)php;
php php php php php php php php php}

php php php php php php php php php$thisphp-php>php_decoratorsphp[php$namephp]php php=php php$decoratorphp;

php php php php php php php php returnphp php$thisphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Addphp manyphp decoratorsphp atphp once
php php php php php php*
php php php php php php*php php@paramphp php arrayphp php$decorators
php php php php php php*php php@returnphp Zendphp_Formphp_Element
php php php php php php*php/
php php php php publicphp functionphp addDecoratorsphp(arrayphp php$decoratorsphp)
php php php php php{
php php php php php php php php foreachphp php(php$decoratorsphp asphp php$decoratorNamephp php=php>php php$decoratorInfophp)php php{
php php php php php php php php php php php php ifphp php(isphp_stringphp(php$decoratorInfophp)php php|php|
php php php php php php php php php php php php php php php php php$decoratorInfophp instanceofphp Zendphp_Formphp_Decoratorphp_Interfacephp)php php{
php php php php php php php php php php php php php php php php ifphp php(php!isphp_numericphp(php$decoratorNamephp)php)php php{
php php php php php php php php php php php php php php php php php php php php php$thisphp-php>addDecoratorphp(arrayphp(php$decoratorNamephp php=php>php php$decoratorInfophp)php)php;
php php php php php php php php php php php php php php php php php}php elsephp php{
php php php php php php php php php php php php php php php php php php php php php$thisphp-php>addDecoratorphp(php$decoratorInfophp)php;
php php php php php php php php php php php php php php php php php}
php php php php php php php php php php php php php}php elseifphp php(isphp_arrayphp(php$decoratorInfophp)php)php php{
php php php php php php php php php php php php php php php php php$argcphp php php php php=php countphp(php$decoratorInfophp)php;
php php php php php php php php php php php php php php php php php$optionsphp php=php arrayphp(php)php;
php php php php php php php php php php php php php php php php ifphp php(issetphp(php$decoratorInfophp[php'decoratorphp'php]php)php)php php{
php php php php php php php php php php php php php php php php php php php php php$decoratorphp php=php php$decoratorInfophp[php'decoratorphp'php]php;
php php php php php php php php php php php php php php php php php php php php ifphp php(issetphp(php$decoratorInfophp[php'optionsphp'php]php)php)php php{
php php php php php php php php php php php php php php php php php php php php php php php php php$optionsphp php=php php$decoratorInfophp[php'optionsphp'php]php;
php php php php php php php php php php php php php php php php php php php php php}
php php php php php php php php php php php php php php php php php php php php php$thisphp-php>addDecoratorphp(php$decoratorphp,php php$optionsphp)php;
php php php php php php php php php php php php php php php php php}php elsephp php{
php php php php php php php php php php php php php php php php php php php php switchphp php(truephp)php php{
php php php php php php php php php php php php php php php php php php php php php php php php casephp php(php0php php=php=php php$argcphp)php:
php php php php php php php php php php php php php php php php php php php php php php php php php php php php breakphp;
php php php php php php php php php php php php php php php php php php php php php php php php casephp php(php1php <php=php php$argcphp)php:
php php php php php php php php php php php php php php php php php php php php php php php php php php php php php$decoratorphp php php=php arrayphp_shiftphp(php$decoratorInfophp)php;
php php php php php php php php php php php php php php php php php php php php php php php php casephp php(php2php <php=php php$argcphp)php:
php php php php php php php php php php php php php php php php php php php php php php php php php php php php php$optionsphp php=php arrayphp_shiftphp(php$decoratorInfophp)php;
php php php php php php php php php php php php php php php php php php php php php php php php defaultphp:
php php php php php php php php php php php php php php php php php php php php php php php php php php php php php$thisphp-php>addDecoratorphp(php$decoratorphp,php php$optionsphp)php;
php php php php php php php php php php php php php php php php php php php php php php php php php php php php breakphp;
php php php php php php php php php php php php php php php php php php php php php}
php php php php php php php php php php php php php php php php php}
php php php php php php php php php php php php php}php elsephp php{
php php php php php php php php php php php php php php php php requirephp_oncephp php'Zendphp/Formphp/Exceptionphp.phpphp'php;
php php php php php php php php php php php php php php php php throwphp newphp Zendphp_Formphp_Exceptionphp(php'Invalidphp decoratorphp passedphp tophp addDecoratorsphp(php)php'php)php;
php php php php php php php php php php php php php}
php php php php php php php php php}

php php php php php php php php returnphp php$thisphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Overwritephp allphp decorators
php php php php php php*
php php php php php php*php php@paramphp php arrayphp php$decorators
php php php php php php*php php@returnphp Zendphp_Formphp_Element
php php php php php php*php/
php php php php publicphp functionphp setDecoratorsphp(arrayphp php$decoratorsphp)
php php php php php{
php php php php php php php php php$thisphp-php>clearDecoratorsphp(php)php;
php php php php php php php php returnphp php$thisphp-php>addDecoratorsphp(php$decoratorsphp)php;
php php php php php}

php php php php php/php*php*
php php php php php php*php Retrievephp aphp registeredphp decorator
php php php php php php*
php php php php php php*php php@paramphp php stringphp php$name
php php php php php php*php php@returnphp falsephp|Zendphp_Formphp_Decoratorphp_Abstract
php php php php php php*php/
php php php php publicphp functionphp getDecoratorphp(php$namephp)
php php php php php{
php php php php php php php php ifphp php(php!issetphp(php$thisphp-php>php_decoratorsphp[php$namephp]php)php)php php{
php php php php php php php php php php php php php$lenphp php=php strlenphp(php$namephp)php;
php php php php php php php php php php php php foreachphp php(php$thisphp-php>php_decoratorsphp asphp php$localNamephp php=php>php php$decoratorphp)php php{
php php php php php php php php php php php php php php php php ifphp php(php$lenphp php>php strlenphp(php$localNamephp)php)php php{
php php php php php php php php php php php php php php php php php php php php continuephp;
php php php php php php php php php php php php php php php php php}

php php php php php php php php php php php php php php php php ifphp php(php0php php=php=php=php substrphp_comparephp(php$localNamephp,php php$namephp,php php-php$lenphp,php php$lenphp,php truephp)php)php php{
php php php php php php php php php php php php php php php php php php php php ifphp php(isphp_arrayphp(php$decoratorphp)php)php php{
php php php php php php php php php php php php php php php php php php php php php php php php returnphp php$thisphp-php>php_loadDecoratorphp(php$decoratorphp,php php$localNamephp)php;
php php php php php php php php php php php php php php php php php php php php php}
php php php php php php php php php php php php php php php php php php php php returnphp php$decoratorphp;
php php php php php php php php php php php php php php php php php}
php php php php php php php php php php php php php}
php php php php php php php php php php php php returnphp falsephp;
php php php php php php php php php}

php php php php php php php php ifphp php(isphp_arrayphp(php$thisphp-php>php_decoratorsphp[php$namephp]php)php)php php{
php php php php php php php php php php php php returnphp php$thisphp-php>php_loadDecoratorphp(php$thisphp-php>php_decoratorsphp[php$namephp]php,php php$namephp)php;
php php php php php php php php php}

php php php php php php php php returnphp php$thisphp-php>php_decoratorsphp[php$namephp]php;
php php php php php}

php php php php php/php*php*
php php php php php php*php Retrievephp allphp decorators
php php php php php php*
php php php php php php*php php@returnphp array
php php php php php php*php/
php php php php publicphp functionphp getDecoratorsphp(php)
php php php php php{
php php php php php php php php foreachphp php(php$thisphp-php>php_decoratorsphp asphp php$keyphp php=php>php php$valuephp)php php{
php php php php php php php php php php php php ifphp php(isphp_arrayphp(php$valuephp)php)php php{
php php php php php php php php php php php php php php php php php$thisphp-php>php_loadDecoratorphp(php$valuephp,php php$keyphp)php;
php php php php php php php php php php php php php}
php php php php php php php php php}
php php php php php php php php returnphp php$thisphp-php>php_decoratorsphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Removephp aphp singlephp decorator
php php php php php php*
php php php php php php*php php@paramphp php stringphp php$name
php php php php php php*php php@returnphp Zendphp_Formphp_Element
php php php php php php*php/
php php php php publicphp functionphp removeDecoratorphp(php$namephp)
php php php php php{
php php php php php php php php ifphp php(issetphp(php$thisphp-php>php_decoratorsphp[php$namephp]php)php)php php{
php php php php php php php php php php php php unsetphp(php$thisphp-php>php_decoratorsphp[php$namephp]php)php;
php php php php php php php php php}php elsephp php{
php php php php php php php php php php php php php$lenphp php=php strlenphp(php$namephp)php;
php php php php php php php php php php php php foreachphp php(arrayphp_keysphp(php$thisphp-php>php_decoratorsphp)php asphp php$decoratorphp)php php{
php php php php php php php php php php php php php php php php ifphp php(php$lenphp php>php strlenphp(php$decoratorphp)php)php php{
php php php php php php php php php php php php php php php php php php php php continuephp;
php php php php php php php php php php php php php php php php php}
php php php php php php php php php php php php php php php php ifphp php(php0php php=php=php=php substrphp_comparephp(php$decoratorphp,php php$namephp,php php-php$lenphp,php php$lenphp,php truephp)php)php php{
php php php php php php php php php php php php php php php php php php php php unsetphp(php$thisphp-php>php_decoratorsphp[php$decoratorphp]php)php;
php php php php php php php php php php php php php php php php php php php php breakphp;
php php php php php php php php php php php php php php php php php}
php php php php php php php php php php php php php}
php php php php php php php php php}

php php php php php php php php returnphp php$thisphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Clearphp allphp decorators
php php php php php php*
php php php php php php*php php@returnphp Zendphp_Formphp_Element
php php php php php php*php/
php php php php publicphp functionphp clearDecoratorsphp(php)
php php php php php{
php php php php php php php php php$thisphp-php>php_decoratorsphp php=php arrayphp(php)php;
php php php php php php php php returnphp php$thisphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Renderphp formphp element
php php php php php php*
php php php php php php*php php@paramphp php Zendphp_Viewphp_Interfacephp php$view
php php php php php php*php php@returnphp string
php php php php php php*php/
php php php php publicphp functionphp renderphp(Zendphp_Viewphp_Interfacephp php$viewphp php=php nullphp)
php php php php php{
php php php php php php php php ifphp php(php$thisphp-php>php_isPartialRenderingphp)php php{
php php php php php php php php php php php php returnphp php'php'php;
php php php php php php php php php}

php php php php php php php php ifphp php(nullphp php!php=php=php php$viewphp)php php{
php php php php php php php php php php php php php$thisphp-php>setViewphp(php$viewphp)php;
php php php php php php php php php}

php php php php php php php php php$contentphp php=php php'php'php;
php php php php php php php php foreachphp php(php$thisphp-php>getDecoratorsphp(php)php asphp php$decoratorphp)php php{
php php php php php php php php php php php php php$decoratorphp-php>setElementphp(php$thisphp)php;
php php php php php php php php php php php php php$contentphp php=php php$decoratorphp-php>renderphp(php$contentphp)php;
php php php php php php php php php}
php php php php php php php php returnphp php$contentphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Stringphp representationphp ofphp formphp element
php php php php php php*
php php php php php php*php Proxiesphp tophp php{php@linkphp renderphp(php)php}php.
php php php php php php*
php php php php php php*php php@returnphp string
php php php php php php*php/
php php php php publicphp functionphp php_php_toStringphp(php)
php php php php php{
php php php php php php php php tryphp php{
php php php php php php php php php php php php php$returnphp php=php php$thisphp-php>renderphp(php)php;
php php php php php php php php php php php php returnphp php$returnphp;
php php php php php php php php php}php catchphp php(Exceptionphp php$ephp)php php{
php php php php php php php php php php php php triggerphp_errorphp(php$ephp-php>getMessagephp(php)php,php Ephp_USERphp_WARNINGphp)php;
php php php php php php php php php php php php returnphp php'php'php;
php php php php php php php php php}
php php php php php}

php php php php php/php*php*
php php php php php php*php Lazyphp-loadphp aphp filter
php php php php php php*
php php php php php php*php php@paramphp php arrayphp php$filter
php php php php php php*php php@returnphp Zendphp_Filterphp_Interface
php php php php php php*php/
php php php php protectedphp functionphp php_loadFilterphp(arrayphp php$filterphp)
php php php php php{
php php php php php php php php php$origNamephp php=php php$filterphp[php'filterphp'php]php;
php php php php php php php php php$namephp php php php php php=php php$thisphp-php>getPluginLoaderphp(selfphp:php:FILTERphp)php-php>loadphp(php$filterphp[php'filterphp'php]php)php;

php php php php php php php php ifphp php(arrayphp_keyphp_existsphp(php$namephp,php php$thisphp-php>php_filtersphp)php)php php{
php php php php php php php php php php php php requirephp_oncephp php'Zendphp/Formphp/Exceptionphp.phpphp'php;
php php php php php php php php php php php php throwphp newphp Zendphp_Formphp_Exceptionphp(sprintfphp(php'Filterphp instancephp alreadyphp existsphp forphp filterphp php"php%sphp"php'php,php php$origNamephp)php)php;
php php php php php php php php php}

php php php php php php php php ifphp php(emptyphp(php$filterphp[php'optionsphp'php]php)php)php php{
php php php php php php php php php php php php php$instancephp php=php newphp php$namephp;
php php php php php php php php php}php elsephp php{
php php php php php php php php php php php php php$rphp php=php newphp ReflectionClassphp(php$namephp)php;
php php php php php php php php php php php php ifphp php(php$rphp-php>hasMethodphp(php'php_php_constructphp'php)php)php php{
php php php php php php php php php php php php php php php php php$instancephp php=php php$rphp-php>newInstanceArgsphp(php(arrayphp)php php$filterphp[php'optionsphp'php]php)php;
php php php php php php php php php php php php php}php elsephp php{
php php php php php php php php php php php php php php php php php$instancephp php=php php$rphp-php>newInstancephp(php)php;
php php php php php php php php php php php php php}
php php php php php php php php php}

php php php php php php php php ifphp php(php$origNamephp php!php=php php$namephp)php php{
php php php php php php php php php php php php php$filterNamesphp php php=php arrayphp_keysphp(php$thisphp-php>php_filtersphp)php;
php php php php php php php php php php php php php$orderphp php php php php php php php php=php arrayphp_flipphp(php$filterNamesphp)php;
php php php php php php php php php php php php php$orderphp[php$namephp]php php=php php$orderphp[php$origNamephp]php;
php php php php php php php php php php php php php$filtersExchangephp php=php arrayphp(php)php;
php php php php php php php php php php php php unsetphp(php$orderphp[php$origNamephp]php)php;
php php php php php php php php php php php php asortphp(php$orderphp)php;
php php php php php php php php php php php php foreachphp php(php$orderphp asphp php$keyphp php=php>php php$indexphp)php php{
php php php php php php php php php php php php php php php php ifphp php(php$keyphp php=php=php php$namephp)php php{
php php php php php php php php php php php php php php php php php php php php php$filtersExchangephp[php$keyphp]php php=php php$instancephp;
php php php php php php php php php php php php php php php php php php php php continuephp;
php php php php php php php php php php php php php php php php php}
php php php php php php php php php php php php php php php php php$filtersExchangephp[php$keyphp]php php=php php$thisphp-php>php_filtersphp[php$keyphp]php;
php php php php php php php php php php php php php}
php php php php php php php php php php php php php$thisphp-php>php_filtersphp php=php php$filtersExchangephp;
php php php php php php php php php}php elsephp php{
php php php php php php php php php php php php php$thisphp-php>php_filtersphp[php$namephp]php php=php php$instancephp;
php php php php php php php php php}

php php php php php php php php returnphp php$instancephp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Lazyphp-loadphp aphp validator
php php php php php php*
php php php php php php*php php@paramphp php arrayphp php$validatorphp Validatorphp definition
php php php php php php*php php@returnphp Zendphp_Validatephp_Interface
php php php php php php*php/
php php php php protectedphp functionphp php_loadValidatorphp(arrayphp php$validatorphp)
php php php php php{
php php php php php php php php php$origNamephp php=php php$validatorphp[php'validatorphp'php]php;
php php php php php php php php php$namephp php php php php php=php php$thisphp-php>getPluginLoaderphp(selfphp:php:VALIDATEphp)php-php>loadphp(php$validatorphp[php'validatorphp'php]php)php;

php php php php php php php php ifphp php(arrayphp_keyphp_existsphp(php$namephp,php php$thisphp-php>php_validatorsphp)php)php php{
php php php php php php php php php php php php requirephp_oncephp php'Zendphp/Formphp/Exceptionphp.phpphp'php;
php php php php php php php php php php php php throwphp newphp Zendphp_Formphp_Exceptionphp(sprintfphp(php'Validatorphp instancephp alreadyphp existsphp forphp validatorphp php"php%sphp"php'php,php php$origNamephp)php)php;
php php php php php php php php php}

php php php php php php php php php$messagesphp php=php falsephp;
php php php php php php php php ifphp php(issetphp(php$validatorphp[php'optionsphp'php]php)php php&php&php arrayphp_keyphp_existsphp(php'messagesphp'php,php php(arrayphp)php$validatorphp[php'optionsphp'php]php)php)php php{
php php php php php php php php php php php php php$messagesphp php=php php$validatorphp[php'optionsphp'php]php[php'messagesphp'php]php;
php php php php php php php php php php php php unsetphp(php$validatorphp[php'optionsphp'php]php[php'messagesphp'php]php)php;
php php php php php php php php php}

php php php php php php php php ifphp php(emptyphp(php$validatorphp[php'optionsphp'php]php)php)php php{
php php php php php php php php php php php php php$instancephp php=php newphp php$namephp;
php php php php php php php php php}php elsephp php{
php php php php php php php php php php php php php$rphp php=php newphp ReflectionClassphp(php$namephp)php;
php php php php php php php php php php php php ifphp php(php$rphp-php>hasMethodphp(php'php_php_constructphp'php)php)php php{
php php php php php php php php php php php php php php php php php$numericphp php=php falsephp;
php php php php php php php php php php php php php php php php ifphp php(isphp_arrayphp(php$validatorphp[php'optionsphp'php]php)php)php php{
php php php php php php php php php php php php php php php php php php php php php$keysphp php php php php=php arrayphp_keysphp(php$validatorphp[php'optionsphp'php]php)php;
php php php php php php php php php php php php php php php php php php php php foreachphp(php$keysphp asphp php$keyphp)php php{
php php php php php php php php php php php php php php php php php php php php php php php php ifphp php(isphp_numericphp(php$keyphp)php)php php{
php php php php php php php php php php php php php php php php php php php php php php php php php php php php php$numericphp php=php truephp;
php php php php php php php php php php php php php php php php php php php php php php php php php php php php breakphp;
php php php php php php php php php php php php php php php php php php php php php php php php php}
php php php php php php php php php php php php php php php php php php php php php}
php php php php php php php php php php php php php php php php php}

php php php php php php php php php php php php php php php php ifphp php(php$numericphp)php php{
php php php php php php php php php php php php php php php php php php php php php$instancephp php=php php$rphp-php>newInstanceArgsphp(php(arrayphp)php php$validatorphp[php'optionsphp'php]php)php;
php php php php php php php php php php php php php php php php php}php elsephp php{
php php php php php php php php php php php php php php php php php php php php php$instancephp php=php php$rphp-php>newInstancephp(php$validatorphp[php'optionsphp'php]php)php;
php php php php php php php php php php php php php php php php php}
php php php php php php php php php php php php php}php elsephp php{
php php php php php php php php php php php php php php php php php$instancephp php=php php$rphp-php>newInstancephp(php)php;
php php php php php php php php php php php php php}
php php php php php php php php php}

php php php php php php php php ifphp php(php$messagesphp)php php{
php php php php php php php php php php php php ifphp php(isphp_arrayphp(php$messagesphp)php)php php{
php php php php php php php php php php php php php php php php php$instancephp-php>setMessagesphp(php$messagesphp)php;
php php php php php php php php php php php php php}php elseifphp php(isphp_stringphp(php$messagesphp)php)php php{
php php php php php php php php php php php php php php php php php$instancephp-php>setMessagephp(php$messagesphp)php;
php php php php php php php php php php php php php}
php php php php php php php php php}
php php php php php php php php php$instancephp-php>zfBreakChainOnFailurephp php=php php$validatorphp[php'breakChainOnFailurephp'php]php;

php php php php php php php php ifphp php(php$origNamephp php!php=php php$namephp)php php{
php php php php php php php php php php php php php$validatorNamesphp php php php php php=php arrayphp_keysphp(php$thisphp-php>php_validatorsphp)php;
php php php php php php php php php php php php php$orderphp php php php php php php php php php php php php php php=php arrayphp_flipphp(php$validatorNamesphp)php;
php php php php php php php php php php php php php$orderphp[php$namephp]php php php php php php php php=php php$orderphp[php$origNamephp]php;
php php php php php php php php php php php php php$validatorsExchangephp php=php arrayphp(php)php;
php php php php php php php php php php php php unsetphp(php$orderphp[php$origNamephp]php)php;
php php php php php php php php php php php php asortphp(php$orderphp)php;
php php php php php php php php php php php php foreachphp php(php$orderphp asphp php$keyphp php=php>php php$indexphp)php php{
php php php php php php php php php php php php php php php php ifphp php(php$keyphp php=php=php php$namephp)php php{
php php php php php php php php php php php php php php php php php php php php php$validatorsExchangephp[php$keyphp]php php=php php$instancephp;
php php php php php php php php php php php php php php php php php php php php continuephp;
php php php php php php php php php php php php php php php php php}
php php php php php php php php php php php php php php php php php$validatorsExchangephp[php$keyphp]php php=php php$thisphp-php>php_validatorsphp[php$keyphp]php;
php php php php php php php php php php php php php}
php php php php php php php php php php php php php$thisphp-php>php_validatorsphp php=php php$validatorsExchangephp;
php php php php php php php php php}php elsephp php{
php php php php php php php php php php php php php$thisphp-php>php_validatorsphp[php$namephp]php php=php php$instancephp;
php php php php php php php php php}

php php php php php php php php returnphp php$instancephp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Lazyphp-loadphp aphp decorator
php php php php php php*
php php php php php php*php php@paramphp php arrayphp php$decoratorphp Decoratorphp typephp andphp options
php php php php php php*php php@paramphp php mixedphp php$namephp Decoratorphp namephp orphp alias
php php php php php php*php php@returnphp Zendphp_Formphp_Decoratorphp_Interface
php php php php php php*php/
php php php php protectedphp functionphp php_loadDecoratorphp(arrayphp php$decoratorphp,php php$namephp)
php php php php php{
php php php php php php php php php$sameNamephp php=php falsephp;
php php php php php php php php ifphp php(php$namephp php=php=php php$decoratorphp[php'decoratorphp'php]php)php php{
php php php php php php php php php php php php php$sameNamephp php=php truephp;
php php php php php php php php php}

php php php php php php php php php$instancephp php=php php$thisphp-php>php_getDecoratorphp(php$decoratorphp[php'decoratorphp'php]php,php php$decoratorphp[php'optionsphp'php]php)php;
php php php php php php php php ifphp php(php$sameNamephp)php php{
php php php php php php php php php php php php php$newNamephp php php php php php php php php php php php php=php getphp_classphp(php$instancephp)php;
php php php php php php php php php php php php php$decoratorNamesphp php php php php php=php arrayphp_keysphp(php$thisphp-php>php_decoratorsphp)php;
php php php php php php php php php php php php php$orderphp php php php php php php php php php php php php php php=php arrayphp_flipphp(php$decoratorNamesphp)php;
php php php php php php php php php php php php php$orderphp[php$newNamephp]php php php php php=php php$orderphp[php$namephp]php;
php php php php php php php php php php php php php$decoratorsExchangephp php=php arrayphp(php)php;
php php php php php php php php php php php php unsetphp(php$orderphp[php$namephp]php)php;
php php php php php php php php php php php php asortphp(php$orderphp)php;
php php php php php php php php php php php php foreachphp php(php$orderphp asphp php$keyphp php=php>php php$indexphp)php php{
php php php php php php php php php php php php php php php php ifphp php(php$keyphp php=php=php php$newNamephp)php php{
php php php php php php php php php php php php php php php php php php php php php$decoratorsExchangephp[php$keyphp]php php=php php$instancephp;
php php php php php php php php php php php php php php php php php php php php continuephp;
php php php php php php php php php php php php php php php php php}
php php php php php php php php php php php php php php php php php$decoratorsExchangephp[php$keyphp]php php=php php$thisphp-php>php_decoratorsphp[php$keyphp]php;
php php php php php php php php php php php php php}
php php php php php php php php php php php php php$thisphp-php>php_decoratorsphp php=php php$decoratorsExchangephp;
php php php php php php php php php}php elsephp php{
php php php php php php php php php php php php php$thisphp-php>php_decoratorsphp[php$namephp]php php=php php$instancephp;
php php php php php php php php php}

php php php php php php php php returnphp php$instancephp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Retrievephp errorphp messagesphp andphp performphp translationphp andphp valuephp substitution
php php php php php php*
php php php php php php*php php@returnphp array
php php php php php php*php/
php php php php protectedphp functionphp php_getErrorMessagesphp(php)
php php php php php{
php php php php php php php php php$translatorphp php=php php$thisphp-php>getTranslatorphp(php)php;
php php php php php php php php php$messagesphp php php php=php php$thisphp-php>getErrorMessagesphp(php)php;
php php php php php php php php php$valuephp php php php php php php=php php$thisphp-php>getValuephp(php)php;
php php php php php php php php foreachphp php(php$messagesphp asphp php$keyphp php=php>php php$messagephp)php php{
php php php php php php php php php php php php ifphp php(nullphp php!php=php=php php$translatorphp)php php{
php php php php php php php php php php php php php php php php php$messagephp php=php php$translatorphp-php>translatephp(php$messagephp)php;
php php php php php php php php php php php php php}
php php php php php php php php php php php php ifphp php(php(php$thisphp-php>isArrayphp(php)php php|php|php isphp_arrayphp(php$valuephp)php)
php php php php php php php php php php php php php php php php php&php&php php!emptyphp(php$valuephp)
php php php php php php php php php php php php php)php php{
php php php php php php php php php php php php php php php php php$aggregateMessagesphp php=php arrayphp(php)php;
php php php php php php php php php php php php php php php php foreachphp php(php$valuephp asphp php$valphp)php php{
php php php php php php php php php php php php php php php php php php php php php$aggregateMessagesphp[php]php php=php strphp_replacephp(php'php%valuephp%php'php,php php$valphp,php php$messagephp)php;
php php php php php php php php php php php php php php php php php}
php php php php php php php php php php php php php php php php php$messagesphp[php$keyphp]php php=php implodephp(php$thisphp-php>getErrorMessageSeparatorphp(php)php,php php$aggregateMessagesphp)php;
php php php php php php php php php php php php php}php elsephp php{
php php php php php php php php php php php php php php php php php$messagesphp[php$keyphp]php php=php strphp_replacephp(php'php%valuephp%php'php,php php$valuephp,php php$messagephp)php;
php php php php php php php php php php php php php}
php php php php php php php php php}
php php php php php php php php returnphp php$messagesphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Arephp therephp customphp errorphp messagesphp registeredphp?
php php php php php php*
php php php php php php*php php@returnphp bool
php php php php php php*php/
php php php php protectedphp functionphp php_hasErrorMessagesphp(php)
php php php php php{
php php php php php php php php returnphp php!emptyphp(php$thisphp-php>php_errorMessagesphp)php;
php php php php php}
php}
