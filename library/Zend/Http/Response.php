<php?php

php/php*php*
php php*php Zendphp Framework
php php*
php php*php LICENSE
php php*
php php*php Thisphp sourcephp filephp isphp subjectphp tophp thephp newphp BSDphp licensephp thatphp isphp bundled
php php*php withphp thisphp packagephp inphp thephp filephp LICENSEphp.txtphp.
php php*php Itphp isphp alsophp availablephp throughphp thephp worldphp-widephp-webphp atphp thisphp URLphp:
php php*php httpphp:php/php/frameworkphp.zendphp.comphp/licensephp/newphp-bsd
php php*php Ifphp youphp didphp notphp receivephp aphp copyphp ofphp thephp licensephp andphp arephp unablephp to
php php*php obtainphp itphp throughphp thephp worldphp-widephp-webphp,php pleasephp sendphp anphp email
php php*php tophp licensephp@zendphp.comphp sophp wephp canphp sendphp youphp aphp copyphp immediatelyphp.
php php*
php php*php php@categoryphp php php Zend
php php*php php@packagephp php php php Zendphp_Http
php php*php php@subpackagephp Response
php php*php php@versionphp php php php php$Idphp:php Responsephp.phpphp php2php3php4php8php4php php2php0php1php0php-php1php2php-php1php0php php0php3php:php5php7php:php5php9Zphp mjhphp_caphp php$
php php*php php@copyrightphp php Copyrightphp php(cphp)php php2php0php0php5php-php2php0php1php0php Zendphp Technologiesphp USAphp Incphp.php php(httpphp:php/php/wwwphp.zendphp.comphp)
php php*php php@licensephp php php php httpphp:php/php/frameworkphp.zendphp.comphp/licensephp/newphp-bsdphp php php php php Newphp BSDphp License
php php*php/

php/php*php*
php php*php Zendphp_Httpphp_Responsephp representsphp anphp HTTPphp php1php.php0php php/php php1php.php1php responsephp messagephp.php It
php php*php includesphp easyphp accessphp tophp allphp thephp responsephp'sphp differentphp elemtsphp,php asphp wellphp asphp some
php php*php conveniencephp methodsphp forphp parsingphp andphp validatingphp HTTPphp responsesphp.
php php*
php php*php php@packagephp php php php Zendphp_Http
php php*php php@subpackagephp Response
php php*php php@copyrightphp php Copyrightphp php(cphp)php php2php0php0php5php-php2php0php1php0php Zendphp Technologiesphp USAphp Incphp.php php(httpphp:php/php/wwwphp.zendphp.comphp)
php php*php php@licensephp php php php httpphp:php/php/frameworkphp.zendphp.comphp/licensephp/newphp-bsdphp php php php php Newphp BSDphp License
php php*php/
classphp Zendphp_Httpphp_Response
php{
php php php php php/php*php*
php php php php php php*php Listphp ofphp allphp knownphp HTTPphp responsephp codesphp php-php usedphp byphp responseCodeAsTextphp(php)php to
php php php php php php*php translatephp numericphp codesphp tophp messagesphp.
php php php php php php*
php php php php php php*php php@varphp array
php php php php php php*php/
php php php php protectedphp staticphp php$messagesphp php=php arrayphp(
php php php php php php php php php/php/php Informationalphp php1xx
php php php php php php php php php1php0php0php php=php>php php'Continuephp'php,
php php php php php php php php php1php0php1php php=php>php php'Switchingphp Protocolsphp'php,

php php php php php php php php php/php/php Successphp php2xx
php php php php php php php php php2php0php0php php=php>php php'OKphp'php,
php php php php php php php php php2php0php1php php=php>php php'Createdphp'php,
php php php php php php php php php2php0php2php php=php>php php'Acceptedphp'php,
php php php php php php php php php2php0php3php php=php>php php'Nonphp-Authoritativephp Informationphp'php,
php php php php php php php php php2php0php4php php=php>php php'Nophp Contentphp'php,
php php php php php php php php php2php0php5php php=php>php php'Resetphp Contentphp'php,
php php php php php php php php php2php0php6php php=php>php php'Partialphp Contentphp'php,

php php php php php php php php php/php/php Redirectionphp php3xx
php php php php php php php php php3php0php0php php=php>php php'Multiplephp Choicesphp'php,
php php php php php php php php php3php0php1php php=php>php php'Movedphp Permanentlyphp'php,
php php php php php php php php php3php0php2php php=php>php php'Foundphp'php,php php php/php/php php1php.php1
php php php php php php php php php3php0php3php php=php>php php'Seephp Otherphp'php,
php php php php php php php php php3php0php4php php=php>php php'Notphp Modifiedphp'php,
php php php php php php php php php3php0php5php php=php>php php'Usephp Proxyphp'php,
php php php php php php php php php/php/php php3php0php6php isphp deprecatedphp butphp reserved
php php php php php php php php php3php0php7php php=php>php php'Temporaryphp Redirectphp'php,

php php php php php php php php php/php/php Clientphp Errorphp php4xx
php php php php php php php php php4php0php0php php=php>php php'Badphp Requestphp'php,
php php php php php php php php php4php0php1php php=php>php php'Unauthorizedphp'php,
php php php php php php php php php4php0php2php php=php>php php'Paymentphp Requiredphp'php,
php php php php php php php php php4php0php3php php=php>php php'Forbiddenphp'php,
php php php php php php php php php4php0php4php php=php>php php'Notphp Foundphp'php,
php php php php php php php php php4php0php5php php=php>php php'Methodphp Notphp Allowedphp'php,
php php php php php php php php php4php0php6php php=php>php php'Notphp Acceptablephp'php,
php php php php php php php php php4php0php7php php=php>php php'Proxyphp Authenticationphp Requiredphp'php,
php php php php php php php php php4php0php8php php=php>php php'Requestphp Timeoutphp'php,
php php php php php php php php php4php0php9php php=php>php php'Conflictphp'php,
php php php php php php php php php4php1php0php php=php>php php'Gonephp'php,
php php php php php php php php php4php1php1php php=php>php php'Lengthphp Requiredphp'php,
php php php php php php php php php4php1php2php php=php>php php'Preconditionphp Failedphp'php,
php php php php php php php php php4php1php3php php=php>php php'Requestphp Entityphp Toophp Largephp'php,
php php php php php php php php php4php1php4php php=php>php php'Requestphp-URIphp Toophp Longphp'php,
php php php php php php php php php4php1php5php php=php>php php'Unsupportedphp Mediaphp Typephp'php,
php php php php php php php php php4php1php6php php=php>php php'Requestedphp Rangephp Notphp Satisfiablephp'php,
php php php php php php php php php4php1php7php php=php>php php'Expectationphp Failedphp'php,

php php php php php php php php php/php/php Serverphp Errorphp php5xx
php php php php php php php php php5php0php0php php=php>php php'Internalphp Serverphp Errorphp'php,
php php php php php php php php php5php0php1php php=php>php php'Notphp Implementedphp'php,
php php php php php php php php php5php0php2php php=php>php php'Badphp Gatewayphp'php,
php php php php php php php php php5php0php3php php=php>php php'Servicephp Unavailablephp'php,
php php php php php php php php php5php0php4php php=php>php php'Gatewayphp Timeoutphp'php,
php php php php php php php php php5php0php5php php=php>php php'HTTPphp Versionphp Notphp Supportedphp'php,
php php php php php php php php php5php0php9php php=php>php php'Bandwidthphp Limitphp Exceededphp'
php php php php php)php;

php php php php php/php*php*
php php php php php php*php Thephp HTTPphp versionphp php(php1php.php0php,php php1php.php1php)
php php php php php php*
php php php php php php*php php@varphp string
php php php php php php*php/
php php php php protectedphp php$versionphp;

php php php php php/php*php*
php php php php php php*php Thephp HTTPphp responsephp code
php php php php php php*
php php php php php php*php php@varphp int
php php php php php php*php/
php php php php protectedphp php$codephp;

php php php php php/php*php*
php php php php php php*php Thephp HTTPphp responsephp codephp asphp string
php php php php php php*php php(ephp.gphp.php php'Notphp Foundphp'php forphp php4php0php4php orphp php'Internalphp Serverphp Errorphp'php forphp php5php0php0php)
php php php php php php*
php php php php php php*php php@varphp string
php php php php php php*php/
php php php php protectedphp php$messagephp;

php php php php php/php*php*
php php php php php php*php Thephp HTTPphp responsephp headersphp array
php php php php php php*
php php php php php php*php php@varphp array
php php php php php php*php/
php php php php protectedphp php$headersphp php=php arrayphp(php)php;

php php php php php/php*php*
php php php php php php*php Thephp HTTPphp responsephp body
php php php php php php*
php php php php php php*php php@varphp string
php php php php php php*php/
php php php php protectedphp php$bodyphp;

php php php php php/php*php*
php php php php php php*php HTTPphp responsephp constructor
php php php php php php*
php php php php php php*php Inphp mostphp casesphp,php youphp wouldphp usephp Zendphp_Httpphp_Responsephp:php:fromStringphp tophp parsephp anphp HTTP
php php php php php php*php responsephp stringphp andphp createphp aphp newphp Zendphp_Httpphp_Responsephp objectphp.
php php php php php php*
php php php php php php*php NOTEphp:php Thephp constructorphp nophp longerphp acceptsphp nullsphp orphp emptyphp valuesphp forphp thephp codephp and
php php php php php php*php headersphp andphp willphp throwphp anphp exceptionphp ifphp thephp passedphp valuesphp dophp notphp formphp aphp validphp HTTP
php php php php php php*php responsesphp.
php php php php php php*
php php php php php php*php Ifphp nophp messagephp isphp passedphp,php thephp messagephp willphp bephp guessedphp accordingphp tophp thephp responsephp codephp.
php php php php php php*
php php php php php php*php php@paramphp intphp php php php php$codephp Responsephp codephp php(php2php0php0php,php php4php0php4php,php php.php.php.php)
php php php php php php*php php@paramphp arrayphp php php$headersphp Headersphp array
php php php php php php*php php@paramphp stringphp php$bodyphp Responsephp body
php php php php php php*php php@paramphp stringphp php$versionphp HTTPphp version
php php php php php php*php php@paramphp stringphp php$messagephp Responsephp codephp asphp text
php php php php php php*php php@throwsphp Zendphp_Httpphp_Exception
php php php php php php*php/
php php php php publicphp functionphp php_php_constructphp(php$codephp,php arrayphp php$headersphp,php php$bodyphp php=php nullphp,php php$versionphp php=php php'php1php.php1php'php,php php$messagephp php=php nullphp)
php php php php php{
php php php php php php php php php/php/php Makephp surephp thephp responsephp codephp isphp validphp andphp setphp it
php php php php php php php php ifphp php(selfphp:php:responseCodeAsTextphp(php$codephp)php php=php=php=php nullphp)php php{
php php php php php php php php php php php php requirephp_oncephp php'Zendphp/Httpphp/Exceptionphp.phpphp'php;
php php php php php php php php php php php php throwphp newphp Zendphp_Httpphp_Exceptionphp(php"php{php$codephp}php isphp notphp aphp validphp HTTPphp responsephp codephp"php)php;
php php php php php php php php php}

php php php php php php php php php$thisphp-php>codephp php=php php$codephp;

php php php php php php php php foreachphp php(php$headersphp asphp php$namephp php=php>php php$valuephp)php php{
php php php php php php php php php php php php ifphp php(isphp_intphp(php$namephp)php)php php{
php php php php php php php php php php php php php php php php php$headerphp php=php explodephp(php"php:php"php,php php$valuephp,php php2php)php;
php php php php php php php php php php php php php php php php ifphp php(countphp(php$headerphp)php php!php=php php2php)php php{
php php php php php php php php php php php php php php php php php php php php requirephp_oncephp php'Zendphp/Httpphp/Exceptionphp.phpphp'php;
php php php php php php php php php php php php php php php php php php php php throwphp newphp Zendphp_Httpphp_Exceptionphp(php"php'php{php$valuephp}php'php isphp notphp aphp validphp HTTPphp headerphp"php)php;
php php php php php php php php php php php php php php php php php}

php php php php php php php php php php php php php php php php php$namephp php php=php trimphp(php$headerphp[php0php]php)php;
php php php php php php php php php php php php php php php php php$valuephp php=php trimphp(php$headerphp[php1php]php)php;
php php php php php php php php php php php php php}

php php php php php php php php php php php php php$thisphp-php>headersphp[ucwordsphp(strtolowerphp(php$namephp)php)php]php php=php php$valuephp;
php php php php php php php php php}

php php php php php php php php php/php/php Setphp thephp body
php php php php php php php php php$thisphp-php>bodyphp php=php php$bodyphp;

php php php php php php php php php/php/php Setphp thephp HTTPphp version
php php php php php php php php ifphp php(php!php pregphp_matchphp(php'php|php^php\dphp\php.php\dphp$php|php'php,php php$versionphp)php)php php{
php php php php php php php php php php php php requirephp_oncephp php'Zendphp/Httpphp/Exceptionphp.phpphp'php;
php php php php php php php php php php php php throwphp newphp Zendphp_Httpphp_Exceptionphp(php"Invalidphp HTTPphp responsephp versionphp:php php$versionphp"php)php;
php php php php php php php php php}

php php php php php php php php php$thisphp-php>versionphp php=php php$versionphp;

php php php php php php php php php/php/php Ifphp wephp gotphp thephp responsephp messagephp,php setphp itphp.php Elsephp,php setphp itphp accordingphp to
php php php php php php php php php/php/php thephp responsephp code
php php php php php php php php ifphp php(isphp_stringphp(php$messagephp)php)php php{
php php php php php php php php php php php php php$thisphp-php>messagephp php=php php$messagephp;
php php php php php php php php php}php elsephp php{
php php php php php php php php php php php php php$thisphp-php>messagephp php=php selfphp:php:responseCodeAsTextphp(php$codephp)php;
php php php php php php php php php}
php php php php php}

php php php php php/php*php*
php php php php php php*php Checkphp whetherphp thephp responsephp isphp anphp error
php php php php php php*
php php php php php php*php php@returnphp boolean
php php php php php php*php/
php php php php publicphp functionphp isErrorphp(php)
php php php php php{
php php php php php php php php php$restypephp php=php floorphp(php$thisphp-php>codephp php/php php1php0php0php)php;
php php php php php php php php ifphp php(php$restypephp php=php=php php4php php|php|php php$restypephp php=php=php php5php)php php{
php php php php php php php php php php php php returnphp truephp;
php php php php php php php php php}

php php php php php php php php returnphp falsephp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Checkphp whetherphp thephp responsephp inphp successful
php php php php php php*
php php php php php php*php php@returnphp boolean
php php php php php php*php/
php php php php publicphp functionphp isSuccessfulphp(php)
php php php php php{
php php php php php php php php php$restypephp php=php floorphp(php$thisphp-php>codephp php/php php1php0php0php)php;
php php php php php php php php ifphp php(php$restypephp php=php=php php2php php|php|php php$restypephp php=php=php php1php)php php{php php/php/php Shouldnphp'tphp php3xxphp countphp asphp successphp asphp wellphp php?php?php?
php php php php php php php php php php php php returnphp truephp;
php php php php php php php php php}

php php php php php php php php returnphp falsephp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Checkphp whetherphp thephp responsephp isphp aphp redirection
php php php php php php*
php php php php php php*php php@returnphp boolean
php php php php php php*php/
php php php php publicphp functionphp isRedirectphp(php)
php php php php php{
php php php php php php php php php$restypephp php=php floorphp(php$thisphp-php>codephp php/php php1php0php0php)php;
php php php php php php php php ifphp php(php$restypephp php=php=php php3php)php php{
php php php php php php php php php php php php returnphp truephp;
php php php php php php php php php}

php php php php php php php php returnphp falsephp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Getphp thephp responsephp bodyphp asphp string
php php php php php php*
php php php php php php*php Thisphp methodphp returnsphp thephp bodyphp ofphp thephp HTTPphp responsephp php(thephp contentphp)php,php asphp it
php php php php php php*php shouldphp bephp inphp itphp'sphp readablephp versionphp php-php thatphp isphp,php afterphp decodingphp itphp php(ifphp it
php php php php php php*php wasphp decodedphp)php,php deflatingphp itphp php(ifphp itphp wasphp gzipphp compressedphp)php,php etcphp.
php php php php php php*
php php php php php php*php Ifphp youphp wantphp tophp getphp thephp rawphp bodyphp php(asphp transferedphp onphp wirephp)php use
php php php php php php*php php$thisphp-php>getRawBodyphp(php)php insteadphp.
php php php php php php*
php php php php php php*php php@returnphp string
php php php php php php*php/
php php php php publicphp functionphp getBodyphp(php)
php php php php php{
php php php php php php php php php$bodyphp php=php php'php'php;

php php php php php php php php php/php/php Decodephp thephp bodyphp ifphp itphp wasphp transferphp-encoded
php php php php php php php php switchphp php(strtolowerphp(php$thisphp-php>getHeaderphp(php'transferphp-encodingphp'php)php)php)php php{

php php php php php php php php php php php php php/php/php Handlephp chunkedphp body
php php php php php php php php php php php php casephp php'chunkedphp'php:
php php php php php php php php php php php php php php php php php$bodyphp php=php selfphp:php:decodeChunkedBodyphp(php$thisphp-php>bodyphp)php;
php php php php php php php php php php php php php php php php breakphp;

php php php php php php php php php php php php php/php/php Nophp transferphp encodingphp,php orphp unknownphp encodingphp extensionphp:
php php php php php php php php php php php php php/php/php returnphp bodyphp asphp is
php php php php php php php php php php php php defaultphp:
php php php php php php php php php php php php php php php php php$bodyphp php=php php$thisphp-php>bodyphp;
php php php php php php php php php php php php php php php php breakphp;
php php php php php php php php php}

php php php php php php php php php/php/php Decodephp anyphp contentphp-encodingphp php(gzipphp orphp deflatephp)php ifphp needed
php php php php php php php php switchphp php(strtolowerphp(php$thisphp-php>getHeaderphp(php'contentphp-encodingphp'php)php)php)php php{

php php php php php php php php php php php php php/php/php Handlephp gzipphp encoding
php php php php php php php php php php php php casephp php'gzipphp'php:
php php php php php php php php php php php php php php php php php$bodyphp php=php selfphp:php:decodeGzipphp(php$bodyphp)php;
php php php php php php php php php php php php php php php php breakphp;

php php php php php php php php php php php php php/php/php Handlephp deflatephp encoding
php php php php php php php php php php php php casephp php'deflatephp'php:
php php php php php php php php php php php php php php php php php$bodyphp php=php selfphp:php:decodeDeflatephp(php$bodyphp)php;
php php php php php php php php php php php php php php php php breakphp;

php php php php php php php php php php php php defaultphp:
php php php php php php php php php php php php php php php php breakphp;
php php php php php php php php php}

php php php php php php php php returnphp php$bodyphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Getphp thephp rawphp responsephp bodyphp php(asphp transferedphp php"onphp wirephp"php)php asphp string
php php php php php php*
php php php php php php*php Ifphp thephp bodyphp isphp encodedphp php(withphp Transferphp-Encodingphp,php notphp contentphp-encodingphp php-
php php php php php php*php IEphp php"chunkedphp"php bodyphp)php,php gzipphp compressedphp,php etcphp.php itphp willphp notphp bephp decodedphp.
php php php php php php*
php php php php php php*php php@returnphp string
php php php php php php*php/
php php php php publicphp functionphp getRawBodyphp(php)
php php php php php{
php php php php php php php php returnphp php$thisphp-php>bodyphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Getphp thephp HTTPphp versionphp ofphp thephp response
php php php php php php*
php php php php php php*php php@returnphp string
php php php php php php*php/
php php php php publicphp functionphp getVersionphp(php)
php php php php php{
php php php php php php php php returnphp php$thisphp-php>versionphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Getphp thephp HTTPphp responsephp statusphp code
php php php php php php*
php php php php php php*php php@returnphp int
php php php php php php*php/
php php php php publicphp functionphp getStatusphp(php)
php php php php php{
php php php php php php php php returnphp php$thisphp-php>codephp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Returnphp aphp messagephp describingphp thephp HTTPphp responsephp code
php php php php php php*php php(Egphp.php php"OKphp"php,php php"Notphp Foundphp"php,php php"Movedphp Permanentlyphp"php)
php php php php php php*
php php php php php php*php php@returnphp string
php php php php php php*php/
php php php php publicphp functionphp getMessagephp(php)
php php php php php{
php php php php php php php php returnphp php$thisphp-php>messagephp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Getphp thephp responsephp headers
php php php php php php*
php php php php php php*php php@returnphp array
php php php php php php*php/
php php php php publicphp functionphp getHeadersphp(php)
php php php php php{
php php php php php php php php returnphp php$thisphp-php>headersphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Getphp aphp specificphp headerphp asphp stringphp,php orphp nullphp ifphp itphp isphp notphp set
php php php php php php*
php php php php php php*php php@paramphp stringphp$header
php php php php php php*php php@returnphp stringphp|arrayphp|null
php php php php php php*php/
php php php php publicphp functionphp getHeaderphp(php$headerphp)
php php php php php{
php php php php php php php php php$headerphp php=php ucwordsphp(strtolowerphp(php$headerphp)php)php;
php php php php php php php php ifphp php(php!php isphp_stringphp(php$headerphp)php php|php|php php!php issetphp(php$thisphp-php>headersphp[php$headerphp]php)php)php returnphp nullphp;

php php php php php php php php returnphp php$thisphp-php>headersphp[php$headerphp]php;
php php php php php}

php php php php php/php*php*
php php php php php php*php Getphp allphp headersphp asphp string
php php php php php php*
php php php php php php*php php@paramphp booleanphp php$statusphp_linephp Whetherphp tophp returnphp thephp firstphp statusphp linephp php(IEphp php"HTTPphp php2php0php0php OKphp"php)
php php php php php php*php php@paramphp stringphp php$brphp Linephp breaksphp php(egphp.php php"php\nphp"php,php php"php\rphp\nphp"php,php php"php<brphp php/php>php"php)
php php php php php php*php php@returnphp string
php php php php php php*php/
php php php php publicphp functionphp getHeadersAsStringphp(php$statusphp_linephp php=php truephp,php php$brphp php=php php"php\nphp"php)
php php php php php{
php php php php php php php php php$strphp php=php php'php'php;

php php php php php php php php ifphp php(php$statusphp_linephp)php php{
php php php php php php php php php php php php php$strphp php=php php"HTTPphp/php{php$thisphp-php>versionphp}php php{php$thisphp-php>codephp}php php{php$thisphp-php>messagephp}php{php$brphp}php"php;
php php php php php php php php php}

php php php php php php php php php/php/php Iteratephp overphp thephp headersphp andphp stringifyphp them
php php php php php php php php foreachphp php(php$thisphp-php>headersphp asphp php$namephp php=php>php php$valuephp)
php php php php php php php php php{
php php php php php php php php php php php php ifphp php(isphp_stringphp(php$valuephp)php)
php php php php php php php php php php php php php php php php php$strphp php.php=php php"php{php$namephp}php:php php{php$valuephp}php{php$brphp}php"php;

php php php php php php php php php php php php elseifphp php(isphp_arrayphp(php$valuephp)php)php php{
php php php php php php php php php php php php php php php php foreachphp php(php$valuephp asphp php$subvalphp)php php{
php php php php php php php php php php php php php php php php php php php php php$strphp php.php=php php"php{php$namephp}php:php php{php$subvalphp}php{php$brphp}php"php;
php php php php php php php php php php php php php php php php php}
php php php php php php php php php php php php php}
php php php php php php php php php}

php php php php php php php php returnphp php$strphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Getphp thephp entirephp responsephp asphp string
php php php php php php*
php php php php php php*php php@paramphp stringphp php$brphp Linephp breaksphp php(egphp.php php"php\nphp"php,php php"php\rphp\nphp"php,php php"php<brphp php/php>php"php)
php php php php php php*php php@returnphp string
php php php php php php*php/
php php php php publicphp functionphp asStringphp(php$brphp php=php php"php\nphp"php)
php php php php php{
php php php php php php php php returnphp php$thisphp-php>getHeadersAsStringphp(truephp,php php$brphp)php php.php php$brphp php.php php$thisphp-php>getRawBodyphp(php)php;
php php php php php}

php php php php php/php*php*
php php php php php php*php Implementsphp magicphp php_php_toStringphp(php)
php php php php php php*
php php php php php php*php php@returnphp string
php php php php php php*php/
php php php php publicphp functionphp php_php_toStringphp(php)
php php php php php{
php php php php php php php php returnphp php$thisphp-php>asStringphp(php)php;
php php php php php}

php php php php php/php*php*
php php php php php php*php Aphp conveniencephp functionphp thatphp returnsphp aphp textphp representationphp of
php php php php php php*php HTTPphp responsephp codesphp.php Returnsphp php'Unknownphp'php forphp unknownphp codesphp.
php php php php php php*php Returnsphp arrayphp ofphp allphp codesphp,php ifphp php$codephp isphp notphp specifiedphp.
php php php php php php*
php php php php php php*php Conformsphp tophp HTTPphp/php1php.php1php asphp definedphp inphp RFCphp php2php6php1php6php php(exceptphp forphp php'Unknownphp'php)
php php php php php php*php Seephp httpphp:php/php/wwwphp.wphp3php.orgphp/Protocolsphp/rfcphp2php6php1php6php/rfcphp2php6php1php6php-secphp1php0php.htmlphp#secphp1php0php forphp reference
php php php php php php*
php php php php php php*php php@paramphp intphp php$codephp HTTPphp responsephp code
php php php php php php*php php@paramphp booleanphp php$httpphp1php1php Usephp HTTPphp versionphp php1php.php1
php php php php php php*php php@returnphp string
php php php php php php*php/
php php php php publicphp staticphp functionphp responseCodeAsTextphp(php$codephp php=php nullphp,php php$httpphp1php1php php=php truephp)
php php php php php{
php php php php php php php php php$messagesphp php=php selfphp:php:php$messagesphp;
php php php php php php php php ifphp php(php!php php$httpphp1php1php)php php$messagesphp[php3php0php2php]php php=php php'Movedphp Temporarilyphp'php;

php php php php php php php php ifphp php(php$codephp php=php=php=php nullphp)php php{
php php php php php php php php php php php php returnphp php$messagesphp;
php php php php php php php php php}php elseifphp php(issetphp(php$messagesphp[php$codephp]php)php)php php{
php php php php php php php php php php php php returnphp php$messagesphp[php$codephp]php;
php php php php php php php php php}php elsephp php{
php php php php php php php php php php php php returnphp php'Unknownphp'php;
php php php php php php php php php}
php php php php php}

php php php php php/php*php*
php php php php php php*php Extractphp thephp responsephp codephp fromphp aphp responsephp string
php php php php php php*
php php php php php php*php php@paramphp stringphp php$responsephp_str
php php php php php php*php php@returnphp int
php php php php php php*php/
php php php php publicphp staticphp functionphp extractCodephp(php$responsephp_strphp)
php php php php php{
php php php php php php php php pregphp_matchphp(php"php|php^HTTPphp/php[php\dphp\php.xphp]php+php php(php\dphp+php)php|php"php,php php$responsephp_strphp,php php$mphp)php;

php php php php php php php php ifphp php(issetphp(php$mphp[php1php]php)php)php php{
php php php php php php php php php php php php returnphp php(intphp)php php$mphp[php1php]php;
php php php php php php php php php}php elsephp php{
php php php php php php php php php php php php returnphp falsephp;
php php php php php php php php php}
php php php php php}

php php php php php/php*php*
php php php php php php*php Extractphp thephp HTTPphp messagephp fromphp aphp response
php php php php php php*
php php php php php php*php php@paramphp stringphp php$responsephp_str
php php php php php php*php php@returnphp string
php php php php php php*php/
php php php php publicphp staticphp functionphp extractMessagephp(php$responsephp_strphp)
php php php php php{
php php php php php php php php pregphp_matchphp(php"php|php^HTTPphp/php[php\dphp\php.xphp]php+php php\dphp+php php(php[php^php\rphp\nphp]php+php)php|php"php,php php$responsephp_strphp,php php$mphp)php;

php php php php php php php php ifphp php(issetphp(php$mphp[php1php]php)php)php php{
php php php php php php php php php php php php returnphp php$mphp[php1php]php;
php php php php php php php php php}php elsephp php{
php php php php php php php php php php php php returnphp falsephp;
php php php php php php php php php}
php php php php php}

php php php php php/php*php*
php php php php php php*php Extractphp thephp HTTPphp versionphp fromphp aphp response
php php php php php php*
php php php php php php*php php@paramphp stringphp php$responsephp_str
php php php php php php*php php@returnphp string
php php php php php php*php/
php php php php publicphp staticphp functionphp extractVersionphp(php$responsephp_strphp)
php php php php php{
php php php php php php php php pregphp_matchphp(php"php|php^HTTPphp/php(php[php\dphp\php.xphp]php+php)php php\dphp+php|php"php,php php$responsephp_strphp,php php$mphp)php;

php php php php php php php php ifphp php(issetphp(php$mphp[php1php]php)php)php php{
php php php php php php php php php php php php returnphp php$mphp[php1php]php;
php php php php php php php php php}php elsephp php{
php php php php php php php php php php php php returnphp falsephp;
php php php php php php php php php}
php php php php php}

php php php php php/php*php*
php php php php php php*php Extractphp thephp headersphp fromphp aphp responsephp string
php php php php php php*
php php php php php php*php php@paramphp php php stringphp php$responsephp_str
php php php php php php*php php@returnphp php array
php php php php php php*php/
php php php php publicphp staticphp functionphp extractHeadersphp(php$responsephp_strphp)
php php php php php{
php php php php php php php php php$headersphp php=php arrayphp(php)php;

php php php php php php php php php/php/php Firstphp,php splitphp bodyphp andphp headers
php php php php php php php php php$partsphp php=php pregphp_splitphp(php'php|php(php?php:php\rphp?php\nphp)php{php2php}php|mphp'php,php php$responsephp_strphp,php php2php)php;
php php php php php php php php ifphp php(php!php php$partsphp[php0php]php)php returnphp php$headersphp;

php php php php php php php php php/php/php Splitphp headersphp partphp tophp lines
php php php php php php php php php$linesphp php=php explodephp(php"php\nphp"php,php php$partsphp[php0php]php)php;
php php php php php php php php unsetphp(php$partsphp)php;
php php php php php php php php php$lastphp_headerphp php=php nullphp;

php php php php php php php php foreachphp(php$linesphp asphp php$linephp)php php{
php php php php php php php php php php php php php$linephp php=php trimphp(php$linephp,php php"php\rphp\nphp"php)php;
php php php php php php php php php php php php ifphp php(php$linephp php=php=php php"php"php)php breakphp;

php php php php php php php php php php php php php/php/php Locatephp headersphp likephp php'Locationphp:php php.php.php.php'php andphp php'Locationphp:php.php.php.php'php php(notephp thephp missingphp spacephp)
php php php php php php php php php php php php ifphp php(pregphp_matchphp(php"php|php^php(php[php\wphp-php]php+php)php:php\sphp*php(php.php+php)php|php"php,php php$linephp,php php$mphp)php)php php{
php php php php php php php php php php php php php php php php unsetphp(php$lastphp_headerphp)php;
php php php php php php php php php php php php php php php php php$hphp_namephp php=php strtolowerphp(php$mphp[php1php]php)php;
php php php php php php php php php php php php php php php php php$hphp_valuephp php=php php$mphp[php2php]php;

php php php php php php php php php php php php php php php php ifphp php(issetphp(php$headersphp[php$hphp_namephp]php)php)php php{
php php php php php php php php php php php php php php php php php php php php ifphp php(php!php isphp_arrayphp(php$headersphp[php$hphp_namephp]php)php)php php{
php php php php php php php php php php php php php php php php php php php php php php php php php$headersphp[php$hphp_namephp]php php=php arrayphp(php$headersphp[php$hphp_namephp]php)php;
php php php php php php php php php php php php php php php php php php php php php}

php php php php php php php php php php php php php php php php php php php php php$headersphp[php$hphp_namephp]php[php]php php=php php$hphp_valuephp;
php php php php php php php php php php php php php php php php php}php elsephp php{
php php php php php php php php php php php php php php php php php php php php php$headersphp[php$hphp_namephp]php php=php php$hphp_valuephp;
php php php php php php php php php php php php php php php php php}
php php php php php php php php php php php php php php php php php$lastphp_headerphp php=php php$hphp_namephp;
php php php php php php php php php php php php php}php elseifphp php(pregphp_matchphp(php"php|php^php\sphp+php(php.php+php)php$php|php"php,php php$linephp,php php$mphp)php php&php&php php$lastphp_headerphp php!php=php=php nullphp)php php{
php php php php php php php php php php php php php php php php ifphp php(isphp_arrayphp(php$headersphp[php$lastphp_headerphp]php)php)php php{
php php php php php php php php php php php php php php php php php php php php endphp(php$headersphp[php$lastphp_headerphp]php)php;
php php php php php php php php php php php php php php php php php php php php php$lastphp_headerphp_keyphp php=php keyphp(php$headersphp[php$lastphp_headerphp]php)php;
php php php php php php php php php php php php php php php php php php php php php$headersphp[php$lastphp_headerphp]php[php$lastphp_headerphp_keyphp]php php.php=php php$mphp[php1php]php;
php php php php php php php php php php php php php php php php php}php elsephp php{
php php php php php php php php php php php php php php php php php php php php php$headersphp[php$lastphp_headerphp]php php.php=php php$mphp[php1php]php;
php php php php php php php php php php php php php php php php php}
php php php php php php php php php php php php php}
php php php php php php php php php}

php php php php php php php php returnphp php$headersphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Extractphp thephp bodyphp fromphp aphp responsephp string
php php php php php php*
php php php php php php*php php@paramphp stringphp php$responsephp_str
php php php php php php*php php@returnphp string
php php php php php php*php/
php php php php publicphp staticphp functionphp extractBodyphp(php$responsephp_strphp)
php php php php php{
php php php php php php php php php$partsphp php=php pregphp_splitphp(php'php|php(php?php:php\rphp?php\nphp)php{php2php}php|mphp'php,php php$responsephp_strphp,php php2php)php;
php php php php php php php php ifphp php(issetphp(php$partsphp[php1php]php)php)php php{
php php php php php php php php php php php php returnphp php$partsphp[php1php]php;
php php php php php php php php php}
php php php php php php php php returnphp php'php'php;
php php php php php}

php php php php php/php*php*
php php php php php php*php Decodephp aphp php"chunkedphp"php transferphp-encodedphp bodyphp andphp returnphp thephp decodedphp text
php php php php php php*
php php php php php php*php php@paramphp stringphp php$body
php php php php php php*php php@returnphp string
php php php php php php*php/
php php php php publicphp staticphp functionphp decodeChunkedBodyphp(php$bodyphp)
php php php php php{
php php php php php php php php php$decBodyphp php=php php'php'php;

php php php php php php php php php/php/php Ifphp mbstringphp overloadsphp substrphp andphp strlenphp functionsphp,php wephp havephp to
php php php php php php php php php/php/php overridephp itphp'sphp internalphp encoding
php php php php php php php php ifphp php(functionphp_existsphp(php'mbphp_internalphp_encodingphp'php)php php&php&
php php php php php php php php php php php php(php(intphp)php iniphp_getphp(php'mbstringphp.funcphp_overloadphp'php)php)php php&php php2php)php php{

php php php php php php php php php php php php php$mbIntEncphp php=php mbphp_internalphp_encodingphp(php)php;
php php php php php php php php php php php php mbphp_internalphp_encodingphp(php'ASCIIphp'php)php;
php php php php php php php php php}

php php php php php php php php whilephp php(trimphp(php$bodyphp)php)php php{
php php php php php php php php php php php php ifphp php(php!php pregphp_matchphp(php"php/php^php(php[php\daphp-fAphp-Fphp]php+php)php[php^php\rphp\nphp]php*php\rphp\nphp/smphp"php,php php$bodyphp,php php$mphp)php)php php{
php php php php php php php php php php php php php php php php requirephp_oncephp php'Zendphp/Httpphp/Exceptionphp.phpphp'php;
php php php php php php php php php php php php php php php php throwphp newphp Zendphp_Httpphp_Exceptionphp(php"Errorphp parsingphp bodyphp php-php doesnphp'tphp seemphp tophp bephp aphp chunkedphp messagephp"php)php;
php php php php php php php php php php php php php}

php php php php php php php php php php php php php$lengthphp php=php hexdecphp(trimphp(php$mphp[php1php]php)php)php;
php php php php php php php php php php php php php$cutphp php=php strlenphp(php$mphp[php0php]php)php;
php php php php php php php php php php php php php$decBodyphp php.php=php substrphp(php$bodyphp,php php$cutphp,php php$lengthphp)php;
php php php php php php php php php php php php php$bodyphp php=php substrphp(php$bodyphp,php php$cutphp php+php php$lengthphp php+php php2php)php;
php php php php php php php php php}

php php php php php php php php ifphp php(issetphp(php$mbIntEncphp)php)php php{
php php php php php php php php php php php php mbphp_internalphp_encodingphp(php$mbIntEncphp)php;
php php php php php php php php php}

php php php php php php php php returnphp php$decBodyphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Decodephp aphp gzipphp encodedphp messagephp php(whenphp Contentphp-encodingphp php=php gzipphp)
php php php php php php*
php php php php php php*php Currentlyphp requiresphp PHPphp withphp zlibphp support
php php php php php php*
php php php php php php*php php@paramphp stringphp php$body
php php php php php php*php php@returnphp string
php php php php php php*php/
php php php php publicphp staticphp functionphp decodeGzipphp(php$bodyphp)
php php php php php{
php php php php php php php php ifphp php(php!php functionphp_existsphp(php'gzinflatephp'php)php)php php{
php php php php php php php php php php php php requirephp_oncephp php'Zendphp/Httpphp/Exceptionphp.phpphp'php;
php php php php php php php php php php php php throwphp newphp Zendphp_Httpphp_Exceptionphp(
php php php php php php php php php php php php php php php php php'zlibphp extensionphp isphp requiredphp inphp orderphp tophp decodephp php"gzipphp"php encodingphp'
php php php php php php php php php php php php php)php;
php php php php php php php php php}

php php php php php php php php returnphp gzinflatephp(substrphp(php$bodyphp,php php1php0php)php)php;
php php php php php}

php php php php php/php*php*
php php php php php php*php Decodephp aphp zlibphp deflatedphp messagephp php(whenphp Contentphp-encodingphp php=php deflatephp)
php php php php php php*
php php php php php php*php Currentlyphp requiresphp PHPphp withphp zlibphp support
php php php php php php*
php php php php php php*php php@paramphp stringphp php$body
php php php php php php*php php@returnphp string
php php php php php php*php/
php php php php publicphp staticphp functionphp decodeDeflatephp(php$bodyphp)
php php php php php{
php php php php php php php php ifphp php(php!php functionphp_existsphp(php'gzuncompressphp'php)php)php php{
php php php php php php php php php php php php requirephp_oncephp php'Zendphp/Httpphp/Exceptionphp.phpphp'php;
php php php php php php php php php php php php throwphp newphp Zendphp_Httpphp_Exceptionphp(
php php php php php php php php php php php php php php php php php'zlibphp extensionphp isphp requiredphp inphp orderphp tophp decodephp php"deflatephp"php encodingphp'
php php php php php php php php php php php php php)php;
php php php php php php php php php}

php php php php php php php php php/php*php*
php php php php php php php php php php*php Somephp serversphp php(IISphp php?php)php sendphp aphp brokenphp deflatephp responsephp,php withoutphp the
php php php php php php php php php php*php RFCphp-requiredphp zlibphp headerphp.
php php php php php php php php php php*
php php php php php php php php php php*php Wephp tryphp tophp detectphp thephp zlibphp headerphp,php andphp ifphp itphp doesphp notphp exsitphp we
php php php php php php php php php php*php teatphp thephp bodyphp isphp plainphp DEFLATEphp contentphp.
php php php php php php php php php php*
php php php php php php php php php php*php Thisphp methodphp wasphp adaptedphp fromphp PEARphp HTTPphp_Requestphp2php byphp php(cphp)php Alexeyphp Borzov
php php php php php php php php php php*
php php php php php php php php php php*php php@linkphp httpphp:php/php/frameworkphp.zendphp.comphp/issuesphp/browsephp/ZFphp-php6php0php4php0
php php php php php php php php php php*php/
php php php php php php php php php$zlibHeaderphp php=php unpackphp(php'nphp'php,php substrphp(php$bodyphp,php php0php,php php2php)php)php;
php php php php php php php php ifphp php(php$zlibHeaderphp[php1php]php php%php php3php1php php=php=php php0php)php php{
php php php php php php php php php php php php returnphp gzuncompressphp(php$bodyphp)php;
php php php php php php php php php}php elsephp php{
php php php php php php php php php php php php returnphp gzinflatephp(php$bodyphp)php;
php php php php php php php php php}
php php php php php}

php php php php php/php*php*
php php php php php php*php Createphp aphp newphp Zendphp_Httpphp_Responsephp objectphp fromphp aphp string
php php php php php php*
php php php php php php*php php@paramphp stringphp php$responsephp_str
php php php php php php*php php@returnphp Zendphp_Httpphp_Response
php php php php php php*php/
php php php php publicphp staticphp functionphp fromStringphp(php$responsephp_strphp)
php php php php php{
php php php php php php php php php$codephp php php php php=php selfphp:php:extractCodephp(php$responsephp_strphp)php;
php php php php php php php php php$headersphp php=php selfphp:php:extractHeadersphp(php$responsephp_strphp)php;
php php php php php php php php php$bodyphp php php php php=php selfphp:php:extractBodyphp(php$responsephp_strphp)php;
php php php php php php php php php$versionphp php=php selfphp:php:extractVersionphp(php$responsephp_strphp)php;
php php php php php php php php php$messagephp php=php selfphp:php:extractMessagephp(php$responsephp_strphp)php;

php php php php php php php php returnphp newphp Zendphp_Httpphp_Responsephp(php$codephp,php php$headersphp,php php$bodyphp,php php$versionphp,php php$messagephp)php;
php php php php php}
php}
