<php?php

php/php*php*
php php*php Zendphp Framework
php php*
php php*php LICENSE
php php*
php php*php Thisphp sourcephp filephp isphp subjectphp tophp thephp newphp BSDphp licensephp thatphp isphp bundled
php php*php withphp thisphp packagephp inphp thephp filephp LICENSEphp.txtphp.
php php*php Itphp isphp alsophp availablephp throughphp thephp worldphp-widephp-webphp atphp thisphp URLphp:
php php*php httpphp:php/php/frameworkphp.zendphp.comphp/licensephp/newphp-bsd
php php*php Ifphp youphp didphp notphp receivephp aphp copyphp ofphp thephp licensephp andphp arephp unablephp to
php php*php obtainphp itphp throughphp thephp worldphp-widephp-webphp,php pleasephp sendphp anphp email
php php*php tophp licensephp@zendphp.comphp sophp wephp canphp sendphp youphp aphp copyphp immediatelyphp.
php php*
php php*php php@categoryphp php php Zend
php php*php php@packagephp php php php Zendphp_Http
php php*php php@subpackagephp Cookie
php php*php php@copyrightphp php Copyrightphp php(cphp)php php2php0php0php5php-php2php0php1php0php Zendphp Technologiesphp USAphp Incphp.php php(httpphp:php/php/wwwphp.zendphp.comphp)
php php*php php@versionphp php php php php$Idphp:php Cookiephp.phpphp php2php3php4php4php3php php2php0php1php0php-php1php1php-php2php4php php1php1php:php5php3php:php1php3Zphp shaharphp php$
php php*php php@licensephp php php php httpphp:php/php/frameworkphp.zendphp.comphp/licensephp/newphp-bsdphp php php php php Newphp BSDphp License
php php*php/

php/php*php*
php php*php php@seephp Zendphp_Uriphp_Http
php php*php/
requirephp_oncephp php'Zendphp/Uriphp/Httpphp.phpphp'php;


php/php*php*
php php*php Zendphp_Httpphp_Cookiephp isphp aphp classphp describingphp anphp HTTPphp cookiephp andphp allphp itphp'sphp parametersphp.
php php*
php php*php Zendphp_Httpphp_Cookiephp isphp aphp classphp describingphp anphp HTTPphp cookiephp andphp allphp itphp'sphp parametersphp.php The
php php*php classphp alsophp enablesphp validatingphp whetherphp thephp cookiephp shouldphp bephp sentphp tophp thephp serverphp in
php php*php aphp specifiedphp scenariophp accordingphp tophp thephp requestphp URIphp,php thephp expiryphp timephp andphp whether
php php*php sessionphp cookiesphp shouldphp bephp usedphp orphp notphp.php Generallyphp speakingphp cookiesphp shouldphp be
php php*php containedphp inphp aphp Cookiejarphp objectphp,php orphp instantiatedphp manuallyphp andphp addedphp tophp anphp HTTP
php php*php requestphp.
php php*
php php*php Seephp httpphp:php/php/wpphp.netscapephp.comphp/newsrefphp/stdphp/cookiephp_specphp.htmlphp forphp somephp specsphp.
php php*
php php*php php@categoryphp php php Zend
php php*php php@packagephp php php php Zendphp_Http
php php*php php@copyrightphp php Copyrightphp php(cphp)php php2php0php0php5php-php2php0php1php0php Zendphp Technologiesphp USAphp Incphp.php php(httpphp:php/php/wwwphp.zendphp.comphp)
php php*php php@licensephp php php php httpphp:php/php/frameworkphp.zendphp.comphp/licensephp/newphp-bsdphp php php php php Newphp BSDphp License
php php*php/
classphp Zendphp_Httpphp_Cookie
php{
php php php php php/php*php*
php php php php php php*php Cookiephp name
php php php php php php*
php php php php php php*php php@varphp string
php php php php php php*php/
php php php php protectedphp php$namephp;

php php php php php/php*php*
php php php php php php*php Cookiephp value
php php php php php php*
php php php php php php*php php@varphp string
php php php php php php*php/
php php php php protectedphp php$valuephp;

php php php php php/php*php*
php php php php php php*php Cookiephp expiryphp date
php php php php php php*
php php php php php php*php php@varphp int
php php php php php php*php/
php php php php protectedphp php$expiresphp;

php php php php php/php*php*
php php php php php php*php Cookiephp domain
php php php php php php*
php php php php php php*php php@varphp string
php php php php php php*php/
php php php php protectedphp php$domainphp;

php php php php php/php*php*
php php php php php php*php Cookiephp path
php php php php php php*
php php php php php php*php php@varphp string
php php php php php php*php/
php php php php protectedphp php$pathphp;

php php php php php/php*php*
php php php php php php*php Whetherphp thephp cookiephp isphp securephp orphp not
php php php php php php*
php php php php php php*php php@varphp boolean
php php php php php php*php/
php php php php protectedphp php$securephp;

php php php php php/php*php*
php php php php php php*php Whetherphp thephp cookiephp valuephp hasphp beenphp encodedphp/decoded
php php php php php php*
php php php php php php*php php@varphp boolean
php php php php php php*php/
php php php php protectedphp php$encodeValuephp;

php php php php php/php*php*
php php php php php php*php Cookiephp objectphp constructor
php php php php php php*
php php php php php php*php php@todophp Addphp validationphp ofphp eachphp onephp ofphp thephp parametersphp php(legalphp domainphp,php etcphp.php)
php php php php php php*
php php php php php php*php php@paramphp stringphp php$name
php php php php php php*php php@paramphp stringphp php$value
php php php php php php*php php@paramphp stringphp php$domain
php php php php php php*php php@paramphp intphp php$expires
php php php php php php*php php@paramphp stringphp php$path
php php php php php php*php php@paramphp boolphp php$secure
php php php php php php*php/
php php php php publicphp functionphp php_php_constructphp(php$namephp,php php$valuephp,php php$domainphp,php php$expiresphp php=php nullphp,php php$pathphp php=php nullphp,php php$securephp php=php falsephp)
php php php php php{
php php php php php php php php ifphp php(pregphp_matchphp(php"php/php[php=php,php;php php\tphp\rphp\nphp\php0php1php3php\php0php1php4php]php/php"php,php php$namephp)php)php php{
php php php php php php php php php php php php requirephp_oncephp php'Zendphp/Httpphp/Exceptionphp.phpphp'php;
php php php php php php php php php php php php throwphp newphp Zendphp_Httpphp_Exceptionphp(php"Cookiephp namephp cannotphp containphp thesephp charactersphp:php php=php,php;php php\php\tphp\php\rphp\php\nphp\php\php0php1php3php\php\php0php1php4php php(php{php$namephp}php)php"php)php;
php php php php php php php php php}

php php php php php php php php ifphp php(php!php php$thisphp-php>namephp php=php php(stringphp)php php$namephp)php php{
php php php php php php php php php php php php requirephp_oncephp php'Zendphp/Httpphp/Exceptionphp.phpphp'php;
php php php php php php php php php php php php throwphp newphp Zendphp_Httpphp_Exceptionphp(php'Cookiesphp mustphp havephp aphp namephp'php)php;
php php php php php php php php php}

php php php php php php php php ifphp php(php!php php$thisphp-php>domainphp php=php php(stringphp)php php$domainphp)php php{
php php php php php php php php php php php php requirephp_oncephp php'Zendphp/Httpphp/Exceptionphp.phpphp'php;
php php php php php php php php php php php php throwphp newphp Zendphp_Httpphp_Exceptionphp(php'Cookiesphp mustphp havephp aphp domainphp'php)php;
php php php php php php php php php}

php php php php php php php php php$thisphp-php>valuephp php=php php(stringphp)php php$valuephp;
php php php php php php php php php$thisphp-php>expiresphp php=php php(php$expiresphp php=php=php=php nullphp php?php nullphp php:php php(intphp)php php$expiresphp)php;
php php php php php php php php php$thisphp-php>pathphp php=php php(php$pathphp php?php php$pathphp php:php php'php/php'php)php;
php php php php php php php php php$thisphp-php>securephp php=php php$securephp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Getphp Cookiephp name
php php php php php php*
php php php php php php*php php@returnphp string
php php php php php php*php/
php php php php publicphp functionphp getNamephp(php)
php php php php php{
php php php php php php php php returnphp php$thisphp-php>namephp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Getphp cookiephp value
php php php php php php*
php php php php php php*php php@returnphp string
php php php php php php*php/
php php php php publicphp functionphp getValuephp(php)
php php php php php{
php php php php php php php php returnphp php$thisphp-php>valuephp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Getphp cookiephp domain
php php php php php php*
php php php php php php*php php@returnphp string
php php php php php php*php/
php php php php publicphp functionphp getDomainphp(php)
php php php php php{
php php php php php php php php returnphp php$thisphp-php>domainphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Getphp thephp cookiephp path
php php php php php php*
php php php php php php*php php@returnphp string
php php php php php php*php/
php php php php publicphp functionphp getPathphp(php)
php php php php php{
php php php php php php php php returnphp php$thisphp-php>pathphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Getphp thephp expiryphp timephp ofphp thephp cookiephp,php orphp nullphp ifphp nophp expiryphp timephp isphp set
php php php php php php*
php php php php php php*php php@returnphp intphp|null
php php php php php php*php/
php php php php publicphp functionphp getExpiryTimephp(php)
php php php php php{
php php php php php php php php returnphp php$thisphp-php>expiresphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Checkphp whetherphp thephp cookiephp shouldphp onlyphp bephp sentphp overphp securephp connections
php php php php php php*
php php php php php php*php php@returnphp boolean
php php php php php php*php/
php php php php publicphp functionphp isSecurephp(php)
php php php php php{
php php php php php php php php returnphp php$thisphp-php>securephp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Checkphp whetherphp thephp cookiephp hasphp expired
php php php php php php*
php php php php php php*php Alwaysphp returnsphp falsephp ifphp thephp cookiephp isphp aphp sessionphp cookiephp php(hasphp nophp expiryphp timephp)
php php php php php php*
php php php php php php*php php@paramphp intphp php$nowphp Timestampphp tophp considerphp asphp php"nowphp"
php php php php php php*php php@returnphp boolean
php php php php php php*php/
php php php php publicphp functionphp isExpiredphp(php$nowphp php=php nullphp)
php php php php php{
php php php php php php php php ifphp php(php$nowphp php=php=php=php nullphp)php php$nowphp php=php timephp(php)php;
php php php php php php php php ifphp php(isphp_intphp(php$thisphp-php>expiresphp)php php&php&php php$thisphp-php>expiresphp <php php$nowphp)php php{
php php php php php php php php php php php php returnphp truephp;
php php php php php php php php php}php elsephp php{
php php php php php php php php php php php php returnphp falsephp;
php php php php php php php php php}
php php php php php}

php php php php php/php*php*
php php php php php php*php Checkphp whetherphp thephp cookiephp isphp aphp sessionphp cookiephp php(hasphp nophp expiryphp timephp setphp)
php php php php php php*
php php php php php php*php php@returnphp boolean
php php php php php php*php/
php php php php publicphp functionphp isSessionCookiephp(php)
php php php php php{
php php php php php php php php returnphp php(php$thisphp-php>expiresphp php=php=php=php nullphp)php;
php php php php php}

php php php php php/php*php*
php php php php php php*php Checksphp whetherphp thephp cookiephp shouldphp bephp sentphp orphp notphp inphp aphp specificphp scenario
php php php php php php*
php php php php php php*php php@paramphp stringphp|Zendphp_Uriphp_Httpphp php$uriphp URIphp tophp checkphp againstphp php(securephp,php domainphp,php pathphp)
php php php php php php*php php@paramphp booleanphp php$matchSessionCookiesphp Whetherphp tophp sendphp sessionphp cookies
php php php php php php*php php@paramphp intphp php$nowphp Overridephp thephp currentphp timephp whenphp checkingphp forphp expiryphp time
php php php php php php*php php@returnphp boolean
php php php php php php*php/
php php php php publicphp functionphp matchphp(php$uriphp,php php$matchSessionCookiesphp php=php truephp,php php$nowphp php=php nullphp)
php php php php php{
php php php php php php php php ifphp php(isphp_stringphp php(php$uriphp)php)php php{
php php php php php php php php php php php php php$uriphp php=php Zendphp_Uriphp_Httpphp:php:factoryphp(php$uriphp)php;
php php php php php php php php php}

php php php php php php php php php/php/php Makephp surephp wephp havephp aphp validphp Zendphp_Uriphp_Httpphp object
php php php php php php php php ifphp php(php!php php(php$uriphp-php>validphp(php)php php&php&php php(php$uriphp-php>getSchemephp(php)php php=php=php php'httpphp'php php|php|php php$uriphp-php>getSchemephp(php)php php=php=php'httpsphp'php)php)php)php php{
php php php php php php php php php php php php requirephp_oncephp php'Zendphp/Httpphp/Exceptionphp.phpphp'php;
php php php php php php php php php php php php throwphp newphp Zendphp_Httpphp_Exceptionphp(php'Passedphp URIphp isphp notphp aphp validphp HTTPphp orphp HTTPSphp URIphp'php)php;
php php php php php php php php php}

php php php php php php php php php/php/php Checkphp thatphp thephp cookiephp isphp securephp php(ifphp requiredphp)php andphp notphp expired
php php php php php php php php ifphp php(php$thisphp-php>securephp php&php&php php$uriphp-php>getSchemephp(php)php php!php=php php'httpsphp'php)php returnphp falsephp;
php php php php php php php php ifphp php(php$thisphp-php>isExpiredphp(php$nowphp)php)php returnphp falsephp;
php php php php php php php php ifphp php(php$thisphp-php>isSessionCookiephp(php)php php&php&php php!php php$matchSessionCookiesphp)php returnphp falsephp;

php php php php php php php php php/php/php Checkphp ifphp thephp domainphp matches
php php php php php php php php ifphp php(php!php selfphp:php:matchCookieDomainphp(php$thisphp-php>getDomainphp(php)php,php php$uriphp-php>getHostphp(php)php)php)php php{
php php php php php php php php php php php php returnphp falsephp;
php php php php php php php php php}

php php php php php php php php php/php/php Checkphp thatphp pathphp matchesphp usingphp prefixphp match
php php php php php php php php ifphp php(php!php selfphp:php:matchCookiePathphp(php$thisphp-php>getPathphp(php)php,php php$uriphp-php>getPathphp(php)php)php)php php{
php php php php php php php php php php php php returnphp falsephp;
php php php php php php php php php}

php php php php php php php php php/php/php Ifphp wephp didnphp'tphp diephp untilphp nowphp,php returnphp truephp.
php php php php php php php php returnphp truephp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Getphp thephp cookiephp asphp aphp stringphp,php suitablephp forphp sendingphp asphp aphp php"Cookiephp"php headerphp inphp an
php php php php php php*php HTTPphp request
php php php php php php*
php php php php php php*php php@returnphp string
php php php php php php*php/
php php php php publicphp functionphp php_php_toStringphp(php)
php php php php php{
php php php php php php php php ifphp php(php$thisphp-php>encodeValuephp)php php{
php php php php php php php php php php php php returnphp php$thisphp-php>namephp php.php php'php=php'php php.php urlencodephp(php$thisphp-php>valuephp)php php.php php'php;php'php;
php php php php php php php php php}
php php php php php php php php returnphp php$thisphp-php>namephp php.php php'php=php'php php.php php$thisphp-php>valuephp php.php php'php;php'php;
php php php php php}

php php php php php/php*php*
php php php php php php*php Generatephp aphp newphp Cookiephp objectphp fromphp aphp cookiephp string
php php php php php php*php php(forphp examplephp thephp valuephp ofphp thephp Setphp-Cookiephp HTTPphp headerphp)
php php php php php php*
php php php php php php*php php@paramphp stringphp php$cookieStr
php php php php php php*php php@paramphp Zendphp_Uriphp_Httpphp|stringphp php$refUriphp Referencephp URIphp forphp defaultphp valuesphp php(domainphp,php pathphp)
php php php php php php*php php@paramphp booleanphp php$encodeValuephp Whetherphp orphp notphp thephp cookiephp'sphp valuephp shouldphp be
php php php php php php*php php php php php php php php php php php php php php php php php php php php php php php php php php php php php passedphp throughphp urlencodephp/urldecode
php php php php php php*php php@returnphp Zendphp_Httpphp_Cookiephp Aphp newphp Zendphp_Httpphp_Cookiephp objectphp orphp falsephp onphp failurephp.
php php php php php php*php/
php php php php publicphp staticphp functionphp fromStringphp(php$cookieStrphp,php php$refUriphp php=php nullphp,php php$encodeValuephp php=php truephp)
php php php php php{
php php php php php php php php php/php/php Setphp defaultphp values
php php php php php php php php ifphp php(isphp_stringphp(php$refUriphp)php)php php{
php php php php php php php php php php php php php$refUriphp php=php Zendphp_Uriphp_Httpphp:php:factoryphp(php$refUriphp)php;
php php php php php php php php php}

php php php php php php php php php$namephp php php php php=php php'php'php;
php php php php php php php php php$valuephp php php php=php php'php'php;
php php php php php php php php php$domainphp php php=php php'php'php;
php php php php php php php php php$pathphp php php php php=php php'php'php;
php php php php php php php php php$expiresphp php=php nullphp;
php php php php php php php php php$securephp php php=php falsephp;
php php php php php php php php php$partsphp php php php=php explodephp(php'php;php'php,php php$cookieStrphp)php;

php php php php php php php php php/php/php Ifphp firstphp partphp doesphp notphp includephp php'php=php'php,php fail
php php php php php php php php ifphp php(strposphp(php$partsphp[php0php]php,php php'php=php'php)php php=php=php=php falsephp)php returnphp falsephp;

php php php php php php php php php/php/php Getphp thephp namephp andphp valuephp ofphp thephp cookie
php php php php php php php php listphp(php$namephp,php php$valuephp)php php=php explodephp(php'php=php'php,php trimphp(arrayphp_shiftphp(php$partsphp)php)php,php php2php)php;
php php php php php php php php php$namephp php php=php trimphp(php$namephp)php;
php php php php php php php php ifphp php(php$encodeValuephp)php php{
php php php php php php php php php php php php php$valuephp php=php urldecodephp(trimphp(php$valuephp)php)php;
php php php php php php php php php}

php php php php php php php php php/php/php Setphp defaultphp domainphp andphp path
php php php php php php php php ifphp php(php$refUriphp instanceofphp Zendphp_Uriphp_Httpphp)php php{
php php php php php php php php php php php php php$domainphp php=php php$refUriphp-php>getHostphp(php)php;
php php php php php php php php php php php php php$pathphp php=php php$refUriphp-php>getPathphp(php)php;
php php php php php php php php php php php php php$pathphp php=php substrphp(php$pathphp,php php0php,php strrposphp(php$pathphp,php php'php/php'php)php)php;
php php php php php php php php php}

php php php php php php php php php/php/php Setphp otherphp cookiephp parameters
php php php php php php php php foreachphp php(php$partsphp asphp php$partphp)php php{
php php php php php php php php php php php php php$partphp php=php trimphp(php$partphp)php;
php php php php php php php php php php php php ifphp php(strtolowerphp(php$partphp)php php=php=php php'securephp'php)php php{
php php php php php php php php php php php php php php php php php$securephp php=php truephp;
php php php php php php php php php php php php php php php php continuephp;
php php php php php php php php php php php php php}

php php php php php php php php php php php php php$keyValuephp php=php explodephp(php'php=php'php,php php$partphp,php php2php)php;
php php php php php php php php php php php php ifphp php(countphp(php$keyValuephp)php php=php=php php2php)php php{
php php php php php php php php php php php php php php php php listphp(php$kphp,php php$vphp)php php=php php$keyValuephp;
php php php php php php php php php php php php php php php php switchphp php(strtolowerphp(php$kphp)php)php php php php php{
php php php php php php php php php php php php php php php php php php php php casephp php'expiresphp'php:
php php php php php php php php php php php php php php php php php php php php php php php php ifphp(php(php$expiresphp php=php strtotimephp(php$vphp)php)php php=php=php=php falsephp)php php{
php php php php php php php php php php php php php php php php php php php php php php php php php php php php php/php*php*
php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php*php Thephp expirationphp isphp pastphp Tuephp,php php1php9php Janphp php2php0php3php8php php0php3php:php1php4php:php0php7php UTC
php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php*php thephp maximumphp forphp php3php2php-bitphp signedphp integerphp.php Zendphp_Date
php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php*php canphp getphp aroundphp thatphp limitphp.
php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php*
php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php*php php@seephp Zendphp_Date
php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php*php/
php php php php php php php php php php php php php php php php php php php php php php php php php php php php requirephp_oncephp php'Zendphp/Datephp.phpphp'php;

php php php php php php php php php php php php php php php php php php php php php php php php php php php php php$expireDatephp php=php newphp Zendphp_Datephp(php$vphp)php;
php php php php php php php php php php php php php php php php php php php php php php php php php php php php php$expiresphp php=php php$expireDatephp-php>getTimestampphp(php)php;
php php php php php php php php php php php php php php php php php php php php php php php php php}
php php php php php php php php php php php php php php php php php php php php php php php php breakphp;

php php php php php php php php php php php php php php php php php php php php casephp php'pathphp'php:
php php php php php php php php php php php php php php php php php php php php php php php php php$pathphp php=php php$vphp;
php php php php php php php php php php php php php php php php php php php php php php php php breakphp;

php php php php php php php php php php php php php php php php php php php php casephp php'domainphp'php:
php php php php php php php php php php php php php php php php php php php php php php php php php$domainphp php=php php$vphp;
php php php php php php php php php php php php php php php php php php php php php php php php breakphp;

php php php php php php php php php php php php php php php php php php php php defaultphp:
php php php php php php php php php php php php php php php php php php php php php php php php breakphp;
php php php php php php php php php php php php php php php php php}
php php php php php php php php php php php php php}
php php php php php php php php php}

php php php php php php php php ifphp php(php$namephp php!php=php=php php'php'php)php php{
php php php php php php php php php php php php php$retphp php=php newphp selfphp(php$namephp,php php$valuephp,php php$domainphp,php php$expiresphp,php php$pathphp,php php$securephp)php;
php php php php php php php php php php php php php$retphp-php>encodeValuephp php=php php(php$encodeValuephp)php php?php truephp php:php falsephp;
php php php php php php php php php php php php returnphp php$retphp;
php php php php php php php php php}php elsephp php{
php php php php php php php php php php php php returnphp falsephp;
php php php php php php php php php}
php php php php php}

php php php php php/php*php*
php php php php php php*php Checkphp ifphp aphp cookiephp'sphp domainphp matchesphp aphp hostphp namephp.
php php php php php php*
php php php php php php*php Usedphp byphp Zendphp_Httpphp_Cookiephp andphp Zendphp_Httpphp_CookieJarphp forphp cookiephp matching
php php php php php php*
php php php php php php*php php@paramphp php stringphp php$cookieDomain
php php php php php php*php php@paramphp php stringphp php$host
php php php php php php*
php php php php php php*php php@returnphp boolean
php php php php php php*php/
php php php php publicphp staticphp functionphp matchCookieDomainphp(php$cookieDomainphp,php php$hostphp)
php php php php php{
php php php php php php php php ifphp php(php!php php$cookieDomainphp)php php{
php php php php php php php php php php php php requirephp_oncephp php'Zendphp/Httpphp/Exceptionphp.phpphp'php;
php php php php php php php php php php php php throwphp newphp Zendphp_Httpphp_Exceptionphp(php"php\php$cookieDomainphp isphp expectedphp tophp bephp aphp cookiephp domainphp"php)php;
php php php php php php php php php}

php php php php php php php php ifphp php(php!php php$hostphp)php php{
php php php php php php php php php php php php requirephp_oncephp php'Zendphp/Httpphp/Exceptionphp.phpphp'php;
php php php php php php php php php php php php throwphp newphp Zendphp_Httpphp_Exceptionphp(php"php\php$hostphp isphp expectedphp tophp bephp aphp hostphp namephp"php)php;
php php php php php php php php php}

php php php php php php php php php$cookieDomainphp php=php strtolowerphp(php$cookieDomainphp)php;
php php php php php php php php php$hostphp php=php strtolowerphp(php$hostphp)php;

php php php php php php php php ifphp php(php$cookieDomainphp[php0php]php php=php=php php'php.php'php)php php{
php php php php php php php php php php php php php$cookieDomainphp php=php substrphp(php$cookieDomainphp,php php1php)php;
php php php php php php php php php}

php php php php php php php php php/php/php Checkphp forphp eitherphp exactphp matchphp orphp suffixphp match
php php php php php php php php returnphp php(php$cookieDomainphp php=php=php php$hostphp php|php|
php php php php php php php php php php php php php php php php pregphp_matchphp(php'php/php\php.php'php php.php pregphp_quotephp(php$cookieDomainphp)php php.php php'php$php/php'php,php php$hostphp)php)php;
php php php php php}

php php php php php/php*php*
php php php php php php*php Checkphp ifphp aphp cookiephp'sphp pathphp matchesphp aphp URLphp path
php php php php php php*
php php php php php php*php Usedphp byphp Zendphp_Httpphp_Cookiephp andphp Zendphp_Httpphp_CookieJarphp forphp cookiephp matching
php php php php php php*
php php php php php php*php php@paramphp php stringphp php$cookiePath
php php php php php php*php php@paramphp php stringphp php$path
php php php php php php*php php@returnphp boolean
php php php php php php*php/
php php php php publicphp staticphp functionphp matchCookiePathphp(php$cookiePathphp,php php$pathphp)
php php php php php{
php php php php php php php php ifphp php(php!php php$cookiePathphp)php php{
php php php php php php php php php php php php requirephp_oncephp php'Zendphp/Httpphp/Exceptionphp.phpphp'php;
php php php php php php php php php php php php throwphp newphp Zendphp_Httpphp_Exceptionphp(php"php\php$cookiePathphp isphp expectedphp tophp bephp aphp cookiephp pathphp"php)php;
php php php php php php php php php}

php php php php php php php php ifphp php(php!php php$pathphp)php php{
php php php php php php php php php php php php requirephp_oncephp php'Zendphp/Httpphp/Exceptionphp.phpphp'php;
php php php php php php php php php php php php throwphp newphp Zendphp_Httpphp_Exceptionphp(php"php\php$pathphp isphp expectedphp tophp bephp aphp hostphp namephp"php)php;
php php php php php php php php php}

php php php php php php php php returnphp php(strposphp(php$pathphp,php php$cookiePathphp)php php=php=php=php php0php)php;
php php php php php}
php}
