<php?php
php/php*php*
php php*php Zendphp Framework
php php*
php php*php LICENSE
php php*
php php*php Thisphp sourcephp filephp isphp subjectphp tophp thephp newphp BSDphp licensephp thatphp isphp bundled
php php*php withphp thisphp packagephp inphp thephp filephp LICENSEphp.txtphp.
php php*php Itphp isphp alsophp availablephp throughphp thephp worldphp-widephp-webphp atphp thisphp URLphp:
php php*php httpphp:php/php/frameworkphp.zendphp.comphp/licensephp/newphp-bsd
php php*php Ifphp youphp didphp notphp receivephp aphp copyphp ofphp thephp licensephp andphp arephp unablephp to
php php*php obtainphp itphp throughphp thephp worldphp-widephp-webphp,php pleasephp sendphp anphp email
php php*php tophp licensephp@zendphp.comphp sophp wephp canphp sendphp youphp aphp copyphp immediatelyphp.
php php*
php php*php php@categoryphp php php Zend
php php*php php@packagephp php php php Zendphp_Serializer
php php*php php@subpackagephp Adapter
php php*php php@copyrightphp php Copyrightphp php(cphp)php php2php0php0php5php-php2php0php1php0php Zendphp Technologiesphp USAphp Incphp.php php(httpphp:php/php/wwwphp.zendphp.comphp)
php php*php php@licensephp php php php httpphp:php/php/frameworkphp.zendphp.comphp/licensephp/newphp-bsdphp php php php php Newphp BSDphp License
php php*php php@versionphp php php php php$Idphp:php PythonPicklephp.phpphp php2php1php1php8php7php php2php0php1php0php-php0php2php-php2php4php php0php1php:php2php2php:php0php1Zphp stasphp php$
php php*php/

php/php*php*php php@seephp Zendphp_Serializerphp_Adapterphp_AdapterAbstractphp php*php/
requirephp_oncephp php'Zendphp/Serializerphp/Adapterphp/AdapterAbstractphp.phpphp'php;

php/php*php*
php php*php php@linkphp php php php php php php httpphp:php/php/wwwphp.pythonphp.org
php php*php php@seephp php php php php php php php Phythonphp3php.php1php/Libphp/picklephp.py
php php*php php@seephp php php php php php php php Phythonphp3php.php1php/Modulesphp/php_picklephp.c
php php*php php@linkphp php php php php php php httpphp:php/php/picklephp-jsphp.googlecodephp.com
php php*php php@categoryphp php php Zend
php php*php php@packagephp php php php Zendphp_Serializer
php php*php php@subpackagephp Adapter
php php*php php@copyrightphp php Copyrightphp php(cphp)php php2php0php0php5php-php2php0php1php0php Zendphp Technologiesphp USAphp Incphp.php php(httpphp:php/php/wwwphp.zendphp.comphp)
php php*php php@licensephp php php php httpphp:php/php/frameworkphp.zendphp.comphp/licensephp/newphp-bsdphp php php php php Newphp BSDphp License
php php*php/
classphp Zendphp_Serializerphp_Adapterphp_PythonPicklephp extendsphp Zendphp_Serializerphp_Adapterphp_AdapterAbstract
php{
php php php php php/php*php Picklephp opcodesphp.php Seephp pickletoolsphp.pyphp forphp extensivephp docsphp.php php Thephp listing
php php php php php php php herephp isphp inphp kindphp-ofphp alphabeticalphp orderphp ofphp php1php-characterphp picklephp codephp.
php php php php php php php pickletoolsphp groupsphp themphp byphp purposephp.php php*php/
php php php php constphp OPphp_MARKphp php php php php php php php php php php php php=php php'php(php'php;php php php php php php/php/php pushphp specialphp markobjectphp onphp stack
php php php php constphp OPphp_STOPphp php php php php php php php php php php php php=php php'php.php'php;php php php php php php/php/php everyphp picklephp endsphp withphp STOP
php php php php constphp OPphp_POPphp php php php php php php php php php php php php php=php php'php0php'php;php php php php php php/php/php discardphp topmostphp stackphp item
php php php php constphp OPphp_POPphp_MARKphp php php php php php php php php=php php'php1php'php;php php php php php php/php/php discardphp stackphp topphp throughphp topmostphp markobject
php php php php constphp OPphp_DUPphp php php php php php php php php php php php php php=php php'php2php'php;php php php php php php/php/php duplicatephp topphp stackphp item
php php php php constphp OPphp_FLOATphp php php php php php php php php php php php=php php'Fphp'php;php php php php php php/php/php pushphp floatphp objectphp;php decimalphp stringphp argument
php php php php constphp OPphp_INTphp php php php php php php php php php php php php php=php php'Iphp'php;php php php php php php/php/php pushphp integerphp orphp boolphp;php decimalphp stringphp argument
php php php php constphp OPphp_BININTphp php php php php php php php php php php=php php'Jphp'php;php php php php php php/php/php pushphp fourphp-bytephp signedphp int
php php php php constphp OPphp_BININTphp1php php php php php php php php php php=php php'Kphp'php;php php php php php php/php/php pushphp php1php-bytephp unsignedphp int
php php php php constphp OPphp_LONGphp php php php php php php php php php php php php=php php'Lphp'php;php php php php php php/php/php pushphp longphp;php decimalphp stringphp argument
php php php php constphp OPphp_BININTphp2php php php php php php php php php php=php php'Mphp'php;php php php php php php/php/php pushphp php2php-bytephp unsignedphp int
php php php php constphp OPphp_NONEphp php php php php php php php php php php php php=php php'Nphp'php;php php php php php php/php/php pushphp None
php php php php constphp OPphp_PERSIDphp php php php php php php php php php php=php php'Pphp'php;php php php php php php/php/php pushphp persistentphp objectphp;php idphp isphp takenphp fromphp stringphp arg
php php php php constphp OPphp_BINPERSIDphp php php php php php php php=php php'Qphp'php;php php php php php php/php/php php php"php php php php php php php php"php php php php php php php php php php"php php php;php php php"php php php"php php php php"php php php php php php"php php stack
php php php php constphp OPphp_REDUCEphp php php php php php php php php php php=php php'Rphp'php;php php php php php php/php/php applyphp callablephp tophp argtuplephp,php bothphp onphp stack
php php php php constphp OPphp_STRINGphp php php php php php php php php php php=php php'Sphp'php;php php php php php php/php/php pushphp stringphp;php NLphp-terminatedphp stringphp argument
php php php php constphp OPphp_BINSTRINGphp php php php php php php php=php php'Tphp'php;php php php php php php/php/php pushphp stringphp;php countedphp binaryphp stringphp argument
php php php php constphp OPphp_SHORTphp_BINSTRINGphp php=php php'Uphp'php;php php php php php php/php/php php php"php php php php php php"php php php php;php php php php php"php php php php php php php"php php php php php php php php"php php php php php php php"php <php php2php5php6php bytes
php php php php constphp OPphp_UNICODEphp php php php php php php php php php=php php'Vphp'php;php php php php php php/php/php pushphp Unicodephp stringphp;php rawphp-unicodephp-escapedphp'dphp argument
php php php php constphp OPphp_BINUNICODEphp php php php php php php=php php'Xphp'php;php php php php php php/php/php php php php"php php php php php php"php php php php php php php php"php php php;php countedphp UTFphp-php8php stringphp argument
php php php php constphp OPphp_APPENDphp php php php php php php php php php php=php php'aphp'php;php php php php php php/php/php appendphp stackphp topphp tophp listphp belowphp it
php php php php constphp OPphp_BUILDphp php php php php php php php php php php php=php php'bphp'php;php php php php php php/php/php callphp php_php_setstatephp_php_php orphp php_php_dictphp_php_php.updatephp(php)
php php php php constphp OPphp_GLOBALphp php php php php php php php php php php=php php'cphp'php;php php php php php php/php/php pushphp selfphp.findphp_classphp(modnamephp,php namephp)php;php php2php stringphp args
php php php php constphp OPphp_DICTphp php php php php php php php php php php php php=php php'dphp'php;php php php php php php/php/php buildphp aphp dictphp fromphp stackphp items
php php php php constphp OPphp_EMPTYphp_DICTphp php php php php php php=php php'php}php'php;php php php php php php/php/php pushphp emptyphp dict
php php php php constphp OPphp_APPENDSphp php php php php php php php php php=php php'ephp'php;php php php php php php/php/php extendphp listphp onphp stackphp byphp topmostphp stackphp slice
php php php php constphp OPphp_GETphp php php php php php php php php php php php php php=php php'gphp'php;php php php php php php/php/php pushphp itemphp fromphp memophp onphp stackphp;php indexphp isphp stringphp arg
php php php php constphp OPphp_BINGETphp php php php php php php php php php php=php php'hphp'php;php php php php php php/php/php php php php"php php php php php"php php php php php"php php php php php"php php php php"php php php php"php php php;php php php php"php php php php php"php php1php-bytephp arg
php php php php constphp OPphp_INSTphp php php php php php php php php php php php php=php php'iphp'php;php php php php php php/php/php buildphp php&php pushphp classphp instance
php php php php constphp OPphp_LONGphp_BINGETphp php php php php php=php php'jphp'php;php php php php php php/php/php pushphp itemphp fromphp memophp onphp stackphp;php indexphp isphp php4php-bytephp arg
php php php php constphp OPphp_LISTphp php php php php php php php php php php php php=php php'lphp'php;php php php php php php/php/php buildphp listphp fromphp topmostphp stackphp items
php php php php constphp OPphp_EMPTYphp_LISTphp php php php php php php=php php'php]php'php;php php php php php php/php/php pushphp emptyphp list
php php php php constphp OPphp_OBJphp php php php php php php php php php php php php php=php php'ophp'php;php php php php php php/php/php buildphp php&php pushphp classphp instance
php php php php constphp OPphp_PUTphp php php php php php php php php php php php php php=php php'pphp'php;php php php php php php/php/php storephp stackphp topphp inphp memophp;php indexphp isphp stringphp arg
php php php php constphp OPphp_BINPUTphp php php php php php php php php php php=php php'qphp'php;php php php php php php/php/php php php php"php php php php php php"php php php php php"php php php php"php php php php"php php;php php php php"php php php php php"php php1php-bytephp arg
php php php php constphp OPphp_LONGphp_BINPUTphp php php php php php=php php'rphp'php;php php php php php php/php/php php php php"php php php php php php"php php php php php"php php php php"php php php php"php php;php php php php"php php php php php"php php4php-bytephp arg
php php php php constphp OPphp_SETITEMphp php php php php php php php php php=php php'sphp'php;php php php php php php/php/php addphp keyphp+valuephp pairphp tophp dict
php php php php constphp OPphp_TUPLEphp php php php php php php php php php php php=php php'tphp'php;php php php php php php/php/php buildphp tuplephp fromphp topmostphp stackphp items
php php php php constphp OPphp_EMPTYphp_TUPLEphp php php php php php=php php'php)php'php;php php php php php php/php/php pushphp emptyphp tuple
php php php php constphp OPphp_SETITEMSphp php php php php php php php php=php php'uphp'php;php php php php php php/php/php modifyphp dictphp byphp addingphp topmostphp keyphp+valuephp pairs
php php php php constphp OPphp_BINFLOATphp php php php php php php php php=php php'Gphp'php;php php php php php php/php/php pushphp floatphp;php argphp isphp php8php-bytephp floatphp encoding

php php php php php/php*php Protocolphp php2php php*php/
php php php php constphp OPphp_PROTOphp php php php php php php php php php php php=php php"php\xphp8php0php"php;php php php/php/php identifyphp picklephp protocol
php php php php constphp OPphp_NEWOBJphp php php php php php php php php php php=php php"php\xphp8php1php"php;php php php/php/php buildphp objectphp byphp applyingphp clsphp.php_php_newphp_php_php tophp argtuple
php php php php constphp OPphp_EXTphp1php php php php php php php php php php php php php=php php"php\xphp8php2php"php;php php php/php/php pushphp objectphp fromphp extensionphp registryphp;php php1php-bytephp index
php php php php constphp OPphp_EXTphp2php php php php php php php php php php php php php=php php"php\xphp8php3php"php;php php php/php/php dittophp,php butphp php2php-bytephp index
php php php php constphp OPphp_EXTphp4php php php php php php php php php php php php php=php php"php\xphp8php4php"php;php php php/php/php dittophp,php butphp php4php-bytephp index
php php php php constphp OPphp_TUPLEphp1php php php php php php php php php php php=php php"php\xphp8php5php"php;php php php/php/php buildphp php1php-tuplephp fromphp stackphp top
php php php php constphp OPphp_TUPLEphp2php php php php php php php php php php php=php php"php\xphp8php6php"php;php php php/php/php buildphp php2php-tuplephp fromphp twophp topmostphp stackphp items
php php php php constphp OPphp_TUPLEphp3php php php php php php php php php php php=php php"php\xphp8php7php"php;php php php/php/php buildphp php3php-tuplephp fromphp threephp topmostphp stackphp items
php php php php constphp OPphp_NEWTRUEphp php php php php php php php php php=php php"php\xphp8php8php"php;php php php/php/php pushphp True
php php php php constphp OPphp_NEWFALSEphp php php php php php php php php=php php"php\xphp8php9php"php;php php php/php/php pushphp False
php php php php constphp OPphp_LONGphp1php php php php php php php php php php php php=php php"php\xphp8aphp"php;php php php/php/php pushphp longphp fromphp <php php2php5php6php bytes
php php php php constphp OPphp_LONGphp4php php php php php php php php php php php php=php php"php\xphp8bphp"php;php php php/php/php pushphp reallyphp bigphp long

php php php php php/php*php Protocolphp php3php php(Pythonphp php3php.xphp)php php*php/
php php php php constphp OPphp_BINBYTESphp php php php php php php php php=php php'Bphp'php;php php php php php php/php/php pushphp bytesphp;php countedphp binaryphp stringphp argument
php php php php constphp OPphp_SHORTphp_BINBYTESphp php php=php php'Cphp'php;php php php php php php/php/php php php"php php php php php php"php php php php;php php php php php"php php php php php php php"php php php php php php php php"php php php php php php php"php <php php2php5php6php bytes

php php php php php/php*php*
php php php php php php*php php@varphp boolphp Whetherphp orphp notphp thisphp isphp aphp PHPphp php6php binary
php php php php php php*php/
php php php php protectedphp staticphp php$php_isPhpphp6php php=php nullphp;

php php php php php/php*php*
php php php php php php*php php@varphp boolphp Whetherphp orphp notphp thephp systemphp isphp littlephp-endian
php php php php php php*php/
php php php php protectedphp staticphp php$php_isLittleEndianphp php=php nullphp;

php php php php php/php*php*
php php php php php php*php php@varphp arrayphp Stringsphp representingphp quotes
php php php php php php*php/
php php php php protectedphp staticphp php$php_quoteStringphp php=php arrayphp(
php php php php php php php php php'php\php\php'php php=php>php php'php\php\php\php\php'php,
php php php php php php php php php"php\xphp0php0php"php php=php>php php'php\php\xphp0php0php'php,php php"php\xphp0php1php"php php=php>php php'php\php\xphp0php1php'php,php php"php\xphp0php2php"php php=php>php php'php\php\xphp0php2php'php,php php"php\xphp0php3php"php php=php>php php'php\php\xphp0php3php'php,
php php php php php php php php php"php\xphp0php4php"php php=php>php php'php\php\xphp0php4php'php,php php"php\xphp0php5php"php php=php>php php'php\php\xphp0php5php'php,php php"php\xphp0php6php"php php=php>php php'php\php\xphp0php6php'php,php php"php\xphp0php7php"php php=php>php php'php\php\xphp0php7php'php,
php php php php php php php php php"php\xphp0php8php"php php=php>php php'php\php\xphp0php8php'php,php php"php\xphp0php9php"php php=php>php php'php\php\tphp'php,php php php php"php\xphp0aphp"php php=php>php php'php\php\nphp'php,php php php php"php\xphp0bphp"php php=php>php php'php\php\xphp0bphp'php,
php php php php php php php php php"php\xphp0cphp"php php=php>php php'php\php\xphp0cphp'php,php php"php\xphp0dphp"php php=php>php php'php\php\rphp'php,php php php php"php\xphp0ephp"php php=php>php php'php\php\xphp0ephp'php,php php"php\xphp0fphp"php php=php>php php'php\php\xphp0fphp'php,
php php php php php php php php php"php\xphp1php0php"php php=php>php php'php\php\xphp1php0php'php,php php"php\xphp1php1php"php php=php>php php'php\php\xphp1php1php'php,php php"php\xphp1php2php"php php=php>php php'php\php\xphp1php2php'php,php php"php\xphp1php3php"php php=php>php php'php\php\xphp1php3php'php,
php php php php php php php php php"php\xphp1php4php"php php=php>php php'php\php\xphp1php4php'php,php php"php\xphp1php5php"php php=php>php php'php\php\xphp1php5php'php,php php"php\xphp1php6php"php php=php>php php'php\php\xphp1php6php'php,php php"php\xphp1php7php"php php=php>php php'php\php\xphp1php7php'php,
php php php php php php php php php"php\xphp1php8php"php php=php>php php'php\php\xphp1php8php'php,php php"php\xphp1php9php"php php=php>php php'php\php\xphp1php9php'php,php php"php\xphp1aphp"php php=php>php php'php\php\xphp1aphp'php,php php"php\xphp1bphp"php php=php>php php'php\php\xphp1bphp'php,
php php php php php php php php php"php\xphp1cphp"php php=php>php php'php\php\xphp1cphp'php,php php"php\xphp1dphp"php php=php>php php'php\php\xphp1dphp'php,php php"php\xphp1ephp"php php=php>php php'php\php\xphp1ephp'php,php php"php\xphp1fphp"php php=php>php php'php\php\xphp1fphp'php,
php php php php php php php php php"php\xffphp"php php=php>php php'php\php\xffphp'
php php php php php)php;

php php php php php/php*php*
php php php php php php*php php@varphp arrayphp Defaultphp options
php php php php php php*php/
php php php php protectedphp php$php_optionsphp php=php arrayphp(
php php php php php php php php php'protocolphp'php php php php php php php php php php php php=php>php php0php,
php php php php php)php;

php php php php php/php/php processphp vars
php php php php protectedphp php$php_protocolphp php php php php php php php php php php php=php php0php;
php php php php protectedphp php$php_binaryphp php php php php php php php php php php php php php=php falsephp;
php php php php protectedphp php$php_memophp php php php php php php php php php php php php php php php=php arrayphp(php)php;
php php php php protectedphp php$php_picklephp php php php php php php php php php php php php php=php php'php'php;
php php php php protectedphp php$php_pickleLenphp php php php php php php php php php php=php php0php;
php php php php protectedphp php$php_posphp php php php php php php php php php php php php php php php php=php php0php;
php php php php protectedphp php$php_stackphp php php php php php php php php php php php php php php=php arrayphp(php)php;
php php php php protectedphp php$php_markerphp php php php php php php php php php php php php php=php nullphp;

php php php php php/php*php*
php php php php php php*php Constructor
php php php php php php*
php php php php php php*php php@linkphp Zendphp_Serializerphp_Adapterphp_AdapterAbstractphp:php:php_php_constructphp(php)
php php php php php php*php/
php php php php publicphp functionphp php_php_constructphp(php$optsphp=arrayphp(php)php)
php php php php php{
php php php php php php php php parentphp:php:php_php_constructphp(php$optsphp)php;

php php php php php php php php php/php/php init
php php php php php php php php ifphp php(selfphp:php:php$php_isLittleEndianphp php=php=php=php nullphp)php php{
php php php php php php php php php php php php selfphp:php:php$php_isLittleEndianphp php=php php(packphp(php'lphp'php,php php1php)php php=php=php=php php"php\xphp0php1php\xphp0php0php\xphp0php0php\xphp0php0php"php)php;
php php php php php php php php php}
php php php php php php php php ifphp php(selfphp:php:php$php_isPhpphp6php php=php=php=php nullphp)php php{
php php php php php php php php php php php php selfphp:php:php$php_isPhpphp6php php=php php!versionphp_comparephp(PHPphp_VERSIONphp,php php'php6php.php0php.php0php'php,php php'<php'php)php;
php php php php php php php php php}

php php php php php php php php php$thisphp-php>php_markerphp php=php newphp stdClassphp(php)php;
php php php php php}

php php php php php/php*php*
php php php php php php*php Setphp anphp option
php php php php php php*
php php php php php php*php php@linkphp php php Zendphp_Serializerphp_Adapterphp_AdapterAbstractphp:php:setOptionphp(php)
php php php php php php*php php@paramphp php stringphp php$name
php php php php php php*php php@paramphp php mixedphp php$value
php php php php php php*php php@returnphp Zendphp_Serializerphp_Adapterphp_PythonPickle
php php php php php php*php/
php php php php publicphp functionphp setOptionphp(php$namephp,php php$valuephp)
php php php php php{
php php php php php php php php switchphp php(php$namephp)php php{
php php php php php php php php php php php php casephp php'protocolphp'php:
php php php php php php php php php php php php php php php php php$valuephp php=php php$thisphp-php>php_checkProtocolNumberphp(php$valuephp)php;
php php php php php php php php php php php php php php php php breakphp;
php php php php php php php php php}

php php php php php php php php returnphp parentphp:php:setOptionphp(php$namephp,php php$valuephp)php;
php php php php php}

php php php php php/php*php*
php php php php php php*php Checkphp andphp normalizephp picklephp protocolphp number
php php php php php php*
php php php php php php*php php@paramphp php intphp php$number
php php php php php php*php php@returnphp int
php php php php php php*php php@throwsphp Zendphp_Serializerphp_Exception
php php php php php php*php/
php php php php protectedphp functionphp php_checkProtocolNumberphp(php$numberphp)
php php php php php{
php php php php php php php php php$intphp php=php php(intphp)php php$numberphp;
php php php php php php php php ifphp php(php$intphp <php php0php php|php|php php$intphp php>php php3php)php php{
php php php php php php php php php php php php requirephp_oncephp php'Zendphp/Serializerphp/Exceptionphp.phpphp'php;
php php php php php php php php php php php php throwphp newphp Zendphp_Serializerphp_Exceptionphp(php'Invalidphp orphp unknownphp protocolphp versionphp php"php'php.php$numberphp.php'php"php'php)php;
php php php php php php php php php}
php php php php php php php php returnphp php$intphp;
php php php php php}

php php php php php/php*php serializephp php*php/

php php php php php/php*php*
php php php php php php*php Serializephp PHPphp tophp PythonPicklephp format
php php php php php php*
php php php php php php*php php@paramphp php mixedphp php$value
php php php php php php*php php@paramphp php arrayphp php$opts
php php php php php php*php php@returnphp string
php php php php php php*php/
php php php php publicphp functionphp serializephp(php$valuephp,php arrayphp php$optsphp php=php arrayphp(php)php)
php php php php php{
php php php php php php php php php$optsphp php=php php$optsphp php+php php$thisphp-php>php_optionsphp;

php php php php php php php php php$thisphp-php>php_protocolphp php=php php$thisphp-php>php_checkProtocolNumberphp(php$optsphp[php'protocolphp'php]php)php;
php php php php php php php php php$thisphp-php>php_binaryphp php php php=php php$thisphp-php>php_protocolphp php!php=php php0php;

php php php php php php php php php/php/php clearphp processphp varsphp beforephp serializing
php php php php php php php php php$thisphp-php>php_memophp php php php=php arrayphp(php)php;
php php php php php php php php php$thisphp-php>php_picklephp php=php php'php'php;

php php php php php php php php php/php/php write
php php php php php php php php ifphp php(php$thisphp-php>php_protocolphp php>php=php php2php)php php{
php php php php php php php php php php php php php$thisphp-php>php_writeProtophp(php$thisphp-php>php_protocolphp)php;
php php php php php php php php php}
php php php php php php php php php$thisphp-php>php_writephp(php$valuephp)php;
php php php php php php php php php$thisphp-php>php_writeStopphp(php)php;

php php php php php php php php php/php/php clearphp processphp varsphp afterphp serializing
php php php php php php php php php$thisphp-php>php_memophp php=php arrayphp(php)php;
php php php php php php php php php$picklephp php=php php$thisphp-php>php_picklephp;
php php php php php php php php php$thisphp-php>php_picklephp php=php php'php'php;

php php php php php php php php returnphp php$picklephp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Writephp aphp value
php php php php php php*
php php php php php php*php php@paramphp php mixedphp php$value
php php php php php php*php php@returnphp void
php php php php php php*php php@throwsphp Zendphp_Serializerphp_Exceptionphp onphp invalidphp orphp unrecognizedphp valuephp type
php php php php php php*php/
php php php php protectedphp functionphp php_writephp(php$valuephp)
php php php php php{
php php php php php php php php ifphp php(php$valuephp php=php=php=php nullphp)php php{
php php php php php php php php php php php php php$thisphp-php>php_writeNullphp(php)php;
php php php php php php php php php}php elseifphp php(php$valuephp php=php=php=php truephp)php php{
php php php php php php php php php php php php php$thisphp-php>php_writeTruephp(php)php;
php php php php php php php php php}php elseifphp php(php$valuephp php=php=php=php falsephp)php php{
php php php php php php php php php php php php php$thisphp-php>php_writeFalsephp(php)php;
php php php php php php php php php}php elseifphp php(isphp_intphp(php$valuephp)php)php php{
php php php php php php php php php php php php php$thisphp-php>php_writeIntphp(php$valuephp)php;
php php php php php php php php php}php elseifphp php(isphp_floatphp(php$valuephp)php)php php{
php php php php php php php php php php php php php$thisphp-php>php_writeFloatphp(php$valuephp)php;
php php php php php php php php php}php elseifphp php(isphp_stringphp(php$valuephp)php)php php{
php php php php php php php php php php php php php/php/php TODOphp:php writephp unicodephp php/php binary
php php php php php php php php php php php php php$thisphp-php>php_writeStringphp(php$valuephp)php;
php php php php php php php php php}php elseifphp php(isphp_arrayphp(php$valuephp)php)php php{
php php php php php php php php php php php php ifphp php(php$thisphp-php>php_isArrayAssocphp(php$valuephp)php)php php{
php php php php php php php php php php php php php php php php php$thisphp-php>php_writeArrayDictphp(php$valuephp)php;
php php php php php php php php php php php php php}php elsephp php{
php php php php php php php php php php php php php php php php php$thisphp-php>php_writeArrayListphp(php$valuephp)php;
php php php php php php php php php php php php php}
php php php php php php php php php}php elseifphp php(isphp_objectphp(php$valuephp)php)php php{
php php php php php php php php php php php php php$thisphp-php>php_writeObjectphp(php$valuephp)php;
php php php php php php php php php}php elsephp php{
php php php php php php php php php php php php requirephp_oncephp php'Zendphp/Serializerphp/Exceptionphp.phpphp'php;
php php php php php php php php php php php php throwphp newphp Zendphp_Serializerphp_Exceptionphp(
php php php php php php php php php php php php php php php php php'PHPphp-Typephp php"php'php.gettypephp(php$valuephp)php.php'php"php isnphp\php'tphp serializablephp withphp php'php.getphp_classphp(php$thisphp)
php php php php php php php php php php php php php)php;
php php php php php php php php php}
php php php php php}

php php php php php/php*php*
php php php php php php*php Writephp picklephp protocol
php php php php php php*
php php php php php php*php php@paramphp php intphp php$protocol
php php php php php php*php php@returnphp void
php php php php php php*php/
php php php php protectedphp functionphp php_writeProtophp(php$protocolphp)
php php php php php{
php php php php php php php php php$thisphp-php>php_picklephp php.php=php selfphp:php:OPphp_PROTOphp php.php php$protocolphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Writephp aphp get
php php php php php php*
php php php php php php*php php@paramphp php intphp php$idphp Idphp ofphp memo
php php php php php php*php php@returnphp void
php php php php php php*php/
php php php php protectedphp functionphp php_writeGetphp(php$idphp)
php php php php php{
php php php php php php php php ifphp php(php$thisphp-php>php_binaryphp)php php{
php php php php php php php php php php php php ifphp php(php$idphp <php=php php0xffphp)php php{
php php php php php php php php php php php php php php php php php/php/php BINGETphp php+php chrphp(iphp)
php php php php php php php php php php php php php php php php php$thisphp-php>php_picklephp php.php=php selfphp:php:OPphp_BINGETphp php.php chrphp(php$idphp)php;
php php php php php php php php php php php php php}php elsephp php{
php php php php php php php php php php php php php php php php php/php/php LONGphp_BINGETphp php+php packphp(php"php<iphp"php,php iphp)
php php php php php php php php php php php php php php php php php$idBinphp php=php packphp(php'lphp'php,php php$idphp)php;
php php php php php php php php php php php php php php php php ifphp php(selfphp:php:php$php_isLittleEndianphp php=php=php=php falsephp)php php{
php php php php php php php php php php php php php php php php php php php php php$idBinphp php=php strrevphp(php$binphp)php;
php php php php php php php php php php php php php php php php php}
php php php php php php php php php php php php php php php php php$thisphp-php>php_picklephp php.php=php selfphp:php:OPphp_LONGphp_BINGETphp php.php php$idBinphp;
php php php php php php php php php php php php php}
php php php php php php php php php}php elsephp php{
php php php php php php php php php php php php php$thisphp-php>php_picklephp php.php=php selfphp:php:OPphp_GETphp php.php php$idphp php.php php"php\rphp\nphp"php;
php php php php php php php php php}
php php php php php}

php php php php php/php*php*
php php php php php php*php Writephp aphp put
php php php php php php*
php php php php php php*php php@paramphp php intphp php$idphp Idphp ofphp memo
php php php php php php*php php@returnphp void
php php php php php php*php/
php php php php protectedphp functionphp php_writePutphp(php$idphp)
php php php php php{
php php php php php php php php ifphp php(php$thisphp-php>php_binaryphp)php php{
php php php php php php php php php php php php ifphp php(php$idphp <php=php php0xffphp)php php{
php php php php php php php php php php php php php php php php php/php/php BINPUTphp php+php chrphp(iphp)
php php php php php php php php php php php php php php php php php$thisphp-php>php_picklephp php.php=php selfphp:php:OPphp_BINPUTphp php.php chrphp(php$idphp)php;
php php php php php php php php php php php php php}php elsephp php{
php php php php php php php php php php php php php php php php php/php/php LONGphp_BINPUTphp php+php packphp(php"php<iphp"php,php iphp)
php php php php php php php php php php php php php php php php php$idBinphp php=php packphp(php'lphp'php,php php$idphp)php;
php php php php php php php php php php php php php php php php ifphp php(selfphp:php:php$php_isLittleEndianphp php=php=php=php falsephp)php php{
php php php php php php php php php php php php php php php php php php php php php$idBinphp php=php strrevphp(php$binphp)php;
php php php php php php php php php php php php php php php php php}
php php php php php php php php php php php php php php php php php$thisphp-php>php_picklephp php.php=php selfphp:php:OPphp_LONGphp_BINPUTphp php.php php$idBinphp;
php php php php php php php php php php php php php}
php php php php php php php php php}php elsephp php{
php php php php php php php php php php php php php$thisphp-php>php_picklephp php.php=php selfphp:php:OPphp_PUTphp php.php php$idphp php.php php"php\rphp\nphp"php;
php php php php php php php php php}
php php php php php}

php php php php php/php*php*
php php php php php php*php Writephp aphp nullphp asphp None
php php php php php php*
php php php php php php*php php@returnphp void
php php php php php php*php/
php php php php protectedphp functionphp php_writeNullphp(php)
php php php php php{
php php php php php php php php php$thisphp-php>php_picklephp php.php=php selfphp:php:OPphp_NONEphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Writephp aphp booleanphp true
php php php php php php*
php php php php php php*php php@returnphp void
php php php php php php*php/
php php php php protectedphp functionphp php_writeTruephp(php)
php php php php php{
php php php php php php php php ifphp php(php$thisphp-php>php_protocolphp php>php=php php2php)php php{
php php php php php php php php php php php php php$thisphp-php>php_picklephp php.php=php selfphp:php:OPphp_NEWTRUEphp;
php php php php php php php php php}php elsephp php{
php php php php php php php php php php php php php$thisphp-php>php_picklephp php.php=php selfphp:php:OPphp_INTphp php.php php"php0php1php\rphp\nphp"php;
php php php php php php php php php}
php php php php php}

php php php php php/php*php*
php php php php php php*php Writephp aphp booleanphp false
php php php php php php*
php php php php php php*php php@returnphp void
php php php php php php*php/
php php php php protectedphp functionphp php_writeFalsephp(php)
php php php php php{
php php php php php php php php ifphp php(php$thisphp-php>php_protocolphp php>php=php php2php)php php{
php php php php php php php php php php php php php$thisphp-php>php_picklephp php.php=php selfphp:php:OPphp_NEWFALSEphp;
php php php php php php php php php}php elsephp php{
php php php php php php php php php php php php php$thisphp-php>php_picklephp php.php=php selfphp:php:OPphp_INTphp php.php php"php0php0php\rphp\nphp"php;
php php php php php php php php php}
php php php php php}

php php php php php/php*php*
php php php php php php*php Writephp anphp integerphp value
php php php php php php*
php php php php php php*php php@paramphp php intphp php$value
php php php php php php*php php@returnphp void
php php php php php php*php/
php php php php protectedphp functionphp php_writeIntphp(php$valuephp)
php php php php php{
php php php php php php php php ifphp php(php$thisphp-php>php_binaryphp)php php{
php php php php php php php php php php php php ifphp php(php$valuephp php>php=php php0php)php php{
php php php php php php php php php php php php php php php php ifphp php(php$valuephp <php=php php0xffphp)php php{
php php php php php php php php php php php php php php php php php php php php php/php/php selfphp.writephp(BININTphp1php php+php chrphp(objphp)php)
php php php php php php php php php php php php php php php php php php php php php$thisphp-php>php_picklephp php.php=php selfphp:php:OPphp_BININTphp1php php.php chrphp(php$valuephp)php;
php php php php php php php php php php php php php php php php php}php elseifphp php(php$valuephp <php=php php0xffffphp)php php{
php php php php php php php php php php php php php php php php php php php php php/php/php selfphp.writephp(php"php%cphp%cphp%cphp"php php%php php(BININTphp2php,php objphp&php0xffphp,php objphp>php>php8php)php)
php php php php php php php php php php php php php php php php php php php php php$thisphp-php>php_picklephp php.php=php selfphp:php:OPphp_BININTphp2php php.php packphp(php'vphp'php,php php$valuephp)php;
php php php php php php php php php php php php php php php php php}
php php php php php php php php php php php php php php php php returnphp;
php php php php php php php php php php php php php}

php php php php php php php php php php php php php/php/php Nextphp checkphp forphp php4php-bytephp signedphp intsphp:
php php php php php php php php php php php php php$highBitsphp php=php php$valuephp php>php>php php3php1php;php php php/php/php notephp thatphp Pythonphp shiftphp signphp-extends
php php php php php php php php php php php php ifphp php(php$highBitsphp php=php=php php0php php|php|php php$highBitsphp php=php=php php-php1php)php php{
php php php php php php php php php php php php php php php php php/php/php Allphp highphp bitsphp arephp copiesphp ofphp bitphp php2php*php*php3php1php,php sophp thephp value
php php php php php php php php php php php php php php php php php/php/php fitsphp inphp aphp php4php-bytephp signedphp intphp.
php php php php php php php php php php php php php php php php php/php/php selfphp.writephp(BININTphp php+php packphp(php"php<iphp"php,php objphp)php)
php php php php php php php php php php php php php php php php php$binphp php=php packphp(php'lphp'php,php php$valuephp)php;
php php php php php php php php php php php php php php php php ifphp php(selfphp:php:php$php_isLittleEndianphp php=php=php=php falsephp)php php{
php php php php php php php php php php php php php php php php php php php php php$binphp php=php strrevphp(php$binphp)php;
php php php php php php php php php php php php php php php php php}
php php php php php php php php php php php php php php php php php$thisphp-php>php_picklephp php.php=php selfphp:php:OPphp_BININTphp php.php php$binphp;
php php php php php php php php php php php php php php php php returnphp;
php php php php php php php php php php php php php}
php php php php php php php php php}

php php php php php php php php php$thisphp-php>php_picklephp php.php=php selfphp:php:OPphp_INTphp php.php php$valuephp php.php php"php\rphp\nphp"php;
php php php php php}

php php php php php/php*php*
php php php php php php*php Writephp aphp floatphp value
php php php php php php*
php php php php php php*php php@paramphp php floatphp php$value
php php php php php php*php php@returnphp void
php php php php php php*php/
php php php php protectedphp functionphp php_writeFloatphp(php$valuephp)
php php php php php{
php php php php php php php php ifphp php(php$thisphp-php>php_binaryphp)php php{
php php php php php php php php php php php php php/php/php selfphp.writephp(BINFLOATphp php+php packphp(php'php>dphp'php,php objphp)php)
php php php php php php php php php php php php php$binphp php=php packphp(php'dphp'php,php php$valuephp)php;
php php php php php php php php php php php php ifphp php(selfphp:php:php$php_isLittleEndianphp php=php=php=php truephp)php php{
php php php php php php php php php php php php php php php php php$binphp php=php strrevphp(php$binphp)php;
php php php php php php php php php php php php php}
php php php php php php php php php php php php php$thisphp-php>php_picklephp php.php=php selfphp:php:OPphp_BINFLOATphp php.php php$binphp;
php php php php php php php php php}php elsephp php{
php php php php php php php php php php php php php$thisphp-php>php_picklephp php.php=php selfphp:php:OPphp_FLOATphp php.php php$valuephp php.php php"php\rphp\nphp"php;
php php php php php php php php php}
php php php php php}

php php php php php/php*php*
php php php php php php*php Writephp aphp stringphp value
php php php php php php*
php php php php php php*php php@paramphp php stringphp php$value
php php php php php php*php php@returnphp void
php php php php php php*php/
php php php php protectedphp functionphp php_writeStringphp(php$valuephp)
php php php php php{
php php php php php php php php ifphp php(php php(php$idphp=php$thisphp-php>php_searchMomophp(php$valuephp)php)php php!php=php=php falsephp php)php php{
php php php php php php php php php php php php php$thisphp-php>php_writeGetphp(php$idphp)php;
php php php php php php php php php php php php returnphp;
php php php php php php php php php}

php php php php php php php php ifphp php(php$thisphp-php>php_binaryphp)php php{
php php php php php php php php php php php php php$nphp php=php strlenphp(php$valuephp)php;
php php php php php php php php php php php php ifphp php(php$nphp <php=php php0xffphp)php php{
php php php php php php php php php php php php php php php php php/php/php selfphp.writephp(SHORTphp_BINSTRINGphp php+php chrphp(nphp)php php+php objphp)
php php php php php php php php php php php php php php php php php$thisphp-php>php_picklephp php.php=php selfphp:php:OPphp_SHORTphp_BINSTRINGphp php.php chrphp(php$nphp)php php.php php$valuephp;
php php php php php php php php php php php php php}php elsephp php{
php php php php php php php php php php php php php php php php php/php/php selfphp.writephp(BINSTRINGphp php+php packphp(php"php<iphp"php,php nphp)php php+php objphp)
php php php php php php php php php php php php php php php php php$binLenphp php=php packphp(php'lphp'php,php php$nphp)php;
php php php php php php php php php php php php php php php php ifphp php(selfphp:php:php$php_isLittleEndianphp php=php=php=php falsephp)php php{
php php php php php php php php php php php php php php php php php php php php php$binLenphp php=php strrevphp(php$binLenphp)php;
php php php php php php php php php php php php php php php php php}
php php php php php php php php php php php php php php php php php$thisphp-php>php_picklephp php.php=php selfphp:php:OPphp_BINSTRINGphp php.php php$binLenphp php.php php$valuephp;
php php php php php php php php php php php php php}
php php php php php php php php php}php elsephp php{
php php php php php php php php php php php php php$thisphp-php>php_picklephp php.php=php selfphp:php:OPphp_STRINGphp php.php php$thisphp-php>php_quoteStringphp(php$valuephp)php php.php php"php\rphp\nphp"php;
php php php php php php php php php}

php php php php php php php php php$thisphp-php>php_momorizephp(php$valuephp)php;
php php php php php}

php php php php php/php*php*
php php php php php php*php Writephp anphp associativephp arrayphp valuephp asphp dictionary
php php php php php php*
php php php php php php*php php@paramphp php arrayphp php$value
php php php php php php*php php@returnphp void
php php php php php php*php/
php php php php protectedphp functionphp php_writeArrayDictphp(arrayphp php$valuephp)
php php php php php{
php php php php php php php php ifphp php(php(php$idphp=php$thisphp-php>php_searchMomophp(php$valuephp)php)php php!php=php=php falsephp)php php{
php php php php php php php php php php php php php$thisphp-php>php_writeGetphp(php$idphp)php;php;
php php php php php php php php php php php php returnphp;
php php php php php php php php php}

php php php php php php php php php$thisphp-php>php_picklephp php.php=php selfphp:php:OPphp_MARKphp php.php selfphp:php:OPphp_DICTphp;
php php php php php php php php php$thisphp-php>php_momorizephp(php$valuephp)php;

php php php php php php php php foreachphp php(php$valuephp asphp php$kphp php=php>php php$vphp)php php{
php php php php php php php php php php php php php$thisphp-php>php_picklephp php.php=php php$thisphp-php>php_writephp(php$kphp)
php php php php php php php php php php php php php php php php php php php php php php php php php php php php php.php php$thisphp-php>php_writephp(php$vphp)
php php php php php php php php php php php php php php php php php php php php php php php php php php php php php.php selfphp:php:OPphp_SETITEMphp;
php php php php php php php php php}
php php php php php}

php php php php php/php*php*
php php php php php php*php Writephp aphp simplephp arrayphp valuephp asphp list
php php php php php php*
php php php php php php*php php@paramphp php arrayphp php$value
php php php php php php*php php@returnphp void
php php php php php php*php/
php php php php protectedphp functionphp php_writeArrayListphp(arrayphp php$valuephp)
php php php php php{
php php php php php php php php ifphp php(php(php$idphp php=php php$thisphp-php>php_searchMomophp(php$valuephp)php)php php!php=php=php falsephp)php php{
php php php php php php php php php php php php php$thisphp-php>php_writeGetphp(php$idphp)php;
php php php php php php php php php php php php returnphp;
php php php php php php php php php}

php php php php php php php php php$thisphp-php>php_picklephp php.php=php selfphp:php:OPphp_MARKphp php.php selfphp:php:OPphp_LISTphp;
php php php php php php php php php$thisphp-php>php_momorizephp(php$valuephp)php;

php php php php php php php php foreachphp php(php$valuephp asphp php$kphp php=php>php php$vphp)php php{
php php php php php php php php php php php php php$thisphp-php>php_picklephp php.php=php php$thisphp-php>php_writephp(php$vphp)php php.php selfphp:php:OPphp_APPENDphp;
php php php php php php php php php}
php php php php php}

php php php php php/php*php*
php php php php php php*php Writephp anphp objectphp asphp anphp dictionary
php php php php php php*
php php php php php php*php php@paramphp php objectphp php$value
php php php php php php*php php@returnphp void
php php php php php php*php/
php php php php protectedphp functionphp php_writeObjectphp(php$valuephp)
php php php php php{
php php php php php php php php php/php/php canphp'tphp serializephp phpphp objectsphp tophp pythonphp objectsphp yet
php php php php php php php php php$thisphp-php>php_writeArrayDictphp(getphp_objectphp_varsphp(php$valuephp)php)php;
php php php php php}

php php php php php/php*php*
php php php php php php*php Writephp stop
php php php php php php*
php php php php php php*php php@returnphp void
php php php php php php*php/
php php php php protectedphp functionphp php_writeStopphp(php)
php php php php php{
php php php php php php php php php$thisphp-php>php_picklephp php.php=php selfphp:php:OPphp_STOPphp;
php php php php php}

php php php php php/php*php serializephp helperphp php*php/

php php php php php/php*php*
php php php php php php*php Addphp aphp valuephp tophp thephp memophp andphp writephp thephp id
php php php php php php*
php php php php php php*php php@paramphp mixedphp php$value
php php php php php php*php php@returnphp void
php php php php php php*php/
php php php php protectedphp functionphp php_momorizephp(php$valuephp)
php php php php php{
php php php php php php php php php$idphp php=php countphp(php$thisphp-php>php_memophp)php;
php php php php php php php php php$thisphp-php>php_memophp[php$idphp]php php=php php$valuephp;
php php php php php php php php php$thisphp-php>php_writePutphp(php$idphp)php;
php php php php php}

php php php php php/php*php*
php php php php php php*php Searchphp aphp valuephp inphp thephp menophp andphp returnphp php thephp id
php php php php php php*
php php php php php php*php php@paramphp php mixedphp php$value
php php php php php php*php php@returnphp intphp|falsephp Thephp idphp orphp false
php php php php php php*php/
php php php php protectedphp functionphp php_searchMomophp(php$valuephp)
php php php php php{
php php php php php php php php returnphp arrayphp_searchphp(php$valuephp,php php$thisphp-php>php_memophp,php truephp)php;
php php php php php}

php php php php php/php*php*
php php php php php php*php Isphp anphp arrayphp associativephp?
php php php php php php*
php php php php php php*php php@paramphp php arrayphp php$value
php php php php php php*php php@returnphp boolean
php php php php php php*php/
php php php php protectedphp functionphp php_isArrayAssocphp(arrayphp php$valuephp)
php php php php php{
php php php php php php php php returnphp arrayphp_diffphp_keyphp(php$valuephp,php arrayphp_keysphp(arrayphp_keysphp(php$valuephp)php)php)php;
php php php php php}

php php php php php/php*php*
php php php php php php*php Quotephp/Escapephp aphp string
php php php php php php*
php php php php php php*php php@paramphp php stringphp php$str
php php php php php php*php php@returnphp stringphp quotedphp string
php php php php php php*php/
php php php php protectedphp functionphp php_quoteStringphp(php$strphp)
php php php php php{
php php php php php php php php php$quoteArrphp php=php selfphp:php:php$php_quoteStringphp;

php php php php php php php php ifphp php(php(php$cntSingleQuotephp php=php substrphp_countphp(php$strphp,php php"php'php"php)php)
php php php php php php php php php php php php php&php&php php(php$cntDoubleQuotephp php=php substrphp_countphp(php$strphp,php php'php"php'php)php)
php php php php php php php php php php php php php&php&php php(php$cntSingleQuotephp <php php$cntDoubleQuotephp)
php php php php php php php php php)php php{
php php php php php php php php php php php php php$quoteArrphp[php'php"php'php]php php=php php'php\php\php"php'php;
php php php php php php php php php php php php php$enclosurephp php php php php php=php php'php"php'php;
php php php php php php php php php}php elsephp php{
php php php php php php php php php php php php php$quoteArrphp[php"php'php"php]php php=php php"php\php\php'php"php;
php php php php php php php php php php php php php$enclosurephp php php php php php=php php"php'php"php;
php php php php php php php php php}

php php php php php php php php returnphp php$enclosurephp php.php strtrphp(php$strphp,php php$quoteArrphp)php php.php php$enclosurephp;
php php php php php}

php php php php php/php*php unserializephp php*php/

php php php php php/php*php*
php php php php php php*php Unserializephp fromphp Pythonphp Picklephp formatphp tophp PHP
php php php php php php*
php php php php php php*php php@paramphp php stringphp php$pickle
php php php php php php*php php@paramphp php arrayphp php$opts
php php php php php php*php php@returnphp mixed
php php php php php php*php php@throwsphp Zendphp_Serializerphp_Exceptionphp onphp invalidphp Picklephp string
php php php php php php*php/
php php php php publicphp functionphp unserializephp(php$picklephp,php arrayphp php$optsphp php=php arrayphp(php)php)
php php php php php{
php php php php php php php php php/php/php initphp processphp vars
php php php php php php php php php$thisphp-php>php_posphp php php php php php php php=php php0php;
php php php php php php php php php$thisphp-php>php_picklephp php php php php=php php$picklephp;
php php php php php php php php php$thisphp-php>php_pickleLenphp php=php strlenphp(php$thisphp-php>php_picklephp)php;
php php php php php php php php php$thisphp-php>php_memophp php php php php php php=php arrayphp(php)php;
php php php php php php php php php$thisphp-php>php_stackphp php php php php php=php arrayphp(php)php;

php php php php php php php php php/php/php readphp picklephp string
php php php php php php php php whilephp php(php(php$opphp=php$thisphp-php>php_readphp(php1php)php)php php!php=php=php selfphp:php:OPphp_STOPphp)php php{
php php php php php php php php php php php php php$thisphp-php>php_loadphp(php$opphp)php;
php php php php php php php php php}

php php php php php php php php ifphp php(php!countphp(php$thisphp-php>php_stackphp)php)php php{
php php php php php php php php php php php php requirephp_oncephp php'Zendphp/Serializerphp/Exceptionphp.phpphp'php;
php php php php php php php php php php php php throwphp newphp Zendphp_Serializerphp_Exceptionphp(php'Nophp dataphp foundphp'php)php;
php php php php php php php php php}

php php php php php php php php php$retphp php=php arrayphp_popphp(php$thisphp-php>php_stackphp)php;

php php php php php php php php php/php/php clearphp processphp vars
php php php php php php php php php$thisphp-php>php_posphp php php php php php php php=php php0php;
php php php php php php php php php$thisphp-php>php_picklephp php php php php=php php'php'php;
php php php php php php php php php$thisphp-php>php_pickleLenphp php=php php0php;
php php php php php php php php php$thisphp-php>php_memophp php php php php php php=php arrayphp(php)php;
php php php php php php php php php$thisphp-php>php_stackphp php php php php php=php arrayphp(php)php;

php php php php php php php php returnphp php$retphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Loadphp aphp picklephp opcode
php php php php php php*
php php php php php php*php php@paramphp php stringphp php$op
php php php php php php*php php@returnphp void
php php php php php php*php php@throwsphp Zendphp_Serializerphp_Exceptionphp onphp invalidphp opcode
php php php php php php*php/
php php php php protectedphp functionphp php_loadphp(php$opphp)
php php php php php{
php php php php php php php php switchphp php(php$opphp)php php{
php php php php php php php php php php php php casephp selfphp:php:OPphp_PUTphp:
php php php php php php php php php php php php php php php php php$thisphp-php>php_loadPutphp(php)php;
php php php php php php php php php php php php php php php php breakphp;
php php php php php php php php php php php php casephp selfphp:php:OPphp_BINPUTphp:
php php php php php php php php php php php php php php php php php$thisphp-php>php_loadBinPutphp(php)php;
php php php php php php php php php php php php php php php php breakphp;
php php php php php php php php php php php php casephp selfphp:php:OPphp_LONGphp_BINPUTphp:
php php php php php php php php php php php php php php php php php$thisphp-php>php_loadLongBinPutphp(php)php;
php php php php php php php php php php php php php php php php breakphp;
php php php php php php php php php php php php casephp selfphp:php:OPphp_GETphp:
php php php php php php php php php php php php php php php php php$thisphp-php>php_loadGetphp(php)php;
php php php php php php php php php php php php php php php php breakphp;
php php php php php php php php php php php php casephp selfphp:php:OPphp_BINGETphp:
php php php php php php php php php php php php php php php php php$thisphp-php>php_loadBinGetphp(php)php;
php php php php php php php php php php php php php php php php breakphp;
php php php php php php php php php php php php casephp selfphp:php:OPphp_LONGphp_BINGETphp:
php php php php php php php php php php php php php php php php php$thisphp-php>php_loadLongBinGetphp(php)php;
php php php php php php php php php php php php php php php php breakphp;
php php php php php php php php php php php php casephp selfphp:php:OPphp_NONEphp:
php php php php php php php php php php php php php php php php php$thisphp-php>php_loadNonephp(php)php;
php php php php php php php php php php php php php php php php breakphp;
php php php php php php php php php php php php casephp selfphp:php:OPphp_NEWTRUEphp:
php php php php php php php php php php php php php php php php php$thisphp-php>php_loadNewTruephp(php)php;
php php php php php php php php php php php php php php php php breakphp;
php php php php php php php php php php php php casephp selfphp:php:OPphp_NEWFALSEphp:
php php php php php php php php php php php php php php php php php$thisphp-php>php_loadNewFalsephp(php)php;
php php php php php php php php php php php php php php php php breakphp;
php php php php php php php php php php php php casephp selfphp:php:OPphp_INTphp:
php php php php php php php php php php php php php php php php php$thisphp-php>php_loadIntphp(php)php;
php php php php php php php php php php php php php php php php breakphp;
php php php php php php php php php php php php casephp selfphp:php:OPphp_BININTphp:
php php php php php php php php php php php php php php php php php$thisphp-php>php_loadBinIntphp(php)php;
php php php php php php php php php php php php php php php php breakphp;
php php php php php php php php php php php php casephp selfphp:php:OPphp_BININTphp1php:
php php php php php php php php php php php php php php php php php$thisphp-php>php_loadBinIntphp1php(php)php;
php php php php php php php php php php php php php php php php breakphp;
php php php php php php php php php php php php casephp selfphp:php:OPphp_BININTphp2php:
php php php php php php php php php php php php php php php php php$thisphp-php>php_loadBinIntphp2php(php)php;
php php php php php php php php php php php php php php php php breakphp;
php php php php php php php php php php php php casephp selfphp:php:OPphp_LONGphp:
php php php php php php php php php php php php php php php php php$thisphp-php>php_loadLongphp(php)php;
php php php php php php php php php php php php php php php php breakphp;
php php php php php php php php php php php php casephp selfphp:php:OPphp_LONGphp1php:
php php php php php php php php php php php php php php php php php$thisphp-php>php_loadLongphp1php(php)php;
php php php php php php php php php php php php php php php php breakphp;
php php php php php php php php php php php php casephp selfphp:php:OPphp_LONGphp4php:
php php php php php php php php php php php php php php php php php$thisphp-php>php_loadLongphp4php(php)php;
php php php php php php php php php php php php php php php php breakphp;
php php php php php php php php php php php php casephp selfphp:php:OPphp_FLOATphp:
php php php php php php php php php php php php php php php php php$thisphp-php>php_loadFloatphp(php)php;
php php php php php php php php php php php php php php php php breakphp;
php php php php php php php php php php php php casephp selfphp:php:OPphp_BINFLOATphp:
php php php php php php php php php php php php php php php php php$thisphp-php>php_loadBinFloatphp(php)php;
php php php php php php php php php php php php php php php php breakphp;
php php php php php php php php php php php php casephp selfphp:php:OPphp_STRINGphp:
php php php php php php php php php php php php php php php php php$thisphp-php>php_loadStringphp(php)php;
php php php php php php php php php php php php php php php php breakphp;
php php php php php php php php php php php php casephp selfphp:php:OPphp_BINSTRINGphp:
php php php php php php php php php php php php php php php php php$thisphp-php>php_loadBinStringphp(php)php;
php php php php php php php php php php php php php php php php breakphp;
php php php php php php php php php php php php casephp selfphp:php:OPphp_SHORTphp_BINSTRINGphp:
php php php php php php php php php php php php php php php php php$thisphp-php>php_loadShortBinStringphp(php)php;
php php php php php php php php php php php php php php php php breakphp;
php php php php php php php php php php php php casephp selfphp:php:OPphp_BINBYTESphp:
php php php php php php php php php php php php php php php php php$thisphp-php>php_loadBinBytesphp(php)php;
php php php php php php php php php php php php php php php php breakphp;
php php php php php php php php php php php php casephp selfphp:php:OPphp_SHORTphp_BINBYTESphp:
php php php php php php php php php php php php php php php php php$thisphp-php>php_loadShortBinBytesphp(php)php;
php php php php php php php php php php php php php php php php breakphp;
php php php php php php php php php php php php casephp selfphp:php:OPphp_UNICODEphp:
php php php php php php php php php php php php php php php php php$thisphp-php>php_loadUnicodephp(php)php;
php php php php php php php php php php php php php php php php breakphp;
php php php php php php php php php php php php casephp selfphp:php:OPphp_BINUNICODEphp:
php php php php php php php php php php php php php php php php php$thisphp-php>php_loadBinUnicodephp(php)php;
php php php php php php php php php php php php php php php php breakphp;
php php php php php php php php php php php php casephp selfphp:php:OPphp_MARKphp:
php php php php php php php php php php php php php php php php php$thisphp-php>php_loadMarkphp(php)php;
php php php php php php php php php php php php php php php php breakphp;
php php php php php php php php php php php php casephp selfphp:php:OPphp_LISTphp:
php php php php php php php php php php php php php php php php php$thisphp-php>php_loadListphp(php)php;
php php php php php php php php php php php php php php php php breakphp;
php php php php php php php php php php php php casephp selfphp:php:OPphp_EMPTYphp_LISTphp:
php php php php php php php php php php php php php php php php php$thisphp-php>php_loadEmptyListphp(php)php;
php php php php php php php php php php php php php php php php breakphp;
php php php php php php php php php php php php casephp selfphp:php:OPphp_APPENDphp:
php php php php php php php php php php php php php php php php php$thisphp-php>php_loadAppendphp(php)php;
php php php php php php php php php php php php php php php php breakphp;
php php php php php php php php php php php php casephp selfphp:php:OPphp_APPENDSphp:
php php php php php php php php php php php php php php php php php$thisphp-php>php_loadAppendsphp(php)php;
php php php php php php php php php php php php php php php php breakphp;
php php php php php php php php php php php php casephp selfphp:php:OPphp_DICTphp:
php php php php php php php php php php php php php php php php php$thisphp-php>php_loadDictphp(php)php;
php php php php php php php php php php php php php php php php breakphp;
php php php php php php php php php php php php casephp selfphp:php:OPphp_EMPTYphp_DICTphp:
php php php php php php php php php php php php php php php php php$thisphp-php>php_loadEmptyDictphp(php)php;
php php php php php php php php php php php php php php php php breakphp;
php php php php php php php php php php php php casephp selfphp:php:OPphp_SETITEMphp:
php php php php php php php php php php php php php php php php php$thisphp-php>php_loadSetItemphp(php)php;
php php php php php php php php php php php php php php php php breakphp;
php php php php php php php php php php php php casephp selfphp:php:OPphp_SETITEMSphp:
php php php php php php php php php php php php php php php php php$thisphp-php>php_loadSetItemsphp(php)php;
php php php php php php php php php php php php php php php php breakphp;
php php php php php php php php php php php php casephp selfphp:php:OPphp_TUPLEphp:
php php php php php php php php php php php php php php php php php$thisphp-php>php_loadTuplephp(php)php;
php php php php php php php php php php php php php php php php breakphp;
php php php php php php php php php php php php casephp selfphp:php:OPphp_TUPLEphp1php:
php php php php php php php php php php php php php php php php php$thisphp-php>php_loadTuplephp1php(php)php;
php php php php php php php php php php php php php php php php breakphp;
php php php php php php php php php php php php casephp selfphp:php:OPphp_TUPLEphp2php:
php php php php php php php php php php php php php php php php php$thisphp-php>php_loadTuplephp2php(php)php;
php php php php php php php php php php php php php php php php breakphp;
php php php php php php php php php php php php casephp selfphp:php:OPphp_TUPLEphp3php:
php php php php php php php php php php php php php php php php php$thisphp-php>php_loadTuplephp3php(php)php;
php php php php php php php php php php php php php php php php breakphp;
php php php php php php php php php php php php casephp selfphp:php:OPphp_PROTOphp:
php php php php php php php php php php php php php php php php php$thisphp-php>php_loadProtophp(php)php;
php php php php php php php php php php php php php php php php breakphp;
php php php php php php php php php php php php defaultphp:
php php php php php php php php php php php php php php php php requirephp_oncephp php'Zendphp/Serializerphp/Exceptionphp.phpphp'php;
php php php php php php php php php php php php php php php php throwphp newphp Zendphp_Serializerphp_Exceptionphp(php'Invalidphp orphp unknownphp opcodephp php"php'php.php$opphp.php'php"php'php)php;
php php php php php php php php php}
php php php php php}

php php php php php/php*php*
php php php php php php*php Loadphp aphp PUTphp opcode
php php php php php php*
php php php php php php*php php@returnphp void
php php php php php php*php php@throwsphp Zendphp_Serializerphp_Exceptionphp onphp missingphp stack
php php php php php php*php/
php php php php protectedphp functionphp php_loadPutphp(php)
php php php php php{
php php php php php php php php php$idphp php=php php(intphp)php$thisphp-php>php_readlinephp(php)php;

php php php php php php php php php$lastStackphp php=php countphp(php$thisphp-php>php_stackphp)php-php1php;
php php php php php php php php ifphp php(php!issetphp(php$thisphp-php>php_stackphp[php$lastStackphp]php)php)php php{
php php php php php php php php php php php php requirephp_oncephp php'Zendphp/Serializerphp/Exceptionphp.phpphp'php;
php php php php php php php php php php php php throwphp newphp Zendphp_Serializerphp_Exceptionphp(php'Nophp stackphp existphp'php)php;
php php php php php php php php php}
php php php php php php php php php$thisphp-php>php_memophp[php$idphp]php php=php php&php php$thisphp-php>php_stackphp[php$lastStackphp]php;
php php php php php}

php php php php php/php*php*
php php php php php php*php Loadphp aphp binaryphp PUT
php php php php php php*
php php php php php php*php php@returnphp void
php php php php php php*php php@throwsphp Zendphp_Serializerphp_Exceptionphp onphp missingphp stack
php php php php php php*php/
php php php php protectedphp functionphp php_loadBinPutphp(php)
php php php php php{
php php php php php php php php php$idphp php=php ordphp(php$thisphp-php>php_readphp(php1php)php)php;

php php php php php php php php php$lastStackphp php=php countphp(php$thisphp-php>php_stackphp)php-php1php;
php php php php php php php php ifphp php(php!issetphp(php$thisphp-php>php_stackphp[php$lastStackphp]php)php)php php{
php php php php php php php php php php php php requirephp_oncephp php'Zendphp/Serializerphp/Exceptionphp.phpphp'php;
php php php php php php php php php php php php throwphp newphp Zendphp_Serializerphp_Exceptionphp(php'Nophp stackphp existphp'php)php;
php php php php php php php php php}
php php php php php php php php php$thisphp-php>php_memophp[php$idphp]php php=php php&php php$thisphp-php>php_stackphp[php$lastStackphp]php;
php php php php php}

php php php php php/php*php*
php php php php php php*php Loadphp aphp longphp binaryphp PUT
php php php php php php*
php php php php php php*php php@returnphp void
php php php php php php*php php@throwsphp Zendphp_Serializerphp_Exceptionphp onphp missingphp stack
php php php php php php*php/
php php php php protectedphp functionphp php_loadLongBinPutphp(php)
php php php php php{
php php php php php php php php php$binphp php=php php$thisphp-php>php_readphp(php4php)php;
php php php php php php php php ifphp php(selfphp:php:php$php_isLittleEndianphp php=php=php=php falsephp)php php{
php php php php php php php php php php php php php$binphp php=php strrevphp(php$binphp)php;
php php php php php php php php php}
php php php php php php php php listphp(php,php php$idphp)php php=php unpackphp(php'lphp'php,php php$binphp)php;

php php php php php php php php php$lastStackphp php=php countphp(php$thisphp-php>php_stackphp)php-php1php;
php php php php php php php php ifphp php(php!issetphp(php$thisphp-php>php_stackphp[php$lastStackphp]php)php)php php{
php php php php php php php php php php php php requirephp_oncephp php'Zendphp/Serializerphp/Exceptionphp.phpphp'php;
php php php php php php php php php php php php throwphp newphp Zendphp_Serializerphp_Exceptionphp(php'Nophp stackphp existphp'php)php;
php php php php php php php php php}
php php php php php php php php php$thisphp-php>php_memophp[php$idphp]php php=php php&php php$thisphp-php>php_stackphp[php$lastStackphp]php;
php php php php php}

php php php php php/php*php*
php php php php php php*php Loadphp aphp GETphp operation
php php php php php php*
php php php php php php*php php@returnphp void
php php php php php php*php php@throwsphp Zendphp_Serializerphp_Exceptionphp onphp missingphp GETphp identifier
php php php php php php*php/
php php php php protectedphp functionphp php_loadGetphp(php)
php php php php php{
php php php php php php php php php$idphp php=php php(intphp)php$thisphp-php>php_readlinephp(php)php;

php php php php php php php php ifphp php(php!arrayphp_keyphp_existsphp(php$idphp,php php$thisphp-php>php_memophp)php)php php{
php php php php php php php php php php php php requirephp_oncephp php'Zendphp/Serializerphp/Exceptionphp.phpphp'php;
php php php php php php php php php php php php throwphp newphp Zendphp_Serializerphp_Exceptionphp(php'Getphp idphp php"php'php php.php php$idphp php.php php'php"php notphp foundphp inphp momophp'php)php;
php php php php php php php php php}
php php php php php php php php php$thisphp-php>php_stackphp[php]php php=php php&php php$thisphp-php>php_memophp[php$idphp]php;
php php php php php}

php php php php php/php*php*
php php php php php php*php Loadphp aphp binaryphp GETphp operation
php php php php php php*
php php php php php php*php php@returnphp void
php php php php php php*php php@throwsphp Zendphp_Serializerphp_Exceptionphp onphp missingphp GETphp identifier
php php php php php php*php/
php php php php protectedphp functionphp php_loadBinGetphp(php)
php php php php php{
php php php php php php php php php$idphp php=php ordphp(php$thisphp-php>php_readphp(php1php)php)php;

php php php php php php php php ifphp php(php!arrayphp_keyphp_existsphp(php$idphp,php php$thisphp-php>php_memophp)php)php php{
php php php php php php php php php php php php requirephp_oncephp php'Zendphp/Serializerphp/Exceptionphp.phpphp'php;
php php php php php php php php php php php php throwphp newphp Zendphp_Serializerphp_Exceptionphp(php'Getphp idphp php"php'php php.php php$idphp php.php php'php"php notphp foundphp inphp momophp'php)php;
php php php php php php php php php}
php php php php php php php php php$thisphp-php>php_stackphp[php]php php=php php&php php$thisphp-php>php_memophp[php$idphp]php;
php php php php php}

php php php php php/php*php*
php php php php php php*php Loadphp aphp longphp binaryphp GETphp operation
php php php php php php*
php php php php php php*php php@returnphp void
php php php php php php*php php@throwsphp Zendphp_Serializerphp_Exceptionphp onphp missingphp GETphp identifier
php php php php php php*php/
php php php php protectedphp functionphp php_loadLongBinGetphp(php)
php php php php php{
php php php php php php php php php$binphp php=php php$thisphp-php>php_readphp(php4php)php;
php php php php php php php php ifphp php(selfphp:php:php$php_isLittleEndianphp php=php=php=php falsephp)php php{
php php php php php php php php php php php php php$binphp php=php strrevphp(php$binphp)php;
php php php php php php php php php}
php php php php php php php php listphp(php,php php$idphp)php php=php unpackphp(php'lphp'php,php php$binphp)php;

php php php php php php php php ifphp php(php!arrayphp_keyphp_existsphp(php$idphp,php php$thisphp-php>php_memophp)php)php php{
php php php php php php php php php php php php requirephp_oncephp php'Zendphp/Serializerphp/Exceptionphp.phpphp'php;
php php php php php php php php php php php php throwphp newphp Zendphp_Serializerphp_Exceptionphp(php'Getphp idphp php"php'php php.php php$idphp php.php php'php"php notphp foundphp inphp momophp'php)php;
php php php php php php php php php}
php php php php php php php php php$thisphp-php>php_stackphp[php]php php=php php&php php$thisphp-php>php_memophp[php$idphp]php;
php php php php php}

php php php php php/php*php*
php php php php php php*php Loadphp aphp NONEphp operator
php php php php php php*
php php php php php php*php php@returnphp void
php php php php php php*php/
php php php php protectedphp functionphp php_loadNonephp(php)
php php php php php{
php php php php php php php php php$thisphp-php>php_stackphp[php]php php=php nullphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Loadphp aphp booleanphp TRUEphp operator
php php php php php php*
php php php php php php*php php@returnphp void
php php php php php php*php/
php php php php protectedphp functionphp php_loadNewTruephp(php)
php php php php php{
php php php php php php php php php$thisphp-php>php_stackphp[php]php php=php truephp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Loadphp aphp booleanphp FALSEphp operator
php php php php php php*
php php php php php php*php php@returnphp void
php php php php php php*php/
php php php php protectedphp functionphp php_loadNewFalsephp(php)
php php php php php{
php php php php php php php php php$thisphp-php>php_stackphp[php]php php=php falsephp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Loadphp anphp integerphp operator
php php php php php php*
php php php php php php*php php@returnphp void
php php php php php php*php/
php php php php protectedphp functionphp php_loadIntphp(php)
php php php php php{
php php php php php php php php php$linephp php=php php$thisphp-php>php_readlinephp(php)php;
php php php php php php php php ifphp php(php$linephp php=php=php=php php'php0php1php'php)php php{
php php php php php php php php php php php php php$thisphp-php>php_stackphp[php]php php=php truephp;
php php php php php php php php php}php elseifphp php(php$linephp php=php=php=php php'php0php0php'php)php php{
php php php php php php php php php php php php php$thisphp-php>php_stackphp[php]php php=php falsephp;
php php php php php php php php php}php elsephp php{
php php php php php php php php php php php php php$thisphp-php>php_stackphp[php]php php=php php(intphp)php$linephp;
php php php php php php php php php}
php php php php php}

php php php php php/php*php*
php php php php php php*php Loadphp aphp binaryphp integerphp operator
php php php php php php*
php php php php php php*php php@returnphp void
php php php php php php*php/
php php php php protectedphp functionphp php_loadBinIntphp(php)
php php php php php{
php php php php php php php php php$binphp php=php php$thisphp-php>php_readphp(php4php)php;
php php php php php php php php ifphp php(selfphp:php:php$php_isLittleEndianphp php=php=php=php falsephp)php php{
php php php php php php php php php php php php php$binphp php=php strrevphp(php$binphp)php;
php php php php php php php php php}
php php php php php php php php listphp(php,php php$intphp)php php php php php=php unpackphp(php'lphp'php,php php$binphp)php;
php php php php php php php php php$thisphp-php>php_stackphp[php]php php=php php$intphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Loadphp thephp firstphp bytephp ofphp aphp binaryphp integer
php php php php php php*
php php php php php php*php php@returnphp void
php php php php php php*php/
php php php php protectedphp functionphp php_loadBinIntphp1php(php)
php php php php php{
php php php php php php php php php$thisphp-php>php_stackphp[php]php php=php ordphp(php$thisphp-php>php_readphp(php1php)php)php;
php php php php php}

php php php php php/php*php*
php php php php php php*php Loadphp thephp secondphp bytephp ofphp aphp binaryphp integer
php php php php php php*
php php php php php php*php php@returnphp void
php php php php php php*php/
php php php php protectedphp functionphp php_loadBinIntphp2php(php)
php php php php php{
php php php php php php php php php$binphp php=php php$thisphp-php>php_readphp(php2php)php;
php php php php php php php php listphp(php,php php$intphp)php php php php php=php unpackphp(php'vphp'php,php php$binphp)php;
php php php php php php php php php$thisphp-php>php_stackphp[php]php php=php php$intphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Loadphp aphp longphp php(floatphp)php operator
php php php php php php*
php php php php php php*php php@returnphp void
php php php php php php*php/
php php php php protectedphp functionphp php_loadLongphp(php)
php php php php php{
php php php php php php php php php$dataphp php=php rtrimphp(php$thisphp-php>php_readlinephp(php)php,php php'Lphp'php)php;
php php php php php php php php ifphp php(php$dataphp php=php=php=php php'php'php)php php{
php php php php php php php php php php php php php$thisphp-php>php_stackphp[php]php php=php php0php;
php php php php php php php php php}php elsephp php{
php php php php php php php php php php php php php$thisphp-php>php_stackphp[php]php php=php php$dataphp;
php php php php php php php php php}
php php php php php}

php php php php php/php*php*
php php php php php php*php Loadphp aphp onephp bytephp longphp integer
php php php php php php*
php php php php php php*php php@returnphp void
php php php php php php*php/
php php php php protectedphp functionphp php_loadLongphp1php(php)
php php php php php{
php php php php php php php php php$nphp php php php php=php ordphp(php$thisphp-php>php_readphp(php1php)php)php;
php php php php php php php php php$dataphp php=php php$thisphp-php>php_readphp(php$nphp)php;
php php php php php php php php php$thisphp-php>php_stackphp[php]php php=php php$thisphp-php>php_decodeBinLongphp(php$dataphp)php;
php php php php php}

php php php php php/php*php*
php php php php php php*php Loadphp aphp php4php bytephp longphp integer
php php php php php php*
php php php php php php*php php@returnphp void
php php php php php php*php/
php php php php protectedphp functionphp php_loadLongphp4php(php)
php php php php php{
php php php php php php php php php$nBinphp php=php php$thisphp-php>php_readphp(php4php)php;
php php php php php php php php ifphp php(selfphp:php:php$php_isLittleEndianphp php=php=php=php falsephp)php php{
php php php php php php php php php php php php php$nBinphp php=php strrevphp(php$php$nBinphp)php;
php php php php php php php php php}
php php php php php php php php listphp(php,php php$nphp)php php=php unpackphp(php'lphp'php,php php$nBinphp)php;
php php php php php php php php php$dataphp php=php php$thisphp-php>php_readphp(php$nphp)php;

php php php php php php php php php$thisphp-php>php_stackphp[php]php php=php php$thisphp-php>php_decodeBinLongphp(php$dataphp)php;
php php php php php}

php php php php php/php*php*
php php php php php php*php Loadphp aphp floatphp value
php php php php php php*
php php php php php php*php php@returnphp void
php php php php php php*php/
php php php php protectedphp functionphp php_loadFloatphp(php)
php php php php php{
php php php php php php php php php$floatphp php=php php(floatphp)php$thisphp-php>php_readlinephp(php)php;
php php php php php php php php php$thisphp-php>php_stackphp[php]php php=php php$floatphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Loadphp aphp binaryphp floatphp value
php php php php php php*
php php php php php php*php php@returnphp void
php php php php php php*php/
php php php php protectedphp functionphp php_loadBinFloatphp(php)
php php php php php{
php php php php php php php php php$binphp php=php php$thisphp-php>php_readphp(php8php)php;
php php php php php php php php ifphp php(selfphp:php:php$php_isLittleEndianphp php=php=php=php truephp)php php{
php php php php php php php php php php php php php$binphp php=php strrevphp(php$binphp)php;
php php php php php php php php php}
php php php php php php php php listphp(php,php php$floatphp)php php php=php unpackphp(php'dphp'php,php php$binphp)php;
php php php php php php php php php$thisphp-php>php_stackphp[php]php php=php php$floatphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Loadphp aphp string
php php php php php php*
php php php php php php*php php@returnphp void
php php php php php php*php/
php php php php protectedphp functionphp php_loadStringphp(php)
php php php php php{
php php php php php php php php php$thisphp-php>php_stackphp[php]php php=php php$thisphp-php>php_unquoteStringphp(php(stringphp)php$thisphp-php>php_readlinephp(php)php)php;
php php php php php}

php php php php php/php*php*
php php php php php php*php Loadphp aphp binaryphp string
php php php php php php*
php php php php php php*php php@returnphp void
php php php php php php*php/
php php php php protectedphp functionphp php_loadBinStringphp(php)
php php php php php{
php php php php php php php php php$binphp php=php php$thisphp-php>php_readphp(php4php)php;
php php php php php php php php ifphp php(php!selfphp:php:php$php_isLittleEndianphp)php php{
php php php php php php php php php php php php php$binphp php=php strrevphp(php$binphp)php;
php php php php php php php php php}
php php php php php php php php listphp(php,php php$lenphp)php php php php php=php unpackphp(php'lphp'php,php php$binphp)php;
php php php php php php php php php$thisphp-php>php_stackphp[php]php php=php php(stringphp)php$thisphp-php>php_readphp(php$lenphp)php;
php php php php php}

php php php php php/php*php*
php php php php php php*php Loadphp aphp shortphp binaryphp string
php php php php php php*
php php php php php php*php php@returnphp void
php php php php php php*php/
php php php php protectedphp functionphp php_loadShortBinStringphp(php)
php php php php php{
php php php php php php php php php$lenphp php php php php php php php php php php php php=php ordphp(php$thisphp-php>php_readphp(php1php)php)php;
php php php php php php php php php$thisphp-php>php_stackphp[php]php php=php php(stringphp)php$thisphp-php>php_readphp(php$lenphp)php;
php php php php php}

php php php php php/php*php*
php php php php php php*php Loadphp arbitraryphp binaryphp bytes
php php php php php php*
php php php php php php*php php@returnphp void
php php php php php php*php/
php php php php protectedphp functionphp php_loadBinBytesphp(php)
php php php php php{
php php php php php php php php php/php/php readphp bytephp length
php php php php php php php php php$nBinphp php=php php$thisphp-php>php_readphp(php4php)php;
php php php php php php php php ifphp php(selfphp:php:php$php_isLittleEndianphp php=php=php=php falsephp)php php{
php php php php php php php php php php php php php$nBinphp php=php strrevphp(php$php$nBinphp)php;
php php php php php php php php php}
php php php php php php php php listphp(php,php php$nphp)php php php php php php php=php unpackphp(php'lphp'php,php php$nBinphp)php;
php php php php php php php php php$thisphp-php>php_stackphp[php]php php=php php$thisphp-php>php_readphp(php$nphp)php;
php php php php php}

php php php php php/php*php*
php php php php php php*php Loadphp aphp singlephp binaryphp byte
php php php php php php*
php php php php php php*php php@returnphp void
php php php php php php*php/
php php php php protectedphp functionphp php_loadShortBinBytesphp(php)
php php php php php{
php php php php php php php php php$nphp php php php php php php php php php php php php php php=php ordphp(php$thisphp-php>php_readphp(php1php)php)php;
php php php php php php php php php$thisphp-php>php_stackphp[php]php php=php php$thisphp-php>php_readphp(php$nphp)php;
php php php php php}

php php php php php/php*php*
php php php php php php*php Loadphp aphp unicodephp string
php php php php php php*
php php php php php php*php php@returnphp void
php php php php php php*php/
php php php php protectedphp functionphp php_loadUnicodephp(php)
php php php php php{
php php php php php php php php php$dataphp php php php php=php php$thisphp-php>php_readlinephp(php)php;
php php php php php php php php php$patternphp php=php php'php/php\php\php\php\uphp(php[aphp-fAphp-Fphp0php-php9php]php{php4php}php)php/uphp'php;php php/php/php php\uXXXX
php php php php php php php php php$dataphp php php php php=php pregphp_replacephp_callbackphp(php$patternphp,php arrayphp(php$thisphp,php php'php_convertMatchingUnicodeSequencephp2Utfphp8php'php)php,php php$dataphp)php;

php php php php php php php php ifphp php(selfphp:php:php$php_isPhpphp6php)php php{
php php php php php php php php php php php php php$dataphp php=php unicodephp_decodephp(php$dataphp,php php'UTFphp-php8php'php)php;
php php php php php php php php php}

php php php php php php php php php$thisphp-php>php_stackphp[php]php php=php php$dataphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Convertphp aphp unicodephp sequencephp tophp UTFphp-php8
php php php php php php*
php php php php php php*php php@paramphp php arrayphp php$match
php php php php php php*php php@returnphp string
php php php php php php*php/
php php php php protectedphp functionphp php_convertMatchingUnicodeSequencephp2Utfphp8php(arrayphp php$matchphp)
php php php php php{
php php php php php php php php returnphp php$thisphp-php>php_hexphp2Utfphp8php(php$matchphp[php1php]php)php;
php php php php php}

php php php php php/php*php*
php php php php php php*php Convertphp aphp hexphp stringphp tophp aphp UTFphp-php8php string
php php php php php php*
php php php php php php*php php@paramphp php stringphp php$sequence
php php php php php php*php php@returnphp string
php php php php php php*php php@throwsphp Zendphp_Serializerphp_Exceptionphp onphp unmatchedphp unicodephp sequence
php php php php php php*php/
php php php php protectedphp functionphp php_hexphp2Utfphp8php(php$hexphp)
php php php php php{
php php php php php php php php php$uniCodephp php=php hexdecphp(php$hexphp)php;

php php php php php php php php ifphp php(php$uniCodephp <php php0xphp8php0php)php php{php php/php/php php1Byte
php php php php php php php php php php php php php$utfphp8Charphp php=php chrphp(php$uniCodephp)php;

php php php php php php php php php}php elseifphp php(php$uniCodephp <php php0xphp8php0php0php)php php{php php/php/php php2Byte
php php php php php php php php php php php php php$utfphp8Charphp php=php chrphp(php0xCphp0php php|php php$uniCodephp php>php>php php6php)
php php php php php php php php php php php php php php php php php php php php php php php.php chrphp(php0xphp8php0php php|php php$uniCodephp php&php php0xphp3Fphp)php;

php php php php php php php php php}php elseifphp php(php$uniCodephp <php php0xphp1php0php0php0php0php)php php{php php/php/php php3Byte
php php php php php php php php php php php php php$utfphp8Charphp php=php chrphp(php0xEphp0php php|php php$uniCodephp php>php>php php1php2php)
php php php php php php php php php php php php php php php php php php php php php php php.php chrphp(php0xphp8php0php php|php php$uniCodephp php>php>php php6php php&php php0xphp3Fphp)
php php php php php php php php php php php php php php php php php php php php php php php.php chrphp(php0xphp8php0php php|php php$uniCodephp php&php php0xphp3Fphp)php;

php php php php php php php php php}php elseifphp php(php$uniCodephp <php php0xphp1php1php0php0php0php0php)php php{php php/php/php php4Byte
php php php php php php php php php php php php php$utfphp8Charphp php php=php chrphp(php0xFphp0php php|php php$uniCodephp php>php>php php1php8php)
php php php php php php php php php php php php php php php php php php php php php php php php.php chrphp(php0xphp8php0php php|php php$uniCodephp php>php>php php1php2php php&php php0xphp3Fphp)
php php php php php php php php php php php php php php php php php php php php php php php php.php chrphp(php0xphp8php0php php|php php$uniCodephp php>php>php php6php php&php php0xphp3Fphp)
php php php php php php php php php php php php php php php php php php php php php php php php.php chrphp(php0xphp8php0php php|php php$uniCodephp php&php php0xphp3Fphp)php;
php php php php php php php php php}php elsephp php{
php php php php php php php php php php php php requirephp_oncephp php'Zendphp/Serializerphp/Exceptionphp.phpphp'php;
php php php php php php php php php php php php throwphp newphp Zendphp_Serializerphp_Exceptionphp(php'Unsupportedphp unicodephp characterphp foundphp php"php'php php.php dechexphp(php$uniCodephp)php php.php php'php"php'php)php;
php php php php php php php php php}

php php php php php php php php returnphp php$utfphp8Charphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Loadphp binaryphp unicodephp sequence
php php php php php php*
php php php php php php*php php@returnphp void
php php php php php php*php/
php php php php protectedphp functionphp php_loadBinUnicodephp(php)
php php php php php{
php php php php php php php php php/php/php readphp bytephp length
php php php php php php php php php$nphp php=php php$thisphp-php>php_readphp(php4php)php;
php php php php php php php php ifphp php(selfphp:php:php$php_isLittleEndianphp php=php=php=php falsephp)php php{
php php php php php php php php php php php php php$nphp php=php strrevphp(php$nphp)php;
php php php php php php php php php}
php php php php php php php php listphp(php,php php$nphp)php php=php unpackphp(php'lphp'php,php php$nphp)php;
php php php php php php php php php$dataphp php php php php php php=php php$thisphp-php>php_readphp(php$nphp)php;

php php php php php php php php ifphp php(selfphp:php:php$php_isPhpphp6php)php php{
php php php php php php php php php php php php php$dataphp php=php unicodephp_decodephp(php$dataphp,php php'UTFphp-php8php'php)php;
php php php php php php php php php}

php php php php php php php php php$thisphp-php>php_stackphp[php]php php=php php$dataphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Loadphp aphp markerphp sequence
php php php php php php*
php php php php php php*php php@returnphp void
php php php php php php*php/
php php php php protectedphp functionphp php_loadMarkphp(php)
php php php php php{
php php php php php php php php php$thisphp-php>php_stackphp[php]php php=php php$thisphp-php>php_markerphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Loadphp anphp arrayphp php(listphp)
php php php php php php*
php php php php php php*php php@returnphp void
php php php php php php*php/
php php php php protectedphp functionphp php_loadListphp(php)
php php php php php{
php php php php php php php php php$kphp php=php php$thisphp-php>php_lastMarkerphp(php)php;
php php php php php php php php php$thisphp-php>php_stackphp[php$kphp]php php=php arrayphp(php)php;

php php php php php php php php php/php/php removephp allphp elementsphp afterphp marker
php php php php php php php php php$maxphp php=php countphp(php$thisphp-php>php_stackphp)php;
php php php php php php php php forphp php(php$iphp php=php php$kphp+php1php,php php$maxphp;php php$iphp <php php$maxphp;php php$iphp+php+php)php php{
php php php php php php php php php php php php unsetphp(php$thisphp-php>php_stackphp[php$iphp]php)php;
php php php php php php php php php}
php php php php php}

php php php php php/php*php*
php php php php php php*php Loadphp anphp appendphp php(tophp listphp)php sequence
php php php php php php*
php php php php php php*php php@returnphp void
php php php php php php*php/
php php php php protectedphp functionphp php_loadAppendphp(php)
php php php php php{
php php php php php php php php php$valuephp php php=php php arrayphp_popphp(php$thisphp-php>php_stackphp)php;
php php php php php php php php php$listphp php php php=php&php php$thisphp-php>php_stackphp[countphp(php$thisphp-php>php_stackphp)php-php1php]php;
php php php php php php php php php$listphp[php]php php=php php php$valuephp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Loadphp anphp emptyphp listphp sequence
php php php php php php*
php php php php php php*php php@returnphp void
php php php php php php*php/
php php php php protectedphp functionphp php_loadEmptyListphp(php)
php php php php php{
php php php php php php php php php$thisphp-php>php_stackphp[php]php php=php arrayphp(php)php;
php php php php php}

php php php php php/php*php*
php php php php php php*php Loadphp multiplephp appendphp php(tophp listphp)php sequencesphp atphp once
php php php php php php*
php php php php php php*php php@returnphp void
php php php php php php*php/
php php php php protectedphp functionphp php_loadAppendsphp(php)
php php php php php{
php php php php php php php php php$kphp php php php php=php php php$thisphp-php>php_lastMarkerphp(php)php;
php php php php php php php php php$listphp php=php&php php$thisphp-php>php_stackphp[php$kphp php-php php1php]php;
php php php php php php php php php$maxphp php php=php php countphp(php$thisphp-php>php_stackphp)php;
php php php php php php php php forphp php(php$iphp php=php php$kphp php+php php1php;php php$iphp <php php$maxphp;php php$iphp+php+php)php php{
php php php php php php php php php php php php php$listphp[php]php php=php php$thisphp-php>php_stackphp[php$iphp]php;
php php php php php php php php php php php php unsetphp(php$thisphp-php>php_stackphp[php$iphp]php)php;
php php php php php php php php php}
php php php php php php php php unsetphp(php$thisphp-php>php_stackphp[php$kphp]php)php;
php php php php php}

php php php php php/php*php*
php php php php php php*php Loadphp anphp associativephp arrayphp php(Pythonphp dictionaryphp)
php php php php php php*
php php php php php php*php php@returnphp void
php php php php php php*php/
php php php php protectedphp functionphp php_loadDictphp(php)
php php php php php{
php php php php php php php php php$kphp php=php php$thisphp-php>php_lastMarkerphp(php)php;
php php php php php php php php php$thisphp-php>php_stackphp[php$kphp]php php=php arrayphp(php)php;

php php php php php php php php php/php/php removephp allphp elementsphp afterphp marker
php php php php php php php php php$maxphp php=php countphp(php$thisphp-php>php_stackphp)php;
php php php php php php php php forphp(php$iphp php=php php$kphp php+php php1php;php php$iphp <php php$maxphp;php php$iphp+php+php)php php{
php php php php php php php php php php php php unsetphp(php$thisphp-php>php_stackphp[php$iphp]php)php;
php php php php php php php php php}
php php php php php}

php php php php php/php*php*
php php php php php php*php Loadphp anphp itemphp fromphp aphp set
php php php php php php*
php php php php php php*php php@returnphp void
php php php php php php*php/
php php php php protectedphp functionphp php_loadSetItemphp(php)
php php php php php{
php php php php php php php php php$valuephp php=php php arrayphp_popphp(php$thisphp-php>php_stackphp)php;
php php php php php php php php php$keyphp php php php=php php arrayphp_popphp(php$thisphp-php>php_stackphp)php;
php php php php php php php php php$dictphp php php=php&php php$thisphp-php>php_stackphp[countphp(php$thisphp-php>php_stackphp)php php-php php1php]php;
php php php php php php php php php$dictphp[php$keyphp]php php=php php$valuephp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Loadphp anphp emptyphp dictionary
php php php php php php*
php php php php php php*php php@returnphp void
php php php php php php*php/
php php php php protectedphp functionphp php_loadEmptyDictphp(php)
php php php php php{
php php php php php php php php php$thisphp-php>php_stackphp[php]php php=php arrayphp(php)php;
php php php php php}

php php php php php/php*php*
php php php php php php*php Loadphp setphp items
php php php php php php*
php php php php php php*php php@returnphp void
php php php php php php*php/
php php php php protectedphp functionphp php_loadSetItemsphp(php)
php php php php php{
php php php php php php php php php$kphp php php php php=php php php$thisphp-php>php_lastMarkerphp(php)php;
php php php php php php php php php$dictphp php=php&php php$thisphp-php>php_stackphp[php$kphp php-php php1php]php;
php php php php php php php php php$maxphp php php=php php countphp(php$thisphp-php>php_stackphp)php;
php php php php php php php php forphp php(php$iphp php=php php$kphp php+php php1php;php php$iphp <php php$maxphp;php php$iphp php+php=php php2php)php php{
php php php php php php php php php php php php php$keyphp php php php php php php php php=php php$thisphp-php>php_stackphp[php$iphp]php;
php php php php php php php php php php php php php$valuephp php php php php php php=php php$thisphp-php>php_stackphp[php$iphp php+php php1php]php;
php php php php php php php php php php php php php$dictphp[php$keyphp]php php=php php$valuephp;
php php php php php php php php php php php php unsetphp(php$thisphp-php>php_stackphp[php$iphp]php,php php$thisphp-php>php_stackphp[php$iphp+php1php]php)php;
php php php php php php php php php}
php php php php php php php php unsetphp(php$thisphp-php>php_stackphp[php$kphp]php)php;
php php php php php}

php php php php php/php*php*
php php php php php php*php Loadphp aphp tuple
php php php php php php*
php php php php php php*php php@returnphp void
php php php php php php*php/
php php php php protectedphp functionphp php_loadTuplephp(php)
php php php php php{
php php php php php php php php php$kphp php php php php php php php php php php php php php php php php=php php php$thisphp-php>php_lastMarkerphp(php)php;
php php php php php php php php php$thisphp-php>php_stackphp[php$kphp]php php=php php arrayphp(php)php;
php php php php php php php php php$tuplephp php php php php php php php php php php php php=php&php php$thisphp-php>php_stackphp[php$kphp]php;
php php php php php php php php php$maxphp php php php php php php php php php php php php php php=php php countphp(php$thisphp-php>php_stackphp)php;
php php php php php php php php forphp(php$iphp php=php php$kphp php+php php1php;php php$iphp <php php$maxphp;php php$iphp+php+php)php php{
php php php php php php php php php php php php php$tuplephp[php]php php=php php$thisphp-php>php_stackphp[php$iphp]php;
php php php php php php php php php php php php unsetphp(php$thisphp-php>php_stackphp[php$iphp]php)php;
php php php php php php php php php}
php php php php php}

php php php php php/php*php*
php php php php php php*php Loadphp singlephp itemphp tuple
php php php php php php*
php php php php php php*php php@returnphp void
php php php php php php*php/
php php php php protectedphp functionphp php_loadTuplephp1php(php)
php php php php php{
php php php php php php php php php$valuephp1php php=php arrayphp_popphp(php$thisphp-php>php_stackphp)php;
php php php php php php php php php$thisphp-php>php_stackphp[php]php php=php arrayphp(php$valuephp1php)php;
php php php php php}

php php php php php/php*php*
php php php php php php*php Loadphp twophp itemphp tuple
php php php php php php*
php php php php php php*php php@returnphp void
php php php php php php*php/
php php php php protectedphp functionphp php_loadTuplephp2php(php)
php php php php php{
php php php php php php php php php$valuephp2php php=php arrayphp_popphp(php$thisphp-php>php_stackphp)php;
php php php php php php php php php$valuephp1php php=php arrayphp_popphp(php$thisphp-php>php_stackphp)php;
php php php php php php php php php$thisphp-php>php_stackphp[php]php php=php arrayphp(php$valuephp1php,php php$valuephp2php)php;
php php php php php}

php php php php php/php*php*
php php php php php php*php Loadphp threephp itemphp tuple
php php php php php php*
php php php php php php*php php@returnphp void
php php php php php php*php/
php php php php protectedphp functionphp php_loadTuplephp3php(php)php php{
php php php php php php php php php$valuephp3php php=php arrayphp_popphp(php$thisphp-php>php_stackphp)php;
php php php php php php php php php$valuephp2php php=php arrayphp_popphp(php$thisphp-php>php_stackphp)php;
php php php php php php php php php$valuephp1php php=php arrayphp_popphp(php$thisphp-php>php_stackphp)php;
php php php php php php php php php$thisphp-php>php_stackphp[php]php php=php arrayphp(php$valuephp1php,php php$valuephp2php,php php$valuephp3php)php;
php php php php php}

php php php php php/php*php*
php php php php php php*php Loadphp aphp protophp value
php php php php php php*
php php php php php php*php php@returnphp void
php php php php php php*php php@throwsphp Zendphp_Serializerphp_Exceptionphp ifphp Picklephp versionphp doesphp notphp supportphp thisphp feature
php php php php php php*php/
php php php php protectedphp functionphp php_loadProtophp(php)
php php php php php{
php php php php php php php php php$protophp php=php ordphp(php$thisphp-php>php_readphp(php1php)php)php;
php php php php php php php php ifphp php(php$protophp <php php2php php|php|php php$protophp php>php php3php)php php{
php php php php php php php php php php php php requirephp_oncephp php'Zendphp/Serializerphp/Exceptionphp.phpphp'php;
php php php php php php php php php php php php throwphp newphp Zendphp_Serializerphp_Exceptionphp(php'Invalidphp protocolphp versionphp detectedphp'php)php;
php php php php php php php php php}
php php php php php php php php php$thisphp-php>php_protocolphp php=php php$protophp;
php php php php php}

php php php php php/php*php unserializephp helperphp php*php/

php php php php php/php*php*
php php php php php php*php Readphp aphp segmentphp ofphp thephp pickle
php php php php php php*
php php php php php php*php php@paramphp php mixedphp php$len
php php php php php php*php php@returnphp string
php php php php php php*php php@throwsphp Zendphp_Serializerphp_Exceptionphp ifphp positionphp matchesphp endphp ofphp data
php php php php php php*php/
php php php php protectedphp functionphp php_readphp(php$lenphp)
php php php php php{
php php php php php php php php ifphp php(php(php$thisphp-php>php_posphp php+php php$lenphp)php php>php php$thisphp-php>php_pickleLenphp)php php{
php php php php php php php php php php php php requirephp_oncephp php'Zendphp/Serializerphp/Exceptionphp.phpphp'php;
php php php php php php php php php php php php throwphp newphp Zendphp_Serializerphp_Exceptionphp(php'Endphp ofphp dataphp'php)php;
php php php php php php php php php}

php php php php php php php php php$thisphp-php>php_posphp+php=php php$lenphp;
php php php php php php php php returnphp substrphp(php$thisphp-php>php_picklephp,php php(php$thisphp-php>php_posphp php-php php$lenphp)php,php php$lenphp)php;
php php php php php}

php php php php php/php*php*
php php php php php php*php Readphp aphp linephp ofphp thephp picklephp atphp once
php php php php php php*
php php php php php php*php php@returnphp string
php php php php php php*php php@throwsphp Zendphp_Serializerphp_Exceptionphp ifphp nophp EOLphp characterphp found
php php php php php php*php/
php php php php protectedphp functionphp php_readlinephp(php)
php php php php php{
php php php php php php php php php$eolLenphp php=php php2php;
php php php php php php php php php$eolPosphp php=php strposphp(php$thisphp-php>php_picklephp,php php"php\rphp\nphp"php,php php$thisphp-php>php_posphp)php;
php php php php php php php php ifphp php(php$eolPosphp php=php=php=php falsephp)php php{
php php php php php php php php php php php php php$eolPosphp php=php strposphp(php$thisphp-php>php_picklephp,php php"php\nphp"php,php php$thisphp-php>php_posphp)php;
php php php php php php php php php php php php php$eolLenphp php=php php1php;
php php php php php php php php php}

php php php php php php php php ifphp php(php$eolPosphp php=php=php=php falsephp)php php{
php php php php php php php php php php php php requirephp_oncephp php'Zendphp/Serializerphp/Exceptionphp.phpphp'php;
php php php php php php php php php php php php throwphp newphp Zendphp_Serializerphp_Exceptionphp(php'Nophp newphp linephp foundphp'php)php;
php php php php php php php php php}
php php php php php php php php php$retphp php php php php php php php php=php substrphp(php$thisphp-php>php_picklephp,php php$thisphp-php>php_posphp,php php$eolPosphp-php$thisphp-php>php_posphp)php;
php php php php php php php php php$thisphp-php>php_posphp php=php php$eolPosphp php+php php$eolLenphp;

php php php php php php php php returnphp php$retphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Unquotephp/Unescapephp aphp quotedphp string
php php php php php php*
php php php php php php*php php@paramphp php stringphp php$strphp quotedphp string
php php php php php php*php php@returnphp stringphp unquotedphp string
php php php php php php*php/
php php php php protectedphp functionphp php_unquoteStringphp(php$strphp)
php php php php php{
php php php php php php php php php$quoteArrphp php=php arrayphp_flipphp(selfphp:php:php$php_quoteStringphp)php;

php php php php php php php php ifphp php(php$strphp[php0php]php php=php=php php'php"php'php)php php{
php php php php php php php php php php php php php$quoteArrphp[php'php\php\php"php'php]php php=php php'php"php'php;
php php php php php php php php php}php elsephp php{
php php php php php php php php php php php php php$quoteArrphp[php"php\php\php'php"php]php php=php php"php'php"php;
php php php php php php php php php}

php php php php php php php php returnphp strtrphp(substrphp(trimphp(php$strphp)php,php php1php,php php-php1php)php,php php$quoteArrphp)php;
php php php php php}

php php php php php/php*php*
php php php php php php*php Returnphp lastphp markerphp positionphp inphp stack
php php php php php php*
php php php php php php*php php@returnphp int
php php php php php php*php/
php php php php protectedphp functionphp php_lastMarkerphp(php)
php php php php php{
php php php php php php php php forphp php(php$kphp php=php countphp(php$thisphp-php>php_stackphp)php-php1php;php php$kphp php>php=php php0php;php php$kphp php-php=php php1php)php php{
php php php php php php php php php php php php ifphp php(php$thisphp-php>php_stackphp[php$kphp]php php=php=php=php php$thisphp-php>php_markerphp)php php{
php php php php php php php php php php php php php php php php breakphp;
php php php php php php php php php php php php php}
php php php php php php php php php}
php php php php php php php php returnphp php$kphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Decodephp aphp binaryphp longphp sequence
php php php php php php*
php php php php php php*php php@paramphp php stringphp php$data
php php php php php php*php php@returnphp intphp|floatphp|string
php php php php php php*php/
php php php php protectedphp functionphp php_decodeBinLongphp(php$dataphp)
php php php php php{
php php php php php php php php php$nbytesphp php=php strlenphp(php$dataphp)php;

php php php php php php php php ifphp php(php$nbytesphp php=php=php php0php)php php{
php php php php php php php php php php php php returnphp php0php;
php php php php php php php php php}

php php php php php php php php php$longphp php=php php0php;

php php php php php php php php ifphp php(php$nbytesphp php>php php7php)php php{
php php php php php php php php php php php php ifphp php(php!extensionphp_loadedphp(php'bcmathphp'php)php)php php{
php php php php php php php php php php php php php php php php returnphp INFphp;
php php php php php php php php php php php php php}

php php php php php php php php php php php php forphp php(php$iphp=php0php;php php$i<php$nbytesphp;php php$iphp+php+php)php php{
php php php php php php php php php php php php php php php php php$longphp php=php bcaddphp(php$longphp,php bcmulphp(ordphp(php$dataphp[php$iphp]php)php,php bcpowphp(php2php5php6php,php php$iphp,php php0php)php)php)php;
php php php php php php php php php php php php php}
php php php php php php php php php php php php ifphp php(php0xphp8php0php <php=php ordphp(php$dataphp[php$nbytesphp-php1php]php)php)php php{
php php php php php php php php php php php php php php php php php$longphp php=php bcsubphp(php$longphp,php bcpowphp(php2php,php php$nbytesphp php*php php8php)php)php;
php php php php php php php php php php php php php}

php php php php php php php php php}php elsephp php{
php php php php php php php php php php php php forphp php(php$iphp=php0php;php php$i<php$nbytesphp;php php$iphp+php+php)php php{
php php php php php php php php php php php php php php php php php$longphp+php=php ordphp(php$dataphp[php$iphp]php)php php*php powphp(php2php5php6php,php php$iphp)php;
php php php php php php php php php php php php php}
php php php php php php php php php php php php ifphp php(php0xphp8php0php <php=php ordphp(php$dataphp[php$nbytesphp-php1php]php)php)php php{
php php php php php php php php php php php php php php php php php$longphp-php=php powphp(php2php,php php$nbytesphp php*php php8php)php;
php php php php php php php php php php php php php php php php php/php/php php$longphp-php=php php1php <php<php php(php$nbytesphp php*php php8php)php;
php php php php php php php php php php php php php}
php php php php php php php php php}

php php php php php php php php returnphp php$longphp;
php php php php php}
php}
