<php?php
php/php*php*
php php*php Zendphp Framework
php php*
php php*php LICENSE
php php*
php php*php Thisphp sourcephp filephp isphp subjectphp tophp thephp newphp BSDphp licensephp thatphp isphp bundled
php php*php withphp thisphp packagephp inphp thephp filephp LICENSEphp.txtphp.
php php*php Itphp isphp alsophp availablephp throughphp thephp worldphp-widephp-webphp atphp thisphp URLphp:
php php*php httpphp:php/php/frameworkphp.zendphp.comphp/licensephp/newphp-bsd
php php*php Ifphp youphp didphp notphp receivephp aphp copyphp ofphp thephp licensephp andphp arephp unablephp to
php php*php obtainphp itphp throughphp thephp worldphp-widephp-webphp,php pleasephp sendphp anphp email
php php*php tophp licensephp@zendphp.comphp sophp wephp canphp sendphp youphp aphp copyphp immediatelyphp.
php php*
php php*php php@categoryphp php php Zend
php php*php php@packagephp php php php Zendphp_Server
php php*php php@copyrightphp php Copyrightphp php(cphp)php php2php0php0php5php-php2php0php1php0php Zendphp Technologiesphp USAphp Incphp.php php(httpphp:php/php/wwwphp.zendphp.comphp)
php php*php php@licensephp php php php httpphp:php/php/frameworkphp.zendphp.comphp/licensephp/newphp-bsdphp php php php php Newphp BSDphp License
php php*php/

php/php*php*
php php*php Zendphp_Serverphp_Reflectionphp_Node
php php*php/
requirephp_oncephp php'Zendphp/Serverphp/Reflectionphp/Nodephp.phpphp'php;

php/php*php*
php php*php Zendphp_Serverphp_Reflectionphp_Parameter
php php*php/
requirephp_oncephp php'Zendphp/Serverphp/Reflectionphp/Parameterphp.phpphp'php;

php/php*php*
php php*php Zendphp_Serverphp_Reflectionphp_Prototype
php php*php/
requirephp_oncephp php'Zendphp/Serverphp/Reflectionphp/Prototypephp.phpphp'php;

php/php*php*
php php*php Functionphp/Methodphp Reflection
php php*
php php*php Decoratesphp aphp ReflectionFunctionphp.php Allowsphp settingphp andphp retrievingphp anphp alternate
php php*php php'servicephp'php namephp php(iphp.ephp.php,php thephp namephp tophp bephp usedphp whenphp callingphp viaphp aphp servicephp)php,
php php*php settingphp andphp retrievingphp thephp descriptionphp php(originallyphp setphp usingphp thephp docblock
php php*php contentsphp)php,php retrievingphp thephp callbackphp andphp callbackphp typephp,php retrievingphp additional
php php*php methodphp invocationphp argumentsphp,php andphp retrievingphp the
php php*php methodphp php{php@linkphp Zendphp_Serverphp_Reflectionphp_Prototypephp prototypesphp}php.
php php*
php php*php php@categoryphp php php Zend
php php*php php@packagephp php php php Zendphp_Server
php php*php php@subpackagephp Reflection
php php*php php@copyrightphp php Copyrightphp php(cphp)php php2php0php0php5php-php2php0php1php0php Zendphp Technologiesphp USAphp Incphp.php php(httpphp:php/php/wwwphp.zendphp.comphp)
php php*php php@licensephp php php php httpphp:php/php/frameworkphp.zendphp.comphp/licensephp/newphp-bsdphp php php php php Newphp BSDphp License
php php*php php@versionphp php$Idphp:php Abstractphp.phpphp php2php3php3php2php0php php2php0php1php0php-php1php1php-php1php2php php2php1php:php5php7php:php2php9Zphp alexanderphp php$
php php*php/
abstractphp classphp Zendphp_Serverphp_Reflectionphp_Functionphp_Abstract
php{
php php php php php/php*php*
php php php php php php*php php@varphp ReflectionFunction
php php php php php php*php/
php php php php protectedphp php$php_reflectionphp;

php php php php php/php*php*
php php php php php php*php Additionalphp argumentsphp tophp passphp tophp methodphp onphp invocation
php php php php php php*php php@varphp array
php php php php php php*php/
php php php php protectedphp php$php_argvphp php=php arrayphp(php)php;

php php php php php/php*php*
php php php php php php*php Usedphp tophp storephp extraphp configurationphp forphp thephp methodphp php(typicallyphp donephp byphp the
php php php php php php*php serverphp classphp,php ephp.gphp.php,php tophp indicatephp whetherphp orphp notphp tophp instantiatephp aphp classphp)php.
php php php php php php*php Associativephp arrayphp;php accessphp isphp asphp propertiesphp viaphp php{php@linkphp php_php_getphp(php)php}php and
php php php php php php*php php{php@linkphp php_php_setphp(php)php}
php php php php php php*php php@varphp array
php php php php php php*php/
php php php php protectedphp php$php_configphp php=php arrayphp(php)php;

php php php php php/php*php*
php php php php php php*php Declaringphp classphp php(neededphp forphp whenphp serializationphp occursphp)
php php php php php php*php php@varphp string
php php php php php php*php/
php php php php protectedphp php$php_classphp;

php php php php php/php*php*
php php php php php php*php Functionphp/methodphp description
php php php php php php*php php@varphp string
php php php php php php*php/
php php php php protectedphp php$php_descriptionphp php=php php'php'php;

php php php php php/php*php*
php php php php php php*php Namespacephp withphp whichphp tophp prefixphp functionphp/methodphp name
php php php php php php*php php@varphp string
php php php php php php*php/
php php php php protectedphp php$php_namespacephp;

php php php php php/php*php*
php php php php php php*php Prototypes
php php php php php php*php php@varphp array
php php php php php php*php/
php php php php protectedphp php$php_prototypesphp php=php arrayphp(php)php;

php php php php privatephp php$php_returnphp;
php php php php privatephp php$php_returnDescphp;
php php php php privatephp php$php_paramDescphp;
php php php php privatephp php$php_sigParamsphp;
php php php php privatephp php$php_sigParamsDepthphp;

php php php php php/php*php*
php php php php php php*php Constructor
php php php php php php*
php php php php php php*php php@paramphp ReflectionFunctionphp php$r
php php php php php php*php/
php php php php publicphp functionphp php_php_constructphp(Reflectorphp php$rphp,php php$namespacephp php=php nullphp,php php$argvphp php=php arrayphp(php)php)
php php php php php{
php php php php php php php php php/php/php Inphp PHPphp php5php.php1php.xphp,php ReflectionMethodphp extendsphp ReflectionFunctionphp.php Inphp php5php.php2php.xphp,
php php php php php php php php php/php/php bothphp extendphp ReflectionFunctionAbstractphp.php Sophp,php wephp canphp'tphp dophp normalphp type
php php php php php php php php php/php/php hintingphp inphp thephp prototypephp,php butphp insteadphp needphp tophp dophp somephp explicit
php php php php php php php php php/php/php testingphp herephp.
php php php php php php php php ifphp php(php(php!php$rphp instanceofphp ReflectionFunctionphp)
php php php php php php php php php php php php php&php&php php(php!php$rphp instanceofphp ReflectionMethodphp)php)php php{
php php php php php php php php php php php php requirephp_oncephp php'Zendphp/Serverphp/Reflectionphp/Exceptionphp.phpphp'php;
php php php php php php php php php php php php throwphp newphp Zendphp_Serverphp_Reflectionphp_Exceptionphp(php'Invalidphp reflectionphp classphp'php)php;
php php php php php php php php php}
php php php php php php php php php$thisphp-php>php_reflectionphp php=php php$rphp;

php php php php php php php php php/php/php Determinephp namespace
php php php php php php php php ifphp php(nullphp php!php=php=php php$namespacephp)php{
php php php php php php php php php php php php php$thisphp-php>setNamespacephp(php$namespacephp)php;
php php php php php php php php php}

php php php php php php php php php/php/php Determinephp arguments
php php php php php php php php ifphp php(isphp_arrayphp(php$argvphp)php)php php{
php php php php php php php php php php php php php$thisphp-php>php_argvphp php=php php$argvphp;
php php php php php php php php php}

php php php php php php php php php/php/php Ifphp methodphp callphp,php needphp tophp storephp somephp infophp onphp thephp class
php php php php php php php php ifphp php(php$rphp instanceofphp ReflectionMethodphp)php php{
php php php php php php php php php php php php php$thisphp-php>php_classphp php=php php$rphp-php>getDeclaringClassphp(php)php-php>getNamephp(php)php;
php php php php php php php php php}

php php php php php php php php php/php/php Performphp somephp introspection
php php php php php php php php php$thisphp-php>php_reflectphp(php)php;
php php php php php}

php php php php php/php*php*
php php php php php php*php Createphp signaturephp nodephp tree
php php php php php php*
php php php php php php*php Recursivephp methodphp tophp buildphp thephp signaturephp nodephp treephp.php Incrementsphp through
php php php php php php*php eachphp arrayphp inphp php{php@linkphp php$php_sigParamsphp}php,php addingphp everyphp valuephp ofphp thephp nextphp level
php php php php php php*php tophp thephp currentphp valuephp php(unlessphp thephp currentphp valuephp isphp nullphp)php.
php php php php php php*
php php php php php php*php php@paramphp Zendphp_Serverphp_Reflectionphp_Nodephp php$parent
php php php php php php*php php@paramphp intphp php$level
php php php php php php*php php@returnphp void
php php php php php php*php/
php php php php protectedphp functionphp php_addTreephp(Zendphp_Serverphp_Reflectionphp_Nodephp php$parentphp,php php$levelphp php=php php0php)
php php php php php{
php php php php php php php php ifphp php(php$levelphp php>php=php php$thisphp-php>php_sigParamsDepthphp)php php{
php php php php php php php php php php php php returnphp;
php php php php php php php php php}

php php php php php php php php foreachphp php(php$thisphp-php>php_sigParamsphp[php$levelphp]php asphp php$valuephp)php php{
php php php php php php php php php php php php php$nodephp php=php newphp Zendphp_Serverphp_Reflectionphp_Nodephp(php$valuephp,php php$parentphp)php;
php php php php php php php php php php php php ifphp php(php(nullphp php!php=php=php php$valuephp)php php&php&php php(php$thisphp-php>php_sigParamsDepthphp php>php php$levelphp php+php php1php)php)php php{
php php php php php php php php php php php php php php php php php$thisphp-php>php_addTreephp(php$nodephp,php php$levelphp php+php php1php)php;
php php php php php php php php php php php php php}
php php php php php php php php php}
php php php php php}

php php php php php/php*php*
php php php php php php*php Buildphp thephp signaturephp tree
php php php php php php*
php php php php php php*php Buildsphp aphp signaturephp treephp startingphp atphp thephp returnphp valuesphp andphp descending
php php php php php php*php throughphp eachphp methodphp argumentphp.php Returnsphp anphp arrayphp of
php php php php php php*php php{php@linkphp Zendphp_Serverphp_Reflectionphp_Nodephp}sphp.
php php php php php php*
php php php php php php*php php@returnphp array
php php php php php php*php/
php php php php protectedphp functionphp php_buildTreephp(php)
php php php php php{
php php php php php php php php php$returnTreephp php=php arrayphp(php)php;
php php php php php php php php foreachphp php(php(arrayphp)php php$thisphp-php>php_returnphp asphp php$valuephp)php php{
php php php php php php php php php php php php php$nodephp php=php newphp Zendphp_Serverphp_Reflectionphp_Nodephp(php$valuephp)php;
php php php php php php php php php php php php php$thisphp-php>php_addTreephp(php$nodephp)php;
php php php php php php php php php php php php php$returnTreephp[php]php php=php php$nodephp;
php php php php php php php php php}

php php php php php php php php returnphp php$returnTreephp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Buildphp methodphp signatures
php php php php php php*
php php php php php php*php Buildsphp methodphp signaturesphp usingphp thephp arrayphp ofphp returnphp typesphp andphp thephp arrayphp of
php php php php php php*php parametersphp types
php php php php php php*
php php php php php php*php php@paramphp arrayphp php$returnphp Arrayphp ofphp returnphp types
php php php php php php*php php@paramphp stringphp php$returnDescphp Returnphp valuephp description
php php php php php php*php php@paramphp arrayphp php$paramsphp Arrayphp ofphp argumentsphp php(eachphp anphp arrayphp ofphp typesphp)
php php php php php php*php php@paramphp arrayphp php$paramDescphp Arrayphp ofphp parameterphp descriptions
php php php php php php*php php@returnphp array
php php php php php php*php/
php php php php protectedphp functionphp php_buildSignaturesphp(php$returnphp,php php$returnDescphp,php php$paramTypesphp,php php$paramDescphp)
php php php php php{
php php php php php php php php php$thisphp-php>php_returnphp php php php php php php php php php=php php$returnphp;
php php php php php php php php php$thisphp-php>php_returnDescphp php php php php php=php php$returnDescphp;
php php php php php php php php php$thisphp-php>php_paramDescphp php php php php php php=php php$paramDescphp;
php php php php php php php php php$thisphp-php>php_sigParamsphp php php php php php php=php php$paramTypesphp;
php php php php php php php php php$thisphp-php>php_sigParamsDepthphp php=php countphp(php$paramTypesphp)php;
php php php php php php php php php$signatureTreesphp php php php php php php php php=php php$thisphp-php>php_buildTreephp(php)php;
php php php php php php php php php$signaturesphp php php php php php php php php php php php php=php arrayphp(php)php;

php php php php php php php php php$endPointsphp php=php arrayphp(php)php;
php php php php php php php php foreachphp php(php$signatureTreesphp asphp php$rootphp)php php{
php php php php php php php php php php php php php$tmpphp php=php php$rootphp-php>getEndPointsphp(php)php;
php php php php php php php php php php php php ifphp php(emptyphp(php$tmpphp)php)php php{
php php php php php php php php php php php php php php php php php$endPointsphp php=php arrayphp_mergephp(php$endPointsphp,php arrayphp(php$rootphp)php)php;
php php php php php php php php php php php php php}php elsephp php{
php php php php php php php php php php php php php php php php php$endPointsphp php=php arrayphp_mergephp(php$endPointsphp,php php$tmpphp)php;
php php php php php php php php php php php php php}
php php php php php php php php php}

php php php php php php php php foreachphp php(php$endPointsphp asphp php$nodephp)php php{
php php php php php php php php php php php php ifphp php(php!php$nodephp instanceofphp Zendphp_Serverphp_Reflectionphp_Nodephp)php php{
php php php php php php php php php php php php php php php php continuephp;
php php php php php php php php php php php php php}

php php php php php php php php php php php php php$signaturephp php=php arrayphp(php)php;
php php php php php php php php php php php php dophp php{
php php php php php php php php php php php php php php php php arrayphp_unshiftphp(php$signaturephp,php php$nodephp-php>getValuephp(php)php)php;
php php php php php php php php php php php php php php php php php$nodephp php=php php$nodephp-php>getParentphp(php)php;
php php php php php php php php php php php php php}php whilephp php(php$nodephp instanceofphp Zendphp_Serverphp_Reflectionphp_Nodephp)php;

php php php php php php php php php php php php php$signaturesphp[php]php php=php php$signaturephp;
php php php php php php php php php}

php php php php php php php php php/php/php Buildphp prototypes
php php php php php php php php php$paramsphp php=php php$thisphp-php>php_reflectionphp-php>getParametersphp(php)php;
php php php php php php php php foreachphp php(php$signaturesphp asphp php$signaturephp)php php{
php php php php php php php php php php php php php$returnphp php=php newphp Zendphp_Serverphp_Reflectionphp_ReturnValuephp(arrayphp_shiftphp(php$signaturephp)php,php php$thisphp-php>php_returnDescphp)php;
php php php php php php php php php php php php php$tmpphp php php php php=php arrayphp(php)php;
php php php php php php php php php php php php foreachphp php(php$signaturephp asphp php$keyphp php=php>php php$typephp)php php{
php php php php php php php php php php php php php php php php php$paramphp php=php newphp Zendphp_Serverphp_Reflectionphp_Parameterphp(php$paramsphp[php$keyphp]php,php php$typephp,php php(issetphp(php$thisphp-php>php_paramDescphp[php$keyphp]php)php php?php php$thisphp-php>php_paramDescphp[php$keyphp]php php:php nullphp)php)php;
php php php php php php php php php php php php php php php php php$paramphp-php>setPositionphp(php$keyphp)php;
php php php php php php php php php php php php php php php php php$tmpphp[php]php php=php php$paramphp;
php php php php php php php php php php php php php}

php php php php php php php php php php php php php$thisphp-php>php_prototypesphp[php]php php=php newphp Zendphp_Serverphp_Reflectionphp_Prototypephp(php$returnphp,php php$tmpphp)php;
php php php php php php php php php}
php php php php php}

php php php php php/php*php*
php php php php php php*php Usephp codephp reflectionphp tophp createphp methodphp signatures
php php php php php php*
php php php php php php*php Determinesphp thephp methodphp helpphp/descriptionphp textphp fromphp thephp functionphp DocBlock
php php php php php php*php commentphp.php Determinesphp methodphp signaturesphp usingphp aphp combinationphp of
php php php php php php*php ReflectionFunctionphp andphp parsingphp ofphp DocBlockphp php@paramphp andphp php@returnphp valuesphp.
php php php php php php*
php php php php php php*php php@paramphp ReflectionFunctionphp php$function
php php php php php php*php php@returnphp array
php php php php php php*php/
php php php php protectedphp functionphp php_reflectphp(php)
php php php php php{
php php php php php php php php php$functionphp php php php php php php php php php php php=php php$thisphp-php>php_reflectionphp;
php php php php php php php php php$helpTextphp php php php php php php php php php php php=php php'php'php;
php php php php php php php php php$signaturesphp php php php php php php php php php=php arrayphp(php)php;
php php php php php php php php php$returnDescphp php php php php php php php php php=php php'php'php;
php php php php php php php php php$paramCountphp php php php php php php php php php=php php$functionphp-php>getNumberOfParametersphp(php)php;
php php php php php php php php php$paramCountRequiredphp php=php php$functionphp-php>getNumberOfRequiredParametersphp(php)php;
php php php php php php php php php$parametersphp php php php php php php php php php=php php$functionphp-php>getParametersphp(php)php;
php php php php php php php php php$docBlockphp php php php php php php php php php php php=php php$functionphp-php>getDocCommentphp(php)php;

php php php php php php php php ifphp php(php!emptyphp(php$docBlockphp)php)php php{
php php php php php php php php php php php php php/php/php Getphp helpphp text
php php php php php php php php php php php php ifphp php(pregphp_matchphp(php'php:php/php\php*php\php*php\sphp*php\rphp?php\nphp\sphp*php\php*php\sphp(php.php*php?php)php\rphp?php\nphp\sphp*php\php*php(php\sphp@php|php/php)php:sphp'php,php php$docBlockphp,php php$matchesphp)php)
php php php php php php php php php php php php php{
php php php php php php php php php php php php php php php php php$helpTextphp php=php php$matchesphp[php1php]php;
php php php php php php php php php php php php php php php php php$helpTextphp php=php pregphp_replacephp(php'php/php(php^php\sphp*php\php*php\sphp)php/mphp'php,php php'php'php,php php$helpTextphp)php;
php php php php php php php php php php php php php php php php php$helpTextphp php=php pregphp_replacephp(php'php/php\rphp?php\nphp\sphp*php\php*php\sphp*php(php\rphp?php\nphp)php*php/sphp'php,php php"php\nphp"php,php php$helpTextphp)php;
php php php php php php php php php php php php php php php php php$helpTextphp php=php trimphp(php$helpTextphp)php;
php php php php php php php php php php php php php}

php php php php php php php php php php php php php/php/php Getphp returnphp typephp(sphp)php andphp description
php php php php php php php php php php php php php$returnphp php php php php php=php php'voidphp'php;
php php php php php php php php php php php php ifphp php(pregphp_matchphp(php'php/php@returnphp\sphp+php(php\Sphp+php)php/php'php,php php$docBlockphp,php php$matchesphp)php)php php{
php php php php php php php php php php php php php php php php php$returnphp php=php explodephp(php'php|php'php,php php$matchesphp[php1php]php)php;
php php php php php php php php php php php php php php php php ifphp php(pregphp_matchphp(php'php/php@returnphp\sphp+php\Sphp+php\sphp+php(php.php*php?php)php(php@php|php\php*php\php/php)php/sphp'php,php php$docBlockphp,php php$matchesphp)php)
php php php php php php php php php php php php php php php php php{
php php php php php php php php php php php php php php php php php php php php php$valuephp php=php php$matchesphp[php1php]php;
php php php php php php php php php php php php php php php php php php php php php$valuephp php=php pregphp_replacephp(php'php/php\sphp?php\php*php\sphp/mphp'php,php php'php'php,php php$valuephp)php;
php php php php php php php php php php php php php php php php php php php php php$valuephp php=php pregphp_replacephp(php'php/php\sphp{php2php,php}php/php'php,php php'php php'php,php php$valuephp)php;
php php php php php php php php php php php php php php php php php php php php php$returnDescphp php=php trimphp(php$valuephp)php;
php php php php php php php php php php php php php php php php php}
php php php php php php php php php php php php php}

php php php php php php php php php php php php php/php/php Getphp paramphp typesphp andphp description
php php php php php php php php php php php php ifphp php(pregphp_matchphp_allphp(php'php/php@paramphp\sphp+php(php[php^php\sphp]php+php)php/mphp'php,php php$docBlockphp,php php$matchesphp)php)php php{
php php php php php php php php php php php php php php php php php$paramTypesTmpphp php=php php$matchesphp[php1php]php;
php php php php php php php php php php php php php php php php ifphp php(pregphp_matchphp_allphp(php'php/php@paramphp\sphp+php\Sphp+php\sphp+php(php\php$php\Sphp+php)php\sphp+php(php.php*php?php)php(php?php=php@php|php\php*php\php/php)php/sphp'php,php php$docBlockphp,php php$matchesphp)php)
php php php php php php php php php php php php php php php php php{
php php php php php php php php php php php php php php php php php php php php php$paramDescphp php=php php$matchesphp[php2php]php;
php php php php php php php php php php php php php php php php php php php php foreachphp php(php$paramDescphp asphp php$keyphp php=php>php php$valuephp)php php{
php php php php php php php php php php php php php php php php php php php php php php php php php$valuephp php=php pregphp_replacephp(php'php/php\sphp?php\php*php\sphp/mphp'php,php php'php'php,php php$valuephp)php;
php php php php php php php php php php php php php php php php php php php php php php php php php$valuephp php=php pregphp_replacephp(php'php/php\sphp{php2php,php}php/php'php,php php'php php'php,php php$valuephp)php;
php php php php php php php php php php php php php php php php php php php php php php php php php$paramDescphp[php$keyphp]php php=php trimphp(php$valuephp)php;
php php php php php php php php php php php php php php php php php php php php php}
php php php php php php php php php php php php php php php php php}
php php php php php php php php php php php php php}
php php php php php php php php php}php elsephp php{
php php php php php php php php php php php php php$helpTextphp php=php php$functionphp-php>getNamephp(php)php;
php php php php php php php php php php php php php$returnphp php php php=php php'voidphp'php;

php php php php php php php php php php php php php/php/php Tryphp andphp autophp-determinephp typephp,php basedphp onphp reflection
php php php php php php php php php php php php php$paramTypesTmpphp php=php arrayphp(php)php;
php php php php php php php php php php php php foreachphp php(php$parametersphp asphp php$iphp php=php>php php$paramphp)php php{
php php php php php php php php php php php php php php php php php$paramTypephp php=php php'mixedphp'php;
php php php php php php php php php php php php php php php php ifphp php(php$paramphp-php>isArrayphp(php)php)php php{
php php php php php php php php php php php php php php php php php php php php php$paramTypephp php=php php'arrayphp'php;
php php php php php php php php php php php php php php php php php}
php php php php php php php php php php php php php php php php php$paramTypesTmpphp[php$iphp]php php=php php$paramTypephp;
php php php php php php php php php php php php php}
php php php php php php php php php}

php php php php php php php php php/php/php Setphp methodphp description
php php php php php php php php php$thisphp-php>setDescriptionphp(php$helpTextphp)php;

php php php php php php php php php/php/php Getphp allphp paramphp typesphp asphp arrays
php php php php php php php php ifphp php(php!issetphp(php$paramTypesTmpphp)php php&php&php php(php0php <php php$paramCountphp)php)php php{
php php php php php php php php php php php php php$paramTypesTmpphp php=php arrayphp_fillphp(php0php,php php$paramCountphp,php php'mixedphp'php)php;
php php php php php php php php php}php elseifphp php(php!issetphp(php$paramTypesTmpphp)php)php php{
php php php php php php php php php php php php php$paramTypesTmpphp php=php arrayphp(php)php;
php php php php php php php php php}php elseifphp php(countphp(php$paramTypesTmpphp)php <php php$paramCountphp)php php{
php php php php php php php php php php php php php$startphp php=php php$paramCountphp php-php countphp(php$paramTypesTmpphp)php;
php php php php php php php php php php php php forphp php(php$iphp php=php php$startphp;php php$iphp <php php$paramCountphp;php php+php+php$iphp)php php{
php php php php php php php php php php php php php php php php php$paramTypesTmpphp[php$iphp]php php=php php'mixedphp'php;
php php php php php php php php php php php php php}
php php php php php php php php php}

php php php php php php php php php/php/php Getphp allphp paramphp descriptionsphp asphp arrays
php php php php php php php php ifphp php(php!issetphp(php$paramDescphp)php php&php&php php(php0php <php php$paramCountphp)php)php php{
php php php php php php php php php php php php php$paramDescphp php=php arrayphp_fillphp(php0php,php php$paramCountphp,php php'php'php)php;
php php php php php php php php php}php elseifphp php(php!issetphp(php$paramDescphp)php)php php{
php php php php php php php php php php php php php$paramDescphp php=php arrayphp(php)php;
php php php php php php php php php}php elseifphp php(countphp(php$paramDescphp)php <php php$paramCountphp)php php{
php php php php php php php php php php php php php$startphp php=php php$paramCountphp php-php countphp(php$paramDescphp)php;
php php php php php php php php php php php php forphp php(php$iphp php=php php$startphp;php php$iphp <php php$paramCountphp;php php+php+php$iphp)php php{
php php php php php php php php php php php php php php php php php$paramDescphp[php$iphp]php php=php php'php'php;
php php php php php php php php php php php php php}
php php php php php php php php php}

php php php php php php php php ifphp php(countphp(php$paramTypesTmpphp)php php!php=php php$paramCountphp)php php{
php php php php php php php php php php php php requirephp_oncephp php'Zendphp/Serverphp/Reflectionphp/Exceptionphp.phpphp'php;
php php php php php php php php php php php php throwphp newphp Zendphp_Serverphp_Reflectionphp_Exceptionphp(
php php php php php php php php php php php php php php php php'Variablephp numberphp ofphp argumentsphp isphp notphp supportedphp forphp servicesphp php(exceptphp optionalphp parametersphp)php.php php'
php php php php php php php php php php php php php php.php php'Numberphp ofphp functionphp argumentsphp inphp php'php php.php php$functionphp-php>getDeclaringClassphp(php)php-php>getNamephp(php)php php.php php'php:php:php'
php php php php php php php php php php php php php php.php php$functionphp-php>getNamephp(php)php php.php php'php(php)php mustphp correspondphp tophp actualphp numberphp ofphp argumentsphp describedphp inphp thephp php'
php php php php php php php php php php php php php php.php php'docblockphp.php'php)php;
php php php php php php php php php}

php php php php php php php php php$paramTypesphp php=php arrayphp(php)php;
php php php php php php php php foreachphp php(php$paramTypesTmpphp asphp php$iphp php=php>php php$paramphp)php php{
php php php php php php php php php php php php php$tmpphp php=php explodephp(php'php|php'php,php php$paramphp)php;
php php php php php php php php php php php php ifphp php(php$parametersphp[php$iphp]php-php>isOptionalphp(php)php)php php{
php php php php php php php php php php php php php php php php arrayphp_unshiftphp(php$tmpphp,php nullphp)php;
php php php php php php php php php php php php php}
php php php php php php php php php php php php php$paramTypesphp[php]php php=php php$tmpphp;
php php php php php php php php php}

php php php php php php php php php$thisphp-php>php_buildSignaturesphp(php$returnphp,php php$returnDescphp,php php$paramTypesphp,php php$paramDescphp)php;
php php php php php}


php php php php php/php*php*
php php php php php php*php Proxyphp reflectionphp calls
php php php php php php*
php php php php php php*php php@paramphp stringphp php$method
php php php php php php*php php@paramphp arrayphp php$args
php php php php php php*php php@returnphp mixed
php php php php php php*php/
php php php php publicphp functionphp php_php_callphp(php$methodphp,php php$argsphp)
php php php php php{
php php php php php php php php ifphp php(methodphp_existsphp(php$thisphp-php>php_reflectionphp,php php$methodphp)php)php php{
php php php php php php php php php php php php returnphp callphp_userphp_funcphp_arrayphp(arrayphp(php$thisphp-php>php_reflectionphp,php php$methodphp)php,php php$argsphp)php;
php php php php php php php php php}

php php php php php php php php requirephp_oncephp php'Zendphp/Serverphp/Reflectionphp/Exceptionphp.phpphp'php;
php php php php php php php php throwphp newphp Zendphp_Serverphp_Reflectionphp_Exceptionphp(php'Invalidphp reflectionphp methodphp php(php"php'php php.php$methodphp.php php'php"php)php'php)php;
php php php php php}

php php php php php/php*php*
php php php php php php*php Retrievephp configurationphp parameters
php php php php php php*
php php php php php php*php Valuesphp arephp retrievedphp byphp keyphp fromphp php{php@linkphp php$php_configphp}php.php Returnsphp nullphp ifphp no
php php php php php php*php valuephp foundphp.
php php php php php php*
php php php php php php*php php@paramphp stringphp php$key
php php php php php php*php php@returnphp mixed
php php php php php php*php/
php php php php publicphp functionphp php_php_getphp(php$keyphp)
php php php php php{
php php php php php php php php ifphp php(issetphp(php$thisphp-php>php_configphp[php$keyphp]php)php)php php{
php php php php php php php php php php php php returnphp php$thisphp-php>php_configphp[php$keyphp]php;
php php php php php php php php php}

php php php php php php php php returnphp nullphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Setphp configurationphp parameters
php php php php php php*
php php php php php php*php Valuesphp arephp storedphp byphp php$keyphp inphp php{php@linkphp php$php_configphp}php.
php php php php php php*
php php php php php php*php php@paramphp stringphp php$key
php php php php php php*php php@paramphp mixedphp php$value
php php php php php php*php php@returnphp void
php php php php php php*php/
php php php php publicphp functionphp php_php_setphp(php$keyphp,php php$valuephp)
php php php php php{
php php php php php php php php php$thisphp-php>php_configphp[php$keyphp]php php=php php$valuephp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Setphp methodphp'sphp namespace
php php php php php php*
php php php php php php*php php@paramphp stringphp php$namespace
php php php php php php*php php@returnphp void
php php php php php php*php/
php php php php publicphp functionphp setNamespacephp(php$namespacephp)
php php php php php{
php php php php php php php php ifphp php(emptyphp(php$namespacephp)php)php php{
php php php php php php php php php php php php php$thisphp-php>php_namespacephp php=php php'php'php;
php php php php php php php php php php php php returnphp;
php php php php php php php php php}

php php php php php php php php ifphp php(php!isphp_stringphp(php$namespacephp)php php|php|php php!pregphp_matchphp(php'php/php[aphp-zphp0php-php9php_php\php.php]php+php/iphp'php,php php$namespacephp)php)php php{
php php php php php php php php php php php php requirephp_oncephp php'Zendphp/Serverphp/Reflectionphp/Exceptionphp.phpphp'php;
php php php php php php php php php php php php throwphp newphp Zendphp_Serverphp_Reflectionphp_Exceptionphp(php'Invalidphp namespacephp'php)php;
php php php php php php php php php}

php php php php php php php php php$thisphp-php>php_namespacephp php=php php$namespacephp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Returnphp methodphp'sphp namespace
php php php php php php*
php php php php php php*php php@returnphp string
php php php php php php*php/
php php php php publicphp functionphp getNamespacephp(php)
php php php php php{
php php php php php php php php returnphp php$thisphp-php>php_namespacephp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Setphp thephp description
php php php php php php*
php php php php php php*php php@paramphp stringphp php$string
php php php php php php*php php@returnphp void
php php php php php php*php/
php php php php publicphp functionphp setDescriptionphp(php$stringphp)
php php php php php{
php php php php php php php php ifphp php(php!isphp_stringphp(php$stringphp)php)php php{
php php php php php php php php php php php php requirephp_oncephp php'Zendphp/Serverphp/Reflectionphp/Exceptionphp.phpphp'php;
php php php php php php php php php php php php throwphp newphp Zendphp_Serverphp_Reflectionphp_Exceptionphp(php'Invalidphp descriptionphp'php)php;
php php php php php php php php php}

php php php php php php php php php$thisphp-php>php_descriptionphp php=php php$stringphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Retrievephp thephp description
php php php php php php*
php php php php php php*php php@returnphp void
php php php php php php*php/
php php php php publicphp functionphp getDescriptionphp(php)
php php php php php{
php php php php php php php php returnphp php$thisphp-php>php_descriptionphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Retrievephp allphp prototypesphp asphp arrayphp of
php php php php php php*php php{php@linkphp Zendphp_Serverphp_Reflectionphp_Prototypephp Zendphp_Serverphp_Reflectionphp_Prototypesphp}
php php php php php php*
php php php php php php*php php@returnphp array
php php php php php php*php/
php php php php publicphp functionphp getPrototypesphp(php)
php php php php php{
php php php php php php php php returnphp php$thisphp-php>php_prototypesphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Retrievephp additionalphp invocationphp arguments
php php php php php php*
php php php php php php*php php@returnphp array
php php php php php php*php/
php php php php publicphp functionphp getInvokeArgumentsphp(php)
php php php php php{
php php php php php php php php returnphp php$thisphp-php>php_argvphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Wakeupphp fromphp serialization
php php php php php php*
php php php php php php*php Reflectionphp needsphp explicitphp instantiationphp tophp workphp correctlyphp.php Rephp-instantiate
php php php php php php*php reflectionphp objectphp onphp wakeupphp.
php php php php php php*
php php php php php php*php php@returnphp void
php php php php php php*php/
php php php php publicphp functionphp php_php_wakeupphp(php)
php php php php php{
php php php php php php php php ifphp php(php$thisphp-php>php_reflectionphp instanceofphp ReflectionMethodphp)php php{
php php php php php php php php php php php php php$classphp php=php newphp ReflectionClassphp(php$thisphp-php>php_classphp)php;
php php php php php php php php php php php php php$thisphp-php>php_reflectionphp php=php newphp ReflectionMethodphp(php$classphp-php>newInstancephp(php)php,php php$thisphp-php>getNamephp(php)php)php;
php php php php php php php php php}php elsephp php{
php php php php php php php php php php php php php$thisphp-php>php_reflectionphp php=php newphp ReflectionFunctionphp(php$thisphp-php>getNamephp(php)php)php;
php php php php php php php php php}
php php php php php}
php}
