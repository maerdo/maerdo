<php?php
php/php*php*
php php*php Zendphp Framework
php php*
php php*php LICENSE
php php*
php php*php Thisphp sourcephp filephp isphp subjectphp tophp thephp newphp BSDphp licensephp thatphp isphp bundled
php php*php withphp thisphp packagephp inphp thephp filephp LICENSEphp.txtphp.
php php*php Itphp isphp alsophp availablephp throughphp thephp worldphp-widephp-webphp atphp thisphp URLphp:
php php*php httpphp:php/php/frameworkphp.zendphp.comphp/licensephp/newphp-bsd
php php*php Ifphp youphp didphp notphp receivephp aphp copyphp ofphp thephp licensephp andphp arephp unablephp to
php php*php obtainphp itphp throughphp thephp worldphp-widephp-webphp,php pleasephp sendphp anphp email
php php*php tophp licensephp@zendphp.comphp sophp wephp canphp sendphp youphp aphp copyphp immediatelyphp.
php php*
php php*php php@categoryphp php php Zend
php php*php php@packagephp php php php Zendphp_Reflection
php php*php php@copyrightphp php Copyrightphp php(cphp)php php2php0php0php5php-php2php0php1php0php Zendphp Technologiesphp USAphp Incphp.php php(httpphp:php/php/wwwphp.zendphp.comphp)
php php*php php@licensephp php php php httpphp:php/php/frameworkphp.zendphp.comphp/licensephp/newphp-bsdphp php php php php Newphp BSDphp License
php php*php php@versionphp php php php php$Idphp:php Docblockphp.phpphp php2php0php0php9php6php php2php0php1php0php-php0php1php-php0php6php php0php2php:php0php5php:php0php9Zphp bkarwinphp php$
php php*php/

php/php*php*
php php*php php@seephp Zendphp_Reflectionphp_Docblockphp_Tag
php php*php/
requirephp_oncephp php'Zendphp/Reflectionphp/Docblockphp/Tagphp.phpphp'php;

php/php*php*
php php*php php@categoryphp php php Zend
php php*php php@packagephp php php php Zendphp_Reflection
php php*php php@copyrightphp php Copyrightphp php(cphp)php php2php0php0php5php-php2php0php1php0php Zendphp Technologiesphp USAphp Incphp.php php(httpphp:php/php/wwwphp.zendphp.comphp)
php php*php php@licensephp php php php httpphp:php/php/frameworkphp.zendphp.comphp/licensephp/newphp-bsdphp php php php php Newphp BSDphp License
php php*php/
classphp Zendphp_Reflectionphp_Docblockphp implementsphp Reflector
php{
php php php php php/php*php*
php php php php php php*php php@varphp Reflector
php php php php php php*php/
php php php php protectedphp php$php_reflectorphp php=php nullphp;

php php php php php/php*php*php#php@php+
php php php php php php*php php@varphp int
php php php php php php*php/
php php php php protectedphp php$php_startLinephp php=php nullphp;
php php php php protectedphp php$php_endLinephp php php php=php nullphp;
php php php php php/php*php*php#php@php-php*php/

php php php php php/php*php*
php php php php php php*php php@varphp string
php php php php php php*php/
php php php php protectedphp php$php_docCommentphp php=php nullphp;

php php php php php/php*php*
php php php php php php*php php@varphp string
php php php php php php*php/
php php php php protectedphp php$php_cleanDocCommentphp php=php nullphp;

php php php php php/php*php*
php php php php php php*php php@varphp string
php php php php php php*php/
php php php php protectedphp php$php_longDescriptionphp php=php nullphp;

php php php php php/php*php*
php php php php php php*php php@varphp string
php php php php php php*php/
php php php php protectedphp php$php_shortDescriptionphp php=php nullphp;

php php php php php/php*php*
php php php php php php*php php@varphp array
php php php php php php*php/
php php php php protectedphp php$php_tagsphp php=php arrayphp(php)php;

php php php php php/php*php*
php php php php php php*php Exportphp reflection
php php php php php php*
php php php php php php*php Reqiredphp byphp thephp Reflectorphp interfacephp.
php php php php php php*
php php php php php php*php php@todophp php php Whatphp shouldphp thisphp dophp?
php php php php php php*php php@returnphp void
php php php php php php*php/
php php php php publicphp staticphp functionphp exportphp(php)
php php php php php{

php php php php php}

php php php php php/php*php*
php php php php php php*php Serializephp tophp string
php php php php php php*
php php php php php php*php Requiredphp byphp thephp Reflectorphp interface
php php php php php php*
php php php php php php*php php@todophp php php Whatphp shouldphp thisphp returnphp?
php php php php php php*php php@returnphp string
php php php php php php*php/
php php php php publicphp functionphp php_php_toStringphp(php)
php php php php php{
php php php php php php php php php$strphp php=php php"Docblockphp php[php php/php*php Docblockphp php*php/php php]php php{php"php.PHPphp_EOLphp.PHPphp_EOLphp;
php php php php php php php php php$strphp php.php=php php"php php php-php Tagsphp php[php"php.countphp(php$thisphp-php>php_tagsphp)php.php"php]php php{php"php.PHPphp_EOLphp;

php php php php php php php php foreachphp(php$thisphp-php>php_tagsphp ASphp php$tagphp)php php{
php php php php php php php php php php php php php$strphp php.php=php php"php php php php php"php.php$tagphp;
php php php php php php php php php}

php php php php php php php php php$strphp php.php=php php"php php php}php"php.PHPphp_EOLphp;
php php php php php php php php php$strphp php.php=php php"php}php"php.PHPphp_EOLphp;

php php php php php php php php returnphp php$strphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Constructor
php php php php php php*
php php php php php php*php php@paramphp Reflectorphp|stringphp php$commentOrReflector
php php php php php php*php/
php php php php publicphp functionphp php_php_constructphp(php$commentOrReflectorphp)
php php php php php{
php php php php php php php php ifphp php(php$commentOrReflectorphp instanceofphp Reflectorphp)php php{
php php php php php php php php php php php php php$thisphp-php>php_reflectorphp php=php php$commentOrReflectorphp;
php php php php php php php php php php php php ifphp php(php!methodphp_existsphp(php$commentOrReflectorphp,php php'getDocCommentphp'php)php)php php{
php php php php php php php php php php php php php php php php requirephp_oncephp php'Zendphp/Reflectionphp/Exceptionphp.phpphp'php;
php php php php php php php php php php php php php php php php throwphp newphp Zendphp_Reflectionphp_Exceptionphp(php'Reflectorphp mustphp containphp methodphp php"getDocCommentphp"php'php)php;
php php php php php php php php php php php php php}
php php php php php php php php php php php php php$docCommentphp php=php php$commentOrReflectorphp-php>getDocCommentphp(php)php;

php php php php php php php php php php php php php$lineCountphp php=php substrphp_countphp(php$docCommentphp,php php"php\nphp"php)php;

php php php php php php php php php php php php php$thisphp-php>php_startLinephp php=php php$thisphp-php>php_reflectorphp-php>getStartLinephp(php)php php-php php$lineCountphp php-php php1php;
php php php php php php php php php php php php php$thisphp-php>php_endLinephp php php php=php php$thisphp-php>php_reflectorphp-php>getStartLinephp(php)php php-php php1php;

php php php php php php php php php}php elseifphp php(isphp_stringphp(php$commentOrReflectorphp)php)php php{
php php php php php php php php php php php php php$docCommentphp php=php php$commentOrReflectorphp;
php php php php php php php php php}php elsephp php{
php php php php php php php php php php php php requirephp_oncephp php'Zendphp/Reflectionphp/Exceptionphp.phpphp'php;
php php php php php php php php php php php php throwphp newphp Zendphp_Reflectionphp_Exceptionphp(getphp_classphp(php$thisphp)php php.php php'php mustphp havephp aphp php(stringphp)php DocCommentphp orphp aphp Reflectorphp inphp thephp constructorphp'php)php;
php php php php php php php php php}

php php php php php php php php ifphp php(php$docCommentphp php=php=php php'php'php)php php{
php php php php php php php php php php php php requirephp_oncephp php'Zendphp/Reflectionphp/Exceptionphp.phpphp'php;
php php php php php php php php php php php php throwphp newphp Zendphp_Reflectionphp_Exceptionphp(php'DocCommentphp cannotphp bephp emptyphp'php)php;
php php php php php php php php php}

php php php php php php php php php$thisphp-php>php_docCommentphp php=php php$docCommentphp;
php php php php php php php php php$thisphp-php>php_parsephp(php)php;
php php php php php}

php php php php php/php*php*
php php php php php php*php Retrievephp contentsphp ofphp docblock
php php php php php php*
php php php php php php*php php@returnphp string
php php php php php php*php/
php php php php publicphp functionphp getContentsphp(php)
php php php php php{
php php php php php php php php returnphp php$thisphp-php>php_cleanDocCommentphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Getphp startphp linephp php(positionphp)php ofphp docblock
php php php php php php*
php php php php php php*php php@returnphp int
php php php php php php*php/
php php php php publicphp functionphp getStartLinephp(php)
php php php php php{
php php php php php php php php returnphp php$thisphp-php>php_startLinephp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Getphp lastphp linephp php(positionphp)php ofphp docblock
php php php php php php*
php php php php php php*php php@returnphp int
php php php php php php*php/
php php php php publicphp functionphp getEndLinephp(php)
php php php php php{
php php php php php php php php returnphp php$thisphp-php>php_endLinephp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Getphp docblockphp shortphp description
php php php php php php*
php php php php php php*php php@returnphp string
php php php php php php*php/
php php php php publicphp functionphp getShortDescriptionphp(php)
php php php php php{
php php php php php php php php returnphp php$thisphp-php>php_shortDescriptionphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Getphp docblockphp longphp description
php php php php php php*
php php php php php php*php php@returnphp string
php php php php php php*php/
php php php php publicphp functionphp getLongDescriptionphp(php)
php php php php php{
php php php php php php php php returnphp php$thisphp-php>php_longDescriptionphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Doesphp thephp docblockphp containphp thephp givenphp annotationphp tagphp?
php php php php php php*
php php php php php php*php php@paramphp php stringphp php$name
php php php php php php*php php@returnphp bool
php php php php php php*php/
php php php php publicphp functionphp hasTagphp(php$namephp)
php php php php php{
php php php php php php php php foreachphp php(php$thisphp-php>php_tagsphp asphp php$tagphp)php php{
php php php php php php php php php php php php ifphp php(php$tagphp-php>getNamephp(php)php php=php=php php$namephp)php php{
php php php php php php php php php php php php php php php php returnphp truephp;
php php php php php php php php php php php php php}
php php php php php php php php php}
php php php php php php php php returnphp falsephp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Retrievephp thephp givenphp docblockphp tag
php php php php php php*
php php php php php php*php php@paramphp php stringphp php$name
php php php php php php*php php@returnphp Zendphp_Reflectionphp_Docblockphp_Tagphp|false
php php php php php php*php/
php php php php publicphp functionphp getTagphp(php$namephp)
php php php php php{
php php php php php php php php foreachphp php(php$thisphp-php>php_tagsphp asphp php$tagphp)php php{
php php php php php php php php php php php php ifphp php(php$tagphp-php>getNamephp(php)php php=php=php php$namephp)php php{
php php php php php php php php php php php php php php php php returnphp php$tagphp;
php php php php php php php php php php php php php}
php php php php php php php php php}

php php php php php php php php returnphp falsephp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Getphp allphp docblockphp annotationphp tags
php php php php php php*
php php php php php php*php php@paramphp stringphp php$filter
php php php php php php*php php@returnphp arrayphp Arrayphp ofphp Zendphp_Reflectionphp_Docblockphp_Tag
php php php php php php*php/
php php php php publicphp functionphp getTagsphp(php$filterphp php=php nullphp)
php php php php php{
php php php php php php php php ifphp php(php$filterphp php=php=php=php nullphp php|php|php php!isphp_stringphp(php$filterphp)php)php php{
php php php php php php php php php php php php returnphp php$thisphp-php>php_tagsphp;
php php php php php php php php php}

php php php php php php php php php$returnTagsphp php=php arrayphp(php)php;
php php php php php php php php foreachphp php(php$thisphp-php>php_tagsphp asphp php$tagphp)php php{
php php php php php php php php php php php php ifphp php(php$tagphp-php>getNamephp(php)php php=php=php php$filterphp)php php{
php php php php php php php php php php php php php php php php php$returnTagsphp[php]php php=php php$tagphp;
php php php php php php php php php php php php php}
php php php php php php php php php}
php php php php php php php php returnphp php$returnTagsphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Parsephp thephp docblock
php php php php php php*
php php php php php php*php php@returnphp void
php php php php php php*php/
php php php php protectedphp functionphp php_parsephp(php)
php php php php php{
php php php php php php php php php$docCommentphp php=php php$thisphp-php>php_docCommentphp;

php php php php php php php php php/php/php Firstphp removephp docphp blockphp linephp starters
php php php php php php php php php$docCommentphp php=php pregphp_replacephp(php'php#php[php php\tphp]php*php(php?php:php\php/php\php*php\php*php|php\php*php\php/php|php\php*php)php?php[php php]php{php0php,php1php}php(php.php*php)php?php#php'php,php php'php$php1php'php,php php$docCommentphp)php;
php php php php php php php php php$docCommentphp php=php ltrimphp(php$docCommentphp,php php"php\rphp\nphp"php)php;php php/php/php php@todophp shouldphp bephp changedphp tophp removephp firstphp andphp lastphp emptyphp line

php php php php php php php php php$thisphp-php>php_cleanDocCommentphp php=php php$docCommentphp;

php php php php php php php php php/php/php Nextphp parsephp outphp thephp tagsphp andphp descriptions
php php php php php php php php php$parsedDocCommentphp php=php php$docCommentphp;
php php php php php php php php php$lineNumberphp php=php php$firstBlandLineEncounteredphp php=php php0php;
php php php php php php php php whilephp php(php(php$newlinePosphp php=php strposphp(php$parsedDocCommentphp,php php"php\nphp"php)php)php php!php=php=php falsephp)php php{
php php php php php php php php php php php php php$lineNumberphp+php+php;
php php php php php php php php php php php php php$linephp php=php substrphp(php$parsedDocCommentphp,php php0php,php php$newlinePosphp)php;

php php php php php php php php php php php php php$matchesphp php=php arrayphp(php)php;

php php php php php php php php php php php php ifphp php(php(strposphp(php$linephp,php php'php@php'php)php php=php=php=php php0php)php php&php&php php(pregphp_matchphp(php'php#php^php(php@php\wphp+php.php*php?php)php(php\nphp)php(php?php:php@php|php\rphp?php\nphp|php$php)php#sphp'php,php php$parsedDocCommentphp,php php$matchesphp)php)php)php php{
php php php php php php php php php php php php php php php php php$thisphp-php>php_tagsphp[php]php php=php Zendphp_Reflectionphp_Docblockphp_Tagphp:php:factoryphp(php$matchesphp[php1php]php)php;
php php php php php php php php php php php php php php php php php$parsedDocCommentphp php=php strphp_replacephp(php$matchesphp[php1php]php php.php php$matchesphp[php2php]php,php php'php'php,php php$parsedDocCommentphp)php;
php php php php php php php php php php php php php}php elsephp php{
php php php php php php php php php php php php php php php php ifphp php(php$lineNumberphp <php php3php php&php&php php!php$firstBlandLineEncounteredphp)php php{
php php php php php php php php php php php php php php php php php php php php php$thisphp-php>php_shortDescriptionphp php.php=php php$linephp php.php php"php\nphp"php;
php php php php php php php php php php php php php php php php php}php elsephp php{
php php php php php php php php php php php php php php php php php php php php php$thisphp-php>php_longDescriptionphp php.php=php php$linephp php.php php"php\nphp"php;
php php php php php php php php php php php php php php php php php}

php php php php php php php php php php php php php php php php ifphp php(php$linephp php=php=php php'php'php)php php{
php php php php php php php php php php php php php php php php php php php php php$firstBlandLineEncounteredphp php=php truephp;
php php php php php php php php php php php php php php php php php}

php php php php php php php php php php php php php php php php php$parsedDocCommentphp php=php substrphp(php$parsedDocCommentphp,php php$newlinePosphp php+php php1php)php;
php php php php php php php php php php php php php}

php php php php php php php php php}

php php php php php php php php php$thisphp-php>php_shortDescriptionphp php=php rtrimphp(php$thisphp-php>php_shortDescriptionphp)php;
php php php php php php php php php$thisphp-php>php_longDescriptionphp php php=php rtrimphp(php$thisphp-php>php_longDescriptionphp)php;
php php php php php}
php}
