<php?php
php/php*php*
php php*php Zendphp Framework
php php*
php php*php LICENSE
php php*
php php*php Thisphp sourcephp filephp isphp subjectphp tophp thephp newphp BSDphp licensephp thatphp isphp bundled
php php*php withphp thisphp packagephp inphp thephp filephp LICENSEphp.txtphp.
php php*php Itphp isphp alsophp availablephp throughphp thephp worldphp-widephp-webphp atphp thisphp URLphp:
php php*php httpphp:php/php/frameworkphp.zendphp.comphp/licensephp/newphp-bsd
php php*php Ifphp youphp didphp notphp receivephp aphp copyphp ofphp thephp licensephp andphp arephp unablephp to
php php*php obtainphp itphp throughphp thephp worldphp-widephp-webphp,php pleasephp sendphp anphp email
php php*php tophp licensephp@zendphp.comphp sophp wephp canphp sendphp youphp aphp copyphp immediatelyphp.
php php*
php php*php php@categoryphp php php Zend
php php*php php@packagephp php php php Zendphp_Pdf
php php*php php@copyrightphp php Copyrightphp php(cphp)php php2php0php0php5php-php2php0php1php0php Zendphp Technologiesphp USAphp Incphp.php php(httpphp:php/php/wwwphp.zendphp.comphp)
php php*php php@licensephp php php php httpphp:php/php/frameworkphp.zendphp.comphp/licensephp/newphp-bsdphp php php php php Newphp BSDphp License
php php*php php@versionphp php php php php$Idphp:php Pagephp.phpphp php2php2php9php0php9php php2php0php1php0php-php0php8php-php2php7php php1php9php:php5php7php:php4php8Zphp alexanderphp php$
php php*php/

php/php*php*php Internallyphp usedphp classesphp php*php/
requirephp_oncephp php'Zendphp/Pdfphp/Elementphp.phpphp'php;
requirephp_oncephp php'Zendphp/Pdfphp/Elementphp/Arrayphp.phpphp'php;
requirephp_oncephp php'Zendphp/Pdfphp/Elementphp/Stringphp/Binaryphp.phpphp'php;
requirephp_oncephp php'Zendphp/Pdfphp/Elementphp/Booleanphp.phpphp'php;
requirephp_oncephp php'Zendphp/Pdfphp/Elementphp/Dictionaryphp.phpphp'php;
requirephp_oncephp php'Zendphp/Pdfphp/Elementphp/Namephp.phpphp'php;
requirephp_oncephp php'Zendphp/Pdfphp/Elementphp/Nullphp.phpphp'php;
requirephp_oncephp php'Zendphp/Pdfphp/Elementphp/Numericphp.phpphp'php;
requirephp_oncephp php'Zendphp/Pdfphp/Elementphp/Stringphp.phpphp'php;
requirephp_oncephp php'Zendphp/Pdfphp/Resourcephp/Unifiedphp.phpphp'php;

requirephp_oncephp php'Zendphp/Pdfphp/Canvasphp/Abstractphp.phpphp'php;


php/php*php*
php php*php PDFphp Page
php php*
php php*php php@packagephp php php php Zendphp_Pdf
php php*php php@copyrightphp php Copyrightphp php(cphp)php php2php0php0php5php-php2php0php1php0php Zendphp Technologiesphp USAphp Incphp.php php(httpphp:php/php/wwwphp.zendphp.comphp)
php php*php php@licensephp php php php httpphp:php/php/frameworkphp.zendphp.comphp/licensephp/newphp-bsdphp php php php php Newphp BSDphp License
php php*php/
classphp Zendphp_Pdfphp_Pagephp extendsphp Zendphp_Pdfphp_Canvasphp_Abstract
php{
php php php/php*php*php*php*php Classphp Constantsphp php*php*php*php*php/


php php php/php*php Pagephp Sizesphp php*php/

php php php php php/php*php*
php php php php php php*php Sizephp representingphp anphp Aphp4php pagephp inphp portraitphp php(tallphp)php orientationphp.
php php php php php php*php/
php php php php constphp SIZEphp_Aphp4php php php php php php php php php php php php php php php php php=php php'php5php9php5php:php8php4php2php:php'php;

php php php php php/php*php*
php php php php php php*php Sizephp representingphp anphp Aphp4php pagephp inphp landscapephp php(widephp)php orientationphp.
php php php php php php*php/
php php php php constphp SIZEphp_Aphp4php_LANDSCAPEphp php php php php php php=php php'php8php4php2php:php5php9php5php:php'php;

php php php php php/php*php*
php php php php php php*php Sizephp representingphp aphp USphp Letterphp pagephp inphp portraitphp php(tallphp)php orientationphp.
php php php php php php*php/
php php php php constphp SIZEphp_LETTERphp php php php php php php php php php php php php=php php'php6php1php2php:php7php9php2php:php'php;

php php php php php/php*php*
php php php php php php*php Sizephp representingphp aphp USphp Letterphp pagephp inphp landscapephp php(widephp)php orientationphp.
php php php php php php*php/
php php php php constphp SIZEphp_LETTERphp_LANDSCAPEphp php php=php php'php7php9php2php:php6php1php2php:php'php;


php php php/php*php Shapephp Drawingphp php*php/

php php php php php/php*php*
php php php php php php*php Strokephp thephp pathphp onlyphp.php Dophp notphp fillphp.
php php php php php php*php/
php php php php constphp SHAPEphp_DRAWphp_STROKEphp php php php php php php=php php0php;

php php php php php/php*php*
php php php php php php*php Fillphp thephp pathphp onlyphp.php Dophp notphp strokephp.
php php php php php php*php/
php php php php constphp SHAPEphp_DRAWphp_FILLphp php php php php php php php php=php php1php;

php php php php php/php*php*
php php php php php php*php Fillphp andphp strokephp thephp pathphp.
php php php php php php*php/
php php php php constphp SHAPEphp_DRAWphp_FILLphp_ANDphp_STROKEphp php=php php2php;


php php php/php*php Shapephp Fillingphp Methodsphp php*php/

php php php php php/php*php*
php php php php php php*php Fillphp thephp pathphp usingphp thephp nonphp-zerophp windingphp rulephp.
php php php php php php*php/
php php php php constphp FILLphp_METHODphp_NONphp_ZEROphp_WINDINGphp php=php php0php;

php php php php php/php*php*
php php php php php php*php Fillphp thephp pathphp usingphp thephp evenphp-oddphp rulephp.
php php php php php php*php/
php php php php constphp FILLphp_METHODphp_EVENphp_ODDphp php php php php php php php php=php php1php;


php php php/php*php Linephp Dashphp Typesphp php*php/

php php php php php/php*php*
php php php php php php*php Solidphp linephp dashphp.
php php php php php php*php/
php php php php constphp LINEphp_DASHINGphp_SOLIDphp php=php php0php;



php php php php php/php*php*
php php php php php php*php Pagephp dictionaryphp php(refersphp tophp anphp inderectphp Zendphp_Pdfphp_Elementphp_Dictionaryphp objectphp)php.
php php php php php php*
php php php php php php*php php@varphp Zendphp_Pdfphp_Elementphp_Referencephp|Zendphp_Pdfphp_Elementphp_Object
php php php php php php*php/
php php php php protectedphp php$php_dictionaryphp;

php php php php php/php*php*
php php php php php php*php PDFphp objectsphp factoryphp.
php php php php php php*
php php php php php php*php php@varphp Zendphp_Pdfphp_ElementFactoryphp_Interface
php php php php php php*php/
php php php php protectedphp php$php_objFactoryphp php=php nullphp;

php php php php php/php*php*
php php php php php php*php Flagphp whichphp signalsphp,php thatphp pagephp isphp createdphp separatelyphp fromphp anyphp PDFphp documentphp or
php php php php php php*php attachedphp tophp anyonephp.
php php php php php php*
php php php php php php*php php@varphp boolean
php php php php php php*php/
php php php php protectedphp php$php_attachedphp;

php php php php php/php*php*
php php php php php php*php Safephp Graphicsphp Statephp semafore
php php php php php php*
php php php php php php*php Ifphp itphp'sphp falsephp,php thanphp wephp canphp'tphp bephp surephp Graphicsphp Statephp isphp restoredphp withing
php php php php php php*php contextphp ofphp previousphp contentsphp streamphp php(exphp.php drawingphp coordinatephp systemphp mayphp bephp rotatedphp)php.
php php php php php php*php Wephp shouldphp encompassphp existingphp contentphp withphp savephp/restorephp GSphp operators
php php php php php php*
php php php php php php*php php@varphp boolean
php php php php php php*php/
php php php php protectedphp php$php_safeGSphp;

php php php php php/php*php*
php php php php php php*php Objectphp constructorphp.
php php php php php php*php Constructorphp signaturesphp:
php php php php php php*
php php php php php php*php php1php.php Loadphp PDFphp pagephp fromphp aphp parsedphp PDFphp filephp.
php php php php php php*php php php php Objectphp factoryphp isphp createdphp byphp PDFphp parserphp.
php php php php php php*php php-php-php-php-php-php-php-php-php-php-php-php-php-php-php-php-php-php-php-php-php-php-php-php-php-php-php-php-php-php-php-php-php-php-php-php-php-php-php-php-php-php-php-php-php-php-php-php-php-php-php-php-php-php-php-php-php-
php php php php php php*php newphp Zendphp_Pdfphp_Pagephp(Zendphp_Pdfphp_Elementphp_Dictionaryphp php php php php php php php$pageDictphp,
php php php php php php*php php php php php php php php php php php php php php php php php php php Zendphp_Pdfphp_ElementFactoryphp_Interfacephp php$factoryphp)php;
php php php php php php*php php-php-php-php-php-php-php-php-php-php-php-php-php-php-php-php-php-php-php-php-php-php-php-php-php-php-php-php-php-php-php-php-php-php-php-php-php-php-php-php-php-php-php-php-php-php-php-php-php-php-php-php-php-php-php-php-php-
php php php php php php*
php php php php php php*php php2php.php Makephp aphp copyphp ofphp thephp PDFphp pagephp.
php php php php php php*php php php php Newphp pagephp isphp createdphp inphp thephp samephp contextphp asphp sourcephp pagephp.php Objectphp factoryphp isphp sharedphp.
php php php php php php*php php php php Thusphp itphp willphp bephp attachedphp tophp thephp documentphp,php butphp needphp tophp bephp placedphp intophp Zendphp_Pdfphp:php:php$pagesphp array
php php php php php php*php php php php tophp bephp includedphp intophp outputphp.
php php php php php php*php php-php-php-php-php-php-php-php-php-php-php-php-php-php-php-php-php-php-php-php-php-php-php-php-php-php-php-php-php-php-php-php-php-php-php-php-php-php-php-php-php-php-php-php-php-php-php-php-php-php-php-php-php-php-php-php-php-
php php php php php php*php newphp Zendphp_Pdfphp_Pagephp(Zendphp_Pdfphp_Pagephp php$pagephp)php;
php php php php php php*php php-php-php-php-php-php-php-php-php-php-php-php-php-php-php-php-php-php-php-php-php-php-php-php-php-php-php-php-php-php-php-php-php-php-php-php-php-php-php-php-php-php-php-php-php-php-php-php-php-php-php-php-php-php-php-php-php-
php php php php php php*
php php php php php php*php php3php.php Createphp newphp pagephp withphp aphp specifiedphp pagesizephp.
php php php php php php*php php php php Ifphp php$factoryphp isphp nullphp thenphp itphp willphp bephp createdphp andphp pagephp mustphp bephp attachedphp tophp thephp documentphp tophp be
php php php php php php*php php php php includedphp intophp outputphp.
php php php php php php*php php-php-php-php-php-php-php-php-php-php-php-php-php-php-php-php-php-php-php-php-php-php-php-php-php-php-php-php-php-php-php-php-php-php-php-php-php-php-php-php-php-php-php-php-php-php-php-php-php-php-php-php-php-php-php-php-php-
php php php php php php*php newphp Zendphp_Pdfphp_Pagephp(stringphp php$pagesizephp,php Zendphp_Pdfphp_ElementFactoryphp_Interfacephp php$factoryphp php=php nullphp)php;
php php php php php php*php php-php-php-php-php-php-php-php-php-php-php-php-php-php-php-php-php-php-php-php-php-php-php-php-php-php-php-php-php-php-php-php-php-php-php-php-php-php-php-php-php-php-php-php-php-php-php-php-php-php-php-php-php-php-php-php-php-
php php php php php php*
php php php php php php*php php4php.php Createphp newphp pagephp withphp aphp specifiedphp pagesizephp php(inphp defaultphp userphp spacephp unitsphp)php.
php php php php php php*php php php php Ifphp php$factoryphp isphp nullphp thenphp itphp willphp bephp createdphp andphp pagephp mustphp bephp attachedphp tophp thephp documentphp tophp be
php php php php php php*php php php php includedphp intophp outputphp.
php php php php php php*php php-php-php-php-php-php-php-php-php-php-php-php-php-php-php-php-php-php-php-php-php-php-php-php-php-php-php-php-php-php-php-php-php-php-php-php-php-php-php-php-php-php-php-php-php-php-php-php-php-php-php-php-php-php-php-php-php-
php php php php php php*php newphp Zendphp_Pdfphp_Pagephp(numericphp php$widthphp,php numericphp php$heightphp,php Zendphp_Pdfphp_ElementFactoryphp_Interfacephp php$factoryphp php=php nullphp)php;
php php php php php php*php php-php-php-php-php-php-php-php-php-php-php-php-php-php-php-php-php-php-php-php-php-php-php-php-php-php-php-php-php-php-php-php-php-php-php-php-php-php-php-php-php-php-php-php-php-php-php-php-php-php-php-php-php-php-php-php-php-
php php php php php php*
php php php php php php*
php php php php php php*php php@paramphp mixedphp php$paramphp1
php php php php php php*php php@paramphp mixedphp php$paramphp2
php php php php php php*php php@paramphp mixedphp php$paramphp3
php php php php php php*php php@throwsphp Zendphp_Pdfphp_Exception
php php php php php php*php/
php php php php publicphp functionphp php_php_constructphp(php$paramphp1php,php php$paramphp2php php=php nullphp,php php$paramphp3php php=php nullphp)
php php php php php{
php php php php php php php php ifphp php(php(php$paramphp1php instanceofphp Zendphp_Pdfphp_Elementphp_Referencephp php|php|
php php php php php php php php php php php php php php$paramphp1php instanceofphp Zendphp_Pdfphp_Elementphp_Object
php php php php php php php php php php php php php)php php&php&
php php php php php php php php php php php php php$paramphp2php instanceofphp Zendphp_Pdfphp_ElementFactoryphp_Interfacephp php&php&
php php php php php php php php php php php php php$paramphp3php php=php=php=php null
php php php php php php php php php php php php)php php{
php php php php php php php php php php php php switchphp php(php$paramphp1php-php>getTypephp(php)php)php php{
php php php php php php php php php php php php php php php php casephp Zendphp_Pdfphp_Elementphp:php:TYPEphp_DICTIONARYphp:
php php php php php php php php php php php php php php php php php php php php php$thisphp-php>php_dictionaryphp php=php php$paramphp1php;
php php php php php php php php php php php php php php php php php php php php php$thisphp-php>php_objFactoryphp php=php php$paramphp2php;
php php php php php php php php php php php php php php php php php php php php php$thisphp-php>php_attachedphp php php php=php truephp;
php php php php php php php php php php php php php php php php php php php php php$thisphp-php>php_safeGSphp php php php php php=php falsephp;
php php php php php php php php php php php php php php php php php php php php returnphp;
php php php php php php php php php php php php php php php php php php php php breakphp;

php php php php php php php php php php php php php php php php casephp Zendphp_Pdfphp_Elementphp:php:TYPEphp_NULLphp:
php php php php php php php php php php php php php php php php php php php php php$thisphp-php>php_objFactoryphp php=php php$paramphp2php;
php php php php php php php php php php php php php php php php php php php php php$pageWidthphp php=php php$pageHeightphp php=php php0php;
php php php php php php php php php php php php php php php php php php php php breakphp;

php php php php php php php php php php php php php php php php defaultphp:
php php php php php php php php php php php php php php php php php php php php requirephp_oncephp php'Zendphp/Pdfphp/Exceptionphp.phpphp'php;
php php php php php php php php php php php php php php php php php php php php throwphp newphp Zendphp_Pdfphp_Exceptionphp(php'Unrecognizedphp objectphp typephp.php'php)php;
php php php php php php php php php php php php php php php php php php php php breakphp;

php php php php php php php php php php php php php}
php php php php php php php php php}php elsephp ifphp php(php$paramphp1php instanceofphp Zendphp_Pdfphp_Pagephp php&php&php php$paramphp2php php=php=php=php nullphp php&php&php php$paramphp3php php=php=php=php nullphp)php php{
php php php php php php php php php php php php php/php/php Duplicatephp existingphp pagephp.
php php php php php php php php php php php php php/php/php Letphp alreadyphp existingphp contentphp andphp resourcesphp tophp bephp sharedphp betweenphp pages
php php php php php php php php php php php php php/php/php Wephp donphp'tphp givephp existingphp contentphp modificationphp functionalityphp,php sophp wephp donphp'tphp needphp php"deepphp copyphp"
php php php php php php php php php php php php php$thisphp-php>php_objFactoryphp php=php php$paramphp1php-php>php_objFactoryphp;
php php php php php php php php php php php php php$thisphp-php>php_attachedphp php php php=php php&php$paramphp1php-php>php_attachedphp;
php php php php php php php php php php php php php$thisphp-php>php_safeGSphp php php php php php=php falsephp;

php php php php php php php php php php php php php$thisphp-php>php_dictionaryphp php=php php$thisphp-php>php_objFactoryphp-php>newObjectphp(newphp Zendphp_Pdfphp_Elementphp_Dictionaryphp(php)php)php;

php php php php php php php php php php php php foreachphp php(php$paramphp1php-php>php_dictionaryphp-php>getKeysphp(php)php asphp php$keyphp)php php{
php php php php php php php php php php php php php php php php ifphp php(php$keyphp php=php=php php'Contentsphp'php)php php{
php php php php php php php php php php php php php php php php php php php php php/php/php Clonephp Contentsphp property

php php php php php php php php php php php php php php php php php php php php php$thisphp-php>php_dictionaryphp-php>Contentsphp php=php newphp Zendphp_Pdfphp_Elementphp_Arrayphp(php)php;

php php php php php php php php php php php php php php php php php php php php ifphp php(php$paramphp1php-php>php_dictionaryphp-php>Contentsphp-php>getTypephp(php)php php!php=php Zendphp_Pdfphp_Elementphp:php:TYPEphp_ARRAYphp)php php{
php php php php php php php php php php php php php php php php php php php php php php php php php/php/php Preparephp arrayphp ofphp contentphp streamsphp andphp addphp existingphp stream
php php php php php php php php php php php php php php php php php php php php php php php php php$thisphp-php>php_dictionaryphp-php>Contentsphp-php>itemsphp[php]php php=php php$paramphp1php-php>php_dictionaryphp-php>Contentsphp;
php php php php php php php php php php php php php php php php php php php php php}php elsephp php{
php php php php php php php php php php php php php php php php php php php php php php php php php/php/php Clonephp arrayphp ofphp thephp contentphp streams
php php php php php php php php php php php php php php php php php php php php php php php php foreachphp php(php$paramphp1php-php>php_dictionaryphp-php>Contentsphp-php>itemsphp asphp php$srcContentStreamphp)php php{
php php php php php php php php php php php php php php php php php php php php php php php php php php php php php$thisphp-php>php_dictionaryphp-php>Contentsphp-php>itemsphp[php]php php=php php$srcContentStreamphp;
php php php php php php php php php php php php php php php php php php php php php php php php php}
php php php php php php php php php php php php php php php php php php php php php}
php php php php php php php php php php php php php php php php php}php elsephp php{
php php php php php php php php php php php php php php php php php php php php php$thisphp-php>php_dictionaryphp-php>php$keyphp php=php php$paramphp1php-php>php_dictionaryphp-php>php$keyphp;
php php php php php php php php php php php php php php php php php}
php php php php php php php php php php php php php}

php php php php php php php php php php php php returnphp;
php php php php php php php php php}php elsephp ifphp php(isphp_stringphp(php$paramphp1php)php php&php&
php php php php php php php php php php php php php php php php php php php php(php$paramphp2php php=php=php=php nullphp php|php|php php$paramphp2php instanceofphp Zendphp_Pdfphp_ElementFactoryphp_Interfacephp)php php&php&
php php php php php php php php php php php php php php php php php php php php$paramphp3php php=php=php=php nullphp)php php{
php php php php php php php php php php php php ifphp php(php$paramphp2php php!php=php=php nullphp)php php{
php php php php php php php php php php php php php php php php php$thisphp-php>php_objFactoryphp php=php php$paramphp2php;
php php php php php php php php php php php php php}php elsephp php{
php php php php php php php php php php php php php php php php requirephp_oncephp php'Zendphp/Pdfphp/ElementFactoryphp.phpphp'php;
php php php php php php php php php php php php php php php php php$thisphp-php>php_objFactoryphp php=php Zendphp_Pdfphp_ElementFactoryphp:php:createFactoryphp(php1php)php;
php php php php php php php php php php php php php}
php php php php php php php php php php php php php$thisphp-php>php_attachedphp php php php=php falsephp;
php php php php php php php php php php php php php$thisphp-php>php_safeGSphp php php php php php=php truephp;php php/php*php*php Newphp pagephp createdphp.php Thatphp'sphp usersphp Appphp responsibilityphp tophp trackphp GSphp changesphp php*php/

php php php php php php php php php php php php switchphp php(strtolowerphp(php$paramphp1php)php)php php{
php php php php php php php php php php php php php php php php casephp php'aphp4php'php:
php php php php php php php php php php php php php php php php php php php php php$paramphp1php php=php Zendphp_Pdfphp_Pagephp:php:SIZEphp_Aphp4php;
php php php php php php php php php php php php php php php php php php php php breakphp;
php php php php php php php php php php php php php php php php casephp php'aphp4php-landscapephp'php:
php php php php php php php php php php php php php php php php php php php php php$paramphp1php php=php Zendphp_Pdfphp_Pagephp:php:SIZEphp_Aphp4php_LANDSCAPEphp;
php php php php php php php php php php php php php php php php php php php php breakphp;
php php php php php php php php php php php php php php php php casephp php'letterphp'php:
php php php php php php php php php php php php php php php php php php php php php$paramphp1php php=php Zendphp_Pdfphp_Pagephp:php:SIZEphp_LETTERphp;
php php php php php php php php php php php php php php php php php php php php breakphp;
php php php php php php php php php php php php php php php php casephp php'letterphp-landscapephp'php:
php php php php php php php php php php php php php php php php php php php php php$paramphp1php php=php Zendphp_Pdfphp_Pagephp:php:SIZEphp_LETTERphp_LANDSCAPEphp;
php php php php php php php php php php php php php php php php php php php php breakphp;
php php php php php php php php php php php php php php php php defaultphp:
php php php php php php php php php php php php php php php php php php php php php/php/php shouldphp bephp inphp php"xphp:yphp"php orphp php"xphp:yphp:php"php form
php php php php php php php php php php php php php}

php php php php php php php php php php php php php$pageDimphp php=php explodephp(php'php:php'php,php php$paramphp1php)php;
php php php php php php php php php php php php ifphp(countphp(php$pageDimphp)php php=php=php php2php php php|php|php php countphp(php$pageDimphp)php php=php=php php3php)php php{
php php php php php php php php php php php php php php php php php$pageWidthphp php php=php php$pageDimphp[php0php]php;
php php php php php php php php php php php php php php php php php$pageHeightphp php=php php$pageDimphp[php1php]php;
php php php php php php php php php php php php php}php elsephp php{
php php php php php php php php php php php php php php php php php/php*php*
php php php php php php php php php php php php php php php php php php*php php@todophp supportphp ofphp userphp definedphp pagesizephp notationsphp,php likephp:
php php php php php php php php php php php php php php php php php php*php php php php php php php php"php2php1php0xphp2php9php7mmphp"php,php php"php5php9php5xphp8php4php2php"php,php php"php8php.php5xphp1php1inphp"php,php php"php6php1php2xphp7php9php2php"
php php php php php php php php php php php php php php php php php php*php/
php php php php php php php php php php php php php php php php requirephp_oncephp php'Zendphp/Pdfphp/Exceptionphp.phpphp'php;
php php php php php php php php php php php php php php php php throwphp newphp Zendphp_Pdfphp_Exceptionphp(php'Wrongphp pagesizephp notationphp.php'php)php;
php php php php php php php php php php php php php}
php php php php php php php php php php php php php/php*php*
php php php php php php php php php php php php php php*php php@todophp supportphp ofphp pagesizephp recalculationphp tophp php"defaultphp userphp spacephp unitsphp"
php php php php php php php php php php php php php php*php/

php php php php php php php php php}php elsephp ifphp php(isphp_numericphp(php$paramphp1php)php php&php&php isphp_numericphp(php$paramphp2php)php php&php&
php php php php php php php php php php php php php php php php php php php php(php$paramphp3php php=php=php=php nullphp php|php|php php$paramphp3php instanceofphp Zendphp_Pdfphp_ElementFactoryphp_Interfacephp)php)php php{
php php php php php php php php php php php php ifphp php(php$paramphp3php php!php=php=php nullphp)php php{
php php php php php php php php php php php php php php php php php$thisphp-php>php_objFactoryphp php=php php$paramphp3php;
php php php php php php php php php php php php php}php elsephp php{
php php php php php php php php php php php php php php php php requirephp_oncephp php'Zendphp/Pdfphp/ElementFactoryphp.phpphp'php;
php php php php php php php php php php php php php php php php php$thisphp-php>php_objFactoryphp php=php Zendphp_Pdfphp_ElementFactoryphp:php:createFactoryphp(php1php)php;
php php php php php php php php php php php php php}

php php php php php php php php php php php php php$thisphp-php>php_attachedphp php=php falsephp;
php php php php php php php php php php php php php$thisphp-php>php_safeGSphp php php php=php truephp;php php/php*php*php Newphp pagephp createdphp.php Thatphp'sphp usersphp Appphp responsibilityphp tophp trackphp GSphp changesphp php*php/
php php php php php php php php php php php php php$pageWidthphp php php=php php$paramphp1php;
php php php php php php php php php php php php php$pageHeightphp php=php php$paramphp2php;

php php php php php php php php php}php elsephp php{
php php php php php php php php php php php php requirephp_oncephp php'Zendphp/Pdfphp/Exceptionphp.phpphp'php;
php php php php php php php php php php php php throwphp newphp Zendphp_Pdfphp_Exceptionphp(php'Unrecognizedphp methodphp signaturephp,php wrongphp numberphp ofphp argumentsphp orphp wrongphp argumentphp typesphp.php'php)php;
php php php php php php php php php}

php php php php php php php php php$thisphp-php>php_dictionaryphp php=php php$thisphp-php>php_objFactoryphp-php>newObjectphp(newphp Zendphp_Pdfphp_Elementphp_Dictionaryphp(php)php)php;
php php php php php php php php php$thisphp-php>php_dictionaryphp-php>Typephp php php php php php php php php php=php newphp Zendphp_Pdfphp_Elementphp_Namephp(php'Pagephp'php)php;
php php php php php php php php requirephp_oncephp php'Zendphp/Pdfphp.phpphp'php;
php php php php php php php php php$thisphp-php>php_dictionaryphp-php>LastModifiedphp php=php newphp Zendphp_Pdfphp_Elementphp_Stringphp(Zendphp_Pdfphp:php:pdfDatephp(php)php)php;
php php php php php php php php php$thisphp-php>php_dictionaryphp-php>Resourcesphp php php php php=php newphp Zendphp_Pdfphp_Elementphp_Dictionaryphp(php)php;
php php php php php php php php php$thisphp-php>php_dictionaryphp-php>MediaBoxphp php php php php php=php newphp Zendphp_Pdfphp_Elementphp_Arrayphp(php)php;
php php php php php php php php php$thisphp-php>php_dictionaryphp-php>MediaBoxphp-php>itemsphp[php]php php=php newphp Zendphp_Pdfphp_Elementphp_Numericphp(php0php)php;
php php php php php php php php php$thisphp-php>php_dictionaryphp-php>MediaBoxphp-php>itemsphp[php]php php=php newphp Zendphp_Pdfphp_Elementphp_Numericphp(php0php)php;
php php php php php php php php php$thisphp-php>php_dictionaryphp-php>MediaBoxphp-php>itemsphp[php]php php=php newphp Zendphp_Pdfphp_Elementphp_Numericphp(php$pageWidthphp)php;
php php php php php php php php php$thisphp-php>php_dictionaryphp-php>MediaBoxphp-php>itemsphp[php]php php=php newphp Zendphp_Pdfphp_Elementphp_Numericphp(php$pageHeightphp)php;
php php php php php php php php php$thisphp-php>php_dictionaryphp-php>Contentsphp php php php php php=php newphp Zendphp_Pdfphp_Elementphp_Arrayphp(php)php;
php php php php php}


php php php php php/php*php*
php php php php php php*php Attachphp resourcephp tophp thephp canvas
php php php php php php*
php php php php php php*php Methodphp returnsphp aphp namephp ofphp thephp resourcephp whichphp canphp bephp used
php php php php php php*php asphp aphp resourcephp referencephp withinphp drawingphp instructionsphp stream
php php php php php php*php Allowedphp typesphp:php php'ExtGStatephp'php,php php'ColorSpacephp'php,php php'Patternphp'php,php php'Shadingphp'php,
php php php php php php*php php'XObjectphp'php,php php'Fontphp'php,php php'Propertiesphp'
php php php php php php*
php php php php php php*php php@paramphp stringphp php$type
php php php php php php*php php@paramphp Zendphp_Pdfphp_Resourcephp php$resource
php php php php php php*php php@returnphp string
php php php php php php*php/
php php php php protectedphp functionphp php_attachResourcephp(php$typephp,php Zendphp_Pdfphp_Resourcephp php$resourcephp)
php php php php php{
php php php php php php php php php/php/php Checkphp thatphp Resourcesphp dictionaryphp containsphp appropriatephp resourcephp set
php php php php php php php php ifphp php(php$thisphp-php>php_dictionaryphp-php>Resourcesphp-php>php$typephp php=php=php=php nullphp)php php{
php php php php php php php php php php php php php$thisphp-php>php_dictionaryphp-php>Resourcesphp-php>touchphp(php)php;
php php php php php php php php php php php php php$thisphp-php>php_dictionaryphp-php>Resourcesphp-php>php$typephp php=php newphp Zendphp_Pdfphp_Elementphp_Dictionaryphp(php)php;
php php php php php php php php php}php elsephp php{
php php php php php php php php php php php php php$thisphp-php>php_dictionaryphp-php>Resourcesphp-php>php$typephp-php>touchphp(php)php;
php php php php php php php php php}

php php php php php php php php php/php/php Checkphp,php thatphp resourcephp isphp alreadyphp attachedphp tophp resourcephp setphp.
php php php php php php php php php$resObjectphp php=php php$resourcephp-php>getResourcephp(php)php;
php php php php php php php php foreachphp php(php$thisphp-php>php_dictionaryphp-php>Resourcesphp-php>php$typephp-php>getKeysphp(php)php asphp php$ResIDphp)php php{
php php php php php php php php php php php php ifphp php(php$thisphp-php>php_dictionaryphp-php>Resourcesphp-php>php$typephp-php>php$ResIDphp php=php=php=php php$resObjectphp)php php{
php php php php php php php php php php php php php php php php returnphp php$ResIDphp;
php php php php php php php php php php php php php}
php php php php php php php php php}

php php php php php php php php php$idCounterphp php=php php1php;
php php php php php php php php dophp php{
php php php php php php php php php php php php php$newResNamephp php=php php$typephp[php0php]php php.php php$idCounterphp+php+php;
php php php php php php php php php}php whilephp php(php$thisphp-php>php_dictionaryphp-php>Resourcesphp-php>php$typephp-php>php$newResNamephp php!php=php=php nullphp)php;

php php php php php php php php php$thisphp-php>php_dictionaryphp-php>Resourcesphp-php>php$typephp-php>php$newResNamephp php=php php$resObjectphp;
php php php php php php php php php$thisphp-php>php_objFactoryphp-php>attachphp(php$resourcephp-php>getFactoryphp(php)php)php;

php php php php php php php php returnphp php$newResNamephp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Addphp procedureSetphp tophp thephp Pagephp description
php php php php php php*
php php php php php php*php php@paramphp stringphp php$procSetName
php php php php php php*php/
php php php php protectedphp functionphp php_addProcSetphp(php$procSetNamephp)
php php php php php{
php php php php php php php php php/php/php Checkphp thatphp Resourcesphp dictionaryphp containsphp ProcSetphp entry
php php php php php php php php ifphp php(php$thisphp-php>php_dictionaryphp-php>Resourcesphp-php>ProcSetphp php=php=php=php nullphp)php php{
php php php php php php php php php php php php php$thisphp-php>php_dictionaryphp-php>Resourcesphp-php>touchphp(php)php;
php php php php php php php php php php php php php$thisphp-php>php_dictionaryphp-php>Resourcesphp-php>ProcSetphp php=php newphp Zendphp_Pdfphp_Elementphp_Arrayphp(php)php;
php php php php php php php php php}php elsephp php{
php php php php php php php php php php php php php$thisphp-php>php_dictionaryphp-php>Resourcesphp-php>ProcSetphp-php>touchphp(php)php;
php php php php php php php php php}

php php php php php php php php foreachphp php(php$thisphp-php>php_dictionaryphp-php>Resourcesphp-php>ProcSetphp-php>itemsphp asphp php$procSetEntryphp)php php{
php php php php php php php php php php php php ifphp php(php$procSetEntryphp-php>valuephp php=php=php php$procSetNamephp)php php{
php php php php php php php php php php php php php php php php php/php/php Procsetphp isphp alreadyphp includedphp intophp aphp ProcSetphp array
php php php php php php php php php php php php php php php php returnphp;
php php php php php php php php php php php php php}
php php php php php php php php php}

php php php php php php php php php$thisphp-php>php_dictionaryphp-php>Resourcesphp-php>ProcSetphp-php>itemsphp[php]php php=php newphp Zendphp_Pdfphp_Elementphp_Namephp(php$procSetNamephp)php;
php php php php php}

php php php php php/php*php*
php php php php php php*php Returnsphp dictionariesphp ofphp usedphp resourcesphp.
php php php php php php*
php php php php php php*php Usedphp forphp canvasphp implementationsphp interoperability
php php php php php php*
php php php php php php*php Structurephp ofphp thephp returnedphp arrayphp:
php php php php php php*php arrayphp(
php php php php php php*php php php php<resTypeNamephp>php php=php>php arrayphp(
php php php php php php*php php php php php php php php php php php php php php php php php php php php php php php<resNamephp>php php=php>php php<Zendphp_Pdfphp_Resourcephp objectphp>php,
php php php php php php*php php php php php php php php php php php php php php php php php php php php php php php<resNamephp>php php=php>php php<Zendphp_Pdfphp_Resourcephp objectphp>php,
php php php php php php*php php php php php php php php php php php php php php php php php php php php php php php<resNamephp>php php=php>php php<Zendphp_Pdfphp_Resourcephp objectphp>php,
php php php php php php*php php php php php php php php php php php php php php php php php php php php php php php.php.php.
php php php php php php*php php php php php php php php php php php php php php php php php php php php php)php,
php php php php php php*php php php php<resTypeNamephp>php php=php>php arrayphp(
php php php php php php*php php php php php php php php php php php php php php php php php php php php php php php<resNamephp>php php=php>php php<Zendphp_Pdfphp_Resourcephp objectphp>php,
php php php php php php*php php php php php php php php php php php php php php php php php php php php php php php<resNamephp>php php=php>php php<Zendphp_Pdfphp_Resourcephp objectphp>php,
php php php php php php*php php php php php php php php php php php php php php php php php php php php php php php<resNamephp>php php=php>php php<Zendphp_Pdfphp_Resourcephp objectphp>php,
php php php php php php*php php php php php php php php php php php php php php php php php php php php php php php.php.php.
php php php php php php*php php php php php php php php php php php php php php php php php php php php php)php,
php php php php php php*php php php php.php.php.
php php php php php php*php php php php'ProcSetphp'php php=php>php arrayphp(php)
php php php php php php*php php)
php php php php php php*
php php php php php php*php wherephp ProcSetphp arrayphp isphp aphp listphp ofphp usedphp procedurephp setsphp namesphp php(stringsphp)php.
php php php php php php*php Allowedphp procedurephp setphp namesphp:php php'PDFphp'php,php php'Textphp'php,php php'ImageBphp'php,php php'ImageCphp'php,php php'ImageIphp'
php php php php php php*
php php php php php php*php php@internal
php php php php php php*php php@returnphp array
php php php php php php*php/
php php php php publicphp functionphp getResourcesphp(php)
php php php php php{
php php php php php php php php php$resourcesphp php=php arrayphp(php)php;
php php php php php php php php php$resDictionaryphp php=php php$thisphp-php>php_dictionaryphp-php>Resourcesphp;

php php php php php php php php foreachphp php(php$resDictionaryphp-php>getKeysphp(php)php asphp php$resTypephp)php php{
php php php php php php php php php php php php php$resourcesphp[php$resTypephp]php php=php arrayphp(php)php;

php php php php php php php php php php php php ifphp php(php$resTypephp php=php=php php'ProcSetphp'php)php php{
php php php php php php php php php php php php php php php php foreachphp php(php$resDictionaryphp-php>ProcSetphp-php>itemsphp asphp php$procSetEntryphp)php php{
php php php php php php php php php php php php php php php php php php php php php$resourcesphp[php$resTypephp]php[php]php php=php php$procSetEntryphp-php>valuephp;
php php php php php php php php php php php php php php php php php}
php php php php php php php php php php php php php}php elsephp php{
php php php php php php php php php php php php php php php php php$resMapphp php=php php$resDictionaryphp-php>php$resTypephp;

php php php php php php php php php php php php php php php php foreachphp php(php$resMapphp-php>getKeysphp(php)php asphp php$resIdphp)php php{
php php php php php php php php php php php php php php php php php php php php php$resourcesphp[php$resTypephp]php[php$resIdphp]php php=newphp Zendphp_Pdfphp_Resourcephp_Unifiedphp(php$resMapphp-php>php$resIdphp)php;
php php php php php php php php php php php php php php php php php}
php php php php php php php php php php php php php}
php php php php php php php php php}

php php php php php php php php returnphp php$resourcesphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Getphp drawingphp instructionsphp stream
php php php php php php*
php php php php php php*php Itphp hasphp tophp bephp returnedphp asphp aphp PDFphp streamphp objectphp tophp makephp itphp reusablephp.
php php php php php php*
php php php php php php*php php@internal
php php php php php php*php php@returnsphp Zendphp_Pdfphp_Resourcephp_ContentStream
php php php php php php*php/
php php php php publicphp functionphp getContentsphp(php)
php php php php php{
php php php php php php php php php/php*php*php php@todophp implementationphp php*php/
php php php php php}

php php php php php/php*php*
php php php php php php*php Returnphp thephp heightphp ofphp thisphp pagephp inphp pointsphp.
php php php php php php*
php php php php php php*php php@returnphp float
php php php php php php*php/
php php php php publicphp functionphp getHeightphp(php)
php php php php php{
php php php php php php php php returnphp php$thisphp-php>php_dictionaryphp-php>MediaBoxphp-php>itemsphp[php3php]php-php>valuephp php-
php php php php php php php php php php php php php php php php$thisphp-php>php_dictionaryphp-php>MediaBoxphp-php>itemsphp[php1php]php-php>valuephp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Returnphp thephp widthphp ofphp thisphp pagephp inphp pointsphp.
php php php php php php*
php php php php php php*php php@returnphp float
php php php php php php*php/
php php php php publicphp functionphp getWidthphp(php)
php php php php php{
php php php php php php php php returnphp php$thisphp-php>php_dictionaryphp-php>MediaBoxphp-php>itemsphp[php2php]php-php>valuephp php-
php php php php php php php php php php php php php php php php$thisphp-php>php_dictionaryphp-php>MediaBoxphp-php>itemsphp[php0php]php-php>valuephp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Clonephp pagephp,php extractphp itphp andphp dependentphp objectsphp fromphp thephp currentphp documentphp,
php php php php php php*php sophp itphp canphp bephp usedphp withinphp otherphp docsphp.
php php php php php php*php/
php php php php publicphp functionphp php_php_clonephp(php)
php php php php php{
php php php php php php php php php$factoryphp php=php Zendphp_Pdfphp_ElementFactoryphp:php:createFactoryphp(php1php)php;
php php php php php php php php php$processedphp php=php arrayphp(php)php;

php php php php php php php php php/php/php Clonephp dictionaryphp objectphp.
php php php php php php php php php/php/php Dophp itphp explicitlyphp tophp preventphp sharingphp pagephp attributesphp betweenphp different
php php php php php php php php php/php/php resultsphp ofphp clonePagephp(php)php operationphp php(otherphp resourcesphp arephp stillphp sharedphp)
php php php php php php php php php$dictionaryphp php=php newphp Zendphp_Pdfphp_Elementphp_Dictionaryphp(php)php;
php php php php php php php php foreachphp php(php$thisphp-php>php_dictionaryphp-php>getKeysphp(php)php asphp php$keyphp)php php{
php php php php php php php php php php php php php$dictionaryphp-php>php$keyphp php=php php$thisphp-php>php_dictionaryphp-php>php$keyphp-php>makeClonephp(php$factoryphp-php>getFactoryphp(php)php,
php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php$processedphp,
php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php Zendphp_Pdfphp_Elementphp:php:CLONEphp_MODEphp_SKIPphp_PAGESphp)php;
php php php php php php php php php}

php php php php php php php php php$thisphp-php>php_dictionaryphp php=php php$factoryphp-php>newObjectphp(php$dictionaryphp)php;
php php php php php php php php php$thisphp-php>php_objFactoryphp php php php php php=php php$factoryphp;
php php php php php php php php php$thisphp-php>php_attachedphp php php php php php php php=php falsephp;
php php php php php php php php php$thisphp-php>php_stylephp php php php php php php php php php php=php nullphp;
php php php php php php php php php$thisphp-php>php_fontphp php php php php php php php php php php php=php nullphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Clonephp pagephp,php extractphp itphp andphp dependentphp objectsphp fromphp thephp currentphp documentphp,
php php php php php php*php sophp itphp canphp bephp usedphp withinphp otherphp docsphp.
php php php php php php*
php php php php php php*php php@internal
php php php php php php*php php@paramphp Zendphp_Pdfphp_ElementFactoryphp_Interfacephp php$factory
php php php php php php*php php@paramphp arrayphp php$processed
php php php php php php*php php@returnphp Zendphp_Pdfphp_Page
php php php php php php*php/
php php php php publicphp functionphp clonePagephp(php$factoryphp,php php&php$processedphp)
php php php php php{
php php php php php php php php php/php/php Clonephp dictionaryphp objectphp.
php php php php php php php php php/php/php Dophp itphp explicitlyphp tophp preventphp sharingphp pagephp attributesphp betweenphp different
php php php php php php php php php/php/php resultsphp ofphp clonePagephp(php)php operationphp php(otherphp resourcesphp arephp stillphp sharedphp)
php php php php php php php php php$dictionaryphp php=php newphp Zendphp_Pdfphp_Elementphp_Dictionaryphp(php)php;
php php php php php php php php foreachphp php(php$thisphp-php>php_dictionaryphp-php>getKeysphp(php)php asphp php$keyphp)php php{
php php php php php php php php php php php php php$dictionaryphp-php>php$keyphp php=php php$thisphp-php>php_dictionaryphp-php>php$keyphp-php>makeClonephp(php$factoryphp-php>getFactoryphp(php)php,
php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php$processedphp,
php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php Zendphp_Pdfphp_Elementphp:php:CLONEphp_MODEphp_SKIPphp_PAGESphp)php;
php php php php php php php php php}

php php php php php php php php php$clonedPagephp php=php newphp Zendphp_Pdfphp_Pagephp(php$factoryphp-php>newObjectphp(php$dictionaryphp)php,php php$factoryphp)php;
php php php php php php php php php$clonedPagephp-php>php_attachedphp php=php falsephp;

php php php php php php php php returnphp php$clonedPagephp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Retrivephp PDFphp filephp referencephp tophp thephp page
php php php php php php*
php php php php php php*php php@internal
php php php php php php*php php@returnphp Zendphp_Pdfphp_Elementphp_Dictionary
php php php php php php*php/
php php php php publicphp functionphp getPageDictionaryphp(php)
php php php php php{
php php php php php php php php returnphp php$thisphp-php>php_dictionaryphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Dumpphp currentphp drawingphp instructionsphp intophp thephp contentphp streamphp.
php php php php php php*
php php php php php php*php php@todophp Donphp'tphp forgetphp tophp closephp allphp currentphp graphicsphp operationsphp php(likephp pathphp drawingphp)
php php php php php php*
php php php php php php*php php@throwsphp Zendphp_Pdfphp_Exception
php php php php php php*php/
php php php php publicphp functionphp flushphp(php)
php php php php php{
php php php php php php php php ifphp php(php$thisphp-php>php_saveCountphp php!php=php php0php)php php{
php php php php php php php php php php php php requirephp_oncephp php'Zendphp/Pdfphp/Exceptionphp.phpphp'php;
php php php php php php php php php php php php throwphp newphp Zendphp_Pdfphp_Exceptionphp(php'Savedphp graphicsphp statephp isphp notphp restoredphp'php)php;
php php php php php php php php php}

php php php php php php php php ifphp php(php$thisphp-php>php_contentsphp php=php=php php'php'php)php php{
php php php php php php php php php php php php returnphp;
php php php php php php php php php}

php php php php php php php php ifphp php(php$thisphp-php>php_dictionaryphp-php>Contentsphp-php>getTypephp(php)php php!php=php Zendphp_Pdfphp_Elementphp:php:TYPEphp_ARRAYphp)php php{
php php php php php php php php php php php php php/php*php*
php php php php php php php php php php php php php php*php Itphp'sphp aphp streamphp objectphp.
php php php php php php php php php php php php php php*php Preparephp Contentsphp pagephp attributephp forphp updatephp.
php php php php php php php php php php php php php php*php/
php php php php php php php php php php php php php$thisphp-php>php_dictionaryphp-php>touchphp(php)php;

php php php php php php php php php php php php php$currentPageContentsphp php=php php$thisphp-php>php_dictionaryphp-php>Contentsphp;
php php php php php php php php php php php php php$thisphp-php>php_dictionaryphp-php>Contentsphp php=php newphp Zendphp_Pdfphp_Elementphp_Arrayphp(php)php;
php php php php php php php php php php php php php$thisphp-php>php_dictionaryphp-php>Contentsphp-php>itemsphp[php]php php=php php$currentPageContentsphp;
php php php php php php php php php}php elsephp php{
php php php php php php php php php php php php php$thisphp-php>php_dictionaryphp-php>Contentsphp-php>touchphp(php)php;
php php php php php php php php php}

php php php php php php php php ifphp php(php(php!php$thisphp-php>php_safeGSphp)php php php&php&php php php(countphp(php$thisphp-php>php_dictionaryphp-php>Contentsphp-php>itemsphp)php php!php=php php0php)php)php php{
php php php php php php php php php php php php php/php*php*
php php php php php php php php php php php php php php*php Pagephp alreadyphp hasphp somephp contentphp whichphp isphp notphp treatedphp asphp safephp.
php php php php php php php php php php php php php php*
php php php php php php php php php php php php php php*php Addphp savephp/restorephp GSphp operators
php php php php php php php php php php php php php php*php/
php php php php php php php php php php php php php$thisphp-php>php_addProcSetphp(php'PDFphp'php)php;

php php php php php php php php php php php php php$newContentsArrayphp php=php newphp Zendphp_Pdfphp_Elementphp_Arrayphp(php)php;
php php php php php php php php php php php php php$newContentsArrayphp-php>itemsphp[php]php php=php php$thisphp-php>php_objFactoryphp-php>newStreamObjectphp(php"php qphp\nphp"php)php;
php php php php php php php php php php php php foreachphp php(php$thisphp-php>php_dictionaryphp-php>Contentsphp-php>itemsphp asphp php$contentStreamphp)php php{
php php php php php php php php php php php php php php php php php$newContentsArrayphp-php>itemsphp[php]php php=php php$contentStreamphp;
php php php php php php php php php php php php php}
php php php php php php php php php php php php php$newContentsArrayphp-php>itemsphp[php]php php=php php$thisphp-php>php_objFactoryphp-php>newStreamObjectphp(php"php Qphp\nphp"php)php;

php php php php php php php php php php php php php$thisphp-php>php_dictionaryphp-php>touchphp(php)php;
php php php php php php php php php php php php php$thisphp-php>php_dictionaryphp-php>Contentsphp php=php php$newContentsArrayphp;

php php php php php php php php php php php php php$thisphp-php>php_safeGSphp php=php truephp;
php php php php php php php php php}

php php php php php php php php php$thisphp-php>php_dictionaryphp-php>Contentsphp-php>itemsphp[php]php php=
php php php php php php php php php php php php php php php php php$thisphp-php>php_objFactoryphp-php>newStreamObjectphp(php$thisphp-php>php_contentsphp)php;

php php php php php php php php php$thisphp-php>php_contentsphp php=php php'php'php;
php php php php php}

php php php php php/php*php*
php php php php php php*php Preparephp pagephp tophp bephp renderedphp intophp PDFphp.
php php php php php php*
php php php php php php*php php@todophp Donphp'tphp forgetphp tophp closephp allphp currentphp graphicsphp operationsphp php(likephp pathphp drawingphp)
php php php php php php*
php php php php php php*php php@paramphp Zendphp_Pdfphp_ElementFactoryphp_Interfacephp php$objFactory
php php php php php php*php php@throwsphp Zendphp_Pdfphp_Exception
php php php php php php*php/
php php php php publicphp functionphp renderphp(Zendphp_Pdfphp_ElementFactoryphp_Interfacephp php$objFactoryphp)
php php php php php{
php php php php php php php php php$thisphp-php>flushphp(php)php;

php php php php php php php php ifphp php(php$objFactoryphp php=php=php=php php$thisphp-php>php_objFactoryphp)php php{
php php php php php php php php php php php php php/php/php Pagephp isphp alreadyphp attachedphp tophp thephp documentphp.
php php php php php php php php php php php php returnphp;
php php php php php php php php php}

php php php php php php php php ifphp php(php$thisphp-php>php_attachedphp)php php{
php php php php php php php php php php php php requirephp_oncephp php'Zendphp/Pdfphp/Exceptionphp.phpphp'php;
php php php php php php php php php php php php throwphp newphp Zendphp_Pdfphp_Exceptionphp(php'Pagephp isphp attachedphp tophp otherphp documenphp.php Usephp clonephp php$pagephp tophp getphp itphp contextphp freephp.php'php)php;
php php php php php php php php php}php elsephp php{
php php php php php php php php php php php php php$objFactoryphp-php>attachphp(php$thisphp-php>php_objFactoryphp)php;
php php php php php php php php php}
php php php php php}

php php php php php/php*php*
php php php php php php*php Extractphp resourcesphp attachedphp tophp thephp page
php php php php php php*
php php php php php php*php Thisphp methodphp isphp notphp intendedphp tophp bephp usedphp inphp userlandphp,php butphp helpsphp tophp optimizephp somephp documentphp widephp operations
php php php php php php*
php php php php php php*php returnsphp arrayphp ofphp Zendphp_Pdfphp_Elementphp_Dictionaryphp objects
php php php php php php*
php php php php php php*php php@internal
php php php php php php*php php@returnphp array
php php php php php php*php/
php php php php publicphp functionphp extractResourcesphp(php)
php php php php php{
php php php php php php php php returnphp php$thisphp-php>php_dictionaryphp-php>Resourcesphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Extractphp fontsphp attachedphp tophp thephp page
php php php php php php*
php php php php php php*php returnsphp arrayphp ofphp Zendphp_Pdfphp_Resourcephp_Fontphp_Extractedphp objects
php php php php php php*
php php php php php php*php php@returnphp array
php php php php php php*php php@throwsphp Zendphp_Pdfphp_Exception
php php php php php php*php/
php php php php publicphp functionphp extractFontsphp(php)
php php php php php{
php php php php php php php php ifphp php(php$thisphp-php>php_dictionaryphp-php>Resourcesphp-php>Fontphp php=php=php=php nullphp)php php{
php php php php php php php php php php php php php/php/php Pagephp doesnphp'tphp havephp anyphp fontphp attached
php php php php php php php php php php php php php/php/php Returnphp emptyphp array
php php php php php php php php php php php php returnphp arrayphp(php)php;
php php php php php php php php php}

php php php php php php php php php$fontResourcesphp php=php php$thisphp-php>php_dictionaryphp-php>Resourcesphp-php>Fontphp;

php php php php php php php php php$fontResourcesUniquephp php=php arrayphp(php)php;
php php php php php php php php foreachphp php(php$fontResourcesphp-php>getKeysphp(php)php asphp php$fontResourceNamephp)php php{
php php php php php php php php php php php php php$fontDictionaryphp php=php php$fontResourcesphp-php>php$fontResourceNamephp;

php php php php php php php php php php php php ifphp php(php!php php(php$fontDictionaryphp instanceofphp Zendphp_Pdfphp_Elementphp_Referencephp php php|php|
php php php php php php php php php php php php php php php php php php php php$fontDictionaryphp instanceofphp Zendphp_Pdfphp_Elementphp_Objectphp)php php)php php{
php php php php php php php php php php php php php php php php requirephp_oncephp php'Zendphp/Pdfphp/Exceptionphp.phpphp'php;
php php php php php php php php php php php php php php php php throwphp newphp Zendphp_Pdfphp_Exceptionphp(php'Fontphp dictionaryphp hasphp tophp bephp anphp indirectphp objectphp orphp objectphp referencephp.php'php)php;
php php php php php php php php php php php php php}

php php php php php php php php php php php php php$fontResourcesUniquephp[splphp_objectphp_hashphp(php$fontDictionaryphp-php>getObjectphp(php)php)php]php php=php php$fontDictionaryphp;
php php php php php php php php php}

php php php php php php php php php$fontsphp php=php arrayphp(php)php;
php php php php php php php php requirephp_oncephp php'Zendphp/Pdfphp/Exceptionphp.phpphp'php;
php php php php php php php php foreachphp php(php$fontResourcesUniquephp asphp php$resourceIdphp php=php>php php$fontDictionaryphp)php php{
php php php php php php php php php php php php tryphp php{
php php php php php php php php php php php php php php php php requirephp_oncephp php'Zendphp/Pdfphp/Resourcephp/Fontphp/Extractedphp.phpphp'php;
php php php php php php php php php php php php php php php php php/php/php Tryphp tophp extractphp font
php php php php php php php php php php php php php php php php php$extractedFontphp php=php newphp Zendphp_Pdfphp_Resourcephp_Fontphp_Extractedphp(php$fontDictionaryphp)php;

php php php php php php php php php php php php php php php php php$fontsphp[php$resourceIdphp]php php=php php$extractedFontphp;
php php php php php php php php php php php php php}php catchphp php(Zendphp_Pdfphp_Exceptionphp php$ephp)php php{
php php php php php php php php php php php php php php php php ifphp php(php$ephp-php>getMessagephp(php)php php!php=php php'Unsupportedphp fontphp typephp.php'php)php php{
php php php php php php php php php php php php php php php php php php php php throwphp newphp Zendphp_Pdfphp_Exceptionphp(php$ephp-php>getMessagephp(php)php,php php$ephp-php>getCodephp(php)php,php php$ephp)php;
php php php php php php php php php php php php php php php php php}
php php php php php php php php php php php php php}
php php php php php php php php php}

php php php php php php php php returnphp php$fontsphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Extractphp fontphp attachedphp tophp thephp pagephp byphp specificphp fontphp name
php php php php php php*
php php php php php php*php php$fontNamephp shouldphp bephp specifiedphp inphp UTFphp-php8php encoding
php php php php php php*
php php php php php php*php php@returnphp Zendphp_Pdfphp_Resourcephp_Fontphp_Extractedphp|null
php php php php php php*php php@throwsphp Zendphp_Pdfphp_Exception
php php php php php php*php/
php php php php publicphp functionphp extractFontphp(php$fontNamephp)
php php php php php{
php php php php php php php php ifphp php(php$thisphp-php>php_dictionaryphp-php>Resourcesphp-php>Fontphp php=php=php=php nullphp)php php{
php php php php php php php php php php php php php/php/php Pagephp doesnphp'tphp havephp anyphp fontphp attached
php php php php php php php php php php php php returnphp nullphp;
php php php php php php php php php}

php php php php php php php php php$fontResourcesphp php=php php$thisphp-php>php_dictionaryphp-php>Resourcesphp-php>Fontphp;

php php php php php php php php php$fontResourcesUniquephp php=php arrayphp(php)php;

php php php php php php php php requirephp_oncephp php'Zendphp/Pdfphp/Exceptionphp.phpphp'php;
php php php php php php php php foreachphp php(php$fontResourcesphp-php>getKeysphp(php)php asphp php$fontResourceNamephp)php php{
php php php php php php php php php php php php php$fontDictionaryphp php=php php$fontResourcesphp-php>php$fontResourceNamephp;

php php php php php php php php php php php php ifphp php(php!php php(php$fontDictionaryphp instanceofphp Zendphp_Pdfphp_Elementphp_Referencephp php php|php|
php php php php php php php php php php php php php php php php php php php php$fontDictionaryphp instanceofphp Zendphp_Pdfphp_Elementphp_Objectphp)php php)php php{
php php php php php php php php php php php php php php php php requirephp_oncephp php'Zendphp/Pdfphp/Exceptionphp.phpphp'php;
php php php php php php php php php php php php php php php php throwphp newphp Zendphp_Pdfphp_Exceptionphp(php'Fontphp dictionaryphp hasphp tophp bephp anphp indirectphp objectphp orphp objectphp referencephp.php'php)php;
php php php php php php php php php php php php php}

php php php php php php php php php php php php php$resourceIdphp php=php splphp_objectphp_hashphp(php$fontDictionaryphp-php>getObjectphp(php)php)php;
php php php php php php php php php php php php ifphp php(issetphp(php$fontResourcesUniquephp[php$resourceIdphp]php)php)php php{
php php php php php php php php php php php php php php php php continuephp;
php php php php php php php php php php php php php}php elsephp php{
php php php php php php php php php php php php php php php php php/php/php Markphp resourcephp asphp processed
php php php php php php php php php php php php php php php php php$fontResourcesUniquephp[php$resourceIdphp]php php=php php1php;
php php php php php php php php php php php php php}

php php php php php php php php php php php php ifphp php(php$fontDictionaryphp-php>BaseFontphp-php>valuephp php!php=php php$fontNamephp)php php{
php php php php php php php php php php php php php php php php continuephp;
php php php php php php php php php php php php php}

php php php php php php php php php php php php tryphp php{
php php php php php php php php php php php php php php php php php/php/php Tryphp tophp extractphp font
php php php php php php php php php php php php php php php php requirephp_oncephp php'Zendphp/Pdfphp/Resourcephp/Fontphp/Extractedphp.phpphp'php;
php php php php php php php php php php php php php php php php returnphp newphp Zendphp_Pdfphp_Resourcephp_Fontphp_Extractedphp(php$fontDictionaryphp)php;
php php php php php php php php php php php php php}php catchphp php(Zendphp_Pdfphp_Exceptionphp php$ephp)php php{
php php php php php php php php php php php php php php php php ifphp php(php$ephp-php>getMessagephp(php)php php!php=php php'Unsupportedphp fontphp typephp.php'php)php php{
php php php php php php php php php php php php php php php php php php php php throwphp newphp Zendphp_Pdfphp_Exceptionphp(php$ephp-php>getMessagephp(php)php,php php$ephp-php>getCodephp(php)php,php php$ephp)php;
php php php php php php php php php php php php php php php php php}

php php php php php php php php php php php php php php php php php/php/php Continuephp searhingphp fontphp withphp specifiedphp name
php php php php php php php php php php php php php}
php php php php php php php php php}

php php php php php php php php returnphp nullphp;
php php php php php}

php php php php php/php*php*
php php php php php php*
php php php php php php*php php@paramphp Zendphp_Pdfphp_Annotationphp php$annotation
php php php php php php*php php@returnphp Zendphp_Pdfphp_Page
php php php php php php*php/
php php php php publicphp functionphp attachAnnotationphp(Zendphp_Pdfphp_Annotationphp php$annotationphp)
php php php php php{
php php php php php php php php php$annotationDictionaryphp php=php php$annotationphp-php>getResourcephp(php)php;
php php php php php php php php ifphp php(php!php$annotationDictionaryphp instanceofphp Zendphp_Pdfphp_Elementphp_Objectphp php php&php&
php php php php php php php php php php php php php!php$annotationDictionaryphp instanceofphp Zendphp_Pdfphp_Elementphp_Referencephp)php php{
php php php php php php php php php php php php php$annotationDictionaryphp php=php php$thisphp-php>php_objFactoryphp-php>newObjectphp(php$annotationDictionaryphp)php;
php php php php php php php php php}

php php php php php php php php ifphp php(php$thisphp-php>php_dictionaryphp-php>Annotsphp php=php=php=php nullphp)php php{
php php php php php php php php php php php php php$thisphp-php>php_dictionaryphp-php>touchphp(php)php;
php php php php php php php php php php php php php$thisphp-php>php_dictionaryphp-php>Annotsphp php=php newphp Zendphp_Pdfphp_Elementphp_Arrayphp(php)php;
php php php php php php php php php}php elsephp php{
php php php php php php php php php php php php php$thisphp-php>php_dictionaryphp-php>Annotsphp-php>touchphp(php)php;
php php php php php php php php php}

php php php php php php php php php$thisphp-php>php_dictionaryphp-php>Annotsphp-php>itemsphp[php]php php=php php$annotationDictionaryphp;

php php php php php php php php php$annotationDictionaryphp-php>touchphp(php)php;
php php php php php php php php php$annotationDictionaryphp-php>Pphp php=php php$thisphp-php>php_dictionaryphp;

php php php php php php php php returnphp php$thisphp;
php php php php php}
php}

