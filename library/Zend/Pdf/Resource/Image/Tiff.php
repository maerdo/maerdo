<php?php
php/php*php*
php php*php Zendphp Framework
php php*
php php*php LICENSE
php php*
php php*php Thisphp sourcephp filephp isphp subjectphp tophp thephp newphp BSDphp licensephp thatphp isphp bundled
php php*php withphp thisphp packagephp inphp thephp filephp LICENSEphp.txtphp.
php php*php Itphp isphp alsophp availablephp throughphp thephp worldphp-widephp-webphp atphp thisphp URLphp:
php php*php httpphp:php/php/frameworkphp.zendphp.comphp/licensephp/newphp-bsd
php php*php Ifphp youphp didphp notphp receivephp aphp copyphp ofphp thephp licensephp andphp arephp unablephp to
php php*php obtainphp itphp throughphp thephp worldphp-widephp-webphp,php pleasephp sendphp anphp email
php php*php tophp licensephp@zendphp.comphp sophp wephp canphp sendphp youphp aphp copyphp immediatelyphp.
php php*
php php*php php@categoryphp php php Zend
php php*php php@packagephp php php php Zendphp_Pdf
php php*php php@copyrightphp php Copyrightphp php(cphp)php php2php0php0php5php-php2php0php1php0php Zendphp Technologiesphp USAphp Incphp.php php(httpphp:php/php/wwwphp.zendphp.comphp)
php php*php php@licensephp php php php httpphp:php/php/frameworkphp.zendphp.comphp/licensephp/newphp-bsdphp php php php php Newphp BSDphp License
php php*php php@versionphp php php php php$Idphp:php Tiffphp.phpphp php2php0php0php9php6php php2php0php1php0php-php0php1php-php0php6php php0php2php:php0php5php:php0php9Zphp bkarwinphp php$
php php*php/

php/php*php*php Internallyphp usedphp classesphp php*php/
requirephp_oncephp php'Zendphp/Pdfphp/Elementphp/Arrayphp.phpphp'php;
requirephp_oncephp php'Zendphp/Pdfphp/Elementphp/Namephp.phpphp'php;
requirephp_oncephp php'Zendphp/Pdfphp/Elementphp/Numericphp.phpphp'php;


php/php*php*php Zendphp_Pdfphp_Resourcephp_Imagephp php*php/
requirephp_oncephp php'Zendphp/Pdfphp/Resourcephp/Imagephp.phpphp'php;

php/php*php*
php php*php TIFFphp image
php php*
php php*php php@packagephp php php php Zendphp_Pdf
php php*php php@copyrightphp php Copyrightphp php(cphp)php php2php0php0php5php-php2php0php1php0php Zendphp Technologiesphp USAphp Incphp.php php(httpphp:php/php/wwwphp.zendphp.comphp)
php php*php php@licensephp php php php httpphp:php/php/frameworkphp.zendphp.comphp/licensephp/newphp-bsdphp php php php php Newphp BSDphp License
php php*php/
classphp Zendphp_Pdfphp_Resourcephp_Imagephp_Tiffphp extendsphp Zendphp_Pdfphp_Resourcephp_Image
php{
php php php php constphp TIFFphp_FIELDphp_TYPEphp_BYTEphp=php1php;
php php php php constphp TIFFphp_FIELDphp_TYPEphp_ASCIIphp=php2php;
php php php php constphp TIFFphp_FIELDphp_TYPEphp_SHORTphp=php3php;
php php php php constphp TIFFphp_FIELDphp_TYPEphp_LONGphp=php4php;
php php php php constphp TIFFphp_FIELDphp_TYPEphp_RATIONALphp=php5php;

php php php php constphp TIFFphp_TAGphp_IMAGEphp_WIDTHphp=php2php5php6php;
php php php php constphp TIFFphp_TAGphp_IMAGEphp_LENGTHphp=php2php5php7php;php php/php/Height
php php php php constphp TIFFphp_TAGphp_BITSphp_PERphp_SAMPLEphp=php2php5php8php;
php php php php constphp TIFFphp_TAGphp_COMPRESSIONphp=php2php5php9php;
php php php php constphp TIFFphp_TAGphp_PHOTOMETRICphp_INTERPRETATIONphp=php2php6php2php;
php php php php constphp TIFFphp_TAGphp_STRIPphp_OFFSETSphp=php2php7php3php;
php php php php constphp TIFFphp_TAGphp_SAMPLESphp_PERphp_PIXELphp=php2php7php7php;
php php php php constphp TIFFphp_TAGphp_STRIPphp_BYTEphp_COUNTSphp=php2php7php9php;

php php php php constphp TIFFphp_COMPRESSIONphp_UNCOMPRESSEDphp php=php php1php;
php php php php constphp TIFFphp_COMPRESSIONphp_CCITTphp1Dphp php=php php2php;
php php php php constphp TIFFphp_COMPRESSIONphp_GROUPphp_php3php_FAXphp php=php php3php;
php php php php constphp TIFFphp_COMPRESSIONphp_GROUPphp_php4php_FAXphp php php=php php4php;
php php php php constphp TIFFphp_COMPRESSIONphp_LZWphp php=php php5php;
php php php php constphp TIFFphp_COMPRESSIONphp_JPEGphp php=php php6php;
php php php php constphp TIFFphp_COMPRESSIONphp_FLATEphp php=php php8php;
php php php php constphp TIFFphp_COMPRESSIONphp_FLATEphp_OBSOLETEphp_CODEphp php=php php3php2php9php4php6php;
php php php php constphp TIFFphp_COMPRESSIONphp_PACKBITSphp php=php php3php2php7php7php3php;

php php php php constphp TIFFphp_PHOTOMETRICphp_INTERPRETATIONphp_WHITEphp_ISphp_ZEROphp=php0php;
php php php php constphp TIFFphp_PHOTOMETRICphp_INTERPRETATIONphp_BLACKphp_ISphp_ZEROphp=php1php;
php php php php constphp TIFFphp_PHOTOMETRICphp_INTERPRETATIONphp_RGBphp=php2php;
php php php php constphp TIFFphp_PHOTOMETRICphp_INTERPRETATIONphp_RGBphp_INDEXEDphp=php3php;
php php php php constphp TIFFphp_PHOTOMETRICphp_INTERPRETATIONphp_CMYKphp=php5php;
php php php php constphp TIFFphp_PHOTOMETRICphp_INTERPRETATIONphp_YCBCRphp=php6php;
php php php php constphp TIFFphp_PHOTOMETRICphp_INTERPRETATIONphp_CIELABphp=php8php;

php php php php protectedphp php$php_widthphp;
php php php php protectedphp php$php_heightphp;
php php php php protectedphp php$php_imagePropertiesphp;
php php php php protectedphp php$php_endianTypephp;
php php php php protectedphp php$php_fileSizephp;
php php php php protectedphp php$php_bitsPerSamplephp;
php php php php protectedphp php$php_compressionphp;
php php php php protectedphp php$php_filterphp;
php php php php protectedphp php$php_colorCodephp;
php php php php protectedphp php$php_whiteIsZerophp;
php php php php protectedphp php$php_blackIsZerophp;
php php php php protectedphp php$php_colorSpacephp;
php php php php protectedphp php$php_imageDataOffsetphp;
php php php php protectedphp php$php_imageDataLengthphp;

php php php php constphp TIFFphp_ENDIANphp_BIGphp=php0php;
php php php php constphp TIFFphp_ENDIANphp_LITTLEphp=php1php;

php php php php constphp UNPACKphp_TYPEphp_BYTEphp=php0php;
php php php php constphp UNPACKphp_TYPEphp_SHORTphp=php1php;
php php php php constphp UNPACKphp_TYPEphp_LONGphp=php2php;
php php php php constphp UNPACKphp_TYPEphp_RATIONALphp=php3php;

php php php php php/php*php*
php php php php php php*php Bytephp unpackingphp function
php php php php php php*
php php php php php php*php Makesphp itphp possiblephp tophp unpackphp bytesphp inphp onephp statementphp forphp enhancedphp logicphp readabilityphp.
php php php php php php*
php php php php php php*php php@paramphp intphp php$type
php php php php php php*php php@paramphp stringphp php$bytes
php php php php php php*php php@throwsphp Zendphp_Pdfphp_Exception
php php php php php php*php/
php php php php protectedphp functionphp unpackBytesphp(php$typephp,php php$bytesphp)php php{
php php php php php php php php ifphp(php!issetphp(php$thisphp-php>php_endianTypephp)php)php php{
php php php php php php php php php php php php requirephp_oncephp php'Zendphp/Pdfphp/Exceptionphp.phpphp'php;
php php php php php php php php php php php php throwphp newphp Zendphp_Pdfphp_Exceptionphp(php"Thephp unpackBytesphp functionphp canphp onlyphp bephp usedphp afterphp thephp endiannessphp ofphp thephp filephp isphp knownphp"php)php;
php php php php php php php php php}
php php php php php php php php switchphp(php$typephp)php php{
php php php php php php php php php php php php casephp Zendphp_Pdfphp_Resourcephp_Imagephp_Tiffphp:php:UNPACKphp_TYPEphp_BYTEphp:
php php php php php php php php php php php php php php php php php$formatphp php=php php'Cphp'php;
php php php php php php php php php php php php php php php php php$unpackedphp php=php unpackphp(php$formatphp,php php$bytesphp)php;
php php php php php php php php php php php php php php php php returnphp php$unpackedphp[php1php]php;
php php php php php php php php php php php php php php php php breakphp;
php php php php php php php php php php php php casephp Zendphp_Pdfphp_Resourcephp_Imagephp_Tiffphp:php:UNPACKphp_TYPEphp_SHORTphp:
php php php php php php php php php php php php php php php php php$formatphp php=php php(php$thisphp-php>php_endianTypephp php=php=php Zendphp_Pdfphp_Resourcephp_Imagephp_Tiffphp:php:TIFFphp_ENDIANphp_LITTLEphp)php?php'vphp'php:php'nphp'php;
php php php php php php php php php php php php php php php php php$unpackedphp php=php unpackphp(php$formatphp,php php$bytesphp)php;
php php php php php php php php php php php php php php php php returnphp php$unpackedphp[php1php]php;
php php php php php php php php php php php php php php php php breakphp;
php php php php php php php php php php php php casephp Zendphp_Pdfphp_Resourcephp_Imagephp_Tiffphp:php:UNPACKphp_TYPEphp_LONGphp:
php php php php php php php php php php php php php php php php php$formatphp php=php php(php$thisphp-php>php_endianTypephp php=php=php Zendphp_Pdfphp_Resourcephp_Imagephp_Tiffphp:php:TIFFphp_ENDIANphp_LITTLEphp)php?php'Vphp'php:php'Nphp'php;
php php php php php php php php php php php php php php php php php$unpackedphp php=php unpackphp(php$formatphp,php php$bytesphp)php;
php php php php php php php php php php php php php php php php returnphp php$unpackedphp[php1php]php;
php php php php php php php php php php php php php php php php breakphp;
php php php php php php php php php php php php casephp Zendphp_Pdfphp_Resourcephp_Imagephp_Tiffphp:php:UNPACKphp_TYPEphp_RATIONALphp:
php php php php php php php php php php php php php php php php php$formatphp php=php php(php$thisphp-php>php_endianTypephp php=php=php Zendphp_Pdfphp_Resourcephp_Imagephp_Tiffphp:php:TIFFphp_ENDIANphp_LITTLEphp)php?php'Vphp2php'php:php'Nphp2php'php;
php php php php php php php php php php php php php php php php php$unpackedphp php=php unpackphp(php$formatphp,php php$bytesphp)php;
php php php php php php php php php php php php php php php php returnphp php(php$unpackedphp[php1php]php/php$unpackedphp[php2php]php)php;
php php php php php php php php php php php php php php php php breakphp;
php php php php php php php php php}
php php php php php}

php php php php php/php*php*
php php php php php php*php Objectphp constructor
php php php php php php*
php php php php php php*php php@paramphp stringphp php$imageFileName
php php php php php php*php php@throwsphp Zendphp_Pdfphp_Exception
php php php php php php*php/
php php php php publicphp functionphp php_php_constructphp(php$imageFileNamephp)
php php php php php{
php php php php php php php php ifphp php(php(php$imageFilephp php=php php@fopenphp(php$imageFileNamephp,php php'rbphp'php)php)php php=php=php=php falsephp php)php php{
php php php php php php php php php php php php requirephp_oncephp php'Zendphp/Pdfphp/Exceptionphp.phpphp'php;
php php php php php php php php php php php php throwphp newphp Zendphp_Pdfphp_Exceptionphp(php php"Canphp notphp openphp php'php$imageFileNamephp'php filephp forphp readingphp.php"php php)php;
php php php php php php php php php}

php php php php php php php php php$byteOrderIndicatorphp php=php freadphp(php$imageFilephp,php php2php)php;
php php php php php php php php ifphp(php$byteOrderIndicatorphp php=php=php php'IIphp'php)php php{
php php php php php php php php php php php php php$thisphp-php>php_endianTypephp php=php Zendphp_Pdfphp_Resourcephp_Imagephp_Tiffphp:php:TIFFphp_ENDIANphp_LITTLEphp;
php php php php php php php php php}php elsephp ifphp(php$byteOrderIndicatorphp php=php=php php'MMphp'php)php php{
php php php php php php php php php php php php php$thisphp-php>php_endianTypephp php=php Zendphp_Pdfphp_Resourcephp_Imagephp_Tiffphp:php:TIFFphp_ENDIANphp_BIGphp;
php php php php php php php php php}php elsephp php{
php php php php php php php php php php php php requirephp_oncephp php'Zendphp/Pdfphp/Exceptionphp.phpphp'php;
php php php php php php php php php php php php throwphp newphp Zendphp_Pdfphp_Exceptionphp(php php"Notphp aphp tiffphp filephp orphp Tiffphp corruptphp.php Nophp bytephp orderphp indicationphp foundphp"php php)php;
php php php php php php php php php}

php php php php php php php php php$versionphp php=php php$thisphp-php>unpackBytesphp(Zendphp_Pdfphp_Resourcephp_Imagephp_Tiffphp:php:UNPACKphp_TYPEphp_SHORTphp,php freadphp(php$imageFilephp,php php2php)php)php;

php php php php php php php php ifphp(php$versionphp php!php=php php4php2php)php php{
php php php php php php php php php php php php requirephp_oncephp php'Zendphp/Pdfphp/Exceptionphp.phpphp'php;
php php php php php php php php php php php php throwphp newphp Zendphp_Pdfphp_Exceptionphp(php php"Notphp aphp tiffphp filephp orphp Tiffphp corruptphp.php Incorrectphp versionphp numberphp.php"php php)php;
php php php php php php php php php}
php php php php php php php php php$ifdOffsetphp php=php php$thisphp-php>unpackBytesphp(Zendphp_Pdfphp_Resourcephp_Imagephp_Tiffphp:php:UNPACKphp_TYPEphp_LONGphp,php freadphp(php$imageFilephp,php php4php)php)php;

php php php php php php php php php$fileStatsphp php=php fstatphp(php$imageFilephp)php;
php php php php php php php php php$thisphp-php>php_fileSizephp php=php php$fileStatsphp[php'sizephp'php]php;

php php php php php php php php php/php*
php php php php php php php php php php*php Tiffphp filesphp arephp storedphp asphp aphp seriesphp ofphp Imagephp Filephp Directoriesphp php(IFDphp)php eachphp direcctory
php php php php php php php php php php*php hasphp aphp specificphp numberphp ofphp entriesphp eachphp php1php2php bytesphp inphp lengthphp.php Atphp thephp endphp ofphp thephp directories
php php php php php php php php php php*php isphp fourphp bytesphp pointingphp tophp thephp offsetphp ofphp thephp nextphp IFDphp.
php php php php php php php php php php*php/

php php php php php php php php whilephp(php$ifdOffsetphp php>php php0php)php php{
php php php php php php php php php php php php ifphp(fseekphp(php$imageFilephp,php php$ifdOffsetphp,php SEEKphp_SETphp)php php=php=php php-php1php php|php|php php$ifdOffsetphp+php2php php>php=php php$thisphp-php>php_fileSizephp)php php{
php php php php php php php php php php php php php php php php requirephp_oncephp php'Zendphp/Pdfphp/Exceptionphp.phpphp'php;
php php php php php php php php php php php php php php php php throwphp newphp Zendphp_Pdfphp_Exceptionphp(php"Couldphp notphp seekphp tophp thephp imagephp filephp directoryphp asphp indexedphp byphp thephp filephp.php Likelyphp causephp isphp TIFFphp corruptionphp.php Offsetphp:php php"php.php php$ifdOffsetphp)php;
php php php php php php php php php php php php php}

php php php php php php php php php php php php php$numDirEntriesphp php=php php$thisphp-php>unpackBytesphp(Zendphp_Pdfphp_Resourcephp_Imagephp_Tiffphp:php:UNPACKphp_TYPEphp_SHORTphp,php freadphp(php$imageFilephp,php php2php)php)php;

php php php php php php php php php php php php php/php*
php php php php php php php php php php php php php php*php Sincephp wephp nowphp knowphp howphp manyphp entriesphp arephp inphp thisphp php(IFDphp)php wephp canphp extractphp thephp dataphp.
php php php php php php php php php php php php php php*php Thephp formatphp ofphp aphp TIFFphp directoryphp entryphp isphp:
php php php php php php php php php php php php php php*
php php php php php php php php php php php php php php*php php2php bytesphp php(shortphp)php tagphp codephp;php Seephp TIFFphp_TAGphp constantsphp atphp thephp topphp forphp supportedphp valuesphp.php php(Therephp arephp manyphp morephp inphp thephp specphp)
php php php php php php php php php php php php php php*php php2php bytesphp php(shortphp)php fieldphp type
php php php php php php php php php php php php php php*php php4php bytesphp php(longphp)php numberphp ofphp valuesphp,php orphp valuephp countphp.
php php php php php php php php php php php php php php*php php4php bytesphp php(mixedphp)php dataphp ifphp thephp dataphp willphp fitphp intophp php4php bytesphp orphp anphp offsetphp ifphp thephp dataphp isphp toophp largephp.
php php php php php php php php php php php php php php*php/
php php php php php php php php php php php php forphp(php$dirEntryIdxphp php=php php1php;php php$dirEntryIdxphp <php=php php$numDirEntriesphp;php php$dirEntryIdxphp+php+php)php php{
php php php php php php php php php php php php php php php php php$tagphp php php php php php php php php php=php php$thisphp-php>unpackBytesphp(Zendphp_Pdfphp_Resourcephp_Imagephp_Tiffphp:php:UNPACKphp_TYPEphp_SHORTphp,php freadphp(php$imageFilephp,php php2php)php)php;
php php php php php php php php php php php php php php php php php$fieldTypephp php php php=php php$thisphp-php>unpackBytesphp(Zendphp_Pdfphp_Resourcephp_Imagephp_Tiffphp:php:UNPACKphp_TYPEphp_SHORTphp,php freadphp(php$imageFilephp,php php2php)php)php;
php php php php php php php php php php php php php php php php php$valueCountphp php php=php php$thisphp-php>unpackBytesphp(Zendphp_Pdfphp_Resourcephp_Imagephp_Tiffphp:php:UNPACKphp_TYPEphp_LONGphp,php freadphp(php$imageFilephp,php php4php)php)php;

php php php php php php php php php php php php php php php php switchphp(php$fieldTypephp)php php{
php php php php php php php php php php php php php php php php php php php php casephp Zendphp_Pdfphp_Resourcephp_Imagephp_Tiffphp:php:TIFFphp_FIELDphp_TYPEphp_BYTEphp:
php php php php php php php php php php php php php php php php php php php php php php php php php$fieldLengthphp php=php php$valueCountphp;
php php php php php php php php php php php php php php php php php php php php php php php php breakphp;
php php php php php php php php php php php php php php php php php php php php casephp Zendphp_Pdfphp_Resourcephp_Imagephp_Tiffphp:php:TIFFphp_FIELDphp_TYPEphp_ASCIIphp:
php php php php php php php php php php php php php php php php php php php php php php php php php$fieldLengthphp php=php php$valueCountphp;
php php php php php php php php php php php php php php php php php php php php php php php php breakphp;
php php php php php php php php php php php php php php php php php php php php casephp Zendphp_Pdfphp_Resourcephp_Imagephp_Tiffphp:php:TIFFphp_FIELDphp_TYPEphp_SHORTphp:
php php php php php php php php php php php php php php php php php php php php php php php php php$fieldLengthphp php=php php$valueCountphp php*php php2php;
php php php php php php php php php php php php php php php php php php php php php php php php breakphp;
php php php php php php php php php php php php php php php php php php php php casephp Zendphp_Pdfphp_Resourcephp_Imagephp_Tiffphp:php:TIFFphp_FIELDphp_TYPEphp_LONGphp:
php php php php php php php php php php php php php php php php php php php php php php php php php$fieldLengthphp php=php php$valueCountphp php*php php4php;
php php php php php php php php php php php php php php php php php php php php php php php php breakphp;
php php php php php php php php php php php php php php php php php php php php casephp Zendphp_Pdfphp_Resourcephp_Imagephp_Tiffphp:php:TIFFphp_FIELDphp_TYPEphp_RATIONALphp:
php php php php php php php php php php php php php php php php php php php php php php php php php$fieldLengthphp php=php php$valueCountphp php*php php8php;
php php php php php php php php php php php php php php php php php php php php php php php php breakphp;
php php php php php php php php php php php php php php php php php php php php defaultphp:
php php php php php php php php php php php php php php php php php php php php php php php php php$fieldLengthphp php=php php$valueCountphp;
php php php php php php php php php php php php php php php php php}

php php php php php php php php php php php php php php php php php$offsetBytesphp php=php freadphp(php$imageFilephp,php php4php)php;

php php php php php php php php php php php php php php php php ifphp(php$fieldLengthphp <php=php php4php)php php{
php php php php php php php php php php php php php php php php php php php php switchphp(php$fieldTypephp)php php{
php php php php php php php php php php php php php php php php php php php php php php php php casephp Zendphp_Pdfphp_Resourcephp_Imagephp_Tiffphp:php:TIFFphp_FIELDphp_TYPEphp_BYTEphp:
php php php php php php php php php php php php php php php php php php php php php php php php php php php php php$valuephp php=php php$thisphp-php>unpackBytesphp(Zendphp_Pdfphp_Resourcephp_Imagephp_Tiffphp:php:UNPACKphp_TYPEphp_BYTEphp,php php$offsetBytesphp)php;
php php php php php php php php php php php php php php php php php php php php php php php php php php php php breakphp;
php php php php php php php php php php php php php php php php php php php php php php php php casephp Zendphp_Pdfphp_Resourcephp_Imagephp_Tiffphp:php:TIFFphp_FIELDphp_TYPEphp_ASCIIphp:
php php php php php php php php php php php php php php php php php php php php php php php php php php php php php/php/Fallphp throughphp tophp nextphp case
php php php php php php php php php php php php php php php php php php php php php php php php casephp Zendphp_Pdfphp_Resourcephp_Imagephp_Tiffphp:php:TIFFphp_FIELDphp_TYPEphp_LONGphp:
php php php php php php php php php php php php php php php php php php php php php php php php php php php php php$valuephp php=php php$thisphp-php>unpackBytesphp(Zendphp_Pdfphp_Resourcephp_Imagephp_Tiffphp:php:UNPACKphp_TYPEphp_LONGphp,php php$offsetBytesphp)php;
php php php php php php php php php php php php php php php php php php php php php php php php php php php php breakphp;
php php php php php php php php php php php php php php php php php php php php php php php php casephp Zendphp_Pdfphp_Resourcephp_Imagephp_Tiffphp:php:TIFFphp_FIELDphp_TYPEphp_SHORTphp:
php php php php php php php php php php php php php php php php php php php php php php php php php php php php php/php/Fallphp throughphp tophp nextphp case
php php php php php php php php php php php php php php php php php php php php php php php php defaultphp:
php php php php php php php php php php php php php php php php php php php php php php php php php php php php php$valuephp php=php php$thisphp-php>unpackBytesphp(Zendphp_Pdfphp_Resourcephp_Imagephp_Tiffphp:php:UNPACKphp_TYPEphp_SHORTphp,php php$offsetBytesphp)php;
php php php php php php php php php php php php php php php php php php php php php}
php php php php php php php php php php php php php php php php php}php elsephp php{
php php php php php php php php php php php php php php php php php php php php php$refOffsetphp php=php php$thisphp-php>unpackBytesphp(Zendphp_Pdfphp_Resourcephp_Imagephp_Tiffphp:php:UNPACKphp_TYPEphp_LONGphp,php php$offsetBytesphp)php;
php php php php php php php php php php php php php php php php php}
php php php php php php php php php php php php php php php php php/php*
php php php php php php php php php php php php php php php php php php*php Linearphp tagphp processingphp isphp probablyphp notphp thephp bestphp wayphp tophp dophp thisphp.php Iphp'vephp processedphp thephp tagsphp accordingphp tophp the
php php php php php php php php php php php php php php php php php php*php Tiffphp php6php specificationphp andphp makephp somephp assumptionsphp aboutphp whenphp tagsphp willphp bephp <php php4php bytesphp andphp fitphp intophp php$valuephp andphp when
php php php php php php php php php php php php php php php php php php*php theyphp willphp bephp php>php php4php bytesphp andphp requirephp seekphp/extractionphp ofphp thephp offsetphp.php Samephp goesphp forphp extractingphp arraysphp ofphp dataphp,php like
php php php php php php php php php php php php php php php php php php*php thephp dataphp offsetsphp andphp lengthphp.php Thisphp shouldphp bephp fixedphp inphp thephp futurephp.
php php php php php php php php php php php php php php php php php php*php/
php php php php php php php php php php php php php php php php switchphp(php$tagphp)php php{
php php php php php php php php php php php php php php php php php php php php casephp Zendphp_Pdfphp_Resourcephp_Imagephp_Tiffphp:php:TIFFphp_TAGphp_IMAGEphp_WIDTHphp:
php php php php php php php php php php php php php php php php php php php php php php php php php$thisphp-php>php_widthphp php=php php$valuephp;
php php php php php php php php php php php php php php php php php php php php php php php php breakphp;
php php php php php php php php php php php php php php php php php php php php casephp Zendphp_Pdfphp_Resourcephp_Imagephp_Tiffphp:php:TIFFphp_TAGphp_IMAGEphp_LENGTHphp:
php php php php php php php php php php php php php php php php php php php php php php php php php$thisphp-php>php_heightphp php=php php$valuephp;
php php php php php php php php php php php php php php php php php php php php php php php php breakphp;
php php php php php php php php php php php php php php php php php php php php casephp Zendphp_Pdfphp_Resourcephp_Imagephp_Tiffphp:php:TIFFphp_TAGphp_BITSphp_PERphp_SAMPLEphp:
php php php php php php php php php php php php php php php php php php php php php php php php ifphp(php$valueCountphp>php1php)php php{
php php php php php php php php php php php php php php php php php php php php php php php php php php php php php$fpphp php=php ftellphp(php$imageFilephp)php;
php php php php php php php php php php php php php php php php php php php php php php php php php php php php fseekphp(php$imageFilephp,php php$refOffsetphp,php SEEKphp_SETphp)php;
php php php php php php php php php php php php php php php php php php php php php php php php php php php php php$thisphp-php>php_bitsPerSamplephp php=php php$thisphp-php>unpackBytesphp(Zendphp_Pdfphp_Resourcephp_Imagephp_Tiffphp:php:UNPACKphp_TYPEphp_SHORTphp,php freadphp(php$imageFilephp,php php2php)php)php;
php php php php php php php php php php php php php php php php php php php php php php php php php php php php fseekphp(php$imageFilephp,php php$fpphp,php SEEKphp_SETphp)php;
php php php php php php php php php php php php php php php php php php php php php php php php php}php elsephp php{
php php php php php php php php php php php php php php php php php php php php php php php php php php php php php$thisphp-php>php_bitsPerSamplephp php=php php$valuephp;
php php php php php php php php php php php php php php php php php php php php php php php php php}
php php php php php php php php php php php php php php php php php php php php php php php php breakphp;
php php php php php php php php php php php php php php php php php php php php casephp Zendphp_Pdfphp_Resourcephp_Imagephp_Tiffphp:php:TIFFphp_TAGphp_COMPRESSIONphp:
php php php php php php php php php php php php php php php php php php php php php php php php php$thisphp-php>php_compressionphp php=php php$valuephp;
php php php php php php php php php php php php php php php php php php php php php php php php switchphp(php$valuephp)php php{
php php php php php php php php php php php php php php php php php php php php php php php php php php php php casephp Zendphp_Pdfphp_Resourcephp_Imagephp_Tiffphp:php:TIFFphp_COMPRESSIONphp_UNCOMPRESSEDphp:
php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php$thisphp-php>php_filterphp php=php php'Nonephp'php;
php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php breakphp;
php php php php php php php php php php php php php php php php php php php php php php php php php php php php casephp Zendphp_Pdfphp_Resourcephp_Imagephp_Tiffphp:php:TIFFphp_COMPRESSIONphp_CCITTphp1Dphp:
php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php/php/Fallphp throughphp tophp nextphp case
php php php php php php php php php php php php php php php php php php php php php php php php php php php php casephp Zendphp_Pdfphp_Resourcephp_Imagephp_Tiffphp:php:TIFFphp_COMPRESSIONphp_GROUPphp_php3php_FAXphp:
php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php/php/Fallphp throughphp tophp nextphp case
php php php php php php php php php php php php php php php php php php php php php php php php php php php php casephp Zendphp_Pdfphp_Resourcephp_Imagephp_Tiffphp:php:TIFFphp_COMPRESSIONphp_GROUPphp_php4php_FAXphp:
php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php$thisphp-php>php_filterphp php=php php'CCITTFaxDecodephp'php;
php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php requirephp_oncephp php'Zendphp/Pdfphp/Exceptionphp.phpphp'php;
php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php throwphp newphp Zendphp_Pdfphp_Exceptionphp(php"CCITTFaxDecodephp Compressionphp Modephp Notphp Currentlyphp Supportedphp"php)php;
php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php breakphp;
php php php php php php php php php php php php php php php php php php php php php php php php php php php php casephp Zendphp_Pdfphp_Resourcephp_Imagephp_Tiffphp:php:TIFFphp_COMPRESSIONphp_LZWphp:
php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php$thisphp-php>php_filterphp php=php php'LZWDecodephp'php;
php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php requirephp_oncephp php'Zendphp/Pdfphp/Exceptionphp.phpphp'php;
php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php throwphp newphp Zendphp_Pdfphp_Exceptionphp(php"LZWDecodephp Compressionphp Modephp Notphp Currentlyphp Supportedphp"php)php;
php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php breakphp;
php php php php php php php php php php php php php php php php php php php php php php php php php php php php casephp Zendphp_Pdfphp_Resourcephp_Imagephp_Tiffphp:php:TIFFphp_COMPRESSIONphp_JPEGphp:
php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php$thisphp-php>php_filterphp php=php php'DCTDecodephp'php;php php/php/Shouldphp workphp,php doesntphp.php.php.
php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php requirephp_oncephp php'Zendphp/Pdfphp/Exceptionphp.phpphp'php;
php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php throwphp newphp Zendphp_Pdfphp_Exceptionphp(php"JPEGphp Compressionphp Modephp Notphp Currentlyphp Supportedphp"php)php;
php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php breakphp;
php php php php php php php php php php php php php php php php php php php php php php php php php php php php casephp Zendphp_Pdfphp_Resourcephp_Imagephp_Tiffphp:php:TIFFphp_COMPRESSIONphp_FLATEphp:
php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php/php/fallphp throughphp tophp nextphp case
php php php php php php php php php php php php php php php php php php php php php php php php php php php php casephp Zendphp_Pdfphp_Resourcephp_Imagephp_Tiffphp:php:TIFFphp_COMPRESSIONphp_FLATEphp_OBSOLETEphp_CODEphp:
php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php$thisphp-php>php_filterphp php=php php'FlateDecodephp'php;
php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php requirephp_oncephp php'Zendphp/Pdfphp/Exceptionphp.phpphp'php;
php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php throwphp newphp Zendphp_Pdfphp_Exceptionphp(php"ZIPphp/Flatephp Compressionphp Modephp Notphp Currentlyphp Supportedphp"php)php;
php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php breakphp;
php php php php php php php php php php php php php php php php php php php php php php php php php php php php casephp Zendphp_Pdfphp_Resourcephp_Imagephp_Tiffphp:php:TIFFphp_COMPRESSIONphp_PACKBITSphp:
php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php$thisphp-php>php_filterphp php=php php'RunLengthDecodephp'php;
php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php breakphp;
php php php php php php php php php php php php php php php php php php php php php php php php php}
php php php php php php php php php php php php php php php php php php php php php php php php breakphp;
php php php php php php php php php php php php php php php php php php php php casephp Zendphp_Pdfphp_Resourcephp_Imagephp_Tiffphp:php:TIFFphp_TAGphp_PHOTOMETRICphp_INTERPRETATIONphp:
php php php php php php php php php php php php php php php php php php php php php php php php php$thisphp-php>php_colorCodephp php=php php$valuephp;
php php php php php php php php php php php php php php php php php php php php php php php php php$thisphp-php>php_whiteIsZerophp php=php falsephp;
php php php php php php php php php php php php php php php php php php php php php php php php php$thisphp-php>php_blackIsZerophp php=php falsephp;
php php php php php php php php php php php php php php php php php php php php php php php php switchphp(php$valuephp)php php{
php php php php php php php php php php php php php php php php php php php php php php php php php php php php casephp Zendphp_Pdfphp_Resourcephp_Imagephp_Tiffphp:php:TIFFphp_PHOTOMETRICphp_INTERPRETATIONphp_WHITEphp_ISphp_ZEROphp:
php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php$thisphp-php>php_whiteIsZerophp php=php truephp;
php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php$thisphp-php>php_colorSpacephp php=php php'DeviceGrayphp'php;
php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php breakphp;
php php php php php php php php php php php php php php php php php php php php php php php php php php php php casephp Zendphp_Pdfphp_Resourcephp_Imagephp_Tiffphp:php:TIFFphp_PHOTOMETRICphp_INTERPRETATIONphp_BLACKphp_ISphp_ZEROphp:
php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php$thisphp-php>php_blackIsZerophp php=php truephp;
php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php$thisphp-php>php_colorSpacephp php=php php'DeviceGrayphp'php;
php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php breakphp;
php php php php php php php php php php php php php php php php php php php php php php php php php php php php casephp Zendphp_Pdfphp_Resourcephp_Imagephp_Tiffphp:php:TIFFphp_PHOTOMETRICphp_INTERPRETATIONphp_YCBCRphp:
php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php/php/fallphp throughphp tophp nextphp case
php php php php php php php php php php php php php php php php php php php php php php php php php php php php casephp Zendphp_Pdfphp_Resourcephp_Imagephp_Tiffphp:php:TIFFphp_PHOTOMETRICphp_INTERPRETATIONphp_RGBphp:
php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php$thisphp-php>php_colorSpacephp php=php php'DeviceRGBphp'php;
php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php breakphp;
php php php php php php php php php php php php php php php php php php php php php php php php php php php php casephp Zendphp_Pdfphp_Resourcephp_Imagephp_Tiffphp:php:TIFFphp_PHOTOMETRICphp_INTERPRETATIONphp_RGBphp_INDEXEDphp:
php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php$thisphp-php>php_colorSpacephp php=php php'Indexedphp'php;
php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php breakphp;
php php php php php php php php php php php php php php php php php php php php php php php php php php php php casephp Zendphp_Pdfphp_Resourcephp_Imagephp_Tiffphp:php:TIFFphp_PHOTOMETRICphp_INTERPRETATIONphp_CMYKphp:
php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php$thisphp-php>php_colorSpacephp php=php php'DeviceCMYKphp'php;
php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php breakphp;
php php php php php php php php php php php php php php php php php php php php php php php php php php php php casephp Zendphp_Pdfphp_Resourcephp_Imagephp_Tiffphp:php:TIFFphp_PHOTOMETRICphp_INTERPRETATIONphp_CIELABphp:
php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php$thisphp-php>php_colorSpacephp php=php php'Labphp'php;
php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php breakphp;
php php php php php php php php php php php php php php php php php php php php php php php php php php php php defaultphp:
php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php requirephp_oncephp php'Zendphp/Pdfphp/Exceptionphp.phpphp'php;
php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php throwphp newphp Zendphp_Pdfphp_Exceptionphp(php'TIFFphp:php Unknownphp orphp Unsupportedphp Colorphp Typephp:php php'php.php php$valuephp)php;
php php php php php php php php php php php php php php php php php php php php php php php php php}
php php php php php php php php php php php php php php php php php php php php php php php php breakphp;
php php php php php php php php php php php php php php php php php php php php casephp Zendphp_Pdfphp_Resourcephp_Imagephp_Tiffphp:php:TIFFphp_TAGphp_STRIPphp_OFFSETSphp:
php php php php php php php php php php php php php php php php php php php php php php php php ifphp(php$valueCountphp>php1php)php php{
php php php php php php php php php php php php php php php php php php php php php php php php php php php php php$formatphp php=php php(php$thisphp-php>php_endianTypephp php=php=php Zendphp_Pdfphp_Resourcephp_Imagephp_Tiffphp:php:TIFFphp_ENDIANphp_LITTLEphp)php?php'Vphp*php'php:php'Nphp*php'php;
php php php php php php php php php php php php php php php php php php php php php php php php php php php php php$fpphp php=php ftellphp(php$imageFilephp)php;
php php php php php php php php php php php php php php php php php php php php php php php php php php php php fseekphp(php$imageFilephp,php php$refOffsetphp,php SEEKphp_SETphp)php;
php php php php php php php php php php php php php php php php php php php php php php php php php php php php php$stripOffsetsBytesphp php=php freadphp(php$imageFilephp,php php$fieldLengthphp)php;
php php php php php php php php php php php php php php php php php php php php php php php php php php php php php$thisphp-php>php_imageDataOffsetphp php=php unpackphp(php$formatphp,php php$stripOffsetsBytesphp)php;
php php php php php php php php php php php php php php php php php php php php php php php php php php php php fseekphp(php$imageFilephp,php php$fpphp,php SEEKphp_SETphp)php;
php php php php php php php php php php php php php php php php php php php php php php php php php}php elsephp php{
php php php php php php php php php php php php php php php php php php php php php php php php php php php php php$thisphp-php>php_imageDataOffsetphp php=php php$valuephp;
php php php php php php php php php php php php php php php php php php php php php php php php php}
php php php php php php php php php php php php php php php php php php php php php php php php breakphp;
php php php php php php php php php php php php php php php php php php php casephp Zendphp_Pdfphp_Resourcephp_Imagephp_Tiffphp:php:TIFFphp_TAGphp_STRIPphp_BYTEphp_COUNTSphp:
php php php php php php php php php php php php php php php php php php php php php php php php ifphp(php$valueCountphp>php1php)php php{
php php php php php php php php php php php php php php php php php php php php php php php php php php php php php$formatphp php=php php(php$thisphp-php>php_endianTypephp php=php=php Zendphp_Pdfphp_Resourcephp_Imagephp_Tiffphp:php:TIFFphp_ENDIANphp_LITTLEphp)php?php'Vphp*php'php:php'Nphp*php'php;
php php php php php php php php php php php php php php php php php php php php php php php php php php php php php$fpphp php=php ftellphp(php$imageFilephp)php;
php php php php php php php php php php php php php php php php php php php php php php php php php php php php fseekphp(php$imageFilephp,php php$refOffsetphp,php SEEKphp_SETphp)php;
php php php php php php php php php php php php php php php php php php php php php php php php php php php php php$stripByteCountsBytesphp php=php freadphp(php$imageFilephp,php php$fieldLengthphp)php;
php php php php php php php php php php php php php php php php php php php php php php php php php php php php php$thisphp-php>php_imageDataLengthphp php=php unpackphp(php$formatphp,php php$stripByteCountsBytesphp)php;
php php php php php php php php php php php php php php php php php php php php php php php php php php php php fseekphp(php$imageFilephp,php php$fpphp,php SEEKphp_SETphp)php;
php php php php php php php php php php php php php php php php php php php php php php php php php}php elsephp php{
php php php php php php php php php php php php php php php php php php php php php php php php php php php php php$thisphp-php>php_imageDataLengthphp php=php php$valuephp;
php php php php php php php php php php php php php php php php php php php php php php php php php}
php php php php php php php php php php php php php php php php php php php php php php php php breakphp;
php php php php php php php php php php php php php php php php php php php php defaultphp:
php php php php php php php php php php php php php php php php php php php php php php php php php/php/Forphp debuggingphp.php Itphp shouldphp bephp harmlessphp tophp ignorephp unknownphp tagsphp,php thoughphp therephp isphp somephp goodphp infophp inphp themphp.
php php php php php php php php php php php php php php php php php php php php php php php php php/php/echophp php"Unknownphp tagphp detectedphp:php php"php.php php$tagphp php.php php"php valuephp:php php"php.php php$valuephp;
php php php php php php php php php php php php php php php php php}
php php php php php php php php php php php php php}
php php php php php php php php php php php php php$ifdOffsetphp php=php php$thisphp-php>unpackBytesphp(Zendphp_Pdfphp_Resourcephp_Imagephp_Tiffphp:php:UNPACKphp_TYPEphp_LONGphp,php freadphp(php$imageFilephp,php php4php)php)php;
php php php php php php php php php}

php php php php php php php php ifphp(php!issetphp(php$thisphp-php>php_imageDataOffsetphp)php php|php|php php!issetphp(php$thisphp-php>php_imageDataLengthphp)php)php php{
php php php php php php php php php php php php requirephp_oncephp php'Zendphp/Pdfphp/Exceptionphp.phpphp'php;
php php php php php php php php php php php php throwphp newphp Zendphp_Pdfphp_Exceptionphp(php"TIFFphp:php Thephp imagephp processedphp didphp notphp containphp imagephp dataphp asphp expectedphp.php"php)php;
php php php php php php php php php}

php php php php php php php php php$imageDataBytesphp php=php php'php'php;
php php php php php php php php ifphp(isphp_arrayphp(php$thisphp-php>php_imageDataOffsetphp)php)php php{
php php php php php php php php php php php php ifphp(php!isphp_arrayphp(php$thisphp-php>php_imageDataLengthphp)php)php php{
php php php php php php php php php php php php php php php php requirephp_oncephp php'Zendphp/Pdfphp/Exceptionphp.phpphp'php;
php php php php php php php php php php php php php php php php throwphp newphp Zendphp_Pdfphp_Exceptionphp(php"TIFFphp:php Thephp imagephp containedphp multiplephp dataphp offsetsphp butphp notphp multiplephp dataphp lengthsphp.php Tiffphp mayphp bephp corruptphp.php"php)php;
php php php php php php php php php php php php php}
php php php php php php php php php php php php foreachphp(php$thisphp-php>php_imageDataOffsetphp asphp php$idxphp php=php>php php$offsetphp)php php{
php php php php php php php php php php php php php php php php fseekphp(php$imageFilephp,php php$thisphp-php>php_imageDataOffsetphp[php$idxphp]php,php SEEKphp_SETphp)php;
php php php php php php php php php php php php php php php php php$imageDataBytesphp php.php=php freadphp(php$imageFilephp,php php$thisphp-php>php_imageDataLengthphp[php$idxphp]php)php;
php php php php php php php php php php php php php}
php php php php php php php php php}php elsephp php{
php php php php php php php php php php php php fseekphp(php$imageFilephp,php php$thisphp-php>php_imageDataOffsetphp,php SEEKphp_SETphp)php;
php php php php php php php php php php php php php$imageDataBytesphp php=php freadphp(php$imageFilephp,php php$thisphp-php>php_imageDataLengthphp)php;
php php php php php php php php php}
php php php php php php php php ifphp(php$imageDataBytesphp php=php=php=php php'php'php)php php{
php php php php php php php php php php php php requirephp_oncephp php'Zendphp/Pdfphp/Exceptionphp.phpphp'php;
php php php php php php php php php php php php throwphp newphp Zendphp_Pdfphp_Exceptionphp(php"TIFFphp:php Nophp dataphp.php Imagephp Corruptionphp"php)php;
php php php php php php php php php}

php php php php php php php php fclosephp(php$imageFilephp)php;

php php php php php php php php parentphp:php:php_php_constructphp(php)php;

php php php php php php php php php$imageDictionaryphp php=php php$thisphp-php>php_resourcephp-php>dictionaryphp;
php php php php php php php php ifphp(php!issetphp(php$thisphp-php>php_widthphp)php php|php|php php!issetphp(php$thisphp-php>php_widthphp)php)php php{
php php php php php php php php php php php php requirephp_oncephp php'Zendphp/Pdfphp/Exceptionphp.phpphp'php;
php php php php php php php php php php php php throwphp newphp Zendphp_Pdfphp_Exceptionphp(php"Problemphp readingphp tiffphp filephp.php Tiffphp isphp probablyphp corruptphp.php"php)php;
php php php php php php php php php}

php php php php php php php php php$thisphp-php>php_imagePropertiesphp php=php arrayphp(php)php;
php php php php php php php php php$thisphp-php>php_imagePropertiesphp[php'bitDepthphp'php]php php=php php$thisphp-php>php_bitsPerSamplephp;
php php php php php php php php php$thisphp-php>php_imagePropertiesphp[php'fileSizephp'php]php php=php php$thisphp-php>php_fileSizephp;
php php php php php php php php php$thisphp-php>php_imagePropertiesphp[php'TIFFendianTypephp'php]php php=php php$thisphp-php>php_endianTypephp;
php php php php php php php php php$thisphp-php>php_imagePropertiesphp[php'TIFFcompressionTypephp'php]php php=php php$thisphp-php>php_compressionphp;
php php php php php php php php php$thisphp-php>php_imagePropertiesphp[php'TIFFwhiteIsZerophp'php]php php=php php$thisphp-php>php_whiteIsZerophp;
php php php php php php php php php$thisphp-php>php_imagePropertiesphp[php'TIFFblackIsZerophp'php]php php=php php$thisphp-php>php_blackIsZerophp;
php php php php php php php php php$thisphp-php>php_imagePropertiesphp[php'TIFFcolorCodephp'php]php php=php php$thisphp-php>php_colorCodephp;
php php php php php php php php php$thisphp-php>php_imagePropertiesphp[php'TIFFimageDataOffsetphp'php]php php=php php$thisphp-php>php_imageDataOffsetphp;
php php php php php php php php php$thisphp-php>php_imagePropertiesphp[php'TIFFimageDataLengthphp'php]php php=php php$thisphp-php>php_imageDataLengthphp;
php php php php php php php php php$thisphp-php>php_imagePropertiesphp[php'PDFfilterphp'php]php php=php php$thisphp-php>php_filterphp;
php php php php php php php php php$thisphp-php>php_imagePropertiesphp[php'PDFcolorSpacephp'php]php php=php php$thisphp-php>php_colorSpacephp;

php php php php php php php php php$imageDictionaryphp-php>Widthphp php php php php php php php php php php php php=php newphp Zendphp_Pdfphp_Elementphp_Numericphp(php$thisphp-php>php_widthphp)php;
php php php php php php php php ifphp(php$thisphp-php>php_whiteIsZerophp php=php=php=php truephp)php php{
php php php php php php php php php php php php php$imageDictionaryphp-php>Decodephp php php php php php php php=php newphp Zendphp_Pdfphp_Elementphp_Arrayphp(arrayphp(newphp Zendphp_Pdfphp_Elementphp_Numericphp(php1php)php,php newphp Zendphp_Pdfphp_Elementphp_Numericphp(php0php)php)php)php;
php php php php php php php php php}
php php php php php php php php php$imageDictionaryphp-php>Heightphp php php php php php php php php php php php=php newphp Zendphp_Pdfphp_Elementphp_Numericphp(php$thisphp-php>php_heightphp)php;
php php php php php php php php php$imageDictionaryphp-php>ColorSpacephp php php php php php php php=php newphp Zendphp_Pdfphp_Elementphp_Namephp(php$thisphp-php>php_colorSpacephp)php;
php php php php php php php php php$imageDictionaryphp-php>BitsPerComponentphp php=php newphp Zendphp_Pdfphp_Elementphp_Numericphp(php$thisphp-php>php_bitsPerSamplephp)php;
php php php php php php php php ifphp(issetphp(php$thisphp-php>php_filterphp)php php&php&php php$thisphp-php>php_filterphp php!php=php php'Nonephp'php)php php{
php php php php php php php php php php php php php$imageDictionaryphp-php>Filterphp php=php newphp Zendphp_Pdfphp_Elementphp_Namephp(php$thisphp-php>php_filterphp)php;
php php php php php php php php php}

php php php php php php php php php$thisphp-php>php_resourcephp-php>valuephp php=php php$imageDataBytesphp;
php php php php php php php php php$thisphp-php>php_resourcephp-php>skipFiltersphp(php)php;
php php php php php}
php php php php php/php*php*
php php php php php php*php Imagephp widthphp php(definedphp inphp Zendphp_Pdfphp_Resourcephp_Imagephp_Interfacephp)
php php php php php php*php/
php php php php publicphp functionphp getPixelWidthphp(php)php php{
php php php php php php php php returnphp php$thisphp-php>php_widthphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Imagephp heightphp php(definedphp inphp Zendphp_Pdfphp_Resourcephp_Imagephp_Interfacephp)
php php php php php php*php/
php php php php publicphp functionphp getPixelHeightphp(php)php php{
php php php php php php php php returnphp php$thisphp-php>php_heightphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Imagephp propertiesphp php(definedphp inphp Zendphp_Pdfphp_Resourcephp_Imagephp_Interfacephp)
php php php php php php*php/
php php php php publicphp functionphp getPropertiesphp(php)php php{
php php php php php php php php returnphp php$thisphp-php>php_imagePropertiesphp;
php php php php php}
php}

