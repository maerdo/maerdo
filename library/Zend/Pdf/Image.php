<php?php
php/php*php*
php php*php Zendphp Framework
php php*
php php*php LICENSE
php php*
php php*php Thisphp sourcephp filephp isphp subjectphp tophp thephp newphp BSDphp licensephp thatphp isphp bundled
php php*php withphp thisphp packagephp inphp thephp filephp LICENSEphp.txtphp.
php php*php Itphp isphp alsophp availablephp throughphp thephp worldphp-widephp-webphp atphp thisphp URLphp:
php php*php httpphp:php/php/frameworkphp.zendphp.comphp/licensephp/newphp-bsd
php php*php Ifphp youphp didphp notphp receivephp aphp copyphp ofphp thephp licensephp andphp arephp unablephp to
php php*php obtainphp itphp throughphp thephp worldphp-widephp-webphp,php pleasephp sendphp anphp email
php php*php tophp licensephp@zendphp.comphp sophp wephp canphp sendphp youphp aphp copyphp immediatelyphp.
php php*
php php*php php@categoryphp php php Zend
php php*php php@packagephp php php php Zendphp_Pdf
php php*php php@subpackagephp Images
php php*php php@copyrightphp php Copyrightphp php(cphp)php php2php0php0php5php-php2php0php1php0php Zendphp Technologiesphp USAphp Incphp.php php(httpphp:php/php/wwwphp.zendphp.comphp)
php php*php php@licensephp php php php httpphp:php/php/frameworkphp.zendphp.comphp/licensephp/newphp-bsdphp php php php php Newphp BSDphp License
php php*php php@versionphp php php php php$Idphp:php Imagephp.phpphp php2php0php0php9php6php php2php0php1php0php-php0php1php-php0php6php php0php2php:php0php5php:php0php9Zphp bkarwinphp php$
php php*php/


php/php*php*
php php*php Abstractphp factoryphp classphp whichphp vendsphp php{php@linkphp Zendphp_Pdfphp_Resourcephp_Imagephp}php objectsphp.
php php*
php php*php Thisphp classphp isphp alsophp thephp homephp forphp imagephp-relatedphp constantsphp becausephp thephp namephp of
php php*php thephp truephp basephp classphp php(php{php@linkphp Zendphp_Pdfphp_Resourcephp_Imagephp}php)php isphp notphp intuitivephp forphp the
php php*php endphp userphp.
php php*
php php*php php@packagephp php php php Zendphp_Pdf
php php*php php@subpackagephp Images
php php*php php@copyrightphp php Copyrightphp php(cphp)php php2php0php0php5php-php2php0php1php0php Zendphp Technologiesphp USAphp Incphp.php php(httpphp:php/php/wwwphp.zendphp.comphp)
php php*php php@licensephp php php php httpphp:php/php/frameworkphp.zendphp.comphp/licensephp/newphp-bsdphp php php php php Newphp BSDphp License
php php*php/
abstractphp classphp Zendphp_Pdfphp_Image
php{
php php php/php*php*php*php*php Classphp Constantsphp php*php*php*php*php/


php php php/php*php Imagephp Typesphp php*php/

php php php php constphp TYPEphp_UNKNOWNphp php=php php0php;
php php php php constphp TYPEphp_JPEGphp php=php php1php;
php php php php constphp TYPEphp_PNGphp php=php php2php;
php php php php constphp TYPEphp_TIFFphp php=php php3php;

php php php/php*php TIFFphp Constantsphp php*php/

php php php php constphp TIFFphp_FIELDphp_TYPEphp_BYTEphp=php1php;
php php php php constphp TIFFphp_FIELDphp_TYPEphp_ASCIIphp=php2php;
php php php php constphp TIFFphp_FIELDphp_TYPEphp_SHORTphp=php3php;
php php php php constphp TIFFphp_FIELDphp_TYPEphp_LONGphp=php4php;
php php php php constphp TIFFphp_FIELDphp_TYPEphp_RATIONALphp=php5php;

php php php php constphp TIFFphp_TAGphp_IMAGEphp_WIDTHphp=php2php5php6php;
php php php php constphp TIFFphp_TAGphp_IMAGEphp_LENGTHphp=php2php5php7php;php php/php/Height
php php php php constphp TIFFphp_TAGphp_BITSphp_PERphp_SAMPLEphp=php2php5php8php;
php php php php constphp TIFFphp_TAGphp_COMPRESSIONphp=php2php5php9php;
php php php php constphp TIFFphp_TAGphp_PHOTOMETRICphp_INTERPRETATIONphp=php2php6php2php;
php php php php constphp TIFFphp_TAGphp_STRIPphp_OFFSETSphp=php2php7php3php;
php php php php constphp TIFFphp_TAGphp_SAMPLESphp_PERphp_PIXELphp=php2php7php7php;
php php php php constphp TIFFphp_TAGphp_STRIPphp_BYTEphp_COUNTSphp=php2php7php9php;

php php php php constphp TIFFphp_COMPRESSIONphp_UNCOMPRESSEDphp php=php php1php;
php php php php constphp TIFFphp_COMPRESSIONphp_CCITTphp1Dphp php=php php2php;
php php php php constphp TIFFphp_COMPRESSIONphp_GROUPphp_php3php_FAXphp php=php php3php;
php php php php constphp TIFFphp_COMPRESSIONphp_GROUPphp_php4php_FAXphp php php=php php4php;
php php php php constphp TIFFphp_COMPRESSIONphp_LZWphp php=php php5php;
php php php php constphp TIFFphp_COMPRESSIONphp_JPEGphp php=php php6php;
php php php php constphp TIFFphp_COMPRESSIONphp_FLATEphp php=php php8php;
php php php php constphp TIFFphp_COMPRESSIONphp_FLATEphp_OBSOLETEphp_CODEphp php=php php3php2php9php4php6php;
php php php php constphp TIFFphp_COMPRESSIONphp_PACKBITSphp php=php php3php2php7php7php3php;

php php php php constphp TIFFphp_PHOTOMETRICphp_INTERPRETATIONphp_WHITEphp_ISphp_ZEROphp=php0php;
php php php php constphp TIFFphp_PHOTOMETRICphp_INTERPRETATIONphp_BLACKphp_ISphp_ZEROphp=php1php;
php php php php constphp TIFFphp_PHOTOMETRICphp_INTERPRETATIONphp_RGBphp=php2php;
php php php php constphp TIFFphp_PHOTOMETRICphp_INTERPRETATIONphp_RGBphp_INDEXEDphp=php3php;
php php php php constphp TIFFphp_PHOTOMETRICphp_INTERPRETATIONphp_CMYKphp=php5php;
php php php php constphp TIFFphp_PHOTOMETRICphp_INTERPRETATIONphp_YCBCRphp=php6php;
php php php php constphp TIFFphp_PHOTOMETRICphp_INTERPRETATIONphp_CIELABphp=php8php;

php php php/php*php PNGphp Constantsphp php*php/

php php php php constphp PNGphp_COMPRESSIONphp_DEFAULTphp_STRATEGYphp php=php php0php;
php php php php constphp PNGphp_COMPRESSIONphp_FILTEREDphp php=php php1php;
php php php php constphp PNGphp_COMPRESSIONphp_HUFFMANphp_ONLYphp php=php php2php;
php php php php constphp PNGphp_COMPRESSIONphp_RLEphp php=php php3php;

php php php php constphp PNGphp_FILTERphp_NONEphp php=php php0php;
php php php php constphp PNGphp_FILTERphp_SUBphp php=php php1php;
php php php php constphp PNGphp_FILTERphp_UPphp php=php php2php;
php php php php constphp PNGphp_FILTERphp_AVERAGEphp php=php php3php;
php php php php constphp PNGphp_FILTERphp_PAETHphp php=php php4php;

php php php php constphp PNGphp_INTERLACINGphp_DISABLEDphp php=php php0php;
php php php php constphp PNGphp_INTERLACINGphp_ENABLEDphp php=php php1php;

php php php php constphp PNGphp_CHANNELphp_GRAYphp php=php php0php;
php php php php constphp PNGphp_CHANNELphp_RGBphp php=php php2php;
php php php php constphp PNGphp_CHANNELphp_INDEXEDphp php=php php3php;
php php php php constphp PNGphp_CHANNELphp_GRAYphp_ALPHAphp php=php php4php;
php php php php constphp PNGphp_CHANNELphp_RGBphp_ALPHAphp php=php php6php;

php php php/php*php*php*php*php Publicphp Interfacephp php*php*php*php*php/


php php php/php*php Factoryphp Methodsphp php*php/

php php php php php/php*php*
php php php php php php*php Returnsphp aphp php{php@linkphp Zendphp_Pdfphp_Resourcephp_Imagephp}php objectphp byphp filephp pathphp.
php php php php php php*
php php php php php php*php php@paramphp stringphp php$filePathphp Fullphp pathphp tophp thephp imagephp filephp.
php php php php php php*php php@returnphp Zendphp_Pdfphp_Resourcephp_Image
php php php php php php*php php@throwsphp Zendphp_Pdfphp_Exception
php php php php php php*php/
php php php php publicphp staticphp functionphp imageWithPathphp(php$filePathphp)
php php php php php{
php php php php php php php php php/php*php*
php php php php php php php php php php*php usephp oldphp implementation
php php php php php php php php php php*php php@todophp switchphp tophp newphp implementation
php php php php php php php php php php*php/
php php php php php php php php requirephp_oncephp php'Zendphp/Pdfphp/Resourcephp/ImageFactoryphp.phpphp'php;
php php php php php php php php returnphp Zendphp_Pdfphp_Resourcephp_ImageFactoryphp:php:factoryphp(php$filePathphp)php;


php php php php php php php php php/php*php Createphp aphp filephp parserphp dataphp sourcephp objectphp forphp thisphp filephp.php Filephp pathphp and
php php php php php php php php php php*php accessphp permissionphp checksphp arephp handledphp herephp.
php php php php php php php php php php*php/
php php php php php php php php requirephp_oncephp php'Zendphp/Pdfphp/FileParserDataSourcephp/Filephp.phpphp'php;
php php php php php php php php php$dataSourcephp php=php newphp Zendphp_Pdfphp_FileParserDataSourcephp_Filephp(php$filePathphp)php;

php php php php php php php php php/php*php Attemptphp tophp determinephp thephp typephp ofphp imagephp.php Wephp canphp'tphp alwaysphp trustphp file
php php php php php php php php php php*php extensionsphp,php butphp tryphp thatphp firstphp sincephp itphp'sphp fastestphp.
php php php php php php php php php php*php/
php php php php php php php php php$fileExtensionphp php=php strtolowerphp(pathinfophp(php$filePathphp,php PATHINFOphp_EXTENSIONphp)php)php;

php php php php php php php php php/php*php Ifphp itphp turnsphp outphp thatphp thephp filephp isphp namedphp improperlyphp andphp wephp guessphp the
php php php php php php php php php php*php wrongphp typephp,php wephp'llphp getphp nullphp insteadphp ofphp anphp imagephp objectphp.
php php php php php php php php php php*php/
php php php php php php php php switchphp php(php$fileExtensionphp)php php{
php php php php php php php php php php php php casephp php'tifphp'php:
php php php php php php php php php php php php php php php php php/php/Fallphp throughphp tophp nextphp casephp;
php php php php php php php php php php php php casephp php'tiffphp'php:
php php php php php php php php php php php php php php php php php$imagephp php=php Zendphp_Pdfphp_Imagephp:php:php_extractTiffImagephp(php$dataSourcephp)php;
php php php php php php php php php php php php php php php php breakphp;
php php php php php php php php php php php php casephp php'pngphp'php:
php php php php php php php php php php php php php php php php php$imagephp php=php Zendphp_Pdfphp_Imagephp:php:php_extractPngImagephp(php$dataSourcephp)php;
php php php php php php php php php php php php php php php php breakphp;
php php php php php php php php php php php php casephp php'jpgphp'php:
php php php php php php php php php php php php php php php php php/php/Fallphp throughphp tophp nextphp casephp;
php php php php php php php php php php php php casephp php'jpephp'php:
php php php php php php php php php php php php php php php php php/php/Fallphp throughphp tophp nextphp casephp;
php php php php php php php php php php php php casephp php'jpegphp'php:
php php php php php php php php php php php php php php php php php$imagephp php=php Zendphp_Pdfphp_Imagephp:php:php_extractJpegImagephp(php$dataSourcephp)php;
php php php php php php php php php php php php php php php php breakphp;
php php php php php php php php php php php php defaultphp:
php php php php php php php php php php php php php php php php requirephp_oncephp php'Zendphp/Pdfphp/Exceptionphp.phpphp'php;
php php php php php php php php php php php php php php php php throwphp newphp Zendphp_Pdfphp_Exceptionphp(php"Cannotphp createphp imagephp resourcephp.php Filephp extensionphp notphp knownphp orphp unsupportedphp typephp.php"php)php;
php php php php php php php php php php php php php php php php breakphp;
php php php php php php php php php}

php php php php php php php php php/php*php Donephp withphp thephp dataphp sourcephp objectphp.
php php php php php php php php php php*php/
php php php php php php php php php$dataSourcephp php=php nullphp;

php php php php php php php php ifphp php(php$imagephp php!php=php=php nullphp)php php{
php php php php php php php php php php php php returnphp php$imagephp;

php php php php php php php php php}php elsephp php{
php php php php php php php php php php php php php/php*php Thephp typephp ofphp imagephp couldphp notphp bephp determinedphp.php Givephp upphp.
php php php php php php php php php php php php php php*php/
php php php php php php php php php php php php requirephp_oncephp php'Zendphp/Pdfphp/Exceptionphp.phpphp'php;
php php php php php php php php php php php php throwphp newphp Zendphp_Pdfphp_Exceptionphp(php"Cannotphp determinephp imagephp typephp:php php$filePathphp"php,
php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php Zendphp_Pdfphp_Exceptionphp:php:CANTphp_DETERMINEphp_IMAGEphp_TYPEphp)php;
php php php php php php php php php php}
php php php php php}



php php php php php/php*php*php*php*php Internalphp Methodsphp php*php*php*php*php/


php php php php php/php*php Imagephp Extractionphp Methodsphp php*php/

php php php php php/php*php*
php php php php php php*php Attemptsphp tophp extractphp aphp JPEGphp Imagephp fromphp thephp dataphp sourcephp.
php php php php php php*
php php php php php php*php php@paramphp Zendphp_Pdfphp_FileParserDataSourcephp php$dataSource
php php php php php php*php php@returnphp Zendphp_Pdfphp_Resourcephp_Imagephp_Jpegphp Mayphp alsophp returnphp nullphp if
php php php php php php*php php php thephp dataphp sourcephp doesphp notphp appearphp tophp containphp validphp imagephp dataphp.
php php php php php php*php php@throwsphp Zendphp_Pdfphp_Exception
php php php php php php*php/
php php php php protectedphp staticphp functionphp php_extractJpegImagephp(php$dataSourcephp)
php php php php php{
php php php php php php php php requirephp_oncephp php'Zendphp/Pdfphp/Exceptionphp.phpphp'php;
php php php php php php php php throwphp newphp Zendphp_Pdfphp_Exceptionphp(php'Jpegphp imagephp fileparserphp isphp notphp implementedphp.php Oldphp stylyphp implementationphp hasphp tophp bephp usedphp.php'php)php;

php php php php php php php php requirephp_oncephp php'Zendphp/Pdfphp/FileParserphp/Imagephp/Jpegphp.phpphp'php;
php php php php php php php php php$imageParserphp php=php newphp Zendphp_Pdfphp_FileParserphp_Imagephp_Jpegphp(php$dataSourcephp)php;
php php php php php php php php requirephp_oncephp php'Zendphp/Pdfphp/Resourcephp/Imagephp/Jpegphp.phpphp'php;
php php php php php php php php php$imagephp php=php newphp Zendphp_Pdfphp_Resourcephp_Imagephp_Jpegphp(php$imageParserphp)php;
php php php php php php php php unsetphp(php$imageParserphp)php;

php php php php php php php php returnphp php$imagephp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Attemptsphp tophp extractphp aphp PNGphp Imagephp fromphp thephp dataphp sourcephp.
php php php php php php*
php php php php php php*php php@paramphp Zendphp_Pdfphp_FileParserDataSourcephp php$dataSource
php php php php php php*php php@returnphp Zendphp_Pdfphp_Resourcephp_Imagephp_Pngphp Mayphp alsophp returnphp nullphp if
php php php php php php*php php php thephp dataphp sourcephp doesphp notphp appearphp tophp containphp validphp imagephp dataphp.
php php php php php php*php/
php php php php protectedphp staticphp functionphp php_extractPngImagephp(php$dataSourcephp)
php php php php php{
php php php php php php php php requirephp_oncephp php'Zendphp/Pdfphp/FileParserphp/Imagephp/Pngphp.phpphp'php;
php php php php php php php php php$imageParserphp php=php newphp Zendphp_Pdfphp_FileParserphp_Imagephp_Pngphp(php$dataSourcephp)php;
php php php php php php php php requirephp_oncephp php'Zendphp/Pdfphp/Resourcephp/Imagephp/Pngphp.phpphp'php;
php php php php php php php php php$imagephp php=php newphp Zendphp_Pdfphp_Resourcephp_Imagephp_Pngphp(php$imageParserphp)php;
php php php php php php php php unsetphp(php$imageParserphp)php;

php php php php php php php php returnphp php$imagephp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Attemptsphp tophp extractphp aphp TIFFphp Imagephp fromphp thephp dataphp sourcephp.
php php php php php php*
php php php php php php*php php@paramphp Zendphp_Pdfphp_FileParserDataSourcephp php$dataSource
php php php php php php*php php@returnphp Zendphp_Pdfphp_Resourcephp_Imagephp_Tiffphp Mayphp alsophp returnphp nullphp if
php php php php php php*php php php thephp dataphp sourcephp doesphp notphp appearphp tophp containphp validphp imagephp dataphp.
php php php php php php*php php@throwsphp Zendphp_Pdfphp_Exception
php php php php php php*php/
php php php php protectedphp staticphp functionphp php_extractTiffImagephp(php$dataSourcephp)
php php php php php{
php php php php php php php php requirephp_oncephp php'Zendphp/Pdfphp/Exceptionphp.phpphp'php;
php php php php php php php php throwphp newphp Zendphp_Pdfphp_Exceptionphp(php'Tiffphp imagephp fileparserphp isphp notphp implementedphp.php Oldphp stylyphp implementationphp hasphp tophp bephp usedphp.php'php)php;

php php php php php php php php requirephp_oncephp php'Zendphp/Pdfphp/FileParserphp/Imagephp/Tiffphp.phpphp'php;
php php php php php php php php php$imageParserphp php=php newphp Zendphp_Pdfphp_FileParserphp_Imagephp_Tiffphp(php$dataSourcephp)php;
php php php php php php php php requirephp_oncephp php'Zendphp/Pdfphp/Resourcephp/Imagephp/Tiffphp.phpphp'php;
php php php php php php php php php$imagephp php=php newphp Zendphp_Pdfphp_Resourcephp_Imagephp_Tiffphp(php$imageParserphp)php;
php php php php php php php php unsetphp(php$imageParserphp)php;

php php php php php php php php returnphp php$imagephp;
php php php php php}
php}
