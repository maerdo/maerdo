<php?php
php/php*php*
php php*php Zendphp Framework
php php*
php php*php LICENSE
php php*
php php*php Thisphp sourcephp filephp isphp subjectphp tophp thephp newphp BSDphp licensephp thatphp isphp bundled
php php*php withphp thisphp packagephp inphp thephp filephp LICENSEphp.txtphp.
php php*php Itphp isphp alsophp availablephp throughphp thephp worldphp-widephp-webphp atphp thisphp URLphp:
php php*php httpphp:php/php/frameworkphp.zendphp.comphp/licensephp/newphp-bsd
php php*php Ifphp youphp didphp notphp receivephp aphp copyphp ofphp thephp licensephp andphp arephp unablephp to
php php*php obtainphp itphp throughphp thephp worldphp-widephp-webphp,php pleasephp sendphp anphp email
php php*php tophp licensephp@zendphp.comphp sophp wephp canphp sendphp youphp aphp copyphp immediatelyphp.
php php*
php php*php php@categoryphp php Zend
php php*php php@packagephp php php Zendphp_Uri
php php*php php@copyrightphp php Copyrightphp php(cphp)php php2php0php0php5php-php2php0php1php0php Zendphp Technologiesphp USAphp Incphp.php php(httpphp:php/php/wwwphp.zendphp.comphp)
php php*php php@licensephp php php httpphp:php/php/frameworkphp.zendphp.comphp/licensephp/newphp-bsdphp php php php php Newphp BSDphp License
php php*php php@versionphp php php php$Idphp:php Httpphp.phpphp php2php3php4php0php9php php2php0php1php0php-php1php1php-php1php9php php1php9php:php5php5php:php2php5Zphp bittarmanphp php$
php php*php/

php/php*php*
php php*php php@seephp Zendphp_Uri
php php*php/
requirephp_oncephp php'Zendphp/Uriphp.phpphp'php;

php/php*php*
php php*php php@seephp Zendphp_Validatephp_Hostname
php php*php/
requirephp_oncephp php'Zendphp/Validatephp/Hostnamephp.phpphp'php;

php/php*php*
php php*php HTTPphp(Sphp)php URIphp handler
php php*
php php*php php@categoryphp php Zend
php php*php php@packagephp php php Zendphp_Uri
php php*php php@usesphp php php php php php Zendphp_Uri
php php*php php@copyrightphp php Copyrightphp php(cphp)php php2php0php0php5php-php2php0php1php0php Zendphp Technologiesphp USAphp Incphp.php php(httpphp:php/php/wwwphp.zendphp.comphp)
php php*php php@licensephp php php httpphp:php/php/frameworkphp.zendphp.comphp/licensephp/newphp-bsdphp php php php php Newphp BSDphp License
php php*php/
classphp Zendphp_Uriphp_Httpphp extendsphp Zendphp_Uri
php{
php php php php php/php*php*
php php php php php php*php Characterphp classesphp forphp validationphp regularphp expressions
php php php php php php*php/
php php php php constphp CHARphp_ALNUMphp php php php php=php php'Aphp-Zaphp-zphp0php-php9php'php;
php php php php constphp CHARphp_MARKphp php php php php php=php php'php-php_php.php!php~php*php\php'php(php)php\php[php\php]php'php;
php php php php constphp CHARphp_RESERVEDphp php=php php'php;php\php/php?php:php@php&php=php+php$php,php'php;
php php php php constphp CHARphp_SEGMENTphp php php=php php'php:php@php&php=php+php$php,php;php'php;
php php php php constphp CHARphp_UNWISEphp php php php=php php'php{php}php|php\php\php\php\php^php`php'php;

php php php php php/php*php*
php php php php php php*php HTTPphp username
php php php php php php*
php php php php php php*php php@varphp string
php php php php php php*php/
php php php php protectedphp php$php_usernamephp php=php php'php'php;

php php php php php/php*php*
php php php php php php*php HTTPphp password
php php php php php php*
php php php php php php*php php@varphp string
php php php php php php*php/
php php php php protectedphp php$php_passwordphp php=php php'php'php;

php php php php php/php*php*
php php php php php php*php HTTPphp host
php php php php php php*
php php php php php php*php php@varphp string
php php php php php php*php/
php php php php protectedphp php$php_hostphp php=php php'php'php;

php php php php php/php*php*
php php php php php php*php HTTPphp post
php php php php php php*
php php php php php php*php php@varphp string
php php php php php php*php/
php php php php protectedphp php$php_portphp php=php php'php'php;

php php php php php/php*php*
php php php php php php*php HTTPphp part
php php php php php php*
php php php php php php*php php@varphp string
php php php php php php*php/
php php php php protectedphp php$php_pathphp php=php php'php'php;

php php php php php/php*php*
php php php php php php*php HTTPphp query
php php php php php php*
php php php php php php*php php@varphp string
php php php php php php*php/
php php php php protectedphp php$php_queryphp php=php php'php'php;

php php php php php/php*php*
php php php php php php*php HTTPphp fragment
php php php php php php*
php php php php php php*php php@varphp string
php php php php php php*php/
php php php php protectedphp php$php_fragmentphp php=php php'php'php;

php php php php php/php*php*
php php php php php php*php Regularphp expressionphp grammarphp rulesphp forphp validationphp;php valuesphp addedphp byphp constructor
php php php php php php*
php php php php php php*php php@varphp array
php php php php php php*php/
php php php php protectedphp php$php_regexphp php=php arrayphp(php)php;

php php php php php/php*php*
php php php php php php*php Constructorphp acceptsphp aphp stringphp php$schemephp php(ephp.gphp.php,php httpphp,php httpsphp)php andphp aphp schemephp-specificphp partphp ofphp thephp URI
php php php php php php*php php(ephp.gphp.php,php examplephp.comphp/pathphp/tophp/resourcephp?queryphp=paramphp#fragmentphp)
php php php php php php*
php php php php php php*php php@paramphp php stringphp php$schemephp php php php php php php php php Thephp schemephp ofphp thephp URI
php php php php php php*php php@paramphp php stringphp php$schemeSpecificphp Thephp schemephp-specificphp partphp ofphp thephp URI
php php php php php php*php php@throwsphp Zendphp_Uriphp_Exceptionphp Whenphp thephp URIphp isphp notphp valid
php php php php php php*php/
php php php php protectedphp functionphp php_php_constructphp(php$schemephp,php php$schemeSpecificphp php=php php'php'php)
php php php php php{
php php php php php php php php php/php/php Setphp thephp scheme
php php php php php php php php php$thisphp-php>php_schemephp php=php php$schemephp;

php php php php php php php php php/php/php Setphp upphp grammarphp rulesphp forphp validationphp viaphp regularphp expressionsphp.php These
php php php php php php php php php/php/php arephp tophp bephp usedphp withphp slashphp-delimitedphp regularphp expressionphp stringsphp.

php php php php php php php php php/php/php Escapedphp specialphp charactersphp php(egphp.php php'php%php2php5php'php forphp php'php%php'php)
php php php php php php php php php$thisphp-php>php_regexphp[php'escapedphp'php]php php php php php=php php'php%php[php[php:xdigitphp:php]php]php{php2php}php'php;

php php php php php php php php php/php/php Unreservedphp characters
php php php php php php php php php$thisphp-php>php_regexphp[php'unreservedphp'php]php php=php php'php[php'php php.php selfphp:php:CHARphp_ALNUMphp php.php selfphp:php:CHARphp_MARKphp php.php php'php]php'php;

php php php php php php php php php/php/php Segmentphp canphp usephp escapedphp,php unreservedphp orphp aphp setphp ofphp additionalphp chars
php php php php php php php php php$thisphp-php>php_regexphp[php'segmentphp'php]php php php php php=php php'php(php?php:php'php php.php php$thisphp-php>php_regexphp[php'escapedphp'php]php php.php php'php|php[php'php php.
php php php php php php php php php php php php selfphp:php:CHARphp_ALNUMphp php.php selfphp:php:CHARphp_MARKphp php.php selfphp:php:CHARphp_SEGMENTphp php.php php'php]php)php*php'php;

php php php php php php php php php/php/php Pathphp canphp bephp aphp seriesphp ofphp segmetsphp charphp stringsphp seperatedphp byphp php'php/php'
php php php php php php php php php$thisphp-php>php_regexphp[php'pathphp'php]php php php php php php php php=php php'php(php?php:php\php/php(php?php:php'php php.php php$thisphp-php>php_regexphp[php'segmentphp'php]php php.php php'php)php?php)php+php'php;

php php php php php php php php php/php/php URIphp charactersphp canphp bephp escapedphp,php alphanumericphp,php markphp orphp reservedphp chars
php php php php php php php php php$thisphp-php>php_regexphp[php'uricphp'php]php php php php php php php php=php php'php(php?php:php'php php.php php$thisphp-php>php_regexphp[php'escapedphp'php]php php.php php'php|php[php'php php.
php php php php php php php php php php php php selfphp:php:CHARphp_ALNUMphp php.php selfphp:php:CHARphp_MARKphp php.php selfphp:php:CHARphp_RESERVEDphp php.

php php php php php php php php php/php/php Ifphp unwisephp charsphp arephp allowedphp,php addphp themphp tophp thephp URIphp charsphp class
php php php php php php php php php php php php php(selfphp:php:php$php_configphp[php'allowphp_unwisephp'php]php php?php selfphp:php:CHARphp_UNWISEphp php:php php'php'php)php php.php php'php]php)php'php;

php php php php php php php php php/php/php Ifphp nophp schemephp-specificphp partphp wasphp suppliedphp,php thephp userphp intendsphp tophp create
php php php php php php php php php/php/php aphp newphp URIphp withphp thisphp objectphp.php php Nophp furtherphp parsingphp isphp requiredphp.
php php php php php php php php ifphp php(strlenphp(php$schemeSpecificphp)php php=php=php=php php0php)php php{
php php php php php php php php php php php php returnphp;
php php php php php php php php php}

php php php php php php php php php/php/php Parsephp thephp schemephp-specificphp URIphp partsphp intophp thephp instancephp variablesphp.
php php php php php php php php php$thisphp-php>php_parseUriphp(php$schemeSpecificphp)php;

php php php php php php php php php/php/php Validatephp thephp URI
php php php php php php php php ifphp php(php$thisphp-php>validphp(php)php php=php=php=php falsephp)php php{
php php php php php php php php php php php php requirephp_oncephp php'Zendphp/Uriphp/Exceptionphp.phpphp'php;
php php php php php php php php php php php php throwphp newphp Zendphp_Uriphp_Exceptionphp(php'Invalidphp URIphp suppliedphp'php)php;
php php php php php php php php php}
php php php php php}

php php php php php/php*php*
php php php php php php*php Createsphp aphp Zendphp_Uriphp_Httpphp fromphp thephp givenphp string
php php php php php php*
php php php php php php*php php@paramphp php stringphp php$uriphp Stringphp tophp createphp URIphp fromphp,php mustphp startphp with
php php php php php php*php php php php php php php php php php php php php php php php php php php php php php'httpphp:php/php/php'php orphp php'httpsphp:php/php/php'
php php php php php php*php php@throwsphp InvalidArgumentExceptionphp php Whenphp thephp givenphp php$uriphp isphp notphp aphp stringphp or
php php php php php php*php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php doesphp notphp startphp withphp httpphp:php/php/php orphp httpsphp:php/php/
php php php php php php*php php@throwsphp Zendphp_Uriphp_Exceptionphp php php php php php php php Whenphp thephp givenphp php$uriphp isphp invalid
php php php php php php*php php@returnphp Zendphp_Uriphp_Http
php php php php php php*php/
php php php php publicphp staticphp functionphp fromStringphp(php$uriphp)
php php php php php{
php php php php php php php php ifphp php(isphp_stringphp(php$uriphp)php php=php=php=php falsephp)php php{
php php php php php php php php php php php php requirephp_oncephp php'Zendphp/Uriphp/Exceptionphp.phpphp'php;
php php php php php php php php php php php php throwphp newphp Zendphp_Uriphp_Exceptionphp(php'php$uriphp isphp notphp aphp stringphp'php)php;
php php php php php php php php php}

php php php php php php php php php$uriphp php php php php php php php php php php php php=php explodephp(php'php:php'php,php php$uriphp,php php2php)php;
php php php php php php php php php$schemephp php php php php php php php php php=php strtolowerphp(php$uriphp[php0php]php)php;
php php php php php php php php php$schemeSpecificphp php=php issetphp(php$uriphp[php1php]php)php php=php=php=php truephp php?php php$uriphp[php1php]php php:php php'php'php;

php php php php php php php php ifphp php(inphp_arrayphp(php$schemephp,php arrayphp(php'httpphp'php,php php'httpsphp'php)php)php php=php=php=php falsephp)php php{
php php php php php php php php php php php php requirephp_oncephp php'Zendphp/Uriphp/Exceptionphp.phpphp'php;
php php php php php php php php php php php php throwphp newphp Zendphp_Uriphp_Exceptionphp(php"Invalidphp schemephp:php php'php$schemephp'php"php)php;
php php php php php php php php php}

php php php php php php php php php$schemeHandlerphp php=php newphp Zendphp_Uriphp_Httpphp(php$schemephp,php php$schemeSpecificphp)php;
php php php php php php php php returnphp php$schemeHandlerphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Parsephp thephp schemephp-specificphp portionphp ofphp thephp URIphp andphp placephp itsphp partsphp intophp instancephp variablesphp.
php php php php php php*
php php php php php php*php php@paramphp php stringphp php$schemeSpecificphp Thephp schemephp-specificphp portionphp tophp parse
php php php php php php*php php@throwsphp Zendphp_Uriphp_Exceptionphp Whenphp schemephp-specificphp decopositionphp fails
php php php php php php*php php@throwsphp Zendphp_Uriphp_Exceptionphp Whenphp authorityphp decompositionphp fails
php php php php php php*php php@returnphp void
php php php php php php*php/
php php php php protectedphp functionphp php_parseUriphp(php$schemeSpecificphp)
php php php php php{
php php php php php php php php php/php/php Highphp-levelphp decompositionphp parser
php php php php php php php php php$patternphp php=php php'php~php^php(php(php/php/php)php(php[php^php/php?php#php]php*php)php)php(php[php^php?php#php]php*php)php(php\php?php(php[php^php#php]php*php)php)php?php(php#php(php.php*php)php)php?php$php~php'php;
php php php php php php php php php$statusphp php php=php php@pregphp_matchphp(php$patternphp,php php$schemeSpecificphp,php php$matchesphp)php;
php php php php php php php php ifphp php(php$statusphp php=php=php=php falsephp)php php{
php php php php php php php php php php php php requirephp_oncephp php'Zendphp/Uriphp/Exceptionphp.phpphp'php;
php php php php php php php php php php php php throwphp newphp Zendphp_Uriphp_Exceptionphp(php'Internalphp errorphp:php schemephp-specificphp decompositionphp failedphp'php)php;
php php php php php php php php php}

php php php php php php php php php/php/php Failedphp decompositionphp;php nophp furtherphp processingphp needed
php php php php php php php php ifphp php(php$statusphp php=php=php=php falsephp)php php{
php php php php php php php php php php php php returnphp;
php php php php php php php php php}

php php php php php php php php php/php/php Savephp URIphp componentsphp thatphp needphp nophp furtherphp decomposition
php php php php php php php php php$thisphp-php>php_pathphp php php php php php=php issetphp(php$matchesphp[php4php]php)php php=php=php=php truephp php?php php$matchesphp[php4php]php php:php php'php'php;
php php php php php php php php php$thisphp-php>php_queryphp php php php php=php issetphp(php$matchesphp[php6php]php)php php=php=php=php truephp php?php php$matchesphp[php6php]php php:php php'php'php;
php php php php php php php php php$thisphp-php>php_fragmentphp php=php issetphp(php$matchesphp[php8php]php)php php=php=php=php truephp php?php php$matchesphp[php8php]php php:php php'php'php;

php php php php php php php php php/php/php Additionalphp decompositionphp tophp getphp usernamephp,php passwordphp,php hostphp,php andphp port
php php php php php php php php php$combophp php php php=php issetphp(php$matchesphp[php3php]php)php php=php=php=php truephp php?php php$matchesphp[php3php]php php:php php'php'php;
php php php php php php php php php$patternphp php=php php'php~php^php(php(php[php^php:php@php]php*php)php(php:php(php[php^php@php]php*php)php)php?php@php)php?php(php[php^php:php]php+php)php(php:php(php.php*php)php)php?php$php~php'php;
php php php php php php php php php$statusphp php php=php php@pregphp_matchphp(php$patternphp,php php$combophp,php php$matchesphp)php;
php php php php php php php php ifphp php(php$statusphp php=php=php=php falsephp)php php{
php php php php php php php php php php php php requirephp_oncephp php'Zendphp/Uriphp/Exceptionphp.phpphp'php;
php php php php php php php php php php php php throwphp newphp Zendphp_Uriphp_Exceptionphp(php'Internalphp errorphp:php authorityphp decompositionphp failedphp'php)php;
php php php php php php php php php}

php php php php php php php php php/php/php Failedphp decompositionphp;php nophp furtherphp processingphp needed
php php php php php php php php ifphp php(php$statusphp php=php=php=php falsephp)php php{
php php php php php php php php php php php php returnphp;
php php php php php php php php php}

php php php php php php php php php/php/php Savephp remainingphp URIphp components
php php php php php php php php php$thisphp-php>php_usernamephp php=php issetphp(php$matchesphp[php2php]php)php php=php=php=php truephp php?php php$matchesphp[php2php]php php:php php'php'php;
php php php php php php php php php$thisphp-php>php_passwordphp php=php issetphp(php$matchesphp[php4php]php)php php=php=php=php truephp php?php php$matchesphp[php4php]php php:php php'php'php;
php php php php php php php php php$thisphp-php>php_hostphp php php php php php=php issetphp(php$matchesphp[php5php]php)php php=php=php=php truephp php?php php$matchesphp[php5php]php php:php php'php'php;
php php php php php php php php php$thisphp-php>php_portphp php php php php php=php issetphp(php$matchesphp[php7php]php)php php=php=php=php truephp php?php php$matchesphp[php7php]php php:php php'php'php;

php php php php php}

php php php php php/php*php*
php php php php php php*php Returnsphp aphp URIphp basedphp onphp currentphp valuesphp ofphp thephp instancephp variablesphp.php Ifphp any
php php php php php php*php partphp ofphp thephp URIphp doesphp notphp passphp validationphp,php thenphp anphp exceptionphp isphp thrownphp.
php php php php php php*
php php php php php php*php php@throwsphp Zendphp_Uriphp_Exceptionphp Whenphp onephp orphp morephp partsphp ofphp thephp URIphp arephp invalid
php php php php php php*php php@returnphp string
php php php php php php*php/
php php php php publicphp functionphp getUriphp(php)
php php php php php{
php php php php php php php php ifphp php(php$thisphp-php>validphp(php)php php=php=php=php falsephp)php php{
php php php php php php php php php php php php requirephp_oncephp php'Zendphp/Uriphp/Exceptionphp.phpphp'php;
php php php php php php php php php php php php throwphp newphp Zendphp_Uriphp_Exceptionphp(php'Onephp orphp morephp partsphp ofphp thephp URIphp arephp invalidphp'php)php;
php php php php php php php php php}

php php php php php php php php php$passwordphp php=php strlenphp(php$thisphp-php>php_passwordphp)php php>php php0php php?php php"php:php$thisphp-php>php_passwordphp"php php:php php'php'php;
php php php php php php php php php$authphp php php php php php=php strlenphp(php$thisphp-php>php_usernamephp)php php>php php0php php?php php"php$thisphp-php>php_usernamephp$passwordphp@php"php php:php php'php'php;
php php php php php php php php php$portphp php php php php php=php strlenphp(php$thisphp-php>php_portphp)php php>php php0php php?php php"php:php$thisphp-php>php_portphp"php php:php php'php'php;
php php php php php php php php php$queryphp php php php php=php strlenphp(php$thisphp-php>php_queryphp)php php>php php0php php?php php"php?php$thisphp-php>php_queryphp"php php:php php'php'php;
php php php php php php php php php$fragmentphp php=php strlenphp(php$thisphp-php>php_fragmentphp)php php>php php0php php?php php"php#php$thisphp-php>php_fragmentphp"php php:php php'php'php;

php php php php php php php php returnphp php$thisphp-php>php_scheme
php php php php php php php php php php php php php php.php php'php:php/php/php'
php php php php php php php php php php php php php php.php php$auth
php php php php php php php php php php php php php php.php php$thisphp-php>php_host
php php php php php php php php php php php php php php.php php$port
php php php php php php php php php php php php php php.php php$thisphp-php>php_path
php php php php php php php php php php php php php php.php php$query
php php php php php php php php php php php php php php.php php$fragmentphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Validatephp thephp currentphp URIphp fromphp thephp instancephp variablesphp.php Returnsphp truephp ifphp andphp onlyphp ifphp all
php php php php php php*php partsphp passphp validationphp.
php php php php php php*
php php php php php php*php php@returnphp boolean
php php php php php php*php/
php php php php publicphp functionphp validphp(php)
php php php php php{
php php php php php php php php php/php/php Returnphp truephp ifphp andphp onlyphp ifphp allphp partsphp ofphp thephp URIphp havephp passedphp validation
php php php php php php php php returnphp php$thisphp-php>validateUsernamephp(php)
php php php php php php php php php php php andphp php$thisphp-php>validatePasswordphp(php)
php php php php php php php php php php php andphp php$thisphp-php>validateHostphp(php)
php php php php php php php php php php php andphp php$thisphp-php>validatePortphp(php)
php php php php php php php php php php php andphp php$thisphp-php>validatePathphp(php)
php php php php php php php php php php php andphp php$thisphp-php>validateQueryphp(php)
php php php php php php php php php php php andphp php$thisphp-php>validateFragmentphp(php)php;
php php php php php}

php php php php php/php*php*
php php php php php php*php Returnsphp thephp usernamephp portionphp ofphp thephp URLphp,php orphp FALSEphp ifphp nonephp.
php php php php php php*
php php php php php php*php php@returnphp string
php php php php php php*php/
php php php php publicphp functionphp getUsernamephp(php)
php php php php php{
php php php php php php php php returnphp strlenphp(php$thisphp-php>php_usernamephp)php php>php php0php php?php php$thisphp-php>php_usernamephp php:php falsephp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Returnsphp truephp ifphp andphp onlyphp ifphp thephp usernamephp passesphp validationphp.php Ifphp nophp usernamephp isphp passedphp,
php php php php php php*php thenphp thephp usernamephp containedphp inphp thephp instancephp variablephp isphp usedphp.
php php php php php php*
php php php php php php*php php@paramphp php stringphp php$usernamephp Thephp HTTPphp username
php php php php php php*php php@throwsphp Zendphp_Uriphp_Exceptionphp Whenphp usernamephp validationphp fails
php php php php php php*php php@returnphp boolean
php php php php php php*php php@linkphp php php httpphp:php/php/wwwphp.faqsphp.orgphp/rfcsphp/rfcphp2php3php9php6php.html
php php php php php php*php/
php php php php publicphp functionphp validateUsernamephp(php$usernamephp php=php nullphp)
php php php php php{
php php php php php php php php ifphp php(php$usernamephp php=php=php=php nullphp)php php{
php php php php php php php php php php php php php$usernamephp php=php php$thisphp-php>php_usernamephp;
php php php php php php php php php}

php php php php php php php php php/php/php Ifphp thephp usernamephp isphp emptyphp,php thenphp itphp isphp consideredphp valid
php php php php php php php php ifphp php(strlenphp(php$usernamephp)php php=php=php=php php0php)php php{
php php php php php php php php php php php php returnphp truephp;
php php php php php php php php php}

php php php php php php php php php/php/php Checkphp thephp usernamephp againstphp thephp allowedphp values
php php php php php php php php php$statusphp php=php php@pregphp_matchphp(php'php/php^php(php?php:php'php php.php php$thisphp-php>php_regexphp[php'escapedphp'php]php php.php php'php|php[php'php php.
php php php php php php php php php php php php selfphp:php:CHARphp_ALNUMphp php.php selfphp:php:CHARphp_MARKphp php.php php'php;php:php&php=php+php$php,php'php php.php php'php]php)php+php$php/php'php,php php$usernamephp)php;

php php php php php php php php ifphp php(php$statusphp php=php=php=php falsephp)php php{
php php php php php php php php php php php php requirephp_oncephp php'Zendphp/Uriphp/Exceptionphp.phpphp'php;
php php php php php php php php php php php php throwphp newphp Zendphp_Uriphp_Exceptionphp(php'Internalphp errorphp:php usernamephp validationphp failedphp'php)php;
php php php php php php php php php}

php php php php php php php php returnphp php$statusphp php=php=php=php php1php;
php php php php php}

php php php php php/php*php*
php php php php php php*php Setsphp thephp usernamephp forphp thephp currentphp URIphp,php andphp returnsphp thephp oldphp username
php php php php php php*
php php php php php php*php php@paramphp php stringphp php$usernamephp Thephp HTTPphp username
php php php php php php*php php@throwsphp Zendphp_Uriphp_Exceptionphp Whenphp php$usernamephp isphp notphp aphp validphp HTTPphp username
php php php php php php*php php@returnphp string
php php php php php php*php/
php php php php publicphp functionphp setUsernamephp(php$usernamephp)
php php php php php{
php php php php php php php php ifphp php(php$thisphp-php>validateUsernamephp(php$usernamephp)php php=php=php=php falsephp)php php{
php php php php php php php php php php php php requirephp_oncephp php'Zendphp/Uriphp/Exceptionphp.phpphp'php;
php php php php php php php php php php php php throwphp newphp Zendphp_Uriphp_Exceptionphp(php"Usernamephp php\php"php$usernamephp\php"php isphp notphp aphp validphp HTTPphp usernamephp"php)php;
php php php php php php php php php}

php php php php php php php php php$oldUsernamephp php php php php php=php php$thisphp-php>php_usernamephp;
php php php php php php php php php$thisphp-php>php_usernamephp php=php php$usernamephp;

php php php php php php php php returnphp php$oldUsernamephp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Returnsphp thephp passwordphp portionphp ofphp thephp URLphp,php orphp FALSEphp ifphp nonephp.
php php php php php php*
php php php php php php*php php@returnphp string
php php php php php php*php/
php php php php publicphp functionphp getPasswordphp(php)
php php php php php{
php php php php php php php php returnphp strlenphp(php$thisphp-php>php_passwordphp)php php>php php0php php?php php$thisphp-php>php_passwordphp php:php falsephp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Returnsphp truephp ifphp andphp onlyphp ifphp thephp passwordphp passesphp validationphp.php Ifphp nophp passwordphp isphp passedphp,
php php php php php php*php thenphp thephp passwordphp containedphp inphp thephp instancephp variablephp isphp usedphp.
php php php php php php*
php php php php php php*php php@paramphp php stringphp php$passwordphp Thephp HTTPphp password
php php php php php php*php php@throwsphp Zendphp_Uriphp_Exceptionphp Whenphp passwordphp validationphp fails
php php php php php php*php php@returnphp boolean
php php php php php php*php php@linkphp php php httpphp:php/php/wwwphp.faqsphp.orgphp/rfcsphp/rfcphp2php3php9php6php.html
php php php php php php*php/
php php php php publicphp functionphp validatePasswordphp(php$passwordphp php=php nullphp)
php php php php php{
php php php php php php php php ifphp php(php$passwordphp php=php=php=php nullphp)php php{
php php php php php php php php php php php php php$passwordphp php=php php$thisphp-php>php_passwordphp;
php php php php php php php php php}

php php php php php php php php php/php/php Ifphp thephp passwordphp isphp emptyphp,php thenphp itphp isphp consideredphp valid
php php php php php php php php ifphp php(strlenphp(php$passwordphp)php php=php=php=php php0php)php php{
php php php php php php php php php php php php returnphp truephp;
php php php php php php php php php}

php php php php php php php php php/php/php Ifphp thephp passwordphp isphp nonemptyphp,php butphp therephp isphp nophp usernamephp,php thenphp itphp isphp consideredphp invalid
php php php php php php php php ifphp php(strlenphp(php$passwordphp)php php>php php0php andphp strlenphp(php$thisphp-php>php_usernamephp)php php=php=php=php php0php)php php{
php php php php php php php php php php php php returnphp falsephp;
php php php php php php php php php}

php php php php php php php php php/php/php Checkphp thephp passwordphp againstphp thephp allowedphp values
php php php php php php php php php$statusphp php=php php@pregphp_matchphp(php'php/php^php(php?php:php'php php.php php$thisphp-php>php_regexphp[php'escapedphp'php]php php.php php'php|php[php'php php.
php php php php php php php php php php php php selfphp:php:CHARphp_ALNUMphp php.php selfphp:php:CHARphp_MARKphp php.php php'php;php:php&php=php+php$php,php'php php.php php'php]php)php+php$php/php'php,php php$passwordphp)php;

php php php php php php php php ifphp php(php$statusphp php=php=php=php falsephp)php php{
php php php php php php php php php php php php requirephp_oncephp php'Zendphp/Uriphp/Exceptionphp.phpphp'php;
php php php php php php php php php php php php throwphp newphp Zendphp_Uriphp_Exceptionphp(php'Internalphp errorphp:php passwordphp validationphp failedphp.php'php)php;
php php php php php php php php php}

php php php php php php php php returnphp php$statusphp php=php=php php1php;
php php php php php}

php php php php php/php*php*
php php php php php php*php Setsphp thephp passwordphp forphp thephp currentphp URIphp,php andphp returnsphp thephp oldphp password
php php php php php php*
php php php php php php*php php@paramphp php stringphp php$passwordphp Thephp HTTPphp password
php php php php php php*php php@throwsphp Zendphp_Uriphp_Exceptionphp Whenphp php$passwordphp isphp notphp aphp validphp HTTPphp password
php php php php php php*php php@returnphp string
php php php php php php*php/
php php php php publicphp functionphp setPasswordphp(php$passwordphp)
php php php php php{
php php php php php php php php ifphp php(php$thisphp-php>validatePasswordphp(php$passwordphp)php php=php=php=php falsephp)php php{
php php php php php php php php php php php php requirephp_oncephp php'Zendphp/Uriphp/Exceptionphp.phpphp'php;
php php php php php php php php php php php php throwphp newphp Zendphp_Uriphp_Exceptionphp(php"Passwordphp php\php"php$passwordphp\php"php isphp notphp aphp validphp HTTPphp passwordphp.php"php)php;
php php php php php php php php php}

php php php php php php php php php$oldPasswordphp php php php php php=php php$thisphp-php>php_passwordphp;
php php php php php php php php php$thisphp-php>php_passwordphp php=php php$passwordphp;

php php php php php php php php returnphp php$oldPasswordphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Returnsphp thephp domainphp orphp hostphp IPphp portionphp ofphp thephp URLphp,php orphp FALSEphp ifphp nonephp.
php php php php php php*
php php php php php php*php php@returnphp string
php php php php php php*php/
php php php php publicphp functionphp getHostphp(php)
php php php php php{
php php php php php php php php returnphp strlenphp(php$thisphp-php>php_hostphp)php php>php php0php php?php php$thisphp-php>php_hostphp php:php falsephp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Returnsphp truephp ifphp andphp onlyphp ifphp thephp hostphp stringphp passesphp validationphp.php Ifphp nophp hostphp isphp passedphp,
php php php php php php*php thenphp thephp hostphp containedphp inphp thephp instancephp variablephp isphp usedphp.
php php php php php php*
php php php php php php*php php@paramphp php stringphp php$hostphp Thephp HTTPphp host
php php php php php php*php php@returnphp boolean
php php php php php php*php php@usesphp php php Zendphp_Filter
php php php php php php*php/
php php php php publicphp functionphp validateHostphp(php$hostphp php=php nullphp)
php php php php php{
php php php php php php php php ifphp php(php$hostphp php=php=php=php nullphp)php php{
php php php php php php php php php php php php php$hostphp php=php php$thisphp-php>php_hostphp;
php php php php php php php php php}

php php php php php php php php php/php/php Ifphp thephp hostphp isphp emptyphp,php thenphp itphp isphp consideredphp invalid
php php php php php php php php ifphp php(strlenphp(php$hostphp)php php=php=php=php php0php)php php{
php php php php php php php php php php php php returnphp falsephp;
php php php php php php php php php}

php php php php php php php php php/php/php Checkphp thephp hostphp againstphp thephp allowedphp valuesphp;php delegatedphp tophp Zendphp_Filterphp.
php php php php php php php php php$validatephp php=php newphp Zendphp_Validatephp_Hostnamephp(Zendphp_Validatephp_Hostnamephp:php:ALLOWphp_ALLphp)php;

php php php php php php php php returnphp php$validatephp-php>isValidphp(php$hostphp)php;
php php php php php}

php php php php php/php*php*
php php php php php php*php Setsphp thephp hostphp forphp thephp currentphp URIphp,php andphp returnsphp thephp oldphp host
php php php php php php*
php php php php php php*php php@paramphp php stringphp php$hostphp Thephp HTTPphp host
php php php php php php*php php@throwsphp Zendphp_Uriphp_Exceptionphp Whenphp php$hostphp isphp notaphp validphp HTTPphp host
php php php php php php*php php@returnphp string
php php php php php php*php/
php php php php publicphp functionphp setHostphp(php$hostphp)
php php php php php{
php php php php php php php php ifphp php(php$thisphp-php>validateHostphp(php$hostphp)php php=php=php=php falsephp)php php{
php php php php php php php php php php php php requirephp_oncephp php'Zendphp/Uriphp/Exceptionphp.phpphp'php;
php php php php php php php php php php php php throwphp newphp Zendphp_Uriphp_Exceptionphp(php"Hostphp php\php"php$hostphp\php"php isphp notphp aphp validphp HTTPphp hostphp"php)php;
php php php php php php php php php}

php php php php php php php php php$oldHostphp php php php php php=php php$thisphp-php>php_hostphp;
php php php php php php php php php$thisphp-php>php_hostphp php=php php$hostphp;

php php php php php php php php returnphp php$oldHostphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Returnsphp thephp TCPphp portphp,php orphp FALSEphp ifphp nonephp.
php php php php php php*
php php php php php php*php php@returnphp string
php php php php php php*php/
php php php php publicphp functionphp getPortphp(php)
php php php php php{
php php php php php php php php returnphp strlenphp(php$thisphp-php>php_portphp)php php>php php0php php?php php$thisphp-php>php_portphp php:php falsephp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Returnsphp truephp ifphp andphp onlyphp ifphp thephp TCPphp portphp stringphp passesphp validationphp.php Ifphp nophp portphp isphp passedphp,
php php php php php php*php thenphp thephp portphp containedphp inphp thephp instancephp variablephp isphp usedphp.
php php php php php php*
php php php php php php*php php@paramphp php stringphp php$portphp Thephp HTTPphp port
php php php php php php*php php@returnphp boolean
php php php php php php*php/
php php php php publicphp functionphp validatePortphp(php$portphp php=php nullphp)
php php php php php{
php php php php php php php php ifphp php(php$portphp php=php=php=php nullphp)php php{
php php php php php php php php php php php php php$portphp php=php php$thisphp-php>php_portphp;
php php php php php php php php php}

php php php php php php php php php/php/php Ifphp thephp portphp isphp emptyphp,php thenphp itphp isphp consideredphp valid
php php php php php php php php ifphp php(strlenphp(php$portphp)php php=php=php=php php0php)php php{
php php php php php php php php php php php php returnphp truephp;
php php php php php php php php php}

php php php php php php php php php/php/php Checkphp thephp portphp againstphp thephp allowedphp values
php php php php php php php php returnphp ctypephp_digitphp(php(stringphp)php php$portphp)php andphp php1php <php=php php$portphp andphp php$portphp <php=php php6php5php5php3php5php;
php php php php php}

php php php php php/php*php*
php php php php php php*php Setsphp thephp portphp forphp thephp currentphp URIphp,php andphp returnsphp thephp oldphp port
php php php php php php*
php php php php php php*php php@paramphp php stringphp php$portphp Thephp HTTPphp port
php php php php php php*php php@throwsphp Zendphp_Uriphp_Exceptionphp Whenphp php$portphp isphp notphp aphp validphp HTTPphp port
php php php php php php*php php@returnphp string
php php php php php php*php/
php php php php publicphp functionphp setPortphp(php$portphp)
php php php php php{
php php php php php php php php ifphp php(php$thisphp-php>validatePortphp(php$portphp)php php=php=php=php falsephp)php php{
php php php php php php php php php php php php requirephp_oncephp php'Zendphp/Uriphp/Exceptionphp.phpphp'php;
php php php php php php php php php php php php throwphp newphp Zendphp_Uriphp_Exceptionphp(php"Portphp php\php"php$portphp\php"php isphp notphp aphp validphp HTTPphp portphp.php"php)php;
php php php php php php php php php}

php php php php php php php php php$oldPortphp php php php php php=php php$thisphp-php>php_portphp;
php php php php php php php php php$thisphp-php>php_portphp php=php php$portphp;

php php php php php php php php returnphp php$oldPortphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Returnsphp thephp pathphp andphp filenamephp portionphp ofphp thephp URLphp.
php php php php php php*
php php php php php php*php php@returnphp string
php php php php php php*php/
php php php php publicphp functionphp getPathphp(php)
php php php php php{
php php php php php php php php returnphp strlenphp(php$thisphp-php>php_pathphp)php php>php php0php php?php php$thisphp-php>php_pathphp php:php php'php/php'php;
php php php php php}

php php php php php/php*php*
php php php php php php*php Returnsphp truephp ifphp andphp onlyphp ifphp thephp pathphp stringphp passesphp validationphp.php Ifphp nophp pathphp isphp passedphp,
php php php php php php*php thenphp thephp pathphp containedphp inphp thephp instancephp variablephp isphp usedphp.
php php php php php php*
php php php php php php*php php@paramphp php stringphp php$pathphp Thephp HTTPphp path
php php php php php php*php php@throwsphp Zendphp_Uriphp_Exceptionphp Whenphp pathphp validationphp fails
php php php php php php*php php@returnphp boolean
php php php php php php*php/
php php php php publicphp functionphp validatePathphp(php$pathphp php=php nullphp)
php php php php php{
php php php php php php php php ifphp php(php$pathphp php=php=php=php nullphp)php php{
php php php php php php php php php php php php php$pathphp php=php php$thisphp-php>php_pathphp;
php php php php php php php php php}

php php php php php php php php php/php/php Ifphp thephp pathphp isphp emptyphp,php thenphp itphp isphp consideredphp valid
php php php php php php php php ifphp php(strlenphp(php$pathphp)php php=php=php=php php0php)php php{
php php php php php php php php php php php php returnphp truephp;
php php php php php php php php php}

php php php php php php php php php/php/php Determinephp whetherphp thephp pathphp isphp wellphp-formed
php php php php php php php php php$patternphp php=php php'php/php^php'php php.php php$thisphp-php>php_regexphp[php'pathphp'php]php php.php php'php$php/php'php;
php php php php php php php php php$statusphp php php=php php@pregphp_matchphp(php$patternphp,php php$pathphp)php;
php php php php php php php php ifphp php(php$statusphp php=php=php=php falsephp)php php{
php php php php php php php php php php php php requirephp_oncephp php'Zendphp/Uriphp/Exceptionphp.phpphp'php;
php php php php php php php php php php php php throwphp newphp Zendphp_Uriphp_Exceptionphp(php'Internalphp errorphp:php pathphp validationphp failedphp'php)php;
php php php php php php php php php}

php php php php php php php php returnphp php(booleanphp)php php$statusphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Setsphp thephp pathphp forphp thephp currentphp URIphp,php andphp returnsphp thephp oldphp path
php php php php php php*
php php php php php php*php php@paramphp php stringphp php$pathphp Thephp HTTPphp path
php php php php php php*php php@throwsphp Zendphp_Uriphp_Exceptionphp Whenphp php$pathphp isphp notphp aphp validphp HTTPphp path
php php php php php php*php php@returnphp string
php php php php php php*php/
php php php php publicphp functionphp setPathphp(php$pathphp)
php php php php php{
php php php php php php php php ifphp php(php$thisphp-php>validatePathphp(php$pathphp)php php=php=php=php falsephp)php php{
php php php php php php php php php php php php requirephp_oncephp php'Zendphp/Uriphp/Exceptionphp.phpphp'php;
php php php php php php php php php php php php throwphp newphp Zendphp_Uriphp_Exceptionphp(php"Pathphp php\php"php$pathphp\php"php isphp notphp aphp validphp HTTPphp pathphp"php)php;
php php php php php php php php php}

php php php php php php php php php$oldPathphp php php php php php=php php$thisphp-php>php_pathphp;
php php php php php php php php php$thisphp-php>php_pathphp php=php php$pathphp;

php php php php php php php php returnphp php$oldPathphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Returnsphp thephp queryphp portionphp ofphp thephp URLphp php(afterphp php?php)php,php orphp FALSEphp ifphp nonephp.
php php php php php php*
php php php php php php*php php@returnphp string
php php php php php php*php/
php php php php publicphp functionphp getQueryphp(php)
php php php php php{
php php php php php php php php returnphp strlenphp(php$thisphp-php>php_queryphp)php php>php php0php php?php php$thisphp-php>php_queryphp php:php falsephp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Returnsphp thephp queryphp portionphp ofphp thephp URLphp php(afterphp php?php)php asphp a
php php php php php php*php keyphp-valuephp-arrayphp.php Ifphp thephp queryphp isphp emptyphp anphp emptyphp array
php php php php php php*php isphp returned
php php php php php php*
php php php php php php*php php@returnphp array
php php php php php php*php/
php php php php publicphp functionphp getQueryAsArrayphp(php)
php php php php php{
php php php php php php php php php$queryphp php=php php$thisphp-php>getQueryphp(php)php;
php php php php php php php php php$querryArrayphp php=php arrayphp(php)php;
php php php php php php php php ifphp php(php$queryphp php!php=php=php falsephp)php php{
php php php php php php php php php php php php parsephp_strphp(php$queryphp,php php$querryArrayphp)php;
php php php php php php php php php}
php php php php php php php php returnphp php$querryArrayphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Returnsphp truephp ifphp andphp onlyphp ifphp thephp queryphp stringphp passesphp validationphp.php Ifphp nophp queryphp isphp passedphp,
php php php php php php*php thenphp thephp queryphp stringphp containedphp inphp thephp instancephp variablephp isphp usedphp.
php php php php php php*
php php php php php php*php php@paramphp php stringphp php$queryphp Thephp queryphp tophp validate
php php php php php php*php php@throwsphp Zendphp_Uriphp_Exceptionphp Whenphp queryphp validationphp fails
php php php php php php*php php@returnphp boolean
php php php php php php*php php@linkphp php php httpphp:php/php/wwwphp.faqsphp.orgphp/rfcsphp/rfcphp2php3php9php6php.html
php php php php php php*php/
php php php php publicphp functionphp validateQueryphp(php$queryphp php=php nullphp)
php php php php php{
php php php php php php php php ifphp php(php$queryphp php=php=php=php nullphp)php php{
php php php php php php php php php php php php php$queryphp php=php php$thisphp-php>php_queryphp;
php php php php php php php php php}

php php php php php php php php php/php/php Ifphp queryphp isphp emptyphp,php itphp isphp consideredphp tophp bephp valid
php php php php php php php php ifphp php(strlenphp(php$queryphp)php php=php=php=php php0php)php php{
php php php php php php php php php php php php returnphp truephp;
php php php php php php php php php}

php php php php php php php php php/php/php Determinephp whetherphp thephp queryphp isphp wellphp-formed
php php php php php php php php php$patternphp php=php php'php/php^php'php php.php php$thisphp-php>php_regexphp[php'uricphp'php]php php.php php'php*php$php/php'php;
php php php php php php php php php$statusphp php php=php php@pregphp_matchphp(php$patternphp,php php$queryphp)php;
php php php php php php php php ifphp php(php$statusphp php=php=php=php falsephp)php php{
php php php php php php php php php php php php requirephp_oncephp php'Zendphp/Uriphp/Exceptionphp.phpphp'php;
php php php php php php php php php php php php throwphp newphp Zendphp_Uriphp_Exceptionphp(php'Internalphp errorphp:php queryphp validationphp failedphp'php)php;
php php php php php php php php php}

php php php php php php php php returnphp php$statusphp php=php=php php1php;
php php php php php}

php php php php php/php*php*
php php php php php php*php Addphp orphp replacephp paramsphp inphp thephp queryphp stringphp forphp thephp currentphp URIphp,php and
php php php php php php*php returnphp thephp oldphp queryphp.
php php php php php php*
php php php php php php*php php@paramphp php arrayphp php$queryParams
php php php php php php*php php@returnphp stringphp Oldphp queryphp string
php php php php php php*php/
php php php php publicphp functionphp addReplaceQueryParametersphp(arrayphp php$queryParamsphp)
php php php php php{
php php php php php php php php php$queryParamsphp php=php arrayphp_mergephp(php$thisphp-php>getQueryAsArrayphp(php)php,php php$queryParamsphp)php;
php php php php php php php php returnphp php$thisphp-php>setQueryphp(php$queryParamsphp)php;
php php php php php}

php php php php php/php*php*
php php php php php php*php Removephp paramsphp inphp thephp queryphp stringphp forphp thephp currentphp URIphp,php and
php php php php php php*php returnphp thephp oldphp queryphp.
php php php php php php*
php php php php php php*php php@paramphp php arrayphp php$queryParamKeys
php php php php php php*php php@returnphp stringphp Oldphp queryphp string
php php php php php php*php/
php php php php publicphp functionphp removeQueryParametersphp(arrayphp php$queryParamKeysphp)
php php php php php{
php php php php php php php php php$queryParamsphp php=php arrayphp_diffphp_keyphp(php$thisphp-php>getQueryAsArrayphp(php)php,php arrayphp_fillphp_keysphp(php$queryParamKeysphp,php php0php)php)php;
php php php php php php php php returnphp php$thisphp-php>setQueryphp(php$queryParamsphp)php;
php php php php php}

php php php php php/php*php*
php php php php php php*php Setphp thephp queryphp stringphp forphp thephp currentphp URIphp,php andphp returnphp thephp oldphp query
php php php php php php*php stringphp Thisphp methodphp acceptsphp bothphp stringsphp andphp arraysphp.
php php php php php php*
php php php php php php*php php@paramphp php stringphp|arrayphp php$queryphp Thephp queryphp stringphp orphp array
php php php php php php*php php@throwsphp Zendphp_Uriphp_Exceptionphp Whenphp php$queryphp isphp notphp aphp validphp queryphp string
php php php php php php*php php@returnphp stringphp php php php php php php php php php php php php php Oldphp queryphp string
php php php php php php*php/
php php php php publicphp functionphp setQueryphp(php$queryphp)
php php php php php{
php php php php php php php php php$oldQueryphp php=php php$thisphp-php>php_queryphp;

php php php php php php php php php/php/php Ifphp queryphp isphp emptyphp,php setphp anphp emptyphp string
php php php php php php php php ifphp php(emptyphp(php$queryphp)php php=php=php=php truephp)php php{
php php php php php php php php php php php php php$thisphp-php>php_queryphp php=php php'php'php;
php php php php php php php php php php php php returnphp php$oldQueryphp;
php php php php php php php php php}

php php php php php php php php php/php/php Ifphp queryphp isphp anphp arrayphp,php makephp aphp stringphp outphp ofphp it
php php php php php php php php ifphp php(isphp_arrayphp(php$queryphp)php php=php=php=php truephp)php php{
php php php php php php php php php php php php php$queryphp php=php httpphp_buildphp_queryphp(php$queryphp,php php'php'php,php php'php&php'php)php;
php php php php php php php php php}php elsephp php{
php php php php php php php php php php php php php/php/php Ifphp itphp isphp aphp stringphp,php makephp surephp itphp isphp validphp.php Ifphp notphp parsephp andphp encodephp it
php php php php php php php php php php php php php$queryphp php=php php(stringphp)php php$queryphp;
php php php php php php php php php php php php ifphp php(php$thisphp-php>validateQueryphp(php$queryphp)php php=php=php=php falsephp)php php{
php php php php php php php php php php php php php php php php parsephp_strphp(php$queryphp,php php$queryArrayphp)php;
php php php php php php php php php php php php php php php php php$queryphp php=php httpphp_buildphp_queryphp(php$queryArrayphp,php php'php'php,php php'php&php'php)php;
php php php php php php php php php php php php php}
php php php php php php php php php}

php php php php php php php php php/php/php Makephp surephp thephp queryphp isphp validphp,php andphp setphp it
php php php php php php php php ifphp php(php$thisphp-php>validateQueryphp(php$queryphp)php php=php=php=php falsephp)php php{
php php php php php php php php php php php php requirephp_oncephp php'Zendphp/Uriphp/Exceptionphp.phpphp'php;
php php php php php php php php php php php php throwphp newphp Zendphp_Uriphp_Exceptionphp(php"php'php$queryphp'php isphp notphp aphp validphp queryphp stringphp"php)php;
php php php php php php php php php}

php php php php php php php php php$thisphp-php>php_queryphp php=php php$queryphp;

php php php php php php php php returnphp php$oldQueryphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Returnsphp thephp fragmentphp portionphp ofphp thephp URLphp php(afterphp php#php)php,php orphp FALSEphp ifphp nonephp.
php php php php php php*
php php php php php php*php php@returnphp stringphp|false
php php php php php php*php/
php php php php publicphp functionphp getFragmentphp(php)
php php php php php{
php php php php php php php php returnphp strlenphp(php$thisphp-php>php_fragmentphp)php php>php php0php php?php php$thisphp-php>php_fragmentphp php:php falsephp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Returnsphp truephp ifphp andphp onlyphp ifphp thephp fragmentphp passesphp validationphp.php Ifphp nophp fragmentphp isphp passedphp,
php php php php php php*php thenphp thephp fragmentphp containedphp inphp thephp instancephp variablephp isphp usedphp.
php php php php php php*
php php php php php php*php php@paramphp php stringphp php$fragmentphp Fragmentphp ofphp anphp URI
php php php php php php*php php@throwsphp Zendphp_Uriphp_Exceptionphp Whenphp fragmentphp validationphp fails
php php php php php php*php php@returnphp boolean
php php php php php php*php php@linkphp php php httpphp:php/php/wwwphp.faqsphp.orgphp/rfcsphp/rfcphp2php3php9php6php.html
php php php php php php*php/
php php php php publicphp functionphp validateFragmentphp(php$fragmentphp php=php nullphp)
php php php php php{
php php php php php php php php ifphp php(php$fragmentphp php=php=php=php nullphp)php php{
php php php php php php php php php php php php php$fragmentphp php=php php$thisphp-php>php_fragmentphp;
php php php php php php php php php}

php php php php php php php php php/php/php Ifphp fragmentphp isphp emptyphp,php itphp isphp consideredphp tophp bephp valid
php php php php php php php php ifphp php(strlenphp(php$fragmentphp)php php=php=php=php php0php)php php{
php php php php php php php php php php php php returnphp truephp;
php php php php php php php php php}

php php php php php php php php php/php/php Determinephp whetherphp thephp fragmentphp isphp wellphp-formed
php php php php php php php php php$patternphp php=php php'php/php^php'php php.php php$thisphp-php>php_regexphp[php'uricphp'php]php php.php php'php*php$php/php'php;
php php php php php php php php php$statusphp php php=php php@pregphp_matchphp(php$patternphp,php php$fragmentphp)php;
php php php php php php php php ifphp php(php$statusphp php=php=php=php falsephp)php php{
php php php php php php php php php php php php requirephp_oncephp php'Zendphp/Uriphp/Exceptionphp.phpphp'php;
php php php php php php php php php php php php throwphp newphp Zendphp_Uriphp_Exceptionphp(php'Internalphp errorphp:php fragmentphp validationphp failedphp'php)php;
php php php php php php php php php}

php php php php php php php php returnphp php(booleanphp)php php$statusphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Setsphp thephp fragmentphp forphp thephp currentphp URIphp,php andphp returnsphp thephp oldphp fragment
php php php php php php*
php php php php php php*php php@paramphp php stringphp php$fragmentphp Fragmentphp ofphp thephp currentphp URI
php php php php php php*php php@throwsphp Zendphp_Uriphp_Exceptionphp Whenphp php$fragmentphp isphp notphp aphp validphp HTTPphp fragment
php php php php php php*php php@returnphp string
php php php php php php*php/
php php php php publicphp functionphp setFragmentphp(php$fragmentphp)
php php php php php{
php php php php php php php php ifphp php(php$thisphp-php>validateFragmentphp(php$fragmentphp)php php=php=php=php falsephp)php php{
php php php php php php php php php php php php requirephp_oncephp php'Zendphp/Uriphp/Exceptionphp.phpphp'php;
php php php php php php php php php php php php throwphp newphp Zendphp_Uriphp_Exceptionphp(php"Fragmentphp php\php"php$fragmentphp\php"php isphp notphp aphp validphp HTTPphp fragmentphp"php)php;
php php php php php php php php php}

php php php php php php php php php$oldFragmentphp php php php php php=php php$thisphp-php>php_fragmentphp;
php php php php php php php php php$thisphp-php>php_fragmentphp php=php php$fragmentphp;

php php php php php php php php returnphp php$oldFragmentphp;
php php php php php}
php}
