<php?php
php/php*php*
php php*php Zendphp Framework
php php*
php php*php LICENSE
php php*
php php*php Thisphp sourcephp filephp isphp subjectphp tophp thephp newphp BSDphp licensephp thatphp isphp bundled
php php*php withphp thisphp packagephp inphp thephp filephp LICENSEphp.txtphp.
php php*php Itphp isphp alsophp availablephp throughphp thephp worldphp-widephp-webphp atphp thisphp URLphp:
php php*php httpphp:php/php/frameworkphp.zendphp.comphp/licensephp/newphp-bsd
php php*php Ifphp youphp didphp notphp receivephp aphp copyphp ofphp thephp licensephp andphp arephp unablephp to
php php*php obtainphp itphp throughphp thephp worldphp-widephp-webphp,php pleasephp sendphp anphp email
php php*php tophp licensephp@zendphp.comphp sophp wephp canphp sendphp youphp aphp copyphp immediatelyphp.
php php*
php php*php php@categoryphp php php Zend
php php*php php@packagephp php php php Zendphp_Form
php php*php php@copyrightphp php Copyrightphp php(cphp)php php2php0php0php5php-php2php0php1php0php Zendphp Technologiesphp USAphp Incphp.php php(httpphp:php/php/wwwphp.zendphp.comphp)
php php*php php@licensephp php php php httpphp:php/php/frameworkphp.zendphp.comphp/licensephp/newphp-bsdphp php php php php Newphp BSDphp License
php php*php/

php/php*php*php php@seephp Zendphp_Validatephp_Interfacephp php*php/
requirephp_oncephp php'Zendphp/Validatephp/Interfacephp.phpphp'php;

php/php*php*
php php*php Zendphp_Form
php php*
php php*php php@categoryphp php php Zend
php php*php php@packagephp php php php Zendphp_Form
php php*php php@copyrightphp php Copyrightphp php(cphp)php php2php0php0php5php-php2php0php1php0php Zendphp Technologiesphp USAphp Incphp.php php(httpphp:php/php/wwwphp.zendphp.comphp)
php php*php php@licensephp php php php httpphp:php/php/frameworkphp.zendphp.comphp/licensephp/newphp-bsdphp php php php php Newphp BSDphp License
php php*php php@versionphp php php php php$Idphp:php Formphp.phpphp php2php3php4php8php4php php2php0php1php0php-php1php2php-php1php0php php0php3php:php5php7php:php5php9Zphp mjhphp_caphp php$
php php*php/
classphp Zendphp_Formphp implementsphp Iteratorphp,php Countablephp,php Zendphp_Validatephp_Interface
php{
php php php php php/php*php*php#php@php+
php php php php php php*php Pluginphp loaderphp typephp constants
php php php php php php*php/
php php php php constphp DECORATORphp php=php php'DECORATORphp'php;
php php php php constphp ELEMENTphp php=php php'ELEMENTphp'php;
php php php php php/php*php*php#php@php-php*php/

php php php php php/php*php*php#php@php+
php php php php php php*php Methodphp typephp constants
php php php php php php*php/
php php php php constphp METHODphp_DELETEphp php=php php'deletephp'php;
php php php php constphp METHODphp_GETphp php php php php=php php'getphp'php;
php php php php constphp METHODphp_POSTphp php php php=php php'postphp'php;
php php php php constphp METHODphp_PUTphp php php php php=php php'putphp'php;
php php php php php/php*php*php#php@php-php*php/

php php php php php/php*php*php#php@php+
php php php php php php*php Encodingphp typephp constants
php php php php php php*php/
php php php php constphp ENCTYPEphp_URLENCODEDphp php=php php'applicationphp/xphp-wwwphp-formphp-urlencodedphp'php;
php php php php constphp ENCTYPEphp_MULTIPARTphp php php=php php'multipartphp/formphp-dataphp'php;
php php php php php/php*php*php#php@php-php*php/

php php php php php/php*php*
php php php php php php*php Formphp metadataphp andphp attributes
php php php php php php*php php@varphp array
php php php php php php*php/
php php php php protectedphp php$php_attribsphp php=php arrayphp(php)php;

php php php php php/php*php*
php php php php php php*php Decoratorsphp forphp rendering
php php php php php php*php php@varphp array
php php php php php php*php/
php php php php protectedphp php$php_decoratorsphp php=php arrayphp(php)php;

php php php php php/php*php*
php php php php php php*php Defaultphp displayphp groupphp class
php php php php php php*php php@varphp string
php php php php php php*php/
php php php php protectedphp php$php_defaultDisplayGroupClassphp php=php php'Zendphp_Formphp_DisplayGroupphp'php;

php php php php php/php*php*
php php php php php php*php Formphp description
php php php php php php*php php@varphp string
php php php php php php*php/
php php php php protectedphp php$php_descriptionphp;

php php php php php/php*php*
php php php php php php*php Shouldphp wephp disablephp loadingphp thephp defaultphp decoratorsphp?
php php php php php php*php php@varphp bool
php php php php php php*php/
php php php php protectedphp php$php_disableLoadDefaultDecoratorsphp php=php falsephp;

php php php php php/php*php*
php php php php php php*php Displayphp groupphp prefixphp paths
php php php php php php*php php@varphp array
php php php php php php*php/
php php php php protectedphp php$php_displayGroupPrefixPathsphp php=php arrayphp(php)php;

php php php php php/php*php*
php php php php php php*php Groupsphp ofphp elementsphp groupedphp forphp displayphp purposes
php php php php php php*php php@varphp array
php php php php php php*php/
php php php php protectedphp php$php_displayGroupsphp php=php arrayphp(php)php;

php php php php php/php*php*
php php php php php php*php Globalphp decoratorsphp tophp applyphp tophp allphp elements
php php php php php php*php php@varphp nullphp|array
php php php php php php*php/
php php php php protectedphp php$php_elementDecoratorsphp;

php php php php php/php*php*
php php php php php php*php Prefixphp pathsphp tophp usephp whenphp creatingphp elements
php php php php php php*php php@varphp array
php php php php php php*php/
php php php php protectedphp php$php_elementPrefixPathsphp php=php arrayphp(php)php;

php php php php php/php*php*
php php php php php php*php Formphp elements
php php php php php php*php php@varphp array
php php php php php php*php/
php php php php protectedphp php$php_elementsphp php=php arrayphp(php)php;

php php php php php/php*php*
php php php php php php*php Arrayphp tophp whichphp elementsphp belongphp php(ifphp anyphp)
php php php php php php*php php@varphp string
php php php php php php*php/
php php php php protectedphp php$php_elementsBelongTophp;

php php php php php/php*php*
php php php php php php*php Customphp formphp-levelphp errorphp messages
php php php php php php*php php@varphp array
php php php php php php*php/
php php php php protectedphp php$php_errorMessagesphp php=php arrayphp(php)php;

php php php php php/php*php*
php php php php php php*php Arephp therephp errorsphp inphp thephp formphp?
php php php php php php*php php@varphp bool
php php php php php php*php/
php php php php protectedphp php$php_errorsExistphp php=php falsephp;

php php php php php/php*php*
php php php php php php*php Hasphp thephp formphp beenphp manuallyphp flaggedphp asphp anphp errorphp?
php php php php php php*php php@varphp bool
php php php php php php*php/
php php php php protectedphp php$php_errorsForcedphp php=php falsephp;

php php php php php/php*php*
php php php php php php*php Formphp order
php php php php php php*php php@varphp intphp|null
php php php php php php*php/
php php php php protectedphp php$php_formOrderphp;

php php php php php/php*php*
php php php php php php*php Whetherphp orphp notphp formphp elementsphp arephp membersphp ofphp anphp array
php php php php php php*php php@varphp bool
php php php php php php*php/
php php php php protectedphp php$php_isArrayphp php=php falsephp;

php php php php php/php*php*
php php php php php php*php Formphp legend
php php php php php php*php php@varphp string
php php php php php php*php/
php php php php protectedphp php$php_legendphp;

php php php php php/php*php*
php php php php php php*php Pluginphp loaders
php php php php php php*php php@varphp array
php php php php php php*php/
php php php php protectedphp php$php_loadersphp php=php arrayphp(php)php;

php php php php php/php*php*
php php php php php php*php Allowedphp formphp methods
php php php php php php*php php@varphp array
php php php php php php*php/
php php php php protectedphp php$php_methodsphp php=php arrayphp(php'deletephp'php,php php'getphp'php,php php'postphp'php,php php'putphp'php)php;

php php php php php/php*php*
php php php php php php*php Orderphp inphp whichphp tophp displayphp andphp iteratephp elements
php php php php php php*php php@varphp array
php php php php php php*php/
php php php php protectedphp php$php_orderphp php=php arrayphp(php)php;

php php php php php/php*php*
php php php php php php*php Whetherphp internalphp orderphp hasphp beenphp updatedphp orphp not
php php php php php php*php php@varphp bool
php php php php php php*php/
php php php php protectedphp php$php_orderUpdatedphp php=php falsephp;

php php php php php/php*php*
php php php php php php*php Subphp formphp prefixphp paths
php php php php php php*php php@varphp array
php php php php php php*php/
php php php php protectedphp php$php_subFormPrefixPathsphp php=php arrayphp(php)php;

php php php php php/php*php*
php php php php php php*php Subphp forms
php php php php php php*php php@varphp array
php php php php php php*php/
php php php php protectedphp php$php_subFormsphp php=php arrayphp(php)php;

php php php php php/php*php*
php php php php php php*php php@varphp Zendphp_Translate
php php php php php php*php/
php php php php protectedphp php$php_translatorphp;

php php php php php/php*php*
php php php php php php*php Globalphp defaultphp translationphp adapter
php php php php php php*php php@varphp Zendphp_Translate
php php php php php php*php/
php php php php protectedphp staticphp php$php_translatorDefaultphp;

php php php php php/php*php*
php php php php php php*php isphp thephp translatorphp disabledphp?
php php php php php php*php php@varphp bool
php php php php php php*php/
php php php php protectedphp php$php_translatorDisabledphp php=php falsephp;

php php php php php/php*php*
php php php php php php*php php@varphp Zendphp_Viewphp_Interface
php php php php php php*php/
php php php php protectedphp php$php_viewphp;

php php php php php/php*php*
php php php php php php*php php@varphp bool
php php php php php php*php/
php php php php protectedphp php$php_isRenderedphp php=php falsephp;

php php php php php/php*php*
php php php php php php*php Constructor
php php php php php php*
php php php php php php*php Registersphp formphp viewphp helperphp asphp decorator
php php php php php php*
php php php php php php*php php@paramphp mixedphp php$options
php php php php php php*php php@returnphp void
php php php php php php*php/
php php php php publicphp functionphp php_php_constructphp(php$optionsphp php=php nullphp)
php php php php php{
php php php php php php php php ifphp php(isphp_arrayphp(php$optionsphp)php)php php{
php php php php php php php php php php php php php$thisphp-php>setOptionsphp(php$optionsphp)php;
php php php php php php php php php}php elseifphp php(php$optionsphp instanceofphp Zendphp_Configphp)php php{
php php php php php php php php php php php php php$thisphp-php>setConfigphp(php$optionsphp)php;
php php php php php php php php php}

php php php php php php php php php/php/php Extensionsphp.php.php.
php php php php php php php php php$thisphp-php>initphp(php)php;

php php php php php php php php php$thisphp-php>loadDefaultDecoratorsphp(php)php;
php php php php php}

php php php php php/php*php*
php php php php php php*php Clonephp formphp objectphp andphp allphp children
php php php php php php*
php php php php php php*php php@returnphp void
php php php php php php*php/
php php php php publicphp functionphp php_php_clonephp(php)
php php php php php{
php php php php php php php php php$elementsphp php=php arrayphp(php)php;
php php php php php php php php foreachphp php(php$thisphp-php>getElementsphp(php)php asphp php$namephp php=php>php php$elementphp)php php{
php php php php php php php php php php php php php$elementsphp[php]php php=php clonephp php$elementphp;
php php php php php php php php php}
php php php php php php php php php$thisphp-php>setElementsphp(php$elementsphp)php;

php php php php php php php php php$subFormsphp php=php arrayphp(php)php;
php php php php php php php php foreachphp php(php$thisphp-php>getSubFormsphp(php)php asphp php$namephp php=php>php php$subFormphp)php php{
php php php php php php php php php php php php php$subFormsphp[php$namephp]php php=php clonephp php$subFormphp;
php php php php php php php php php}
php php php php php php php php php$thisphp-php>setSubFormsphp(php$subFormsphp)php;

php php php php php php php php php$displayGroupsphp php=php arrayphp(php)php;
php php php php php php php php foreachphp php(php$thisphp-php>php_displayGroupsphp asphp php$groupphp)php php php{
php php php php php php php php php php php php php$clonephp php php php php=php clonephp php$groupphp;
php php php php php php php php php php php php php$elementsphp php=php arrayphp(php)php;
php php php php php php php php php php php php foreachphp php(php$clonephp-php>getElementsphp(php)php asphp php$namephp php=php>php php$ephp)php php{
php php php php php php php php php php php php php php php php php$elementsphp[php]php php=php php$thisphp-php>getElementphp(php$namephp)php;
php php php php php php php php php php php php php}
php php php php php php php php php php php php php$clonephp-php>setElementsphp(php$elementsphp)php;
php php php php php php php php php php php php php$displayGroupsphp[php]php php=php php$clonephp;
php php php php php php php php php}
php php php php php php php php php$thisphp-php>setDisplayGroupsphp(php$displayGroupsphp)php;
php php php php php}

php php php php php/php*php*
php php php php php php*php Resetphp valuesphp ofphp form
php php php php php php*
php php php php php php*php php@returnphp Zendphp_Form
php php php php php php*php/
php php php php publicphp functionphp resetphp(php)
php php php php php{
php php php php php php php php foreachphp php(php$thisphp-php>getElementsphp(php)php asphp php$elementphp)php php{
php php php php php php php php php php php php php$elementphp-php>setValuephp(nullphp)php;
php php php php php php php php php}
php php php php php php php php foreachphp php(php$thisphp-php>getSubFormsphp(php)php asphp php$subFormphp)php php{
php php php php php php php php php php php php php$subFormphp-php>resetphp(php)php;
php php php php php php php php php}

php php php php php php php php returnphp php$thisphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Initializephp formphp php(usedphp byphp extendingphp classesphp)
php php php php php php*
php php php php php php*php php@returnphp void
php php php php php php*php/
php php php php publicphp functionphp initphp(php)
php php php php php{
php php php php php}

php php php php php/php*php*
php php php php php php*php Setphp formphp statephp fromphp optionsphp array
php php php php php php*
php php php php php php*php php@paramphp php arrayphp php$options
php php php php php php*php php@returnphp Zendphp_Form
php php php php php php*php/
php php php php publicphp functionphp setOptionsphp(arrayphp php$optionsphp)
php php php php php{
php php php php php php php php ifphp php(issetphp(php$optionsphp[php'prefixPathphp'php]php)php)php php{
php php php php php php php php php php php php php$thisphp-php>addPrefixPathsphp(php$optionsphp[php'prefixPathphp'php]php)php;
php php php php php php php php php php php php unsetphp(php$optionsphp[php'prefixPathphp'php]php)php;
php php php php php php php php php}

php php php php php php php php ifphp php(issetphp(php$optionsphp[php'elementPrefixPathphp'php]php)php)php php{
php php php php php php php php php php php php php$thisphp-php>addElementPrefixPathsphp(php$optionsphp[php'elementPrefixPathphp'php]php)php;
php php php php php php php php php php php php unsetphp(php$optionsphp[php'elementPrefixPathphp'php]php)php;
php php php php php php php php php}

php php php php php php php php ifphp php(issetphp(php$optionsphp[php'displayGroupPrefixPathphp'php]php)php)php php{
php php php php php php php php php php php php php$thisphp-php>addDisplayGroupPrefixPathsphp(php$optionsphp[php'displayGroupPrefixPathphp'php]php)php;
php php php php php php php php php php php php unsetphp(php$optionsphp[php'displayGroupPrefixPathphp'php]php)php;
php php php php php php php php php}

php php php php php php php php ifphp php(issetphp(php$optionsphp[php'elementDecoratorsphp'php]php)php)php php{
php php php php php php php php php php php php php$thisphp-php>php_elementDecoratorsphp php=php php$optionsphp[php'elementDecoratorsphp'php]php;
php php php php php php php php php php php php unsetphp(php$optionsphp[php'elementDecoratorsphp'php]php)php;
php php php php php php php php php}

php php php php php php php php ifphp php(issetphp(php$optionsphp[php'elementsphp'php]php)php)php php{
php php php php php php php php php php php php php$thisphp-php>setElementsphp(php$optionsphp[php'elementsphp'php]php)php;
php php php php php php php php php php php php unsetphp(php$optionsphp[php'elementsphp'php]php)php;
php php php php php php php php php}

php php php php php php php php ifphp php(issetphp(php$optionsphp[php'defaultDisplayGroupClassphp'php]php)php)php php{
php php php php php php php php php php php php php$thisphp-php>setDefaultDisplayGroupClassphp(php$optionsphp[php'defaultDisplayGroupClassphp'php]php)php;
php php php php php php php php php php php php unsetphp(php$optionsphp[php'defaultDisplayGroupClassphp'php]php)php;
php php php php php php php php php}

php php php php php php php php ifphp php(issetphp(php$optionsphp[php'displayGroupDecoratorsphp'php]php)php)php php{
php php php php php php php php php php php php php$displayGroupDecoratorsphp php=php php$optionsphp[php'displayGroupDecoratorsphp'php]php;
php php php php php php php php php php php php unsetphp(php$optionsphp[php'displayGroupDecoratorsphp'php]php)php;
php php php php php php php php php}

php php php php php php php php ifphp php(issetphp(php$optionsphp[php'elementsBelongTophp'php]php)php)php php{
php php php php php php php php php php php php php$elementsBelongTophp php=php php$optionsphp[php'elementsBelongTophp'php]php;
php php php php php php php php php php php php unsetphp(php$optionsphp[php'elementsBelongTophp'php]php)php;
php php php php php php php php php}

php php php php php php php php ifphp php(issetphp(php$optionsphp[php'attribsphp'php]php)php)php php{
php php php php php php php php php php php php php$thisphp-php>addAttribsphp(php$optionsphp[php'attribsphp'php]php)php;
php php php php php php php php php php php php unsetphp(php$optionsphp[php'attribsphp'php]php)php;
php php php php php php php php php}

php php php php php php php php php$forbiddenphp php=php arrayphp(
php php php php php php php php php php php php php'Optionsphp'php,php php'Configphp'php,php php'PluginLoaderphp'php,php php'SubFormsphp'php,php php'Translatorphp'php,
php php php php php php php php php php php php php'Attribphp'php,php php'Defaultphp'php,
php php php php php php php php php)php;

php php php php php php php php foreachphp php(php$optionsphp asphp php$keyphp php=php>php php$valuephp)php php{
php php php php php php php php php php php php php$normalizedphp php=php ucfirstphp(php$keyphp)php;
php php php php php php php php php php php php ifphp php(inphp_arrayphp(php$normalizedphp,php php$forbiddenphp)php)php php{
php php php php php php php php php php php php php php php php continuephp;
php php php php php php php php php php php php php}

php php php php php php php php php php php php php$methodphp php=php php'setphp'php php.php php$normalizedphp;
php php php php php php php php php php php php ifphp php(methodphp_existsphp(php$thisphp,php php$methodphp)php)php php{
php php php php php php php php php php php php php php php php ifphp(php$normalizedphp php=php=php php'Viewphp'php php&php&php php!php(php$valuephp instanceofphp Zendphp_Viewphp_Interfacephp)php)php php{
php php php php php php php php php php php php php php php php php php php php continuephp;
php php php php php php php php php php php php php php php php php}
php php php php php php php php php php php php php php php php php$thisphp-php>php$methodphp(php$valuephp)php;
php php php php php php php php php php php php php}php elsephp php{
php php php php php php php php php php php php php php php php php$thisphp-php>setAttribphp(php$keyphp,php php$valuephp)php;
php php php php php php php php php php php php php}
php php php php php php php php php}

php php php php php php php php ifphp php(issetphp(php$displayGroupDecoratorsphp)php)php php{
php php php php php php php php php php php php php$thisphp-php>setDisplayGroupDecoratorsphp(php$displayGroupDecoratorsphp)php;
php php php php php php php php php}

php php php php php php php php ifphp php(issetphp(php$elementsBelongTophp)php)php php{
php php php php php php php php php php php php php$thisphp-php>setElementsBelongTophp(php$elementsBelongTophp)php;
php php php php php php php php php}

php php php php php php php php returnphp php$thisphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Setphp formphp statephp fromphp configphp object
php php php php php php*
php php php php php php*php php@paramphp php Zendphp_Configphp php$config
php php php php php php*php php@returnphp Zendphp_Form
php php php php php php*php/
php php php php publicphp functionphp setConfigphp(Zendphp_Configphp php$configphp)
php php php php php{
php php php php php php php php returnphp php$thisphp-php>setOptionsphp(php$configphp-php>toArrayphp(php)php)php;
php php php php php}


php php php php php/php/php Loaders

php php php php php/php*php*
php php php php php php*php Setphp pluginphp loadersphp forphp usephp withphp decoratorsphp andphp elements
php php php php php php*
php php php php php php*php php@paramphp php Zendphp_Loaderphp_PluginLoaderphp_Interfacephp php$loader
php php php php php php*php php@paramphp php stringphp php$typephp php'decoratorphp'php orphp php'elementphp'
php php php php php php*php php@returnphp Zendphp_Form
php php php php php php*php php@throwsphp Zendphp_Formphp_Exceptionphp onphp invalidphp type
php php php php php php*php/
php php php php publicphp functionphp setPluginLoaderphp(Zendphp_Loaderphp_PluginLoaderphp_Interfacephp php$loaderphp,php php$typephp php=php nullphp)
php php php php php{
php php php php php php php php php$typephp php=php strtoupperphp(php$typephp)php;
php php php php php php php php switchphp php(php$typephp)php php{
php php php php php php php php php php php php casephp selfphp:php:DECORATORphp:
php php php php php php php php php php php php casephp selfphp:php:ELEMENTphp:
php php php php php php php php php php php php php php php php php$thisphp-php>php_loadersphp[php$typephp]php php=php php$loaderphp;
php php php php php php php php php php php php php php php php returnphp php$thisphp;
php php php php php php php php php php php php defaultphp:
php php php php php php php php php php php php php php php php requirephp_oncephp php'Zendphp/Formphp/Exceptionphp.phpphp'php;
php php php php php php php php php php php php php php php php throwphp newphp Zendphp_Formphp_Exceptionphp(sprintfphp(php'Invalidphp typephp php"php%sphp"php providedphp tophp setPluginLoaderphp(php)php'php,php php$typephp)php)php;
php php php php php php php php php}
php php php php php}

php php php php php/php*php*
php php php php php php*php Retrievephp pluginphp loaderphp forphp givenphp type
php php php php php php*
php php php php php php*php php$typephp mayphp bephp onephp ofphp:
php php php php php php*php php-php decorator
php php php php php php*php php-php element
php php php php php php*
php php php php php php*php Ifphp aphp pluginphp loaderphp doesphp notphp existphp forphp thephp givenphp typephp,php defaultsphp are
php php php php php php*php createdphp.
php php php php php php*
php php php php php php*php php@paramphp php stringphp php$type
php php php php php php*php php@returnphp Zendphp_Loaderphp_PluginLoaderphp_Interface
php php php php php php*php/
php php php php publicphp functionphp getPluginLoaderphp(php$typephp php=php nullphp)
php php php php php{
php php php php php php php php php$typephp php=php strtoupperphp(php$typephp)php;
php php php php php php php php ifphp php(php!issetphp(php$thisphp-php>php_loadersphp[php$typephp]php)php)php php{
php php php php php php php php php php php php switchphp php(php$typephp)php php{
php php php php php php php php php php php php php php php php casephp selfphp:php:DECORATORphp:
php php php php php php php php php php php php php php php php php php php php php$prefixSegmentphp php=php php'Formphp_Decoratorphp'php;
php php php php php php php php php php php php php php php php php php php php php$pathSegmentphp php php php=php php'Formphp/Decoratorphp'php;
php php php php php php php php php php php php php php php php php php php php breakphp;
php php php php php php php php php php php php php php php php casephp selfphp:php:ELEMENTphp:
php php php php php php php php php php php php php php php php php php php php php$prefixSegmentphp php=php php'Formphp_Elementphp'php;
php php php php php php php php php php php php php php php php php php php php php$pathSegmentphp php php php=php php'Formphp/Elementphp'php;
php php php php php php php php php php php php php php php php php php php php breakphp;
php php php php php php php php php php php php php php php php defaultphp:
php php php php php php php php php php php php php php php php php php php php requirephp_oncephp php'Zendphp/Formphp/Exceptionphp.phpphp'php;
php php php php php php php php php php php php php php php php php php php php throwphp newphp Zendphp_Formphp_Exceptionphp(sprintfphp(php'Invalidphp typephp php"php%sphp"php providedphp tophp getPluginLoaderphp(php)php'php,php php$typephp)php)php;
php php php php php php php php php php php php php}

php php php php php php php php php php php php requirephp_oncephp php'Zendphp/Loaderphp/PluginLoaderphp.phpphp'php;
php php php php php php php php php php php php php$thisphp-php>php_loadersphp[php$typephp]php php=php newphp Zendphp_Loaderphp_PluginLoaderphp(
php php php php php php php php php php php php php php php php arrayphp(php'Zendphp_php'php php.php php$prefixSegmentphp php.php php'php_php'php php=php>php php'Zendphp/php'php php.php php$pathSegmentphp php.php php'php/php'php)
php php php php php php php php php php php php php)php;
php php php php php php php php php}

php php php php php php php php returnphp php$thisphp-php>php_loadersphp[php$typephp]php;
php php php php php}

php php php php php/php*php*
php php php php php php*php Addphp prefixphp pathphp forphp pluginphp loader
php php php php php php*
php php php php php php*php Ifphp nophp php$typephp specifiedphp,php assumesphp itphp isphp aphp basephp pathphp forphp bothphp filtersphp and
php php php php php php*php validatorsphp,php andphp setsphp eachphp accordingphp tophp thephp followingphp rulesphp:
php php php php php php*php php-php decoratorsphp:php php$prefixphp php=php php$prefixphp php.php php'php_Decoratorphp'
php php php php php php*php php-php elementsphp:php php$prefixphp php=php php$prefixphp php.php php'php_Elementphp'
php php php php php php*
php php php php php php*php Otherwisephp,php thephp pathphp prefixphp isphp setphp onphp thephp appropriatephp pluginphp loaderphp.
php php php php php php*
php php php php php php*php Ifphp php$typephp isphp php'decoratorphp'php,php setsphp thephp pathphp inphp thephp decoratorphp pluginphp loader
php php php php php php*php forphp allphp elementsphp.php Additionallyphp,php ifphp nophp php$typephp isphp providedphp,
php php php php php php*php thephp prefixphp andphp pathphp isphp addedphp tophp bothphp decoratorphp andphp element
php php php php php php*php pluginphp loaderphp withphp followingphp settingsphp:
php php php php php php*php php$prefixphp php.php php'php_Decoratorphp'php,php php$pathphp php.php php'php/Decoratorphp/php'
php php php php php php*php php$prefixphp php.php php'php_Elementphp'php,php php$pathphp php.php php'php/Elementphp/php'
php php php php php php*
php php php php php php*php php@paramphp php stringphp php$prefix
php php php php php php*php php@paramphp php stringphp php$path
php php php php php php*php php@paramphp php stringphp php$type
php php php php php php*php php@returnphp Zendphp_Form
php php php php php php*php php@throwsphp Zendphp_Formphp_Exceptionphp forphp invalidphp type
php php php php php php*php/
php php php php publicphp functionphp addPrefixPathphp(php$prefixphp,php php$pathphp,php php$typephp php=php nullphp)
php php php php php{
php php php php php php php php php$typephp php=php strtoupperphp(php$typephp)php;
php php php php php php php php switchphp php(php$typephp)php php{
php php php php php php php php php php php php casephp selfphp:php:DECORATORphp:
php php php php php php php php php php php php casephp selfphp:php:ELEMENTphp:
php php php php php php php php php php php php php php php php php$loaderphp php=php php$thisphp-php>getPluginLoaderphp(php$typephp)php;
php php php php php php php php php php php php php php php php php$loaderphp-php>addPrefixPathphp(php$prefixphp,php php$pathphp)php;
php php php php php php php php php php php php php php php php returnphp php$thisphp;
php php php php php php php php php php php php casephp nullphp:
php php php php php php php php php php php php php php php php php$prefixphp php=php rtrimphp(php$prefixphp,php php'php_php'php)php;
php php php php php php php php php php php php php php php php php$pathphp php php php=php rtrimphp(php$pathphp,php DIRECTORYphp_SEPARATORphp)php;
php php php php php php php php php php php php php php php php foreachphp php(arrayphp(selfphp:php:DECORATORphp,php selfphp:php:ELEMENTphp)php asphp php$typephp)php php{
php php php php php php php php php php php php php php php php php php php php php$cTypephp php php php php php php php php=php ucfirstphp(strtolowerphp(php$typephp)php)php;
php php php php php php php php php php php php php php php php php php php php php$pluginPathphp php php php=php php$pathphp php.php DIRECTORYphp_SEPARATORphp php.php php$cTypephp php.php DIRECTORYphp_SEPARATORphp;
php php php php php php php php php php php php php php php php php php php php php$pluginPrefixphp php=php php$prefixphp php.php php'php_php'php php.php php$cTypephp;
php php php php php php php php php php php php php php php php php php php php php$loaderphp php php php php php php php=php php$thisphp-php>getPluginLoaderphp(php$typephp)php;
php php php php php php php php php php php php php php php php php php php php php$loaderphp-php>addPrefixPathphp(php$pluginPrefixphp,php php$pluginPathphp)php;
php php php php php php php php php php php php php php php php php}
php php php php php php php php php php php php php php php php returnphp php$thisphp;
php php php php php php php php php php php php defaultphp:
php php php php php php php php php php php php php php php php requirephp_oncephp php'Zendphp/Formphp/Exceptionphp.phpphp'php;
php php php php php php php php php php php php php php php php throwphp newphp Zendphp_Formphp_Exceptionphp(sprintfphp(php'Invalidphp typephp php"php%sphp"php providedphp tophp getPluginLoaderphp(php)php'php,php php$typephp)php)php;
php php php php php php php php php}
php php php php php}

php php php php php/php*php*
php php php php php php*php Addphp manyphp prefixphp pathsphp atphp once
php php php php php php*
php php php php php php*php php@paramphp php arrayphp php$spec
php php php php php php*php php@returnphp Zendphp_Form
php php php php php php*php/
php php php php publicphp functionphp addPrefixPathsphp(arrayphp php$specphp)
php php php php php{
php php php php php php php php ifphp php(issetphp(php$specphp[php'prefixphp'php]php)php php&php&php issetphp(php$specphp[php'pathphp'php]php)php)php php{
php php php php php php php php php php php php returnphp php$thisphp-php>addPrefixPathphp(php$specphp[php'prefixphp'php]php,php php$specphp[php'pathphp'php]php)php;
php php php php php php php php php}
php php php php php php php php foreachphp php(php$specphp asphp php$typephp php=php>php php$pathsphp)php php{
php php php php php php php php php php php php ifphp php(isphp_numericphp(php$typephp)php php&php&php isphp_arrayphp(php$pathsphp)php)php php{
php php php php php php php php php php php php php php php php php$typephp php=php nullphp;
php php php php php php php php php php php php php php php php ifphp php(issetphp(php$pathsphp[php'prefixphp'php]php)php php&php&php issetphp(php$pathsphp[php'pathphp'php]php)php)php php{
php php php php php php php php php php php php php php php php php php php php ifphp php(issetphp(php$pathsphp[php'typephp'php]php)php)php php{
php php php php php php php php php php php php php php php php php php php php php php php php php$typephp php=php php$pathsphp[php'typephp'php]php;
php php php php php php php php php php php php php php php php php php php php php}
php php php php php php php php php php php php php php php php php php php php php$thisphp-php>addPrefixPathphp(php$pathsphp[php'prefixphp'php]php,php php$pathsphp[php'pathphp'php]php,php php$typephp)php;
php php php php php php php php php php php php php php php php php}
php php php php php php php php php php php php php}php elseifphp php(php!isphp_numericphp(php$typephp)php)php php{
php php php php php php php php php php php php php php php php ifphp php(php!issetphp(php$pathsphp[php'prefixphp'php]php)php php|php|php php!issetphp(php$pathsphp[php'pathphp'php]php)php)php php{
php php php php php php php php php php php php php php php php php php php php continuephp;
php php php php php php php php php php php php php php php php php}
php php php php php php php php php php php php php php php php php$thisphp-php>addPrefixPathphp(php$pathsphp[php'prefixphp'php]php,php php$pathsphp[php'pathphp'php]php,php php$typephp)php;
php php php php php php php php php php php php php}
php php php php php php php php php}
php php php php php php php php returnphp php$thisphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Addphp prefixphp pathphp forphp allphp elements
php php php php php php*
php php php php php php*php php@paramphp php stringphp php$prefix
php php php php php php*php php@paramphp php stringphp php$path
php php php php php php*php php@paramphp php stringphp php$type
php php php php php php*php php@returnphp Zendphp_Form
php php php php php php*php/
php php php php publicphp functionphp addElementPrefixPathphp(php$prefixphp,php php$pathphp,php php$typephp php=php nullphp)
php php php php php{
php php php php php php php php php$thisphp-php>php_elementPrefixPathsphp[php]php php=php arrayphp(
php php php php php php php php php php php php php'prefixphp'php php=php>php php$prefixphp,
php php php php php php php php php php php php php'pathphp'php php php php=php>php php$pathphp,
php php php php php php php php php php php php php'typephp'php php php php=php>php php$typephp,
php php php php php php php php php)php;

php php php php php php php php foreachphp php(php$thisphp-php>getElementsphp(php)php asphp php$elementphp)php php{
php php php php php php php php php php php php php$elementphp-php>addPrefixPathphp(php$prefixphp,php php$pathphp,php php$typephp)php;
php php php php php php php php php}

php php php php php php php php foreachphp php(php$thisphp-php>getSubFormsphp(php)php asphp php$subFormphp)php php{
php php php php php php php php php php php php php$subFormphp-php>addElementPrefixPathphp(php$prefixphp,php php$pathphp,php php$typephp)php;
php php php php php php php php php}

php php php php php php php php returnphp php$thisphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Addphp prefixphp pathsphp forphp allphp elements
php php php php php php*
php php php php php php*php php@paramphp php arrayphp php$spec
php php php php php php*php php@returnphp Zendphp_Form
php php php php php php*php/
php php php php publicphp functionphp addElementPrefixPathsphp(arrayphp php$specphp)
php php php php php{
php php php php php php php php php$thisphp-php>php_elementPrefixPathsphp php=php php$thisphp-php>php_elementPrefixPathsphp php+php php$specphp;

php php php php php php php php foreachphp php(php$thisphp-php>getElementsphp(php)php asphp php$elementphp)php php{
php php php php php php php php php php php php php$elementphp-php>addPrefixPathsphp(php$specphp)php;
php php php php php php php php php}

php php php php php php php php returnphp php$thisphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Addphp prefixphp pathphp forphp allphp displayphp groups
php php php php php php*
php php php php php php*php php@paramphp php stringphp php$prefix
php php php php php php*php php@paramphp php stringphp php$path
php php php php php php*php php@returnphp Zendphp_Form
php php php php php php*php/
php php php php publicphp functionphp addDisplayGroupPrefixPathphp(php$prefixphp,php php$pathphp)
php php php php php{
php php php php php php php php php$thisphp-php>php_displayGroupPrefixPathsphp[php]php php=php arrayphp(
php php php php php php php php php php php php php'prefixphp'php php=php>php php$prefixphp,
php php php php php php php php php php php php php'pathphp'php php php php=php>php php$pathphp,
php php php php php php php php php)php;

php php php php php php php php foreachphp php(php$thisphp-php>getDisplayGroupsphp(php)php asphp php$groupphp)php php{
php php php php php php php php php php php php php$groupphp-php>addPrefixPathphp(php$prefixphp,php php$pathphp)php;
php php php php php php php php php}

php php php php php php php php returnphp php$thisphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Addphp multiplephp displayphp groupphp prefixphp pathsphp atphp once
php php php php php php*
php php php php php php*php php@paramphp php arrayphp php$spec
php php php php php php*php php@returnphp Zendphp_Form
php php php php php php*php/
php php php php publicphp functionphp addDisplayGroupPrefixPathsphp(arrayphp php$specphp)
php php php php php{
php php php php php php php php foreachphp php(php$specphp asphp php$keyphp php=php>php php$valuephp)php php{
php php php php php php php php php php php php ifphp php(isphp_stringphp(php$valuephp)php php&php&php php!isphp_numericphp(php$keyphp)php)php php{
php php php php php php php php php php php php php php php php php$thisphp-php>addDisplayGroupPrefixPathphp(php$keyphp,php php$valuephp)php;
php php php php php php php php php php php php php php php php continuephp;
php php php php php php php php php php php php php}

php php php php php php php php php php php php ifphp php(isphp_stringphp(php$valuephp)php php&php&php isphp_numericphp(php$keyphp)php)php php{
php php php php php php php php php php php php php php php php continuephp;
php php php php php php php php php php php php php}

php php php php php php php php php php php php ifphp php(isphp_arrayphp(php$valuephp)php)php php{
php php php php php php php php php php php php php php php php php$countphp php=php countphp(php$valuephp)php;
php php php php php php php php php php php php php php php php ifphp php(arrayphp_keysphp(php$valuephp)php php=php=php=php rangephp(php0php,php php$countphp php-php php1php)php)php php{
php php php php php php php php php php php php php php php php php php php php ifphp php(php$countphp <php php2php)php php{
php php php php php php php php php php php php php php php php php php php php php php php php continuephp;
php php php php php php php php php php php php php php php php php php php php php}
php php php php php php php php php php php php php php php php php php php php php$prefixphp php=php arrayphp_shiftphp(php$valuephp)php;
php php php php php php php php php php php php php php php php php php php php php$pathphp php php php=php arrayphp_shiftphp(php$valuephp)php;
php php php php php php php php php php php php php php php php php php php php php$thisphp-php>addDisplayGroupPrefixPathphp(php$prefixphp,php php$pathphp)php;
php php php php php php php php php php php php php php php php php php php php continuephp;
php php php php php php php php php php php php php php php php php}
php php php php php php php php php php php php php php php php ifphp php(arrayphp_keyphp_existsphp(php'prefixphp'php,php php$valuephp)php php&php&php arrayphp_keyphp_existsphp(php'pathphp'php,php php$valuephp)php)php php{
php php php php php php php php php php php php php php php php php php php php php$thisphp-php>addDisplayGroupPrefixPathphp(php$valuephp[php'prefixphp'php]php,php php$valuephp[php'pathphp'php]php)php;
php php php php php php php php php php php php php php php php php}
php php php php php php php php php php php php php}
php php php php php php php php php}
php php php php php php php php returnphp php$thisphp;
php php php php php}

php php php php php/php/php Formphp metadataphp:

php php php php php/php*php*
php php php php php php*php Setphp formphp attribute
php php php php php php*
php php php php php php*php php@paramphp php stringphp php$key
php php php php php php*php php@paramphp php mixedphp php$value
php php php php php php*php php@returnphp Zendphp_Form
php php php php php php*php/
php php php php publicphp functionphp setAttribphp(php$keyphp,php php$valuephp)
php php php php php{
php php php php php php php php php$keyphp php=php php(stringphp)php php$keyphp;
php php php php php php php php php$thisphp-php>php_attribsphp[php$keyphp]php php=php php$valuephp;
php php php php php php php php returnphp php$thisphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Addphp multiplephp formphp attributesphp atphp once
php php php php php php*
php php php php php php*php php@paramphp php arrayphp php$attribs
php php php php php php*php php@returnphp Zendphp_Form
php php php php php php*php/
php php php php publicphp functionphp addAttribsphp(arrayphp php$attribsphp)
php php php php php{
php php php php php php php php foreachphp php(php$attribsphp asphp php$keyphp php=php>php php$valuephp)php php{
php php php php php php php php php php php php php$thisphp-php>setAttribphp(php$keyphp,php php$valuephp)php;
php php php php php php php php php}
php php php php php php php php returnphp php$thisphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Setphp multiplephp formphp attributesphp atphp once
php php php php php php*
php php php php php php*php Overwritesphp anyphp previouslyphp setphp attributesphp.
php php php php php php*
php php php php php php*php php@paramphp php arrayphp php$attribs
php php php php php php*php php@returnphp Zendphp_Form
php php php php php php*php/
php php php php publicphp functionphp setAttribsphp(arrayphp php$attribsphp)
php php php php php{
php php php php php php php php php$thisphp-php>clearAttribsphp(php)php;
php php php php php php php php returnphp php$thisphp-php>addAttribsphp(php$attribsphp)php;
php php php php php}

php php php php php/php*php*
php php php php php php*php Retrievephp aphp singlephp formphp attribute
php php php php php php*
php php php php php php*php php@paramphp php stringphp php$key
php php php php php php*php php@returnphp mixed
php php php php php php*php/
php php php php publicphp functionphp getAttribphp(php$keyphp)
php php php php php{
php php php php php php php php php$keyphp php=php php(stringphp)php php$keyphp;
php php php php php php php php ifphp php(php!issetphp(php$thisphp-php>php_attribsphp[php$keyphp]php)php)php php{
php php php php php php php php php php php php returnphp nullphp;
php php php php php php php php php}

php php php php php php php php returnphp php$thisphp-php>php_attribsphp[php$keyphp]php;
php php php php php}

php php php php php/php*php*
php php php php php php*php Retrievephp allphp formphp attributesphp/metadata
php php php php php php*
php php php php php php*php php@returnphp array
php php php php php php*php/
php php php php publicphp functionphp getAttribsphp(php)
php php php php php{
php php php php php php php php returnphp php$thisphp-php>php_attribsphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Removephp attribute
php php php php php php*
php php php php php php*php php@paramphp php stringphp php$key
php php php php php php*php php@returnphp bool
php php php php php php*php/
php php php php publicphp functionphp removeAttribphp(php$keyphp)
php php php php php{
php php php php php php php php ifphp php(issetphp(php$thisphp-php>php_attribsphp[php$keyphp]php)php)php php{
php php php php php php php php php php php php unsetphp(php$thisphp-php>php_attribsphp[php$keyphp]php)php;
php php php php php php php php php php php php returnphp truephp;
php php php php php php php php php}

php php php php php php php php returnphp falsephp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Clearphp allphp formphp attributes
php php php php php php*
php php php php php php*php php@returnphp Zendphp_Form
php php php php php php*php/
php php php php publicphp functionphp clearAttribsphp(php)
php php php php php{
php php php php php php php php php$thisphp-php>php_attribsphp php=php arrayphp(php)php;
php php php php php php php php returnphp php$thisphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Setphp formphp action
php php php php php php*
php php php php php php*php php@paramphp php stringphp php$action
php php php php php php*php php@returnphp Zendphp_Form
php php php php php php*php/
php php php php publicphp functionphp setActionphp(php$actionphp)
php php php php php{
php php php php php php php php returnphp php$thisphp-php>setAttribphp(php'actionphp'php,php php(stringphp)php php$actionphp)php;
php php php php php}

php php php php php/php*php*
php php php php php php*php Getphp formphp action
php php php php php php*
php php php php php php*php Setsphp defaultphp tophp php'php'php ifphp notphp setphp.
php php php php php php*
php php php php php php*php php@returnphp string
php php php php php php*php/
php php php php publicphp functionphp getActionphp(php)
php php php php php{
php php php php php php php php php$actionphp php=php php$thisphp-php>getAttribphp(php'actionphp'php)php;
php php php php php php php php ifphp php(nullphp php=php=php=php php$actionphp)php php{
php php php php php php php php php php php php php$actionphp php=php php'php'php;
php php php php php php php php php php php php php$thisphp-php>setActionphp(php$actionphp)php;
php php php php php php php php php}
php php php php php php php php returnphp php$actionphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Setphp formphp method
php php php php php php*
php php php php php php*php Onlyphp valuesphp inphp php{php@linkphp php$php_methodsphp(php)php}php allowed
php php php php php php*
php php php php php php*php php@paramphp php stringphp php$method
php php php php php php*php php@returnphp Zendphp_Form
php php php php php php*php php@throwsphp Zendphp_Formphp_Exception
php php php php php php*php/
php php php php publicphp functionphp setMethodphp(php$methodphp)
php php php php php{
php php php php php php php php php$methodphp php=php strtolowerphp(php$methodphp)php;
php php php php php php php php ifphp php(php!inphp_arrayphp(php$methodphp,php php$thisphp-php>php_methodsphp)php)php php{
php php php php php php php php php php php php requirephp_oncephp php'Zendphp/Formphp/Exceptionphp.phpphp'php;
php php php php php php php php php php php php throwphp newphp Zendphp_Formphp_Exceptionphp(sprintfphp(php'php"php%sphp"php isphp anphp invalidphp formphp methodphp'php,php php$methodphp)php)php;
php php php php php php php php php}
php php php php php php php php php$thisphp-php>setAttribphp(php'methodphp'php,php php$methodphp)php;
php php php php php php php php returnphp php$thisphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Retrievephp formphp method
php php php php php php*
php php php php php php*php php@returnphp string
php php php php php php*php/
php php php php publicphp functionphp getMethodphp(php)
php php php php php{
php php php php php php php php ifphp php(nullphp php=php=php=php php(php$methodphp php=php php$thisphp-php>getAttribphp(php'methodphp'php)php)php)php php{
php php php php php php php php php php php php php$methodphp php=php selfphp:php:METHODphp_POSTphp;
php php php php php php php php php php php php php$thisphp-php>setAttribphp(php'methodphp'php,php php$methodphp)php;
php php php php php php php php php}
php php php php php php php php returnphp strtolowerphp(php$methodphp)php;
php php php php php}

php php php php php/php*php*
php php php php php php*php Setphp encodingphp type
php php php php php php*
php php php php php php*php php@paramphp php stringphp php$value
php php php php php php*php php@returnphp Zendphp_Form
php php php php php php*php/
php php php php publicphp functionphp setEnctypephp(php$valuephp)
php php php php php{
php php php php php php php php php$thisphp-php>setAttribphp(php'enctypephp'php,php php$valuephp)php;
php php php php php php php php returnphp php$thisphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Getphp encodingphp type
php php php php php php*
php php php php php php*php php@returnphp string
php php php php php php*php/
php php php php publicphp functionphp getEnctypephp(php)
php php php php php{
php php php php php php php php ifphp php(nullphp php=php=php=php php(php$enctypephp php=php php$thisphp-php>getAttribphp(php'enctypephp'php)php)php)php php{
php php php php php php php php php php php php php$enctypephp php=php selfphp:php:ENCTYPEphp_URLENCODEDphp;
php php php php php php php php php php php php php$thisphp-php>setAttribphp(php'enctypephp'php,php php$enctypephp)php;
php php php php php php php php php}
php php php php php php php php returnphp php$thisphp-php>getAttribphp(php'enctypephp'php)php;
php php php php php}

php php php php php/php*php*
php php php php php php*php Filterphp aphp namephp tophp onlyphp allowphp validphp variablephp characters
php php php php php php*
php php php php php php*php php@paramphp php stringphp php$value
php php php php php php*php php@paramphp php boolphp php$allowBrackets
php php php php php php*php php@returnphp string
php php php php php php*php/
php php php php publicphp functionphp filterNamephp(php$valuephp,php php$allowBracketsphp php=php falsephp)
php php php php php{
php php php php php php php php php$charsetphp php=php php'php^aphp-zAphp-Zphp0php-php9php_php\xphp7fphp-php\xffphp'php;
php php php php php php php php ifphp php(php$allowBracketsphp)php php{
php php php php php php php php php php php php php$charsetphp php.php=php php'php\php[php\php]php'php;
php php php php php php php php php}
php php php php php php php php returnphp pregphp_replacephp(php'php/php[php'php php.php php$charsetphp php.php php'php]php/php'php,php php'php'php,php php(stringphp)php php$valuephp)php;
php php php php php}

php php php php php/php*php*
php php php php php php*php Setphp formphp name
php php php php php php*
php php php php php php*php php@paramphp php stringphp php$name
php php php php php php*php php@returnphp Zendphp_Form
php php php php php php*php/
php php php php publicphp functionphp setNamephp(php$namephp)
php php php php php{
php php php php php php php php php$namephp php=php php$thisphp-php>filterNamephp(php$namephp)php;
php php php php php php php php ifphp php(php'php'php php=php=php=php php(stringphp)php$namephp)php php{
php php php php php php php php php php php php requirephp_oncephp php'Zendphp/Formphp/Exceptionphp.phpphp'php;
php php php php php php php php php php php php throwphp newphp Zendphp_Formphp_Exceptionphp(php'Invalidphp namephp providedphp;php mustphp containphp onlyphp validphp variablephp charactersphp andphp bephp nonphp-emptyphp'php)php;
php php php php php php php php php}

php php php php php php php php returnphp php$thisphp-php>setAttribphp(php'namephp'php,php php$namephp)php;
php php php php php}

php php php php php/php*php*
php php php php php php*php Getphp namephp attribute
php php php php php php*
php php php php php php*php php@returnphp nullphp|string
php php php php php php*php/
php php php php publicphp functionphp getNamephp(php)
php php php php php{
php php php php php php php php returnphp php$thisphp-php>getAttribphp(php'namephp'php)php;
php php php php php}

php php php php php/php*php*
php php php php php php*php Getphp fullyphp qualifiedphp name
php php php php php php*
php php php php php php*php Placesphp namephp asphp subitemphp ofphp arrayphp andphp/orphp appendsphp bracketsphp.
php php php php php php*
php php php php php php*php php@returnphp string
php php php php php php*php/
php php php php publicphp functionphp getFullyQualifiedNamephp(php)
php php php php php{
php php php php php php php php returnphp php$thisphp-php>getNamephp(php)php;
php php php php php}

php php php php php/php*php*
php php php php php php*php Getphp elementphp id
php php php php php php*
php php php php php php*php php@returnphp string
php php php php php php*php/
php php php php publicphp functionphp getIdphp(php)
php php php php php{
php php php php php php php php ifphp php(nullphp php!php=php=php php(php$idphp php=php php$thisphp-php>getAttribphp(php'idphp'php)php)php)php php{
php php php php php php php php php php php php returnphp php$idphp;
php php php php php php php php php}

php php php php php php php php php$idphp php=php php$thisphp-php>getFullyQualifiedNamephp(php)php;

php php php php php php php php php/php/php Bailphp earlyphp ifphp nophp arrayphp notationphp detected
php php php php php php php php ifphp php(php!strstrphp(php$idphp,php php'php[php'php)php)php php{
php php php php php php php php php php php php returnphp php$idphp;
php php php php php php php php php}

php php php php php php php php php/php/php Stripphp arrayphp notation
php php php php php php php php ifphp php(php'php[php]php'php php=php=php substrphp(php$idphp,php php-php2php)php)php php{
php php php php php php php php php php php php php$idphp php=php substrphp(php$idphp,php php0php,php strlenphp(php$idphp)php php-php php2php)php;
php php php php php php php php php}
php php php php php php php php php$idphp php=php strphp_replacephp(php'php]php[php'php,php php'php-php'php,php php$idphp)php;
php php php php php php php php php$idphp php=php strphp_replacephp(arrayphp(php'php]php'php,php php'php[php'php)php,php php'php-php'php,php php$idphp)php;
php php php php php php php php php$idphp php=php trimphp(php$idphp,php php'php-php'php)php;

php php php php php php php php returnphp php$idphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Setphp formphp legend
php php php php php php*
php php php php php php*php php@paramphp php stringphp php$value
php php php php php php*php php@returnphp Zendphp_Form
php php php php php php*php/
php php php php publicphp functionphp setLegendphp(php$valuephp)
php php php php php{
php php php php php php php php php$thisphp-php>php_legendphp php=php php(stringphp)php php$valuephp;
php php php php php php php php returnphp php$thisphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Getphp formphp legend
php php php php php php*
php php php php php php*php php@returnphp string
php php php php php php*php/
php php php php publicphp functionphp getLegendphp(php)
php php php php php{
php php php php php php php php returnphp php$thisphp-php>php_legendphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Setphp formphp description
php php php php php php*
php php php php php php*php php@paramphp php stringphp php$value
php php php php php php*php php@returnphp Zendphp_Form
php php php php php php*php/
php php php php publicphp functionphp setDescriptionphp(php$valuephp)
php php php php php{
php php php php php php php php php$thisphp-php>php_descriptionphp php=php php(stringphp)php php$valuephp;
php php php php php php php php returnphp php$thisphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Retrievephp formphp description
php php php php php php*
php php php php php php*php php@returnphp string
php php php php php php*php/
php php php php publicphp functionphp getDescriptionphp(php)
php php php php php{
php php php php php php php php returnphp php$thisphp-php>php_descriptionphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Setphp formphp order
php php php php php php*
php php php php php php*php php@paramphp php intphp php$index
php php php php php php*php php@returnphp Zendphp_Form
php php php php php php*php/
php php php php publicphp functionphp setOrderphp(php$indexphp)
php php php php php{
php php php php php php php php php$thisphp-php>php_formOrderphp php=php php(intphp)php php$indexphp;
php php php php php php php php returnphp php$thisphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Getphp formphp order
php php php php php php*
php php php php php php*php php@returnphp intphp|null
php php php php php php*php/
php php php php publicphp functionphp getOrderphp(php)
php php php php php{
php php php php php php php php returnphp php$thisphp-php>php_formOrderphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Whenphp callingphp renderFormElementsphp orphp renderphp thisphp method
php php php php php php*php isphp usedphp tophp setphp php$php_isRenderedphp memberphp tophp preventphp repeatedly
php php php php php php*php mergingphp belongsTophp setting
php php php php php php*php/
php php php php protectedphp functionphp php_setIsRenderedphp(php)
php php php php php{
php php php php php php php php php$thisphp-php>php_isRenderedphp php=php truephp;
php php php php php php php php returnphp php$thisphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Getphp thephp valuephp ofphp php$php_isRenderedphp member
php php php php php php*php/
php php php php protectedphp functionphp php_getIsRenderedphp(php)
php php php php php{
php php php php php php php php returnphp php(boolphp)php$thisphp-php>php_isRenderedphp;
php php php php php}

php php php php php/php/php Elementphp interactionphp:

php php php php php/php*php*
php php php php php php*php Addphp aphp newphp element
php php php php php php*
php php php php php php*php php$elementphp mayphp bephp eitherphp aphp stringphp elementphp typephp,php orphp anphp objectphp ofphp type
php php php php php php*php Zendphp_Formphp_Elementphp.php Ifphp aphp stringphp elementphp typephp isphp providedphp,php php$namephp mustphp be
php php php php php php*php providedphp,php andphp php$optionsphp mayphp bephp optionallyphp providedphp forphp configuringphp the
php php php php php php*php elementphp.
php php php php php php*
php php php php php php*php Ifphp aphp Zendphp_Formphp_Elementphp isphp providedphp,php php$namephp mayphp bephp optionallyphp providedphp,
php php php php php php*php andphp anyphp providedphp php$optionsphp willphp bephp ignoredphp.
php php php php php php*
php php php php php php*php php@paramphp php stringphp|Zendphp_Formphp_Elementphp php$element
php php php php php php*php php@paramphp php stringphp php$name
php php php php php php*php php@paramphp php arrayphp|Zendphp_Configphp php$options
php php php php php php*php php@returnphp Zendphp_Form
php php php php php php*php/
php php php php publicphp functionphp addElementphp(php$elementphp,php php$namephp php=php nullphp,php php$optionsphp php=php nullphp)
php php php php php{
php php php php php php php php ifphp php(isphp_stringphp(php$elementphp)php)php php{
php php php php php php php php php php php php ifphp php(nullphp php=php=php=php php$namephp)php php{
php php php php php php php php php php php php php php php php requirephp_oncephp php'Zendphp/Formphp/Exceptionphp.phpphp'php;
php php php php php php php php php php php php php php php php throwphp newphp Zendphp_Formphp_Exceptionphp(php'Elementsphp specifiedphp byphp stringphp mustphp havephp anphp accompanyingphp namephp'php)php;
php php php php php php php php php php php php php}

php php php php php php php php php php php php ifphp php(isphp_arrayphp(php$thisphp-php>php_elementDecoratorsphp)php)php php{
php php php php php php php php php php php php php php php php ifphp php(nullphp php=php=php=php php$optionsphp)php php{
php php php php php php php php php php php php php php php php php php php php php$optionsphp php=php arrayphp(php'decoratorsphp'php php=php>php php$thisphp-php>php_elementDecoratorsphp)php;
php php php php php php php php php php php php php php php php php}php elseifphp php(php$optionsphp instanceofphp Zendphp_Configphp)php php{
php php php php php php php php php php php php php php php php php php php php php$optionsphp php=php php$optionsphp-php>toArrayphp(php)php;
php php php php php php php php php php php php php php php php php}
php php php php php php php php php php php php php php php php ifphp php(isphp_arrayphp(php$optionsphp)
php php php php php php php php php php php php php php php php php php php php php&php&php php!arrayphp_keyphp_existsphp(php'decoratorsphp'php,php php$optionsphp)
php php php php php php php php php php php php php php php php php)php php{
php php php php php php php php php php php php php php php php php php php php php$optionsphp[php'decoratorsphp'php]php php=php php$thisphp-php>php_elementDecoratorsphp;
php php php php php php php php php php php php php php php php php}
php php php php php php php php php php php php php}

php php php php php php php php php php php php php$thisphp-php>php_elementsphp[php$namephp]php php=php php$thisphp-php>createElementphp(php$elementphp,php php$namephp,php php$optionsphp)php;
php php php php php php php php php}php elseifphp php(php$elementphp instanceofphp Zendphp_Formphp_Elementphp)php php{
php php php php php php php php php php php php php$prefixPathsphp php php php php php php php php php php php php php php=php arrayphp(php)php;
php php php php php php php php php php php php php$prefixPathsphp[php'decoratorphp'php]php php=php php$thisphp-php>getPluginLoaderphp(php'decoratorphp'php)php-php>getPathsphp(php)php;
php php php php php php php php php php php php ifphp php(php!emptyphp(php$thisphp-php>php_elementPrefixPathsphp)php)php php{
php php php php php php php php php php php php php php php php php$prefixPathsphp php=php arrayphp_mergephp(php$prefixPathsphp,php php$thisphp-php>php_elementPrefixPathsphp)php;
php php php php php php php php php php php php php}

php php php php php php php php php php php php ifphp php(nullphp php=php=php=php php$namephp)php php{
php php php php php php php php php php php php php php php php php$namephp php=php php$elementphp-php>getNamephp(php)php;
php php php php php php php php php php php php php}

php php php php php php php php php php php php php$thisphp-php>php_elementsphp[php$namephp]php php=php php$elementphp;
php php php php php php php php php php php php php$thisphp-php>php_elementsphp[php$namephp]php-php>addPrefixPathsphp(php$prefixPathsphp)php;
php php php php php php php php php}

php php php php php php php php php$thisphp-php>php_orderphp[php$namephp]php php=php php$thisphp-php>php_elementsphp[php$namephp]php-php>getOrderphp(php)php;
php php php php php php php php php$thisphp-php>php_orderUpdatedphp php=php truephp;
php php php php php php php php php$thisphp-php>php_setElementsBelongTophp(php$namephp)php;

php php php php php php php php returnphp php$thisphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Createphp anphp element
php php php php php php*
php php php php php php*php Actsphp asphp aphp factoryphp forphp creatingphp elementsphp.php Elementsphp createdphp withphp this
php php php php php php*php methodphp willphp notphp bephp attachedphp tophp thephp formphp,php butphp willphp containphp element
php php php php php php*php settingsphp asphp specifiedphp inphp thephp formphp objectphp php(includingphp pluginphp loader
php php php php php php*php prefixphp pathsphp,php defaultphp decoratorsphp,php etcphp.php)php.
php php php php php php*
php php php php php php*php php@paramphp php stringphp php$type
php php php php php php*php php@paramphp php stringphp php$name
php php php php php php*php php@paramphp php arrayphp|Zendphp_Configphp php$options
php php php php php php*php php@returnphp Zendphp_Formphp_Element
php php php php php php*php/
php php php php publicphp functionphp createElementphp(php$typephp,php php$namephp,php php$optionsphp php=php nullphp)
php php php php php{
php php php php php php php php ifphp php(php!isphp_stringphp(php$typephp)php)php php{
php php php php php php php php php php php php requirephp_oncephp php'Zendphp/Formphp/Exceptionphp.phpphp'php;
php php php php php php php php php php php php throwphp newphp Zendphp_Formphp_Exceptionphp(php'Elementphp typephp mustphp bephp aphp stringphp indicatingphp typephp'php)php;
php php php php php php php php php}

php php php php php php php php ifphp php(php!isphp_stringphp(php$namephp)php)php php{
php php php php php php php php php php php php requirephp_oncephp php'Zendphp/Formphp/Exceptionphp.phpphp'php;
php php php php php php php php php php php php throwphp newphp Zendphp_Formphp_Exceptionphp(php'Elementphp namephp mustphp bephp aphp stringphp'php)php;
php php php php php php php php php}

php php php php php php php php php$prefixPathsphp php php php php php php php php php php php php php php=php arrayphp(php)php;
php php php php php php php php php$prefixPathsphp[php'decoratorphp'php]php php=php php$thisphp-php>getPluginLoaderphp(php'decoratorphp'php)php-php>getPathsphp(php)php;
php php php php php php php php ifphp php(php!emptyphp(php$thisphp-php>php_elementPrefixPathsphp)php)php php{
php php php php php php php php php php php php php$prefixPathsphp php=php arrayphp_mergephp(php$prefixPathsphp,php php$thisphp-php>php_elementPrefixPathsphp)php;
php php php php php php php php php}

php php php php php php php php ifphp php(php$optionsphp instanceofphp Zendphp_Configphp)php php{
php php php php php php php php php php php php php$optionsphp php=php php$optionsphp-php>toArrayphp(php)php;
php php php php php php php php php}

php php php php php php php php ifphp php(php(nullphp php=php=php=php php$optionsphp)php php|php|php php!isphp_arrayphp(php$optionsphp)php)php php{
php php php php php php php php php php php php php$optionsphp php=php arrayphp(php'prefixPathphp'php php=php>php php$prefixPathsphp)php;
php php php php php php php php php}php elseifphp php(isphp_arrayphp(php$optionsphp)php)php php{
php php php php php php php php php php php php ifphp php(arrayphp_keyphp_existsphp(php'prefixPathphp'php,php php$optionsphp)php)php php{
php php php php php php php php php php php php php php php php php$optionsphp[php'prefixPathphp'php]php php=php arrayphp_mergephp(php$prefixPathsphp,php php$optionsphp[php'prefixPathphp'php]php)php;
php php php php php php php php php php php php php}php elsephp php{
php php php php php php php php php php php php php php php php php$optionsphp[php'prefixPathphp'php]php php=php php$prefixPathsphp;
php php php php php php php php php php php php php}
php php php php php php php php php}

php php php php php php php php php$classphp php=php php$thisphp-php>getPluginLoaderphp(selfphp:php:ELEMENTphp)php-php>loadphp(php$typephp)php;
php php php php php php php php php$elementphp php=php newphp php$classphp(php$namephp,php php$optionsphp)php;

php php php php php php php php returnphp php$elementphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Addphp multiplephp elementsphp atphp once
php php php php php php*
php php php php php php*php php@paramphp php arrayphp php$elements
php php php php php php*php php@returnphp Zendphp_Form
php php php php php php*php/
php php php php publicphp functionphp addElementsphp(arrayphp php$elementsphp)
php php php php php{
php php php php php php php php foreachphp php(php$elementsphp asphp php$keyphp php=php>php php$specphp)php php{
php php php php php php php php php php php php php$namephp php=php nullphp;
php php php php php php php php php php php php ifphp php(php!isphp_numericphp(php$keyphp)php)php php{
php php php php php php php php php php php php php php php php php$namephp php=php php$keyphp;
php php php php php php php php php php php php php}

php php php php php php php php php php php php ifphp php(isphp_stringphp(php$specphp)php php|php|php php(php$specphp instanceofphp Zendphp_Formphp_Elementphp)php)php php{
php php php php php php php php php php php php php php php php php$thisphp-php>addElementphp(php$specphp,php php$namephp)php;
php php php php php php php php php php php php php php php php continuephp;
php php php php php php php php php php php php php}

php php php php php php php php php php php php ifphp php(isphp_arrayphp(php$specphp)php)php php{
php php php php php php php php php php php php php php php php php$argcphp php=php countphp(php$specphp)php;
php php php php php php php php php php php php php php php php php$optionsphp php=php arrayphp(php)php;
php php php php php php php php php php php php php php php php ifphp php(issetphp(php$specphp[php'typephp'php]php)php)php php{
php php php php php php php php php php php php php php php php php php php php php$typephp php=php php$specphp[php'typephp'php]php;
php php php php php php php php php php php php php php php php php php php php ifphp php(issetphp(php$specphp[php'namephp'php]php)php)php php{
php php php php php php php php php php php php php php php php php php php php php php php php php$namephp php=php php$specphp[php'namephp'php]php;
php php php php php php php php php php php php php php php php php php php php php}
php php php php php php php php php php php php php php php php php php php php ifphp php(issetphp(php$specphp[php'optionsphp'php]php)php)php php{
php php php php php php php php php php php php php php php php php php php php php php php php php$optionsphp php=php php$specphp[php'optionsphp'php]php;
php php php php php php php php php php php php php php php php php php php php php}
php php php php php php php php php php php php php php php php php php php php php$thisphp-php>addElementphp(php$typephp,php php$namephp,php php$optionsphp)php;
php php php php php php php php php php php php php php php php php}php elsephp php{
php php php php php php php php php php php php php php php php php php php php switchphp php(php$argcphp)php php{
php php php php php php php php php php php php php php php php php php php php php php php php casephp php0php:
php php php php php php php php php php php php php php php php php php php php php php php php php php php php continuephp;
php php php php php php php php php php php php php php php php php php php php php php php php casephp php(php1php <php=php php$argcphp)php:
php php php php php php php php php php php php php php php php php php php php php php php php php php php php php$typephp php=php arrayphp_shiftphp(php$specphp)php;
php php php php php php php php php php php php php php php php php php php php php php php php casephp php(php2php <php=php php$argcphp)php:
php php php php php php php php php php php php php php php php php php php php php php php php php php php php ifphp php(nullphp php=php=php=php php$namephp)php php{
php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php$namephp php=php arrayphp_shiftphp(php$specphp)php;
php php php php php php php php php php php php php php php php php php php php php php php php php php php php php}php elsephp php{
php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php$optionsphp php=php arrayphp_shiftphp(php$specphp)php;
php php php php php php php php php php php php php php php php php php php php php php php php php php php php php}
php php php php php php php php php php php php php php php php php php php php php php php php casephp php(php3php <php=php php$argcphp)php:
php php php php php php php php php php php php php php php php php php php php php php php php php php php php ifphp php(emptyphp(php$optionsphp)php)php php{
php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php$optionsphp php=php arrayphp_shiftphp(php$specphp)php;
php php php php php php php php php php php php php php php php php php php php php php php php php php php php php}
php php php php php php php php php php php php php php php php php php php php php php php php defaultphp:
php php php php php php php php php php php php php php php php php php php php php php php php php php php php php$thisphp-php>addElementphp(php$typephp,php php$namephp,php php$optionsphp)php;
php php php php php php php php php php php php php php php php php php php php php}
php php php php php php php php php php php php php php php php php}
php php php php php php php php php php php php php}
php php php php php php php php php}
php php php php php php php php returnphp php$thisphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Setphp formphp elementsphp php(overwritesphp existingphp elementsphp)
php php php php php php*
php php php php php php*php php@paramphp php arrayphp php$elements
php php php php php php*php php@returnphp Zendphp_Form
php php php php php php*php/
php php php php publicphp functionphp setElementsphp(arrayphp php$elementsphp)
php php php php php{
php php php php php php php php php$thisphp-php>clearElementsphp(php)php;
php php php php php php php php returnphp php$thisphp-php>addElementsphp(php$elementsphp)php;
php php php php php}

php php php php php/php*php*
php php php php php php*php Retrievephp aphp singlephp element
php php php php php php*
php php php php php php*php php@paramphp php stringphp php$name
php php php php php php*php php@returnphp Zendphp_Formphp_Elementphp|null
php php php php php php*php/
php php php php publicphp functionphp getElementphp(php$namephp)
php php php php php{
php php php php php php php php ifphp php(arrayphp_keyphp_existsphp(php$namephp,php php$thisphp-php>php_elementsphp)php)php php{
php php php php php php php php php php php php returnphp php$thisphp-php>php_elementsphp[php$namephp]php;
php php php php php php php php php}
php php php php php php php php returnphp nullphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Retrievephp allphp elements
php php php php php php*
php php php php php php*php php@returnphp array
php php php php php php*php/
php php php php publicphp functionphp getElementsphp(php)
php php php php php{
php php php php php php php php returnphp php$thisphp-php>php_elementsphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Removephp element
php php php php php php*
php php php php php php*php php@paramphp php stringphp php$name
php php php php php php*php php@returnphp boolean
php php php php php php*php/
php php php php publicphp functionphp removeElementphp(php$namephp)
php php php php php{
php php php php php php php php php$namephp php=php php(stringphp)php php$namephp;
php php php php php php php php ifphp php(issetphp(php$thisphp-php>php_elementsphp[php$namephp]php)php)php php{
php php php php php php php php php php php php unsetphp(php$thisphp-php>php_elementsphp[php$namephp]php)php;
php php php php php php php php php php php php ifphp php(arrayphp_keyphp_existsphp(php$namephp,php php$thisphp-php>php_orderphp)php)php php{
php php php php php php php php php php php php php php php php unsetphp(php$thisphp-php>php_orderphp[php$namephp]php)php;
php php php php php php php php php php php php php php php php php$thisphp-php>php_orderUpdatedphp php=php truephp;
php php php php php php php php php php php php php}php elsephp php{
php php php php php php php php php php php php php php php php foreachphp php(php$thisphp-php>php_displayGroupsphp asphp php$groupphp)php php{
php php php php php php php php php php php php php php php php php php php php ifphp php(nullphp php!php=php=php php$groupphp-php>getElementphp(php$namephp)php)php php{
php php php php php php php php php php php php php php php php php php php php php php php php php$groupphp-php>removeElementphp(php$namephp)php;
php php php php php php php php php php php php php php php php php php php php php}
php php php php php php php php php php php php php php php php php}
php php php php php php php php php php php php php}
php php php php php php php php php php php php returnphp truephp;
php php php php php php php php php}

php php php php php php php php returnphp falsephp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Removephp allphp formphp elements
php php php php php php*
php php php php php php*php php@returnphp Zendphp_Form
php php php php php php*php/
php php php php publicphp functionphp clearElementsphp(php)
php php php php php{
php php php php php php php php foreachphp php(arrayphp_keysphp(php$thisphp-php>php_elementsphp)php asphp php$keyphp)php php{
php php php php php php php php php php php php ifphp php(arrayphp_keyphp_existsphp(php$keyphp,php php$thisphp-php>php_orderphp)php)php php{
php php php php php php php php php php php php php php php php unsetphp(php$thisphp-php>php_orderphp[php$keyphp]php)php;
php php php php php php php php php php php php php}
php php php php php php php php php}
php php php php php php php php php$thisphp-php>php_elementsphp php php php php php=php arrayphp(php)php;
php php php php php php php php php$thisphp-php>php_orderUpdatedphp php=php truephp;
php php php php php php php php returnphp php$thisphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Setphp defaultphp valuesphp forphp elements
php php php php php php*
php php php php php php*php Setsphp valuesphp forphp allphp elementsphp specifiedphp inphp thephp arrayphp ofphp php$defaultsphp.
php php php php php php*
php php php php php php*php php@paramphp php arrayphp php$defaults
php php php php php php*php php@returnphp Zendphp_Form
php php php php php php*php/
php php php php publicphp functionphp setDefaultsphp(arrayphp php$defaultsphp)
php php php php php{
php php php php php php php php php$eBelongTophp php=php nullphp;

php php php php php php php php ifphp php(php$thisphp-php>isArrayphp(php)php)php php{
php php php php php php php php php php php php php$eBelongTophp php=php php$thisphp-php>getElementsBelongTophp(php)php;
php php php php php php php php php php php php php$defaultsphp php=php php$thisphp-php>php_dissolveArrayValuephp(php$defaultsphp,php php$eBelongTophp)php;
php php php php php php php php php}
php php php php php php php php foreachphp php(php$thisphp-php>getElementsphp(php)php asphp php$namephp php=php>php php$elementphp)php php{
php php php php php php php php php php php php php$checkphp php=php php$defaultsphp;
php php php php php php php php php php php php ifphp php(php(php$belongsTophp php=php php$elementphp-php>getBelongsTophp(php)php)php php!php=php=php php$eBelongTophp)php php{
php php php php php php php php php php php php php php php php php$checkphp php=php php$thisphp-php>php_dissolveArrayValuephp(php$defaultsphp,php php$belongsTophp)php;
php php php php php php php php php php php php php}
php php php php php php php php php php php php ifphp php(arrayphp_keyphp_existsphp(php$namephp,php php$checkphp)php)php php{
php php php php php php php php php php php php php php php php php$thisphp-php>setDefaultphp(php$namephp,php php$checkphp[php$namephp]php)php;
php php php php php php php php php php php php php php php php php$defaultsphp php=php php$thisphp-php>php_dissolveArrayUnsetKeyphp(php$defaultsphp,php php$belongsTophp,php php$namephp)php;
php php php php php php php php php php php php php}
php php php php php php php php php}
php php php php php php php php foreachphp php(php$thisphp-php>getSubFormsphp(php)php asphp php$namephp php=php>php php$formphp)php php{
php php php php php php php php php php php php ifphp php(php!php$formphp-php>isArrayphp(php)php php&php&php arrayphp_keyphp_existsphp(php$namephp,php php$defaultsphp)php)php php{
php php php php php php php php php php php php php php php php php$formphp-php>setDefaultsphp(php$defaultsphp[php$namephp]php)php;
php php php php php php php php php php php php php}php elsephp php{
php php php php php php php php php php php php php php php php php$formphp-php>setDefaultsphp(php$defaultsphp)php;
php php php php php php php php php php php php php}
php php php php php php php php php}
php php php php php php php php returnphp php$thisphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Setphp defaultphp valuephp forphp anphp element
php php php php php php*
php php php php php php*php php@paramphp php stringphp php$name
php php php php php php*php php@paramphp php mixedphp php$value
php php php php php php*php php@returnphp Zendphp_Form
php php php php php php*php/
php php php php publicphp functionphp setDefaultphp(php$namephp,php php$valuephp)
php php php php php{
php php php php php php php php php$namephp php=php php(stringphp)php php$namephp;
php php php php php php php php ifphp php(php$elementphp php=php php$thisphp-php>getElementphp(php$namephp)php)php php{
php php php php php php php php php php php php php$elementphp-php>setValuephp(php$valuephp)php;
php php php php php php php php php}php elsephp php{
php php php php php php php php php php php php ifphp php(isphp_scalarphp(php$valuephp)php)php php{
php php php php php php php php php php php php php php php php foreachphp php(php$thisphp-php>getSubFormsphp(php)php asphp php$subFormphp)php php{
php php php php php php php php php php php php php php php php php php php php php$subFormphp-php>setDefaultphp(php$namephp,php php$valuephp)php;
php php php php php php php php php php php php php php php php php}
php php php php php php php php php php php php php}php elseifphp php(isphp_arrayphp(php$valuephp)php php&php&php php(php$subFormphp php=php php$thisphp-php>getSubFormphp(php$namephp)php)php)php php{
php php php php php php php php php php php php php php php php php$subFormphp-php>setDefaultsphp(php$valuephp)php;
php php php php php php php php php php php php php}
php php php php php php php php php}
php php php php php php php php returnphp php$thisphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Retrievephp valuephp forphp singlephp element
php php php php php php*
php php php php php php*php php@paramphp php stringphp php$name
php php php php php php*php php@returnphp mixed
php php php php php php*php/
php php php php publicphp functionphp getValuephp(php$namephp)
php php php php php{
php php php php php php php php ifphp php(php$elementphp php=php php$thisphp-php>getElementphp(php$namephp)php)php php{
php php php php php php php php php php php php returnphp php$elementphp-php>getValuephp(php)php;
php php php php php php php php php}

php php php php php php php php ifphp php(php$subFormphp php=php php$thisphp-php>getSubFormphp(php$namephp)php)php php{
php php php php php php php php php php php php returnphp php$subFormphp-php>getValuesphp(truephp)php;
php php php php php php php php php}

php php php php php php php php foreachphp php(php$thisphp-php>getSubFormsphp(php)php asphp php$subFormphp)php php{
php php php php php php php php php php php php ifphp php(php$namephp php=php=php php$subFormphp-php>getElementsBelongTophp(php)php)php php{
php php php php php php php php php php php php php php php php returnphp php$subFormphp-php>getValuesphp(truephp)php;
php php php php php php php php php php php php php}
php php php php php php php php php}
php php php php php php php php returnphp nullphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Retrievephp allphp formphp elementphp values
php php php php php php*
php php php php php php*php php@paramphp php boolphp php$suppressArrayNotation
php php php php php php*php php@returnphp array
php php php php php php*php/
php php php php publicphp functionphp getValuesphp(php$suppressArrayNotationphp php=php falsephp)
php php php php php{
php php php php php php php php php$valuesphp php=php arrayphp(php)php;
php php php php php php php php php$eBelongTophp php=php nullphp;

php php php php php php php php ifphp php(php$thisphp-php>isArrayphp(php)php)php php{
php php php php php php php php php php php php php$eBelongTophp php=php php$thisphp-php>getElementsBelongTophp(php)php;
php php php php php php php php php}

php php php php php php php php foreachphp php(php$thisphp-php>getElementsphp(php)php asphp php$keyphp php=php>php php$elementphp)php php{
php php php php php php php php php php php php ifphp php(php!php$elementphp-php>getIgnorephp(php)php)php php{
php php php php php php php php php php php php php php php php php$mergephp php=php arrayphp(php)php;
php php php php php php php php php php php php php php php php ifphp php(php(php$belongsTophp php=php php$elementphp-php>getBelongsTophp(php)php)php php!php=php=php php$eBelongTophp)php php{
php php php php php php php php php php php php php php php php php php php php ifphp php(php'php'php php!php=php=php php(stringphp)php$belongsTophp)php php{
php php php php php php php php php php php php php php php php php php php php php php php php php$keyphp php=php php$belongsTophp php.php php'php[php'php php.php php$keyphp php.php php'php]php'php;
php php php php php php php php php php php php php php php php php php php php php}
php php php php php php php php php php php php php php php php php}
php php php php php php php php php php php php php php php php php$mergephp php=php php$thisphp-php>php_attachToArrayphp(php$elementphp-php>getValuephp(php)php,php php$keyphp)php;
php php php php php php php php php php php php php php php php php$valuesphp php=php php$thisphp-php>php_arrayphp_replacephp_recursivephp(php$valuesphp,php php$mergephp)php;
php php php php php php php php php php php php php}
php php php php php php php php php}
php php php php php php php php foreachphp php(php$thisphp-php>getSubFormsphp(php)php asphp php$keyphp php=php>php php$subFormphp)php php{
php php php php php php php php php php php php php$mergephp php=php arrayphp(php)php;
php php php php php php php php php php php php ifphp php(php!php$subFormphp-php>isArrayphp(php)php)php php{
php php php php php php php php php php php php php php php php php$mergephp[php$keyphp]php php=php php$subFormphp-php>getValuesphp(php)php;
php php php php php php php php php php php php php}php elsephp php{
php php php php php php php php php php php php php php php php php$mergephp php=php php$thisphp-php>php_attachToArrayphp(php$subFormphp-php>getValuesphp(truephp)php,
php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php$subFormphp-php>getElementsBelongTophp(php)php)php;
php php php php php php php php php php php php php}
php php php php php php php php php php php php php$valuesphp php=php php$thisphp-php>php_arrayphp_replacephp_recursivephp(php$valuesphp,php php$mergephp)php;
php php php php php php php php php}

php php php php php php php php ifphp php(php!php$suppressArrayNotationphp php&php&
php php php php php php php php php php php php php$thisphp-php>isArrayphp(php)php php&php&
php php php php php php php php php php php php php!php$thisphp-php>php_getIsRenderedphp(php)php)php php{
php php php php php php php php php php php php php$valuesphp php=php php$thisphp-php>php_attachToArrayphp(php$valuesphp,php php$thisphp-php>getElementsBelongTophp(php)php)php;
php php php php php php php php php}

php php php php php php php php returnphp php$valuesphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Returnsphp onlyphp thephp validphp valuesphp fromphp thephp givenphp formphp inputphp.
php php php php php php*
php php php php php php*php Forphp modelsphp thatphp canphp bephp savedphp inphp aphp partiallyphp validphp statephp,php forphp examplephp whenphp followingphp thephp builderphp,
php php php php php php*php prototypephp orphp statephp patternsphp itphp isphp particularlyphp interesstingphp tophp retrievephp allphp thephp currentphp valid
php php php php php php*php valuesphp tophp persistphp themphp.
php php php php php php*
php php php php php php*php php@paramphp php arrayphp php$data
php php php php php php*php php@paramphp php boolphp php$suppressArrayNotation
php php php php php php*php php@returnphp array
php php php php php php*php/
php php php php publicphp functionphp getValidValuesphp(php$dataphp,php php$suppressArrayNotationphp php=php falsephp)
php php php php php{
php php php php php php php php php$valuesphp php=php arrayphp(php)php;
php php php php php php php php php$eBelongTophp php=php nullphp;

php php php php php php php php ifphp php(php$thisphp-php>isArrayphp(php)php)php php{
php php php php php php php php php php php php php$eBelongTophp php=php php$thisphp-php>getElementsBelongTophp(php)php;
php php php php php php php php php php php php php$dataphp php=php php$thisphp-php>php_dissolveArrayValuephp(php$dataphp,php php$eBelongTophp)php;
php php php php php php php php php}
php php php php php php php php php$contextphp php=php php$dataphp;
php php php php php php php php foreachphp php(php$thisphp-php>getElementsphp(php)php asphp php$keyphp php=php>php php$elementphp)php php{
php php php php php php php php php php php php ifphp php(php!php$elementphp-php>getIgnorephp(php)php)php php{
php php php php php php php php php php php php php php php php php$checkphp php=php php$dataphp;
php php php php php php php php php php php php php php php php ifphp php(php(php$belongsTophp php=php php$elementphp-php>getBelongsTophp(php)php)php php!php=php=php php$eBelongTophp)php php{
php php php php php php php php php php php php php php php php php php php php php$checkphp php=php php$thisphp-php>php_dissolveArrayValuephp(php$dataphp,php php$belongsTophp)php;
php php php php php php php php php php php php php php php php php}
php php php php php php php php php php php php php php php php ifphp php(issetphp(php$checkphp[php$keyphp]php)php)php php{
php php php php php php php php php php php php php php php php php php php php ifphp(php$elementphp-php>isValidphp(php$checkphp[php$keyphp]php,php php$contextphp)php)php php{
php php php php php php php php php php php php php php php php php php php php php php php php php$mergephp php=php arrayphp(php)php;
php php php php php php php php php php php php php php php php php php php php php php php php ifphp php(php$belongsTophp php!php=php=php php$eBelongTophp php&php&php php'php'php php!php=php=php php(stringphp)php$belongsTophp)php php{
php php php php php php php php php php php php php php php php php php php php php php php php php php php php php$keyphp php=php php$belongsTophp php.php php'php[php'php php.php php$keyphp php.php php'php]php'php;
php php php php php php php php php php php php php php php php php php php php php php php php php}
php php php php php php php php php php php php php php php php php php php php php php php php php$mergephp php=php php$thisphp-php>php_attachToArrayphp(php$elementphp-php>getValuephp(php)php,php php$keyphp)php;
php php php php php php php php php php php php php php php php php php php php php php php php php$valuesphp php=php php$thisphp-php>php_arrayphp_replacephp_recursivephp(php$valuesphp,php php$mergephp)php;
php php php php php php php php php php php php php php php php php php php php php}
php php php php php php php php php php php php php php php php php php php php php$dataphp php=php php$thisphp-php>php_dissolveArrayUnsetKeyphp(php$dataphp,php php$belongsTophp,php php$keyphp)php;
php php php php php php php php php php php php php php php php php}
php php php php php php php php php php php php php}
php php php php php php php php php}
php php php php php php php php foreachphp php(php$thisphp-php>getSubFormsphp(php)php asphp php$keyphp php=php>php php$formphp)php php{
php php php php php php php php php php php php php$mergephp php=php arrayphp(php)php;
php php php php php php php php php php php php ifphp php(issetphp(php$dataphp[php$keyphp]php)php php&php&php php!php$formphp-php>isArrayphp(php)php)php php{
php php php php php php php php php php php php php php php php php$tmpphp php=php php$formphp-php>getValidValuesphp(php$dataphp[php$keyphp]php)php;
php php php php php php php php php php php php php php php php ifphp php(php!emptyphp(php$tmpphp)php)php php{
php php php php php php php php php php php php php php php php php php php php php$mergephp[php$keyphp]php php=php php$tmpphp;
php php php php php php php php php php php php php php php php php}
php php php php php php php php php php php php php}php elsephp php{
php php php php php php php php php php php php php php php php php$tmpphp php=php php$formphp-php>getValidValuesphp(php$dataphp,php truephp)php;
php php php php php php php php php php php php php php php php ifphp php(php!emptyphp(php$tmpphp)php)php php{
php php php php php php php php php php php php php php php php php php php php php$mergephp php=php php$thisphp-php>php_attachToArrayphp(php$tmpphp,php php$formphp-php>getElementsBelongTophp(php)php)php;
php php php php php php php php php php php php php php php php php}
php php php php php php php php php php php php php}
php php php php php php php php php php php php php$valuesphp php=php php$thisphp-php>php_arrayphp_replacephp_recursivephp(php$valuesphp,php php$mergephp)php;
php php php php php php php php php}
php php php php php php php php ifphp php(php!php$suppressArrayNotationphp php&php&
php php php php php php php php php php php php php$thisphp-php>isArrayphp(php)php php&php&
php php php php php php php php php php php php php!emptyphp(php$valuesphp)php php&php&
php php php php php php php php php php php php php!php$thisphp-php>php_getIsRenderedphp(php)php)php php{
php php php php php php php php php php php php php$valuesphp php=php php$thisphp-php>php_attachToArrayphp(php$valuesphp,php php$thisphp-php>getElementsBelongTophp(php)php)php;
php php php php php php php php php}

php php php php php php php php returnphp php$valuesphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Getphp unfilteredphp elementphp value
php php php php php php*
php php php php php php*php php@paramphp php stringphp php$name
php php php php php php*php php@returnphp mixed
php php php php php php*php/
php php php php publicphp functionphp getUnfilteredValuephp(php$namephp)
php php php php php{
php php php php php php php php ifphp php(php$elementphp php=php php$thisphp-php>getElementphp(php$namephp)php)php php{
php php php php php php php php php php php php returnphp php$elementphp-php>getUnfilteredValuephp(php)php;
php php php php php php php php php}
php php php php php php php php returnphp nullphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Retrievephp allphp unfilteredphp elementphp values
php php php php php php*
php php php php php php*php php@returnphp array
php php php php php php*php/
php php php php publicphp functionphp getUnfilteredValuesphp(php)
php php php php php{
php php php php php php php php php$valuesphp php=php arrayphp(php)php;
php php php php php php php php foreachphp php(php$thisphp-php>getElementsphp(php)php asphp php$keyphp php=php>php php$elementphp)php php{
php php php php php php php php php php php php php$valuesphp[php$keyphp]php php=php php$elementphp-php>getUnfilteredValuephp(php)php;
php php php php php php php php php}

php php php php php php php php returnphp php$valuesphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Setphp allphp elementsphp'php filters
php php php php php php*
php php php php php php*php php@paramphp php arrayphp php$filters
php php php php php php*php php@returnphp Zendphp_Form
php php php php php php*php/
php php php php publicphp functionphp setElementFiltersphp(arrayphp php$filtersphp)
php php php php php{
php php php php php php php php foreachphp php(php$thisphp-php>getElementsphp(php)php asphp php$elementphp)php php{
php php php php php php php php php php php php php$elementphp-php>setFiltersphp(php$filtersphp)php;
php php php php php php php php php}
php php php php php php php php returnphp php$thisphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Setphp namephp ofphp arrayphp elementsphp belongphp to
php php php php php php*
php php php php php php*php php@paramphp php stringphp php$array
php php php php php php*php php@returnphp Zendphp_Form
php php php php php php*php/
php php php php publicphp functionphp setElementsBelongTophp(php$arrayphp)
php php php php php{
php php php php php php php php php$origNamephp php=php php$thisphp-php>getElementsBelongTophp(php)php;
php php php php php php php php php$namephp php=php php$thisphp-php>filterNamephp(php$arrayphp,php truephp)php;
php php php php php php php php ifphp php(php'php'php php=php=php=php php$namephp)php php{
php php php php php php php php php php php php php$namephp php=php nullphp;
php php php php php php php php php}
php php php php php php php php php$thisphp-php>php_elementsBelongTophp php=php php$namephp;

php php php php php php php php ifphp php(nullphp php=php=php=php php$namephp)php php{
php php php php php php php php php php php php php$thisphp-php>setIsArrayphp(falsephp)php;
php php php php php php php php php php php php ifphp php(nullphp php!php=php=php php$origNamephp)php php{
php php php php php php php php php php php php php php php php php$thisphp-php>php_setElementsBelongTophp(php)php;
php php php php php php php php php php php php php}
php php php php php php php php php}php elsephp php{
php php php php php php php php php php php php php$thisphp-php>setIsArrayphp(truephp)php;
php php php php php php php php php php php php php$thisphp-php>php_setElementsBelongTophp(php)php;
php php php php php php php php php}

php php php php php php php php returnphp php$thisphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Setphp arrayphp tophp whichphp elementsphp belong
php php php php php php*
php php php php php php*php php@paramphp php stringphp php$namephp Elementphp name
php php php php php php*php php@returnphp void
php php php php php php*php/
php php php php protectedphp functionphp php_setElementsBelongTophp(php$namephp php=php nullphp)
php php php php php{
php php php php php php php php php$arrayphp php=php php$thisphp-php>getElementsBelongTophp(php)php;

php php php php php php php php ifphp php(nullphp php=php=php=php php$arrayphp)php php{
php php php php php php php php php php php php returnphp;
php php php php php php php php php}

php php php php php php php php ifphp php(nullphp php=php=php=php php$namephp)php php{
php php php php php php php php php php php php foreachphp php(php$thisphp-php>getElementsphp(php)php asphp php$elementphp)php php{
php php php php php php php php php php php php php php php php php$elementphp-php>setBelongsTophp(php$arrayphp)php;
php php php php php php php php php php php php php}
php php php php php php php php php}php elsephp php{
php php php php php php php php php php php php ifphp php(nullphp php!php=php=php php(php$elementphp php=php php$thisphp-php>getElementphp(php$namephp)php)php)php php{
php php php php php php php php php php php php php php php php php$elementphp-php>setBelongsTophp(php$arrayphp)php;
php php php php php php php php php php php php php}
php php php php php php php php php}
php php php php php}

php php php php php/php*php*
php php php php php php*php Getphp namephp ofphp arrayphp elementsphp belongphp to
php php php php php php*
php php php php php php*php php@returnphp stringphp|null
php php php php php php*php/
php php php php publicphp functionphp getElementsBelongTophp(php)
php php php php php{
php php php php php php php php ifphp php(php(nullphp php=php=php=php php$thisphp-php>php_elementsBelongTophp)php php&php&php php$thisphp-php>isArrayphp(php)php)php php{
php php php php php php php php php php php php php$namephp php=php php$thisphp-php>getNamephp(php)php;
php php php php php php php php php php php php ifphp php(php'php'php php!php=php=php php(stringphp)php$namephp)php php{
php php php php php php php php php php php php php php php php returnphp php$namephp;
php php php php php php php php php php php php php}
php php php php php php php php php}
php php php php php php php php returnphp php$thisphp-php>php_elementsBelongTophp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Setphp flagphp indicatingphp elementsphp belongphp tophp array
php php php php php php*
php php php php php php*php php@paramphp php boolphp php$flagphp Valuephp ofphp flag
php php php php php php*php php@returnphp Zendphp_Form
php php php php php php*php/
php php php php publicphp functionphp setIsArrayphp(php$flagphp)
php php php php php{
php php php php php php php php php$thisphp-php>php_isArrayphp php=php php(boolphp)php php$flagphp;
php php php php php php php php returnphp php$thisphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Getphp flagphp indicatingphp ifphp elementsphp belongphp tophp anphp array
php php php php php php*
php php php php php php*php php@returnphp bool
php php php php php php*php/
php php php php publicphp functionphp isArrayphp(php)
php php php php php{
php php php php php php php php returnphp php$thisphp-php>php_isArrayphp;
php php php php php}

php php php php php/php/php Elementphp groupsphp:

php php php php php/php*php*
php php php php php php*php Addphp aphp formphp groupphp/subform
php php php php php php*
php php php php php php*php php@paramphp php Zendphp_Formphp php$form
php php php php php php*php php@paramphp php stringphp php$name
php php php php php php*php php@paramphp php intphp php$order
php php php php php php*php php@returnphp Zendphp_Form
php php php php php php*php/
php php php php publicphp functionphp addSubFormphp(Zendphp_Formphp php$formphp,php php$namephp,php php$orderphp php=php nullphp)
php php php php php{
php php php php php php php php php$namephp php=php php(stringphp)php php$namephp;
php php php php php php php php foreachphp php(php$thisphp-php>php_loadersphp asphp php$typephp php=php>php php$loaderphp)php php{
php php php php php php php php php php php php php$loaderPathsphp php=php php$loaderphp-php>getPathsphp(php)php;
php php php php php php php php php php php php foreachphp php(php$loaderPathsphp asphp php$prefixphp php=php>php php$pathsphp)php php{
php php php php php php php php php php php php php php php php foreachphp php(php$pathsphp asphp php$pathphp)php php{
php php php php php php php php php php php php php php php php php php php php php$formphp-php>addPrefixPathphp(php$prefixphp,php php$pathphp,php php$typephp)php;
php php php php php php php php php php php php php php php php php}
php php php php php php php php php php php php php}
php php php php php php php php php}

php php php php php php php php ifphp php(php!emptyphp(php$thisphp-php>php_elementPrefixPathsphp)php)php php{
php php php php php php php php php php php php foreachphp php(php$thisphp-php>php_elementPrefixPathsphp asphp php$specphp)php php{
php php php php php php php php php php php php php php php php listphp(php$prefixphp,php php$pathphp,php php$typephp)php php=php arrayphp_valuesphp(php$specphp)php;
php php php php php php php php php php php php php php php php php$formphp-php>addElementPrefixPathphp(php$prefixphp,php php$pathphp,php php$typephp)php;
php php php php php php php php php php php php php}
php php php php php php php php php}

php php php php php php php php ifphp php(php!emptyphp(php$thisphp-php>php_displayGroupPrefixPathsphp)php)php php{
php php php php php php php php php php php php foreachphp php(php$thisphp-php>php_displayGroupPrefixPathsphp asphp php$specphp)php php{
php php php php php php php php php php php php php php php php listphp(php$prefixphp,php php$pathphp)php php=php arrayphp_valuesphp(php$specphp)php;
php php php php php php php php php php php php php php php php php$formphp-php>addDisplayGroupPrefixPathphp(php$prefixphp,php php$pathphp)php;
php php php php php php php php php php php php php}
php php php php php php php php php}

php php php php php php php php ifphp php(nullphp php!php=php=php php$orderphp)php php{
php php php php php php php php php php php php php$formphp-php>setOrderphp(php$orderphp)php;
php php php php php php php php php}

php php php php php php php php ifphp php(php(php$oldNamephp php=php php$formphp-php>getNamephp(php)php)php php&php&
php php php php php php php php php php php php php$oldNamephp php!php=php=php php$namephp php&php&
php php php php php php php php php php php php php$oldNamephp php=php=php=php php$formphp-php>getElementsBelongTophp(php)php)php php{
php php php php php php php php php php php php php$formphp-php>setElementsBelongTophp(php$namephp)php;
php php php php php php php php php}

php php php php php php php php php$formphp-php>setNamephp(php$namephp)php;
php php php php php php php php php$thisphp-php>php_subFormsphp[php$namephp]php php=php php$formphp;
php php php php php php php php php$thisphp-php>php_orderphp[php$namephp]php php php php php=php php$orderphp;
php php php php php php php php php$thisphp-php>php_orderUpdatedphp php php php php=php truephp;
php php php php php php php php returnphp php$thisphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Addphp multiplephp formphp subFormsphp/subformsphp atphp once
php php php php php php*
php php php php php php*php php@paramphp php arrayphp php$subForms
php php php php php php*php php@returnphp Zendphp_Form
php php php php php php*php/
php php php php publicphp functionphp addSubFormsphp(arrayphp php$subFormsphp)
php php php php php{
php php php php php php php php foreachphp php(php$subFormsphp asphp php$keyphp php=php>php php$specphp)php php{
php php php php php php php php php php php php php$namephp php=php nullphp;
php php php php php php php php php php php php ifphp php(php!isphp_numericphp(php$keyphp)php)php php{
php php php php php php php php php php php php php php php php php$namephp php=php php$keyphp;
php php php php php php php php php php php php php}

php php php php php php php php php php php php ifphp php(php$specphp instanceofphp Zendphp_Formphp)php php{
php php php php php php php php php php php php php php php php php$thisphp-php>addSubFormphp(php$specphp,php php$namephp)php;
php php php php php php php php php php php php php php php php continuephp;
php php php php php php php php php php php php php}

php php php php php php php php php php php php ifphp php(isphp_arrayphp(php$specphp)php)php php{
php php php php php php php php php php php php php php php php php$argcphp php php=php countphp(php$specphp)php;
php php php php php php php php php php php php php php php php php$orderphp php=php nullphp;
php php php php php php php php php php php php php php php php switchphp php(php$argcphp)php php{
php php php php php php php php php php php php php php php php php php php php casephp php0php:
php php php php php php php php php php php php php php php php php php php php php php php php continuephp;
php php php php php php php php php php php php php php php php php php php php casephp php(php1php <php=php php$argcphp)php:
php php php php php php php php php php php php php php php php php php php php php php php php php$subFormphp php=php arrayphp_shiftphp(php$specphp)php;
php php php php php php php php php php php php php php php php php php php php casephp php(php2php <php=php php$argcphp)php:
php php php php php php php php php php php php php php php php php php php php php php php php php$namephp php php=php arrayphp_shiftphp(php$specphp)php;
php php php php php php php php php php php php php php php php php php php php casephp php(php3php <php=php php$argcphp)php:
php php php php php php php php php php php php php php php php php php php php php php php php php$orderphp php=php arrayphp_shiftphp(php$specphp)php;
php php php php php php php php php php php php php php php php php php php php defaultphp:
php php php php php php php php php php php php php php php php php php php php php php php php php$thisphp-php>addSubFormphp(php$subFormphp,php php$namephp,php php$orderphp)php;
php php php php php php php php php php php php php php php php php}
php php php php php php php php php php php php php}
php php php php php php php php php}
php php php php php php php php returnphp php$thisphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Setphp multiplephp formphp subFormsphp/subformsphp php(overwritesphp)
php php php php php php*
php php php php php php*php php@paramphp php arrayphp php$subForms
php php php php php php*php php@returnphp Zendphp_Form
php php php php php php*php/
php php php php publicphp functionphp setSubFormsphp(arrayphp php$subFormsphp)
php php php php php{
php php php php php php php php php$thisphp-php>clearSubFormsphp(php)php;
php php php php php php php php returnphp php$thisphp-php>addSubFormsphp(php$subFormsphp)php;
php php php php php}

php php php php php/php*php*
php php php php php php*php Retrievephp aphp formphp subFormphp/subform
php php php php php php*
php php php php php php*php php@paramphp php stringphp php$name
php php php php php php*php php@returnphp Zendphp_Formphp|null
php php php php php php*php/
php php php php publicphp functionphp getSubFormphp(php$namephp)
php php php php php{
php php php php php php php php php$namephp php=php php(stringphp)php php$namephp;
php php php php php php php php ifphp php(issetphp(php$thisphp-php>php_subFormsphp[php$namephp]php)php)php php{
php php php php php php php php php php php php returnphp php$thisphp-php>php_subFormsphp[php$namephp]php;
php php php php php php php php php}
php php php php php php php php returnphp nullphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Retrievephp allphp formphp subFormsphp/subforms
php php php php php php*
php php php php php php*php php@returnphp array
php php php php php php*php/
php php php php publicphp functionphp getSubFormsphp(php)
php php php php php{
php php php php php php php php returnphp php$thisphp-php>php_subFormsphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Removephp formphp subFormphp/subform
php php php php php php*
php php php php php php*php php@paramphp php stringphp php$name
php php php php php php*php php@returnphp boolean
php php php php php php*php/
php php php php publicphp functionphp removeSubFormphp(php$namephp)
php php php php php{
php php php php php php php php php$namephp php=php php(stringphp)php php$namephp;
php php php php php php php php ifphp php(arrayphp_keyphp_existsphp(php$namephp,php php$thisphp-php>php_subFormsphp)php)php php{
php php php php php php php php php php php php unsetphp(php$thisphp-php>php_subFormsphp[php$namephp]php)php;
php php php php php php php php php php php php ifphp php(arrayphp_keyphp_existsphp(php$namephp,php php$thisphp-php>php_orderphp)php)php php{
php php php php php php php php php php php php php php php php unsetphp(php$thisphp-php>php_orderphp[php$namephp]php)php;
php php php php php php php php php php php php php php php php php$thisphp-php>php_orderUpdatedphp php=php truephp;
php php php php php php php php php php php php php}
php php php php php php php php php php php php returnphp truephp;
php php php php php php php php php}

php php php php php php php php returnphp falsephp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Removephp allphp formphp subFormsphp/subforms
php php php php php php*
php php php php php php*php php@returnphp Zendphp_Form
php php php php php php*php/
php php php php publicphp functionphp clearSubFormsphp(php)
php php php php php{
php php php php php php php php foreachphp php(arrayphp_keysphp(php$thisphp-php>php_subFormsphp)php asphp php$keyphp)php php{
php php php php php php php php php php php php ifphp php(arrayphp_keyphp_existsphp(php$keyphp,php php$thisphp-php>php_orderphp)php)php php{
php php php php php php php php php php php php php php php php unsetphp(php$thisphp-php>php_orderphp[php$keyphp]php)php;
php php php php php php php php php php php php php}
php php php php php php php php php}
php php php php php php php php php$thisphp-php>php_subFormsphp php php php php php=php arrayphp(php)php;
php php php php php php php php php$thisphp-php>php_orderUpdatedphp php=php truephp;
php php php php php php php php returnphp php$thisphp;
php php php php php}


php php php php php/php/php Displayphp groupsphp:

php php php php php/php*php*
php php php php php php*php Setphp defaultphp displayphp groupphp class
php php php php php php*
php php php php php php*php php@paramphp php stringphp php$class
php php php php php php*php php@returnphp Zendphp_Form
php php php php php php*php/
php php php php publicphp functionphp setDefaultDisplayGroupClassphp(php$classphp)
php php php php php{
php php php php php php php php php$thisphp-php>php_defaultDisplayGroupClassphp php=php php(stringphp)php php$classphp;
php php php php php php php php returnphp php$thisphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Retrievephp defaultphp displayphp groupphp class
php php php php php php*
php php php php php php*php php@returnphp string
php php php php php php*php/
php php php php publicphp functionphp getDefaultDisplayGroupClassphp(php)
php php php php php{
php php php php php php php php returnphp php$thisphp-php>php_defaultDisplayGroupClassphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Addphp aphp displayphp group
php php php php php php*
php php php php php php*php Groupsphp namedphp elementsphp forphp displayphp purposesphp.
php php php php php php*
php php php php php php*php Ifphp aphp referencedphp elementphp doesphp notphp yetphp existphp inphp thephp formphp,php itphp isphp omittedphp.
php php php php php php*
php php php php php php*php php@paramphp php arrayphp php$elements
php php php php php php*php php@paramphp php stringphp php$name
php php php php php php*php php@paramphp php arrayphp|Zendphp_Configphp php$options
php php php php php php*php php@returnphp Zendphp_Form
php php php php php php*php php@throwsphp Zendphp_Formphp_Exceptionphp ifphp nophp validphp elementsphp provided
php php php php php php*php/
php php php php publicphp functionphp addDisplayGroupphp(arrayphp php$elementsphp,php php$namephp,php php$optionsphp php=php nullphp)
php php php php php{
php php php php php php php php php$groupphp php=php arrayphp(php)php;
php php php php php php php php foreachphp php(php$elementsphp asphp php$elementphp)php php{
php php php php php php php php php php php php ifphp(php$elementphp instanceofphp Zendphp_Formphp_Elementphp)php php{
php php php php php php php php php php php php php php php php php$elementphp php=php php$elementphp-php>getIdphp(php)php;
php php php php php php php php php php php php php}

php php php php php php php php php php php php ifphp php(issetphp(php$thisphp-php>php_elementsphp[php$elementphp]php)php)php php{
php php php php php php php php php php php php php php php php php$addphp php=php php$thisphp-php>getElementphp(php$elementphp)php;
php php php php php php php php php php php php php php php php ifphp php(nullphp php!php=php=php php$addphp)php php{
php php php php php php php php php php php php php php php php php php php php php$groupphp[php]php php=php php$addphp;
php php php php php php php php php php php php php php php php php}
php php php php php php php php php php php php php}
php php php php php php php php php}
php php php php php php php php ifphp php(emptyphp(php$groupphp)php)php php{
php php php php php php php php php php php php requirephp_oncephp php'Zendphp/Formphp/Exceptionphp.phpphp'php;
php php php php php php php php php php php php throwphp newphp Zendphp_Formphp_Exceptionphp(php'Nophp validphp elementsphp specifiedphp forphp displayphp groupphp'php)php;
php php php php php php php php php}

php php php php php php php php php$namephp php=php php(stringphp)php php$namephp;

php php php php php php php php ifphp php(isphp_arrayphp(php$optionsphp)php)php php{
php php php php php php php php php php php php php$optionsphp[php'formphp'php]php php php php php php=php php$thisphp;
php php php php php php php php php php php php php$optionsphp[php'elementsphp'php]php php=php php$groupphp;
php php php php php php php php php}php elseifphp php(php$optionsphp instanceofphp Zendphp_Configphp)php php{
php php php php php php php php php php php php php$optionsphp php=php php$optionsphp-php>toArrayphp(php)php;
php php php php php php php php php php php php php$optionsphp[php'formphp'php]php php php php php php=php php$thisphp;
php php php php php php php php php php php php php$optionsphp[php'elementsphp'php]php php=php php$groupphp;
php php php php php php php php php}php elsephp php{
php php php php php php php php php php php php php$optionsphp php=php arrayphp(
php php php php php php php php php php php php php php php php php'formphp'php php php php php php=php>php php$thisphp,
php php php php php php php php php php php php php php php php php'elementsphp'php php=php>php php$groupphp,
php php php php php php php php php php php php php)php;
php php php php php php php php php}

php php php php php php php php ifphp php(issetphp(php$optionsphp[php'displayGroupClassphp'php]php)php)php php{
php php php php php php php php php php php php php$classphp php=php php$optionsphp[php'displayGroupClassphp'php]php;
php php php php php php php php php php php php unsetphp(php$optionsphp[php'displayGroupClassphp'php]php)php;
php php php php php php php php php}php elsephp php{
php php php php php php php php php php php php php$classphp php=php php$thisphp-php>getDefaultDisplayGroupClassphp(php)php;
php php php php php php php php php}

php php php php php php php php ifphp php(php!classphp_existsphp(php$classphp)php)php php{
php php php php php php php php php php php php requirephp_oncephp php'Zendphp/Loaderphp.phpphp'php;
php php php php php php php php php php php php Zendphp_Loaderphp:php:loadClassphp(php$classphp)php;
php php php php php php php php php}
php php php php php php php php php$thisphp-php>php_displayGroupsphp[php$namephp]php php=php newphp php$classphp(
php php php php php php php php php php php php php$namephp,
php php php php php php php php php php php php php$thisphp-php>getPluginLoaderphp(selfphp:php:DECORATORphp)php,
php php php php php php php php php php php php php$options
php php php php php php php php php)php;

php php php php php php php php ifphp php(php!emptyphp(php$thisphp-php>php_displayGroupPrefixPathsphp)php)php php{
php php php php php php php php php php php php php$thisphp-php>php_displayGroupsphp[php$namephp]php-php>addPrefixPathsphp(php$thisphp-php>php_displayGroupPrefixPathsphp)php;
php php php php php php php php php}

php php php php php php php php php$thisphp-php>php_orderphp[php$namephp]php php=php php$thisphp-php>php_displayGroupsphp[php$namephp]php-php>getOrderphp(php)php;
php php php php php php php php php$thisphp-php>php_orderUpdatedphp php=php truephp;
php php php php php php php php returnphp php$thisphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Addphp aphp displayphp groupphp objectphp php(usedphp withphp cloningphp)
php php php php php php*
php php php php php php*php php@paramphp php Zendphp_Formphp_DisplayGroupphp php$group
php php php php php php*php php@paramphp php stringphp|nullphp php$name
php php php php php php*php php@returnphp Zendphp_Form
php php php php php php*php/
php php php php protectedphp functionphp php_addDisplayGroupObjectphp(Zendphp_Formphp_DisplayGroupphp php$groupphp,php php$namephp php=php nullphp)
php php php php php{
php php php php php php php php ifphp php(nullphp php=php=php=php php$namephp)php php{
php php php php php php php php php php php php php$namephp php=php php$groupphp-php>getNamephp(php)php;
php php php php php php php php php php php php ifphp php(php'php'php php=php=php=php php(stringphp)php$namephp)php php{
php php php php php php php php php php php php php php php php requirephp_oncephp php'Zendphp/Formphp/Exceptionphp.phpphp'php;
php php php php php php php php php php php php php php php php throwphp newphp Zendphp_Formphp_Exceptionphp(php'Invalidphp displayphp groupphp addedphp;php requiresphp namephp'php)php;
php php php php php php php php php php php php php}
php php php php php php php php php}

php php php php php php php php php$thisphp-php>php_displayGroupsphp[php$namephp]php php=php php$groupphp;
php php php php php php php php php$groupphp-php>setFormphp(php$thisphp)php;

php php php php php php php php ifphp php(php!emptyphp(php$thisphp-php>php_displayGroupPrefixPathsphp)php)php php{
php php php php php php php php php php php php php$thisphp-php>php_displayGroupsphp[php$namephp]php-php>addPrefixPathsphp(php$thisphp-php>php_displayGroupPrefixPathsphp)php;
php php php php php php php php php}

php php php php php php php php php$thisphp-php>php_orderphp[php$namephp]php php=php php$thisphp-php>php_displayGroupsphp[php$namephp]php-php>getOrderphp(php)php;
php php php php php php php php php$thisphp-php>php_orderUpdatedphp php=php truephp;
php php php php php php php php returnphp php$thisphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Addphp multiplephp displayphp groupsphp atphp once
php php php php php php*
php php php php php php*php php@paramphp php arrayphp php$groups
php php php php php php*php php@returnphp Zendphp_Form
php php php php php php*php/
php php php php publicphp functionphp addDisplayGroupsphp(arrayphp php$groupsphp)
php php php php php{
php php php php php php php php foreachphp php(php$groupsphp asphp php$keyphp php=php>php php$specphp)php php{
php php php php php php php php php php php php php$namephp php=php nullphp;
php php php php php php php php php php php php ifphp php(php!isphp_numericphp(php$keyphp)php)php php{
php php php php php php php php php php php php php php php php php$namephp php=php php$keyphp;
php php php php php php php php php php php php php}

php php php php php php php php php php php php ifphp php(php$specphp instanceofphp Zendphp_Formphp_DisplayGroupphp)php php{
php php php php php php php php php php php php php php php php php$thisphp-php>php_addDisplayGroupObjectphp(php$specphp)php;
php php php php php php php php php php php php php}

php php php php php php php php php php php php ifphp php(php!isphp_arrayphp(php$specphp)php php|php|php emptyphp(php$specphp)php)php php{
php php php php php php php php php php php php php php php php continuephp;
php php php php php php php php php php php php php}

php php php php php php php php php php php php php$argcphp php php php php=php countphp(php$specphp)php;
php php php php php php php php php php php php php$optionsphp php=php arrayphp(php)php;

php php php php php php php php php php php php ifphp php(issetphp(php$specphp[php'elementsphp'php]php)php)php php{
php php php php php php php php php php php php php php php php php$elementsphp php=php php$specphp[php'elementsphp'php]php;
php php php php php php php php php php php php php php php php ifphp php(issetphp(php$specphp[php'namephp'php]php)php)php php{
php php php php php php php php php php php php php php php php php php php php php$namephp php=php php$specphp[php'namephp'php]php;
php php php php php php php php php php php php php php php php php}
php php php php php php php php php php php php php php php php ifphp php(issetphp(php$specphp[php'optionsphp'php]php)php)php php{
php php php php php php php php php php php php php php php php php php php php php$optionsphp php=php php$specphp[php'optionsphp'php]php;
php php php php php php php php php php php php php php php php php}
php php php php php php php php php php php php php php php php php$thisphp-php>addDisplayGroupphp(php$elementsphp,php php$namephp,php php$optionsphp)php;
php php php php php php php php php php php php php}php elsephp php{
php php php php php php php php php php php php php php php php switchphp php(php$argcphp)php php{
php php php php php php php php php php php php php php php php php php php php casephp php(php1php <php=php php$argcphp)php:
php php php php php php php php php php php php php php php php php php php php php php php php php$elementsphp php=php arrayphp_shiftphp(php$specphp)php;
php php php php php php php php php php php php php php php php php php php php php php php php ifphp php(php!isphp_arrayphp(php$elementsphp)php php&php&php php(nullphp php!php=php=php php$namephp)php)php php{
php php php php php php php php php php php php php php php php php php php php php php php php php php php php php$elementsphp php=php arrayphp_mergephp(php(arrayphp)php php$elementsphp,php php$specphp)php;
php php php php php php php php php php php php php php php php php php php php php php php php php php php php php$thisphp-php>addDisplayGroupphp(php$elementsphp,php php$namephp)php;
php php php php php php php php php php php php php php php php php php php php php php php php php php php php breakphp;
php php php php php php php php php php php php php php php php php php php php php php php php php}
php php php php php php php php php php php php php php php php php php php php casephp php(php2php <php=php php$argcphp)php:
php php php php php php php php php php php php php php php php php php php php php php php php ifphp php(nullphp php!php=php=php php$namephp)php php{
php php php php php php php php php php php php php php php php php php php php php php php php php php php php php$optionsphp php=php arrayphp_shiftphp(php$specphp)php;
php php php php php php php php php php php php php php php php php php php php php php php php php php php php php$thisphp-php>addDisplayGroupphp(php$elementsphp,php php$namephp,php php$optionsphp)php;
php php php php php php php php php php php php php php php php php php php php php php php php php php php php breakphp;
php php php php php php php php php php php php php php php php php php php php php php php php php}
php php php php php php php php php php php php php php php php php php php php php php php php php$namephp php=php arrayphp_shiftphp(php$specphp)php;
php php php php php php php php php php php php php php php php php php php php casephp php(php3php <php=php php$argcphp)php:
php php php php php php php php php php php php php php php php php php php php php php php php php$optionsphp php=php arrayphp_shiftphp(php$specphp)php;
php php php php php php php php php php php php php php php php php php php php defaultphp:
php php php php php php php php php php php php php php php php php php php php php php php php php$thisphp-php>addDisplayGroupphp(php$elementsphp,php php$namephp,php php$optionsphp)php;
php php php php php php php php php php php php php php php php php}
php php php php php php php php php php php php php}
php php php php php php php php php}
php php php php php php php php returnphp php$thisphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Addphp multiplephp displayphp groupsphp php(overwritesphp)
php php php php php php*
php php php php php php*php php@paramphp php arrayphp php$groups
php php php php php php*php php@returnphp Zendphp_Form
php php php php php php*php/
php php php php publicphp functionphp setDisplayGroupsphp(arrayphp php$groupsphp)
php php php php php{
php php php php php php php php returnphp php$thisphp-php>clearDisplayGroupsphp(php)
php php php php php php php php php php php php php php php php php php php php php-php>addDisplayGroupsphp(php$groupsphp)php;
php php php php php}

php php php php php/php*php*
php php php php php php*php Returnphp aphp displayphp group
php php php php php php*
php php php php php php*php php@paramphp php stringphp php$name
php php php php php php*php php@returnphp Zendphp_Formphp_DisplayGroupphp|null
php php php php php php*php/
php php php php publicphp functionphp getDisplayGroupphp(php$namephp)
php php php php php{
php php php php php php php php php$namephp php=php php(stringphp)php php$namephp;
php php php php php php php php ifphp php(issetphp(php$thisphp-php>php_displayGroupsphp[php$namephp]php)php)php php{
php php php php php php php php php php php php returnphp php$thisphp-php>php_displayGroupsphp[php$namephp]php;
php php php php php php php php php}

php php php php php php php php returnphp nullphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Returnphp allphp displayphp groups
php php php php php php*
php php php php php php*php php@returnphp array
php php php php php php*php/
php php php php publicphp functionphp getDisplayGroupsphp(php)
php php php php php{
php php php php php php php php returnphp php$thisphp-php>php_displayGroupsphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Removephp aphp displayphp groupphp byphp name
php php php php php php*
php php php php php php*php php@paramphp php stringphp php$name
php php php php php php*php php@returnphp boolean
php php php php php php*php/
php php php php publicphp functionphp removeDisplayGroupphp(php$namephp)
php php php php php{
php php php php php php php php php$namephp php=php php(stringphp)php php$namephp;
php php php php php php php php ifphp php(arrayphp_keyphp_existsphp(php$namephp,php php$thisphp-php>php_displayGroupsphp)php)php php{
php php php php php php php php php php php php foreachphp php(php$thisphp-php>php_displayGroupsphp[php$namephp]php asphp php$keyphp php=php>php php$elementphp)php php{
php php php php php php php php php php php php php php php php ifphp php(arrayphp_keyphp_existsphp(php$keyphp,php php$thisphp-php>php_elementsphp)php)php php{
php php php php php php php php php php php php php php php php php php php php php$thisphp-php>php_orderphp[php$keyphp]php php php=php php$elementphp-php>getOrderphp(php)php;
php php php php php php php php php php php php php php php php php php php php php$thisphp-php>php_orderUpdatedphp php=php truephp;
php php php php php php php php php php php php php php php php php}
php php php php php php php php php php php php php}
php php php php php php php php php php php php unsetphp(php$thisphp-php>php_displayGroupsphp[php$namephp]php)php;

php php php php php php php php php php php php ifphp php(arrayphp_keyphp_existsphp(php$namephp,php php$thisphp-php>php_orderphp)php)php php{
php php php php php php php php php php php php php php php php unsetphp(php$thisphp-php>php_orderphp[php$namephp]php)php;
php php php php php php php php php php php php php php php php php$thisphp-php>php_orderUpdatedphp php=php truephp;
php php php php php php php php php php php php php}
php php php php php php php php php php php php returnphp truephp;
php php php php php php php php php}

php php php php php php php php returnphp falsephp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Removephp allphp displayphp groups
php php php php php php*
php php php php php php*php php@returnphp Zendphp_Form
php php php php php php*php/
php php php php publicphp functionphp clearDisplayGroupsphp(php)
php php php php php{
php php php php php php php php foreachphp php(php$thisphp-php>php_displayGroupsphp asphp php$keyphp php=php>php php$groupphp)php php{
php php php php php php php php php php php php ifphp php(arrayphp_keyphp_existsphp(php$keyphp,php php$thisphp-php>php_orderphp)php)php php{
php php php php php php php php php php php php php php php php unsetphp(php$thisphp-php>php_orderphp[php$keyphp]php)php;
php php php php php php php php php php php php php}
php php php php php php php php php php php php foreachphp php(php$groupphp asphp php$namephp php=php>php php$elementphp)php php{
php php php php php php php php php php php php php php php php ifphp php(issetphp(php$thisphp-php>php_elementsphp[php$namephp]php)php)php php{
php php php php php php php php php php php php php php php php php php php php php$thisphp-php>php_orderphp[php$namephp]php php=php php$elementphp-php>getOrderphp(php)php;
php php php php php php php php php php php php php php php php php}
php php php php php php php php php php php php php php php php php$thisphp-php>php_orderphp[php$namephp]php php=php php$elementphp-php>getOrderphp(php)php;
php php php php php php php php php php php php php}
php php php php php php php php php}
php php php php php php php php php$thisphp-php>php_displayGroupsphp php=php arrayphp(php)php;
php php php php php php php php php$thisphp-php>php_orderUpdatedphp php php=php truephp;
php php php php php php php php returnphp php$thisphp;
php php php php php}


php php php php php/php/php Processing

php php php php php/php*php*
php php php php php php*php Populatephp form
php php php php php php*
php php php php php php*php Proxiesphp tophp php{php@linkphp setDefaultsphp(php)php}
php php php php php php*
php php php php php php*php php@paramphp php arrayphp php$values
php php php php php php*php php@returnphp Zendphp_Form
php php php php php php*php/
php php php php publicphp functionphp populatephp(arrayphp php$valuesphp)
php php php php php{
php php php php php php php php returnphp php$thisphp-php>setDefaultsphp(php$valuesphp)php;
php php php php php}

php php php php php/php*php*
php php php php php php*php Determinephp arrayphp keyphp namephp fromphp givenphp value
php php php php php php*
php php php php php php*php Givenphp aphp valuephp suchphp asphp foophp[barphp]php[bazphp]php,php returnsphp thephp lastphp elementphp php(inphp thisphp casephp,php php'bazphp'php)php.
php php php php php php*
php php php php php php*php php@paramphp php stringphp php$value
php php php php php php*php php@returnphp string
php php php php php php*php/
php php php php protectedphp functionphp php_getArrayNamephp(php$valuephp)
php php php php php{
php php php php php php php php ifphp php(php!isphp_stringphp(php$valuephp)php php|php|php php'php'php php=php=php=php php$valuephp)php php{
php php php php php php php php php php php php returnphp php$valuephp;
php php php php php php php php php}

php php php php php php php php ifphp php(php!strstrphp(php$valuephp,php php'php[php'php)php)php php{
php php php php php php php php php php php php returnphp php$valuephp;
php php php php php php php php php}

php php php php php php php php php$endPosphp php=php strlenphp(php$valuephp)php php-php php1php;
php php php php php php php php ifphp php(php'php]php'php php!php=php php$valuephp[php$endPosphp]php)php php{
php php php php php php php php php php php php returnphp php$valuephp;
php php php php php php php php php}

php php php php php php php php php$startphp php=php strrposphp(php$valuephp,php php'php[php'php)php php+php php1php;
php php php php php php php php php$namephp php=php substrphp(php$valuephp,php php$startphp,php php$endPosphp php-php php$startphp)php;
php php php php php php php php returnphp php$namephp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Extractphp thephp valuephp byphp walkingphp thephp arrayphp usingphp givenphp arrayphp pathphp.
php php php php php php*
php php php php php php*php Givenphp anphp arrayphp pathphp suchphp asphp foophp[barphp]php[bazphp]php,php returnsphp thephp valuephp ofphp thephp last
php php php php php php*php elementphp php(inphp thisphp casephp,php php'bazphp'php)php.
php php php php php php*
php php php php php php*php php@paramphp php arrayphp php$valuephp Arrayphp tophp walk
php php php php php php*php php@paramphp php stringphp php$arrayPathphp Arrayphp notationphp pathphp ofphp thephp partphp tophp extract
php php php php php php*php php@returnphp string
php php php php php php*php/
php php php php protectedphp functionphp php_dissolveArrayValuephp(php$valuephp,php php$arrayPathphp)
php php php php php{
php php php php php php php php php/php/php Asphp longphp asphp wephp havephp morephp levels
php php php php php php php php whilephp php(php$arrayPosphp php=php strposphp(php$arrayPathphp,php php'php[php'php)php)php php{
php php php php php php php php php php php php php/php/php Getphp thephp nextphp keyphp inphp thephp path
php php php php php php php php php php php php php$arrayKeyphp php=php trimphp(substrphp(php$arrayPathphp,php php0php,php php$arrayPosphp)php,php php'php]php'php)php;

php php php php php php php php php php php php php/php/php Setphp thephp potentiallyphp finalphp valuephp orphp thephp nextphp searchphp pointphp inphp thephp array
php php php php php php php php php php php php ifphp php(issetphp(php$valuephp[php$arrayKeyphp]php)php)php php{
php php php php php php php php php php php php php php php php php$valuephp php=php php$valuephp[php$arrayKeyphp]php;
php php php php php php php php php php php php php}

php php php php php php php php php php php php php/php/php Setphp thephp nextphp searchphp pointphp inphp thephp path
php php php php php php php php php php php php php$arrayPathphp php=php trimphp(substrphp(php$arrayPathphp,php php$arrayPosphp php+php php1php)php,php php'php]php'php)php;
php php php php php php php php php}

php php php php php php php php ifphp php(issetphp(php$valuephp[php$arrayPathphp]php)php)php php{
php php php php php php php php php php php php php$valuephp php=php php$valuephp[php$arrayPathphp]php;
php php php php php php php php php}

php php php php php php php php returnphp php$valuephp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Givenphp anphp arrayphp,php anphp optionalphp arrayPathphp andphp aphp keyphp thisphp method
php php php php php php*php dissolvesphp thephp arrayPathphp andphp unsetsphp thephp keyphp withinphp thephp array
php php php php php php*php ifphp itphp existsphp.
php php php php php php*
php php php php php php*php php@paramphp arrayphp php$array
php php php php php php*php php@paramphp stringphp|nullphp php$arrayPath
php php php php php php*php php@paramphp stringphp php$key
php php php php php php*php php@returnphp array
php php php php php php*php/
php php php php protectedphp functionphp php_dissolveArrayUnsetKeyphp(php$arrayphp,php php$arrayPathphp,php php$keyphp)
php php php php php{
php php php php php php php php php$unsetphp php=php&php php$arrayphp;
php php php php php php php php php$pathphp php php=php trimphp(strtrphp(php(stringphp)php$arrayPathphp,php arrayphp(php'php[php'php php=php>php php'php/php'php,php php'php]php'php php=php>php php'php'php)php)php,php php'php/php'php)php;
php php php php php php php php php$segsphp php php=php php(php'php'php php!php=php=php php$pathphp)php php?php explodephp(php'php/php'php,php php$pathphp)php php:php arrayphp(php)php;

php php php php php php php php foreachphp php(php$segsphp asphp php$segphp)php php{
php php php php php php php php php php php php ifphp php(php!arrayphp_keyphp_existsphp(php$segphp,php php(arrayphp)php$unsetphp)php)php php{
php php php php php php php php php php php php php php php php returnphp php$arrayphp;
php php php php php php php php php php php php php}
php php php php php php php php php php php php php$unsetphp php=php&php php$unsetphp[php$segphp]php;
php php php php php php php php php}
php php php php php php php php ifphp php(arrayphp_keyphp_existsphp(php$keyphp,php php(arrayphp)php$unsetphp)php)php php{
php php php php php php php php php php php php unsetphp(php$unsetphp[php$keyphp]php)php;
php php php php php php php php php}
php php php php php php php php returnphp php$arrayphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Convertsphp givenphp arrayPathphp tophp anphp arrayphp andphp attachesphp givenphp valuephp atphp thephp endphp ofphp itphp.
php php php php php php*
php php php php php php*php php@paramphp php mixedphp php$valuephp Thephp valuephp tophp attach
php php php php php php*php php@paramphp php stringphp php$arrayPathphp Givenphp arrayphp pathphp tophp convertphp andphp attachphp tophp.
php php php php php php*php php@returnphp array
php php php php php php*php/
php php php php protectedphp functionphp php_attachToArrayphp(php$valuephp,php php$arrayPathphp)
php php php php php{
php php php php php php php php php/php/php Asphp longphp asphp wephp havephp morephp levels
php php php php php php php php whilephp php(php$arrayPosphp php=php strrposphp(php$arrayPathphp,php php'php[php'php)php)php php{
php php php php php php php php php php php php php/php/php Getphp thephp nextphp keyphp inphp thephp path
php php php php php php php php php php php php php$arrayKeyphp php=php trimphp(substrphp(php$arrayPathphp,php php$arrayPosphp php+php php1php)php,php php'php]php'php)php;

php php php php php php php php php php php php php/php/php Attach
php php php php php php php php php php php php php$valuephp php=php arrayphp(php$arrayKeyphp php=php>php php$valuephp)php;

php php php php php php php php php php php php php/php/php Setphp thephp nextphp searchphp pointphp inphp thephp path
php php php php php php php php php php php php php$arrayPathphp php=php trimphp(substrphp(php$arrayPathphp,php php0php,php php$arrayPosphp)php,php php'php]php'php)php;
php php php php php php php php php}

php php php php php php php php php$valuephp php=php arrayphp(php$arrayPathphp php=php>php php$valuephp)php;

php php php php php php php php returnphp php$valuephp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Returnsphp aphp onephp dimensionalphp numericalphp indexedphp arrayphp withphp the
php php php php php php*php Elementsphp,php SubFormsphp andphp Elementsphp fromphp DisplayGroupsphp asphp Valuesphp.
php php php php php php*
php php php php php php*php Subitemsphp arephp insertedphp basedphp onphp theirphp orderphp Settingphp ifphp setphp,
php php php php php php*php otherwisephp theyphp arephp appendedphp,php thephp resultingphp numericalphp index
php php php php php php*php mayphp differphp fromphp thephp orderphp valuephp.
php php php php php php*
php php php php php php*php php@accessphp protected
php php php php php php*php php@returnphp array
php php php php php php*php/
php php php php publicphp functionphp getElementsAndSubFormsOrderedphp(php)
php php php php php{
php php php php php php php php php$orderedphp php=php arrayphp(php)php;
php php php php php php php php foreachphp php(php$thisphp-php>php_orderphp asphp php$namephp php=php>php php$orderphp)php php{
php php php php php php php php php php php php php$orderphp php=php issetphp(php$orderphp)php php?php php$orderphp php:php countphp(php$orderedphp)php;
php php php php php php php php php php php php ifphp php(php$thisphp-php>php$namephp instanceofphp Zendphp_Formphp_Elementphp php|php|
php php php php php php php php php php php php php php php php php$thisphp-php>php$namephp instanceofphp Zendphp_Formphp)php php{
php php php php php php php php php php php php php php php php arrayphp_splicephp(php$orderedphp,php php$orderphp,php php0php,php arrayphp(php$thisphp-php>php$namephp)php)php;
php php php php php php php php php php php php php}php elsephp ifphp php(php$thisphp-php>php$namephp instanceofphp Zendphp_Formphp_DisplayGroupphp)php php{
php php php php php php php php php php php php php php php php php$suborderedphp php=php arrayphp(php)php;
php php php php php php php php php php php php php php php php foreachphp php(php$thisphp-php>php$namephp-php>getElementsphp(php)php asphp php$elementphp)php php{
php php php php php php php php php php php php php php php php php php php php php$suborderphp php=php php$elementphp-php>getOrderphp(php)php;
php php php php php php php php php php php php php php php php php php php php php$suborderphp php=php php(nullphp php!php=php=php php$suborderphp)php php?php php$suborderphp php:php countphp(php$suborderedphp)php;
php php php php php php php php php php php php php php php php php php php php arrayphp_splicephp(php$suborderedphp,php php$suborderphp,php php0php,php arrayphp(php$elementphp)php)php;
php php php php php php php php php php php php php php php php php}
php php php php php php php php php php php php php php php php ifphp php(php!emptyphp(php$suborderedphp)php)php php{
php php php php php php php php php php php php php php php php php php php php arrayphp_splicephp(php$orderedphp,php php$orderphp,php php0php,php php$suborderedphp)php;
php php php php php php php php php php php php php php php php php}
php php php php php php php php php php php php php}
php php php php php php php php php}
php php php php php php php php returnphp php$orderedphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Thisphp isphp aphp helperphp functionphp untilphp phpphp php5php.php3php isphp widespreaded
php php php php php php*
php php php php php php*php php@paramphp arrayphp php$into
php php php php php php*php php@accessphp protected
php php php php php php*php php@returnphp void
php php php php php php*php/
php php php php protectedphp functionphp php_arrayphp_replacephp_recursivephp(arrayphp php$intophp)
php php php php php{
php php php php php php php php php$fromArraysphp php=php arrayphp_slicephp(funcphp_getphp_argsphp(php)php,php1php)php;

php php php php php php php php foreachphp php(php$fromArraysphp asphp php$fromphp)php php{
php php php php php php php php php php php php foreachphp php(php$fromphp asphp php$keyphp php=php>php php$valuephp)php php{
php php php php php php php php php php php php php php php php ifphp php(isphp_arrayphp(php$valuephp)php)php php{
php php php php php php php php php php php php php php php php php php php php ifphp php(php!issetphp(php$intophp[php$keyphp]php)php)php php{
php php php php php php php php php php php php php php php php php php php php php php php php php$intophp[php$keyphp]php php=php arrayphp(php)php;
php php php php php php php php php php php php php php php php php php php php php}
php php php php php php php php php php php php php php php php php php php php php$intophp[php$keyphp]php php=php php$thisphp-php>php_arrayphp_replacephp_recursivephp(php$intophp[php$keyphp]php,php php$fromphp[php$keyphp]php)php;
php php php php php php php php php php php php php php php php php}php elsephp php{
php php php php php php php php php php php php php php php php php php php php php$intophp[php$keyphp]php php=php php$valuephp;
php php php php php php php php php php php php php php php php php}
php php php php php php php php php php php php php}
php php php php php php php php php}
php php php php php php php php returnphp php$intophp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Validatephp thephp form
php php php php php php*
php php php php php php*php php@paramphp php arrayphp php$data
php php php php php php*php php@returnphp boolean
php php php php php php*php/
php php php php publicphp functionphp isValidphp(php$dataphp)
php php php php php{
php php php php php php php php ifphp php(php!isphp_arrayphp(php$dataphp)php)php php{
php php php php php php php php php php php php requirephp_oncephp php'Zendphp/Formphp/Exceptionphp.phpphp'php;
php php php php php php php php php php php php throwphp newphp Zendphp_Formphp_Exceptionphp(php_php_METHODphp_php_php php.php php'php expectsphp anphp arrayphp'php)php;
php php php php php php php php php}
php php php php php php php php php$translatorphp php=php php$thisphp-php>getTranslatorphp(php)php;
php php php php php php php php php$validphp php php php php php php=php truephp;
php php php php php php php php php$eBelongTophp php php=php nullphp;

php php php php php php php php ifphp php(php$thisphp-php>isArrayphp(php)php)php php{
php php php php php php php php php php php php php$eBelongTophp php=php php$thisphp-php>getElementsBelongTophp(php)php;
php php php php php php php php php php php php php$dataphp php=php php$thisphp-php>php_dissolveArrayValuephp(php$dataphp,php php$eBelongTophp)php;
php php php php php php php php php}
php php php php php php php php php$contextphp php=php php$dataphp;
php php php php php php php php foreachphp php(php$thisphp-php>getElementsphp(php)php asphp php$keyphp php=php>php php$elementphp)php php{
php php php php php php php php php php php php ifphp php(nullphp php!php=php=php php$translatorphp php&php&php php$thisphp-php>hasTranslatorphp(php)
php php php php php php php php php php php php php php php php php php php php php&php&php php!php$elementphp-php>hasTranslatorphp(php)php)php php{
php php php php php php php php php php php php php php php php php$elementphp-php>setTranslatorphp(php$translatorphp)php;
php php php php php php php php php php php php php}
php php php php php php php php php php php php php$checkphp php=php php$dataphp;
php php php php php php php php php php php php ifphp php(php(php$belongsTophp php=php php$elementphp-php>getBelongsTophp(php)php)php php!php=php=php php$eBelongTophp)php php{
php php php php php php php php php php php php php php php php php$checkphp php=php php$thisphp-php>php_dissolveArrayValuephp(php$dataphp,php php$belongsTophp)php;
php php php php php php php php php php php php php}
php php php php php php php php php php php php ifphp php(php!issetphp(php$checkphp[php$keyphp]php)php)php php{
php php php php php php php php php php php php php php php php php$validphp php=php php$elementphp-php>isValidphp(nullphp,php php$contextphp)php php&php&php php$validphp;
php php php php php php php php php php php php php}php elsephp php{
php php php php php php php php php php php php php php php php php$validphp php=php php$elementphp-php>isValidphp(php$checkphp[php$keyphp]php,php php$contextphp)php php&php&php php$validphp;
php php php php php php php php php php php php php php php php php$dataphp php=php php$thisphp-php>php_dissolveArrayUnsetKeyphp(php$dataphp,php php$belongsTophp,php php$keyphp)php;
php php php php php php php php php php php php php}
php php php php php php php php php}
php php php php php php php php foreachphp php(php$thisphp-php>getSubFormsphp(php)php asphp php$keyphp php=php>php php$formphp)php php{
php php php php php php php php php php php php ifphp php(nullphp php!php=php=php php$translatorphp php&php&php php!php$formphp-php>hasTranslatorphp(php)php)php php{
php php php php php php php php php php php php php php php php php$formphp-php>setTranslatorphp(php$translatorphp)php;
php php php php php php php php php php php php php}
php php php php php php php php php php php php ifphp php(issetphp(php$dataphp[php$keyphp]php)php php&php&php php!php$formphp-php>isArrayphp(php)php)php php{
php php php php php php php php php php php php php php php php php$validphp php=php php$formphp-php>isValidphp(php$dataphp[php$keyphp]php)php php&php&php php$validphp;
php php php php php php php php php php php php php}php elsephp php{
php php php php php php php php php php php php php php php php php$validphp php=php php$formphp-php>isValidphp(php$dataphp)php php&php&php php$validphp;
php php php php php php php php php php php php php}
php php php php php php php php php}

php php php php php php php php php$thisphp-php>php_errorsExistphp php=php php!php$validphp;

php php php php php php php php php/php/php Ifphp manuallyphp flaggedphp asphp anphp errorphp,php returnphp invalidphp status
php php php php php php php php ifphp php(php$thisphp-php>php_errorsForcedphp)php php{
php php php php php php php php php php php php returnphp falsephp;
php php php php php php php php php}

php php php php php php php php returnphp php$validphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Validatephp aphp partialphp form
php php php php php php*
php php php php php php*php Doesphp notphp checkphp forphp requiredphp flagsphp.
php php php php php php*
php php php php php php*php php@paramphp php arrayphp php$data
php php php php php php*php php@returnphp boolean
php php php php php php*php/
php php php php publicphp functionphp isValidPartialphp(arrayphp php$dataphp)
php php php php php{
php php php php php php php php php$eBelongTophp php php=php nullphp;

php php php php php php php php ifphp php(php$thisphp-php>isArrayphp(php)php)php php{
php php php php php php php php php php php php php$eBelongTophp php=php php$thisphp-php>getElementsBelongTophp(php)php;
php php php php php php php php php php php php php$dataphp php=php php$thisphp-php>php_dissolveArrayValuephp(php$dataphp,php php$eBelongTophp)php;
php php php php php php php php php}

php php php php php php php php php$translatorphp php=php php$thisphp-php>getTranslatorphp(php)php;
php php php php php php php php php$validphp php php php php php php=php truephp;
php php php php php php php php php$contextphp php php php php=php php$dataphp;

php php php php php php php php foreachphp php(php$thisphp-php>getElementsphp(php)php asphp php$keyphp php=php>php php$elementphp)php php{
php php php php php php php php php php php php php$checkphp php=php php$dataphp;
php php php php php php php php php php php php ifphp php(php(php$belongsTophp php=php php$elementphp-php>getBelongsTophp(php)php)php php!php=php=php php$eBelongTophp)php php{
php php php php php php php php php php php php php php php php php$checkphp php=php php$thisphp-php>php_dissolveArrayValuephp(php$dataphp,php php$belongsTophp)php;
php php php php php php php php php php php php php}
php php php php php php php php php php php php ifphp php(issetphp(php$checkphp[php$keyphp]php)php)php php{
php php php php php php php php php php php php php php php php ifphp php(nullphp php!php=php=php php$translatorphp php&php&php php!php$elementphp-php>hasTranslatorphp(php)php)php php{
php php php php php php php php php php php php php php php php php php php php php$elementphp-php>setTranslatorphp(php$translatorphp)php;
php php php php php php php php php php php php php php php php php}
php php php php php php php php php php php php php php php php php$validphp php=php php$elementphp-php>isValidphp(php$checkphp[php$keyphp]php,php php$contextphp)php php&php&php php$validphp;
php php php php php php php php php php php php php php php php php$dataphp php=php php$thisphp-php>php_dissolveArrayUnsetKeyphp(php$dataphp,php php$belongsTophp,php php$keyphp)php;
php php php php php php php php php php php php php}
php php php php php php php php php}
php php php php php php php php foreachphp php(php$thisphp-php>getSubFormsphp(php)php asphp php$keyphp php=php>php php$formphp)php php{
php php php php php php php php php php php php ifphp php(nullphp php!php=php=php php$translatorphp php&php&php php!php$formphp-php>hasTranslatorphp(php)php)php php{
php php php php php php php php php php php php php php php php php$formphp-php>setTranslatorphp(php$translatorphp)php;
php php php php php php php php php php php php php}
php php php php php php php php php php php php ifphp php(issetphp(php$dataphp[php$keyphp]php)php php&php&php php!php$formphp-php>isArrayphp(php)php)php php{
php php php php php php php php php php php php php php php php php$validphp php=php php$formphp-php>isValidPartialphp(php$dataphp[php$keyphp]php)php php&php&php php$validphp;
php php php php php php php php php php php php php}php elsephp php{
php php php php php php php php php php php php php php php php php$validphp php=php php$formphp-php>isValidPartialphp(php$dataphp)php php&php&php php$validphp;
php php php php php php php php php php php php php}
php php php php php php php php php}

php php php php php php php php php$thisphp-php>php_errorsExistphp php=php php!php$validphp;
php php php php php php php php returnphp php$validphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Processphp submittedphp AJAXphp data
php php php php php php*
php php php php php php*php Checksphp ifphp providedphp php$dataphp isphp validphp,php viaphp php{php@linkphp isValidPartialphp(php)php}php.php Ifphp sophp,
php php php php php php*php itphp returnsphp JSONphp-encodedphp booleanphp truephp.php Ifphp notphp,php itphp returnsphp JSONphp-encoded
php php php php php php*php errorphp messagesphp php(asphp returnedphp byphp php{php@linkphp getMessagesphp(php)php}php)php.
php php php php php php*
php php php php php php*php php@paramphp php arrayphp php$data
php php php php php php*php php@returnphp stringphp JSONphp-encodedphp booleanphp truephp orphp errorphp messages
php php php php php php*php/
php php php php publicphp functionphp processAjaxphp(arrayphp php$dataphp)
php php php php php{
php php php php php php php php requirephp_oncephp php'Zendphp/Jsonphp.phpphp'php;
php php php php php php php php ifphp php(php$thisphp-php>isValidPartialphp(php$dataphp)php)php php{
php php php php php php php php php php php php returnphp Zendphp_Jsonphp:php:encodephp(truephp)php;
php php php php php php php php php}
php php php php php php php php php$messagesphp php=php php$thisphp-php>getMessagesphp(php)php;
php php php php php php php php returnphp Zendphp_Jsonphp:php:encodephp(php$messagesphp)php;
php php php php php}

php php php php php/php*php*
php php php php php php*php Addphp aphp customphp errorphp messagephp tophp returnphp inphp thephp eventphp ofphp failedphp validation
php php php php php php*
php php php php php php*php php@paramphp php stringphp php$message
php php php php php php*php php@returnphp Zendphp_Form
php php php php php php*php/
php php php php publicphp functionphp addErrorMessagephp(php$messagephp)
php php php php php{
php php php php php php php php php$thisphp-php>php_errorMessagesphp[php]php php=php php(stringphp)php php$messagephp;
php php php php php php php php returnphp php$thisphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Addphp multiplephp customphp errorphp messagesphp tophp returnphp inphp thephp eventphp ofphp failedphp validation
php php php php php php*
php php php php php php*php php@paramphp php arrayphp php$messages
php php php php php php*php php@returnphp Zendphp_Form
php php php php php php*php/
php php php php publicphp functionphp addErrorMessagesphp(arrayphp php$messagesphp)
php php php php php{
php php php php php php php php foreachphp php(php$messagesphp asphp php$messagephp)php php{
php php php php php php php php php php php php php$thisphp-php>addErrorMessagephp(php$messagephp)php;
php php php php php php php php php}
php php php php php php php php returnphp php$thisphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Samephp asphp addErrorMessagesphp(php)php,php butphp clearsphp customphp errorphp messagephp stackphp first
php php php php php php*
php php php php php php*php php@paramphp php arrayphp php$messages
php php php php php php*php php@returnphp Zendphp_Form
php php php php php php*php/
php php php php publicphp functionphp setErrorMessagesphp(arrayphp php$messagesphp)
php php php php php{
php php php php php php php php php$thisphp-php>clearErrorMessagesphp(php)php;
php php php php php php php php returnphp php$thisphp-php>addErrorMessagesphp(php$messagesphp)php;
php php php php php}

php php php php php/php*php*
php php php php php php*php Retrievephp customphp errorphp messages
php php php php php php*
php php php php php php*php php@returnphp array
php php php php php php*php/
php php php php publicphp functionphp getErrorMessagesphp(php)
php php php php php{
php php php php php php php php returnphp php$thisphp-php>php_errorMessagesphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Clearphp customphp errorphp messagesphp stack
php php php php php php*
php php php php php php*php php@returnphp Zendphp_Form
php php php php php php*php/
php php php php publicphp functionphp clearErrorMessagesphp(php)
php php php php php{
php php php php php php php php php$thisphp-php>php_errorMessagesphp php=php arrayphp(php)php;
php php php php php php php php returnphp php$thisphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Markphp thephp elementphp asphp beingphp inphp aphp failedphp validationphp state
php php php php php php*
php php php php php php*php php@returnphp Zendphp_Form
php php php php php php*php/
php php php php publicphp functionphp markAsErrorphp(php)
php php php php php{
php php php php php php php php php$thisphp-php>php_errorsExistphp php php=php truephp;
php php php php php php php php php$thisphp-php>php_errorsForcedphp php=php truephp;
php php php php php php php php returnphp php$thisphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Addphp anphp errorphp messagephp andphp markphp elementphp asphp failedphp validation
php php php php php php*
php php php php php php*php php@paramphp php stringphp php$message
php php php php php php*php php@returnphp Zendphp_Form
php php php php php php*php/
php php php php publicphp functionphp addErrorphp(php$messagephp)
php php php php php{
php php php php php php php php php$thisphp-php>addErrorMessagephp(php$messagephp)php;
php php php php php php php php php$thisphp-php>markAsErrorphp(php)php;
php php php php php php php php returnphp php$thisphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Addphp multiplephp errorphp messagesphp andphp flagphp elementphp asphp failedphp validation
php php php php php php*
php php php php php php*php php@paramphp php arrayphp php$messages
php php php php php php*php php@returnphp Zendphp_Form
php php php php php php*php/
php php php php publicphp functionphp addErrorsphp(arrayphp php$messagesphp)
php php php php php{
php php php php php php php php foreachphp php(php$messagesphp asphp php$messagephp)php php{
php php php php php php php php php php php php php$thisphp-php>addErrorphp(php$messagephp)php;
php php php php php php php php php}
php php php php php php php php returnphp php$thisphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Overwritephp anyphp previouslyphp setphp errorphp messagesphp andphp flagphp asphp failedphp validation
php php php php php php*
php php php php php php*php php@paramphp php arrayphp php$messages
php php php php php php*php php@returnphp Zendphp_Form
php php php php php php*php/
php php php php publicphp functionphp setErrorsphp(arrayphp php$messagesphp)
php php php php php{
php php php php php php php php php$thisphp-php>clearErrorMessagesphp(php)php;
php php php php php php php php returnphp php$thisphp-php>addErrorsphp(php$messagesphp)php;
php php php php php}


php php php php publicphp functionphp persistDataphp(php)
php php php php php{
php php php php php}

php php php php php/php*php*
php php php php php php*php Arephp therephp errorsphp inphp thephp formphp?
php php php php php php*
php php php php php php*php php@returnphp bool
php php php php php php*php/
php php php php publicphp functionphp isErrorsphp(php)
php php php php php{
php php php php php php php php returnphp php$thisphp-php>php_errorsExistphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Getphp errorphp codesphp forphp allphp elementsphp failingphp validation
php php php php php php*
php php php php php php*php php@paramphp php stringphp php$name
php php php php php php*php php@returnphp array
php php php php php php*php/
php php php php publicphp functionphp getErrorsphp(php$namephp php=php nullphp,php php$suppressArrayNotationphp php=php falsephp)
php php php php php{
php php php php php php php php php$errorsphp php=php arrayphp(php)php;
php php php php php php php php ifphp php(nullphp php!php=php=php php$namephp)php php{
php php php php php php php php php php php php ifphp php(issetphp(php$thisphp-php>php_elementsphp[php$namephp]php)php)php php{
php php php php php php php php php php php php php php php php returnphp php$thisphp-php>getElementphp(php$namephp)php-php>getErrorsphp(php)php;
php php php php php php php php php php php php php}php elsephp ifphp php(issetphp(php$thisphp-php>php_subFormsphp[php$namephp]php)php)php php{
php php php php php php php php php php php php php php php php returnphp php$thisphp-php>getSubFormphp(php$namephp)php-php>getErrorsphp(nullphp,php truephp)php;
php php php php php php php php php php php php php}
php php php php php php php php php}

php php php php php php php php foreachphp php(php$thisphp-php>php_elementsphp asphp php$keyphp php=php>php php$elementphp)php php{
php php php php php php php php php php php php php$errorsphp[php$keyphp]php php=php php$elementphp-php>getErrorsphp(php)php;
php php php php php php php php php}
php php php php php php php php foreachphp php(php$thisphp-php>getSubFormsphp(php)php asphp php$keyphp php=php>php php$subFormphp)php php{
php php php php php php php php php php php php php$mergephp php=php arrayphp(php)php;
php php php php php php php php php php php php ifphp php(php!php$subFormphp-php>isArrayphp(php)php)php php{
php php php php php php php php php php php php php php php php php$mergephp[php$keyphp]php php=php php$subFormphp-php>getErrorsphp(php)php;
php php php php php php php php php php php php php}php elsephp php{
php php php php php php php php php php php php php php php php php$mergephp php=php php$thisphp-php>php_attachToArrayphp(php$subFormphp-php>getErrorsphp(nullphp,php truephp)php,
php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php$subFormphp-php>getElementsBelongTophp(php)php)php;
php php php php php php php php php php php php php}
php php php php php php php php php php php php php$errorsphp php=php php$thisphp-php>php_arrayphp_replacephp_recursivephp(php$errorsphp,php php$mergephp)php;
php php php php php php php php php}

php php php php php php php php ifphp php(php!php$suppressArrayNotationphp php&php&
php php php php php php php php php php php php php$thisphp-php>isArrayphp(php)php php&php&
php php php php php php php php php php php php php!php$thisphp-php>php_getIsRenderedphp(php)php)php php{
php php php php php php php php php php php php php$errorsphp php=php php$thisphp-php>php_attachToArrayphp(php$errorsphp,php php$thisphp-php>getElementsBelongTophp(php)php)php;
php php php php php php php php php}

php php php php php php php php returnphp php$errorsphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Retrievephp errorphp messagesphp fromphp elementsphp failingphp validations
php php php php php php*
php php php php php php*php php@paramphp php stringphp php$name
php php php php php php*php php@paramphp php boolphp php$suppressArrayNotation
php php php php php php*php php@returnphp array
php php php php php php*php/
php php php php publicphp functionphp getMessagesphp(php$namephp php=php nullphp,php php$suppressArrayNotationphp php=php falsephp)
php php php php php{
php php php php php php php php ifphp php(nullphp php!php=php=php php$namephp)php php{
php php php php php php php php php php php php ifphp php(issetphp(php$thisphp-php>php_elementsphp[php$namephp]php)php)php php{
php php php php php php php php php php php php php php php php returnphp php$thisphp-php>getElementphp(php$namephp)php-php>getMessagesphp(php)php;
php php php php php php php php php php php php php}php elsephp ifphp php(issetphp(php$thisphp-php>php_subFormsphp[php$namephp]php)php)php php{
php php php php php php php php php php php php php php php php returnphp php$thisphp-php>getSubFormphp(php$namephp)php-php>getMessagesphp(nullphp,php truephp)php;
php php php php php php php php php php php php php}
php php php php php php php php php php php php foreachphp php(php$thisphp-php>getSubFormsphp(php)php asphp php$keyphp php=php>php php$subFormphp)php php{
php php php php php php php php php php php php php php php php ifphp php(php$subFormphp-php>isArrayphp(php)php)php php{
php php php php php php php php php php php php php php php php php php php php php$belongTophp php=php php$subFormphp-php>getElementsBelongTophp(php)php;
php php php php php php php php php php php php php php php php php php php php ifphp php(php$namephp php=php=php php$thisphp-php>php_getArrayNamephp(php$belongTophp)php)php php{
php php php php php php php php php php php php php php php php php php php php php php php php returnphp php$subFormphp-php>getMessagesphp(nullphp,php truephp)php;
php php php php php php php php php php php php php php php php php php php php php}
php php php php php php php php php php php php php php php php php}
php php php php php php php php php php php php php}
php php php php php php php php php}

php php php php php php php php php$customMessagesphp php=php php$thisphp-php>php_getErrorMessagesphp(php)php;
php php php php php php php php ifphp php(php$thisphp-php>isErrorsphp(php)php php&php&php php!emptyphp(php$customMessagesphp)php)php php{
php php php php php php php php php php php php returnphp php$customMessagesphp;
php php php php php php php php php}

php php php php php php php php php$messagesphp php=php arrayphp(php)php;

php php php php php php php php foreachphp php(php$thisphp-php>getElementsphp(php)php asphp php$namephp php=php>php php$elementphp)php php{
php php php php php php php php php php php php php$eMessagesphp php=php php$elementphp-php>getMessagesphp(php)php;
php php php php php php php php php php php php ifphp php(php!emptyphp(php$eMessagesphp)php)php php{
php php php php php php php php php php php php php php php php php$messagesphp[php$namephp]php php=php php$eMessagesphp;
php php php php php php php php php php php php php}
php php php php php php php php php}

php php php php php php php php foreachphp php(php$thisphp-php>getSubFormsphp(php)php asphp php$keyphp php=php>php php$subFormphp)php php{
php php php php php php php php php php php php php$mergephp php=php php$subFormphp-php>getMessagesphp(nullphp,php truephp)php;
php php php php php php php php php php php php ifphp php(php!emptyphp(php$mergephp)php)php php{
php php php php php php php php php php php php php php php php ifphp php(php!php$subFormphp-php>isArrayphp(php)php)php php{
php php php php php php php php php php php php php php php php php php php php php$mergephp php=php arrayphp(php$keyphp php=php>php php$mergephp)php;
php php php php php php php php php php php php php php php php php}php elsephp php{
php php php php php php php php php php php php php php php php php php php php php$mergephp php=php php$thisphp-php>php_attachToArrayphp(php$mergephp,
php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php$subFormphp-php>getElementsBelongTophp(php)php)php;
php php php php php php php php php php php php php php php php php}
php php php php php php php php php php php php php php php php php$messagesphp php=php php$thisphp-php>php_arrayphp_replacephp_recursivephp(php$messagesphp,php php$mergephp)php;
php php php php php php php php php php php php php}
php php php php php php php php php}

php php php php php php php php ifphp php(php!php$suppressArrayNotationphp php&php&
php php php php php php php php php php php php php$thisphp-php>isArrayphp(php)php php&php&
php php php php php php php php php php php php php!php$thisphp-php>php_getIsRenderedphp(php)php)php php{
php php php php php php php php php php php php php$messagesphp php=php php$thisphp-php>php_attachToArrayphp(php$messagesphp,php php$thisphp-php>getElementsBelongTophp(php)php)php;
php php php php php php php php php}

php php php php php php php php returnphp php$messagesphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Retrievephp translatedphp customphp errorphp messages
php php php php php php*php Proxiesphp tophp php{php@linkphp php_getErrorMessagesphp(php)php}php.
php php php php php php*
php php php php php php*php php@returnphp array
php php php php php php*php/
php php php php publicphp functionphp getCustomMessagesphp(php)
php php php php php{
php php php php php php php php returnphp php$thisphp-php>php_getErrorMessagesphp(php)php;
php php php php php}


php php php php php/php/php Rendering

php php php php php/php*php*
php php php php php php*php Setphp viewphp object
php php php php php php*
php php php php php php*php php@paramphp php Zendphp_Viewphp_Interfacephp php$view
php php php php php php*php php@returnphp Zendphp_Form
php php php php php php*php/
php php php php publicphp functionphp setViewphp(Zendphp_Viewphp_Interfacephp php$viewphp php=php nullphp)
php php php php php{
php php php php php php php php php$thisphp-php>php_viewphp php=php php$viewphp;
php php php php php php php php returnphp php$thisphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Retrievephp viewphp object
php php php php php php*
php php php php php php*php Ifphp nonephp registeredphp,php attemptsphp tophp pullphp fromphp ViewRendererphp.
php php php php php php*
php php php php php php*php php@returnphp Zendphp_Viewphp_Interfacephp|null
php php php php php php*php/
php php php php publicphp functionphp getViewphp(php)
php php php php php{
php php php php php php php php ifphp php(nullphp php=php=php=php php$thisphp-php>php_viewphp)php php{
php php php php php php php php php php php php requirephp_oncephp php'Zendphp/Controllerphp/Actionphp/HelperBrokerphp.phpphp'php;
php php php php php php php php php php php php php$viewRendererphp php=php Zendphp_Controllerphp_Actionphp_HelperBrokerphp:php:getStaticHelperphp(php'viewRendererphp'php)php;
php php php php php php php php php php php php php$thisphp-php>setViewphp(php$viewRendererphp-php>viewphp)php;
php php php php php php php php php}

php php php php php php php php returnphp php$thisphp-php>php_viewphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Instantiatephp aphp decoratorphp basedphp onphp classphp namephp orphp classphp namephp fragment
php php php php php php*
php php php php php php*php php@paramphp php stringphp php$name
php php php php php php*php php@paramphp php nullphp|arrayphp php$options
php php php php php php*php php@returnphp Zendphp_Formphp_Decoratorphp_Interface
php php php php php php*php/
php php php php protectedphp functionphp php_getDecoratorphp(php$namephp,php php$optionsphp)
php php php php php{
php php php php php php php php php$classphp php=php php$thisphp-php>getPluginLoaderphp(selfphp:php:DECORATORphp)php-php>loadphp(php$namephp)php;
php php php php php php php php ifphp php(nullphp php=php=php=php php$optionsphp)php php{
php php php php php php php php php php php php php$decoratorphp php=php newphp php$classphp;
php php php php php php php php php}php elsephp php{
php php php php php php php php php php php php php$decoratorphp php=php newphp php$classphp(php$optionsphp)php;
php php php php php php php php php}

php php php php php php php php returnphp php$decoratorphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Addphp aphp decoratorphp forphp renderingphp thephp element
php php php php php php*
php php php php php php*php php@paramphp php stringphp|Zendphp_Formphp_Decoratorphp_Interfacephp php$decorator
php php php php php php*php php@paramphp php arrayphp|Zendphp_Configphp php$optionsphp Optionsphp withphp whichphp tophp initializephp decorator
php php php php php php*php php@returnphp Zendphp_Form
php php php php php php*php/
php php php php publicphp functionphp addDecoratorphp(php$decoratorphp,php php$optionsphp php=php nullphp)
php php php php php{
php php php php php php php php ifphp php(php$decoratorphp instanceofphp Zendphp_Formphp_Decoratorphp_Interfacephp)php php{
php php php php php php php php php php php php php$namephp php=php getphp_classphp(php$decoratorphp)php;
php php php php php php php php php}php elseifphp php(isphp_stringphp(php$decoratorphp)php)php php{
php php php php php php php php php php php php php$namephp php php php php php php=php php$decoratorphp;
php php php php php php php php php php php php php$decoratorphp php=php arrayphp(
php php php php php php php php php php php php php php php php php'decoratorphp'php php=php>php php$namephp,
php php php php php php php php php php php php php php php php php'optionsphp'php php php php=php>php php$optionsphp,
php php php php php php php php php php php php php)php;
php php php php php php php php php}php elseifphp php(isphp_arrayphp(php$decoratorphp)php)php php{
php php php php php php php php php php php php foreachphp php(php$decoratorphp asphp php$namephp php=php>php php$specphp)php php{
php php php php php php php php php php php php php php php php breakphp;
php php php php php php php php php php php php php}
php php php php php php php php php php php php ifphp php(isphp_numericphp(php$namephp)php)php php{
php php php php php php php php php php php php php php php php requirephp_oncephp php'Zendphp/Formphp/Exceptionphp.phpphp'php;
php php php php php php php php php php php php php php php php throwphp newphp Zendphp_Formphp_Exceptionphp(php'Invalidphp aliasphp providedphp tophp addDecoratorphp;php mustphp bephp alphanumericphp stringphp'php)php;
php php php php php php php php php php php php php}
php php php php php php php php php php php php ifphp php(isphp_stringphp(php$specphp)php)php php{
php php php php php php php php php php php php php php php php php$decoratorphp php=php arrayphp(
php php php php php php php php php php php php php php php php php php php php php'decoratorphp'php php=php>php php$specphp,
php php php php php php php php php php php php php php php php php php php php php'optionsphp'php php php php=php>php php$optionsphp,
php php php php php php php php php php php php php php php php php)php;
php php php php php php php php php php php php php}php elseifphp php(php$specphp instanceofphp Zendphp_Formphp_Decoratorphp_Interfacephp)php php{
php php php php php php php php php php php php php php php php php$decoratorphp php=php php$specphp;
php php php php php php php php php php php php php}
php php php php php php php php php}php elsephp php{
php php php php php php php php php php php php requirephp_oncephp php'Zendphp/Formphp/Exceptionphp.phpphp'php;
php php php php php php php php php php php php throwphp newphp Zendphp_Formphp_Exceptionphp(php'Invalidphp decoratorphp providedphp tophp addDecoratorphp;php mustphp bephp stringphp orphp Zendphp_Formphp_Decoratorphp_Interfacephp'php)php;
php php php php php php php php php}

php php php php php php php php php$thisphp-php>php_decoratorsphp[php$namephp]php php=php php$decoratorphp;

php php php php php php php php returnphp php$thisphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Addphp manyphp decoratorsphp atphp once
php php php php php php*
php php php php php php*php php@paramphp php arrayphp php$decorators
php php php php php php*php php@returnphp Zendphp_Form
php php php php php php*php/
php php php php publicphp functionphp addDecoratorsphp(arrayphp php$decoratorsphp)
php php php php php{
php php php php php php php php foreachphp php(php$decoratorsphp asphp php$decoratorNamephp php=php>php php$decoratorInfophp)php php{
php php php php php php php php php php php php ifphp php(isphp_stringphp(php$decoratorInfophp)php php|php|
php php php php php php php php php php php php php php php php php$decoratorInfophp instanceofphp Zendphp_Formphp_Decoratorphp_Interfacephp)php php{
php php php php php php php php php php php php php php php php ifphp php(php!isphp_numericphp(php$decoratorNamephp)php)php php{
php php php php php php php php php php php php php php php php php php php php php$thisphp-php>addDecoratorphp(arrayphp(php$decoratorNamephp php=php>php php$decoratorInfophp)php)php;
php php php php php php php php php php php php php php php php php}php elsephp php{
php php php php php php php php php php php php php php php php php php php php php$thisphp-php>addDecoratorphp(php$decoratorInfophp)php;
php php php php php php php php php php php php php php php php php}
php php php php php php php php php php php php php}php elseifphp php(isphp_arrayphp(php$decoratorInfophp)php)php php{
php php php php php php php php php php php php php php php php php$argcphp php php php php=php countphp(php$decoratorInfophp)php;
php php php php php php php php php php php php php php php php php$optionsphp php=php arrayphp(php)php;
php php php php php php php php php php php php php php php php ifphp php(issetphp(php$decoratorInfophp[php'decoratorphp'php]php)php)php php{
php php php php php php php php php php php php php php php php php php php php php$decoratorphp php=php php$decoratorInfophp[php'decoratorphp'php]php;
php php php php php php php php php php php php php php php php php php php php ifphp php(issetphp(php$decoratorInfophp[php'optionsphp'php]php)php)php php{
php php php php php php php php php php php php php php php php php php php php php php php php php$optionsphp php=php php$decoratorInfophp[php'optionsphp'php]php;
php php php php php php php php php php php php php php php php php php php php php}
php php php php php php php php php php php php php php php php php php php php php$thisphp-php>addDecoratorphp(php$decoratorphp,php php$optionsphp)php;
php php php php php php php php php php php php php php php php php}php elsephp php{
php php php php php php php php php php php php php php php php php php php php switchphp php(truephp)php php{
php php php php php php php php php php php php php php php php php php php php php php php php casephp php(php0php php=php=php php$argcphp)php:
php php php php php php php php php php php php php php php php php php php php php php php php php php php php breakphp;
php php php php php php php php php php php php php php php php php php php php php php php php casephp php(php1php <php=php php$argcphp)php:
php php php php php php php php php php php php php php php php php php php php php php php php php php php php php$decoratorphp php php=php arrayphp_shiftphp(php$decoratorInfophp)php;
php php php php php php php php php php php php php php php php php php php php php php php php casephp php(php2php <php=php php$argcphp)php:
php php php php php php php php php php php php php php php php php php php php php php php php php php php php php$optionsphp php=php arrayphp_shiftphp(php$decoratorInfophp)php;
php php php php php php php php php php php php php php php php php php php php php php php php defaultphp:
php php php php php php php php php php php php php php php php php php php php php php php php php php php php php$thisphp-php>addDecoratorphp(php$decoratorphp,php php$optionsphp)php;
php php php php php php php php php php php php php php php php php php php php php php php php php php php php breakphp;
php php php php php php php php php php php php php php php php php php php php php}
php php php php php php php php php php php php php php php php php}
php php php php php php php php php php php php php}php elsephp php{
php php php php php php php php php php php php php php php php requirephp_oncephp php'Zendphp/Formphp/Exceptionphp.phpphp'php;
php php php php php php php php php php php php php php php php throwphp newphp Zendphp_Formphp_Exceptionphp(php'Invalidphp decoratorphp passedphp tophp addDecoratorsphp(php)php'php)php;
php php php php php php php php php php php php php}
php php php php php php php php php}

php php php php php php php php returnphp php$thisphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Overwritephp allphp decorators
php php php php php php*
php php php php php php*php php@paramphp php arrayphp php$decorators
php php php php php php*php php@returnphp Zendphp_Form
php php php php php php*php/
php php php php publicphp functionphp setDecoratorsphp(arrayphp php$decoratorsphp)
php php php php php{
php php php php php php php php php$thisphp-php>clearDecoratorsphp(php)php;
php php php php php php php php returnphp php$thisphp-php>addDecoratorsphp(php$decoratorsphp)php;
php php php php php}

php php php php php/php*php*
php php php php php php*php Retrievephp aphp registeredphp decorator
php php php php php php*
php php php php php php*php php@paramphp php stringphp php$name
php php php php php php*php php@returnphp falsephp|Zendphp_Formphp_Decoratorphp_Abstract
php php php php php php*php/
php php php php publicphp functionphp getDecoratorphp(php$namephp)
php php php php php{
php php php php php php php php ifphp php(php!issetphp(php$thisphp-php>php_decoratorsphp[php$namephp]php)php)php php{
php php php php php php php php php php php php php$lenphp php=php strlenphp(php$namephp)php;
php php php php php php php php php php php php foreachphp php(php$thisphp-php>php_decoratorsphp asphp php$localNamephp php=php>php php$decoratorphp)php php{
php php php php php php php php php php php php php php php php ifphp php(php$lenphp php>php strlenphp(php$localNamephp)php)php php{
php php php php php php php php php php php php php php php php php php php php continuephp;
php php php php php php php php php php php php php php php php php}

php php php php php php php php php php php php php php php php ifphp php(php0php php=php=php=php substrphp_comparephp(php$localNamephp,php php$namephp,php php-php$lenphp,php php$lenphp,php truephp)php)php php{
php php php php php php php php php php php php php php php php php php php php ifphp php(isphp_arrayphp(php$decoratorphp)php)php php{
php php php php php php php php php php php php php php php php php php php php php php php php returnphp php$thisphp-php>php_loadDecoratorphp(php$decoratorphp,php php$localNamephp)php;
php php php php php php php php php php php php php php php php php php php php php}
php php php php php php php php php php php php php php php php php php php php returnphp php$decoratorphp;
php php php php php php php php php php php php php php php php php}
php php php php php php php php php php php php php}
php php php php php php php php php php php php returnphp falsephp;
php php php php php php php php php}

php php php php php php php php ifphp php(isphp_arrayphp(php$thisphp-php>php_decoratorsphp[php$namephp]php)php)php php{
php php php php php php php php php php php php returnphp php$thisphp-php>php_loadDecoratorphp(php$thisphp-php>php_decoratorsphp[php$namephp]php,php php$namephp)php;
php php php php php php php php php}

php php php php php php php php returnphp php$thisphp-php>php_decoratorsphp[php$namephp]php;
php php php php php}

php php php php php/php*php*
php php php php php php*php Retrievephp allphp decorators
php php php php php php*
php php php php php php*php php@returnphp array
php php php php php php*php/
php php php php publicphp functionphp getDecoratorsphp(php)
php php php php php{
php php php php php php php php foreachphp php(php$thisphp-php>php_decoratorsphp asphp php$keyphp php=php>php php$valuephp)php php{
php php php php php php php php php php php php ifphp php(isphp_arrayphp(php$valuephp)php)php php{
php php php php php php php php php php php php php php php php php$thisphp-php>php_loadDecoratorphp(php$valuephp,php php$keyphp)php;
php php php php php php php php php php php php php}
php php php php php php php php php}
php php php php php php php php returnphp php$thisphp-php>php_decoratorsphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Removephp aphp singlephp decorator
php php php php php php*
php php php php php php*php php@paramphp php stringphp php$name
php php php php php php*php php@returnphp bool
php php php php php php*php/
php php php php publicphp functionphp removeDecoratorphp(php$namephp)
php php php php php{
php php php php php php php php php$decoratorphp php=php php$thisphp-php>getDecoratorphp(php$namephp)php;
php php php php php php php php ifphp php(php$decoratorphp)php php{
php php php php php php php php php php php php ifphp php(arrayphp_keyphp_existsphp(php$namephp,php php$thisphp-php>php_decoratorsphp)php)php php{
php php php php php php php php php php php php php php php php unsetphp(php$thisphp-php>php_decoratorsphp[php$namephp]php)php;
php php php php php php php php php php php php php}php elsephp php{
php php php php php php php php php php php php php php php php php$classphp php=php getphp_classphp(php$decoratorphp)php;
php php php php php php php php php php php php php php php php ifphp php(php!arrayphp_keyphp_existsphp(php$classphp,php php$thisphp-php>php_decoratorsphp)php)php php{
php php php php php php php php php php php php php php php php php php php php returnphp falsephp;
php php php php php php php php php php php php php php php php php}
php php php php php php php php php php php php php php php php unsetphp(php$thisphp-php>php_decoratorsphp[php$classphp]php)php;
php php php php php php php php php php php php php}
php php php php php php php php php php php php returnphp truephp;
php php php php php php php php php}

php php php php php php php php returnphp falsephp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Clearphp allphp decorators
php php php php php php*
php php php php php php*php php@returnphp Zendphp_Form
php php php php php php*php/
php php php php publicphp functionphp clearDecoratorsphp(php)
php php php php php{
php php php php php php php php php$thisphp-php>php_decoratorsphp php=php arrayphp(php)php;
php php php php php php php php returnphp php$thisphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Setphp allphp elementphp decoratorsphp asphp specified
php php php php php php*
php php php php php php*php php@paramphp php arrayphp php$decorators
php php php php php php*php php@paramphp php arrayphp|nullphp php$elementsphp Specificphp elementsphp tophp decoratephp orphp excludephp fromphp decoration
php php php php php php*php php@paramphp php boolphp php$includephp Whetherphp php$elementsphp isphp anphp inclusionphp orphp exclusionphp list
php php php php php php*php php@returnphp Zendphp_Form
php php php php php php*php/
php php php php publicphp functionphp setElementDecoratorsphp(arrayphp php$decoratorsphp,php arrayphp php$elementsphp php=php nullphp,php php$includephp php=php truephp)
php php php php php{
php php php php php php php php ifphp php(isphp_arrayphp(php$elementsphp)php)php php{
php php php php php php php php php php php php ifphp php(php$includephp)php php{
php php php php php php php php php php php php php php php php php$elementObjsphp php=php arrayphp(php)php;
php php php php php php php php php php php php php php php php foreachphp php(php$elementsphp asphp php$namephp)php php{
php php php php php php php php php php php php php php php php php php php php ifphp php(nullphp php!php=php=php php(php$elementphp php=php php$thisphp-php>getElementphp(php$namephp)php)php)php php{
php php php php php php php php php php php php php php php php php php php php php php php php php$elementObjsphp[php]php php=php php$elementphp;
php php php php php php php php php php php php php php php php php php php php php}
php php php php php php php php php php php php php php php php php}
php php php php php php php php php php php php php}php elsephp php{
php php php php php php php php php php php php php php php php php$elementObjsphp php=php php$thisphp-php>getElementsphp(php)php;
php php php php php php php php php php php php php php php php foreachphp php(php$elementsphp asphp php$namephp)php php{
php php php php php php php php php php php php php php php php php php php php ifphp php(arrayphp_keyphp_existsphp(php$namephp,php php$elementObjsphp)php)php php{
php php php php php php php php php php php php php php php php php php php php php php php php unsetphp(php$elementObjsphp[php$namephp]php)php;
php php php php php php php php php php php php php php php php php php php php php}
php php php php php php php php php php php php php php php php php}
php php php php php php php php php php php php php}
php php php php php php php php php}php elsephp php{
php php php php php php php php php php php php php$elementObjsphp php=php php$thisphp-php>getElementsphp(php)php;
php php php php php php php php php}

php php php php php php php php foreachphp php(php$elementObjsphp asphp php$elementphp)php php{
php php php php php php php php php php php php php$elementphp-php>setDecoratorsphp(php$decoratorsphp)php;
php php php php php php php php php}

php php php php php php php php php$thisphp-php>php_elementDecoratorsphp php=php php$decoratorsphp;

php php php php php php php php returnphp php$thisphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Setphp allphp displayphp groupphp decoratorsphp asphp specified
php php php php php php*
php php php php php php*php php@paramphp php arrayphp php$decorators
php php php php php php*php php@returnphp Zendphp_Form
php php php php php php*php/
php php php php publicphp functionphp setDisplayGroupDecoratorsphp(arrayphp php$decoratorsphp)
php php php php php{
php php php php php php php php foreachphp php(php$thisphp-php>getDisplayGroupsphp(php)php asphp php$groupphp)php php{
php php php php php php php php php php php php php$groupphp-php>setDecoratorsphp(php$decoratorsphp)php;
php php php php php php php php php}

php php php php php php php php returnphp php$thisphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Setphp allphp subformphp decoratorsphp asphp specified
php php php php php php*
php php php php php php*php php@paramphp php arrayphp php$decorators
php php php php php php*php php@returnphp Zendphp_Form
php php php php php php*php/
php php php php publicphp functionphp setSubFormDecoratorsphp(arrayphp php$decoratorsphp)
php php php php php{
php php php php php php php php foreachphp php(php$thisphp-php>getSubFormsphp(php)php asphp php$formphp)php php{
php php php php php php php php php php php php php$formphp-php>setDecoratorsphp(php$decoratorsphp)php;
php php php php php php php php php}

php php php php php php php php returnphp php$thisphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Renderphp form
php php php php php php*
php php php php php php*php php@paramphp php Zendphp_Viewphp_Interfacephp php$view
php php php php php php*php php@returnphp string
php php php php php php*php/
php php php php publicphp functionphp renderphp(Zendphp_Viewphp_Interfacephp php$viewphp php=php nullphp)
php php php php php{
php php php php php php php php ifphp php(nullphp php!php=php=php php$viewphp)php php{
php php php php php php php php php php php php php$thisphp-php>setViewphp(php$viewphp)php;
php php php php php php php php php}

php php php php php php php php php$contentphp php=php php'php'php;
php php php php php php php php foreachphp php(php$thisphp-php>getDecoratorsphp(php)php asphp php$decoratorphp)php php{
php php php php php php php php php php php php php$decoratorphp-php>setElementphp(php$thisphp)php;
php php php php php php php php php php php php php$contentphp php=php php$decoratorphp-php>renderphp(php$contentphp)php;
php php php php php php php php php}
php php php php php php php php php$thisphp-php>php_setIsRenderedphp(php)php;
php php php php php php php php returnphp php$contentphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Serializephp asphp string
php php php php php php*
php php php php php php*php Proxiesphp tophp php{php@linkphp renderphp(php)php}php.
php php php php php php*
php php php php php php*php php@returnphp string
php php php php php php*php/
php php php php publicphp functionphp php_php_toStringphp(php)
php php php php php{
php php php php php php php php tryphp php{
php php php php php php php php php php php php php$returnphp php=php php$thisphp-php>renderphp(php)php;
php php php php php php php php php php php php returnphp php$returnphp;
php php php php php php php php php}php catchphp php(Exceptionphp php$ephp)php php{
php php php php php php php php php php php php php$messagephp php=php php"Exceptionphp caughtphp byphp formphp:php php"php php.php php$ephp-php>getMessagephp(php)
php php php php php php php php php php php php php php php php php php php php php php.php php"php\nStackphp Tracephp:php\nphp"php php.php php$ephp-php>getTraceAsStringphp(php)php;
php php php php php php php php php php php php triggerphp_errorphp(php$messagephp,php Ephp_USERphp_WARNINGphp)php;
php php php php php php php php php php php php returnphp php'php'php;
php php php php php php php php php}
php php php php php}


php php php php php/php/php Localizationphp:

php php php php php/php*php*
php php php php php php*php Setphp translatorphp object
php php php php php php*
php php php php php php*php php@paramphp php Zendphp_Translatephp|Zendphp_Translatephp_Adapterphp|nullphp php$translator
php php php php php php*php php@returnphp Zendphp_Form
php php php php php php*php/
php php php php publicphp functionphp setTranslatorphp(php$translatorphp php=php nullphp)
php php php php php{
php php php php php php php php ifphp php(nullphp php=php=php=php php$translatorphp)php php{
php php php php php php php php php php php php php$thisphp-php>php_translatorphp php=php nullphp;
php php php php php php php php php}php elseifphp php(php$translatorphp instanceofphp Zendphp_Translatephp_Adapterphp)php php{
php php php php php php php php php php php php php$thisphp-php>php_translatorphp php=php php$translatorphp;
php php php php php php php php php}php elseifphp php(php$translatorphp instanceofphp Zendphp_Translatephp)php php{
php php php php php php php php php php php php php$thisphp-php>php_translatorphp php=php php$translatorphp-php>getAdapterphp(php)php;
php php php php php php php php php}php elsephp php{
php php php php php php php php php php php php requirephp_oncephp php'Zendphp/Formphp/Exceptionphp.phpphp'php;
php php php php php php php php php php php php throwphp newphp Zendphp_Formphp_Exceptionphp(php'Invalidphp translatorphp specifiedphp'php)php;
php php php php php php php php php}

php php php php php php php php returnphp php$thisphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Setphp globalphp defaultphp translatorphp object
php php php php php php*
php php php php php php*php php@paramphp php Zendphp_Translatephp|Zendphp_Translatephp_Adapterphp|nullphp php$translator
php php php php php php*php php@returnphp void
php php php php php php*php/
php php php php publicphp staticphp functionphp setDefaultTranslatorphp(php$translatorphp php=php nullphp)
php php php php php{
php php php php php php php php ifphp php(nullphp php=php=php=php php$translatorphp)php php{
php php php php php php php php php php php php selfphp:php:php$php_translatorDefaultphp php=php nullphp;
php php php php php php php php php}php elseifphp php(php$translatorphp instanceofphp Zendphp_Translatephp_Adapterphp)php php{
php php php php php php php php php php php php selfphp:php:php$php_translatorDefaultphp php=php php$translatorphp;
php php php php php php php php php}php elseifphp php(php$translatorphp instanceofphp Zendphp_Translatephp)php php{
php php php php php php php php php php php php selfphp:php:php$php_translatorDefaultphp php=php php$translatorphp-php>getAdapterphp(php)php;
php php php php php php php php php}php elsephp php{
php php php php php php php php php php php php requirephp_oncephp php'Zendphp/Formphp/Exceptionphp.phpphp'php;
php php php php php php php php php php php php throwphp newphp Zendphp_Formphp_Exceptionphp(php'Invalidphp translatorphp specifiedphp'php)php;
php php php php php php php php php}
php php php php php}

php php php php php/php*php*
php php php php php php*php Retrievephp translatorphp object
php php php php php php*
php php php php php php*php php@returnphp Zendphp_Translatephp|null
php php php php php php*php/
php php php php publicphp functionphp getTranslatorphp(php)
php php php php php{
php php php php php php php php ifphp php(php$thisphp-php>translatorIsDisabledphp(php)php)php php{
php php php php php php php php php php php php returnphp nullphp;
php php php php php php php php php}

php php php php php php php php ifphp php(nullphp php=php=php=php php$thisphp-php>php_translatorphp)php php{
php php php php php php php php php php php php returnphp selfphp:php:getDefaultTranslatorphp(php)php;
php php php php php php php php php}

php php php php php php php php returnphp php$thisphp-php>php_translatorphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Doesphp thisphp formphp havephp itsphp ownphp specificphp translatorphp?
php php php php php php*
php php php php php php*php php@returnphp bool
php php php php php php*php/
php php php php publicphp functionphp hasTranslatorphp(php)
php php php php php{
php php php php php php php php returnphp php(boolphp)php$thisphp-php>php_translatorphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Getphp globalphp defaultphp translatorphp object
php php php php php php*
php php php php php php*php php@returnphp nullphp|Zendphp_Translate
php php php php php php*php/
php php php php publicphp staticphp functionphp getDefaultTranslatorphp(php)
php php php php php{
php php php php php php php php ifphp php(nullphp php=php=php=php selfphp:php:php$php_translatorDefaultphp)php php{
php php php php php php php php php php php php requirephp_oncephp php'Zendphp/Registryphp.phpphp'php;
php php php php php php php php php php php php ifphp php(Zendphp_Registryphp:php:isRegisteredphp(php'Zendphp_Translatephp'php)php)php php{
php php php php php php php php php php php php php php php php php$translatorphp php=php Zendphp_Registryphp:php:getphp(php'Zendphp_Translatephp'php)php;
php php php php php php php php php php php php php php php php ifphp php(php$translatorphp instanceofphp Zendphp_Translatephp_Adapterphp)php php{
php php php php php php php php php php php php php php php php php php php php returnphp php$translatorphp;
php php php php php php php php php php php php php php php php php}php elseifphp php(php$translatorphp instanceofphp Zendphp_Translatephp)php php{
php php php php php php php php php php php php php php php php php php php php returnphp php$translatorphp-php>getAdapterphp(php)php;
php php php php php php php php php php php php php php php php php}
php php php php php php php php php php php php php}
php php php php php php php php php}
php php php php php php php php returnphp selfphp:php:php$php_translatorDefaultphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Isphp therephp aphp defaultphp translationphp objectphp setphp?
php php php php php php*
php php php php php php*php php@returnphp boolean
php php php php php php*php/
php php php php publicphp staticphp functionphp hasDefaultTranslatorphp(php)
php php php php php{
php php php php php php php php returnphp php(boolphp)selfphp:php:php$php_translatorDefaultphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Indicatephp whetherphp orphp notphp translationphp shouldphp bephp disabled
php php php php php php*
php php php php php php*php php@paramphp php boolphp php$flag
php php php php php php*php php@returnphp Zendphp_Form
php php php php php php*php/
php php php php publicphp functionphp setDisableTranslatorphp(php$flagphp)
php php php php php{
php php php php php php php php php$thisphp-php>php_translatorDisabledphp php=php php(boolphp)php php$flagphp;
php php php php php php php php returnphp php$thisphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Isphp translationphp disabledphp?
php php php php php php*
php php php php php php*php php@returnphp bool
php php php php php php*php/
php php php php publicphp functionphp translatorIsDisabledphp(php)
php php php php php{
php php php php php php php php returnphp php$thisphp-php>php_translatorDisabledphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Overloadingphp:php accessphp tophp elementsphp,php formphp groupsphp,php andphp displayphp groups
php php php php php php*
php php php php php php*php php@paramphp php stringphp php$name
php php php php php php*php php@returnphp Zendphp_Formphp_Elementphp|Zendphp_Formphp|null
php php php php php php*php/
php php php php publicphp functionphp php_php_getphp(php$namephp)
php php php php php{
php php php php php php php php ifphp php(issetphp(php$thisphp-php>php_elementsphp[php$namephp]php)php)php php{
php php php php php php php php php php php php returnphp php$thisphp-php>php_elementsphp[php$namephp]php;
php php php php php php php php php}php elseifphp php(issetphp(php$thisphp-php>php_subFormsphp[php$namephp]php)php)php php{
php php php php php php php php php php php php returnphp php$thisphp-php>php_subFormsphp[php$namephp]php;
php php php php php php php php php}php elseifphp php(issetphp(php$thisphp-php>php_displayGroupsphp[php$namephp]php)php)php php{
php php php php php php php php php php php php returnphp php$thisphp-php>php_displayGroupsphp[php$namephp]php;
php php php php php php php php php}

php php php php php php php php returnphp nullphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Overloadingphp:php accessphp tophp elementsphp,php formphp groupsphp,php andphp displayphp groups
php php php php php php*
php php php php php php*php php@paramphp php stringphp php$name
php php php php php php*php php@paramphp php Zendphp_Formphp_Elementphp|Zendphp_Formphp php$value
php php php php php php*php php@returnphp void
php php php php php php*php php@throwsphp Zendphp_Formphp_Exceptionphp forphp invalidphp php$value
php php php php php php*php/
php php php php publicphp functionphp php_php_setphp(php$namephp,php php$valuephp)
php php php php php{
php php php php php php php php ifphp php(php$valuephp instanceofphp Zendphp_Formphp_Elementphp)php php{
php php php php php php php php php php php php php$thisphp-php>addElementphp(php$valuephp,php php$namephp)php;
php php php php php php php php php php php php returnphp;
php php php php php php php php php}php elseifphp php(php$valuephp instanceofphp Zendphp_Formphp)php php{
php php php php php php php php php php php php php$thisphp-php>addSubFormphp(php$valuephp,php php$namephp)php;
php php php php php php php php php php php php returnphp;
php php php php php php php php php}php elseifphp php(isphp_arrayphp(php$valuephp)php)php php{
php php php php php php php php php php php php php$thisphp-php>addDisplayGroupphp(php$valuephp,php php$namephp)php;
php php php php php php php php php php php php returnphp;
php php php php php php php php php}

php php php php php php php php requirephp_oncephp php'Zendphp/Formphp/Exceptionphp.phpphp'php;
php php php php php php php php ifphp php(isphp_objectphp(php$valuephp)php)php php{
php php php php php php php php php php php php php$typephp php=php getphp_classphp(php$valuephp)php;
php php php php php php php php php}php elsephp php{
php php php php php php php php php php php php php$typephp php=php gettypephp(php$valuephp)php;
php php php php php php php php php}
php php php php php php php php throwphp newphp Zendphp_Formphp_Exceptionphp(php'Onlyphp formphp elementsphp andphp groupsphp mayphp bephp overloadedphp;php variablephp ofphp typephp php"php'php php.php php$typephp php.php php'php"php providedphp'php)php;
php php php php php}

php php php php php/php*php*
php php php php php php*php Overloadingphp:php accessphp tophp elementsphp,php formphp groupsphp,php andphp displayphp groups
php php php php php php*
php php php php php php*php php@paramphp php stringphp php$name
php php php php php php*php php@returnphp boolean
php php php php php php*php/
php php php php publicphp functionphp php_php_issetphp(php$namephp)
php php php php php{
php php php php php php php php ifphp php(issetphp(php$thisphp-php>php_elementsphp[php$namephp]php)
php php php php php php php php php php php php php|php|php issetphp(php$thisphp-php>php_subFormsphp[php$namephp]php)
php php php php php php php php php php php php php|php|php issetphp(php$thisphp-php>php_displayGroupsphp[php$namephp]php)php)
php php php php php php php php php{
php php php php php php php php php php php php returnphp truephp;
php php php php php php php php php}

php php php php php php php php returnphp falsephp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Overloadingphp:php accessphp tophp elementsphp,php formphp groupsphp,php andphp displayphp groups
php php php php php php*
php php php php php php*php php@paramphp php stringphp php$name
php php php php php php*php php@returnphp void
php php php php php php*php/
php php php php publicphp functionphp php_php_unsetphp(php$namephp)
php php php php php{
php php php php php php php php ifphp php(issetphp(php$thisphp-php>php_elementsphp[php$namephp]php)php)php php{
php php php php php php php php php php php php unsetphp(php$thisphp-php>php_elementsphp[php$namephp]php)php;
php php php php php php php php php}php elseifphp php(issetphp(php$thisphp-php>php_subFormsphp[php$namephp]php)php)php php{
php php php php php php php php php php php php unsetphp(php$thisphp-php>php_subFormsphp[php$namephp]php)php;
php php php php php php php php php}php elseifphp php(issetphp(php$thisphp-php>php_displayGroupsphp[php$namephp]php)php)php php{
php php php php php php php php php php php php unsetphp(php$thisphp-php>php_displayGroupsphp[php$namephp]php)php;
php php php php php php php php php}
php php php php php}

php php php php php/php*php*
php php php php php php*php Overloadingphp:php allowphp renderingphp specificphp decorators
php php php php php php*
php php php php php php*php Callphp renderDecoratorNamephp(php)php tophp renderphp aphp specificphp decoratorphp.
php php php php php php*
php php php php php php*php php@paramphp php stringphp php$method
php php php php php php*php php@paramphp php arrayphp php$args
php php php php php php*php php@returnphp string
php php php php php php*php php@throwsphp Zendphp_Formphp_Exceptionphp forphp invalidphp decoratorphp orphp invalidphp methodphp call
php php php php php php*php/
php php php php publicphp functionphp php_php_callphp(php$methodphp,php php$argsphp)
php php php php php{
php php php php php php php php ifphp php(php'renderphp'php php=php=php substrphp(php$methodphp,php php0php,php php6php)php)php php{
php php php php php php php php php php php php php$decoratorNamephp php=php substrphp(php$methodphp,php php6php)php;
php php php php php php php php php php php php ifphp php(falsephp php!php=php=php php(php$decoratorphp php=php php$thisphp-php>getDecoratorphp(php$decoratorNamephp)php)php)php php{
php php php php php php php php php php php php php php php php php$decoratorphp-php>setElementphp(php$thisphp)php;
php php php php php php php php php php php php php php php php php$seedphp php=php php'php'php;
php php php php php php php php php php php php php php php php ifphp php(php0php <php countphp(php$argsphp)php)php php{
php php php php php php php php php php php php php php php php php php php php php$seedphp php=php arrayphp_shiftphp(php$argsphp)php;
php php php php php php php php php php php php php php php php php}
php php php php php php php php php php php php php php php php ifphp php(php$decoratorNamephp php=php=php=php php'FormElementsphp'php php|php|
php php php php php php php php php php php php php php php php php php php php php$decoratorNamephp php=php=php=php php'PrepareElementsphp'php)php php{
php php php php php php php php php php php php php php php php php php php php php php php php php$thisphp-php>php_setIsRenderedphp(php)php;
php php php php php php php php php php php php php php php php php}
php php php php php php php php php php php php php php php php returnphp php$decoratorphp-php>renderphp(php$seedphp)php;
php php php php php php php php php php php php php}

php php php php php php php php php php php php requirephp_oncephp php'Zendphp/Formphp/Exceptionphp.phpphp'php;
php php php php php php php php php php php php throwphp newphp Zendphp_Formphp_Exceptionphp(sprintfphp(php'Decoratorphp byphp namephp php%sphp doesphp notphp existphp'php,php php$decoratorNamephp)php)php;
php php php php php php php php php}

php php php php php php php php requirephp_oncephp php'Zendphp/Formphp/Exceptionphp.phpphp'php;
php php php php php php php php throwphp newphp Zendphp_Formphp_Exceptionphp(sprintfphp(php'Methodphp php%sphp doesphp notphp existphp'php,php php$methodphp)php)php;
php php php php php}

php php php php php/php/php Interfacesphp:php Iteratorphp,php Countable

php php php php php/php*php*
php php php php php php*php Currentphp elementphp/subformphp/displayphp group
php php php php php php*
php php php php php php*php php@returnphp Zendphp_Formphp_Elementphp|Zendphp_Formphp_DisplayGroupphp|Zendphp_Form
php php php php php php*php/
php php php php publicphp functionphp currentphp(php)
php php php php php{
php php php php php php php php php$thisphp-php>php_sortphp(php)php;
php php php php php php php php currentphp(php$thisphp-php>php_orderphp)php;
php php php php php php php php php$keyphp php=php keyphp(php$thisphp-php>php_orderphp)php;

php php php php php php php php ifphp php(issetphp(php$thisphp-php>php_elementsphp[php$keyphp]php)php)php php{
php php php php php php php php php php php php returnphp php$thisphp-php>getElementphp(php$keyphp)php;
php php php php php php php php php}php elseifphp php(issetphp(php$thisphp-php>php_subFormsphp[php$keyphp]php)php)php php{
php php php php php php php php php php php php returnphp php$thisphp-php>getSubFormphp(php$keyphp)php;
php php php php php php php php php}php elseifphp php(issetphp(php$thisphp-php>php_displayGroupsphp[php$keyphp]php)php)php php{
php php php php php php php php php php php php returnphp php$thisphp-php>getDisplayGroupphp(php$keyphp)php;
php php php php php php php php php}php elsephp php{
php php php php php php php php php php php php requirephp_oncephp php'Zendphp/Formphp/Exceptionphp.phpphp'php;
php php php php php php php php php php php php throwphp newphp Zendphp_Formphp_Exceptionphp(sprintfphp(php'Corruptionphp detectedphp inphp formphp;php invalidphp keyphp php(php"php%sphp"php)php foundphp inphp internalphp iteratorphp'php,php php(stringphp)php php$keyphp)php)php;
php php php php php php php php php}
php php php php php}

php php php php php/php*php*
php php php php php php*php Currentphp elementphp/subformphp/displayphp groupphp name
php php php php php php*
php php php php php php*php php@returnphp string
php php php php php php*php/
php php php php publicphp functionphp keyphp(php)
php php php php php{
php php php php php php php php php$thisphp-php>php_sortphp(php)php;
php php php php php php php php returnphp keyphp(php$thisphp-php>php_orderphp)php;
php php php php php}

php php php php php/php*php*
php php php php php php*php Movephp pointerphp tophp nextphp elementphp/subformphp/displayphp group
php php php php php php*
php php php php php php*php php@returnphp void
php php php php php php*php/
php php php php publicphp functionphp nextphp(php)
php php php php php{
php php php php php php php php php$thisphp-php>php_sortphp(php)php;
php php php php php php php php nextphp(php$thisphp-php>php_orderphp)php;
php php php php php}

php php php php php/php*php*
php php php php php php*php Movephp pointerphp tophp beginningphp ofphp elementphp/subformphp/displayphp groupphp loop
php php php php php php*
php php php php php php*php php@returnphp void
php php php php php php*php/
php php php php publicphp functionphp rewindphp(php)
php php php php php{
php php php php php php php php php$thisphp-php>php_sortphp(php)php;
php php php php php php php php resetphp(php$thisphp-php>php_orderphp)php;
php php php php php}

php php php php php/php*php*
php php php php php php*php Determinephp ifphp currentphp elementphp/subformphp/displayphp groupphp isphp valid
php php php php php php*
php php php php php php*php php@returnphp bool
php php php php php php*php/
php php php php publicphp functionphp validphp(php)
php php php php php{
php php php php php php php php php$thisphp-php>php_sortphp(php)php;
php php php php php php php php returnphp php(currentphp(php$thisphp-php>php_orderphp)php php!php=php=php falsephp)php;
php php php php php}

php php php php php/php*php*
php php php php php php*php Countphp ofphp elementsphp/subformsphp thatphp arephp iterable
php php php php php php*
php php php php php php*php php@returnphp int
php php php php php php*php/
php php php php publicphp functionphp countphp(php)
php php php php php{
php php php php php php php php returnphp countphp(php$thisphp-php>php_orderphp)php;
php php php php php}

php php php php php/php*php*
php php php php php php*php Setphp flagphp tophp disablephp loadingphp defaultphp decorators
php php php php php php*
php php php php php php*php php@paramphp php boolphp php$flag
php php php php php php*php php@returnphp Zendphp_Form
php php php php php php*php/
php php php php publicphp functionphp setDisableLoadDefaultDecoratorsphp(php$flagphp)
php php php php php{
php php php php php php php php php$thisphp-php>php_disableLoadDefaultDecoratorsphp php=php php(boolphp)php php$flagphp;
php php php php php php php php returnphp php$thisphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Shouldphp wephp loadphp thephp defaultphp decoratorsphp?
php php php php php php*
php php php php php php*php php@returnphp bool
php php php php php php*php/
php php php php publicphp functionphp loadDefaultDecoratorsIsDisabledphp(php)
php php php php php{
php php php php php php php php returnphp php$thisphp-php>php_disableLoadDefaultDecoratorsphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Loadphp thephp defaultphp decorators
php php php php php php*
php php php php php php*php php@returnphp void
php php php php php php*php/
php php php php publicphp functionphp loadDefaultDecoratorsphp(php)
php php php php php{
php php php php php php php php ifphp php(php$thisphp-php>loadDefaultDecoratorsIsDisabledphp(php)php)php php{
php php php php php php php php php php php php returnphp php$thisphp;
php php php php php php php php php}

php php php php php php php php php$decoratorsphp php=php php$thisphp-php>getDecoratorsphp(php)php;
php php php php php php php php ifphp php(emptyphp(php$decoratorsphp)php)php php{
php php php php php php php php php php php php php$thisphp-php>addDecoratorphp(php'FormElementsphp'php)
php php php php php php php php php php php php php php php php php php-php>addDecoratorphp(php'HtmlTagphp'php,php arrayphp(php'tagphp'php php=php>php php'dlphp'php,php php'classphp'php php=php>php php'zendphp_formphp'php)php)
php php php php php php php php php php php php php php php php php php-php>addDecoratorphp(php'Formphp'php)php;
php php php php php php php php php}
php php php php php php php php returnphp php$thisphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Removephp anphp elementphp fromphp iteration
php php php php php php*
php php php php php php*php php@paramphp php stringphp php$namephp Elementphp/groupphp/formphp name
php php php php php php*php php@returnphp void
php php php php php php*php/
php php php php publicphp functionphp removeFromIterationphp(php$namephp)
php php php php php{
php php php php php php php php ifphp php(arrayphp_keyphp_existsphp(php$namephp,php php$thisphp-php>php_orderphp)php)php php{
php php php php php php php php php php php php unsetphp(php$thisphp-php>php_orderphp[php$namephp]php)php;
php php php php php php php php php php php php php$thisphp-php>php_orderUpdatedphp php=php truephp;
php php php php php php php php php}
php php php php php}

php php php php php/php*php*
php php php php php php*php Sortphp itemsphp accordingphp tophp theirphp order
php php php php php php*
php php php php php php*php php@returnphp void
php php php php php php*php/
php php php php protectedphp functionphp php_sortphp(php)
php php php php php{
php php php php php php php php ifphp php(php$thisphp-php>php_orderUpdatedphp)php php{
php php php php php php php php php php php php php$itemsphp php=php arrayphp(php)php;
php php php php php php php php php php php php php$indexphp php=php php0php;
php php php php php php php php php php php php foreachphp php(php$thisphp-php>php_orderphp asphp php$keyphp php=php>php php$orderphp)php php{
php php php php php php php php php php php php php php php php ifphp php(nullphp php=php=php=php php$orderphp)php php{
php php php php php php php php php php php php php php php php php php php php ifphp php(nullphp php=php=php=php php(php$orderphp php=php php$thisphp-php>php{php$keyphp}php-php>getOrderphp(php)php)php)php php{
php php php php php php php php php php php php php php php php php php php php php php php php whilephp php(arrayphp_searchphp(php$indexphp,php php$thisphp-php>php_orderphp,php truephp)php)php php{
php php php php php php php php php php php php php php php php php php php php php php php php php php php php php+php+php$indexphp;
php php php php php php php php php php php php php php php php php php php php php php php php php}
php php php php php php php php php php php php php php php php php php php php php php php php php$itemsphp[php$indexphp]php php=php php$keyphp;
php php php php php php php php php php php php php php php php php php php php php php php php php+php+php$indexphp;
php php php php php php php php php php php php php php php php php php php php php}php elsephp php{
php php php php php php php php php php php php php php php php php php php php php php php php php$itemsphp[php$orderphp]php php=php php$keyphp;
php php php php php php php php php php php php php php php php php php php php php}
php php php php php php php php php php php php php php php php php}php elsephp php{
php php php php php php php php php php php php php php php php php php php php php$itemsphp[php$orderphp]php php=php php$keyphp;
php php php php php php php php php php php php php php php php php}
php php php php php php php php php php php php php}

php php php php php php php php php php php php php$itemsphp php=php arrayphp_flipphp(php$itemsphp)php;
php php php php php php php php php php php php asortphp(php$itemsphp)php;
php php php php php php php php php php php php php$thisphp-php>php_orderphp php=php php$itemsphp;
php php php php php php php php php php php php php$thisphp-php>php_orderUpdatedphp php=php falsephp;
php php php php php php php php php}
php php php php php}

php php php php php/php*php*
php php php php php php*php Lazyphp-loadphp aphp decorator
php php php php php php*
php php php php php php*php php@paramphp php arrayphp php$decoratorphp Decoratorphp typephp andphp options
php php php php php php*php php@paramphp php mixedphp php$namephp Decoratorphp namephp orphp alias
php php php php php php*php php@returnphp Zendphp_Formphp_Decoratorphp_Interface
php php php php php php*php/
php php php php protectedphp functionphp php_loadDecoratorphp(arrayphp php$decoratorphp,php php$namephp)
php php php php php{
php php php php php php php php php$sameNamephp php=php falsephp;
php php php php php php php php ifphp php(php$namephp php=php=php php$decoratorphp[php'decoratorphp'php]php)php php{
php php php php php php php php php php php php php$sameNamephp php=php truephp;
php php php php php php php php php}

php php php php php php php php php$instancephp php=php php$thisphp-php>php_getDecoratorphp(php$decoratorphp[php'decoratorphp'php]php,php php$decoratorphp[php'optionsphp'php]php)php;
php php php php php php php php ifphp php(php$sameNamephp)php php{
php php php php php php php php php php php php php$newNamephp php php php php php php php php php php php php=php getphp_classphp(php$instancephp)php;
php php php php php php php php php php php php php$decoratorNamesphp php php php php php=php arrayphp_keysphp(php$thisphp-php>php_decoratorsphp)php;
php php php php php php php php php php php php php$orderphp php php php php php php php php php php php php php php=php arrayphp_flipphp(php$decoratorNamesphp)php;
php php php php php php php php php php php php php$orderphp[php$newNamephp]php php php php php=php php$orderphp[php$namephp]php;
php php php php php php php php php php php php php$decoratorsExchangephp php=php arrayphp(php)php;
php php php php php php php php php php php php unsetphp(php$orderphp[php$namephp]php)php;
php php php php php php php php php php php php asortphp(php$orderphp)php;
php php php php php php php php php php php php foreachphp php(php$orderphp asphp php$keyphp php=php>php php$indexphp)php php{
php php php php php php php php php php php php php php php php ifphp php(php$keyphp php=php=php php$newNamephp)php php{
php php php php php php php php php php php php php php php php php php php php php$decoratorsExchangephp[php$keyphp]php php=php php$instancephp;
php php php php php php php php php php php php php php php php php php php php continuephp;
php php php php php php php php php php php php php php php php php}
php php php php php php php php php php php php php php php php php$decoratorsExchangephp[php$keyphp]php php=php php$thisphp-php>php_decoratorsphp[php$keyphp]php;
php php php php php php php php php php php php php}
php php php php php php php php php php php php php$thisphp-php>php_decoratorsphp php=php php$decoratorsExchangephp;
php php php php php php php php php}php elsephp php{
php php php php php php php php php php php php php$thisphp-php>php_decoratorsphp[php$namephp]php php=php php$instancephp;
php php php php php php php php php}

php php php php php php php php returnphp php$instancephp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Retrievephp optionallyphp translatedphp customphp errorphp messages
php php php php php php*
php php php php php php*php php@returnphp array
php php php php php php*php/
php php php php protectedphp functionphp php_getErrorMessagesphp(php)
php php php php php{
php php php php php php php php php$messagesphp php php php=php php$thisphp-php>getErrorMessagesphp(php)php;
php php php php php php php php php$translatorphp php=php php$thisphp-php>getTranslatorphp(php)php;
php php php php php php php php ifphp php(nullphp php!php=php=php php$translatorphp)php php{
php php php php php php php php php php php php foreachphp php(php$messagesphp asphp php$keyphp php=php>php php$messagephp)php php{
php php php php php php php php php php php php php php php php php$messagesphp[php$keyphp]php php=php php$translatorphp-php>translatephp(php$messagephp)php;
php php php php php php php php php php php php php}
php php php php php php php php php}
php php php php php php php php returnphp php$messagesphp;
php php php php php}
php}
