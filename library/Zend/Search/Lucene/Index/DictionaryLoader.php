<php?php
php/php*php*
php php*php Zendphp Framework
php php*
php php*php LICENSE
php php*
php php*php Thisphp sourcephp filephp isphp subjectphp tophp thephp newphp BSDphp licensephp thatphp isphp bundled
php php*php withphp thisphp packagephp inphp thephp filephp LICENSEphp.txtphp.
php php*php Itphp isphp alsophp availablephp throughphp thephp worldphp-widephp-webphp atphp thisphp URLphp:
php php*php httpphp:php/php/frameworkphp.zendphp.comphp/licensephp/newphp-bsd
php php*php Ifphp youphp didphp notphp receivephp aphp copyphp ofphp thephp licensephp andphp arephp unablephp to
php php*php obtainphp itphp throughphp thephp worldphp-widephp-webphp,php pleasephp sendphp anphp email
php php*php tophp licensephp@zendphp.comphp sophp wephp canphp sendphp youphp aphp copyphp immediatelyphp.
php php*
php php*php php@categoryphp php php Zend
php php*php php@packagephp php php php Zendphp_Searchphp_Lucene
php php*php php@subpackagephp Index
php php*php php@copyrightphp php Copyrightphp php(cphp)php php2php0php0php5php-php2php0php1php0php Zendphp Technologiesphp USAphp Incphp.php php(httpphp:php/php/wwwphp.zendphp.comphp)
php php*php php@licensephp php php php httpphp:php/php/frameworkphp.zendphp.comphp/licensephp/newphp-bsdphp php php php php Newphp BSDphp License
php php*php php@versionphp php php php php$Idphp:php DictionaryLoaderphp.phpphp php2php0php0php9php6php php2php0php1php0php-php0php1php-php0php6php php0php2php:php0php5php:php0php9Zphp bkarwinphp php$
php php*php/

php/php*php*
php php*php Dictionaryphp loader
php php*
php php*php Itphp'sphp aphp dummyphp classphp whichphp isphp createdphp tophp encapsulatephp nonphp-goodphp structuredphp codephp.
php php*php Manualphp php"methodphp inliningphp"php isphp performedphp tophp increasephp dictionaryphp indexphp loadingphp operation
php php*php whichphp isphp majorphp bottelneckphp forphp searchphp performancephp.
php php*
php php*
php php*php php@categoryphp php php Zend
php php*php php@packagephp php php php Zendphp_Searchphp_Lucene
php php*php php@subpackagephp Index
php php*php php@copyrightphp php Copyrightphp php(cphp)php php2php0php0php5php-php2php0php1php0php Zendphp Technologiesphp USAphp Incphp.php php(httpphp:php/php/wwwphp.zendphp.comphp)
php php*php php@licensephp php php php httpphp:php/php/frameworkphp.zendphp.comphp/licensephp/newphp-bsdphp php php php php Newphp BSDphp License
php php*php/
classphp Zendphp_Searchphp_Lucenephp_Indexphp_DictionaryLoader
php{
php php php php php/php*php*
php php php php php php*php Dictionaryphp indexphp loaderphp.
php php php php php php*
php php php php php php*php Itphp takesphp aphp stringphp whichphp isphp actuallyphp php<segmentphp_namephp>php.tiiphp indexphp filephp dataphp and
php php php php php php*php returnsphp twophp arraysphp php-php termphp andphp tremInfophp listsphp.
php php php php php php*
php php php php php php*php Seephp Zendphp_Searchphp_Lucenephp_Indexphp_SegmintInfophp classphp forphp details
php php php php php php*
php php php php php php*php php@paramphp stringphp php$data
php php php php php php*php php@returnphp array
php php php php php php*php php@throwsphp Zendphp_Searchphp_Lucenephp_Exception
php php php php php php*php/
php php php php publicphp staticphp functionphp loadphp(php$dataphp)
php php php php php{
php php php php php php php php php$termDictionaryphp php=php arrayphp(php)php;
php php php php php php php php php$termInfosphp php php php php php php=php arrayphp(php)php;
php php php php php php php php php$posphp php=php php0php;

php php php php php php php php php/php/php php$tiVersionphp php=php php$tiiFilephp-php>readIntphp(php)php;
php php php php php php php php php$tiVersionphp php=php ordphp(php$dataphp[php0php]php)php <php<php php2php4php php|php ordphp(php$dataphp[php1php]php)php <php<php php1php6php php|php ordphp(php$dataphp[php2php]php)php <php<php php8php php php|php ordphp(php$dataphp[php3php]php)php;
php php php php php php php php php$posphp php+php=php php4php;
php php php php php php php php ifphp php(php$tiVersionphp php!php=php php(intphp)php0xFFFFFFFEphp php/php*php prephp-php2php.php1php formatphp php*php/php php&php&
php php php php php php php php php php php php php$tiVersionphp php!php=php php(intphp)php0xFFFFFFFDphp php/php*php php2php.php1php+php formatphp php php php php*php/php)php php{
php php php php php php php php php php php php php php php php requirephp_oncephp php'Zendphp/Searchphp/Lucenephp/Exceptionphp.phpphp'php;
php php php php php php php php php php php php php php php php throwphp newphp Zendphp_Searchphp_Lucenephp_Exceptionphp(php'Wrongphp TermInfoIndexFilephp filephp formatphp'php)php;
php php php php php php php php php}

php php php php php php php php php/php/php php$indexTermCountphp php=php php$tiiFilephp-php>readLongphp(php)php;
php php php php php php php php ifphp php(PHPphp_INTphp_SIZEphp php>php php4php)php php{
php php php php php php php php php php php php php$indexTermCountphp php=php ordphp(php$dataphp[php$posphp]php)php <php<php php5php6php php php|
php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php ordphp(php$dataphp[php$posphp+php1php]php)php <php<php php4php8php php php|
php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php ordphp(php$dataphp[php$posphp+php2php]php)php <php<php php4php0php php php|
php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php ordphp(php$dataphp[php$posphp+php3php]php)php <php<php php3php2php php php|
php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php ordphp(php$dataphp[php$posphp+php4php]php)php <php<php php2php4php php php|
php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php ordphp(php$dataphp[php$posphp+php5php]php)php <php<php php1php6php php php|
php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php ordphp(php$dataphp[php$posphp+php6php]php)php <php<php php8php php php php|
php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php ordphp(php$dataphp[php$posphp+php7php]php)php;
php php php php php php php php php}php elsephp php{
php php php php php php php php php php php php ifphp php(php(ordphp(php$dataphp[php$posphp]php)php php php php php php php php php php php php php!php=php php0php)php php|php|
php php php php php php php php php php php php php php php php php(ordphp(php$dataphp[php$posphp+php1php]php)php php php php php php php php php php php!php=php php0php)php php|php|
php php php php php php php php php php php php php php php php php(ordphp(php$dataphp[php$posphp+php2php]php)php php php php php php php php php php php!php=php php0php)php php|php|
php php php php php php php php php php php php php php php php php(ordphp(php$dataphp[php$posphp+php3php]php)php php php php php php php php php php php!php=php php0php)php php|php|
php php php php php php php php php php php php php php php php php(php(ordphp(php$dataphp[php$posphp+php4php]php)php php&php php0xphp8php0php)php php!php=php php0php)php)php php{
php php php php php php php php php php php php php php php php php php php php requirephp_oncephp php'Zendphp/Searchphp/Lucenephp/Exceptionphp.phpphp'php;
php php php php php php php php php php php php php php php php php php php php throwphp newphp Zendphp_Searchphp_Lucenephp_Exceptionphp(php'Largestphp supportedphp segmentphp sizephp php(forphp php3php2php-bitphp modephp)php isphp php2Gbphp'php)php;
php php php php php php php php php php php php php php php php php php}

php php php php php php php php php php php php php$indexTermCountphp php=php ordphp(php$dataphp[php$posphp+php4php]php)php <php<php php2php4php php php|
php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php ordphp(php$dataphp[php$posphp+php5php]php)php <php<php php1php6php php php|
php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php ordphp(php$dataphp[php$posphp+php6php]php)php <php<php php8php php php php|
php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php ordphp(php$dataphp[php$posphp+php7php]php)php;
php php php php php php php php php}
php php php php php php php php php$posphp php+php=php php8php;

php php php php php php php php php/php/php php php php php php php php php php php php php php php php php php php$tiiFilephp-php>readIntphp(php)php;php php php/php/php IndexInterval
php php php php php php php php php$posphp php+php=php php4php;

php php php php php php php php php/php/php php$skipIntervalphp php php php=php php$tiiFilephp-php>readIntphp(php)php;
php php php php php php php php php$skipIntervalphp php=php ordphp(php$dataphp[php$posphp]php)php <php<php php2php4php php|php ordphp(php$dataphp[php$posphp+php1php]php)php <php<php php1php6php php|php ordphp(php$dataphp[php$posphp+php2php]php)php <php<php php8php php php|php ordphp(php$dataphp[php$posphp+php3php]php)php;
php php php php php php php php php$posphp php+php=php php4php;
php php php php php php php php ifphp php(php$indexTermCountphp <php php1php)php php{
php php php php php php php php php php php php requirephp_oncephp php'Zendphp/Searchphp/Lucenephp/Exceptionphp.phpphp'php;
php php php php php php php php php php php php throwphp newphp Zendphp_Searchphp_Lucenephp_Exceptionphp(php'Wrongphp numberphp ofphp termsphp inphp aphp termphp dictionaryphp indexphp'php)php;
php php php php php php php php php}

php php php php php php php php ifphp php(php$tiVersionphp php=php=php php(intphp)php0xFFFFFFFDphp php/php*php php2php.php1php+php formatphp php*php/php)php php{
php php php php php php php php php php php php php/php*php Skipphp MaxSkipLevelsphp valuephp php*php/
php php php php php php php php php php php php php$posphp php+php=php php4php;
php php php php php php php php php}

php php php php php php php php php$prevTermphp php php php php php=php php'php'php;
php php php php php php php php php$freqPointerphp php php=php php php0php;
php php php php php php php php php$proxPointerphp php php=php php php0php;
php php php php php php php php php$indexPointerphp php=php php php0php;
php php php php php php php php forphp php(php$countphp php=php php0php;php php$countphp <php php$indexTermCountphp;php php$countphp+php+php)php php{
php php php php php php php php php php php php php/php/php$termPrefixLengthphp php=php php$tiiFilephp-php>readVIntphp(php)php;
php php php php php php php php php php php php php$nbytephp php=php ordphp(php$dataphp[php$posphp+php+php]php)php;
php php php php php php php php php php php php php$termPrefixLengthphp php=php php$nbytephp php&php php0xphp7Fphp;
php php php php php php php php php php php php forphp php(php$shiftphp=php7php;php php(php$nbytephp php&php php0xphp8php0php)php php!php=php php0php;php php$shiftphp php+php=php php7php)php php{
php php php php php php php php php php php php php php php php php$nbytephp php=php ordphp(php$dataphp[php$posphp+php+php]php)php;
php php php php php php php php php php php php php php php php php$termPrefixLengthphp php|php=php php(php$nbytephp php&php php0xphp7Fphp)php <php<php php$shiftphp;
php php php php php php php php php php php php php}

php php php php php php php php php php php php php/php/php php$termSuffixphp php php php php php php php=php php$tiiFilephp-php>readStringphp(php)php;
php php php php php php php php php php php php php$nbytephp php=php ordphp(php$dataphp[php$posphp+php+php]php)php;
php php php php php php php php php php php php php$lenphp php=php php$nbytephp php&php php0xphp7Fphp;
php php php php php php php php php php php php forphp php(php$shiftphp=php7php;php php(php$nbytephp php&php php0xphp8php0php)php php!php=php php0php;php php$shiftphp php+php=php php7php)php php{
php php php php php php php php php php php php php php php php php$nbytephp php=php ordphp(php$dataphp[php$posphp+php+php]php)php;
php php php php php php php php php php php php php php php php php$lenphp php|php=php php(php$nbytephp php&php php0xphp7Fphp)php <php<php php$shiftphp;
php php php php php php php php php php php php php}
php php php php php php php php php php php php ifphp php(php$lenphp php=php=php php0php)php php{
php php php php php php php php php php php php php php php php php$termSuffixphp php=php php'php'php;
php php php php php php php php php php php php php}php elsephp php{
php php php php php php php php php php php php php php php php php$termSuffixphp php=php substrphp(php$dataphp,php php$posphp,php php$lenphp)php;
php php php php php php php php php php php php php php php php php$posphp php+php=php php$lenphp;
php php php php php php php php php php php php php php php php forphp php(php$countphp1php php=php php0php;php php$countphp1php <php php$lenphp;php php$countphp1php+php+php php)php php{
php php php php php php php php php php php php php php php php php php php php ifphp php(php(php ordphp(php$termSuffixphp[php$countphp1php]php)php php&php php0xCphp0php php)php php=php=php php0xCphp0php)php php{
php php php php php php php php php php php php php php php php php php php php php php php php php$addBytesphp php=php php1php;
php php php php php php php php php php php php php php php php php php php php php php php php ifphp php(ordphp(php$termSuffixphp[php$countphp1php]php)php php&php php0xphp2php0php php)php php{
php php php php php php php php php php php php php php php php php php php php php php php php php php php php php$addBytesphp+php+php;

php php php php php php php php php php php php php php php php php php php php php php php php php php php php php/php/php Neverphp usedphp forphp Javaphp Lucenephp createdphp indexphp.
php php php php php php php php php php php php php php php php php php php php php php php php php php php php php/php/php Javaphp2php doesnphp'tphp encodephp stringsphp inphp fourphp bytes
php php php php php php php php php php php php php php php php php php php php php php php php php php php php ifphp php(ordphp(php$termSuffixphp[php$countphp1php]php)php php&php php0xphp1php0php php)php php{
php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php$addBytesphp+php+php;
php php php php php php php php php php php php php php php php php php php php php php php php php php php php php}
php php php php php php php php php php php php php php php php php php php php php php php php php}
php php php php php php php php php php php php php php php php php php php php php php php php php$termSuffixphp php.php=php substrphp(php$dataphp,php php$posphp,php php$addBytesphp)php;
php php php php php php php php php php php php php php php php php php php php php php php php php$posphp php+php=php php$addBytesphp;
php php php php php php php php php php php php php php php php php php php php php php php php php$lenphp php+php=php php$addBytesphp;

php php php php php php php php php php php php php php php php php php php php php php php php php/php/php Checkphp forphp nullphp characterphp.php Javaphp2php encodesphp nullphp character
php php php php php php php php php php php php php php php php php php php php php php php php php/php/php inphp twophp bytesphp.
php php php php php php php php php php php php php php php php php php php php php php php php ifphp php(ordphp(php$termSuffixphp[php$countphp1php]php)php php=php=php php0xCphp0php php&php&
php php php php php php php php php php php php php php php php php php php php php php php php php php php php ordphp(php$termSuffixphp[php$countphp1php+php1php]php)php php=php=php php0xphp8php0php php php php)php php{
php php php php php php php php php php php php php php php php php php php php php php php php php php php php php$termSuffixphp[php$countphp1php]php php=php php0php;
php php php php php php php php php php php php php php php php php php php php php php php php php php php php php$termSuffixphp php=php substrphp(php$termSuffixphp,php0php,php$countphp1php+php1php)
php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php.php substrphp(php$termSuffixphp,php$countphp1php+php2php)php;
php php php php php php php php php php php php php php php php php php php php php php php php php}
php php php php php php php php php php php php php php php php php php php php php php php php php$countphp1php php+php=php php$addBytesphp;
php php php php php php php php php php php php php php php php php php php php php}
php php php php php php php php php php php php php php php php php}
php php php php php php php php php php php php php}

php php php php php php php php php php php php php/php/php php$termValuephp php php php php php php php php=php Zendphp_Searchphp_Lucenephp_Indexphp_Termphp:php:getPrefixphp(php$prevTermphp,php php$termPrefixLengthphp)php php.php php$termSuffixphp;
php php php php php php php php php php php php php$pbphp php=php php0php;php php$pcphp php=php php0php;
php php php php php php php php php php php php whilephp php(php$pbphp <php strlenphp(php$prevTermphp)php php php&php&php php php$pcphp <php php$termPrefixLengthphp)php php{
php php php php php php php php php php php php php php php php php$charBytesphp php=php php1php;
php php php php php php php php php php php php php php php php ifphp php(php(ordphp(php$prevTermphp[php$pbphp]php)php php&php php0xCphp0php)php php=php=php php0xCphp0php)php php{
php php php php php php php php php php php php php php php php php php php php php$charBytesphp+php+php;
php php php php php php php php php php php php php php php php php php php php ifphp php(ordphp(php$prevTermphp[php$pbphp]php)php php&php php0xphp2php0php php)php php{
php php php php php php php php php php php php php php php php php php php php php php php php php$charBytesphp+php+php;
php php php php php php php php php php php php php php php php php php php php php php php php ifphp php(ordphp(php$prevTermphp[php$pbphp]php)php php&php php0xphp1php0php php)php php{
php php php php php php php php php php php php php php php php php php php php php php php php php php php php php$charBytesphp+php+php;
php php php php php php php php php php php php php php php php php php php php php php php php php}
php php php php php php php php php php php php php php php php php php php php php}
php php php php php php php php php php php php php php php php php}

php php php php php php php php php php php php php php php php ifphp php(php$pbphp php+php php$charBytesphp php>php strlenphp(php$dataphp)php)php php{
php php php php php php php php php php php php php php php php php php php php php/php/php wrongphp character
php php php php php php php php php php php php php php php php php php php php breakphp;
php php php php php php php php php php php php php php php php php}

php php php php php php php php php php php php php php php php php$pcphp+php+php;
php php php php php php php php php php php php php php php php php$pbphp php+php=php php$charBytesphp;
php php php php php php php php php php php php php}
php php php php php php php php php php php php php$termValuephp php=php substrphp(php$prevTermphp,php php0php,php php$pbphp)php php.php php$termSuffixphp;

php php php php php php php php php php php php php/php/php php$termFieldNumphp php php php php php=php php$tiiFilephp-php>readVIntphp(php)php;
php php php php php php php php php php php php php$nbytephp php=php ordphp(php$dataphp[php$posphp+php+php]php)php;
php php php php php php php php php php php php php$termFieldNumphp php=php php$nbytephp php&php php0xphp7Fphp;
php php php php php php php php php php php php forphp php(php$shiftphp=php7php;php php(php$nbytephp php&php php0xphp8php0php)php php!php=php php0php;php php$shiftphp php+php=php php7php)php php{
php php php php php php php php php php php php php php php php php$nbytephp php=php ordphp(php$dataphp[php$posphp+php+php]php)php;
php php php php php php php php php php php php php php php php php$termFieldNumphp php|php=php php(php$nbytephp php&php php0xphp7Fphp)php <php<php php$shiftphp;
php php php php php php php php php php php php php}

php php php php php php php php php php php php php/php/php php$docFreqphp php php php php php php php php php php=php php$tiiFilephp-php>readVIntphp(php)php;
php php php php php php php php php php php php php$nbytephp php=php ordphp(php$dataphp[php$posphp+php+php]php)php;
php php php php php php php php php php php php php$docFreqphp php=php php$nbytephp php&php php0xphp7Fphp;
php php php php php php php php php php php php forphp php(php$shiftphp=php7php;php php(php$nbytephp php&php php0xphp8php0php)php php!php=php php0php;php php$shiftphp php+php=php php7php)php php{
php php php php php php php php php php php php php php php php php$nbytephp php=php ordphp(php$dataphp[php$posphp+php+php]php)php;
php php php php php php php php php php php php php php php php php$docFreqphp php|php=php php(php$nbytephp php&php php0xphp7Fphp)php <php<php php$shiftphp;
php php php php php php php php php php php php php}

php php php php php php php php php php php php php/php/php php$freqPointerphp php php php php php+php=php php$tiiFilephp-php>readVIntphp(php)php;
php php php php php php php php php php php php php$nbytephp php=php ordphp(php$dataphp[php$posphp+php+php]php)php;
php php php php php php php php php php php php php$vintphp php=php php$nbytephp php&php php0xphp7Fphp;
php php php php php php php php php php php php forphp php(php$shiftphp=php7php;php php(php$nbytephp php&php php0xphp8php0php)php php!php=php php0php;php php$shiftphp php+php=php php7php)php php{
php php php php php php php php php php php php php php php php php$nbytephp php=php ordphp(php$dataphp[php$posphp+php+php]php)php;
php php php php php php php php php php php php php php php php php$vintphp php|php=php php(php$nbytephp php&php php0xphp7Fphp)php <php<php php$shiftphp;
php php php php php php php php php php php php php}
php php php php php php php php php php php php php$freqPointerphp php+php=php php$vintphp;

php php php php php php php php php php php php php/php/php php$proxPointerphp php php php php php+php=php php$tiiFilephp-php>readVIntphp(php)php;
php php php php php php php php php php php php php$nbytephp php=php ordphp(php$dataphp[php$posphp+php+php]php)php;
php php php php php php php php php php php php php$vintphp php=php php$nbytephp php&php php0xphp7Fphp;
php php php php php php php php php php php php forphp php(php$shiftphp=php7php;php php(php$nbytephp php&php php0xphp8php0php)php php!php=php php0php;php php$shiftphp php+php=php php7php)php php{
php php php php php php php php php php php php php php php php php$nbytephp php=php ordphp(php$dataphp[php$posphp+php+php]php)php;
php php php php php php php php php php php php php php php php php$vintphp php|php=php php(php$nbytephp php&php php0xphp7Fphp)php <php<php php$shiftphp;
php php php php php php php php php php php php php}
php php php php php php php php php php php php php$proxPointerphp php+php=php php$vintphp;

php php php php php php php php php php php php ifphp(php php$docFreqphp php>php=php php$skipIntervalphp php)php php{
php php php php php php php php php php php php php php php php php/php/php php$skipDeltaphp php=php php$tiiFilephp-php>readVIntphp(php)php;
php php php php php php php php php php php php php php php php php$nbytephp php=php ordphp(php$dataphp[php$posphp+php+php]php)php;
php php php php php php php php php php php php php php php php php$vintphp php=php php$nbytephp php&php php0xphp7Fphp;
php php php php php php php php php php php php php php php php forphp php(php$shiftphp=php7php;php php(php$nbytephp php&php php0xphp8php0php)php php!php=php php0php;php php$shiftphp php+php=php php7php)php php{
php php php php php php php php php php php php php php php php php php php php php$nbytephp php=php ordphp(php$dataphp[php$posphp+php+php]php)php;
php php php php php php php php php php php php php php php php php php php php php$vintphp php|php=php php(php$nbytephp php&php php0xphp7Fphp)php <php<php php$shiftphp;
php php php php php php php php php php php php php php php php php}
php php php php php php php php php php php php php php php php php$skipDeltaphp php=php php$vintphp;
php php php php php php php php php php php php php}php elsephp php{
php php php php php php php php php php php php php php php php php$skipDeltaphp php=php php0php;
php php php php php php php php php php php php php}

php php php php php php php php php php php php php/php/php php$indexPointerphp php+php=php php$tiiFilephp-php>readVIntphp(php)php;
php php php php php php php php php php php php php$nbytephp php=php ordphp(php$dataphp[php$posphp+php+php]php)php;
php php php php php php php php php php php php php$vintphp php=php php$nbytephp php&php php0xphp7Fphp;
php php php php php php php php php php php php forphp php(php$shiftphp=php7php;php php(php$nbytephp php&php php0xphp8php0php)php php!php=php php0php;php php$shiftphp php+php=php php7php)php php{
php php php php php php php php php php php php php php php php php$nbytephp php=php ordphp(php$dataphp[php$posphp+php+php]php)php;
php php php php php php php php php php php php php php php php php$vintphp php|php=php php(php$nbytephp php&php php0xphp7Fphp)php <php<php php$shiftphp;
php php php php php php php php php php php php php}
php php php php php php php php php php php php php$indexPointerphp php+php=php php$vintphp;


php php php php php php php php php php php php php/php/php php$thisphp-php>php_termDictionaryphp[php]php php=php php newphp Zendphp_Searchphp_Lucenephp_Indexphp_Termphp(php$termValuephp,php php$termFieldNumphp)php;
php php php php php php php php php php php php php$termDictionaryphp[php]php php=php arrayphp(php$termFieldNumphp,php php$termValuephp)php;

php php php php php php php php php php php php php$termInfosphp[php]php php=
php php php php php php php php php php php php php php php php php php/php/php newphp Zendphp_Searchphp_Lucenephp_Indexphp_TermInfophp(php$docFreqphp,php php$freqPointerphp,php php$proxPointerphp,php php$skipDeltaphp,php php$indexPointerphp)php;
php php php php php php php php php php php php php php php php php arrayphp(php$docFreqphp,php php$freqPointerphp,php php$proxPointerphp,php php$skipDeltaphp,php php$indexPointerphp)php;

php php php php php php php php php php php php php$prevTermphp php=php php$termValuephp;
php php php php php php php php php}

php php php php php php php php php/php/php Checkphp specialphp indexphp entryphp mark
php php php php php php php php ifphp php(php$termDictionaryphp[php0php]php[php0php]php php!php=php php(intphp)php0xFFFFFFFFphp)php php{
php php php php php php php php php php php php requirephp_oncephp php'Zendphp/Searchphp/Lucenephp/Exceptionphp.phpphp'php;
php php php php php php php php php php php php throwphp newphp Zendphp_Searchphp_Lucenephp_Exceptionphp(php'Wrongphp TermInfoIndexFilephp filephp formatphp'php)php;
php php php php php php php php php}

php php php php php php php php ifphp php(PHPphp_INTphp_SIZEphp php>php php4php)php php{
php php php php php php php php php php php php php/php/php Treatphp php6php4php-bitphp php0xFFFFFFFFphp asphp php-php1
php php php php php php php php php php php php php$termDictionaryphp[php0php]php[php0php]php php=php php-php1php;
php php php php php php php php php}

php php php php php php php php returnphp arrayphp(php$termDictionaryphp,php php$termInfosphp)php;
php php php php php}
php}

