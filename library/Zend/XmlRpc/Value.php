<php?php
php/php*php*
php php*php Zendphp Framework
php php*
php php*php LICENSE
php php*
php php*php Thisphp sourcephp filephp isphp subjectphp tophp thephp newphp BSDphp licensephp thatphp isphp bundled
php php*php withphp thisphp packagephp inphp thephp filephp LICENSEphp.txtphp.
php php*php Itphp isphp alsophp availablephp throughphp thephp worldphp-widephp-webphp atphp thisphp URLphp:
php php*php httpphp:php/php/frameworkphp.zendphp.comphp/licensephp/newphp-bsd
php php*php Ifphp youphp didphp notphp receivephp aphp copyphp ofphp thephp licensephp andphp arephp unablephp to
php php*php obtainphp itphp throughphp thephp worldphp-widephp-webphp,php pleasephp sendphp anphp email
php php*php tophp licensephp@zendphp.comphp sophp wephp canphp sendphp youphp aphp copyphp immediatelyphp.
php php*
php php*php php@categoryphp php php Zend
php php*php php@packagephp php php php Zendphp_XmlRpc
php php*php php@subpackagephp Value
php php*php php@copyrightphp php Copyrightphp php(cphp)php php2php0php0php5php-php2php0php1php0php Zendphp Technologiesphp USAphp Incphp.php php(httpphp:php/php/wwwphp.zendphp.comphp)
php php*php php@licensephp php php php httpphp:php/php/frameworkphp.zendphp.comphp/licensephp/newphp-bsdphp php php php php Newphp BSDphp License
php php*php php@versionphp php php php php$Idphp:php Valuephp.phpphp php2php3php5php8php4php php2php0php1php0php-php1php2php-php2php8php php1php9php:php5php1php:php4php9Zphp matthewphp php$
php php*php/

php/php*php*
php php*php Representphp aphp nativephp XMLphp-RPCphp valuephp entityphp,php usedphp asphp parametersphp forphp thephp methods
php php*php calledphp byphp thephp Zendphp_XmlRpcphp_Clientphp objectphp andphp asphp thephp returnphp valuephp forphp thosephp callsphp.
php php*
php php*php Thisphp objectphp asphp aphp veryphp importantphp staticphp functionphp Zendphp_XmlRpcphp_Valuephp:php:getXmlRpcValuephp,php this
php php*php functionphp actsphp likesphp aphp factoryphp forphp thephp Zendphp_XmlRpcphp_Valuephp objects
php php*
php php*php Usingphp thisphp functionphp,php usersphp/Zendphp_XmlRpcphp_Clientphp objectphp canphp createphp thephp Zendphp_XmlRpcphp_Valuephp objects
php php*php fromphp PHPphp variablesphp,php XMLphp stringphp orphp byphp specifingphp thephp exactphp XMLphp-RPCphp natviephp type
php php*
php php*php php@packagephp php php php Zendphp_XmlRpc
php php*php php@copyrightphp php Copyrightphp php(cphp)php php2php0php0php5php-php2php0php1php0php Zendphp Technologiesphp USAphp Incphp.php php(httpphp:php/php/wwwphp.zendphp.comphp)
php php*php php@licensephp php php php httpphp:php/php/frameworkphp.zendphp.comphp/licensephp/newphp-bsdphp php php php php Newphp BSDphp License
php php*php/
abstractphp classphp Zendphp_XmlRpcphp_Value
php{
php php php php php/php*php*
php php php php php php*php Thephp nativephp XMLphp-RPCphp representationphp ofphp thisphp objectphp'sphp value
php php php php php php*
php php php php php php*php Ifphp thephp nativephp typephp ofphp thisphp objectphp isphp arrayphp orphp structphp,php thisphp willphp bephp anphp array
php php php php php php*php ofphp Zendphp_XmlRpcphp_Valuephp objects
php php php php php php*php/
php php php php protectedphp php$php_valuephp;

php php php php php/php*php*
php php php php php php*php Thephp nativephp XMLphp-RPCphp typephp ofphp thisphp object
php php php php php php*php Onephp ofphp thephp XMLRPCphp_TYPEphp_php*php constants
php php php php php php*php/
php php php php protectedphp php$php_typephp;

php php php php php/php*php*
php php php php php php*php XMLphp codephp representationphp ofphp thisphp objectphp php(willphp bephp calculatedphp onlyphp oncephp)
php php php php php php*php/
php php php php protectedphp php$php_xmlphp;

php php php php php/php*php*
php php php php php php*php php@varphp Zendphp_XmlRpcphp_Generatorphp_GeneratorAbstract
php php php php php php*php/
php php php php protectedphp staticphp php$php_generatorphp;

php php php php php/php*php*
php php php php php php*php Specifyphp thatphp thephp XMLphp-RPCphp nativephp typephp willphp bephp autophp detectedphp fromphp aphp PHPphp variablephp type
php php php php php php*php/
php php php php constphp AUTOphp_DETECTphp_TYPEphp php=php php'autophp_detectphp'php;

php php php php php/php*php*
php php php php php php*php Specifyphp thatphp thephp XMLphp-RPCphp valuephp willphp bephp parsedphp outphp fromphp aphp givenphp XMLphp code
php php php php php php*php/
php php php php constphp XMLphp_STRINGphp php=php php'xmlphp'php;

php php php php php/php*php*
php php php php php php*php Allphp thephp XMLphp-RPCphp nativephp types
php php php php php php*php/
php php php php constphp XMLRPCphp_TYPEphp_Iphp4php php php php php php php php php=php php'iphp4php'php;
php php php php constphp XMLRPCphp_TYPEphp_INTEGERphp php php php=php php'intphp'php;
php php php php constphp XMLRPCphp_TYPEphp_Iphp8php php php php php php php php php=php php'iphp8php'php;
php php php php constphp XMLRPCphp_TYPEphp_APACHEIphp8php php php=php php'exphp:iphp8php'php;
php php php php constphp XMLRPCphp_TYPEphp_DOUBLEphp php php php php=php php'doublephp'php;
php php php php constphp XMLRPCphp_TYPEphp_BOOLEANphp php php php=php php'booleanphp'php;
php php php php constphp XMLRPCphp_TYPEphp_STRINGphp php php php php=php php'stringphp'php;
php php php php constphp XMLRPCphp_TYPEphp_DATETIMEphp php php=php php'dateTimephp.isophp8php6php0php1php'php;
php php php php constphp XMLRPCphp_TYPEphp_BASEphp6php4php php php php php=php php'basephp6php4php'php;
php php php php constphp XMLRPCphp_TYPEphp_ARRAYphp php php php php php=php php'arrayphp'php;
php php php php constphp XMLRPCphp_TYPEphp_STRUCTphp php php php php=php php'structphp'php;
php php php php constphp XMLRPCphp_TYPEphp_NILphp php php php php php php php=php php'nilphp'php;
php php php php constphp XMLRPCphp_TYPEphp_APACHENILphp php=php php'exphp:nilphp'php;

php php php php php/php*php*
php php php php php php*php Getphp thephp nativephp XMLphp-RPCphp typephp php(thephp typephp isphp onephp ofphp thephp Zendphp_XmlRpcphp_Valuephp:php:XMLRPCphp_TYPEphp_php*php constantsphp)
php php php php php php*
php php php php php php*php php@returnphp string
php php php php php php*php/
php php php php publicphp functionphp getTypephp(php)
php php php php php{
php php php php php php php php returnphp php$thisphp-php>php_typephp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Getphp XMLphp generatorphp instance
php php php php php php*
php php php php php php*php php@returnphp Zendphp_XmlRpcphp_Generatorphp_GeneratorAbstract
php php php php php php*php/
php php php php publicphp staticphp functionphp getGeneratorphp(php)
php php php php php{
php php php php php php php php ifphp php(php!selfphp:php:php$php_generatorphp)php php{
php php php php php php php php php php php php ifphp php(extensionphp_loadedphp(php'xmlwriterphp'php)php)php php{
php php php php php php php php php php php php php php php php requirephp_oncephp php'Zendphp/XmlRpcphp/Generatorphp/XmlWriterphp.phpphp'php;
php php php php php php php php php php php php php php php php selfphp:php:php$php_generatorphp php=php newphp Zendphp_XmlRpcphp_Generatorphp_XmlWriterphp(php)php;
php php php php php php php php php php php php php}php elsephp php{
php php php php php php php php php php php php php php php php requirephp_oncephp php'Zendphp/XmlRpcphp/Generatorphp/DomDocumentphp.phpphp'php;
php php php php php php php php php php php php php php php php selfphp:php:php$php_generatorphp php=php newphp Zendphp_XmlRpcphp_Generatorphp_DomDocumentphp(php)php;
php php php php php php php php php php php php php}
php php php php php php php php php}

php php php php php php php php returnphp selfphp:php:php$php_generatorphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Setsphp XMLphp generatorphp instance
php php php php php php*
php php php php php php*php php@paramphp Zendphp_XmlRpcphp_Generatorphp_GeneratorAbstractphp php$generator
php php php php php php*php php@returnphp void
php php php php php php*php/
php php php php publicphp staticphp functionphp setGeneratorphp(Zendphp_XmlRpcphp_Generatorphp_GeneratorAbstractphp php$generatorphp)
php php php php php{
php php php php php php php php selfphp:php:php$php_generatorphp php=php php$generatorphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Changesphp thephp encodingphp ofphp thephp generator
php php php php php php*
php php php php php php*php php@paramphp stringphp php$encoding
php php php php php php*php php@returnphp void
php php php php php php*php/
php php php php publicphp staticphp functionphp setEncodingphp(php$encodingphp)
php php php php php{
php php php php php php php php php$generatorphp php=php selfphp:php:getGeneratorphp(php)php;
php php php php php php php php php$newGeneratorphp php=php newphp php$generatorphp(php$encodingphp)php;
php php php php php php php php selfphp:php:setGeneratorphp(php$newGeneratorphp)php;
php php php php php}

php php php php php/php*php*
php php php php php php*php Returnphp thephp valuephp ofphp thisphp objectphp,php convertphp thephp XMLphp-RPCphp nativephp valuephp intophp aphp PHPphp variable
php php php php php php*
php php php php php php*php php@returnphp mixed
php php php php php php*php/
php php php php abstractphp publicphp functionphp getValuephp(php)php;


php php php php php/php*php*
php php php php php php*php Returnphp thephp XMLphp codephp thatphp representphp aphp nativephp MXLphp-RPCphp value
php php php php php php*
php php php php php php*php php@returnphp string
php php php php php php*php/
php php php php publicphp functionphp saveXmlphp(php)
php php php php php{
php php php php php php php php ifphp php(php!php$thisphp-php>php_xmlphp)php php{
php php php php php php php php php php php php php$thisphp-php>generateXmlphp(php)php;
php php php php php php php php php php php php php$thisphp-php>php_xmlphp php=php php(stringphp)php php$thisphp-php>getGeneratorphp(php)php;
php php php php php php php php php}
php php php php php php php php returnphp php$thisphp-php>php_xmlphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Generatephp XMLphp codephp thatphp representphp aphp nativephp XMLphp/RPCphp value
php php php php php php*
php php php php php php*php php@returnphp void
php php php php php php*php/
php php php php publicphp functionphp generateXmlphp(php)
php php php php php{
php php php php php php php php php$thisphp-php>php_generateXmlphp(php)php;
php php php php php}

php php php php php/php*php*
php php php php php php*php Createsphp aphp Zendphp_XmlRpcphp_Valuephp*php objectphp,php representingphp aphp nativephp XMLphp-RPCphp value
php php php php php php*php Aphp XmlRpcValuephp objectphp canphp bephp createdphp inphp php3php waysphp:
php php php php php php*php php1php.php Autodetectingphp thephp nativephp typephp outphp ofphp aphp PHPphp variable
php php php php php php*php php php php php(ifphp php$typephp isphp notphp setphp orphp equalphp tophp Zendphp_XmlRpcphp_Valuephp:php:AUTOphp_DETECTphp_TYPEphp)
php php php php php php*php php2php.php Byphp specifingphp thephp nativephp typephp php(php$typephp isphp onephp ofphp thephp Zendphp_XmlRpcphp_Valuephp:php:XMLRPCphp_TYPEphp_php*php constantsphp)
php php php php php php*php php3php.php Fromphp aphp XMLphp stringphp php(php$typephp isphp setphp tophp Zendphp_XmlRpcphp_Valuephp:php:XMLphp_STRINGphp)
php php php php php php*
php php php php php php*php Byphp defaultphp thephp valuephp typephp isphp autodetectedphp accordingphp tophp itphp'sphp PHPphp type
php php php php php php*
php php php php php php*php php@paramphp mixedphp php$value
php php php php php php*php php@paramphp Zendphp_XmlRpcphp_Valuephp:php:constantphp php$type
php php php php php php*
php php php php php php*php php@returnphp Zendphp_XmlRpcphp_Value
php php php php php php*php php@static
php php php php php php*php/
php php php php publicphp staticphp functionphp getXmlRpcValuephp(php$valuephp,php php$typephp php=php selfphp:php:AUTOphp_DETECTphp_TYPEphp)
php php php php php{
php php php php php php php php switchphp php(php$typephp)php php{
php php php php php php php php php php php php casephp selfphp:php:AUTOphp_DETECTphp_TYPEphp:
php php php php php php php php php php php php php php php php php/php/php Autophp detectphp thephp XMLphp-RPCphp nativephp typephp fromphp thephp PHPphp typephp ofphp php$value
php php php php php php php php php php php php php php php php returnphp selfphp:php:php_phpVarToNativeXmlRpcphp(php$valuephp)php;

php php php php php php php php php php php php casephp selfphp:php:XMLphp_STRINGphp:
php php php php php php php php php php php php php php php php php/php/php Parsephp thephp XMLphp stringphp givenphp inphp php$valuephp andphp getphp thephp XMLphp-RPCphp valuephp inphp it
php php php php php php php php php php php php php php php php returnphp selfphp:php:php_xmlStringToNativeXmlRpcphp(php$valuephp)php;

php php php php php php php php php php php php casephp selfphp:php:XMLRPCphp_TYPEphp_Iphp4php:
php php php php php php php php php php php php php php php php php/php/php fallphp throughphp tophp thephp nextphp case
php php php php php php php php php php php php casephp selfphp:php:XMLRPCphp_TYPEphp_INTEGERphp:
php php php php php php php php php php php php php php php php requirephp_oncephp php'Zendphp/XmlRpcphp/Valuephp/Integerphp.phpphp'php;
php php php php php php php php php php php php php php php php returnphp newphp Zendphp_XmlRpcphp_Valuephp_Integerphp(php$valuephp)php;

php php php php php php php php php php php php casephp selfphp:php:XMLRPCphp_TYPEphp_Iphp8php:
php php php php php php php php php php php php php php php php php/php/php fallphp throughphp tophp thephp nextphp case
php php php php php php php php php php php php casephp selfphp:php:XMLRPCphp_TYPEphp_APACHEIphp8php:
php php php php php php php php php php php php php php php php requirephp_oncephp php'Zendphp/XmlRpcphp/Valuephp/BigIntegerphp.phpphp'php;
php php php php php php php php php php php php php php php php returnphp newphp Zendphp_XmlRpcphp_Valuephp_BigIntegerphp(php$valuephp)php;

php php php php php php php php php php php php casephp selfphp:php:XMLRPCphp_TYPEphp_DOUBLEphp:
php php php php php php php php php php php php php php php php requirephp_oncephp php'Zendphp/XmlRpcphp/Valuephp/Doublephp.phpphp'php;
php php php php php php php php php php php php php php php php returnphp newphp Zendphp_XmlRpcphp_Valuephp_Doublephp(php$valuephp)php;

php php php php php php php php php php php php casephp selfphp:php:XMLRPCphp_TYPEphp_BOOLEANphp:
php php php php php php php php php php php php php php php php requirephp_oncephp php'Zendphp/XmlRpcphp/Valuephp/Booleanphp.phpphp'php;
php php php php php php php php php php php php php php php php returnphp newphp Zendphp_XmlRpcphp_Valuephp_Booleanphp(php$valuephp)php;

php php php php php php php php php php php php casephp selfphp:php:XMLRPCphp_TYPEphp_STRINGphp:
php php php php php php php php php php php php php php php php requirephp_oncephp php'Zendphp/XmlRpcphp/Valuephp/Stringphp.phpphp'php;
php php php php php php php php php php php php php php php php returnphp newphp Zendphp_XmlRpcphp_Valuephp_Stringphp(php$valuephp)php;

php php php php php php php php php php php php casephp selfphp:php:XMLRPCphp_TYPEphp_BASEphp6php4php:
php php php php php php php php php php php php php php php php requirephp_oncephp php'Zendphp/XmlRpcphp/Valuephp/Basephp6php4php.phpphp'php;
php php php php php php php php php php php php php php php php returnphp newphp Zendphp_XmlRpcphp_Valuephp_Basephp6php4php(php$valuephp)php;

php php php php php php php php php php php php casephp selfphp:php:XMLRPCphp_TYPEphp_NILphp:
php php php php php php php php php php php php php php php php php/php/php fallphp throughphp tophp thephp nextphp case
php php php php php php php php php php php php casephp selfphp:php:XMLRPCphp_TYPEphp_APACHENILphp:
php php php php php php php php php php php php php php php php requirephp_oncephp php'Zendphp/XmlRpcphp/Valuephp/Nilphp.phpphp'php;
php php php php php php php php php php php php php php php php returnphp newphp Zendphp_XmlRpcphp_Valuephp_Nilphp(php)php;

php php php php php php php php php php php php casephp selfphp:php:XMLRPCphp_TYPEphp_DATETIMEphp:
php php php php php php php php php php php php php php php php requirephp_oncephp php'Zendphp/XmlRpcphp/Valuephp/DateTimephp.phpphp'php;
php php php php php php php php php php php php php php php php returnphp newphp Zendphp_XmlRpcphp_Valuephp_DateTimephp(php$valuephp)php;

php php php php php php php php php php php php casephp selfphp:php:XMLRPCphp_TYPEphp_ARRAYphp:
php php php php php php php php php php php php php php php php requirephp_oncephp php'Zendphp/XmlRpcphp/Valuephp/Arrayphp.phpphp'php;
php php php php php php php php php php php php php php php php returnphp newphp Zendphp_XmlRpcphp_Valuephp_Arrayphp(php$valuephp)php;

php php php php php php php php php php php php casephp selfphp:php:XMLRPCphp_TYPEphp_STRUCTphp:
php php php php php php php php php php php php php php php php requirephp_oncephp php'Zendphp/XmlRpcphp/Valuephp/Structphp.phpphp'php;
php php php php php php php php php php php php php php php php returnphp newphp Zendphp_XmlRpcphp_Valuephp_Structphp(php$valuephp)php;

php php php php php php php php php php php php defaultphp:
php php php php php php php php php php php php php php php php requirephp_oncephp php'Zendphp/XmlRpcphp/Valuephp/Exceptionphp.phpphp'php;
php php php php php php php php php php php php php php php php throwphp newphp Zendphp_XmlRpcphp_Valuephp_Exceptionphp(php'Givenphp typephp isphp notphp aphp php'php.php php_php_CLASSphp_php_php php.php'php constantphp'php)php;
php php php php php php php php php}
php php php php php}

php php php php php/php*php*
php php php php php php*php Getphp XMLphp-RPCphp typephp forphp aphp PHPphp nativephp variable
php php php php php php*
php php php php php php*php php@static
php php php php php php*php php@paramphp mixedphp php$value
php php php php php php*php php@returnphp string
php php php php php php*php/
php php php php publicphp staticphp functionphp getXmlRpcTypeByValuephp(php$valuephp)
php php php php php{
php php php php php php php php ifphp php(isphp_objectphp(php$valuephp)php)php php{
php php php php php php php php php php php php ifphp php(php$valuephp instanceofphp Zendphp_XmlRpcphp_Valuephp)php php{
php php php php php php php php php php php php php php php php returnphp php$valuephp-php>getTypephp(php)php;
php php php php php php php php php php php php php}php elseifphp php(php(php$valuephp instanceofphp Zendphp_Datephp)php php|php|php php(php$valuephp instanceofphp DateTimephp)php)php php{
php php php php php php php php php php php php php php php php returnphp selfphp:php:XMLRPCphp_TYPEphp_DATETIMEphp;
php php php php php php php php php php php php php}
php php php php php php php php php php php php returnphp selfphp:php:getXmlRpcTypeByValuephp(getphp_objectphp_varsphp(php$valuephp)php)php;
php php php php php php php php php}php elseifphp php(isphp_arrayphp(php$valuephp)php)php php{
php php php php php php php php php php php php ifphp php(php!emptyphp(php$valuephp)php php&php&php isphp_arrayphp(php$valuephp)php php&php&php php(arrayphp_keysphp(php$valuephp)php php!php=php=php rangephp(php0php,php countphp(php$valuephp)php php-php php1php)php)php)php php{
php php php php php php php php php php php php php php php php returnphp selfphp:php:XMLRPCphp_TYPEphp_STRUCTphp;
php php php php php php php php php php php php php}
php php php php php php php php php php php php returnphp selfphp:php:XMLRPCphp_TYPEphp_ARRAYphp;
php php php php php php php php php}php elseifphp php(isphp_intphp(php$valuephp)php)php php{
php php php php php php php php php php php php returnphp php(php$valuephp php>php PHPphp_INTphp_MAXphp)php php?php selfphp:php:XMLRPCphp_TYPEphp_Iphp8php php:php selfphp:php:XMLRPCphp_TYPEphp_INTEGERphp;
php php php php php php php php php}php elseifphp php(isphp_doublephp(php$valuephp)php)php php{
php php php php php php php php php php php php returnphp selfphp:php:XMLRPCphp_TYPEphp_DOUBLEphp;
php php php php php php php php php}php elseifphp php(isphp_boolphp(php$valuephp)php)php php{
php php php php php php php php php php php php returnphp selfphp:php:XMLRPCphp_TYPEphp_BOOLEANphp;
php php php php php php php php php}php elseifphp php(isphp_nullphp(php$valuephp)php)php php{
php php php php php php php php php php php php returnphp selfphp:php:XMLRPCphp_TYPEphp_NILphp;
php php php php php php php php php}php elseifphp php(isphp_stringphp(php$valuephp)php)php php{
php php php php php php php php php php php php returnphp selfphp:php:XMLRPCphp_TYPEphp_STRINGphp;
php php php php php php php php php}
php php php php php php php php throwphp newphp Zendphp_XmlRpcphp_Valuephp_Exceptionphp(sprintfphp(
php php php php php php php php php php php php php'Nophp matchingphp XMLRPCphp typephp foundphp forphp phpphp typephp php%sphp.php'php,
php php php php php php php php php php php php gettypephp(php$valuephp)
php php php php php php php php php)php)php;
php php php php php}

php php php php php/php*php*
php php php php php php*php Transformphp aphp PHPphp nativephp variablephp intophp aphp XMLphp-RPCphp nativephp value
php php php php php php*
php php php php php php*php php@paramphp mixedphp php$valuephp Thephp PHPphp variablephp forphp convertion
php php php php php php*
php php php php php php*php php@returnphp Zendphp_XmlRpcphp_Value
php php php php php php*php php@static
php php php php php php*php/
php php php php protectedphp staticphp functionphp php_phpVarToNativeXmlRpcphp(php$valuephp)
php php php php php{
php php php php php php php php php/php/php php@seephp httpphp:php/php/frameworkphp.zendphp.comphp/issuesphp/browsephp/ZFphp-php8php6php2php3
php php php php php php php php ifphp php(isphp_objectphp(php$valuephp)php)php php{
php php php php php php php php php php php php ifphp php(php$valuephp instanceofphp Zendphp_XmlRpcphp_Valuephp)php php{
php php php php php php php php php php php php php php php php returnphp php$valuephp;
php php php php php php php php php php php php php}
php php php php php php php php php php php php ifphp php(php$valuephp instanceofphp Zendphp_Cryptphp_Mathphp_BigIntegerphp)php php{
php php php php php php php php php php php php php php php php requirephp_oncephp php'Zendphp/XmlRpcphp/Valuephp/Exceptionphp.phpphp'php;
php php php php php php php php php php php php php php php php throwphp newphp Zendphp_XmlRpcphp_Valuephp_Exceptionphp(
php php php php php php php php php php php php php php php php php php php php php'Usingphp Zendphp_Cryptphp_Mathphp_BigIntegerphp tophp getphp anphp php'php php.
php php php php php php php php php php php php php php php php php php php php php'instancephp ofphp Zendphp_XmlRpcphp_Valuephp_BigIntegerphp isphp notphp php'php php.
php php php php php php php php php php php php php php php php php php php php php'availablephp anymorephp.php'
php php php php php php php php php php php php php php php php php)php;
php php php php php php php php php php php php php}
php php php php php php php php php}

php php php php php php php php switchphp php(selfphp:php:getXmlRpcTypeByValuephp(php$valuephp)php)
php php php php php php php php php{
php php php php php php php php php php php php casephp selfphp:php:XMLRPCphp_TYPEphp_DATETIMEphp:
php php php php php php php php php php php php php php php php requirephp_oncephp php'Zendphp/XmlRpcphp/Valuephp/DateTimephp.phpphp'php;
php php php php php php php php php php php php php php php php returnphp newphp Zendphp_XmlRpcphp_Valuephp_DateTimephp(php$valuephp)php;

php php php php php php php php php php php php php php php php ifphp php(php$valuephp instanceofphp Zendphp_Cryptphp_Mathphp_BigIntegerphp)php php{
php php php php php php php php php php php php php php php php php php php php requirephp_oncephp php'Zendphp/XmlRpcphp/Valuephp/BigIntegerphp.phpphp'php;
php php php php php php php php php php php php php php php php php php php php returnphp newphp Zendphp_XmlRpcphp_Valuephp_BigIntegerphp(php$valuephp)php;
php php php php php php php php php php php php php php php php php}

php php php php php php php php php php php php php php php php ifphp php(php$valuephp instanceofphp Zendphp_Datephp orphp php$valuephp instanceofphp DateTimephp)php php{
php php php php php php php php php php php php php php php php php php php php requirephp_oncephp php'Zendphp/XmlRpcphp/Valuephp/DateTimephp.phpphp'php;
php php php php php php php php php php php php php php php php php php php php returnphp newphp Zendphp_XmlRpcphp_Valuephp_DateTimephp(php$valuephp)php;
php php php php php php php php php php php php php php php php php}

php php php php php php php php php php php php php php php php php/php/php Otherwisephp,php wephp convertphp thephp objectphp intophp aphp struct
php php php php php php php php php php php php php php php php php$valuephp php=php getphp_objectphp_varsphp(php$valuephp)php;
php php php php php php php php php php php php php php php php php/php/php Breakphp intentionallyphp omitted
php php php php php php php php php php php php casephp php'arrayphp'php:
php php php php php php php php php php php php php php php php php/php/php Defaultphp nativephp typephp forphp aphp PHPphp arrayphp php(aphp simplephp numericphp arrayphp)php isphp php'arrayphp'
php php php php php php php php php php php php php php php php requirephp_oncephp php'Zendphp/XmlRpcphp/Valuephp/Arrayphp.phpphp'php;
php php php php php php php php php php php php php php php php php$objphp php=php php'Zendphp_XmlRpcphp_Valuephp_Arrayphp'php;

php php php php php php php php php php php php php php php php php/php/php Determinephp ifphp thisphp isphp anphp associativephp array
php php php php php php php php php php php php php php php php ifphp php(php!emptyphp(php$valuephp)php php&php&php isphp_arrayphp(php$valuephp)php php&php&php php(arrayphp_keysphp(php$valuephp)php php!php=php=php rangephp(php0php,php countphp(php$valuephp)php php-php php1php)php)php)php php{
php php php php php php php php php php php php php php php php php php php php requirephp_oncephp php'Zendphp/XmlRpcphp/Valuephp/Structphp.phpphp'php;
php php php php php php php php php php php php php php php php php php php php php$objphp php=php php'Zendphp_XmlRpcphp_Valuephp_Structphp'php;
php php php php php php php php php php php php php php php php php}
php php php php php php php php php php php php php php php php returnphp newphp php$objphp(php$valuephp)php;

php php php php php php php php php php php php casephp php'integerphp'php:
php php php php php php php php php php php php php php php php requirephp_oncephp php'Zendphp/XmlRpcphp/Valuephp/Integerphp.phpphp'php;
php php php php php php php php php php php php php php php php returnphp newphp Zendphp_XmlRpcphp_Valuephp_Integerphp(php$valuephp)php;

php php php php php php php php php php php php casephp php'doublephp'php:
php php php php php php php php php php php php php php php php requirephp_oncephp php'Zendphp/XmlRpcphp/Valuephp/Doublephp.phpphp'php;
php php php php php php php php php php php php php php php php returnphp newphp Zendphp_XmlRpcphp_Valuephp_Doublephp(php$valuephp)php;

php php php php php php php php php php php php casephp php'booleanphp'php:
php php php php php php php php php php php php php php php php requirephp_oncephp php'Zendphp/XmlRpcphp/Valuephp/Booleanphp.phpphp'php;
php php php php php php php php php php php php php php php php returnphp newphp Zendphp_XmlRpcphp_Valuephp_Booleanphp(php$valuephp)php;

php php php php php php php php php php php php casephp php'NULLphp'php:
php php php php php php php php php php php php casephp php'nullphp'php:
php php php php php php php php php php php php php php php php requirephp_oncephp php'Zendphp/XmlRpcphp/Valuephp/Nilphp.phpphp'php;
php php php php php php php php php php php php php php php php returnphp newphp Zendphp_XmlRpcphp_Valuephp_Nilphp(php)php;

php php php php php php php php php php php php casephp php'stringphp'php:
php php php php php php php php php php php php php php php php php/php/php Fallphp throughphp tophp thephp nextphp case
php php php php php php php php php php php php defaultphp:
php php php php php php php php php php php php php php php php php/php/php Ifphp typephp isnphp'tphp identifiedphp php(orphp identifiedphp asphp stringphp)php,php itphp treatedphp asphp string
php php php php php php php php php php php php php php php php requirephp_oncephp php'Zendphp/XmlRpcphp/Valuephp/Stringphp.phpphp'php;
php php php php php php php php php php php php php php php php returnphp newphp Zendphp_XmlRpcphp_Valuephp_Stringphp(php$valuephp)php;
php php php php php php php php php}
php php php php php}


php php php php php/php*php*
php php php php php php*php Transformphp anphp XMLphp stringphp intophp aphp XMLphp-RPCphp nativephp value
php php php php php php*
php php php php php php*php php@paramphp stringphp|SimpleXMLElementphp php$xmlphp Aphp SimpleXMLElementphp objectphp representphp thephp XMLphp string
php php php php php php*php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php Itphp canphp bephp alsophp aphp validphp XMLphp stringphp forphp convertion
php php php php php php*
php php php php php php*php php@returnphp Zendphp_XmlRpcphp_Value
php php php php php php*php php@static
php php php php php php*php/
php php php php protectedphp staticphp functionphp php_xmlStringToNativeXmlRpcphp(php$xmlphp)
php php php php php{
php php php php php php php php selfphp:php:php_createSimpleXMLElementphp(php$xmlphp)php;

php php php php php php php php selfphp:php:php_extractTypeAndValuephp(php$xmlphp,php php$typephp,php php$valuephp)php;

php php php php php php php php switchphp php(php$typephp)php php{
php php php php php php php php php php php php php/php/php Allphp validphp andphp knownphp XMLphp-RPCphp nativephp values
php php php php php php php php php php php php casephp selfphp:php:XMLRPCphp_TYPEphp_Iphp4php:
php php php php php php php php php php php php php php php php php/php/php Fallphp throughphp tophp thephp nextphp case
php php php php php php php php php php php php casephp selfphp:php:XMLRPCphp_TYPEphp_INTEGERphp:
php php php php php php php php php php php php php php php php requirephp_oncephp php'Zendphp/XmlRpcphp/Valuephp/Integerphp.phpphp'php;
php php php php php php php php php php php php php php php php php$xmlrpcValuephp php=php newphp Zendphp_XmlRpcphp_Valuephp_Integerphp(php$valuephp)php;
php php php php php php php php php php php php php php php php breakphp;
php php php php php php php php php php php php casephp selfphp:php:XMLRPCphp_TYPEphp_APACHEIphp8php:
php php php php php php php php php php php php php php php php php/php/php Fallphp throughphp tophp thephp nextphp case
php php php php php php php php php php php php casephp selfphp:php:XMLRPCphp_TYPEphp_Iphp8php:
php php php php php php php php php php php php php php php php requirephp_oncephp php'Zendphp/XmlRpcphp/Valuephp/BigIntegerphp.phpphp'php;
php php php php php php php php php php php php php php php php php$xmlrpcValuephp php=php newphp Zendphp_XmlRpcphp_Valuephp_BigIntegerphp(php$valuephp)php;
php php php php php php php php php php php php php php php php breakphp;
php php php php php php php php php php php php casephp selfphp:php:XMLRPCphp_TYPEphp_DOUBLEphp:
php php php php php php php php php php php php php php php php requirephp_oncephp php'Zendphp/XmlRpcphp/Valuephp/Doublephp.phpphp'php;
php php php php php php php php php php php php php php php php php$xmlrpcValuephp php=php newphp Zendphp_XmlRpcphp_Valuephp_Doublephp(php$valuephp)php;
php php php php php php php php php php php php php php php php breakphp;
php php php php php php php php php php php php casephp selfphp:php:XMLRPCphp_TYPEphp_BOOLEANphp:
php php php php php php php php php php php php php php php php requirephp_oncephp php'Zendphp/XmlRpcphp/Valuephp/Booleanphp.phpphp'php;
php php php php php php php php php php php php php php php php php$xmlrpcValuephp php=php newphp Zendphp_XmlRpcphp_Valuephp_Booleanphp(php$valuephp)php;
php php php php php php php php php php php php php php php php breakphp;
php php php php php php php php php php php php casephp selfphp:php:XMLRPCphp_TYPEphp_STRINGphp:
php php php php php php php php php php php php php php php php requirephp_oncephp php'Zendphp/XmlRpcphp/Valuephp/Stringphp.phpphp'php;
php php php php php php php php php php php php php php php php php$xmlrpcValuephp php=php newphp Zendphp_XmlRpcphp_Valuephp_Stringphp(php$valuephp)php;
php php php php php php php php php php php php php php php php breakphp;
php php php php php php php php php php php php casephp selfphp:php:XMLRPCphp_TYPEphp_DATETIMEphp:php php php/php/php Thephp valuephp shouldphp alreadyphp bephp inphp aphp isophp8php6php0php1php format
php php php php php php php php php php php php php php php php requirephp_oncephp php'Zendphp/XmlRpcphp/Valuephp/DateTimephp.phpphp'php;
php php php php php php php php php php php php php php php php php$xmlrpcValuephp php=php newphp Zendphp_XmlRpcphp_Valuephp_DateTimephp(php$valuephp)php;
php php php php php php php php php php php php php php php php breakphp;
php php php php php php php php php php php php casephp selfphp:php:XMLRPCphp_TYPEphp_BASEphp6php4php:php php php php php/php/php Thephp valuephp shouldphp alreadyphp bephp basephp6php4php encoded
php php php php php php php php php php php php php php php php requirephp_oncephp php'Zendphp/XmlRpcphp/Valuephp/Basephp6php4php.phpphp'php;
php php php php php php php php php php php php php php php php php$xmlrpcValuephp php=php newphp Zendphp_XmlRpcphp_Valuephp_Basephp6php4php(php$valuephp,php truephp)php;
php php php php php php php php php php php php php php php php breakphp;
php php php php php php php php php php php php casephp selfphp:php:XMLRPCphp_TYPEphp_NILphp:
php php php php php php php php php php php php php php php php php/php/php Fallphp throughphp tophp thephp nextphp case
php php php php php php php php php php php php casephp selfphp:php:XMLRPCphp_TYPEphp_APACHENILphp:
php php php php php php php php php php php php php php php php php/php/php Thephp valuephp shouldphp alwaysphp bephp NULL
php php php php php php php php php php php php php php php php requirephp_oncephp php'Zendphp/XmlRpcphp/Valuephp/Nilphp.phpphp'php;
php php php php php php php php php php php php php php php php php$xmlrpcValuephp php=php newphp Zendphp_XmlRpcphp_Valuephp_Nilphp(php)php;
php php php php php php php php php php php php php php php php breakphp;
php php php php php php php php php php php php casephp selfphp:php:XMLRPCphp_TYPEphp_ARRAYphp:
php php php php php php php php php php php php php php php php php/php/php PHPphp php5php.php2php.php4php introducedphp aphp regressionphp inphp howphp emptyphp(php$xmlphp-php>valuephp)
php php php php php php php php php php php php php php php php php/php/php returnsphp;php needphp tophp lookphp forphp thephp itemphp specifically
php php php php php php php php php php php php php php php php php$dataphp php=php nullphp;
php php php php php php php php php php php php php php php php foreachphp php(php$valuephp-php>childrenphp(php)php asphp php$keyphp php=php>php php$valuephp)php php{
php php php php php php php php php php php php php php php php php php php php ifphp php(php'dataphp'php php=php=php php$keyphp)php php{
php php php php php php php php php php php php php php php php php php php php php php php php php$dataphp php=php php$valuephp;
php php php php php php php php php php php php php php php php php php php php php php php php breakphp;
php php php php php php php php php php php php php php php php php php php php php}
php php php php php php php php php php php php php php php php php}

php php php php php php php php php php php php php php php php ifphp php(nullphp php=php=php=php php$dataphp)php php{
php php php php php php php php php php php php php php php php php php php php requirephp_oncephp php'Zendphp/XmlRpcphp/Valuephp/Exceptionphp.phpphp'php;
php php php php php php php php php php php php php php php php php php php php throwphp newphp Zendphp_XmlRpcphp_Valuephp_Exceptionphp(php'Invalidphp XMLphp forphp XMLphp-RPCphp nativephp php'php.php selfphp:php:XMLRPCphp_TYPEphp_ARRAYphp php.php'php typephp:php ARRAYphp tagphp mustphp containphp DATAphp tagphp'php)php;
php php php php php php php php php php php php php php php php php}
php php php php php php php php php php php php php php php php php$valuesphp php=php arrayphp(php)php;
php php php php php php php php php php php php php php php php php/php/php Parsephp allphp thephp elementsphp ofphp thephp arrayphp fromphp thephp XMLphp string
php php php php php php php php php php php php php php php php php/php/php php(simplephp xmlphp elementphp)php tophp Zendphp_XmlRpcphp_Valuephp objects
php php php php php php php php php php php php php php php php foreachphp php(php$dataphp-php>valuephp asphp php$elementphp)php php{
php php php php php php php php php php php php php php php php php php php php php$valuesphp[php]php php=php selfphp:php:php_xmlStringToNativeXmlRpcphp(php$elementphp)php;
php php php php php php php php php php php php php php php php php}
php php php php php php php php php php php php php php php php requirephp_oncephp php'Zendphp/XmlRpcphp/Valuephp/Arrayphp.phpphp'php;
php php php php php php php php php php php php php php php php php$xmlrpcValuephp php=php newphp Zendphp_XmlRpcphp_Valuephp_Arrayphp(php$valuesphp)php;
php php php php php php php php php php php php php php php php breakphp;
php php php php php php php php php php php php casephp selfphp:php:XMLRPCphp_TYPEphp_STRUCTphp:
php php php php php php php php php php php php php php php php php$valuesphp php=php arrayphp(php)php;
php php php php php php php php php php php php php php php php php/php/php Parsephp allphp thephp memebersphp ofphp thephp structphp fromphp thephp XMLphp string
php php php php php php php php php php php php php php php php php/php/php php(simplephp xmlphp elementphp)php tophp Zendphp_XmlRpcphp_Valuephp objects
php php php php php php php php php php php php php php php php foreachphp php(php$valuephp-php>memberphp asphp php$memberphp)php php{
php php php php php php php php php php php php php php php php php php php php php/php/php php@todophp?php Ifphp aphp memberphp doesnphp'tphp havephp aphp php<valuephp>php tagphp,php wephp donphp'tphp addphp itphp tophp thephp struct
php php php php php php php php php php php php php php php php php php php php php/php/php Maybephp wephp wantphp tophp throwphp anphp exceptionphp herephp php?
php php php php php php php php php php php php php php php php php php php php ifphp php(php!issetphp(php$memberphp-php>valuephp)php orphp php!issetphp(php$memberphp-php>namephp)php)php php{
php php php php php php php php php php php php php php php php php php php php php php php php continuephp;
php php php php php php php php php php php php php php php php php php php php php php php php php/php/throwphp newphp Zendphp_XmlRpcphp_Valuephp_Exceptionphp(php'Memberphp ofphp thephp php'php.php selfphp:php:XMLRPCphp_TYPEphp_STRUCTphp php.php'php XMLphp-RPCphp nativephp typephp mustphp containphp aphp VALUEphp tagphp'php)php;
php php php php php php php php php php php php php php php php php php php php php}
php php php php php php php php php php php php php php php php php php php php php$valuesphp[php(stringphp)php$memberphp-php>namephp]php php=php selfphp:php:php_xmlStringToNativeXmlRpcphp(php$memberphp-php>valuephp)php;
php php php php php php php php php php php php php php php php php}
php php php php php php php php php php php php php php php php requirephp_oncephp php'Zendphp/XmlRpcphp/Valuephp/Structphp.phpphp'php;
php php php php php php php php php php php php php php php php php$xmlrpcValuephp php=php newphp Zendphp_XmlRpcphp_Valuephp_Structphp(php$valuesphp)php;
php php php php php php php php php php php php php php php php breakphp;
php php php php php php php php php php php php defaultphp:
php php php php php php php php php php php php php php php php requirephp_oncephp php'Zendphp/XmlRpcphp/Valuephp/Exceptionphp.phpphp'php;
php php php php php php php php php php php php php php php php throwphp newphp Zendphp_XmlRpcphp_Valuephp_Exceptionphp(php'Valuephp typephp php\php'php'php.php php$typephp php.php'php\php'php parsedphp fromphp thephp XMLphp stringphp isphp notphp aphp knownphp XMLphp-RPCphp nativephp typephp'php)php;
php php php php php php php php php php php php php php php php breakphp;
php php php php php php php php php}
php php php php php php php php php$xmlrpcValuephp-php>php_setXMLphp(php$xmlphp-php>asXMLphp(php)php)php;

php php php php php php php php returnphp php$xmlrpcValuephp;
php php php php php}

php php php php protectedphp staticphp functionphp php_createSimpleXMLElementphp(php&php$xmlphp)
php php php php php{
php php php php php php php php ifphp php(php$xmlphp instanceofphp SimpleXMLElementphp)php php{
php php php php php php php php php php php php returnphp;
php php php php php php php php php}

php php php php php php php php tryphp php{
php php php php php php php php php php php php php$xmlphp php=php newphp SimpleXMLElementphp(php$xmlphp)php;
php php php php php php php php php}php catchphp php(Exceptionphp php$ephp)php php{
php php php php php php php php php php php php php/php/php Thephp givenphp stringphp isphp notphp aphp validphp XML
php php php php php php php php php php php php requirephp_oncephp php'Zendphp/XmlRpcphp/Valuephp/Exceptionphp.phpphp'php;
php php php php php php php php php php php php throwphp newphp Zendphp_XmlRpcphp_Valuephp_Exceptionphp(php'Failedphp tophp createphp XMLphp-RPCphp valuephp fromphp XMLphp stringphp:php php'php php.php php$ephp-php>getMessagephp(php)php,php php$ephp-php>getCodephp(php)php,php php$ephp)php;
php php php php php php php php php}
php php php php php}

php php php php php/php*php*
php php php php php php*php Extractphp XMLphp/RPCphp typephp andphp valuephp fromphp SimpleXMLElementphp object
php php php php php php*
php php php php php php*php php@paramphp SimpleXMLElementphp php$xml
php php php php php php*php php@paramphp stringphp php&php$typephp Typephp bindphp variable
php php php php php php*php php@paramphp stringphp php&php$valuephp Valuephp bindphp variable
php php php php php php*php php@returnphp void
php php php php php php*php/
php php php php protectedphp staticphp functionphp php_extractTypeAndValuephp(SimpleXMLElementphp php$xmlphp,php php&php$typephp,php php&php$valuephp)
php php php php php{
php php php php php php php php listphp(php$typephp,php php$valuephp)php php=php eachphp(php$xmlphp)php;

php php php php php php php php ifphp php(php!php$typephp andphp php$valuephp php=php=php=php nullphp)php php{
php php php php php php php php php php php php php$namespacesphp php=php arrayphp(php'exphp'php php=php>php php'httpphp:php/php/wsphp.apachephp.orgphp/xmlrpcphp/namespacesphp/extensionsphp'php)php;
php php php php php php php php php php php php foreachphp php(php$namespacesphp asphp php$namespaceNamephp php=php>php php$namespaceUriphp)php php{
php php php php php php php php php php php php php php php php php$namespaceXmlphp php=php php$xmlphp-php>childrenphp(php$namespaceUriphp)php;
php php php php php php php php php php php php php php php php listphp(php$typephp,php php$valuephp)php php=php eachphp(php$namespaceXmlphp)php;
php php php php php php php php php php php php php php php php ifphp php(php$typephp php!php=php=php nullphp)php php{
php php php php php php php php php php php php php php php php php php php php php$typephp php=php php$namespaceNamephp php.php php'php:php'php php.php php$typephp;
php php php php php php php php php php php php php php php php php php php php breakphp;
php php php php php php php php php php php php php php php php php}
php php php php php php php php php php php php php}
php php php php php php php php php}

php php php php php php php php php/php/php Ifphp nophp typephp wasphp specifiedphp,php thephp defaultphp isphp string
php php php php php php php php ifphp php(php!php$typephp)php php{
php php php php php php php php php php php php php$typephp php=php selfphp:php:XMLRPCphp_TYPEphp_STRINGphp;
php php php php php php php php php}
php php php php php}

php php php php php/php*php*
php php php php php php*php php@paramphp php$xml
php php php php php php*php php@returnphp void
php php php php php php*php/
php php php php protectedphp functionphp php_setXMLphp(php$xmlphp)
php php php php php{
php php php php php php php php php$thisphp-php>php_xmlphp php=php php$thisphp-php>getGeneratorphp(php)php-php>stripDeclarationphp(php$xmlphp)php;
php php php php php}
php}
