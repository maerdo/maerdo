<php?php
php/php*php*
php php*php Zendphp Framework
php php*
php php*php LICENSE
php php*
php php*php Thisphp sourcephp filephp isphp subjectphp tophp thephp newphp BSDphp licensephp thatphp isphp bundled
php php*php withphp thisphp packagephp inphp thephp filephp LICENSEphp.txtphp.
php php*php Itphp isphp alsophp availablephp throughphp thephp worldphp-widephp-webphp atphp thisphp URLphp:
php php*php httpphp:php/php/frameworkphp.zendphp.comphp/licensephp/newphp-bsd
php php*php Ifphp youphp didphp notphp receivephp aphp copyphp ofphp thephp licensephp andphp arephp unablephp to
php php*php obtainphp itphp throughphp thephp worldphp-widephp-webphp,php pleasephp sendphp anphp email
php php*php tophp licensephp@zendphp.comphp sophp wephp canphp sendphp youphp aphp copyphp immediatelyphp.
php php*
php php*php php@categoryphp php Zend
php php*php php@packagephp php php Zendphp_Textphp_Figlet
php php*php php@copyrightphp php Copyrightphp php(cphp)php php2php0php0php5php-php2php0php1php0php Zendphp Technologiesphp USAphp Incphp.php php(httpphp:php/php/wwwphp.zendphp.comphp)
php php*php php@licensephp php php httpphp:php/php/frameworkphp.zendphp.comphp/licensephp/newphp-bsdphp php php php php Newphp BSDphp License
php php*php php@versionphp php php php$Idphp:php Figletphp.phpphp php2php0php0php9php6php php2php0php1php0php-php0php1php-php0php6php php0php2php:php0php5php:php0php9Zphp bkarwinphp php$
php php*php/

php/php*php*
php php*php Zendphp_Textphp_Figletphp isphp aphp PHPphp implementationphp ofphp FIGlet
php php*
php php*php php@categoryphp php Zend
php php*php php@packagephp php php Zendphp_Textphp_Figlet
php php*php php@copyrightphp php Copyrightphp php(cphp)php php2php0php0php5php-php2php0php1php0php Zendphp Technologiesphp USAphp Incphp.php php(httpphp:php/php/wwwphp.zendphp.comphp)
php php*php php@licensephp php php httpphp:php/php/frameworkphp.zendphp.comphp/licensephp/newphp-bsdphp php php php php Newphp BSDphp License
php php*php/
classphp Zendphp_Textphp_Figlet
php{
php php php php php/php*php*
php php php php php php*php Smushphp2php layoutphp modes
php php php php php php*php/
php php php php constphp SMphp_EQUALphp php php php php php=php php0xphp0php1php;
php php php php constphp SMphp_LOWLINEphp php php php=php php0xphp0php2php;
php php php php constphp SMphp_HIERARCHYphp php=php php0xphp0php4php;
php php php php constphp SMphp_PAIRphp php php php php php php=php php0xphp0php8php;
php php php php constphp SMphp_BIGXphp php php php php php php=php php0xphp1php0php;
php php php php constphp SMphp_HARDBLANKphp php=php php0xphp2php0php;
php php php php constphp SMphp_KERNphp php php php php php php=php php0xphp4php0php;
php php php php constphp SMphp_SMUSHphp php php php php php=php php0xphp8php0php;

php php php php php/php*php*
php php php php php php*php Smushphp modephp overridephp modes
php php php php php php*php/
php php php php constphp SMOphp_NOphp php php php php=php php0php;
php php php php constphp SMOphp_YESphp php php php=php php1php;
php php php php constphp SMOphp_FORCEphp php=php php2php;

php php php php php/php*php*
php php php php php php*php Justifications
php php php php php php*php/
php php php php constphp JUSTIFICATIONphp_LEFTphp php php php=php php0php;
php php php php constphp JUSTIFICATIONphp_CENTERphp php=php php1php;
php php php php constphp JUSTIFICATIONphp_RIGHTphp php php=php php2php;

php php php php php/php*php*
php php php php php php*php Writephp directions
php php php php php php*php/
php php php php constphp DIRECTIONphp_LEFTphp_TOphp_RIGHTphp php=php php0php;
php php php php constphp DIRECTIONphp_RIGHTphp_TOphp_LEFTphp php=php php1php;

php php php php php/php*php*
php php php php php php*php Magicphp fontfilephp number
php php php php php php*php/
php php php php constphp FONTFILEphp_MAGICphp_NUMBERphp php=php php'flfphp2php'php;

php php php php php/php*php*
php php php php php php*php Arrayphp containingphp allphp charactersphp ofphp thephp currentphp font
php php php php php php*
php php php php php php*php php@varphp array
php php php php php php*php/
php php php php protectedphp php$php_charListphp php=php arrayphp(php)php;

php php php php php/php*php*
php php php php php php*php Indicatesphp ifphp aphp fontphp wasphp loadedphp yet
php php php php php php*
php php php php php php*php php@varphp boolean
php php php php php php*php/
php php php php protectedphp php$php_fontLoadedphp php=php falsephp;

php php php php php/php*php*
php php php php php php*php Latinphp-php1php codesphp forphp Germanphp lettersphp,php respectivelyphp:
php php php php php php*
php php php php php php*php LATINphp CAPITALphp LETTERphp Aphp WITHphp DIAERESISphp php=php Aphp-umlaut
php php php php php php*php LATINphp CAPITALphp LETTERphp Ophp WITHphp DIAERESISphp php=php Ophp-umlaut
php php php php php php*php LATINphp CAPITALphp LETTERphp Uphp WITHphp DIAERESISphp php=php Uphp-umlaut
php php php php php php*php LATINphp SMALLphp LETTERphp Aphp WITHphp DIAERESISphp php=php aphp-umlaut
php php php php php php*php LATINphp SMALLphp LETTERphp Ophp WITHphp DIAERESISphp php=php ophp-umlaut
php php php php php php*php LATINphp SMALLphp LETTERphp Uphp WITHphp DIAERESISphp php=php uphp-umlaut
php php php php php php*php LATINphp SMALLphp LETTERphp SHARPphp Sphp php=php essphp-zed
php php php php php php*
php php php php php php*php php@varphp array
php php php php php php*php/
php php php php protectedphp php$php_germanCharsphp php=php arrayphp(php1php9php6php,php php2php1php4php,php php2php2php0php,php php2php2php8php,php php2php4php6php,php php2php5php2php,php php2php2php3php)php;

php php php php php/php*php*
php php php php php php*php Outputphp widthphp,php defaultsphp tophp php8php0php.
php php php php php php*
php php php php php php*php php@varphp integer
php php php php php php*php/
php php php php protectedphp php$php_outputWidthphp php=php php8php0php;

php php php php php/php*php*
php php php php php php*php Hardphp blankphp character
php php php php php php*
php php php php php php*php php@varphp string
php php php php php php*php/
php php php php protectedphp php$php_hardBlankphp;

php php php php php/php*php*
php php php php php php*php Heightphp ofphp thephp characters
php php php php php php*
php php php php php php*php php@varphp integer
php php php php php php*php/
php php php php protectedphp php$php_charHeightphp;

php php php php php/php*php*
php php php php php php*php Maxphp lengthphp ofphp anyphp character
php php php php php php*
php php php php php php*php php@varphp integer
php php php php php php*php/
php php php php protectedphp php$php_maxLengthphp;

php php php php php/php*php*
php php php php php php*php Smushphp mode
php php php php php php*
php php php php php php*php php@varphp integer
php php php php php php*php/
php php php php protectedphp php$php_smushModephp php=php php0php;

php php php php php/php*php*
php php php php php php*php Smushphp definedphp byphp thephp font
php php php php php php*
php php php php php php*php php@varphp integer
php php php php php php*php/
php php php php protectedphp php$php_fontSmushphp php=php php0php;

php php php php php/php*php*
php php php php php php*php Smushphp definedphp byphp thephp user
php php php php php php*
php php php php php php*php php@varphp integer
php php php php php php*php/
php php php php protectedphp php$php_userSmushphp php=php php0php;

php php php php php/php*php*
php php php php php php*php Wetherphp tophp handlephp paragraphsphp php|php|php not
php php php php php php*
php php php php php php*php php@varphp boolean
php php php php php php*php/
php php php php protectedphp php$php_handleParagraphsphp php=php falsephp;

php php php php php/php*php*
php php php php php php*php Justificationphp forphp thephp textphp,php accordingphp tophp php$php_outputWidth
php php php php php php*
php php php php php php*php Forphp usingphp fontphp defaultphp,php thisphp parameterphp shouldphp bephp nullphp,php elsephp onephp of
php php php php php php*php thephp valuesphp ofphp Zendphp_Textphp_Figletphp:php:JUSTIFICATIONphp_php*
php php php php php php*
php php php php php php*php php@varphp integer
php php php php php php*php/
php php php php protectedphp php$php_justificationphp php=php nullphp;

php php php php php/php*php*
php php php php php php*php Directionphp ofphp textphp-writingphp,php namelyphp rightphp tophp left
php php php php php php*
php php php php php php*php Forphp usingphp fontphp defaultphp,php thisphp parameterphp shouldphp bephp nullphp,php elsephp onephp of
php php php php php php*php thephp valuesphp ofphp Zendphp_Textphp_Figletphp:php:DIRECTIONphp_php*
php php php php php php*
php php php php php php*php php@varphp integer
php php php php php php*php/
php php php php protectedphp php$php_rightToLeftphp php=php nullphp;

php php php php php/php*php*
php php php php php php*php Overridephp fontphp filephp smushphp layout
php php php php php php*
php php php php php php*php php@varphp integer
php php php php php php*php/
php php php php protectedphp php$php_smushOverridephp php=php php0php;

php php php php php/php*php*
php php php php php php*php Optionsphp ofphp thephp currentphp font
php php php php php php*
php php php php php php*php php@varphp array
php php php php php php*php/
php php php php protectedphp php$php_fontOptionsphp php=php arrayphp(php)php;

php php php php php/php*php*
php php php php php php*php Previousphp characterphp width
php php php php php php*
php php php php php php*php php@varphp integer
php php php php php php*php/
php php php php protectedphp php$php_previousCharWidthphp php=php php0php;

php php php php php/php*php*
php php php php php php*php Currentphp characterphp width
php php php php php php*
php php php php php php*php php@varphp integer
php php php php php php*php/
php php php php protectedphp php$php_currentCharWidthphp php=php php0php;

php php php php php/php*php*
php php php php php php*php Currentphp outlinephp length
php php php php php php*
php php php php php php*php php@varphp integer
php php php php php php*php/
php php php php protectedphp php$php_outlineLengthphp php=php php0php;

php php php php php/php*php*
php php php php php php*php Maxmimumphp outlinephp length
php php php php php php*
php php php php php php*php php@varphp integer
php php php php php php*php/
php php php php protectedphp php$php_outlineLengthLimitphp php=php php0php;

php php php php php/php*php*
php php php php php php*php Inphp characterphp line
php php php php php php*
php php php php php php*php php@varphp string
php php php php php php*php/
php php php php protectedphp php$php_inCharLinephp;

php php php php php/php*php*
php php php php php php*php Inphp characterphp linephp length
php php php php php php*
php php php php php php*php php@varphp integer
php php php php php php*php/
php php php php protectedphp php$php_inCharLineLengthphp php=php php0php;

php php php php php/php*php*
php php php php php php*php Maximumphp inphp characterphp linephp length
php php php php php php*
php php php php php php*php php@varphp integer
php php php php php php*php/
php php php php protectedphp php$php_inCharLineLengthLimitphp php=php php0php;

php php php php php/php*php*
php php php php php php*php Currentphp char
php php php php php php*
php php php php php php*php php@varphp array
php php php php php php*php/
php php php php protectedphp php$php_currentCharphp php=php nullphp;

php php php php php/php*php*
php php php php php php*php Currentphp outputphp line
php php php php php php*
php php php php php php*php php@varphp array
php php php php php php*php/
php php php php protectedphp php$php_outputLinephp;

php php php php php/php*php*
php php php php php php*php Currentphp output
php php php php php php*
php php php php php php*php php@varphp string
php php php php php php*php/
php php php php protectedphp php$php_outputphp;

php php php php php/php*php*
php php php php php php*php Optionphp keysphp tophp skipphp whenphp callingphp setOptionsphp(php)
php php php php php php*
php php php php php php*php php@varphp array
php php php php php php*php/
php php php php protectedphp php$php_skipOptionsphp php=php arrayphp(
php php php php php php php php php'optionsphp'php,
php php php php php php php php php'configphp'php,
php php php php php)php;

php php php php php/php*php*
php php php php php php*php Instantiatephp thephp FIGletphp withphp aphp specificphp fontphp.php Ifphp nophp fontphp isphp givenphp,php the
php php php php php php*php standardphp fontphp isphp usedphp.php Youphp canphp alsophp supplyphp multiplephp optionsphp via
php php php php php php*php thephp php$optionsphp variablephp,php whichphp canphp eitherphp bephp anphp arrayphp orphp anphp instancephp of
php php php php php php*php Zendphp_Configphp.
php php php php php php*
php php php php php php*php php@paramphp arrayphp|Zendphp_Configphp php$optionsphp Optionsphp forphp thephp output
php php php php php php*php/
php php php php publicphp functionphp php_php_constructphp(php$optionsphp php=php nullphp)
php php php php php{
php php php php php php php php php/php/php Setphp options
php php php php php php php php ifphp php(isphp_arrayphp(php$optionsphp)php)php php{
php php php php php php php php php php php php php$thisphp-php>setOptionsphp(php$optionsphp)php;
php php php php php php php php php}php elsephp ifphp php(php$optionsphp instanceofphp Zendphp_Configphp)php php{
php php php php php php php php php php php php php$thisphp-php>setConfigphp(php$optionsphp)php;
php php php php php php php php php}

php php php php php php php php php/php/php Ifphp nophp fontphp wasphp definedphp,php loadphp defaultphp font
php php php php php php php php ifphp php(php!php$thisphp-php>php_fontLoadedphp)php php{
php php php php php php php php php php php php php$thisphp-php>php_loadFontphp(dirnamephp(php_php_FILEphp_php_php)php php.php php'php/Figletphp/zendphp-frameworkphp.flfphp'php)php;
php php php php php php php php php}
php php php php php}

php php php php php/php*php*
php php php php php php*php Setphp optionsphp fromphp array
php php php php php php*
php php php php php php*php php@paramphp php arrayphp php$optionsphp Configurationphp forphp Zendphp_Textphp_Figlet
php php php php php php*php php@returnphp Zendphp_Textphp_Figlet
php php php php php php*php/
php php php php publicphp functionphp setOptionsphp(arrayphp php$optionsphp)
php php php php php{
php php php php php php php php foreachphp php(php$optionsphp asphp php$keyphp php=php>php php$valuephp)php php{
php php php php php php php php php php php php ifphp php(inphp_arrayphp(strtolowerphp(php$keyphp)php,php php$thisphp-php>php_skipOptionsphp)php)php php{
php php php php php php php php php php php php php php php php continuephp;
php php php php php php php php php php php php php}

php php php php php php php php php php php php php$methodphp php=php php'setphp'php php.php ucfirstphp(php$keyphp)php;
php php php php php php php php php php php php ifphp php(methodphp_existsphp(php$thisphp,php php$methodphp)php)php php{
php php php php php php php php php php php php php php php php php$thisphp-php>php$methodphp(php$valuephp)php;
php php php php php php php php php php php php php}
php php php php php php php php php}
php php php php php php php php returnphp php$thisphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Setphp optionsphp fromphp configphp object
php php php php php php*
php php php php php php*php php@paramphp php Zendphp_Configphp php$configphp Configurationphp forphp Zendphp_Textphp_Figlet
php php php php php php*php php@returnphp Zendphp_Textphp_Figlet
php php php php php php*php/
php php php php publicphp functionphp setConfigphp(Zendphp_Configphp php$configphp)
php php php php php{
php php php php php php php php returnphp php$thisphp-php>setOptionsphp(php$configphp-php>toArrayphp(php)php)php;
php php php php php}

php php php php php/php*php*
php php php php php php*php Setphp aphp fontphp tophp use
php php php php php php*
php php php php php php*php php@paramphp php stringphp php$fontphp Pathphp tophp thephp font
php php php php php php*php php@returnphp Zendphp_Textphp_Figlet
php php php php php php*php/
php php php php publicphp functionphp setFontphp(php$fontphp)
php php php php php{
php php php php php php php php php$thisphp-php>php_loadFontphp(php$fontphp)php;
php php php php php php php php returnphp php$thisphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Setphp handlingphp ofphp paragraphs
php php php php php php*
php php php php php php*php php@paramphp php booleanphp php$handleParagraphsphp Wetherphp tophp handlephp paragraphsphp orphp not
php php php php php php*php php@returnphp Zendphp_Textphp_Figlet
php php php php php php*php/
php php php php publicphp functionphp setHandleParagraphsphp(php$handleParagraphsphp)
php php php php php{
php php php php php php php php php$thisphp-php>php_handleParagraphsphp php=php php(boolphp)php php$handleParagraphsphp;
php php php php php php php php returnphp php$thisphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Setphp thephp justificationphp.php php0php standsphp forphp leftphp alignedphp,php php1php forphp centeredphp andphp php2
php php php php php php*php forphp rightphp alignedphp.
php php php php php php*
php php php php php php*php php@paramphp php integerphp php$justificationphp Justificationphp ofphp thephp outputphp text
php php php php php php*php php@returnphp Zendphp_Textphp_Figlet
php php php php php php*php/
php php php php publicphp functionphp setJustificationphp(php$justificationphp)
php php php php php{
php php php php php php php php php$thisphp-php>php_justificationphp php=php minphp(php3php,php maxphp(php0php,php php(intphp)php php$justificationphp)php)php;
php php php php php php php php returnphp php$thisphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Setphp thephp outputphp width
php php php php php php*
php php php php php php*php php@paramphp php integerphp php$outputWidthphp Outputphp withphp whichphp shouldphp bephp usedphp forphp word
php php php php php php*php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php wrappingphp andphp justification
php php php php php php*php php@returnphp Zendphp_Textphp_Figlet
php php php php php php*php/
php php php php publicphp functionphp setOutputWidthphp(php$outputWidthphp)
php php php php php{
php php php php php php php php php$thisphp-php>php_outputWidthphp php=php maxphp(php1php,php php(intphp)php php$outputWidthphp)php;
php php php php php php php php returnphp php$thisphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Setphp rightphp tophp leftphp modephp.php Forphp writingphp fromphp leftphp tophp rightphp,php use
php php php php php php*php Zendphp_Textphp_Figletphp:php:DIRECTIONphp_LEFTphp_TOphp_RIGHTphp.php Forphp writingphp fromphp rightphp tophp leftphp,
php php php php php php*php usephp Zendphp_Textphp_Figletphp:php:DIRECTIONphp_RIGHTphp_TOphp_LEFTphp.
php php php php php php*
php php php php php php*php php@paramphp php integerphp php$rightToLeftphp Rightphp-tophp-leftphp mode
php php php php php php*php php@returnphp Zendphp_Textphp_Figlet
php php php php php php*php/
php php php php publicphp functionphp setRightToLeftphp(php$rightToLeftphp)
php php php php php{
php php php php php php php php php$thisphp-php>php_rightToLeftphp php=php minphp(php1php,php maxphp(php0php,php php(intphp)php php$rightToLeftphp)php)php;
php php php php php php php php returnphp php$thisphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Setphp thephp smushphp modephp.
php php php php php php*
php php php php php php*php Usephp onephp ofphp thephp constantsphp ofphp Zendphp_Textphp_Figletphp:php:SMphp_php*php,php youphp mayphp combinephp themphp.
php php php php php php*
php php php php php php*php php@paramphp php integerphp php$smushModephp Smushphp modephp tophp usephp forphp generatingphp text
php php php php php php*php php@returnphp Zendphp_Textphp_Figlet
php php php php php php*php/
php php php php publicphp functionphp setSmushModephp(php$smushModephp)
php php php php php{
php php php php php php php php php$smushModephp php=php php(intphp)php php$smushModephp;

php php php php php php php php ifphp php(php$smushModephp <php php-php1php)php php{
php php php php php php php php php php php php php$thisphp-php>php_smushOverridephp php=php selfphp:php:SMOphp_NOphp;
php php php php php php php php php}php elsephp php{
php php php php php php php php php php php php ifphp php(php$smushModephp php=php=php=php php0php)php php{
php php php php php php php php php php php php php php php php php$thisphp-php>php_userSmushphp php=php selfphp:php:SMphp_KERNphp;
php php php php php php php php php php php php php}php elsephp ifphp php(php$smushModephp php=php=php=php php-php1php)php php{
php php php php php php php php php php php php php php php php php$thisphp-php>php_userSmushphp php=php php0php;
php php php php php php php php php php php php php}php elsephp php{
php php php php php php php php php php php php php php php php php$thisphp-php>php_userSmushphp php=php php(php(php$smushModephp php&php php6php3php)php php|php selfphp:php:SMphp_SMUSHphp)php;
php php php php php php php php php php php php php}

php php php php php php php php php php php php php$thisphp-php>php_smushOverridephp php=php selfphp:php:SMOphp_YESphp;
php php php php php php php php php}

php php php php php php php php php$thisphp-php>php_setUsedSmushphp(php)php;

php php php php php php php php returnphp php$thisphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Renderphp aphp FIGletphp text
php php php php php php*
php php php php php php*php php@paramphp php stringphp php$textphp php php php php Textphp tophp convertphp tophp aphp figletphp text
php php php php php php*php php@paramphp php stringphp php$encodingphp Encodingphp ofphp thephp inputphp string
php php php php php php*php php@throwsphp InvalidArgumentExceptionphp Whenphp php$textphp isphp notphp aphp string
php php php php php php*php php@throwsphp Zendphp_Textphp_Figletphp_Exceptionphp php php php Whenphp php$textphp itphp notphp properlyphp encoded
php php php php php php*php php@returnphp string
php php php php php php*php/
php php php php publicphp functionphp renderphp(php$textphp,php php$encodingphp php=php php'UTFphp-php8php'php)
php php php php php{
php php php php php php php php ifphp php(php!isphp_stringphp(php$textphp)php)php php{
php php php php php php php php php php php php throwphp newphp InvalidArgumentExceptionphp(php'php$textphp mustphp bephp aphp stringphp'php)php;
php php php php php php php php php}

php php php php php php php php ifphp php(php$encodingphp php!php=php=php php'UTFphp-php8php'php)php php{
php php php php php php php php php php php php php$textphp php=php iconvphp(php$encodingphp,php php'UTFphp-php8php'php,php php$textphp)php;
php php php php php php php php php}

php php php php php php php php php$thisphp-php>php_outputphp php php php php php=php php'php'php;
php php php php php php php php php$thisphp-php>php_outputLinephp php=php arrayphp(php)php;

php php php php php php php php php$thisphp-php>php_clearLinephp(php)php;

php php php php php php php php php$thisphp-php>php_outlineLengthLimitphp php php php php=php php(php$thisphp-php>php_outputWidthphp php-php php1php)php;
php php php php php php php php php$thisphp-php>php_inCharLineLengthLimitphp php=php php(php$thisphp-php>php_outputWidthphp php*php php4php php+php php1php0php0php)php;

php php php php php php php php php$wordBreakModephp php php=php php0php;
php php php php php php php php php$lastCharWasEolphp php=php falsephp;
php php php php php php php php php$textLengthphp php php php php php=php php@iconvphp_strlenphp(php$textphp,php php'UTFphp-php8php'php)php;

php php php php php php php php ifphp php(php$textLengthphp php=php=php=php falsephp)php php{
php php php php php php php php php php php php requirephp_oncephp php'Zendphp/Textphp/Figletphp/Exceptionphp.phpphp'php;
php php php php php php php php php php php php throwphp newphp Zendphp_Textphp_Figletphp_Exceptionphp(php'php$textphp isphp notphp encodedphp withphp php'php php.php php$encodingphp)php;
php php php php php php php php php}

php php php php php php php php forphp php(php$charNumphp php=php php0php;php php$charNumphp <php php$textLengthphp;php php$charNumphp+php+php)php php{
php php php php php php php php php php php php php/php/php Handlephp paragraphs
php php php php php php php php php php php php php$charphp php=php iconvphp_substrphp(php$textphp,php php$charNumphp,php php1php,php php'UTFphp-php8php'php)php;

php php php php php php php php php php php php ifphp php(php$charphp php=php=php=php php"php\nphp"php php&php&php php$thisphp-php>php_handleParagraphsphp php&php&php php!php$lastCharWasEolphp)php php{
php php php php php php php php php php php php php php php php php$nextCharphp php=php iconvphp_substrphp(php$textphp,php php(php$charNumphp php+php php1php)php,php php1php,php php'UTFphp-php8php'php)php;
php php php php php php php php php php php php php php php php ifphp php(php!php$nextCharphp)php php{
php php php php php php php php php php php php php php php php php php php php php$nextCharphp php=php nullphp;
php php php php php php php php php php php php php php php php php}

php php php php php php php php php php php php php php php php php$charphp php=php php(ctypephp_spacephp(php$nextCharphp)php)php php?php php"php\nphp"php php:php php'php php'php;
php php php php php php php php php php php php php}

php php php php php php php php php php php php php$lastCharWasEolphp php=php php(ctypephp_spacephp(php$charphp)php php&php&php php$charphp php!php=php=php php"php\tphp"php php&php&php php$charphp php!php=php=php php'php php'php)php;

php php php php php php php php php php php php ifphp php(ctypephp_spacephp(php$charphp)php)php php{
php php php php php php php php php php php php php php php php php$charphp php=php php(php$charphp php=php=php=php php"php\tphp"php php|php|php php$charphp php=php=php=php php'php php'php)php php?php php'php php'php:php php"php\nphp"php;
php php php php php php php php php php php php php}

php php php php php php php php php php php php php/php/php Skipphp unprintablephp characters
php php php php php php php php php php php php php$ordCharphp php=php php$thisphp-php>php_uniOrdphp(php$charphp)php;
php php php php php php php php php php php php ifphp php(php(php$ordCharphp php>php php0php php&php&php php$ordCharphp <php php3php2php php&php&php php$charphp php!php=php=php php"php\nphp"php)php php|php|php php$ordCharphp php=php=php=php php1php2php7php)php php{
php php php php php php php php php php php php php php php php continuephp;
php php php php php php php php php php php php php}

php php php php php php php php php php php php php/php/php Buildphp thephp character
php php php php php php php php php php php php php/php/php Notephp:php Thephp followingphp codephp isphp complexphp andphp thoroughlyphp testedphp.
php php php php php php php php php php php php php/php/php Bephp carefulphp whenphp modifyingphp!
php php php php php php php php php php php php dophp php{
php php php php php php php php php php php php php php php php php$charNotAddedphp php=php falsephp;

php php php php php php php php php php php php php php php php ifphp php(php$wordBreakModephp php=php=php=php php-php1php)php php{
php php php php php php php php php php php php php php php php php php php php ifphp php(php$charphp php=php=php=php php'php php'php)php php{
php php php php php php php php php php php php php php php php php php php php php php php php breakphp;
php php php php php php php php php php php php php php php php php php php php php}php elsephp ifphp php(php$charphp php=php=php=php php"php\nphp"php)php php{
php php php php php php php php php php php php php php php php php php php php php php php php php$wordBreakModephp php=php php0php;
php php php php php php php php php php php php php php php php php php php php php php php php breakphp;
php php php php php php php php php php php php php php php php php php php php php}

php php php php php php php php php php php php php php php php php php php php php$wordBreakModephp php=php php0php;
php php php php php php php php php php php php php php php php php}

php php php php php php php php php php php php php php php php ifphp php(php$charphp php=php=php=php php"php\nphp"php)php php{
php php php php php php php php php php php php php php php php php php php php php$thisphp-php>php_appendLinephp(php)php;
php php php php php php php php php php php php php php php php php php php php php$wordBreakModephp php=php falsephp;
php php php php php php php php php php php php php php php php php}php elsephp ifphp php(php$thisphp-php>php_addCharphp(php$charphp)php)php php{
php php php php php php php php php php php php php php php php php php php php ifphp php(php$charphp php!php=php=php php'php php'php)php php{
php php php php php php php php php php php php php php php php php php php php php php php php php$wordBreakModephp php=php php(php$wordBreakModephp php>php=php php2php)php php?php php3php:php php1php;
php php php php php php php php php php php php php php php php php php php php php}php elsephp php{
php php php php php php php php php php php php php php php php php php php php php php php php php$wordBreakModephp php=php php(php$wordBreakModephp php>php php0php)php php?php php2php:php php0php;
php php php php php php php php php php php php php php php php php php php php php}
php php php php php php php php php php php php php php php php php}php elsephp ifphp php(php$thisphp-php>php_outlineLengthphp php=php=php=php php0php)php php{
php php php php php php php php php php php php php php php php php php php php forphp php(php$iphp php=php php0php;php php$iphp <php php$thisphp-php>php_charHeightphp;php php$iphp+php+php)php php{
php php php php php php php php php php php php php php php php php php php php php php php php ifphp php(php$thisphp-php>php_rightToLeftphp php=php=php=php php1php php&php&php php$thisphp-php>php_outputWidthphp php>php php1php)php php{
php php php php php php php php php php php php php php php php php php php php php php php php php php php php php$offsetphp php=php php(strlenphp(php$thisphp-php>php_currentCharphp[php$iphp]php)php php-php php$thisphp-php>php_outlineLengthLimitphp)php;
php php php php php php php php php php php php php php php php php php php php php php php php php php php php php$thisphp-php>php_putStringphp(substrphp(php$thisphp-php>php_currentCharphp[php$iphp]php,php php$offsetphp)php)php;
php php php php php php php php php php php php php php php php php php php php php php php php php}php elsephp php{
php php php php php php php php php php php php php php php php php php php php php php php php php php php php php$thisphp-php>php_putStringphp(php$thisphp-php>php_currentCharphp[php$iphp]php)php;
php php php php php php php php php php php php php php php php php php php php php php php php php}
php php php php php php php php php php php php php php php php php php php php php}

php php php php php php php php php php php php php php php php php php php php php$wordBreakModephp php=php php-php1php;
php php php php php php php php php php php php php php php php php}php elsephp ifphp php(php$charphp php=php=php=php php'php php'php)php php{
php php php php php php php php php php php php php php php php php php php php ifphp php(php$wordBreakModephp php=php=php=php php2php)php php{
php php php php php php php php php php php php php php php php php php php php php php php php php$thisphp-php>php_splitLinephp(php)php;
php php php php php php php php php php php php php php php php php php php php php}php elsephp php{
php php php php php php php php php php php php php php php php php php php php php php php php php$thisphp-php>php_appendLinephp(php)php;
php php php php php php php php php php php php php php php php php php php php php}

php php php php php php php php php php php php php php php php php php php php php$wordBreakModephp php=php php-php1php;
php php php php php php php php php php php php php php php php php}php elsephp php{
php php php php php php php php php php php php php php php php php php php php ifphp php(php$wordBreakModephp php>php=php php2php)php php{
php php php php php php php php php php php php php php php php php php php php php php php php php$thisphp-php>php_splitLinephp(php)php;
php php php php php php php php php php php php php php php php php php php php php}php elsephp php{
php php php php php php php php php php php php php php php php php php php php php php php php php$thisphp-php>php_appendLinephp(php)php;
php php php php php php php php php php php php php php php php php php php php php}

php php php php php php php php php php php php php php php php php php php php php$wordBreakModephp php=php php(php$wordBreakModephp php=php=php=php php3php)php php?php php1php php:php php0php;
php php php php php php php php php php php php php php php php php php php php php$charNotAddedphp php php=php truephp;
php php php php php php php php php php php php php php php php php}
php php php php php php php php php php php php php}php whilephp php(php$charNotAddedphp)php;
php php php php php php php php php}

php php php php php php php php ifphp php(php$thisphp-php>php_outlineLengthphp php!php=php=php php0php)php php{
php php php php php php php php php php php php php$thisphp-php>php_appendLinephp(php)php;
php php php php php php php php php}

php php php php php php php php returnphp php$thisphp-php>php_outputphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Putsphp thephp givenphp stringphp,php substitutingphp blanksphp forphp hardblanksphp.php Ifphp outputWidth
php php php php php php*php isphp php1php,php putsphp thephp entirephp stringphp;php otherwisephp putsphp atphp mostphp outputWidthphp php-php php1
php php php php php php*php charactersphp.php Putsphp aphp newlinephp atphp thephp endphp ofphp thephp stringphp.php Thephp stringphp isphp leftphp-
php php php php php php*php justifiedphp,php centeredphp orphp rightphp-justifiedphp php(takingphp outputWidthphp asphp thephp screen
php php php php php php*php widthphp)php ifphp justificationphp isphp php0php,php php1php orphp php2php respectivelyphp.
php php php php php php*
php php php php php php*php php@paramphp php stringphp php$stringphp Thephp stringphp tophp addphp tophp thephp output
php php php php php php*php php@returnphp void
php php php php php php*php/
php php php php protectedphp functionphp php_putStringphp(php$stringphp)
php php php php php{
php php php php php php php php php$lengthphp php=php strlenphp(php$stringphp)php;

php php php php php php php php ifphp php(php$thisphp-php>php_outputWidthphp php>php php1php)php php{
php php php php php php php php php php php php ifphp php(php$lengthphp php>php php(php$thisphp-php>php_outputWidthphp php-php php1php)php)php php{
php php php php php php php php php php php php php php php php php$lengthphp php=php php(php$thisphp-php>php_outputWidthphp php-php php1php)php;
php php php php php php php php php php php php php}

php php php php php php php php php php php php ifphp php(php$thisphp-php>php_justificationphp php>php php0php)php php{
php php php php php php php php php php php php php php php php forphp php(php$iphp php=php php1php;
php php php php php php php php php php php php php php php php php php php php php php(php(php3php php-php php$thisphp-php>php_justificationphp)php php*php php$iphp php+php php$lengthphp php+php php$thisphp-php>php_justificationphp php-php php2php)php <php php$thisphp-php>php_outputWidthphp;
php php php php php php php php php php php php php php php php php php php php php php$iphp+php+php)php php{
php php php php php php php php php php php php php php php php php php php php php$thisphp-php>php_outputphp php.php=php php'php php'php;
php php php php php php php php php php php php php php php php php}
php php php php php php php php php php php php php}
php php php php php php php php php}

php php php php php php php php php$thisphp-php>php_outputphp php.php=php strphp_replacephp(php$thisphp-php>php_hardBlankphp,php php'php php'php,php php$stringphp)php php.php php"php\nphp"php;
php php php php php}

php php php php php/php*php*
php php php php php php*php Appendsphp thephp currentphp linephp tophp thephp output
php php php php php php*
php php php php php php*php php@returnphp void
php php php php php php*php/
php php php php protectedphp functionphp php_appendLinephp(php)
php php php php php{
php php php php php php php php forphp php(php$iphp php=php php0php;php php$iphp <php php$thisphp-php>php_charHeightphp;php php$iphp+php+php)php php{
php php php php php php php php php php php php php$thisphp-php>php_putStringphp(php$thisphp-php>php_outputLinephp[php$iphp]php)php;
php php php php php php php php php}

php php php php php php php php php$thisphp-php>php_clearLinephp(php)php;
php php php php php}

php php php php php/php*php*
php php php php php php*php Splitsphp inCharLinephp atphp thephp lastphp wordphp breakphp php(bunchphp ofphp consecutivephp blanksphp)php.
php php php php php php*php Makesphp aphp newphp linephp outphp ofphp thephp firstphp partphp andphp appendsphp itphp usingphp appendLinephp(php)php.
php php php php php php*php Makesphp aphp newphp linephp outphp ofphp thephp secondphp partphp andphp returnsphp.
php php php php php php*
php php php php php php*php php@returnphp void
php php php php php php*php/
php php php php protectedphp functionphp php_splitLinephp(php)
php php php php php{
php php php php php php php php php$gotSpacephp php=php falsephp;
php php php php php php php php forphp php(php$iphp php=php php(php$thisphp-php>php_inCharLineLengthphp php-php php1php)php;php php$iphp php>php=php php0php;php php$iphp-php-php)php php{
php php php php php php php php php php php php ifphp php(php!php$gotSpacephp php&php&php php$thisphp-php>php_inCharLinephp[php$iphp]php php=php=php=php php'php php'php)php php{
php php php php php php php php php php php php php php php php php$gotSpacephp php php=php truephp;
php php php php php php php php php php php php php php php php php$lastSpacephp php=php php$iphp;
php php php php php php php php php php php php php}

php php php php php php php php php php php php ifphp php(php$gotSpacephp php&php&php php$thisphp-php>php_inCharLinephp[php$iphp]php php!php=php=php php'php php'php)php php{
php php php php php php php php php php php php php php php php breakphp;
php php php php php php php php php php php php php}
php php php php php php php php php}

php php php php php php php php php$firstLengthphp php=php php(php$iphp php+php php1php)php;
php php php php php php php php php$lastLengthphp php php=php php(php$thisphp-php>php_inCharLineLengthphp php-php php$lastSpacephp php-php php1php)php;

php php php php php php php php php$firstPartphp php=php php'php'php;
php php php php php php php php forphp php(php$iphp php=php php0php;php php$iphp <php php$firstLengthphp;php php$iphp+php+php)php php{
php php php php php php php php php php php php php$firstPartphp[php$iphp]php php=php php$thisphp-php>php_inCharLinephp[php$iphp]php;
php php php php php php php php php}

php php php php php php php php php$lastPartphp php=php php'php'php;
php php php php php php php php forphp php(php$iphp php=php php0php;php php$iphp <php php$lastLengthphp;php php$iphp+php+php)php php{
php php php php php php php php php php php php php$lastPartphp[php$iphp]php php=php php$thisphp-php>php_inCharLinephp[php(php$lastSpacephp php+php php1php php+php php$iphp)php]php;
php php php php php php php php php}

php php php php php php php php php$thisphp-php>php_clearLinephp(php)php;

php php php php php php php php forphp php(php$iphp php=php php0php;php php$iphp <php php$firstLengthphp;php php$iphp+php+php)php php{
php php php php php php php php php php php php php$thisphp-php>php_addCharphp(php$firstPartphp[php$iphp]php)php;
php php php php php php php php php}

php php php php php php php php php$thisphp-php>php_appendLinephp(php)php;

php php php php php php php php forphp php(php$iphp php=php php0php;php php$iphp <php php$lastLengthphp;php php$iphp+php+php)php php{
php php php php php php php php php php php php php$thisphp-php>php_addCharphp(php$lastPartphp[php$iphp]php)php;
php php php php php php php php php}
php php php php php}

php php php php php/php*php*
php php php php php php*php Clearsphp thephp currentphp line
php php php php php php*
php php php php php php*php php@returnphp void
php php php php php php*php/
php php php php protectedphp functionphp php_clearLinephp(php)
php php php php php{
php php php php php php php php forphp php(php$iphp php=php php0php;php php$iphp <php php$thisphp-php>php_charHeightphp;php php$iphp+php+php)php php{
php php php php php php php php php php php php php$thisphp-php>php_outputLinephp[php$iphp]php php=php php'php'php;
php php php php php php php php php}

php php php php php php php php php$thisphp-php>php_outlineLengthphp php php php php=php php0php;
php php php php php php php php php$thisphp-php>php_inCharLineLengthphp php=php php0php;
php php php php php}

php php php php php/php*php*
php php php php php php*php Attemptsphp tophp addphp thephp givenphp characterphp ontophp thephp endphp ofphp thephp currentphp linephp.
php php php php php php*php Returnsphp truephp ifphp thisphp canphp bephp donephp,php falsephp otherwisephp.
php php php php php php*
php php php php php php*php php@paramphp php stringphp php$charphp Characterphp whichphp tophp addphp tophp thephp output
php php php php php php*php php@returnphp boolean
php php php php php php*php/
php php php php protectedphp functionphp php_addCharphp(php$charphp)
php php php php php{
php php php php php php php php php$thisphp-php>php_getLetterphp(php$charphp)php;

php php php php php php php php ifphp php(php$thisphp-php>php_currentCharphp php=php=php=php nullphp)php php{
php php php php php php php php php php php php returnphp truephp;
php php php php php php php php php}

php php php php php php php php php$smushAmountphp php=php php$thisphp-php>php_smushAmountphp(php)php;

php php php php php php php php ifphp php(php(php$thisphp-php>php_outlineLengthphp php+php php$thisphp-php>php_currentCharWidthphp php-php php$smushAmountphp)php php>php php$thisphp-php>php_outlineLengthLimit
php php php php php php php php php php php php php|php|php php(php$thisphp-php>php_inCharLineLengthphp php+php php1php)php php>php php$thisphp-php>php_inCharLineLengthLimitphp)php php{
php php php php php php php php php php php php returnphp falsephp;
php php php php php php php php php}

php php php php php php php php php$tempLinephp php=php php'php'php;
php php php php php php php php forphp php(php$rowphp php=php php0php;php php$rowphp <php php$thisphp-php>php_charHeightphp;php php$rowphp+php+php)php php{
php php php php php php php php php php php php ifphp php(php$thisphp-php>php_rightToLeftphp php=php=php=php php1php)php php{
php php php php php php php php php php php php php php php php php$tempLinephp php=php php$thisphp-php>php_currentCharphp[php$rowphp]php;

php php php php php php php php php php php php php php php php forphp php(php$kphp php=php php0php;php php$kphp <php php$smushAmountphp;php php$kphp+php+php)php php{
php php php php php php php php php php php php php php php php php php php php php$positionphp php php php php php php php php php php php php=php php(php$thisphp-php>php_currentCharWidthphp php-php php$smushAmountphp php+php php$kphp)php;
php php php php php php php php php php php php php php php php php php php php php$tempLinephp[php$positionphp]php php=php php$thisphp-php>php_smushemphp(php$tempLinephp[php$positionphp]php,php php$thisphp-php>php_outputLinephp[php$rowphp]php[php$kphp]php)php;
php php php php php php php php php php php php php php php php php}

php php php php php php php php php php php php php php php php php$thisphp-php>php_outputLinephp[php$rowphp]php php=php php$tempLinephp php.php substrphp(php$thisphp-php>php_outputLinephp[php$rowphp]php,php php$smushAmountphp)php;
php php php php php php php php php php php php php}php elsephp php{
php php php php php php php php php php php php php php php php forphp php(php$kphp php=php php0php;php php$kphp <php php$smushAmountphp;php php$kphp+php+php)php php{
php php php php php php php php php php php php php php php php php php php php ifphp php(php(php$thisphp-php>php_outlineLengthphp php-php php$smushAmountphp php+php php$kphp)php <php php0php)php php{
php php php php php php php php php php php php php php php php php php php php php php php php continuephp;
php php php php php php php php php php php php php php php php php php php php php}

php php php php php php php php php php php php php php php php php php php php php$positionphp php=php php(php$thisphp-php>php_outlineLengthphp php-php php$smushAmountphp php+php php$kphp)php;
php php php php php php php php php php php php php php php php php php php php ifphp php(issetphp(php$thisphp-php>php_outputLinephp[php$rowphp]php[php$positionphp]php)php)php php{
php php php php php php php php php php php php php php php php php php php php php php php php php$leftCharphp php=php php$thisphp-php>php_outputLinephp[php$rowphp]php[php$positionphp]php;
php php php php php php php php php php php php php php php php php php php php php}php elsephp php{
php php php php php php php php php php php php php php php php php php php php php php php php php$leftCharphp php=php nullphp;
php php php php php php php php php php php php php php php php php php php php php}

php php php php php php php php php php php php php php php php php php php php php$thisphp-php>php_outputLinephp[php$rowphp]php[php$positionphp]php php=php php$thisphp-php>php_smushemphp(php$leftCharphp,php php$thisphp-php>php_currentCharphp[php$rowphp]php[php$kphp]php)php;
php php php php php php php php php php php php php php php php php}

php php php php php php php php php php php php php php php php php$thisphp-php>php_outputLinephp[php$rowphp]php php.php=php substrphp(php$thisphp-php>php_currentCharphp[php$rowphp]php,php php$smushAmountphp)php;
php php php php php php php php php php php php php}
php php php php php php php php php}

php php php php php php php php php$thisphp-php>php_outlineLengthphp php php php php php php php php php php php php php php php php php php php php php php php php php php=php strlenphp(php$thisphp-php>php_outputLinephp[php0php]php)php;
php php php php php php php php php$thisphp-php>php_inCharLinephp[php$thisphp-php>php_inCharLineLengthphp+php+php]php php=php php$charphp;

php php php php php php php php returnphp truephp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Getsphp thephp requestedphp characterphp andphp setsphp currentphp andphp previousphp charphp widthphp.
php php php php php php*
php php php php php php*php php@paramphp php stringphp php$charphp Thephp characterphp fromphp whichphp tophp getphp thephp letterphp of
php php php php php php*php php@returnphp void
php php php php php php*php/
php php php php protectedphp functionphp php_getLetterphp(php$charphp)
php php php php php{
php php php php php php php php ifphp php(arrayphp_keyphp_existsphp(php$thisphp-php>php_uniOrdphp(php$charphp)php,php php$thisphp-php>php_charListphp)php)php php{
php php php php php php php php php php php php php$thisphp-php>php_currentCharphp php php php php php php php=php php$thisphp-php>php_charListphp[php$thisphp-php>php_uniOrdphp(php$charphp)php]php;
php php php php php php php php php php php php php$thisphp-php>php_previousCharWidthphp php=php php$thisphp-php>php_currentCharWidthphp;
php php php php php php php php php php php php php$thisphp-php>php_currentCharWidthphp php php=php strlenphp(php$thisphp-php>php_currentCharphp[php0php]php)php;
php php php php php php php php php}php elsephp php{
php php php php php php php php php php php php php$thisphp-php>php_currentCharphp php=php nullphp;
php php php php php php php php php}
php php php php php}

php php php php php/php*php*
php php php php php php*php Returnsphp thephp maximumphp amountphp thatphp thephp currentphp characterphp canphp bephp smushedphp into
php php php php php php*php thephp currentphp linephp.
php php php php php php*
php php php php php php*php php@returnphp integer
php php php php php php*php/
php php php php protectedphp functionphp php_smushAmountphp(php)
php php php php php{
php php php php php php php php ifphp php(php(php$thisphp-php>php_smushModephp php&php php(selfphp:php:SMphp_SMUSHphp php|php selfphp:php:SMphp_KERNphp)php)php php=php=php=php php0php)php php{
php php php php php php php php php php php php returnphp php0php;
php php php php php php php php php}

php php php php php php php php php$maxSmushphp php=php php$thisphp-php>php_currentCharWidthphp;
php php php php php php php php php$amountphp php php php=php php$maxSmushphp;

php php php php php php php php forphp php(php$rowphp php=php php0php;php php$rowphp <php php$thisphp-php>php_charHeightphp;php php$rowphp+php+php)php php{
php php php php php php php php php php php php ifphp php(php$thisphp-php>php_rightToLeftphp php=php=php=php php1php)php php{
php php php php php php php php php php php php php php php php php$charbdphp php=php strlenphp(php$thisphp-php>php_currentCharphp[php$rowphp]php)php;
php php php php php php php php php php php php php php php php whilephp php(truephp)php php{
php php php php php php php php php php php php php php php php php php php php ifphp php(php!issetphp(php$thisphp-php>php_currentCharphp[php$rowphp]php[php$charbdphp]php)php)php php{
php php php php php php php php php php php php php php php php php php php php php php php php php$leftCharphp php=php nullphp;
php php php php php php php php php php php php php php php php php php php php php}php elsephp php{
php php php php php php php php php php php php php php php php php php php php php php php php php$leftCharphp php=php php$thisphp-php>php_currentCharphp[php$rowphp]php[php$charbdphp]php;
php php php php php php php php php php php php php php php php php php php php php}

php php php php php php php php php php php php php php php php php php php php ifphp php(php$charbdphp php>php php0php php&php&php php(php$leftCharphp php=php=php=php nullphp php|php|php php$leftCharphp php=php=php php'php php'php)php)php php{
php php php php php php php php php php php php php php php php php php php php php php php php php$charbdphp-php-php;
php php php php php php php php php php php php php php php php php php php php php}php elsephp php{
php php php php php php php php php php php php php php php php php php php php php php php php breakphp;
php php php php php php php php php php php php php php php php php php php php php}
php php php php php php php php php php php php php php php php php}

php php php php php php php php php php php php php php php php php$linebdphp php=php php0php;
php php php php php php php php php php php php php php php php whilephp php(truephp)php php{
php php php php php php php php php php php php php php php php php php php php ifphp php(php!issetphp(php$thisphp-php>php_outputLinephp[php$rowphp]php[php$linebdphp]php)php)php php{
php php php php php php php php php php php php php php php php php php php php php php php php php$rightCharphp php=php nullphp;
php php php php php php php php php php php php php php php php php php php php php}php elsephp php{
php php php php php php php php php php php php php php php php php php php php php php php php php$rightCharphp php=php php$thisphp-php>php_outputLinephp[php$rowphp]php[php$linebdphp]php;
php php php php php php php php php php php php php php php php php php php php php}

php php php php php php php php php php php php php php php php php php php php ifphp php(php$rightCharphp php=php=php=php php'php php'php)php php{
php php php php php php php php php php php php php php php php php php php php php php php php php$linebdphp+php+php;
php php php php php php php php php php php php php php php php php php php php php}php elsephp php{
php php php php php php php php php php php php php php php php php php php php php php php php breakphp;
php php php php php php php php php php php php php php php php php php php php php}
php php php php php php php php php php php php php php php php php}

php php php php php php php php php php php php php php php php php$amountphp php=php php(php$linebdphp php+php php$thisphp-php>php_currentCharWidthphp php-php php1php php-php php$charbdphp)php;
php php php php php php php php php php php php php}php elsephp php{
php php php php php php php php php php php php php php php php php$linebdphp php=php strlenphp(php$thisphp-php>php_outputLinephp[php$rowphp]php)php;
php php php php php php php php php php php php php php php php whilephp php(truephp)php php{
php php php php php php php php php php php php php php php php php php php php ifphp php(php!issetphp(php$thisphp-php>php_outputLinephp[php$rowphp]php[php$linebdphp]php)php)php php{
php php php php php php php php php php php php php php php php php php php php php php php php php$leftCharphp php=php nullphp;
php php php php php php php php php php php php php php php php php php php php php}php elsephp php{
php php php php php php php php php php php php php php php php php php php php php php php php php$leftCharphp php=php php$thisphp-php>php_outputLinephp[php$rowphp]php[php$linebdphp]php;
php php php php php php php php php php php php php php php php php php php php php}

php php php php php php php php php php php php php php php php php php php php ifphp php(php$linebdphp php>php php0php php&php&php php(php$leftCharphp php=php=php=php nullphp php|php|php php$leftCharphp php=php=php php'php php'php)php)php php{
php php php php php php php php php php php php php php php php php php php php php php php php php$linebdphp-php-php;
php php php php php php php php php php php php php php php php php php php php php}php elsephp php{
php php php php php php php php php php php php php php php php php php php php php php php php breakphp;
php php php php php php php php php php php php php php php php php php php php php}
php php php php php php php php php php php php php php php php php}

php php php php php php php php php php php php php php php php php$charbdphp php=php php0php;
php php php php php php php php php php php php php php php php whilephp php(truephp)php php{
php php php php php php php php php php php php php php php php php php php php ifphp php(php!issetphp(php$thisphp-php>php_currentCharphp[php$rowphp]php[php$charbdphp]php)php)php php{
php php php php php php php php php php php php php php php php php php php php php php php php php$rightCharphp php=php nullphp;
php php php php php php php php php php php php php php php php php php php php php}php elsephp php{
php php php php php php php php php php php php php php php php php php php php php php php php php$rightCharphp php=php php$thisphp-php>php_currentCharphp[php$rowphp]php[php$charbdphp]php;
php php php php php php php php php php php php php php php php php php php php php}

php php php php php php php php php php php php php php php php php php php php ifphp php(php$rightCharphp php=php=php=php php'php php'php)php php{
php php php php php php php php php php php php php php php php php php php php php php php php php$charbdphp+php+php;
php php php php php php php php php php php php php php php php php php php php php}php elsephp php{
php php php php php php php php php php php php php php php php php php php php php php php php breakphp;
php php php php php php php php php php php php php php php php php php php php php}
php php php php php php php php php php php php php php php php php}

php php php php php php php php php php php php php php php php php$amountphp php=php php(php$charbdphp php+php php$thisphp-php>php_outlineLengthphp php-php php1php php-php php$linebdphp)php;
php php php php php php php php php php php php php}

php php php php php php php php php php php php ifphp php(emptyphp(php$leftCharphp)php php|php|php php$leftCharphp php=php=php=php php'php php'php)php php{
php php php php php php php php php php php php php php php php php$amountphp+php+php;
php php php php php php php php php php php php php}php elsephp ifphp php(php!emptyphp(php$rightCharphp)php)php php{
php php php php php php php php php php php php php php php php ifphp php(php$thisphp-php>php_smushemphp(php$leftCharphp,php php$rightCharphp)php php!php=php=php nullphp)php php{
php php php php php php php php php php php php php php php php php php php php php$amountphp+php+php;
php php php php php php php php php php php php php php php php php}
php php php php php php php php php php php php php}

php php php php php php php php php php php php php$maxSmushphp php=php minphp(php$amountphp,php php$maxSmushphp)php;
php php php php php php php php php}

php php php php php php php php returnphp php$maxSmushphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Givenphp twophp charactersphp,php attemptsphp tophp smushphp themphp intophp onephp,php accordingphp tophp the
php php php php php php*php currentphp smushmodephp.php Returnsphp smushedphp characterphp orphp falsephp ifphp nophp smushingphp can
php php php php php php*php bephp donephp.
php php php php php php*
php php php php php php*php Smushmodephp valuesphp arephp sumphp ofphp followingphp php(allphp valuesphp smushphp blanksphp)php:
php php php php php php*
php php php php php php*php php php1php:php Smushphp equalphp charsphp php(notphp hardblanksphp)
php php php php php php*php php php2php:php Smushphp php'php_php'php withphp anyphp charphp inphp hierarchyphp below
php php php php php php*php php php4php:php hierarchyphp:php php"php|php"php,php php"php/php\php"php,php php"php[php]php"php,php php"php{php}php"php,php php"php(php)php"php,php php"<php>php"
php php php php php php*php php php php php Eachphp classphp inphp hierphp.php canphp bephp replacedphp byphp laterphp classphp.
php php php php php php*php php php8php:php php[php php+php php]php php-php>php php|php,php php{php php+php php}php php-php>php php|php,php php(php php+php php)php php-php>php php|
php php php php php php*php php1php6php:php php/php php+php php\php php-php>php Xphp,php php>php php+php <php php-php>php Xphp php(onlyphp inphp thatphp orderphp)
php php php php php php*php php3php2php:php hardblankphp php+php hardblankphp php-php>php hardblank
php php php php php php*
php php php php php php*php php@paramphp php stringphp php$leftCharphp php Leftphp characterphp tophp smush
php php php php php php*php php@paramphp php stringphp php$rightCharphp Rightphp characterphp tophp smush
php php php php php php*php php@returnphp string
php php php php php php*php/
php php php php protectedphp functionphp php_smushemphp(php$leftCharphp,php php$rightCharphp)
php php php php php{
php php php php php php php php ifphp php(php$leftCharphp php=php=php=php php'php php'php)php php{
php php php php php php php php php php php php returnphp php$rightCharphp;
php php php php php php php php php}

php php php php php php php php ifphp php(php$rightCharphp php=php=php=php php'php php'php)php php{
php php php php php php php php php php php php returnphp php$leftCharphp;
php php php php php php php php php}

php php php php php php php php ifphp php(php$thisphp-php>php_previousCharWidthphp <php php2php php|php|php php$thisphp-php>php_currentCharWidthphp <php php2php)php php{
php php php php php php php php php php php php php/php/php Disallowsphp overlappingphp ifphp thephp previousphp characterphp orphp thephp current
php php php php php php php php php php php php php/php/php characterphp hasphp aphp widthphp ofphp onephp orphp zerophp.
php php php php php php php php php php php php returnphp nullphp;
php php php php php php php php php}

php php php php php php php php ifphp php(php(php$thisphp-php>php_smushModephp php&php selfphp:php:SMphp_SMUSHphp)php php=php=php=php php0php)php php{
php php php php php php php php php php php php php/php/php Kerning
php php php php php php php php php php php php returnphp nullphp;
php php php php php php php php php}

php php php php php php php php ifphp php(php(php$thisphp-php>php_smushModephp php&php php6php3php)php php=php=php=php php0php)php php{
php php php php php php php php php php php php php/php/php Thisphp isphp smushingphp byphp universalphp overlapping
php php php php php php php php php php php php ifphp php(php$leftCharphp php=php=php=php php'php php'php)php php{
php php php php php php php php php php php php php php php php returnphp php$rightCharphp;
php php php php php php php php php php php php php}php elsephp ifphp php(php$rightCharphp php=php=php=php php'php php'php)php php{
php php php php php php php php php php php php php php php php returnphp php$leftCharphp;
php php php php php php php php php php php php php}php elsephp ifphp php(php$leftCharphp php=php=php=php php$thisphp-php>php_hardBlankphp)php php{
php php php php php php php php php php php php php php php php returnphp php$rightCharphp;
php php php php php php php php php php php php php}php elsephp ifphp php(php$rightCharphp php=php=php=php php$thisphp-php>php_hardBlankphp)php php{
php php php php php php php php php php php php php php php php returnphp php$rightCharphp;
php php php php php php php php php php php php php}php elsephp ifphp php(php$thisphp-php>php_rightToLeftphp php=php=php=php php1php)php php{
php php php php php php php php php php php php php php php php returnphp php$leftCharphp;
php php php php php php php php php php php php php}php elsephp php{
php php php php php php php php php php php php php php php php php/php/php Occursphp inphp thephp absencephp ofphp abovephp exceptions
php php php php php php php php php php php php php php php php returnphp php$rightCharphp;
php php php php php php php php php php php php php}
php php php php php php php php php}

php php php php php php php php ifphp php(php(php$thisphp-php>php_smushModephp php&php selfphp:php:SMphp_HARDBLANKphp)php php>php php0php)php php{
php php php php php php php php php php php php ifphp php(php$leftCharphp php=php=php=php php$thisphp-php>php_hardBlankphp php&php&php php$rightCharphp php=php=php=php php$thisphp-php>php_hardBlankphp)php php{
php php php php php php php php php php php php php php php php returnphp php$leftCharphp;
php php php php php php php php php php php php php}
php php php php php php php php php}

php php php php php php php php ifphp php(php$leftCharphp php=php=php=php php$thisphp-php>php_hardBlankphp php&php&php php$rightCharphp php=php=php=php php$thisphp-php>php_hardBlankphp)php php{
php php php php php php php php php php php php returnphp nullphp;
php php php php php php php php php}

php php php php php php php php ifphp php(php(php$thisphp-php>php_smushModephp php&php selfphp:php:SMphp_EQUALphp)php php>php php0php)php php{
php php php php php php php php php php php php ifphp php(php$leftCharphp php=php=php=php php$rightCharphp)php php{
php php php php php php php php php php php php php php php php returnphp php$leftCharphp;
php php php php php php php php php php php php php}
php php php php php php php php php}

php php php php php php php php ifphp php(php(php$thisphp-php>php_smushModephp php&php selfphp:php:SMphp_LOWLINEphp)php php>php php0php)php php{
php php php php php php php php php php php php ifphp php(php$leftCharphp php=php=php=php php'php_php'php php&php&php strchrphp(php'php|php/php\php\php[php]php{php}php(php)<php>php'php,php php$rightCharphp)php php!php=php=php falsephp)php php{
php php php php php php php php php php php php php php php php returnphp php$rightCharphp;
php php php php php php php php php php php php php}php elsephp ifphp php(php$rightCharphp php=php=php=php php'php_php'php php&php&php strchrphp(php'php|php/php\php\php[php]php{php}php(php)<php>php'php,php php$leftCharphp)php php!php=php=php falsephp)php php{
php php php php php php php php php php php php php php php php returnphp php$leftCharphp;
php php php php php php php php php php php php php}
php php php php php php php php php}

php php php php php php php php ifphp php(php(php$thisphp-php>php_smushModephp php&php selfphp:php:SMphp_HIERARCHYphp)php php>php php0php)php php{
php php php php php php php php php php php php ifphp php(php$leftCharphp php=php=php=php php'php|php'php php&php&php strchrphp(php'php/php\php\php[php]php{php}php(php)<php>php'php,php php$rightCharphp)php php!php=php=php falsephp)php php{
php php php php php php php php php php php php php php php php returnphp php$rightCharphp;
php php php php php php php php php php php php php}php elsephp ifphp php(php$rightCharphp php=php=php=php php'php|php'php php&php&php strchrphp(php'php/php\php\php[php]php{php}php(php)<php>php'php,php php$leftCharphp)php php!php=php=php falsephp)php php{
php php php php php php php php php php php php php php php php returnphp php$leftCharphp;
php php php php php php php php php php php php php}php elsephp ifphp php(strchrphp(php'php/php\php\php'php,php php$leftCharphp)php php&php&php strchrphp(php'php[php]php{php}php(php)<php>php'php,php php$rightCharphp)php php!php=php=php falsephp)php php{
php php php php php php php php php php php php php php php php returnphp php$rightCharphp;
php php php php php php php php php php php php php}php elsephp ifphp php(strchrphp(php'php/php\php\php'php,php php$rightCharphp)php php&php&php strchrphp(php'php[php]php{php}php(php)<php>php'php,php php$leftCharphp)php php!php=php=php falsephp)php php{
php php php php php php php php php php php php php php php php returnphp php$leftCharphp;
php php php php php php php php php php php php php}php elsephp ifphp php(strchrphp(php'php[php]php'php,php php$leftCharphp)php php&php&php strchrphp(php'php{php}php(php)<php>php'php,php php$rightCharphp)php php!php=php=php falsephp)php php{
php php php php php php php php php php php php php php php php returnphp php$rightCharphp;
php php php php php php php php php php php php php}php elsephp ifphp php(strchrphp(php'php[php]php'php,php php$rightCharphp)php php&php&php strchrphp(php'php{php}php(php)<php>php'php,php php$leftCharphp)php php!php=php=php falsephp)php php{
php php php php php php php php php php php php php php php php returnphp php$leftCharphp;
php php php php php php php php php php php php php}php elsephp ifphp php(strchrphp(php'php{php}php'php,php php$leftCharphp)php php&php&php strchrphp(php'php(php)<php>php'php,php php$rightCharphp)php php!php=php=php falsephp)php php{
php php php php php php php php php php php php php php php php returnphp php$rightCharphp;
php php php php php php php php php php php php php}php elsephp ifphp php(strchrphp(php'php{php}php'php,php php$rightCharphp)php php&php&php strchrphp(php'php(php)<php>php'php,php php$leftCharphp)php php!php=php=php falsephp)php php{
php php php php php php php php php php php php php php php php returnphp php$leftCharphp;
php php php php php php php php php php php php php}php elsephp ifphp php(strchrphp(php'php(php)php'php,php php$leftCharphp)php php&php&php strchrphp(php'<php>php'php,php php$rightCharphp)php php!php=php=php falsephp)php php{
php php php php php php php php php php php php php php php php returnphp php$rightCharphp;
php php php php php php php php php php php php php}php elsephp ifphp php(strchrphp(php'php(php)php'php,php php$rightCharphp)php php&php&php strchrphp(php'<php>php'php,php php$leftCharphp)php php!php=php=php falsephp)php php{
php php php php php php php php php php php php php php php php returnphp php$leftCharphp;
php php php php php php php php php php php php php}
php php php php php php php php php}

php php php php php php php php ifphp php(php(php$thisphp-php>php_smushModephp php&php selfphp:php:SMphp_PAIRphp)php php>php php0php)php php{
php php php php php php php php php php php php ifphp php(php$leftCharphp php=php=php=php php'php[php'php php&php&php php$rightCharphp php=php=php=php php'php]php'php)php php{
php php php php php php php php php php php php php php php php returnphp php'php|php'php;
php php php php php php php php php php php php php}php elsephp ifphp php(php$rightCharphp php=php=php=php php'php[php'php php&php&php php$leftCharphp php=php=php=php php'php]php'php)php php{
php php php php php php php php php php php php php php php php returnphp php'php|php'php;
php php php php php php php php php php php php php}php elsephp ifphp php(php$leftCharphp php=php=php=php php'php{php'php php&php&php php$rightCharphp php=php=php=php php'php}php'php)php php{
php php php php php php php php php php php php php php php php returnphp php'php|php'php;
php php php php php php php php php php php php php}php elsephp ifphp php(php$rightCharphp php=php=php=php php'php{php'php php&php&php php$leftCharphp php=php=php=php php'php}php'php)php php{
php php php php php php php php php php php php php php php php returnphp php'php|php'php;
php php php php php php php php php php php php php}php elsephp ifphp php(php$leftCharphp php=php=php=php php'php(php'php php&php&php php$rightCharphp php=php=php=php php'php)php'php)php php{
php php php php php php php php php php php php php php php php returnphp php'php|php'php;
php php php php php php php php php php php php php}php elsephp ifphp php(php$rightCharphp php=php=php=php php'php(php'php php&php&php php$leftCharphp php=php=php=php php'php)php'php)php php{
php php php php php php php php php php php php php php php php returnphp php'php|php'php;
php php php php php php php php php php php php php}
php php php php php php php php php}

php php php php php php php php ifphp php(php(php$thisphp-php>php_smushModephp php&php selfphp:php:SMphp_BIGXphp)php php>php php0php)php php{
php php php php php php php php php php php php ifphp php(php$leftCharphp php=php=php=php php'php/php'php php&php&php php$rightCharphp php=php=php=php php'php\php\php'php)php php{
php php php php php php php php php php php php php php php php returnphp php'php|php'php;
php php php php php php php php php php php php php}php elsephp ifphp php(php$rightCharphp php=php=php=php php'php/php'php php&php&php php$leftCharphp php=php=php=php php'php\php\php'php)php php{
php php php php php php php php php php php php php php php php returnphp php'Yphp'php;
php php php php php php php php php php php php php}php elsephp ifphp php(php$leftCharphp php=php=php=php php'php>php'php php&php&php php$rightCharphp php=php=php=php php'<php'php)php php{
php php php php php php php php php php php php php php php php returnphp php'Xphp'php;
php php php php php php php php php php php php php}
php php php php php php php php php}

php php php php php php php php returnphp nullphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Loadphp thephp specifiedphp font
php php php php php php*
php php php php php php*php php@paramphp php stringphp php$fontFilephp Fontphp filephp tophp load
php php php php php php*php php@throwsphp Zendphp_Textphp_Figletphp_Exceptionphp Whenphp fontphp filephp wasphp notphp found
php php php php php php*php php@throwsphp Zendphp_Textphp_Figletphp_Exceptionphp Whenphp GZIPphp libraryphp isphp requiredphp butphp notphp found
php php php php php php*php php@throwsphp Zendphp_Textphp_Figletphp_Exceptionphp Whenphp fontphp filephp isphp notphp readable
php php php php php php*php php@returnphp void
php php php php php php*php/
php php php php protectedphp functionphp php_loadFontphp(php$fontFilephp)
php php php php php{
php php php php php php php php php/php/php Checkphp ifphp thephp fontphp filephp exists
php php php php php php php php ifphp php(php!filephp_existsphp(php$fontFilephp)php)php php{
php php php php php php php php php php php php requirephp_oncephp php'Zendphp/Textphp/Figletphp/Exceptionphp.phpphp'php;
php php php php php php php php php php php php throwphp newphp Zendphp_Textphp_Figletphp_Exceptionphp(php$fontFilephp php.php php'php:php Fontphp filephp notphp foundphp'php)php;
php php php php php php php php php}

php php php php php php php php php/php/php Checkphp ifphp gzipphp supportphp isphp required
php php php php php php php php ifphp php(substrphp(php$fontFilephp,php php-php3php)php php=php=php=php php'php.gzphp'php)php php{
php php php php php php php php php php php php ifphp php(php!functionphp_existsphp(php'gzcompressphp'php)php)php php{
php php php php php php php php php php php php php php php php requirephp_oncephp php'Zendphp/Textphp/Figletphp/Exceptionphp.phpphp'php;
php php php php php php php php php php php php php php php php throwphp newphp Zendphp_Textphp_Figletphp_Exceptionphp(php'GZIPphp libraryphp isphp requiredphp forphp php'
php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php.php php'gzipphp compressedphp fontphp filesphp'php)php;
php php php php php php php php php php php php php}

php php php php php php php php php php php php php$fontFilephp php php php=php php'compressphp.zlibphp:php/php/php'php php.php php$fontFilephp;
php php php php php php php php php php php php php$compressedphp php=php truephp;
php php php php php php php php php}php elsephp php{
php php php php php php php php php php php php php$compressedphp php=php falsephp;
php php php php php php php php php}

php php php php php php php php php/php/php Tryphp tophp openphp thephp file
php php php php php php php php php$fpphp php=php fopenphp(php$fontFilephp,php php'rbphp'php)php;
php php php php php php php php ifphp php(php$fpphp php=php=php=php falsephp)php php{
php php php php php php php php php php php php requirephp_oncephp php'Zendphp/Textphp/Figletphp/Exceptionphp.phpphp'php;
php php php php php php php php php php php php throwphp newphp Zendphp_Textphp_Figletphp_Exceptionphp(php$fontFilephp php.php php'php:php Couldphp notphp openphp filephp'php)php;
php php php php php php php php php}

php php php php php php php php php/php/php Ifphp thephp filephp isphp notphp compressedphp,php lockphp thephp stream
php php php php php php php php ifphp php(php!php$compressedphp)php php{
php php php php php php php php php php php php flockphp(php$fpphp,php LOCKphp_SHphp)php;
php php php php php php php php php}

php php php php php php php php php/php/php Getphp magic
php php php php php php php php php$magicphp php=php php$thisphp-php>php_readMagicphp(php$fpphp)php;

php php php php php php php php php/php/php Getphp thephp header
php php php php php php php php php$numsReadphp php=php sscanfphp(fgetsphp(php$fpphp,php php1php0php0php0php)php,
php php php php php php php php php php php php php php php php php php php php php php php php php php php php'php%php*cphp%cphp php%dphp php%php*dphp php%dphp php%dphp php%dphp php%dphp php%dphp'php,
php php php php php php php php php php php php php php php php php php php php php php php php php php php php$thisphp-php>php_hardBlankphp,
php php php php php php php php php php php php php php php php php php php php php php php php php php php php$thisphp-php>php_charHeightphp,
php php php php php php php php php php php php php php php php php php php php php php php php php php php php$thisphp-php>php_maxLengthphp,
php php php php php php php php php php php php php php php php php php php php php php php php php php php php$smushphp,
php php php php php php php php php php php php php php php php php php php php php php php php php php php php$cmtLinesphp,
php php php php php php php php php php php php php php php php php php php php php php php php php php php php$rightToLeftphp,
php php php php php php php php php php php php php php php php php php php php php php php php php php php php$thisphp-php>php_fontSmushphp)php;

php php php php php php php php ifphp php(php$magicphp php!php=php=php selfphp:php:FONTFILEphp_MAGICphp_NUMBERphp php|php|php php$numsReadphp <php php5php)php php{
php php php php php php php php php php php php requirephp_oncephp php'Zendphp/Textphp/Figletphp/Exceptionphp.phpphp'php;
php php php php php php php php php php php php throwphp newphp Zendphp_Textphp_Figletphp_Exceptionphp(php$fontFilephp php.php php'php:php Notphp aphp FIGletphp php2php fontphp filephp'php)php;
php php php php php php php php php}

php php php php php php php php php/php/php Setphp defaultphp rightphp tophp left
php php php php php php php php ifphp php(php$numsReadphp <php php6php)php php{
php php php php php php php php php php php php php$rightToLeftphp php=php php0php;
php php php php php php php php php}

php php php php php php php php php/php/php Ifphp nophp smushphp2php,php decodephp smushphp intophp smushphp2
php php php php php php php php ifphp php(php$numsReadphp <php php7php)php php{
php php php php php php php php php php php php ifphp php(php$smushphp php=php=php=php php2php)php php{
php php php php php php php php php php php php php php php php php$thisphp-php>php_fontSmushphp php=php selfphp:php:SMphp_KERNphp;
php php php php php php php php php php php php php}php elsephp ifphp php(php$smushphp <php php0php)php php{
php php php php php php php php php php php php php php php php php$thisphp-php>php_fontSmushphp php=php php0php;
php php php php php php php php php php php php php}php elsephp php{
php php php php php php php php php php php php php php php php php$thisphp-php>php_fontSmushphp php=php php(php(php$smushphp php&php php3php1php)php php|php selfphp:php:SMphp_SMUSHphp)php;
php php php php php php php php php php php php php}
php php php php php php php php php}

php php php php php php php php php/php/php Correctphp charphp heightphp php&php&php maxlength
php php php php php php php php php$thisphp-php>php_charHeightphp php=php maxphp(php1php,php php$thisphp-php>php_charHeightphp)php;
php php php php php php php php php$thisphp-php>php_maxLengthphp php php=php maxphp(php1php,php php$thisphp-php>php_maxLengthphp)php;

php php php php php php php php php/php/php Givephp ourselvesphp somephp extraphp room
php php php php php php php php php$thisphp-php>php_maxLengthphp php+php=php php1php0php0php;

php php php php php php php php php/php/php Seephp ifphp wephp havephp tophp overridephp smushphp settings
php php php php php php php php php$thisphp-php>php_setUsedSmushphp(php)php;

php php php php php php php php php/php/php Getphp leftphp tophp rightphp value
php php php php php php php php ifphp php(php$thisphp-php>php_rightToLeftphp php=php=php=php nullphp)php php{
php php php php php php php php php php php php php$thisphp-php>php_rightToLeftphp php=php php$rightToLeftphp;
php php php php php php php php php}

php php php php php php php php php/php/php Getphp justificationphp value
php php php php php php php php ifphp php(php$thisphp-php>php_justificationphp php=php=php=php nullphp)php php{
php php php php php php php php php php php php php$thisphp-php>php_justificationphp php=php php(php2php php*php php$thisphp-php>php_rightToLeftphp)php;
php php php php php php php php php}

php php php php php php php php php/php/php Skipphp allphp commentphp lines
php php php php php php php php forphp php(php$linephp php=php php1php;php php$linephp <php=php php$cmtLinesphp;php php$linephp+php+php)php php{
php php php php php php php php php php php php php$thisphp-php>php_skipToEolphp(php$fpphp)php;
php php php php php php php php php}

php php php php php php php php php/php/php Fetchphp allphp ASCIIphp characters
php php php php php php php php forphp php(php$asciiCodephp php=php php3php2php;php php$asciiCodephp <php php1php2php7php;php php$asciiCodephp+php+php)php php{
php php php php php php php php php php php php php$thisphp-php>php_charListphp[php$asciiCodephp]php php=php php$thisphp-php>php_loadCharphp(php$fpphp)php;
php php php php php php php php php}

php php php php php php php php php/php/php Fetchphp allphp germanphp characters
php php php php php php php php foreachphp php(php$thisphp-php>php_germanCharsphp asphp php$uniCodephp)php php{
php php php php php php php php php php php php php$charphp php=php php$thisphp-php>php_loadCharphp(php$fpphp)php;

php php php php php php php php php php php php ifphp php(php$charphp php=php=php=php falsephp)php php{
php php php php php php php php php php php php php php php php fclosephp(php$fpphp)php;
php php php php php php php php php php php php php php php php returnphp;
php php php php php php php php php php php php php}

php php php php php php php php php php php php ifphp php(trimphp(implodephp(php'php'php,php php$charphp)php)php php!php=php=php php'php'php)php php{
php php php php php php php php php php php php php php php php php$thisphp-php>php_charListphp[php$uniCodephp]php php=php php$charphp;
php php php php php php php php php php php php php}
php php php php php php php php php}

php php php php php php php php php/php/php Atphp thephp endphp fetchphp allphp extendedphp characters
php php php php php php php php whilephp php(php!feofphp(php$fpphp)php)php php{
php php php php php php php php php php php php php/php/php Getphp thephp Unicode
php php php php php php php php php php php php listphp(php$uniCodephp)php php=php explodephp(php'php php'php,php fgetsphp(php$fpphp,php php2php0php4php8php)php)php;

php php php php php php php php php php php php ifphp php(emptyphp(php$uniCodephp)php)php php{
php php php php php php php php php php php php php php php php continuephp;
php php php php php php php php php php php php php}

php php php php php php php php php php php php php/php/php Convertphp itphp ifphp required
php php php php php php php php php php php php ifphp php(substrphp(php$uniCodephp,php php0php,php php2php)php php=php=php=php php'php0xphp'php)php php{
php php php php php php php php php php php php php php php php php$uniCodephp php=php hexdecphp(substrphp(php$uniCodephp,php php2php)php)php;
php php php php php php php php php php php php php}php elsephp ifphp php(substrphp(php$uniCodephp,php php0php,php php1php)php php=php=php=php php'php0php'php and
php php php php php php php php php php php php php php php php php php php php php php php php$uniCodephp php!php=php=php php'php0php'php or
php php php php php php php php php php php php php php php php php php php php php php php substrphp(php$uniCodephp,php php0php,php php2php)php php=php=php=php php'php-php0php'php)php php{
php php php php php php php php php php php php php php php php php$uniCodephp php=php octdecphp(php$uniCodephp)php;
php php php php php php php php php php php php php}php elsephp php{
php php php php php php php php php php php php php php php php php$uniCodephp php=php php(intphp)php php$uniCodephp;
php php php php php php php php php php php php php}

php php php php php php php php php php php php php/php/php Nowphp fetchphp thephp character
php php php php php php php php php php php php php$charphp php=php php$thisphp-php>php_loadCharphp(php$fpphp)php;

php php php php php php php php php php php php ifphp php(php$charphp php=php=php=php falsephp)php php{
php php php php php php php php php php php php php php php php fclosephp(php$fpphp)php;
php php php php php php php php php php php php php php php php returnphp;
php php php php php php php php php php php php php}

php php php php php php php php php php php php php$thisphp-php>php_charListphp[php$uniCodephp]php php=php php$charphp;
php php php php php php php php php}

php php php php php php php php fclosephp(php$fpphp)php;

php php php php php php php php php$thisphp-php>php_fontLoadedphp php=php truephp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Setphp thephp usedphp smushphp modephp,php accordingphp tophp smushphp overridephp,php userphp smsushphp and
php php php php php php*php fontphp smushphp.
php php php php php php*
php php php php php php*php php@returnphp void
php php php php php php*php/
php php php php protectedphp functionphp php_setUsedSmushphp(php)
php php php php php{
php php php php php php php php ifphp php(php$thisphp-php>php_smushOverridephp php=php=php=php selfphp:php:SMOphp_NOphp)php php{
php php php php php php php php php php php php php$thisphp-php>php_smushModephp php=php php$thisphp-php>php_fontSmushphp;
php php php php php php php php php}php elsephp ifphp php(php$thisphp-php>php_smushOverridephp php=php=php=php selfphp:php:SMOphp_YESphp)php php{
php php php php php php php php php php php php php$thisphp-php>php_smushModephp php=php php$thisphp-php>php_userSmushphp;
php php php php php php php php php}php elsephp ifphp php(php$thisphp-php>php_smushOverridephp php=php=php=php selfphp:php:SMOphp_FORCEphp)php php{
php php php php php php php php php php php php php$thisphp-php>php_smushModephp php=php php(php$thisphp-php>php_fontSmushphp php|php php$thisphp-php>php_userSmushphp)php;
php php php php php php php php php}
php php php php php}

php php php php php/php*php*
php php php php php php*php Readsphp aphp fourphp-characterphp magicphp stringphp fromphp aphp stream
php php php php php php*
php php php php php php*php php@paramphp php resourcephp php$fpphp Filephp pointerphp tophp thephp fontphp file
php php php php php php*php php@returnphp string
php php php php php php*php/
php php php php protectedphp functionphp php_readMagicphp(php$fpphp)
php php php php php{
php php php php php php php php php$magicphp php=php php'php'php;

php php php php php php php php forphp php(php$iphp php=php php0php;php php$iphp <php php4php;php php$iphp+php+php)php php{
php php php php php php php php php php php php php$magicphp php.php=php fgetcphp(php$fpphp)php;
php php php php php php php php php}

php php php php php php php php returnphp php$magicphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Skipphp aphp streamphp tophp thephp endphp ofphp line
php php php php php php*
php php php php php php*php php@paramphp php resourcephp php$fpphp Filephp pointerphp tophp thephp fontphp file
php php php php php php*php php@returnphp void
php php php php php php*php/
php php php php protectedphp functionphp php_skipToEolphp(php$fpphp)
php php php php php{
php php php php php php php php php$dummyphp php=php fgetcphp(php$fpphp)php;
php php php php php php php php whilephp php(php$dummyphp php!php=php=php falsephp php&php&php php!feofphp(php$fpphp)php)php php{
php php php php php php php php php php php php ifphp php(php$dummyphp php=php=php=php php"php\nphp"php)php php{
php php php php php php php php php php php php php php php php returnphp;
php php php php php php php php php php php php php}

php php php php php php php php php php php php ifphp php(php$dummyphp php=php=php=php php"php\rphp"php)php php{
php php php php php php php php php php php php php php php php php$dummyphp php=php fgetcphp(php$fpphp)php;

php php php php php php php php php php php php php php php php ifphp php(php!feofphp(php$fpphp)php php&php&php php$dummyphp php!php=php=php php"php\nphp"php)php php{
php php php php php php php php php php php php php php php php php php php php fseekphp(php$fpphp,php php-php1php,php SEEKphp_SETphp)php;
php php php php php php php php php php php php php php php php php}

php php php php php php php php php php php php php php php php returnphp;
php php php php php php php php php php php php php}

php php php php php php php php php php php php php$dummyphp php=php fgetcphp(php$fpphp)php;
php php php php php php php php php}
php php php php php}

php php php php php/php*php*
php php php php php php*php Loadphp aphp singlephp characterphp fromphp thephp fontphp file
php php php php php php*
php php php php php php*php php@paramphp php resourcephp php$fpphp Filephp pointerphp tophp thephp fontphp file
php php php php php php*php php@returnphp array
php php php php php php*php/
php php php php protectedphp functionphp php_loadCharphp(php$fpphp)
php php php php php{
php php php php php php php php php$charphp php=php arrayphp(php)php;

php php php php php php php php forphp php(php$iphp php=php php0php;php php$iphp <php php$thisphp-php>php_charHeightphp;php php$iphp+php+php)php php{
php php php php php php php php php php php php ifphp php(feofphp(php$fpphp)php)php php{
php php php php php php php php php php php php php php php php returnphp falsephp;
php php php php php php php php php php php php php}

php php php php php php php php php php php php php$linephp php=php rtrimphp(fgetsphp(php$fpphp,php php2php0php4php8php)php,php php"php\rphp\nphp"php)php;

php php php php php php php php php php php php ifphp php(pregphp_matchphp(php'php#php(php.php)php\php\php1php?php$php#php'php,php php$linephp,php php$resultphp)php php=php=php=php php1php)php php{
php php php php php php php php php php php php php php php php php$linephp php=php strphp_replacephp(php$resultphp[php1php]php,php php'php'php,php php$linephp)php;
php php php php php php php php php php php php php}

php php php php php php php php php php php php php$charphp[php]php php=php php$linephp;
php php php php php php php php php}

php php php php php php php php returnphp php$charphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Unicodephp compatiblephp ordphp(php)php method
php php php php php php*
php php php php php php*php php@paramphp php stringphp php$cphp Thephp charphp tophp getphp thephp valuephp from
php php php php php php*php php@returnphp integer
php php php php php php*php/
php php php php protectedphp functionphp php_uniOrdphp(php$cphp)
php php php php php{
php php php php php php php php php$hphp php=php ordphp(php$cphp[php0php]php)php;

php php php php php php php php ifphp php(php$hphp <php=php php0xphp7Fphp)php php{
php php php php php php php php php php php php php$ordphp php=php php$hphp;
php php php php php php php php php}php elsephp ifphp php(php$hphp <php php0xCphp2php)php php{
php php php php php php php php php php php php php$ordphp php=php php0php;
php php php php php php php php php}php elsephp ifphp php(php$hphp <php=php php0xDFphp)php php{
php php php php php php php php php php php php php$ordphp php=php php(php(php$hphp php&php php0xphp1Fphp)php <php<php php6php php|php php(ordphp(php$cphp[php1php]php)php php&php php0xphp3Fphp)php)php;
php php php php php php php php php}php elsephp ifphp php(php$hphp <php=php php0xEFphp)php php{
php php php php php php php php php php php php php$ordphp php=php php(php(php$hphp php&php php0xphp0Fphp)php <php<php php1php2php php|php php(ordphp(php$cphp[php1php]php)php php&php php0xphp3Fphp)php <php<php php6php php|php php(ordphp(php$cphp[php2php]php)php php&php php0xphp3Fphp)php)php;
php php php php php php php php php}php elsephp ifphp php(php$hphp <php=php php0xFphp4php)php php{
php php php php php php php php php php php php php$ordphp php=php php(php(php$hphp php&php php0xphp0Fphp)php <php<php php1php8php php|php php(ordphp(php$cphp[php1php]php)php php&php php0xphp3Fphp)php <php<php php1php2php php|
php php php php php php php php php php php php php php php php php php php php(ordphp(php$cphp[php2php]php)php php&php php0xphp3Fphp)php <php<php php6php php|php php(ordphp(php$cphp[php3php]php)php php&php php0xphp3Fphp)php)php;
php php php php php php php php php}php elsephp php{
php php php php php php php php php php php php php$ordphp php=php php0php;
php php php php php php php php php}

php php php php php php php php returnphp php$ordphp;
php php php php php}
php}
