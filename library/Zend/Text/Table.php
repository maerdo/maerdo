<php?php
php/php*php*
php php*php Zendphp Framework
php php*
php php*php LICENSE
php php*
php php*php Thisphp sourcephp filephp isphp subjectphp tophp thephp newphp BSDphp licensephp thatphp isphp bundled
php php*php withphp thisphp packagephp inphp thephp filephp LICENSEphp.txtphp.
php php*php Itphp isphp alsophp availablephp throughphp thephp worldphp-widephp-webphp atphp thisphp URLphp:
php php*php httpphp:php/php/frameworkphp.zendphp.comphp/licensephp/newphp-bsd
php php*php Ifphp youphp didphp notphp receivephp aphp copyphp ofphp thephp licensephp andphp arephp unablephp to
php php*php obtainphp itphp throughphp thephp worldphp-widephp-webphp,php pleasephp sendphp anphp email
php php*php tophp licensephp@zendphp.comphp sophp wephp canphp sendphp youphp aphp copyphp immediatelyphp.
php php*
php php*php php@categoryphp php Zend
php php*php php@packagephp php php Zendphp_Textphp_Table
php php*php php@copyrightphp php Copyrightphp php(cphp)php php2php0php0php5php-php2php0php1php0php Zendphp Technologiesphp USAphp Incphp.php php(httpphp:php/php/wwwphp.zendphp.comphp)
php php*php php@licensephp php php httpphp:php/php/frameworkphp.zendphp.comphp/licensephp/newphp-bsdphp php php php php Newphp BSDphp License
php php*php php@versionphp php php php$Idphp:php Tablephp.phpphp php2php0php0php9php6php php2php0php1php0php-php0php1php-php0php6php php0php2php:php0php5php:php0php9Zphp bkarwinphp php$
php php*php/

php/php*php*
php php*php Zendphp_Textphp_Tablephp enablesphp developersphp tophp createphp tablesphp outphp ofphp characters
php php*
php php*php php@categoryphp php Zend
php php*php php@packagephp php php Zendphp_Textphp_Table
php php*php php@copyrightphp php Copyrightphp php(cphp)php php2php0php0php5php-php2php0php1php0php Zendphp Technologiesphp USAphp Incphp.php php(httpphp:php/php/wwwphp.zendphp.comphp)
php php*php php@licensephp php php httpphp:php/php/frameworkphp.zendphp.comphp/licensephp/newphp-bsdphp php php php php Newphp BSDphp License
php php*php/
classphp Zendphp_Textphp_Table
php{
php php php php php/php*php*
php php php php php php*php Autophp seperatorphp settings
php php php php php php*php/
php php php php constphp AUTOphp_SEPARATEphp_NONEphp php php php=php php0xphp0php;
php php php php constphp AUTOphp_SEPARATEphp_HEADERphp php=php php0xphp1php;
php php php php constphp AUTOphp_SEPARATEphp_FOOTERphp php=php php0xphp2php;
php php php php constphp AUTOphp_SEPARATEphp_ALLphp php php php php=php php0xphp4php;

php php php php php/php*php*
php php php php php php*php Decoratorphp usedphp forphp thephp tablephp borders
php php php php php php*
php php php php php php*php php@varphp Zendphp_Textphp_Tablephp_Decoratorphp_Interface
php php php php php php*php/
php php php php protectedphp php$php_decoratorphp php=php nullphp;

php php php php php/php*php*
php php php php php php*php Listphp ofphp allphp columnphp widths
php php php php php php*
php php php php php php*php php@varphp array
php php php php php php*php/
php php php php protectedphp php$php_columnWidthsphp php=php nullphp;

php php php php php/php*php*
php php php php php php*php Rowsphp ofphp thephp table
php php php php php php*
php php php php php php*php php@varphp array
php php php php php php*php/
php php php php protectedphp php$php_rowsphp php=php arrayphp(php)php;

php php php php php/php*php*
php php php php php php*php Autophp separationphp mode
php php php php php php*
php php php php php php*php php@varphp integer
php php php php php php*php/
php php php php protectedphp php$php_autoSeparatephp php=php selfphp:php:AUTOphp_SEPARATEphp_ALLphp;

php php php php php/php*php*
php php php php php php*php Paddingphp forphp columns
php php php php php php*
php php php php php php*php php@varphp integer
php php php php php php*php/
php php php php protectedphp php$php_paddingphp php=php php0php;

php php php php php/php*php*
php php php php php php*php Defaultphp columnphp alignsphp forphp rowsphp createdphp byphp appendRowphp(arrayphp php$dataphp)
php php php php php php*
php php php php php php*php php@varphp array
php php php php php php*php/
php php php php protectedphp php$php_defaultColumnAlignsphp php=php arrayphp(php)php;

php php php php php/php*php*
php php php php php php*php Pluginphp loaderphp forphp decorators
php php php php php php*
php php php php php php*php php@varphp string
php php php php php php*php/
php php php php protectedphp php$php_pluginLoaderphp php=php nullphp;

php php php php php/php*php*
php php php php php php*php Charsetphp whichphp isphp usedphp forphp inputphp byphp default
php php php php php php*
php php php php php php*php php@varphp string
php php php php php php*php/
php php php php protectedphp staticphp php$php_inputCharsetphp php=php php'utfphp-php8php'php;

php php php php php/php*php*
php php php php php php*php Charsetphp whichphp isphp usedphp internally
php php php php php php*
php php php php php php*php php@varphp string
php php php php php php*php/
php php php php protectedphp staticphp php$php_outputCharsetphp php=php php'utfphp-php8php'php;

php php php php php/php*php*
php php php php php php*php Optionphp keysphp tophp skipphp whenphp callingphp setOptionsphp(php)
php php php php php php*
php php php php php php*php php@varphp array
php php php php php php*php/
php php php php protectedphp php$php_skipOptionsphp php=php arrayphp(
php php php php php php php php php'optionsphp'php,
php php php php php php php php php'configphp'php,
php php php php php php php php php'defaultColumnAlignphp'php,
php php php php php)php;

php php php php php/php*php*
php php php php php php*php Createphp aphp basicphp tablephp object
php php php php php php*
php php php php php php*php php@paramphp php arrayphp php php php php php php php php php php php php php$columnsWidthsphp Listphp ofphp allphp columnphp widths
php php php php php php*php php@paramphp php Zendphp_Configphp|arrayphp php$optionsphp php php php php php php Configurationphp options
php php php php php php*php php@throwsphp Zendphp_Textphp_Tablephp_Exceptionphp Whenphp nophp columnsphp widthsphp werephp set
php php php php php php*php/
php php php php publicphp functionphp php_php_constructphp(php$optionsphp php=php nullphp)
php php php php php{
php php php php php php php php php/php/php Setphp options
php php php php php php php php ifphp php(isphp_arrayphp(php$optionsphp)php)php php{
php php php php php php php php php php php php php$thisphp-php>setOptionsphp(php$optionsphp)php;
php php php php php php php php php}php elsephp ifphp php(php$optionsphp instanceofphp Zendphp_Configphp)php php{
php php php php php php php php php php php php php$thisphp-php>setConfigphp(php$optionsphp)php;
php php php php php php php php php}

php php php php php php php php php/php/php Checkphp ifphp columnphp widthsphp werephp set
php php php php php php php php php/php/php php@todophp Whenphp columnphp widthsphp werephp notphp setphp,php assumephp autophp-sizing
php php php php php php php php ifphp php(php$thisphp-php>php_columnWidthsphp php=php=php=php nullphp)php php{
php php php php php php php php php php php php requirephp_oncephp php'Zendphp/Textphp/Tablephp/Exceptionphp.phpphp'php;
php php php php php php php php php php php php throwphp newphp Zendphp_Textphp_Tablephp_Exceptionphp(php'Youphp mustphp definephp thephp columnphp widthsphp'php)php;
php php php php php php php php php}

php php php php php php php php php/php/php Ifphp nophp decoratorphp wasphp givenphp,php usephp defaultphp unicodephp decorator
php php php php php php php php ifphp php(php$thisphp-php>php_decoratorphp php=php=php=php nullphp)php php{
php php php php php php php php php php php php ifphp php(selfphp:php:getOutputCharsetphp(php)php php=php=php=php php'utfphp-php8php'php)php php{
php php php php php php php php php php php php php php php php php$thisphp-php>setDecoratorphp(php'unicodephp'php)php;
php php php php php php php php php php php php php}php elsephp php{
php php php php php php php php php php php php php php php php php$thisphp-php>setDecoratorphp(php'asciiphp'php)php;
php php php php php php php php php php php php php}
php php php php php php php php php}
php php php php php}

php php php php php/php*php*
php php php php php php*php Setphp optionsphp fromphp array
php php php php php php*
php php php php php php*php php@paramphp php arrayphp php$optionsphp Configurationphp forphp Zendphp_Textphp_Table
php php php php php php*php php@returnphp Zendphp_Textphp_Table
php php php php php php*php/
php php php php publicphp functionphp setOptionsphp(arrayphp php$optionsphp)
php php php php php{
php php php php php php php php foreachphp php(php$optionsphp asphp php$keyphp php=php>php php$valuephp)php php{
php php php php php php php php php php php php ifphp php(inphp_arrayphp(strtolowerphp(php$keyphp)php,php php$thisphp-php>php_skipOptionsphp)php)php php{
php php php php php php php php php php php php php php php php continuephp;
php php php php php php php php php php php php php}

php php php php php php php php php php php php php$methodphp php=php php'setphp'php php.php ucfirstphp(php$keyphp)php;
php php php php php php php php php php php php ifphp php(methodphp_existsphp(php$thisphp,php php$methodphp)php)php php{
php php php php php php php php php php php php php php php php php$thisphp-php>php$methodphp(php$valuephp)php;
php php php php php php php php php php php php php}
php php php php php php php php php}

php php php php php php php php returnphp php$thisphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Setphp optionsphp fromphp configphp object
php php php php php php*
php php php php php php*php php@paramphp php Zendphp_Configphp php$configphp Configurationphp forphp Zendphp_Textphp_Table
php php php php php php*php php@returnphp Zendphp_Textphp_Table
php php php php php php*php/
php php php php publicphp functionphp setConfigphp(Zendphp_Configphp php$configphp)
php php php php php{
php php php php php php php php returnphp php$thisphp-php>setOptionsphp(php$configphp-php>toArrayphp(php)php)php;
php php php php php}

php php php php php/php*php*
php php php php php php*php Setphp columnphp widths
php php php php php php*
php php php php php php*php php@paramphp php arrayphp php$columnWidthsphp Widthsphp ofphp allphp columns
php php php php php php*php php@throwsphp Zendphp_Textphp_Tablephp_Exceptionphp Whenphp nophp columnsphp werephp supplied
php php php php php php*php php@throwsphp Zendphp_Textphp_Tablephp_Exceptionphp Whenphp aphp columnphp hasphp anphp invalidphp width
php php php php php php*php php@returnphp Zendphp_Textphp_Table
php php php php php php*php/
php php php php publicphp functionphp setColumnWidthsphp(arrayphp php$columnWidthsphp)
php php php php php{
php php php php php php php php ifphp php(countphp(php$columnWidthsphp)php php=php=php=php php0php)php php{
php php php php php php php php php php php php requirephp_oncephp php'Zendphp/Textphp/Tablephp/Exceptionphp.phpphp'php;
php php php php php php php php php php php php throwphp newphp Zendphp_Textphp_Tablephp_Exceptionphp(php'Youphp mustphp supplyphp atphp leastphp onephp columnphp'php)php;
php php php php php php php php php}

php php php php php php php php foreachphp php(php$columnWidthsphp asphp php$columnNumphp php=php>php php$columnWidthphp)php php{
php php php php php php php php php php php php ifphp php(isphp_intphp(php$columnWidthphp)php php=php=php=php falsephp orphp php$columnWidthphp <php php1php)php php{
php php php php php php php php php php php php php php php php requirephp_oncephp php'Zendphp/Textphp/Tablephp/Exceptionphp.phpphp'php;
php php php php php php php php php php php php php php php php throwphp newphp Zendphp_Textphp_Tablephp_Exceptionphp(php'Columnphp php'php php.php php$columnNumphp php.php php'php hasphp anphp invalidphp'
php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php.php php'php columnphp widthphp'php)php;
php php php php php php php php php php php php php}
php php php php php php php php php}

php php php php php php php php php$thisphp-php>php_columnWidthsphp php=php php$columnWidthsphp;

php php php php php php php php returnphp php$thisphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Setphp autophp separationphp mode
php php php php php php*
php php php php php php*php php@paramphp php integerphp php$autoSeparatephp Autophp separationphp mode
php php php php php php*php php@returnphp Zendphp_Textphp_Table
php php php php php php*php/
php php php php publicphp functionphp setAutoSeparatephp(php$autoSeparatephp)
php php php php php{
php php php php php php php php php$thisphp-php>php_autoSeparatephp php=php php(intphp)php php$autoSeparatephp;
php php php php php php php php returnphp php$thisphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Setphp decorator
php php php php php php*
php php php php php php*php php@paramphp php Zendphp_Textphp_Tablephp_Decoratorphp_Interfacephp|stringphp php$decoratorphp Decoratorphp tophp use
php php php php php php*php php@returnphp Zendphp_Textphp_Table
php php php php php php*php/
php php php php publicphp functionphp setDecoratorphp(php$decoratorphp)
php php php php php{
php php php php php php php php ifphp php(php$decoratorphp instanceofphp Zendphp_Textphp_Tablephp_Decoratorphp_Interfacephp)php php{
php php php php php php php php php php php php php$thisphp-php>php_decoratorphp php=php php$decoratorphp;
php php php php php php php php php}php elsephp php{
php php php php php php php php php php php php php$classnamephp php php php php php php php php=php php$thisphp-php>getPluginLoaderphp(php)php-php>loadphp(php$decoratorphp)php;
php php php php php php php php php php php php php$thisphp-php>php_decoratorphp php=php newphp php$classnamephp;
php php php php php php php php php}

php php php php php php php php returnphp php$thisphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Setphp thephp columnphp padding
php php php php php php*
php php php php php php*php php@paramphp php integerphp php$paddingphp Thephp paddingphp forphp thephp columns
php php php php php php*php php@returnphp Zendphp_Textphp_Table
php php php php php php*php/
php php php php publicphp functionphp setPaddingphp(php$paddingphp)
php php php php php{
php php php php php php php php php$thisphp-php>php_paddingphp php=php maxphp(php0php,php php(intphp)php php$paddingphp)php;
php php php php php php php php returnphp php$thisphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Getphp thephp pluginphp loaderphp forphp decorators
php php php php php php*
php php php php php php*php php@returnphp Zendphp_Loaderphp_PluginLoader
php php php php php php*php/
php php php php publicphp functionphp getPluginLoaderphp(php)
php php php php php{
php php php php php php php php ifphp php(php$thisphp-php>php_pluginLoaderphp php=php=php=php nullphp)php php{
php php php php php php php php php php php php php$prefixphp php php php php php=php php'Zendphp_Textphp_Tablephp_Decoratorphp_php'php;
php php php php php php php php php php php php php$pathPrefixphp php=php php'Zendphp/Textphp/Tablephp/Decoratorphp/php'php;

php php php php php php php php php php php php requirephp_oncephp php'Zendphp/Loaderphp/PluginLoaderphp.phpphp'php;
php php php php php php php php php php php php php$thisphp-php>php_pluginLoaderphp php=php newphp Zendphp_Loaderphp_PluginLoaderphp(arrayphp(php$prefixphp php=php>php php$pathPrefixphp)php)php;
php php php php php php php php php}

php php php php php php php php returnphp php$thisphp-php>php_pluginLoaderphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Setphp defaultphp columnphp alignphp forphp rowsphp createdphp byphp appendRowphp(arrayphp php$dataphp)
php php php php php php*
php php php php php php*php php@paramphp php integerphp php$columnNum
php php php php php php*php php@paramphp php stringphp php php$align
php php php php php php*php php@returnphp Zendphp_Textphp_Table
php php php php php php*php/
php php php php publicphp functionphp setDefaultColumnAlignphp(php$columnNumphp,php php$alignphp)
php php php php php{
php php php php php php php php php$thisphp-php>php_defaultColumnAlignsphp[php$columnNumphp]php php=php php$alignphp;

php php php php php php php php returnphp php$thisphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Setphp thephp inputphp charsetphp forphp columnphp contents
php php php php php php*
php php php php php php*php php@paramphp stringphp php$charset
php php php php php php*php/
php php php php publicphp staticphp functionphp setInputCharsetphp(php$charsetphp)
php php php php php{
php php php php php php php php selfphp:php:php$php_inputCharsetphp php=php strtolowerphp(php$charsetphp)php;
php php php php php}

php php php php php/php*php*
php php php php php php*php Getphp thephp inputphp charsetphp forphp columnphp contents
php php php php php php*
php php php php php php*php php@paramphp stringphp php$charset
php php php php php php*php/
php php php php publicphp staticphp functionphp getInputCharsetphp(php)
php php php php php{
php php php php php php php php returnphp selfphp:php:php$php_inputCharsetphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Setphp thephp outputphp charsetphp forphp columnphp contents
php php php php php php*
php php php php php php*php php@paramphp stringphp php$charset
php php php php php php*php/
php php php php publicphp staticphp functionphp setOutputCharsetphp(php$charsetphp)
php php php php php{
php php php php php php php php selfphp:php:php$php_outputCharsetphp php=php strtolowerphp(php$charsetphp)php;
php php php php php}

php php php php php/php*php*
php php php php php php*php Getphp thephp outputphp charsetphp forphp columnphp contents
php php php php php php*
php php php php php php*php php@paramphp stringphp php$charset
php php php php php php*php/
php php php php publicphp staticphp functionphp getOutputCharsetphp(php)
php php php php php{
php php php php php php php php returnphp selfphp:php:php$php_outputCharsetphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Appendphp aphp rowphp tophp thephp table
php php php php php php*
php php php php php php*php php@paramphp php arrayphp|Zendphp_Textphp_Tablephp_Rowphp php$rowphp Thephp rowphp tophp appendphp tophp thephp table
php php php php php php*php php@throwsphp Zendphp_Textphp_Tablephp_Exceptionphp Whenphp php$rowphp isphp neitherphp anphp arrayphp norphp Zendphp_Zextphp_Tablephp_Row
php php php php php php*php php@throwsphp Zendphp_Textphp_Tablephp_Exceptionphp Whenphp aphp rowphp containsphp toophp manyphp columns
php php php php php php*php php@returnphp Zendphp_Textphp_Table
php php php php php php*php/
php php php php publicphp functionphp appendRowphp(php$rowphp)
php php php php php{
php php php php php php php php ifphp php(php!isphp_arrayphp(php$rowphp)php php&php&php php!php(php$rowphp instanceofphp Zendphp_Textphp_Tablephp_Rowphp)php)php php{
php php php php php php php php php php php php requirephp_oncephp php'Zendphp/Textphp/Tablephp/Exceptionphp.phpphp'php;
php php php php php php php php php php php php throwphp newphp Zendphp_Textphp_Tablephp_Exceptionphp(php'php$rowphp mustphp bephp anphp arrayphp orphp instancephp ofphp Zendphp_Textphp_Tablephp_Rowphp'php)php;
php php php php php php php php php}

php php php php php php php php ifphp php(isphp_arrayphp(php$rowphp)php)php php{
php php php php php php php php php php php php ifphp php(countphp(php$rowphp)php php>php countphp(php$thisphp-php>php_columnWidthsphp)php)php php{
php php php php php php php php php php php php php php php php requirephp_oncephp php'Zendphp/Textphp/Tablephp/Exceptionphp.phpphp'php;
php php php php php php php php php php php php php php php php throwphp newphp Zendphp_Textphp_Tablephp_Exceptionphp(php'Rowphp containsphp toophp manyphp columnsphp'php)php;
php php php php php php php php php php php php php}

php php php php php php php php php php php php requirephp_oncephp php'Zendphp/Textphp/Tablephp/Rowphp.phpphp'php;

php php php php php php php php php php php php php$dataphp php php php=php php$rowphp;
php php php php php php php php php php php php php$rowphp php php php php=php newphp Zendphp_Textphp_Tablephp_Rowphp(php)php;
php php php php php php php php php php php php php$colNumphp php=php php0php;
php php php php php php php php php php php php foreachphp php(php$dataphp asphp php$columnDataphp)php php{
php php php php php php php php php php php php php php php php ifphp php(issetphp(php$thisphp-php>php_defaultColumnAlignsphp[php$colNumphp]php)php)php php{
php php php php php php php php php php php php php php php php php php php php php$alignphp php=php php$thisphp-php>php_defaultColumnAlignsphp[php$colNumphp]php;
php php php php php php php php php php php php php php php php php}php elsephp php{
php php php php php php php php php php php php php php php php php php php php php$alignphp php=php nullphp;
php php php php php php php php php php php php php php php php php}

php php php php php php php php php php php php php php php php php$rowphp-php>appendColumnphp(newphp Zendphp_Textphp_Tablephp_Columnphp(php$columnDataphp,php php$alignphp)php)php;
php php php php php php php php php php php php php php php php php$colNumphp+php+php;
php php php php php php php php php php php php php}
php php php php php php php php php}

php php php php php php php php php$thisphp-php>php_rowsphp[php]php php=php php$rowphp;

php php php php php php php php returnphp php$thisphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Renderphp thephp table
php php php php php php*
php php php php php php*php php@throwsphp Zendphp_Textphp_Tablephp_Exceptionphp Whenphp nophp rowsphp werephp addedphp tophp thephp table
php php php php php php*php php@returnphp string
php php php php php php*php/
php php php php publicphp functionphp renderphp(php)
php php php php php{
php php php php php php php php php/php/php Therephp shouldphp bephp atphp leastphp onephp row
php php php php php php php php ifphp php(countphp(php$thisphp-php>php_rowsphp)php php=php=php=php php0php)php php{
php php php php php php php php php php php php requirephp_oncephp php'Zendphp/Textphp/Tablephp/Exceptionphp.phpphp'php;
php php php php php php php php php php php php throwphp newphp Zendphp_Textphp_Tablephp_Exceptionphp(php'Nophp rowsphp werephp addedphp tophp thephp tablephp yetphp'php)php;
php php php php php php php php php}

php php php php php php php php php/php/php Initiatephp thephp resultphp variable
php php php php php php php php php$resultphp php=php php'php'php;

php php php php php php php php php/php/php Countphp totalphp columns
php php php php php php php php php$totalNumColumnsphp php=php countphp(php$thisphp-php>php_columnWidthsphp)php;

php php php php php php php php php/php/php Nowphp renderphp allphp rowsphp,php startingphp fromphp thephp firstphp one
php php php php php php php php php$numRowsphp php=php countphp(php$thisphp-php>php_rowsphp)php;
php php php php php php php php foreachphp php(php$thisphp-php>php_rowsphp asphp php$rowNumphp php=php>php php$rowphp)php php{
php php php php php php php php php php php php php/php/php Getphp allphp columnphp widths
php php php php php php php php php php php php ifphp php(issetphp(php$columnWidthsphp)php php=php=php=php truephp)php php{
php php php php php php php php php php php php php php php php php$lastColumnWidthsphp php=php php$columnWidthsphp;
php php php php php php php php php php php php php}

php php php php php php php php php php php php php$renderedRowphp php php=php php$rowphp-php>renderphp(php$thisphp-php>php_columnWidthsphp,php php$thisphp-php>php_decoratorphp,php php$thisphp-php>php_paddingphp)php;
php php php php php php php php php php php php php$columnWidthsphp php=php php$rowphp-php>getColumnWidthsphp(php)php;
php php php php php php php php php php php php php$numColumnsphp php php php=php countphp(php$columnWidthsphp)php;

php php php php php php php php php php php php php/php/php Checkphp whatphp wephp havephp tophp draw
php php php php php php php php php php php php ifphp php(php$rowNumphp php=php=php=php php0php)php php{
php php php php php php php php php php php php php php php php php/php/php Ifphp thisphp isphp thephp firstphp rowphp,php drawphp thephp tablephp top
php php php php php php php php php php php php php php php php php$resultphp php.php=php php$thisphp-php>php_decoratorphp-php>getTopLeftphp(php)php;

php php php php php php php php php php php php php php php php foreachphp php(php$columnWidthsphp asphp php$columnNumphp php=php>php php$columnWidthphp)php php{
php php php php php php php php php php php php php php php php php php php php php$resultphp php.php=php strphp_repeatphp(php$thisphp-php>php_decoratorphp-php>getHorizontalphp(php)php,
php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php$columnWidthphp)php;

php php php php php php php php php php php php php php php php php php php php ifphp php(php(php$columnNumphp php+php php1php)php php=php=php=php php$numColumnsphp)php php{
php php php php php php php php php php php php php php php php php php php php php php php php php$resultphp php.php=php php$thisphp-php>php_decoratorphp-php>getTopRightphp(php)php;
php php php php php php php php php php php php php php php php php php php php php}php elsephp php{
php php php php php php php php php php php php php php php php php php php php php php php php php$resultphp php.php=php php$thisphp-php>php_decoratorphp-php>getHorizontalDownphp(php)php;
php php php php php php php php php php php php php php php php php php php php php}
php php php php php php php php php php php php php php php php php}

php php php php php php php php php php php php php php php php php$resultphp php.php=php php"php\nphp"php;
php php php php php php php php php php php php php}php elsephp php{
php php php php php php php php php php php php php php php php php/php/php Elsephp checkphp ifphp wephp havephp tophp drawphp thephp rowphp separator
php php php php php php php php php php php php php php php php ifphp php(php$thisphp-php>php_autoSeparatephp php&php selfphp:php:AUTOphp_SEPARATEphp_ALLphp)php php{
php php php php php php php php php php php php php php php php php php php php php$drawSeparatorphp php=php truephp;
php php php php php php php php php php php php php php php php php}php elsephp ifphp php(php$rowNumphp php=php=php=php php1php php&php&php php$thisphp-php>php_autoSeparatephp php&php selfphp:php:AUTOphp_SEPARATEphp_HEADERphp)php php{
php php php php php php php php php php php php php php php php php php php php php$drawSeparatorphp php=php truephp;
php php php php php php php php php php php php php php php php php}php elsephp ifphp php(php$rowNumphp php=php=php=php php(php$numRowsphp php-php php1php)php php&php&php php$thisphp-php>php_autoSeparatephp php&php selfphp:php:AUTOphp_SEPARATEphp_FOOTERphp)php php{
php php php php php php php php php php php php php php php php php php php php php$drawSeparatorphp php=php truephp;
php php php php php php php php php php php php php php php php php}php elsephp php{
php php php php php php php php php php php php php php php php php php php php php$drawSeparatorphp php=php falsephp;
php php php php php php php php php php php php php php php php php}

php php php php php php php php php php php php php php php php ifphp php(php$drawSeparatorphp)php php{
php php php php php php php php php php php php php php php php php php php php php$resultphp php.php=php php$thisphp-php>php_decoratorphp-php>getVerticalRightphp(php)php;

php php php php php php php php php php php php php php php php php php php php php$currentUpperColumnphp php=php php0php;
php php php php php php php php php php php php php php php php php php php php php$currentLowerColumnphp php=php php0php;
php php php php php php php php php php php php php php php php php php php php php$currentUpperWidthphp php php=php php0php;
php php php php php php php php php php php php php php php php php php php php php$currentLowerWidthphp php php=php php0php;

php php php php php php php php php php php php php php php php php php php php php/php/php Loopphp throughphp allphp columnphp widths
php php php php php php php php php php php php php php php php php php php php foreachphp php(php$thisphp-php>php_columnWidthsphp asphp php$columnNumphp php=php>php php$columnWidthphp)php php{
php php php php php php php php php php php php php php php php php php php php php php php php php/php/php Addphp thephp horizontalphp line
php php php php php php php php php php php php php php php php php php php php php php php php php$resultphp php.php=php strphp_repeatphp(php$thisphp-php>php_decoratorphp-php>getHorizontalphp(php)php,
php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php$columnWidthphp)php;

php php php php php php php php php php php php php php php php php php php php php php php php php/php/php Ifphp thisphp isphp thephp lastphp linephp,php breakphp out
php php php php php php php php php php php php php php php php php php php php php php php php ifphp php(php(php$columnNumphp php+php php1php)php php=php=php=php php$totalNumColumnsphp)php php{
php php php php php php php php php php php php php php php php php php php php php php php php php php php php breakphp;
php php php php php php php php php php php php php php php php php php php php php php php php php}

php php php php php php php php php php php php php php php php php php php php php php php php php/php/php Elsephp checkphp,php whichphp connectorphp stylephp hasphp tophp bephp used
php php php php php php php php php php php php php php php php php php php php php php php php php$connectorphp php php php php php php php php php php=php php0xphp0php;
php php php php php php php php php php php php php php php php php php php php php php php php php$currentUpperWidthphp php+php=php php$columnWidthphp;
php php php php php php php php php php php php php php php php php php php php php php php php php$currentLowerWidthphp php+php=php php$columnWidthphp;

php php php php php php php php php php php php php php php php php php php php php php php php ifphp php(php$lastColumnWidthsphp[php$currentUpperColumnphp]php php=php=php=php php$currentUpperWidthphp)php php{
php php php php php php php php php php php php php php php php php php php php php php php php php php php php php$connectorphp php php php php php php php php php php|php=php php0xphp1php;
php php php php php php php php php php php php php php php php php php php php php php php php php php php php php$currentUpperColumnphp php+php=php php1php;
php php php php php php php php php php php php php php php php php php php php php php php php php php php php php$currentUpperWidthphp php php php=php php0php;
php php php php php php php php php php php php php php php php php php php php php php php php php}php elsephp php{
php php php php php php php php php php php php php php php php php php php php php php php php php php php php php$currentUpperWidthphp php+php=php php1php;
php php php php php php php php php php php php php php php php php php php php php php php php php}

php php php php php php php php php php php php php php php php php php php php php php php php ifphp php(php$columnWidthsphp[php$currentLowerColumnphp]php php=php=php=php php$currentLowerWidthphp)php php{
php php php php php php php php php php php php php php php php php php php php php php php php php php php php php$connectorphp php php php php php php php php php php|php=php php0xphp2php;
php php php php php php php php php php php php php php php php php php php php php php php php php php php php php$currentLowerColumnphp php+php=php php1php;
php php php php php php php php php php php php php php php php php php php php php php php php php php php php php$currentLowerWidthphp php php php=php php0php;
php php php php php php php php php php php php php php php php php php php php php php php php php}php elsephp php{
php php php php php php php php php php php php php php php php php php php php php php php php php php php php php$currentLowerWidthphp php+php=php php1php;
php php php php php php php php php php php php php php php php php php php php php php php php php}

php php php php php php php php php php php php php php php php php php php php php php php php switchphp php(php$connectorphp)php php{
php php php php php php php php php php php php php php php php php php php php php php php php php php php php casephp php0xphp0php:
php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php$resultphp php.php=php php$thisphp-php>php_decoratorphp-php>getHorizontalphp(php)php;
php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php breakphp;

php php php php php php php php php php php php php php php php php php php php php php php php php php php php casephp php0xphp1php:
php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php$resultphp php.php=php php$thisphp-php>php_decoratorphp-php>getHorizontalUpphp(php)php;
php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php breakphp;

php php php php php php php php php php php php php php php php php php php php php php php php php php php php casephp php0xphp2php:
php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php$resultphp php.php=php php$thisphp-php>php_decoratorphp-php>getHorizontalDownphp(php)php;
php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php breakphp;

php php php php php php php php php php php php php php php php php php php php php php php php php php php php casephp php0xphp3php:
php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php$resultphp php.php=php php$thisphp-php>php_decoratorphp-php>getCrossphp(php)php;
php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php breakphp;

php php php php php php php php php php php php php php php php php php php php php php php php php php php php defaultphp:
php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php/php/php Thisphp canphp neverphp happenphp,php butphp thephp CSphp tellsphp Iphp havephp tophp havephp itphp php.php.php.
php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php breakphp;
php php php php php php php php php php php php php php php php php php php php php php php php php}
php php php php php php php php php php php php php php php php php php php php php}

php php php php php php php php php php php php php php php php php php php php php$resultphp php.php=php php$thisphp-php>php_decoratorphp-php>getVerticalLeftphp(php)php php.php php"php\nphp"php;
php php php php php php php php php php php php php php php php php}
php php php php php php php php php php php php php}

php php php php php php php php php php php php php/php/php Addphp thephp renderedphp rowphp tophp thephp result
php php php php php php php php php php php php php$resultphp php.php=php php$renderedRowphp;

php php php php php php php php php php php php php/php/php Ifphp thisphp isphp thephp lastphp rowphp,php drawphp thephp tablephp bottom
php php php php php php php php php php php php ifphp php(php(php$rowNumphp php+php php1php)php php=php=php=php php$numRowsphp)php php{
php php php php php php php php php php php php php php php php php$resultphp php.php=php php$thisphp-php>php_decoratorphp-php>getBottomLeftphp(php)php;

php php php php php php php php php php php php php php php php foreachphp php(php$columnWidthsphp asphp php$columnNumphp php=php>php php$columnWidthphp)php php{
php php php php php php php php php php php php php php php php php php php php php$resultphp php.php=php strphp_repeatphp(php$thisphp-php>php_decoratorphp-php>getHorizontalphp(php)php,
php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php$columnWidthphp)php;

php php php php php php php php php php php php php php php php php php php php ifphp php(php(php$columnNumphp php+php php1php)php php=php=php=php php$numColumnsphp)php php{
php php php php php php php php php php php php php php php php php php php php php php php php php$resultphp php.php=php php$thisphp-php>php_decoratorphp-php>getBottomRightphp(php)php;
php php php php php php php php php php php php php php php php php php php php php}php elsephp php{
php php php php php php php php php php php php php php php php php php php php php php php php php$resultphp php.php=php php$thisphp-php>php_decoratorphp-php>getHorizontalUpphp(php)php;
php php php php php php php php php php php php php php php php php php php php php}
php php php php php php php php php php php php php php php php php}

php php php php php php php php php php php php php php php php php$resultphp php.php=php php"php\nphp"php;
php php php php php php php php php php php php php}
php php php php php php php php php}

php php php php php php php php returnphp php$resultphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Magicphp methodphp whichphp returnsphp thephp renderedphp table
php php php php php php*
php php php php php php*php php@returnphp string
php php php php php php*php/
php php php php publicphp functionphp php_php_toStringphp(php)
php php php php php{
php php php php php php php php tryphp php{
php php php php php php php php php php php php returnphp php$thisphp-php>renderphp(php)php;
php php php php php php php php php}php catchphp php(Exceptionphp php$ephp)php php{
php php php php php php php php php php php php triggerphp_errorphp(php$ephp-php>getMessagephp(php)php,php Ephp_USERphp_ERRORphp)php;
php php php php php php php php php}

php php php php php}
php}
