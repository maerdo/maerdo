<php?php
php/php*php*
php php*php Zendphp Framework
php php*
php php*php LICENSE
php php*
php php*php Thisphp sourcephp filephp isphp subjectphp tophp thephp newphp BSDphp licensephp thatphp isphp bundled
php php*php withphp thisphp packagephp inphp thephp filephp LICENSEphp.txtphp.
php php*php Itphp isphp alsophp availablephp throughphp thephp worldphp-widephp-webphp atphp thisphp URLphp:
php php*php httpphp:php/php/frameworkphp.zendphp.comphp/licensephp/newphp-bsd
php php*php Ifphp youphp didphp notphp receivephp aphp copyphp ofphp thephp licensephp andphp arephp unablephp to
php php*php obtainphp itphp throughphp thephp worldphp-widephp-webphp,php pleasephp sendphp anphp email
php php*php tophp licensephp@zendphp.comphp sophp wephp canphp sendphp youphp aphp copyphp immediatelyphp.
php php*
php php*php php@categoryphp php php Zend
php php*php php@packagephp php php php Zendphp_Date
php php*php php@copyrightphp php Copyrightphp php(cphp)php php2php0php0php5php-php2php0php1php0php Zendphp Technologiesphp USAphp Incphp.php php(httpphp:php/php/wwwphp.zendphp.comphp)
php php*php php@versionphp php php php php$Idphp:php DateObjectphp.phpphp php2php2php7php1php2php php2php0php1php0php-php0php7php-php2php9php php0php8php:php2php4php:php2php8Zphp thomasphp php$
php php*php php@licensephp php php php httpphp:php/php/frameworkphp.zendphp.comphp/licensephp/newphp-bsdphp php php php php Newphp BSDphp License
php php*php/

php/php*php*
php php*php php@categoryphp php php Zend
php php*php php@packagephp php php php Zendphp_Date
php php*php php@subpackagephp Zendphp_Datephp_DateObject
php php*php php@copyrightphp php Copyrightphp php(cphp)php php2php0php0php5php-php2php0php1php0php Zendphp Technologiesphp USAphp Incphp.php php(httpphp:php/php/wwwphp.zendphp.comphp)
php php*php php@licensephp php php php httpphp:php/php/frameworkphp.zendphp.comphp/licensephp/newphp-bsdphp php php php php Newphp BSDphp License
php php*php/
abstractphp classphp Zendphp_Datephp_DateObjectphp php{

php php php php php/php*php*
php php php php php php*php UNIXphp Timestamp
php php php php php php*php/
php php php php privatephp php php php$php_unixTimestampphp;
php php php php protectedphp staticphp php$php_cachephp php php php php php php php php php=php nullphp;
php php php php protectedphp staticphp php$php_cacheTagsphp php php php php php=php falsephp;
php php php php protectedphp staticphp php$php_defaultOffsetphp php=php php0php;

php php php php php/php*php*
php php php php php php*php activephp timezone
php php php php php php*php/
php php php php privatephp php php php$php_timezonephp php php php php=php php'UTCphp'php;
php php php php privatephp php php php$php_offsetphp php php php php php php=php php0php;
php php php php privatephp php php php$php_syncronisedphp php=php php0php;

php php php php php/php/php turnphp offphp DSTphp correctionphp ifphp UTCphp orphp GMT
php php php php protectedphp php$php_dstphp php php php php php php php php php=php truephp;

php php php php php/php*php*
php php php php php php*php Tablephp ofphp Monthdays
php php php php php php*php/
php php php php privatephp staticphp php$php_monthTablephp php=php arrayphp(php3php1php,php php2php8php,php php3php1php,php php3php0php,php php3php1php,php php3php0php,php php3php1php,php php3php1php,php php3php0php,php php3php1php,php php3php0php,php php3php1php)php;

php php php php php/php*php*
php php php php php php*php Tablephp ofphp Years
php php php php php php*php/
php php php php privatephp staticphp php$php_yearTablephp php=php arrayphp(
php php php php php php php php php1php9php7php0php php=php>php php0php,php php php php php php php php php php php php php1php9php6php0php php=php>php php-php3php1php5php6php1php9php2php0php0php,php php php php1php9php5php0php php=php>php php-php6php3php1php1php5php2php0php0php0php,
php php php php php php php php php1php9php4php0php php=php>php php-php9php4php6php7php7php1php2php0php0php,php php php php1php9php3php0php php=php>php php-php1php2php6php2php3php0php4php0php0php0php,php php php1php9php2php0php php=php>php php-php1php5php7php7php9php2php3php2php0php0php,
php php php php php php php php php1php9php1php0php php=php>php php-php1php8php9php3php4php5php6php0php0php0php,php php php1php9php0php0php php=php>php php-php2php2php0php8php9php8php8php8php0php0php,php php php1php8php9php0php php=php>php php-php2php5php2php4php5php2php1php6php0php0php,
php php php php php php php php php1php8php8php0php php=php>php php-php2php8php4php0php1php4php0php8php0php0php,php php php1php8php7php0php php=php>php php-php3php1php5php5php6php7php3php6php0php0php,php php php1php8php6php0php php=php>php php-php3php4php7php1php2php9php2php8php0php0php,
php php php php php php php php php1php8php5php0php php=php>php php-php3php7php8php6php8php2php5php6php0php0php,php php php1php8php4php0php php=php>php php-php4php1php0php2php4php4php4php8php0php0php,php php php1php8php3php0php php=php>php php-php4php4php1php7php9php7php7php6php0php0php,
php php php php php php php php php1php8php2php0php php=php>php php-php4php7php3php3php5php9php6php8php0php0php,php php php1php8php1php0php php=php>php php-php5php0php4php9php1php2php9php6php0php0php,php php php1php8php0php0php php=php>php php-php5php3php6php4php6php6php2php4php0php0php,
php php php php php php php php php1php7php9php0php php=php>php php-php5php6php8php0php1php9php5php2php0php0php,php php php1php7php8php0php php=php>php php-php5php9php9php5php8php1php4php4php0php0php,php php php1php7php7php0php php=php>php php-php6php3php1php1php3php4php7php2php0php0php,
php php php php php php php php php1php7php6php0php php=php>php php-php6php6php2php6php9php6php6php4php0php0php,php php php1php7php5php0php php=php>php php-php6php9php4php2php4php9php9php2php0php0php,php php php1php7php4php0php php=php>php php-php7php2php5php8php1php1php8php4php0php0php,
php php php php php php php php php1php7php3php0php php=php>php php-php7php5php7php3php6php5php1php2php0php0php,php php php1php7php2php0php php=php>php php-php7php8php8php9php2php7php0php4php0php0php,php php php1php7php1php0php php=php>php php-php8php2php0php4php8php0php3php2php0php0php,
php php php php php php php php php1php7php0php0php php=php>php php-php8php5php2php0php3php3php6php0php0php0php,php php php1php6php9php0php php=php>php php-php8php8php3php5php8php6php8php8php0php0php,php php php1php6php8php0php php=php>php php-php9php1php5php1php4php8php8php0php0php0php,
php php php php php php php php php1php6php7php0php php=php>php php-php9php4php6php7php0php2php0php8php0php0php,php php php1php6php6php0php php=php>php php-php9php7php8php2php6php4php0php0php0php0php,php php php1php6php5php0php php=php>php php-php1php0php0php9php8php1php7php2php8php0php0php,
php php php php php php php php php1php6php4php0php php=php>php php-php1php0php4php1php3php7php9php2php0php0php0php,php php1php6php3php0php php=php>php php-php1php0php7php2php9php3php2php4php8php0php0php,php php1php6php2php0php php=php>php php-php1php1php0php4php4php9php4php4php0php0php0php,
php php php php php php php php php1php6php1php0php php=php>php php-php1php1php3php6php0php4php7php6php8php0php0php,php php1php6php0php0php php=php>php php-php1php1php6php7php6php0php9php6php0php0php0php)php;

php php php php php/php*php*
php php php php php php*php Setphp thisphp objectphp tophp havephp aphp newphp UNIXphp timestampphp.
php php php php php php*
php php php php php php*php php@paramphp php stringphp|integerphp php php$timestampphp php OPTIONALphp timestampphp;php defaultsphp tophp localphp timephp usingphp timephp(php)
php php php php php php*php php@returnphp stringphp|integerphp php oldphp timestamp
php php php php php php*php php@throwsphp Zendphp_Datephp_Exception
php php php php php php*php/
php php php php protectedphp functionphp setUnixTimestampphp(php$timestampphp php=php nullphp)
php php php php php{
php php php php php php php php php$oldphp php=php php$thisphp-php>php_unixTimestampphp;

php php php php php php php php ifphp php(isphp_numericphp(php$timestampphp)php)php php{
php php php php php php php php php php php php php$thisphp-php>php_unixTimestampphp php=php php$timestampphp;
php php php php php php php php php}php elsephp ifphp php(php$timestampphp php=php=php=php nullphp)php php{
php php php php php php php php php php php php php$thisphp-php>php_unixTimestampphp php=php timephp(php)php;
php php php php php php php php php}php elsephp php{
php php php php php php php php php php php php requirephp_oncephp php'Zendphp/Datephp/Exceptionphp.phpphp'php;
php php php php php php php php php php php php throwphp newphp Zendphp_Datephp_Exceptionphp(php'php\php'php'php php.php php$timestampphp php.php php'php\php'php isphp notphp aphp validphp UNIXphp timestampphp'php,php php0php,php nullphp,php php$timestampphp)php;
php php php php php php php php php}

php php php php php php php php returnphp php$oldphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Returnsphp thisphp objectphp'sphp UNIXphp timestamp
php php php php php php*php Aphp timestampphp greaterphp thenphp thephp integerphp rangephp willphp bephp returnedphp asphp string
php php php php php php*php Thisphp functionphp doesphp notphp returnphp thephp timestampphp asphp objectphp.php Usephp copyphp(php)php insteadphp.
php php php php php php*
php php php php php php*php php@returnphp php integerphp|stringphp php timestamp
php php php php php php*php/
php php php php protectedphp functionphp getUnixTimestampphp(php)
php php php php php{
php php php php php php php php ifphp php(php$thisphp-php>php_unixTimestampphp php=php=php=php intvalphp(php$thisphp-php>php_unixTimestampphp)php)php php{
php php php php php php php php php php php php returnphp php(intphp)php php$thisphp-php>php_unixTimestampphp;
php php php php php php php php php}php elsephp php{
php php php php php php php php php php php php returnphp php(stringphp)php php$thisphp-php>php_unixTimestampphp;
php php php php php php php php php}
php php php php php}

php php php php php/php*php*
php php php php php php*php Internalphp functionphp.
php php php php php php*php Returnsphp timephp(php)php.php php Thisphp methodphp existsphp tophp allowphp unitphp testsphp tophp workphp-aroundphp methodsphp thatphp mightphp otherwise
php php php php php php*php bephp hardphp-codedphp tophp usephp timephp(php)php.php php Forphp examplephp,php thisphp makesphp itphp possiblephp tophp testphp isYesterdayphp(php)php inphp Datephp.phpphp.
php php php php php php*
php php php php php php*php php@paramphp php php integerphp php php$syncphp php php php php php OPTIONALphp timephp syncronisationphp value
php php php php php php*php php@returnphp php integerphp php timestamp
php php php php php php*php/
php php php php protectedphp functionphp php_getTimephp(php$syncphp php=php nullphp)
php php php php php{
php php php php php php php php ifphp php(php$syncphp php!php=php=php nullphp)php php{
php php php php php php php php php php php php php$thisphp-php>php_syncronisedphp php=php roundphp(php$syncphp)php;
php php php php php php php php php}
php php php php php php php php returnphp php(timephp(php)php php+php php$thisphp-php>php_syncronisedphp)php;
php php php php php}

php php php php php/php*php*
php php php php php php*php Internalphp mktimephp functionphp usedphp byphp Zendphp_Datephp.
php php php php php php*php Thephp timestampphp returnedphp byphp mktimephp(php)php canphp exceedphp thephp precisionphp ofphp traditionalphp UNIXphp timestampsphp,
php php php php php php*php byphp allowingphp PHPphp tophp autophp-convertphp tophp usingphp aphp floatphp valuephp.
php php php php php php*
php php php php php php*php Returnsphp aphp timestampphp relativephp tophp php1php9php7php0php/php0php1php/php0php1php php0php0php:php0php0php:php0php0php GMTphp/UTCphp.
php php php php php php*php DSTphp php(Summerphp/Winterphp)php isphp depriciatedphp sincephp phpphp php5php.php1php.php0php.
php php php php php php*php Yearphp hasphp tophp bephp php4php digitsphp otherwisephp itphp wouldphp bephp recognisedphp as
php php php php php php*php yearphp php7php0php ADphp insteadphp ofphp php1php9php7php0php ADphp asphp expectedphp php!php!
php php php php php php*
php php php php php php*php php@paramphp php integerphp php php$hour
php php php php php php*php php@paramphp php integerphp php php$minute
php php php php php php*php php@paramphp php integerphp php php$second
php php php php php php*php php@paramphp php integerphp php php$month
php php php php php php*php php@paramphp php integerphp php php$day
php php php php php php*php php@paramphp php integerphp php php$year
php php php php php php*php php@paramphp php booleanphp php php$gmtphp php php php php OPTIONALphp truephp php=php otherphp argumentsphp arephp forphp UTCphp timephp,php falsephp php=php argumentsphp arephp forphp localphp timephp/date
php php php php php php*php php@returnphp php integerphp|floatphp php timestampphp php(numberphp ofphp secondsphp elapsedphp relativephp tophp php1php9php7php0php/php0php1php/php0php1php php0php0php:php0php0php:php0php0php GMTphp/UTCphp)
php php php php php php*php/
php php php php protectedphp functionphp mktimephp(php$hourphp,php php$minutephp,php php$secondphp,php php$monthphp,php php$dayphp,php php$yearphp,php php$gmtphp php=php falsephp)
php php php php php{
php php php php php php php php php/php/php completephp datephp butphp inphp php3php2bitphp timestampphp php-php usephp PHPphp internal
php php php php php php php php ifphp php(php(php1php9php0php1php <php php$yearphp)php andphp php(php$yearphp <php php2php0php3php8php)php)php php{

php php php php php php php php php php php php php$oldzonephp php=php php@datephp_defaultphp_timezonephp_getphp(php)php;
php php php php php php php php php php php php php/php/php Timezonephp alsophp includesphp DSTphp settingsphp,php thereforphp substractingphp thephp GMTphp offsetphp isphp notphp enough
php php php php php php php php php php php php php/php/php Wephp havephp tophp setphp thephp correctphp timezonephp tophp getphp thephp rightphp value
php php php php php php php php php php php php ifphp php(php(php$thisphp-php>php_timezonephp php!php=php php$oldzonephp)php andphp php(php$gmtphp php=php=php=php falsephp)php)php php{
php php php php php php php php php php php php php php php php datephp_defaultphp_timezonephp_setphp(php$thisphp-php>php_timezonephp)php;
php php php php php php php php php php php php php}
php php php php php php php php php php php php php$resultphp php=php php(php$gmtphp)php php?php php@gmmktimephp(php$hourphp,php php$minutephp,php php$secondphp,php php$monthphp,php php$dayphp,php php$yearphp)
php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php:php php php php@mktimephp(php$hourphp,php php$minutephp,php php$secondphp,php php$monthphp,php php$dayphp,php php$yearphp)php;
php php php php php php php php php php php php datephp_defaultphp_timezonephp_setphp(php$oldzonephp)php;

php php php php php php php php php php php php returnphp php$resultphp;
php php php php php php php php php}

php php php php php php php php ifphp php(php$gmtphp php!php=php=php truephp)php php{
php php php php php php php php php php php php php$secondphp php+php=php php$thisphp-php>php_offsetphp;
php php php php php php php php php}

php php php php php php php php ifphp php(issetphp(selfphp:php:php$php_cachephp)php)php php{
php php php php php php php php php php php php php$idphp php=php strtrphp(php'Zendphp_DateObjectphp_mkTimephp_php'php php.php php$thisphp-php>php_offsetphp php.php php'php_php'php php.php php$yearphp.php$monthphp.php$dayphp.php'php_php'php.php$hourphp.php$minutephp.php$secondphp php.php php'php_php'php.php(intphp)php$gmtphp,php php'php-php'php,php'php_php'php)php;
php php php php php php php php php php php php ifphp php(php$resultphp php=php selfphp:php:php$php_cachephp-php>loadphp(php$idphp)php)php php{
php php php php php php php php php php php php php php php php returnphp unserializephp(php$resultphp)php;
php php php php php php php php php php php php php}
php php php php php php php php php}

php php php php php php php php php/php/php datephp tophp integer
php php php php php php php php php$dayphp php php php=php intvalphp(php$dayphp)php;
php php php php php php php php php$monthphp php=php intvalphp(php$monthphp)php;
php php php php php php php php php$yearphp php php=php intvalphp(php$yearphp)php;

php php php php php php php php php/php/php correctphp monthsphp php>php php1php2php andphp monthsphp <php php1
php php php php php php php php ifphp php(php$monthphp php>php php1php2php)php php{
php php php php php php php php php php php php php$overlapphp php=php floorphp(php$monthphp php/php php1php2php)php;
php php php php php php php php php php php php php$yearphp php php php+php=php php$overlapphp;
php php php php php php php php php php php php php$monthphp php php-php=php php$overlapphp php*php php1php2php;
php php php php php php php php php}php elsephp php{
php php php php php php php php php php php php php$overlapphp php=php ceilphp(php(php1php php-php php$monthphp)php php/php php1php2php)php;
php php php php php php php php php php php php php$yearphp php php php-php=php php$overlapphp;
php php php php php php php php php php php php php$monthphp php php+php=php php$overlapphp php*php php1php2php;
php php php php php php php php php}

php php php php php php php php php$datephp php=php php0php;
php php php php php php php php ifphp php(php$yearphp php>php=php php1php9php7php0php)php php{

php php php php php php php php php php php php php/php/php Datephp isphp afterphp UNIXphp epoch
php php php php php php php php php php php php php/php/php gophp throughphp leapyears
php php php php php php php php php php php php php/php/php addphp monthsphp fromphp latestphp givenphp year
php php php php php php php php php php php php forphp php(php$countphp php=php php1php9php7php0php;php php$countphp <php=php php$yearphp;php php$countphp+php+php)php php{

php php php php php php php php php php php php php php php php php$leapyearphp php=php selfphp:php:isYearLeapYearphp(php$countphp)php;
php php php php php php php php php php php php php php php php ifphp php(php$countphp <php php$yearphp)php php{

php php php php php php php php php php php php php php php php php php php php php$datephp php+php=php php3php6php5php;
php php php php php php php php php php php php php php php php php php php php ifphp php(php$leapyearphp php=php=php=php truephp)php php{
php php php php php php php php php php php php php php php php php php php php php php php php php$datephp+php+php;
php php php php php php php php php php php php php php php php php php php php php}

php php php php php php php php php php php php php php php php php}php elsephp php{

php php php php php php php php php php php php php php php php php php php php forphp php(php$mcountphp php=php php0php;php php$mcountphp <php php(php$monthphp php-php php1php)php;php php$mcountphp+php+php)php php{
php php php php php php php php php php php php php php php php php php php php php php php php php$datephp php+php=php selfphp:php:php$php_monthTablephp[php$mcountphp]php;
php php php php php php php php php php php php php php php php php php php php php php php php ifphp php(php(php$leapyearphp php=php=php=php truephp)php andphp php(php$mcountphp php=php=php php1php)php)php php{
php php php php php php php php php php php php php php php php php php php php php php php php php php php php php$datephp+php+php;
php php php php php php php php php php php php php php php php php php php php php php php php php}

php php php php php php php php php php php php php php php php php php php php php}
php php php php php php php php php php php php php php php php php}
php php php php php php php php php php php php php}

php php php php php php php php php php php php php$datephp php+php=php php$dayphp php-php php1php;
php php php php php php php php php php php php php$datephp php=php php(php(php$datephp php*php php8php6php4php0php0php)php php+php php(php$hourphp php*php php3php6php0php0php)php php+php php(php$minutephp php*php php6php0php)php php+php php$secondphp)php;
php php php php php php php php php}php elsephp php{

php php php php php php php php php php php php php/php/php Datephp isphp beforephp UNIXphp epoch
php php php php php php php php php php php php php/php/php gophp throughphp leapyears
php php php php php php php php php php php php php/php/php addphp monthsphp fromphp latestphp givenphp year
php php php php php php php php php php php php forphp php(php$countphp php=php php1php9php6php9php;php php$countphp php>php=php php$yearphp;php php$countphp-php-php)php php{

php php php php php php php php php php php php php php php php php$leapyearphp php=php selfphp:php:isYearLeapYearphp(php$countphp)php;
php php php php php php php php php php php php php php php php ifphp php(php$countphp php>php php$yearphp)
php php php php php php php php php php php php php php php php php{
php php php php php php php php php php php php php php php php php php php php php$datephp php+php=php php3php6php5php;
php php php php php php php php php php php php php php php php php php php php ifphp php(php$leapyearphp php=php=php=php truephp)
php php php php php php php php php php php php php php php php php php php php php php php php php$datephp+php+php;
php php php php php php php php php php php php php php php php php}php elsephp php{

php php php php php php php php php php php php php php php php php php php php forphp php(php$mcountphp php=php php1php1php;php php$mcountphp php>php php(php$monthphp php-php php1php)php;php php$mcountphp-php-php)php php{
php php php php php php php php php php php php php php php php php php php php php php php php php$datephp php+php=php selfphp:php:php$php_monthTablephp[php$mcountphp]php;
php php php php php php php php php php php php php php php php php php php php php php php php ifphp php(php(php$leapyearphp php=php=php=php truephp)php andphp php(php$mcountphp php=php=php php2php)php)php php{
php php php php php php php php php php php php php php php php php php php php php php php php php php php php php$datephp+php+php;
php php php php php php php php php php php php php php php php php php php php php php php php php}

php php php php php php php php php php php php php php php php php php php php php}
php php php php php php php php php php php php php php php php php}
php php php php php php php php php php php php php}

php php php php php php php php php php php php php$datephp php+php=php php(selfphp:php:php$php_monthTablephp[php$monthphp php-php php1php]php php-php php$dayphp)php;
php php php php php php php php php php php php php$datephp php=php php-php(php(php$datephp php*php php8php6php4php0php0php)php php+php php(php8php6php4php0php0php php-php php(php(php$hourphp php*php php3php6php0php0php)php php+php php(php$minutephp php*php php6php0php)php php+php php$secondphp)php)php)php;

php php php php php php php php php php php php php/php/php gregorianphp correctionphp forphp php5php.Octphp.php1php5php8php2
php php php php php php php php php php php php ifphp php(php$datephp <php php-php1php2php2php2php0php1php8php5php6php0php0php)php php{
php php php php php php php php php php php php php php php php php$datephp php+php=php php8php6php4php0php0php0php;
php php php php php php php php php php php php php}php elsephp ifphp php(php$datephp <php php-php1php2php2php1php9php3php2php1php6php0php0php)php php{
php php php php php php php php php php php php php php php php php$datephp php php=php php-php1php2php2php1php9php3php2php1php6php0php0php;
php php php php php php php php php php php php php}
php php php php php php php php php}

php php php php php php php php ifphp php(issetphp(selfphp:php:php$php_cachephp)php)php php{
php php php php php php php php php php php php ifphp php(selfphp:php:php$php_cacheTagsphp)php php{
php php php php php php php php php php php php php php php php selfphp:php:php$php_cachephp-php>savephp(php serializephp(php$datephp)php,php php$idphp,php arrayphp(php'Zendphp_Datephp'php)php)php;
php php php php php php php php php php php php php}php elsephp php{
php php php php php php php php php php php php php php php php selfphp:php:php$php_cachephp-php>savephp(php serializephp(php$datephp)php,php php$idphp)php;
php php php php php php php php php php php php php}
php php php php php php php php php}

php php php php php php php php returnphp php$datephp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Returnsphp truephp,php ifphp givenphp php$yearphp isphp aphp leapphp yearphp.
php php php php php php*
php php php php php php*php php@paramphp php integerphp php php$year
php php php php php php*php php@returnphp booleanphp php truephp,php ifphp yearphp isphp leapphp year
php php php php php php*php/
php php php php protectedphp staticphp functionphp isYearLeapYearphp(php$yearphp)
php php php php php{
php php php php php php php php php/php/php allphp leapyearsphp canphp bephp dividedphp throughphp php4
php php php php php php php php ifphp php(php(php$yearphp php%php php4php)php php!php=php php0php)php php{
php php php php php php php php php php php php returnphp falsephp;
php php php php php php php php php}

php php php php php php php php php/php/php allphp leapyearsphp canphp bephp dividedphp throughphp php4php0php0
php php php php php php php php ifphp php(php$yearphp php%php php4php0php0php php=php=php php0php)php php{
php php php php php php php php php php php php returnphp truephp;
php php php php php php php php php}php elsephp ifphp php(php(php$yearphp php>php php1php5php8php2php)php andphp php(php$yearphp php%php php1php0php0php php=php=php php0php)php)php php{
php php php php php php php php php php php php returnphp falsephp;
php php php php php php php php php}

php php php php php php php php returnphp truephp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Internalphp mktimephp functionphp usedphp byphp Zendphp_Datephp forphp handlingphp php6php4bitphp timestampsphp.
php php php php php php*
php php php php php php*php Returnsphp aphp formattedphp datephp forphp aphp givenphp timestampphp.
php php php php php php*
php php php php php php*php php@paramphp php stringphp php php php$formatphp php php php php formatphp forphp output
php php php php php php*php php@paramphp php mixedphp php php php php$timestamp
php php php php php php*php php@paramphp php booleanphp php php$gmtphp php php php php php php php OPTIONALphp truephp php=php otherphp argumentsphp arephp forphp UTCphp timephp,php falsephp php=php argumentsphp arephp forphp localphp timephp/date
php php php php php php*php php@returnphp string
php php php php php php*php/
php php php php protectedphp functionphp datephp(php$formatphp,php php$timestampphp php=php nullphp,php php$gmtphp php=php falsephp)
php php php php php{
php php php php php php php php php$oldzonephp php=php php@datephp_defaultphp_timezonephp_getphp(php)php;
php php php php php php php php ifphp php(php$thisphp-php>php_timezonephp php!php=php php$oldzonephp)php php{
php php php php php php php php php php php php datephp_defaultphp_timezonephp_setphp(php$thisphp-php>php_timezonephp)php;
php php php php php php php php php}

php php php php php php php php ifphp php(php$timestampphp php=php=php=php nullphp)php php{
php php php php php php php php php php php php php$resultphp php=php php(php$gmtphp)php php?php php@gmdatephp(php$formatphp)php php:php php@datephp(php$formatphp)php;
php php php php php php php php php php php php datephp_defaultphp_timezonephp_setphp(php$oldzonephp)php;
php php php php php php php php php php php php returnphp php$resultphp;
php php php php php php php php php}

php php php php php php php php ifphp php(absphp(php$timestampphp)php <php=php php0xphp7FFFFFFFphp)php php{
php php php php php php php php php php php php php$resultphp php=php php(php$gmtphp)php php?php php@gmdatephp(php$formatphp,php php$timestampphp)php php:php php@datephp(php$formatphp,php php$timestampphp)php;
php php php php php php php php php php php php datephp_defaultphp_timezonephp_setphp(php$oldzonephp)php;
php php php php php php php php php php php php returnphp php$resultphp;
php php php php php php php php php}

php php php php php php php php php$jumpphp php php php php php php=php falsephp;
php php php php php php php php php$origstampphp php=php php$timestampphp;
php php php php php php php php ifphp php(issetphp(selfphp:php:php$php_cachephp)php)php php{
php php php php php php php php php php php php php$idstampphp php=php strtrphp(php'Zendphp_DateObjectphp_datephp_php'php php.php php$thisphp-php>php_offsetphp php.php php'php_php'php.php php$timestampphp php.php php'php_php'php.php(intphp)php$gmtphp,php php'php-php'php,php'php_php'php)php;
php php php php php php php php php php php php ifphp php(php$resultphp2php php=php selfphp:php:php$php_cachephp-php>loadphp(php$idstampphp)php)php php{
php php php php php php php php php php php php php php php php php$timestampphp php=php unserializephp(php$resultphp2php)php;
php php php php php php php php php php php php php php php php php$jumpphp php=php truephp;
php php php php php php php php php php php php php}
php php php php php php php php php}

php php php php php php php php php/php/php checkphp onphp falsephp orphp nullphp alonephp fails
php php php php php php php php ifphp php(emptyphp(php$gmtphp)php andphp emptyphp(php$jumpphp)php)php php{
php php php php php php php php php php php php php$tempstampphp php=php php$timestampphp;
php php php php php php php php php php php php ifphp php(php$tempstampphp php>php php0php)php php{
php php php php php php php php php php php php php php php php whilephp php(absphp(php$tempstampphp)php php>php php0xphp7FFFFFFFphp)php php{
php php php php php php php php php php php php php php php php php php php php php$tempstampphp php-php=php php(php8php6php4php0php0php php*php php2php3php3php7php6php)php;
php php php php php php php php php php php php php php php php php}

php php php php php php php php php php php php php php php php php$dstphp php=php datephp(php"Iphp"php,php php$tempstampphp)php;
php php php php php php php php php php php php php php php php ifphp php(php$dstphp php=php=php=php php1php)php php{
php php php php php php php php php php php php php php php php php php php php php$timestampphp php+php=php php3php6php0php0php;
php php php php php php php php php php php php php php php php php}

php php php php php php php php php php php php php php php php php$tempphp php php php php php php php=php datephp(php'Zphp'php,php php$tempstampphp)php;
php php php php php php php php php php php php php php php php php$timestampphp php+php=php php$tempphp;
php php php php php php php php php php php php php}

php php php php php php php php php php php php ifphp php(issetphp(selfphp:php:php$php_cachephp)php)php php{
php php php php php php php php php php php php php php php php ifphp php(selfphp:php:php$php_cacheTagsphp)php php{
php php php php php php php php php php php php php php php php php php php php selfphp:php:php$php_cachephp-php>savephp(php serializephp(php$timestampphp)php,php php$idstampphp,php arrayphp(php'Zendphp_Datephp'php)php)php;
php php php php php php php php php php php php php php php php php}php elsephp php{
php php php php php php php php php php php php php php php php php php php php selfphp:php:php$php_cachephp-php>savephp(php serializephp(php$timestampphp)php,php php$idstampphp)php;
php php php php php php php php php php php php php php php php php}
php php php php php php php php php php php php php}
php php php php php php php php php}

php php php php php php php php ifphp php(php(php$timestampphp <php php0php)php andphp php(php$gmtphp php!php=php=php truephp)php)php php{
php php php php php php php php php php php php php$timestampphp php-php=php php$thisphp-php>php_offsetphp;
php php php php php php php php php}

php php php php php php php php datephp_defaultphp_timezonephp_setphp(php$oldzonephp)php;
php php php php php php php php php$datephp php php php=php php$thisphp-php>getDatePartsphp(php$timestampphp,php truephp)php;
php php php php php php php php php$lengthphp php=php strlenphp(php$formatphp)php;
php php php php php php php php php$outputphp php=php php'php'php;

php php php php php php php php forphp php(php$iphp php=php php0php;php php$iphp <php php$lengthphp;php php$iphp+php+php)php php{
php php php php php php php php php php php php switchphp(php$formatphp[php$iphp]php)php php{
php php php php php php php php php php php php php php php php php/php/php dayphp formats
php php php php php php php php php php php php php php php php casephp php'dphp'php:php php php/php/php dayphp ofphp monthphp,php php2php digitsphp,php withphp leadingphp zerophp,php php0php1php php-php php3php1
php php php php php php php php php php php php php php php php php php php php php$outputphp php.php=php php(php(php$datephp[php'mdayphp'php]php <php php1php0php)php php?php php'php0php'php php.php php$datephp[php'mdayphp'php]php php:php php$datephp[php'mdayphp'php]php)php;
php php php php php php php php php php php php php php php php php php php php breakphp;

php php php php php php php php php php php php php php php php casephp php'Dphp'php:php php php/php/php dayphp ofphp weekphp,php php3php lettersphp,php Monphp php-php Sun
php php php php php php php php php php php php php php php php php php php php php$outputphp php.php=php datephp(php'Dphp'php,php php8php6php4php0php0php php*php php(php3php php+php selfphp:php:dayOfWeekphp(php$datephp[php'yearphp'php]php,php php$datephp[php'monphp'php]php,php php$datephp[php'mdayphp'php]php)php)php)php;
php php php php php php php php php php php php php php php php php php php php breakphp;

php php php php php php php php php php php php php php php php casephp php'jphp'php:php php php/php/php dayphp ofphp monthphp,php withoutphp leadingphp zerophp,php php1php php-php php3php1
php php php php php php php php php php php php php php php php php php php php php$outputphp php.php=php php$datephp[php'mdayphp'php]php;
php php php php php php php php php php php php php php php php php php php php breakphp;

php php php php php php php php php php php php php php php php casephp php'lphp'php:php php php/php/php dayphp ofphp weekphp,php fullphp stringphp namephp,php Sundayphp php-php Saturday
php php php php php php php php php php php php php php php php php php php php php$outputphp php.php=php datephp(php'lphp'php,php php8php6php4php0php0php php*php php(php3php php+php selfphp:php:dayOfWeekphp(php$datephp[php'yearphp'php]php,php php$datephp[php'monphp'php]php,php php$datephp[php'mdayphp'php]php)php)php)php;
php php php php php php php php php php php php php php php php php php php php breakphp;

php php php php php php php php php php php php php php php php casephp php'Nphp'php:php php php/php/php ISOphp php8php6php0php1php numericphp dayphp ofphp weekphp,php php1php php-php php7
php php php php php php php php php php php php php php php php php php php php php$dayphp php=php selfphp:php:dayOfWeekphp(php$datephp[php'yearphp'php]php,php php$datephp[php'monphp'php]php,php php$datephp[php'mdayphp'php]php)php;
php php php php php php php php php php php php php php php php php php php php ifphp php(php$dayphp php=php=php php0php)php php{
php php php php php php php php php php php php php php php php php php php php php php php php php$dayphp php=php php7php;
php php php php php php php php php php php php php php php php php php php php php}
php php php php php php php php php php php php php php php php php php php php php$outputphp php.php=php php$dayphp;
php php php php php php php php php php php php php php php php php php php php breakphp;

php php php php php php php php php php php php php php php php casephp php'Sphp'php:php php php/php/php englishphp suffixphp forphp dayphp ofphp monthphp,php stphp ndphp rdphp th
php php php php php php php php php php php php php php php php php php php php ifphp php(php(php$datephp[php'mdayphp'php]php php%php php1php0php)php php=php=php php1php)php php{
php php php php php php php php php php php php php php php php php php php php php php php php php$outputphp php.php=php php'stphp'php;
php php php php php php php php php php php php php php php php php php php php php}php elsephp ifphp php(php(php(php$datephp[php'mdayphp'php]php php%php php1php0php)php php=php=php php2php)php andphp php(php$datephp[php'mdayphp'php]php php!php=php php1php2php)php)php php{
php php php php php php php php php php php php php php php php php php php php php php php php php$outputphp php.php=php php'ndphp'php;
php php php php php php php php php php php php php php php php php php php php php}php elsephp ifphp php(php(php$datephp[php'mdayphp'php]php php%php php1php0php)php php=php=php php3php)php php{
php php php php php php php php php php php php php php php php php php php php php php php php php$outputphp php.php=php php'rdphp'php;
php php php php php php php php php php php php php php php php php php php php php}php elsephp php{
php php php php php php php php php php php php php php php php php php php php php php php php php$outputphp php.php=php php'thphp'php;
php php php php php php php php php php php php php php php php php php php php php}
php php php php php php php php php php php php php php php php php php php php breakphp;

php php php php php php php php php php php php php php php php casephp php'wphp'php:php php php/php/php numericphp dayphp ofphp weekphp,php php0php php-php php6
php php php php php php php php php php php php php php php php php php php php php$outputphp php.php=php selfphp:php:dayOfWeekphp(php$datephp[php'yearphp'php]php,php php$datephp[php'monphp'php]php,php php$datephp[php'mdayphp'php]php)php;
php php php php php php php php php php php php php php php php php php php php breakphp;

php php php php php php php php php php php php php php php php casephp php'zphp'php:php php php/php/php dayphp ofphp yearphp,php php0php php-php php3php6php5
php php php php php php php php php php php php php php php php php php php php php$outputphp php.php=php php$datephp[php'ydayphp'php]php;
php php php php php php php php php php php php php php php php php php php php breakphp;


php php php php php php php php php php php php php php php php php/php/php weekphp formats
php php php php php php php php php php php php php php php php casephp php'Wphp'php:php php php/php/php ISOphp php8php6php0php1php,php weekphp numberphp ofphp year
php php php php php php php php php php php php php php php php php php php php php$outputphp php.php=php php$thisphp-php>weekNumberphp(php$datephp[php'yearphp'php]php,php php$datephp[php'monphp'php]php,php php$datephp[php'mdayphp'php]php)php;
php php php php php php php php php php php php php php php php php php php php breakphp;


php php php php php php php php php php php php php php php php php/php/php monthphp formats
php php php php php php php php php php php php php php php php casephp php'Fphp'php:php php php/php/php stringphp monthphp namephp,php januaryphp php-php december
php php php php php php php php php php php php php php php php php php php php php$outputphp php.php=php datephp(php'Fphp'php,php mktimephp(php0php,php php0php,php php0php,php php$datephp[php'monphp'php]php,php php2php,php php1php9php7php1php)php)php;
php php php php php php php php php php php php php php php php php php php php breakphp;

php php php php php php php php php php php php php php php php casephp php'mphp'php:php php php/php/php numberphp ofphp monthphp,php withphp leadingphp zerosphp,php php0php1php php-php php1php2
php php php php php php php php php php php php php php php php php php php php php$outputphp php.php=php php(php(php$datephp[php'monphp'php]php <php php1php0php)php php?php php'php0php'php php.php php$datephp[php'monphp'php]php php:php php$datephp[php'monphp'php]php)php;
php php php php php php php php php php php php php php php php php php php php breakphp;

php php php php php php php php php php php php php php php php casephp php'Mphp'php:php php php/php/php php3php letterphp monthphp namephp,php Janphp php-php Dec
php php php php php php php php php php php php php php php php php php php php php$outputphp php.php=php datephp(php'Mphp'php,mktimephp(php0php,php php0php,php php0php,php php$datephp[php'monphp'php]php,php php2php,php php1php9php7php1php)php)php;
php php php php php php php php php php php php php php php php php php php php breakphp;

php php php php php php php php php php php php php php php php casephp php'nphp'php:php php php/php/php numberphp ofphp monthphp,php withoutphp leadingphp zerosphp,php php1php php-php php1php2
php php php php php php php php php php php php php php php php php php php php php$outputphp php.php=php php$datephp[php'monphp'php]php;
php php php php php php php php php php php php php php php php php php php php breakphp;

php php php php php php php php php php php php php php php php casephp php'tphp'php:php php php/php/php numberphp ofphp dayphp inphp month
php php php php php php php php php php php php php php php php php php php php php$outputphp php.php=php selfphp:php:php$php_monthTablephp[php$datephp[php'monphp'php]php php-php php1php]php;
php php php php php php php php php php php php php php php php php php php php breakphp;


php php php php php php php php php php php php php php php php php/php/php yearphp formats
php php php php php php php php php php php php php php php php casephp php'Lphp'php:php php php/php/php isphp leapphp yearphp php?
php php php php php php php php php php php php php php php php php php php php php$outputphp php.php=php php(selfphp:php:isYearLeapYearphp(php$datephp[php'yearphp'php]php)php)php php?php php'php1php'php php:php php'php0php'php;
php php php php php php php php php php php php php php php php php php php php breakphp;

php php php php php php php php php php php php php php php php casephp php'ophp'php:php php php/php/php ISOphp php8php6php0php1php yearphp number
php php php php php php php php php php php php php php php php php php php php php$weekphp php=php php$thisphp-php>weekNumberphp(php$datephp[php'yearphp'php]php,php php$datephp[php'monphp'php]php,php php$datephp[php'mdayphp'php]php)php;
php php php php php php php php php php php php php php php php php php php php ifphp php(php(php$weekphp php>php php5php0php)php andphp php(php$datephp[php'monphp'php]php php=php=php php1php)php)php php{
php php php php php php php php php php php php php php php php php php php php php php php php php$outputphp php.php=php php(php$datephp[php'yearphp'php]php php-php php1php)php;
php php php php php php php php php php php php php php php php php php php php php}php elsephp php{
php php php php php php php php php php php php php php php php php php php php php php php php php$outputphp php.php=php php$datephp[php'yearphp'php]php;
php php php php php php php php php php php php php php php php php php php php php}
php php php php php php php php php php php php php php php php php php php php breakphp;

php php php php php php php php php php php php php php php php casephp php'Yphp'php:php php php/php/php yearphp numberphp,php php4php digits
php php php php php php php php php php php php php php php php php php php php php$outputphp php.php=php php$datephp[php'yearphp'php]php;
php php php php php php php php php php php php php php php php php php php php breakphp;

php php php php php php php php php php php php php php php php casephp php'yphp'php:php php php/php/php yearphp numberphp,php php2php digits
php php php php php php php php php php php php php php php php php php php php php$outputphp php.php=php substrphp(php$datephp[php'yearphp'php]php,php strlenphp(php$datephp[php'yearphp'php]php)php php-php php2php,php php2php)php;
php php php php php php php php php php php php php php php php php php php php breakphp;


php php php php php php php php php php php php php php php php php/php/php timephp formats
php php php php php php php php php php php php php php php php casephp php'aphp'php:php php php/php/php lowerphp casephp amphp/pm
php php php php php php php php php php php php php php php php php php php php php$outputphp php.php=php php(php(php$datephp[php'hoursphp'php]php php>php=php php1php2php)php php?php php'pmphp'php php:php php'amphp'php)php;
php php php php php php php php php php php php php php php php php php php php breakphp;

php php php php php php php php php php php php php php php php casephp php'Aphp'php:php php php/php/php upperphp casephp amphp/pm
php php php php php php php php php php php php php php php php php php php php php$outputphp php.php=php php(php(php$datephp[php'hoursphp'php]php php>php=php php1php2php)php php?php php'PMphp'php php:php php'AMphp'php)php;
php php php php php php php php php php php php php php php php php php php php breakphp;

php php php php php php php php php php php php php php php php casephp php'Bphp'php:php php php/php/php swatchphp internetphp time
php php php php php php php php php php php php php php php php php php php php php$daysecondsphp php=php php(php$datephp[php'hoursphp'php]php php*php php3php6php0php0php)php php+php php(php$datephp[php'minutesphp'php]php php*php php6php0php)php php+php php$datephp[php'secondsphp'php]php;
php php php php php php php php php php php php php php php php php php php php ifphp php(php$gmtphp php=php=php=php truephp)php php{
php php php php php php php php php php php php php php php php php php php php php php php php php$daysecondsphp php+php=php php3php6php0php0php;
php php php php php php php php php php php php php php php php php php php php php}
php php php php php php php php php php php php php php php php php php php php php$outputphp php.php=php php(intphp)php php(php(php$daysecondsphp php%php php8php6php4php0php0php)php php/php php8php6php.php4php)php;
php php php php php php php php php php php php php php php php php php php php breakphp;

php php php php php php php php php php php php php php php php casephp php'gphp'php:php php php/php/php hoursphp withoutphp leadingphp zerosphp,php php1php2hphp format
php php php php php php php php php php php php php php php php php php php php ifphp php(php$datephp[php'hoursphp'php]php php>php php1php2php)php php{
php php php php php php php php php php php php php php php php php php php php php php php php php$hourphp php=php php$datephp[php'hoursphp'php]php php-php php1php2php;
php php php php php php php php php php php php php php php php php php php php php}php elsephp php{
php php php php php php php php php php php php php php php php php php php php php php php php ifphp php(php$datephp[php'hoursphp'php]php php=php=php php0php)php php{
php php php php php php php php php php php php php php php php php php php php php php php php php php php php php$hourphp php=php php'php1php2php'php;
php php php php php php php php php php php php php php php php php php php php php php php php php}php elsephp php{
php php php php php php php php php php php php php php php php php php php php php php php php php php php php php$hourphp php=php php$datephp[php'hoursphp'php]php;
php php php php php php php php php php php php php php php php php php php php php php php php php}
php php php php php php php php php php php php php php php php php php php php php}
php php php php php php php php php php php php php php php php php php php php php$outputphp php.php=php php$hourphp;
php php php php php php php php php php php php php php php php php php php php breakphp;

php php php php php php php php php php php php php php php php casephp php'Gphp'php:php php php/php/php hoursphp withoutphp leadingphp zerosphp,php php2php4hphp format
php php php php php php php php php php php php php php php php php php php php php$outputphp php.php=php php$datephp[php'hoursphp'php]php;
php php php php php php php php php php php php php php php php php php php php breakphp;

php php php php php php php php php php php php php php php php casephp php'hphp'php:php php php/php/php hoursphp withphp leadingphp zerosphp,php php1php2hphp format
php php php php php php php php php php php php php php php php php php php php ifphp php(php$datephp[php'hoursphp'php]php php>php php1php2php)php php{
php php php php php php php php php php php php php php php php php php php php php php php php php$hourphp php=php php$datephp[php'hoursphp'php]php php-php php1php2php;
php php php php php php php php php php php php php php php php php php php php php}php elsephp php{
php php php php php php php php php php php php php php php php php php php php php php php php ifphp php(php$datephp[php'hoursphp'php]php php=php=php php0php)php php{
php php php php php php php php php php php php php php php php php php php php php php php php php php php php php$hourphp php=php php'php1php2php'php;
php php php php php php php php php php php php php php php php php php php php php php php php php}php elsephp php{
php php php php php php php php php php php php php php php php php php php php php php php php php php php php php$hourphp php=php php$datephp[php'hoursphp'php]php;
php php php php php php php php php php php php php php php php php php php php php php php php php}
php php php php php php php php php php php php php php php php php php php php php}
php php php php php php php php php php php php php php php php php php php php php$outputphp php.php=php php(php(php$hourphp <php php1php0php)php php?php php'php0php'php.php$hourphp php:php php$hourphp)php;
php php php php php php php php php php php php php php php php php php php php breakphp;

php php php php php php php php php php php php php php php php casephp php'Hphp'php:php php php/php/php hoursphp withphp leadingphp zerosphp,php php2php4hphp format
php php php php php php php php php php php php php php php php php php php php php$outputphp php.php=php php(php(php$datephp[php'hoursphp'php]php <php php1php0php)php php?php php'php0php'php php.php php$datephp[php'hoursphp'php]php php:php php$datephp[php'hoursphp'php]php)php;
php php php php php php php php php php php php php php php php php php php php breakphp;

php php php php php php php php php php php php php php php php casephp php'iphp'php:php php php/php/php minutesphp withphp leadingphp zeros
php php php php php php php php php php php php php php php php php php php php php$outputphp php.php=php php(php(php$datephp[php'minutesphp'php]php <php php1php0php)php php?php php'php0php'php php.php php$datephp[php'minutesphp'php]php php:php php$datephp[php'minutesphp'php]php)php;
php php php php php php php php php php php php php php php php php php php php breakphp;

php php php php php php php php php php php php php php php php casephp php'sphp'php:php php php/php/php secondsphp withphp leadingphp zeros
php php php php php php php php php php php php php php php php php php php php php$outputphp php.php=php php(php(php$datephp[php'secondsphp'php]php <php php1php0php)php php?php php'php0php'php php.php php$datephp[php'secondsphp'php]php php:php php$datephp[php'secondsphp'php]php)php;
php php php php php php php php php php php php php php php php php php php php breakphp;


php php php php php php php php php php php php php php php php php/php/php timezonephp formats
php php php php php php php php php php php php php php php php casephp php'ephp'php:php php php/php/php timezonephp identifier
php php php php php php php php php php php php php php php php php php php php ifphp php(php$gmtphp php=php=php=php truephp)php php{
php php php php php php php php php php php php php php php php php php php php php php php php php$outputphp php.php=php gmdatephp(php'ephp'php,php mktimephp(php$datephp[php'hoursphp'php]php,php php$datephp[php'minutesphp'php]php,php php$datephp[php'secondsphp'php]php,
php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php$datephp[php'monphp'php]php,php php$datephp[php'mdayphp'php]php,php php2php0php0php0php)php)php;
php php php php php php php php php php php php php php php php php php php php php}php elsephp php{
php php php php php php php php php php php php php php php php php php php php php php php php php$outputphp php.php=php php php datephp(php'ephp'php,php mktimephp(php$datephp[php'hoursphp'php]php,php php$datephp[php'minutesphp'php]php,php php$datephp[php'secondsphp'php]php,
php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php$datephp[php'monphp'php]php,php php$datephp[php'mdayphp'php]php,php php2php0php0php0php)php)php;
php php php php php php php php php php php php php php php php php php php php php}
php php php php php php php php php php php php php php php php php php php php breakphp;

php php php php php php php php php php php php php php php php casephp php'Iphp'php:php php php/php/php daylightphp savingphp timephp orphp not
php php php php php php php php php php php php php php php php php php php php ifphp php(php$gmtphp php=php=php=php truephp)php php{
php php php php php php php php php php php php php php php php php php php php php php php php php$outputphp php.php=php gmdatephp(php'Iphp'php,php mktimephp(php$datephp[php'hoursphp'php]php,php php$datephp[php'minutesphp'php]php,php php$datephp[php'secondsphp'php]php,
php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php$datephp[php'monphp'php]php,php php$datephp[php'mdayphp'php]php,php php2php0php0php0php)php)php;
php php php php php php php php php php php php php php php php php php php php php}php elsephp php{
php php php php php php php php php php php php php php php php php php php php php php php php php$outputphp php.php=php php php datephp(php'Iphp'php,php mktimephp(php$datephp[php'hoursphp'php]php,php php$datephp[php'minutesphp'php]php,php php$datephp[php'secondsphp'php]php,
php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php$datephp[php'monphp'php]php,php php$datephp[php'mdayphp'php]php,php php2php0php0php0php)php)php;
php php php php php php php php php php php php php php php php php php php php php}
php php php php php php php php php php php php php php php php php php php php breakphp;

php php php php php php php php php php php php php php php php casephp php'Ophp'php:php php php/php/php differencephp tophp GMTphp inphp hours
php php php php php php php php php php php php php php php php php php php php php$gmtstrphp php=php php(php$gmtphp php=php=php=php truephp)php php?php php0php php:php php$thisphp-php>getGmtOffsetphp(php)php;
php php php php php php php php php php php php php php php php php php php php php$outputphp php.php=php sprintfphp(php'php%sphp%php0php4dphp'php,php php(php$gmtstrphp <php=php php0php)php php?php php'php+php'php php:php php'php-php'php,php absphp(php$gmtstrphp)php php/php php3php6php)php;
php php php php php php php php php php php php php php php php php php php php breakphp;

php php php php php php php php php php php php php php php php casephp php'Pphp'php:php php php/php/php differencephp tophp GMTphp withphp colon
php php php php php php php php php php php php php php php php php php php php php$gmtstrphp php=php php(php$gmtphp php=php=php=php truephp)php php?php php0php php:php php$thisphp-php>getGmtOffsetphp(php)php;
php php php php php php php php php php php php php php php php php php php php php$gmtstrphp php=php sprintfphp(php'php%sphp%php0php4dphp'php,php php(php$gmtstrphp <php=php php0php)php php?php php'php+php'php php:php php'php-php'php,php absphp(php$gmtstrphp)php php/php php3php6php)php;
php php php php php php php php php php php php php php php php php php php php php$outputphp php=php php$outputphp php.php substrphp(php$gmtstrphp,php php0php,php php3php)php php.php php'php:php'php php.php substrphp(php$gmtstrphp,php php3php)php;
php php php php php php php php php php php php php php php php php php php php breakphp;

php php php php php php php php php php php php php php php php casephp php'Tphp'php:php php php/php/php timezonephp settings
php php php php php php php php php php php php php php php php php php php php ifphp php(php$gmtphp php=php=php=php truephp)php php{
php php php php php php php php php php php php php php php php php php php php php php php php php$outputphp php.php=php gmdatephp(php'Tphp'php,php mktimephp(php$datephp[php'hoursphp'php]php,php php$datephp[php'minutesphp'php]php,php php$datephp[php'secondsphp'php]php,
php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php$datephp[php'monphp'php]php,php php$datephp[php'mdayphp'php]php,php php2php0php0php0php)php)php;
php php php php php php php php php php php php php php php php php php php php php}php elsephp php{
php php php php php php php php php php php php php php php php php php php php php php php php php$outputphp php.php=php php php datephp(php'Tphp'php,php mktimephp(php$datephp[php'hoursphp'php]php,php php$datephp[php'minutesphp'php]php,php php$datephp[php'secondsphp'php]php,
php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php$datephp[php'monphp'php]php,php php$datephp[php'mdayphp'php]php,php php2php0php0php0php)php)php;
php php php php php php php php php php php php php php php php php php php php php}
php php php php php php php php php php php php php php php php php php php php breakphp;

php php php php php php php php php php php php php php php php casephp php'Zphp'php:php php php/php/php timezonephp offsetphp inphp seconds
php php php php php php php php php php php php php php php php php php php php php$outputphp php.php=php php(php$gmtphp php=php=php=php truephp)php php?php php0php php:php php-php$thisphp-php>getGmtOffsetphp(php)php;
php php php php php php php php php php php php php php php php php php php php breakphp;


php php php php php php php php php php php php php php php php php/php/php completephp timephp formats
php php php php php php php php php php php php php php php php casephp php'cphp'php:php php php/php/php ISOphp php8php6php0php1php datephp format
php php php php php php php php php php php php php php php php php php php php php$differencephp php=php php$thisphp-php>getGmtOffsetphp(php)php;
php php php php php php php php php php php php php php php php php php php php php$differencephp php=php sprintfphp(php'php%sphp%php0php4dphp'php,php php(php$differencephp <php=php php0php)php php?php php'php+php'php php:php php'php-php'php,php absphp(php$differencephp)php php/php php3php6php)php;
php php php php php php php php php php php php php php php php php php php php php$differencephp php=php substrphp(php$differencephp,php php0php,php php3php)php php.php php'php:php'php php.php substrphp(php$differencephp,php php3php)php;
php php php php php php php php php php php php php php php php php php php php php$outputphp php.php=php php$datephp[php'yearphp'php]php php.php php'php-php'
php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php.php php(php(php$datephp[php'monphp'php]php php php php php <php php1php0php)php php?php php'php0php'php php.php php$datephp[php'monphp'php]php php php php php php:php php$datephp[php'monphp'php]php)php php php php php php.php php'php-php'
php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php.php php(php(php$datephp[php'mdayphp'php]php php php php <php php1php0php)php php?php php'php0php'php php.php php$datephp[php'mdayphp'php]php php php php php:php php$datephp[php'mdayphp'php]php)php php php php php.php php'Tphp'
php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php.php php(php(php$datephp[php'hoursphp'php]php php php <php php1php0php)php php?php php'php0php'php php.php php$datephp[php'hoursphp'php]php php php php:php php$datephp[php'hoursphp'php]php)php php php php.php php'php:php'
php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php.php php(php(php$datephp[php'minutesphp'php]php <php php1php0php)php php?php php'php0php'php php.php php$datephp[php'minutesphp'php]php php:php php$datephp[php'minutesphp'php]php)php php.php php'php:php'
php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php.php php(php(php$datephp[php'secondsphp'php]php <php php1php0php)php php?php php'php0php'php php.php php$datephp[php'secondsphp'php]php php:php php$datephp[php'secondsphp'php]php)
php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php.php php$differencephp;
php php php php php php php php php php php php php php php php php php php php breakphp;

php php php php php php php php php php php php php php php php casephp php'rphp'php:php php php/php/php RFCphp php2php8php2php2php datephp format
php php php php php php php php php php php php php php php php php php php php php$differencephp php=php php$thisphp-php>getGmtOffsetphp(php)php;
php php php php php php php php php php php php php php php php php php php php php$differencephp php=php sprintfphp(php'php%sphp%php0php4dphp'php,php php(php$differencephp <php=php php0php)php php?php php'php+php'php php:php php'php-php'php,php absphp(php$differencephp)php php/php php3php6php)php;
php php php php php php php php php php php php php php php php php php php php php$outputphp php.php=php gmdatephp(php'Dphp'php,php php8php6php4php0php0php php*php php(php3php php+php selfphp:php:dayOfWeekphp(php$datephp[php'yearphp'php]php,php php$datephp[php'monphp'php]php,php php$datephp[php'mdayphp'php]php)php)php)php php.php php'php,php php'
php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php.php php(php(php$datephp[php'mdayphp'php]php php php php <php php1php0php)php php?php php'php0php'php php.php php$datephp[php'mdayphp'php]php php php php php:php php$datephp[php'mdayphp'php]php)php php php php php.php php'php php'
php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php.php datephp(php'Mphp'php,php mktimephp(php0php,php php0php,php php0php,php php$datephp[php'monphp'php]php,php php2php,php php1php9php7php1php)php)php php.php php'php php'
php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php.php php$datephp[php'yearphp'php]php php.php php'php php'
php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php.php php(php(php$datephp[php'hoursphp'php]php php php <php php1php0php)php php?php php'php0php'php php.php php$datephp[php'hoursphp'php]php php php php:php php$datephp[php'hoursphp'php]php)php php php php.php php'php:php'
php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php.php php(php(php$datephp[php'minutesphp'php]php <php php1php0php)php php?php php'php0php'php php.php php$datephp[php'minutesphp'php]php php:php php$datephp[php'minutesphp'php]php)php php.php php'php:php'
php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php.php php(php(php$datephp[php'secondsphp'php]php <php php1php0php)php php?php php'php0php'php php.php php$datephp[php'secondsphp'php]php php:php php$datephp[php'secondsphp'php]php)php php.php php'php php'
php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php.php php$differencephp;
php php php php php php php php php php php php php php php php php php php php breakphp;

php php php php php php php php php php php php php php php php casephp php'Uphp'php:php php php/php/php Unixphp timestamp
php php php php php php php php php php php php php php php php php php php php php$outputphp php.php=php php$origstampphp;
php php php php php php php php php php php php php php php php php php php php breakphp;


php php php php php php php php php php php php php php php php php/php/php specialphp formats
php php php php php php php php php php php php php php php php casephp php"php\php\php"php:php php php/php/php nextphp letterphp tophp printphp withphp nophp format
php php php php php php php php php php php php php php php php php php php php php$iphp+php+php;
php php php php php php php php php php php php php php php php php php php php ifphp php(php$iphp <php php$lengthphp)php php{
php php php php php php php php php php php php php php php php php php php php php php php php php$outputphp php.php=php php$formatphp[php$iphp]php;
php php php php php php php php php php php php php php php php php php php php php}
php php php php php php php php php php php php php php php php php php php php breakphp;

php php php php php php php php php php php php php php php php defaultphp:php php php/php/php letterphp isphp nophp formatphp sophp addphp itphp direct
php php php php php php php php php php php php php php php php php php php php php$outputphp php.php=php php$formatphp[php$iphp]php;
php php php php php php php php php php php php php php php php php php php php breakphp;
php php php php php php php php php php php php php}
php php php php php php php php php}

php php php php php php php php returnphp php(stringphp)php php$outputphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Returnsphp thephp dayphp ofphp weekphp forphp aphp Gregorianphp calendarphp datephp.
php php php php php php*php php0php php=php sundayphp,php php6php php=php saturday
php php php php php php*
php php php php php php*php php@paramphp php integerphp php php$year
php php php php php php*php php@paramphp php integerphp php php$month
php php php php php php*php php@paramphp php integerphp php php$day
php php php php php php*php php@returnphp integerphp php dayOfWeek
php php php php php php*php/
php php php php protectedphp staticphp functionphp dayOfWeekphp(php$yearphp,php php$monthphp,php php$dayphp)
php php php php php{
php php php php php php php php ifphp php(php(php1php9php0php1php <php php$yearphp)php andphp php(php$yearphp <php php2php0php3php8php)php)php php{
php php php php php php php php php php php php returnphp php(intphp)php datephp(php'wphp'php,php mktimephp(php0php,php php0php,php php0php,php php$monthphp,php php$dayphp,php php$yearphp)php)php;
php php php php php php php php php}

php php php php php php php php php/php/php gregorianphp correction
php php php php php php php php php$correctionphp php=php php0php;
php php php php php php php php ifphp php(php(php$yearphp <php php1php5php8php2php)php orphp php(php(php$yearphp php=php=php php1php5php8php2php)php andphp php(php(php$monthphp <php php1php0php)php orphp php(php(php$monthphp php=php=php php1php0php)php php&php&php php(php$dayphp <php php1php5php)php)php)php)php)php php{
php php php php php php php php php php php php php$correctionphp php=php php3php;
php php php php php php php php php}

php php php php php php php php ifphp php(php$monthphp php>php php2php)php php{
php php php php php php php php php php php php php$monthphp php-php=php php2php;
php php php php php php php php php}php elsephp php{
php php php php php php php php php php php php php$monthphp php+php=php php1php0php;
php php php php php php php php php php php php php$yearphp-php-php;
php php php php php php php php php}

php php php php php php php php php$dayphp php php=php floorphp(php(php1php3php php*php php$monthphp php-php php1php)php php/php php5php)php php+php php$dayphp php+php php(php$yearphp php%php php1php0php0php)php php+php floorphp(php(php$yearphp php%php php1php0php0php)php php/php php4php)php;
php php php php php php php php php$dayphp php+php=php floorphp(php(php$yearphp php/php php1php0php0php)php php/php php4php)php php-php php2php php*php floorphp(php$yearphp php/php php1php0php0php)php php+php php7php7php php+php php$correctionphp;

php php php php php php php php returnphp php(intphp)php php(php$dayphp php-php php7php php*php floorphp(php$dayphp php/php php7php)php)php;
php php php php php}

php php php php php/php*php*
php php php php php php*php Internalphp getDatePartsphp functionphp forphp handlingphp php6php4bitphp timestampsphp,php similarphp tophp:
php php php php php php*php httpphp:php/php/wwwphp.phpphp.netphp/getdate
php php php php php php*
php php php php php php*php Returnsphp anphp arrayphp ofphp datephp partsphp forphp php$timestampphp,php relativephp tophp php1php9php7php0php/php0php1php/php0php1php php0php0php:php0php0php:php0php0php GMTphp/UTCphp.
php php php php php php*
php php php php php php*php php$fastphp specifiesphp ALLphp datephp partsphp shouldphp bephp returnedphp php(slowerphp)
php php php php php php*php Defaultphp isphp falsephp,php andphp excludesphp php$dayofweekphp,php weekdayphp,php monthphp andphp timestampphp fromphp partsphp returnedphp.
php php php php php php*
php php php php php php*php php@paramphp php php mixedphp php php php php$timestamp
php php php php php php*php php@paramphp php php booleanphp php php$fastphp php php OPTIONALphp defaultsphp tophp fastphp php(falsephp)php,php resultingphp inphp fewerphp datephp parts
php php php php php php*php php@returnphp php array
php php php php php php*php/
php php php php protectedphp functionphp getDatePartsphp(php$timestampphp php=php nullphp,php php$fastphp php=php nullphp)
php php php php php{

php php php php php php php php php/php/php actualphp timestamp
php php php php php php php php ifphp php(php!isphp_numericphp(php$timestampphp)php)php php{
php php php php php php php php php php php php returnphp getdatephp(php)php;
php php php php php php php php php}

php php php php php php php php php/php/php php3php2bitphp timestamp
php php php php php php php php ifphp php(absphp(php$timestampphp)php <php=php php0xphp7FFFFFFFphp)php php{
php php php php php php php php php php php php returnphp php@getdatephp(php(intphp)php php$timestampphp)php;
php php php php php php php php php}

php php php php php php php php ifphp php(issetphp(selfphp:php:php$php_cachephp)php)php php{
php php php php php php php php php php php php php$idphp php=php strtrphp(php'Zendphp_DateObjectphp_getDatePartsphp_php'php php.php php$timestampphp.php'php_php'php.php(intphp)php$fastphp,php php'php-php'php,php'php_php'php)php;
php php php php php php php php php php php php ifphp php(php$resultphp php=php selfphp:php:php$php_cachephp-php>loadphp(php$idphp)php)php php{
php php php php php php php php php php php php php php php php returnphp unserializephp(php$resultphp)php;
php php php php php php php php php php php php php}
php php php php php php php php php}

php php php php php php php php php$otimestampphp php=php php$timestampphp;
php php php php php php php php php$numdayphp php=php php0php;
php php php php php php php php php$monthphp php=php php0php;
php php php php php php php php php/php/php gregorianphp correction
php php php php php php php php ifphp php(php$timestampphp <php php-php1php2php2php1php9php3php2php1php6php0php0php)php php{
php php php php php php php php php php php php php$timestampphp php-php=php php8php6php4php0php0php0php;
php php php php php php php php php}

php php php php php php php php php/php/php timestampphp lowerphp php0
php php php php php php php php ifphp php(php$timestampphp <php php0php)php php{
php php php php php php php php php php php php php$secphp php=php php0php;
php php php php php php php php php php php php php$actphp php=php php1php9php7php0php;

php php php php php php php php php php php php php/php/php iteratephp throughphp php1php0php yearsphp tablephp,php increasingphp speed
php php php php php php php php php php php php foreachphp(selfphp:php:php$php_yearTablephp asphp php$yearphp php=php>php php$secondsphp)php php{
php php php php php php php php php php php php php php php php ifphp php(php$timestampphp php>php=php php$secondsphp)php php{
php php php php php php php php php php php php php php php php php php php php php$iphp php=php php$actphp;
php php php php php php php php php php php php php php php php php php php php breakphp;
php php php php php php php php php php php php php php php php php}
php php php php php php php php php php php php php php php php php$secphp php=php php$secondsphp;
php php php php php php php php php php php php php php php php php$actphp php=php php$yearphp;
php php php php php php php php php php php php php}

php php php php php php php php php php php php php$timestampphp php-php=php php$secphp;
php php php php php php php php php php php php ifphp php(php!issetphp(php$iphp)php)php php{
php php php php php php php php php php php php php php php php php$iphp php=php php$actphp;
php php php php php php php php php php php php php}

php php php php php php php php php php php php php/php/php iteratephp thephp maxphp lastphp php1php0php years
php php php php php php php php php php php php dophp php{
php php php php php php php php php php php php php php php php php-php-php$iphp;
php php php php php php php php php php php php php php php php php$dayphp php=php php$timestampphp;

php php php php php php php php php php php php php php php php php$timestampphp php+php=php php3php1php5php3php6php0php0php0php;
php php php php php php php php php php php php php php php php php$leapyearphp php=php selfphp:php:isYearLeapYearphp(php$iphp)php;
php php php php php php php php php php php php php php php php ifphp php(php$leapyearphp php=php=php=php truephp)php php{
php php php php php php php php php php php php php php php php php php php php php$timestampphp php+php=php php8php6php4php0php0php;
php php php php php php php php php php php php php php php php php}

php php php php php php php php php php php php php php php php ifphp php(php$timestampphp php>php=php php0php)php php{
php php php php php php php php php php php php php php php php php php php php php$yearphp php=php php$iphp;
php php php php php php php php php php php php php php php php php php php php breakphp;
php php php php php php php php php php php php php php php php php}
php php php php php php php php php php php php php}php whilephp php(php$timestampphp <php php0php)php;

php php php php php php php php php php php php php$secondsPerYearphp php=php php8php6php4php0php0php php*php php(php$leapyearphp php?php php3php6php6php php:php php3php6php5php)php php+php php$dayphp;

php php php php php php php php php php php php php$timestampphp php=php php$dayphp;
php php php php php php php php php php php php php/php/php iteratephp throughphp months
php php php php php php php php php php php php forphp php(php$iphp php=php php1php2php;php php-php-php$iphp php>php=php php0php;php)php php{
php php php php php php php php php php php php php php php php php$dayphp php=php php$timestampphp;

php php php php php php php php php php php php php php php php php$timestampphp php+php=php selfphp:php:php$php_monthTablephp[php$iphp]php php*php php8php6php4php0php0php;
php php php php php php php php php php php php php php php php ifphp php(php(php$leapyearphp php=php=php=php truephp)php andphp php(php$iphp php=php=php php1php)php)php php{
php php php php php php php php php php php php php php php php php php php php php$timestampphp php+php=php php8php6php4php0php0php;
php php php php php php php php php php php php php php php php php}

php php php php php php php php php php php php php php php php ifphp php(php$timestampphp php>php=php php0php)php php{
php php php php php php php php php php php php php php php php php php php php php$monthphp php php=php php$iphp;
php php php php php php php php php php php php php php php php php php php php php$numdayphp php=php selfphp:php:php$php_monthTablephp[php$iphp]php;
php php php php php php php php php php php php php php php php php php php php ifphp php(php(php$leapyearphp php=php=php=php truephp)php andphp php(php$iphp php=php=php php1php)php)php php{
php php php php php php php php php php php php php php php php php php php php php php php php php+php+php$numdayphp;
php php php php php php php php php php php php php php php php php php php php php}
php php php php php php php php php php php php php php php php php php php php breakphp;
php php php php php php php php php php php php php php php php php}
php php php php php php php php php php php php php}

php php php php php php php php php php php php php$timestampphp php php=php php$dayphp;
php php php php php php php php php php php php php$numberdaysphp php=php php$numdayphp php+php ceilphp(php(php$timestampphp php+php php1php)php php/php php8php6php4php0php0php)php;

php php php php php php php php php php php php php$timestampphp php+php=php php(php$numdayphp php-php php$numberdaysphp php+php php1php)php php*php php8php6php4php0php0php;
php php php php php php php php php php php php php$hoursphp php php php php php php=php floorphp(php$timestampphp php/php php3php6php0php0php)php;
php php php php php php php php php}php elsephp php{

php php php php php php php php php php php php php/php/php iteratephp throughphp years
php php php php php php php php php php php php forphp php(php$iphp php=php php1php9php7php0php;php;php$iphp+php+php)php php{
php php php php php php php php php php php php php php php php php$dayphp php=php php$timestampphp;

php php php php php php php php php php php php php php php php php$timestampphp php-php=php php3php1php5php3php6php0php0php0php;
php php php php php php php php php php php php php php php php php$leapyearphp php=php selfphp:php:isYearLeapYearphp(php$iphp)php;
php php php php php php php php php php php php php php php php ifphp php(php$leapyearphp php=php=php=php truephp)php php{
php php php php php php php php php php php php php php php php php php php php php$timestampphp php-php=php php8php6php4php0php0php;
php php php php php php php php php php php php php php php php php}

php php php php php php php php php php php php php php php php ifphp php(php$timestampphp <php php0php)php php{
php php php php php php php php php php php php php php php php php php php php php$yearphp php=php php$iphp;
php php php php php php php php php php php php php php php php php php php php breakphp;
php php php php php php php php php php php php php php php php php}
php php php php php php php php php php php php php}

php php php php php php php php php php php php php$secondsPerYearphp php=php php$dayphp;

php php php php php php php php php php php php php$timestampphp php=php php$dayphp;
php php php php php php php php php php php php php/php/php iteratephp throughphp months
php php php php php php php php php php php php forphp php(php$iphp php=php php0php;php php$iphp <php=php php1php1php;php php$iphp+php+php)php php{
php php php php php php php php php php php php php php php php php$dayphp php=php php$timestampphp;
php php php php php php php php php php php php php php php php php$timestampphp php-php=php selfphp:php:php$php_monthTablephp[php$iphp]php php*php php8php6php4php0php0php;

php php php php php php php php php php php php php php php php ifphp php(php(php$leapyearphp php=php=php=php truephp)php andphp php(php$iphp php=php=php php1php)php)php php{
php php php php php php php php php php php php php php php php php php php php php$timestampphp php-php=php php8php6php4php0php0php;
php php php php php php php php php php php php php php php php php}

php php php php php php php php php php php php php php php php ifphp php(php$timestampphp <php php0php)php php{
php php php php php php php php php php php php php php php php php php php php php$monthphp php php=php php$iphp;
php php php php php php php php php php php php php php php php php php php php php$numdayphp php=php selfphp:php:php$php_monthTablephp[php$iphp]php;
php php php php php php php php php php php php php php php php php php php php ifphp php(php(php$leapyearphp php=php=php=php truephp)php andphp php(php$iphp php=php=php php1php)php)php php{
php php php php php php php php php php php php php php php php php php php php php php php php php+php+php$numdayphp;
php php php php php php php php php php php php php php php php php php php php php}
php php php php php php php php php php php php php php php php php php php php breakphp;
php php php php php php php php php php php php php php php php php}
php php php php php php php php php php php php php}

php php php php php php php php php php php php php$timestampphp php php=php php$dayphp;
php php php php php php php php php php php php php$numberdaysphp php=php ceilphp(php(php$timestampphp php+php php1php)php php/php php8php6php4php0php0php)php;
php php php php php php php php php php php php php$timestampphp php php=php php$timestampphp php-php php(php$numberdaysphp php-php php1php)php php*php php8php6php4php0php0php;
php php php php php php php php php php php php php$hoursphp php=php floorphp(php$timestampphp php/php php3php6php0php0php)php;
php php php php php php php php php}

php php php php php php php php php$timestampphp php-php=php php$hoursphp php*php php3php6php0php0php;

php php php php php php php php php$monthphp php php+php=php php1php;
php php php php php php php php php$minutesphp php=php floorphp(php$timestampphp php/php php6php0php)php;
php php php php php php php php php$secondsphp php=php php$timestampphp php-php php$minutesphp php*php php6php0php;

php php php php php php php php ifphp php(php$fastphp php=php=php=php truephp)php php{
php php php php php php php php php php php php php$arrayphp php=php arrayphp(
php php php php php php php php php php php php php php php php php'secondsphp'php php=php>php php$secondsphp,
php php php php php php php php php php php php php php php php php'minutesphp'php php=php>php php$minutesphp,
php php php php php php php php php php php php php php php php php'hoursphp'php php php php=php>php php$hoursphp,
php php php php php php php php php php php php php php php php php'mdayphp'php php php php php=php>php php$numberdaysphp,
php php php php php php php php php php php php php php php php php'monphp'php php php php php php=php>php php$monthphp,
php php php php php php php php php php php php php php php php php'yearphp'php php php php php=php>php php$yearphp,
php php php php php php php php php php php php php php php php php'ydayphp'php php php php php=php>php floorphp(php$secondsPerYearphp php/php php8php6php4php0php0php)php,
php php php php php php php php php php php php php)php;
php php php php php php php php php}php elsephp php{

php php php php php php php php php php php php php$dayofweekphp php=php selfphp:php:dayOfWeekphp(php$yearphp,php php$monthphp,php php$numberdaysphp)php;
php php php php php php php php php php php php php$arrayphp php=php arrayphp(
php php php php php php php php php php php php php php php php php php php php php'secondsphp'php php=php>php php$secondsphp,
php php php php php php php php php php php php php php php php php php php php php'minutesphp'php php=php>php php$minutesphp,
php php php php php php php php php php php php php php php php php php php php php'hoursphp'php php php php=php>php php$hoursphp,
php php php php php php php php php php php php php php php php php php php php php'mdayphp'php php php php php=php>php php$numberdaysphp,
php php php php php php php php php php php php php php php php php php php php php'wdayphp'php php php php php=php>php php$dayofweekphp,
php php php php php php php php php php php php php php php php php php php php php'monphp'php php php php php php=php>php php$monthphp,
php php php php php php php php php php php php php php php php php php php php php'yearphp'php php php php php=php>php php$yearphp,
php php php php php php php php php php php php php php php php php php php php php'ydayphp'php php php php php=php>php floorphp(php$secondsPerYearphp php/php php8php6php4php0php0php)php,
php php php php php php php php php php php php php php php php php php php php php'weekdayphp'php php=php>php gmdatephp(php'lphp'php,php php8php6php4php0php0php php*php php(php3php php+php php$dayofweekphp)php)php,
php php php php php php php php php php php php php php php php php php php php php'monthphp'php php php php=php>php gmdatephp(php'Fphp'php,php mktimephp(php0php,php php0php,php php0php,php php$monthphp,php php1php,php php1php9php7php1php)php)php,
php php php php php php php php php php php php php php php php php php php php php0php php php php php php php php php php=php>php php$otimestamp
php php php php php php php php php php php php php)php;
php php php php php php php php php}

php php php php php php php php ifphp php(issetphp(selfphp:php:php$php_cachephp)php)php php{
php php php php php php php php php php php php ifphp php(selfphp:php:php$php_cacheTagsphp)php php{
php php php php php php php php php php php php php php php php selfphp:php:php$php_cachephp-php>savephp(php serializephp(php$arrayphp)php,php php$idphp,php arrayphp(php'Zendphp_Datephp'php)php)php;
php php php php php php php php php php php php php}php elsephp php{
php php php php php php php php php php php php php php php php selfphp:php:php$php_cachephp-php>savephp(php serializephp(php$arrayphp)php,php php$idphp)php;
php php php php php php php php php php php php php}
php php php php php php php php php}

php php php php php php php php returnphp php$arrayphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Internalphp getWeekNumberphp functionphp forphp handlingphp php6php4bitphp timestamps
php php php php php php*
php php php php php php*php Returnsphp thephp ISOphp php8php6php0php1php weekphp numberphp ofphp aphp givenphp date
php php php php php php*
php php php php php php*php php@paramphp php integerphp php php$year
php php php php php php*php php@paramphp php integerphp php php$month
php php php php php php*php php@paramphp php integerphp php php$day
php php php php php php*php php@returnphp integer
php php php php php php*php/
php php php php protectedphp functionphp weekNumberphp(php$yearphp,php php$monthphp,php php$dayphp)
php php php php php{
php php php php php php php php ifphp php(php(php1php9php0php1php <php php$yearphp)php andphp php(php$yearphp <php php2php0php3php8php)php)php php{
php php php php php php php php php php php php returnphp php(intphp)php datephp(php'Wphp'php,php mktimephp(php0php,php php0php,php php0php,php php$monthphp,php php$dayphp,php php$yearphp)php)php;
php php php php php php php php php}

php php php php php php php php php$dayofweekphp php=php selfphp:php:dayOfWeekphp(php$yearphp,php php$monthphp,php php$dayphp)php;
php php php php php php php php php$firstdayphp php php=php selfphp:php:dayOfWeekphp(php$yearphp,php php1php,php php1php)php;
php php php php php php php php ifphp php(php(php$monthphp php=php=php php1php)php andphp php(php(php$firstdayphp <php php1php)php orphp php(php$firstdayphp php>php php4php)php)php andphp php(php$dayphp <php php4php)php)php php{
php php php php php php php php php php php php php$firstdayphp php php=php selfphp:php:dayOfWeekphp(php$yearphp php-php php1php,php php1php,php php1php)php;
php php php php php php php php php php php php php$monthphp php php php php php=php php1php2php;
php php php php php php php php php php php php php$dayphp php php php php php php php=php php3php1php;

php php php php php php php php php}php elsephp ifphp php(php(php$monthphp php=php=php php1php2php)php andphp php(php(selfphp:php:dayOfWeekphp(php$yearphp php+php php1php,php php1php,php php1php)php <php php5php)php and
php php php php php php php php php php php php php php php php php php php php(selfphp:php:dayOfWeekphp(php$yearphp php+php php1php,php php1php,php php1php)php php>php php0php)php)php)php php{
php php php php php php php php php php php php returnphp php1php;
php php php php php php php php php}

php php php php php php php php returnphp intvalphp php(php(php(selfphp:php:dayOfWeekphp(php$yearphp,php php1php,php php1php)php <php php5php)php andphp php(selfphp:php:dayOfWeekphp(php$yearphp,php php1php,php php1php)php php>php php0php)php)php php+
php php php php php php php php php php php php php php php php4php php*php php(php$monthphp php-php php1php)php php+php php(php2php php*php php(php$monthphp php-php php1php)php php+php php(php$dayphp php-php php1php)php php+php php$firstdayphp php-php php$dayofweekphp php+php php6php)php php*php php3php6php php/php php2php5php6php)php;
php php php php php}

php php php php php/php*php*
php php php php php php*php Internalphp php_rangephp function
php php php php php php*php Setsphp thephp valuephp php$aphp tophp bephp inphp thephp rangephp ofphp php[php0php,php php$bphp]
php php php php php php*
php php php php php php*php php@paramphp floatphp php$aphp php-php valuephp tophp correct
php php php php php php*php php@paramphp floatphp php$bphp php-php maximumphp rangephp tophp set
php php php php php php*php/
php php php php privatephp functionphp php_rangephp(php$aphp,php php$bphp)php php{
php php php php php php php php whilephp php(php$aphp <php php0php)php php{
php php php php php php php php php php php php php$aphp php+php=php php$bphp;
php php php php php php php php php}
php php php php php php php php whilephp php(php$aphp php>php=php php$bphp)php php{
php php php php php php php php php php php php php$aphp php-php=php php$bphp;
php php php php php php php php php}
php php php php php php php php returnphp php$aphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Calculatesphp thephp sunrisephp orphp sunsetphp basedphp onphp aphp location
php php php php php php*
php php php php php php*php php@paramphp php arrayphp php php$locationphp php Locationphp forphp calculationphp MUSTphp includephp php'latitudephp'php,php php'longitudephp'php,php php'horizonphp'
php php php php php php*php php@paramphp php boolphp php php php$horizonphp php php truephp:php sunrisephp;php falsephp:php sunset
php php php php php php*php php@returnphp mixedphp php php-php falsephp:php midnightphp sunphp,php integerphp:
php php php php php php*php/
php php php php protectedphp functionphp calcSunphp(php$locationphp,php php$horizonphp,php php$risephp php=php falsephp)
php php php php php{
php php php php php php php php php/php/php timestampphp withinphp php3php2bit
php php php php php php php php ifphp php(absphp(php$thisphp-php>php_unixTimestampphp)php <php=php php0xphp7FFFFFFFphp)php php{
php php php php php php php php php php php php ifphp php(php$risephp php=php=php=php falsephp)php php{
php php php php php php php php php php php php php php php php returnphp datephp_sunsetphp(php$thisphp-php>php_unixTimestampphp,php SUNFUNCSphp_RETphp_TIMESTAMPphp,php php$locationphp[php'latitudephp'php]php,
php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php$locationphp[php'longitudephp'php]php,php php9php0php php+php php$horizonphp,php php$thisphp-php>getGmtOffsetphp(php)php php/php php3php6php0php0php)php;
php php php php php php php php php php php php php}
php php php php php php php php php php php php returnphp datephp_sunrisephp(php$thisphp-php>php_unixTimestampphp,php SUNFUNCSphp_RETphp_TIMESTAMPphp,php php$locationphp[php'latitudephp'php]php,
php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php$locationphp[php'longitudephp'php]php,php php9php0php php+php php$horizonphp,php php$thisphp-php>getGmtOffsetphp(php)php php/php php3php6php0php0php)php;
php php php php php php php php php}

php php php php php php php php php/php/php selfphp calculationphp php-php timestampphp biggerphp thanphp php3php2bit
php php php php php php php php php/php/php fixphp circlephp values
php php php php php php php php php$quarterCirclephp php php php php php php=php php0php.php5php php*php Mphp_PIphp;
php php php php php php php php php$halfCirclephp php php php php php php php php php=php php php php php php php Mphp_PIphp;
php php php php php php php php php$threeQuarterCirclephp php=php php1php.php5php php*php Mphp_PIphp;
php php php php php php php php php$fullCirclephp php php php php php php php php php=php php2php php php php*php Mphp_PIphp;

php php php php php php php php php/php/php radiantphp conversionphp forphp coordinates
php php php php php php php php php$radLatitudephp php php=php php$locationphp[php'latitudephp'php]php php php php*php php$halfCirclephp php/php php1php8php0php;
php php php php php php php php php$radLongitudephp php=php php$locationphp[php'longitudephp'php]php php php*php php$halfCirclephp php/php php1php8php0php;

php php php php php php php php php/php/php getphp solarphp coordinates
php php php php php php php php php$tmpRisephp php php php php php php php=php php$risephp php?php php$quarterCirclephp php:php php$threeQuarterCirclephp;
php php php php php php php php php$radDayphp php php php php php php php php=php php$thisphp-php>datephp(php'zphp'php,php$thisphp-php>php_unixTimestampphp)php php+php php(php$tmpRisephp php-php php$radLongitudephp)php php/php php$fullCirclephp;

php php php php php php php php php/php/php solarphp anomolyphp andphp longitude
php php php php php php php php php$solAnomolyphp php php php php=php php$radDayphp php*php php0php.php0php1php7php2php0php2php php-php php0php.php0php5php7php4php0php3php9php;
php php php php php php php php php$solLongitudephp php php=php php$solAnomolyphp php+php php0php.php0php3php3php4php4php0php5php php*php sinphp(php$solAnomolyphp)php;
php php php php php php php php php$solLongitudephp php+php=php php4php.php9php3php2php8php9php php+php php3php.php4php9php0php6php6Ephp-php4php php*php sinphp(php2php php*php php$solAnomolyphp)php;

php php php php php php php php php/php/php getphp quadrant
php php php php php php php php php$solLongitudephp php=php php$thisphp-php>php_rangephp(php$solLongitudephp,php php$fullCirclephp)php;

php php php php php php php php ifphp php(php(php$solLongitudephp php/php php$quarterCirclephp)php php-php intvalphp(php$solLongitudephp php/php php$quarterCirclephp)php php=php=php php0php)php php{
php php php php php php php php php php php php php$solLongitudephp php+php=php php4php.php8php4php8php1php4Ephp-php6php;
php php php php php php php php php}

php php php php php php php php php/php/php solarphp ascension
php php php php php php php php php$solAscensionphp php=php sinphp(php$solLongitudephp)php php/php cosphp(php$solLongitudephp)php;
php php php php php php php php php$solAscensionphp php=php atanphp2php(php0php.php9php1php7php4php6php php*php php$solAscensionphp,php php1php)php;

php php php php php php php php php/php/php adjustphp quadrant
php php php php php php php php ifphp php(php$solLongitudephp php>php php$threeQuarterCirclephp)php php{
php php php php php php php php php php php php php$solAscensionphp php+php=php php$fullCirclephp;
php php php php php php php php php}php elsephp ifphp php(php$solLongitudephp php>php php$quarterCirclephp)php php{
php php php php php php php php php php php php php$solAscensionphp php+php=php php$halfCirclephp;
php php php php php php php php php}

php php php php php php php php php/php/php solarphp declination
php php php php php php php php php$solDeclinationphp php php=php php0php.php3php9php7php8php2php php*php sinphp(php$solLongitudephp)php;
php php php php php php php php php$solDeclinationphp php/php=php php sqrtphp(php-php$solDeclinationphp php*php php$solDeclinationphp php+php php1php)php;
php php php php php php php php php$solDeclinationphp php php=php atanphp2php(php$solDeclinationphp,php php1php)php;

php php php php php php php php php$solHorizonphp php=php php$horizonphp php-php sinphp(php$solDeclinationphp)php php*php sinphp(php$radLatitudephp)php;
php php php php php php php php php$solHorizonphp php/php=php cosphp(php$solDeclinationphp)php php*php cosphp(php$radLatitudephp)php;

php php php php php php php php php/php/php midnightphp sunphp,php alwaysphp night
php php php php php php php php ifphp php(absphp(php$solHorizonphp)php php>php php1php)php php{
php php php php php php php php php php php php returnphp falsephp;
php php php php php php php php php}

php php php php php php php php php$solHorizonphp php/php=php sqrtphp(php-php$solHorizonphp php*php php$solHorizonphp php+php php1php)php;
php php php php php php php php php$solHorizonphp php php=php php$quarterCirclephp php-php atanphp2php(php$solHorizonphp,php php1php)php;

php php php php php php php php ifphp php(php$risephp)php php{
php php php php php php php php php php php php php$solHorizonphp php=php php$fullCirclephp php-php php$solHorizonphp;
php php php php php php php php php}

php php php php php php php php php/php/php timephp calculation
php php php php php php php php php$localTimephp php php php php php=php php$solHorizonphp php+php php$solAscensionphp php-php php0php.php0php1php7php2php0php2php8php php*php php$radDayphp php-php php1php.php7php3php3php6php4php;
php php php php php php php php php$universalTimephp php=php php$localTimephp php-php php$radLongitudephp;

php php php php php php php php php/php/php determinatephp quadrant
php php php php php php php php php$universalTimephp php=php php$thisphp-php>php_rangephp(php$universalTimephp,php php$fullCirclephp)php;

php php php php php php php php php/php/php radiantphp tophp hours
php php php php php php php php php$universalTimephp php*php=php php2php4php php/php php$fullCirclephp;

php php php php php php php php php/php/php convertphp tophp time
php php php php php php php php php$hourphp php=php intvalphp(php$universalTimephp)php;
php php php php php php php php php$universalTimephp php php php php=php php(php$universalTimephp php-php php$hourphp)php php*php php6php0php;
php php php php php php php php php$minphp php php=php intvalphp(php$universalTimephp)php;
php php php php php php php php php$universalTimephp php php php php=php php(php$universalTimephp php-php php$minphp)php php*php php6php0php;
php php php php php php php php php$secphp php php=php intvalphp(php$universalTimephp)php;

php php php php php php php php returnphp php$thisphp-php>mktimephp(php$hourphp,php php$minphp,php php$secphp,php php$thisphp-php>datephp(php'mphp'php,php php$thisphp-php>php_unixTimestampphp)php,
php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php$thisphp-php>datephp(php'jphp'php,php php$thisphp-php>php_unixTimestampphp)php,php php$thisphp-php>datephp(php'Yphp'php,php php$thisphp-php>php_unixTimestampphp)php,
php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php-php1php,php truephp)php;
php php php php php}

php php php php php/php*php*
php php php php php php*php Setsphp aphp newphp timezonephp forphp calculationphp ofphp php$thisphp objectphp'sphp gmtphp offsetphp.
php php php php php php*php Forphp aphp listphp ofphp supportedphp timezonesphp lookphp herephp:php httpphp:php/php/phpphp.netphp/timezones
php php php php php php*php Ifphp nophp timezonephp canphp bephp detectedphp orphp thephp givenphp timezonephp isphp wrongphp UTCphp willphp bephp setphp.
php php php php php php*
php php php php php php*php php@paramphp php stringphp php php$zonephp php php php php php OPTIONALphp timezonephp forphp datephp calculationphp;php defaultsphp tophp datephp_defaultphp_timezonephp_getphp(php)
php php php php php php*php php@returnphp Zendphp_Datephp_DateObjectphp Providesphp fluentphp interface
php php php php php php*php php@throwsphp Zendphp_Datephp_Exception
php php php php php php*php/
php php php php publicphp functionphp setTimezonephp(php$zonephp php=php nullphp)
php php php php php{
php php php php php php php php php$oldzonephp php=php php@datephp_defaultphp_timezonephp_getphp(php)php;
php php php php php php php php ifphp php(php$zonephp php=php=php=php nullphp)php php{
php php php php php php php php php php php php php$zonephp php=php php$oldzonephp;
php php php php php php php php php}

php php php php php php php php php/php/php throwphp anphp errorphp onphp falsephp inputphp,php butphp onlyphp ifphp thephp newphp datephp extensionphp isphp available
php php php php php php php php ifphp php(functionphp_existsphp(php'timezonephp_openphp'php)php)php php{
php php php php php php php php php php php php ifphp php(php!php@timezonephp_openphp(php$zonephp)php)php php{
php php php php php php php php php php php php php php php php requirephp_oncephp php'Zendphp/Datephp/Exceptionphp.phpphp'php;
php php php php php php php php php php php php php php php php throwphp newphp Zendphp_Datephp_Exceptionphp(php"timezonephp php(php$zonephp)php isphp notphp aphp knownphp timezonephp"php,php php0php,php nullphp,php php$zonephp)php;
php php php php php php php php php php php php php}
php php php php php php php php php}
php php php php php php php php php/php/php thisphp canphp generatephp anphp errorphp ifphp thephp datephp extensionphp isphp notphp availablephp andphp aphp falsephp timezonephp isphp given
php php php php php php php php php$resultphp php=php php@datephp_defaultphp_timezonephp_setphp(php$zonephp)php;
php php php php php php php php ifphp php(php$resultphp php=php=php=php truephp)php php{
php php php php php php php php php php php php php$thisphp-php>php_offsetphp php php php=php mktimephp(php0php,php php0php,php php0php,php php1php,php php2php,php php1php9php7php0php)php php-php gmmktimephp(php0php,php php0php,php php0php,php php1php,php php2php,php php1php9php7php0php)php;
php php php php php php php php php php php php php$thisphp-php>php_timezonephp php=php php$zonephp;
php php php php php php php php php}
php php php php php php php php datephp_defaultphp_timezonephp_setphp(php$oldzonephp)php;

php php php php php php php php ifphp php(php(php$zonephp php=php=php php'UTCphp'php)php orphp php(php$zonephp php=php=php php'GMTphp'php)php)php php{
php php php php php php php php php php php php php$thisphp-php>php_dstphp php=php falsephp;
php php php php php php php php php}php elsephp php{
php php php php php php php php php php php php php$thisphp-php>php_dstphp php=php truephp;
php php php php php php php php php}

php php php php php php php php returnphp php$thisphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Returnphp thephp timezonephp ofphp php$thisphp objectphp.
php php php php php php*php Thephp timezonephp isphp initiallyphp setphp whenphp thephp objectphp isphp instantiatedphp.
php php php php php php*
php php php php php php*php php@returnphp php stringphp php actualphp setphp timezonephp string
php php php php php php*php/
php php php php publicphp functionphp getTimezonephp(php)
php php php php php{
php php php php php php php php returnphp php$thisphp-php>php_timezonephp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Returnphp thephp offsetphp tophp GMTphp ofphp php$thisphp objectphp'sphp timezonephp.
php php php php php php*php Thephp offsetphp tophp GMTphp isphp initiallyphp setphp whenphp thephp objectphp isphp instantiatedphp usingphp thephp currentlyphp,
php php php php php php*php inphp effectphp,php defaultphp timezonephp forphp PHPphp functionsphp.
php php php php php php*
php php php php php php*php php@returnphp php integerphp php secondsphp differencephp betweenphp GMTphp timezonephp andphp timezonephp whenphp objectphp wasphp instantiated
php php php php php php*php/
php php php php publicphp functionphp getGmtOffsetphp(php)
php php php php php{
php php php php php php php php php$datephp php php php=php php$thisphp-php>getDatePartsphp(php$thisphp-php>getUnixTimestampphp(php)php,php truephp)php;
php php php php php php php php php$zonephp php php php=php php@datephp_defaultphp_timezonephp_getphp(php)php;
php php php php php php php php php$resultphp php=php php@datephp_defaultphp_timezonephp_setphp(php$thisphp-php>php_timezonephp)php;
php php php php php php php php ifphp php(php$resultphp php=php=php=php truephp)php php{
php php php php php php php php php php php php php$offsetphp php=php php$thisphp-php>mktimephp(php$datephp[php'hoursphp'php]php,php php$datephp[php'minutesphp'php]php,php php$datephp[php'secondsphp'php]php,
php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php$datephp[php'monphp'php]php,php php$datephp[php'mdayphp'php]php,php php$datephp[php'yearphp'php]php,php falsephp)
php php php php php php php php php php php php php php php php php php php php php-php php$thisphp-php>mktimephp(php$datephp[php'hoursphp'php]php,php php$datephp[php'minutesphp'php]php,php php$datephp[php'secondsphp'php]php,
php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php$datephp[php'monphp'php]php,php php$datephp[php'mdayphp'php]php,php php$datephp[php'yearphp'php]php,php truephp)php;
php php php php php php php php php}
php php php php php php php php datephp_defaultphp_timezonephp_setphp(php$zonephp)php;

php php php php php php php php returnphp php$offsetphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Internalphp methodphp tophp checkphp ifphp thephp givenphp cachephp supportsphp tags
php php php php php php*
php php php php php php*php php@paramphp Zendphp_Cachephp php$cache
php php php php php php*php/
php php php php protectedphp staticphp functionphp php_getTagSupportForCachephp(php)
php php php php php{
php php php php php php php php php$backendphp php=php selfphp:php:php$php_cachephp-php>getBackendphp(php)php;
php php php php php php php php ifphp php(php$backendphp instanceofphp Zendphp_Cachephp_Backendphp_ExtendedInterfacephp)php php{
php php php php php php php php php php php php php$cacheOptionsphp php=php php$backendphp-php>getCapabilitiesphp(php)php;
php php php php php php php php php php php php selfphp:php:php$php_cacheTagsphp php=php php$cacheOptionsphp[php'tagsphp'php]php;
php php php php php php php php php}php elsephp php{
php php php php php php php php php php php php selfphp:php:php$php_cacheTagsphp php=php falsephp;
php php php php php php php php php}

php php php php php php php php returnphp selfphp:php:php$php_cacheTagsphp;
php php php php php}
php}
