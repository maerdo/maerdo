<php?php
php/php*php*
php php*php Zendphp Framework
php php*
php php*php LICENSE
php php*
php php*php Thisphp sourcephp filephp isphp subjectphp tophp thephp newphp BSDphp licensephp thatphp isphp bundled
php php*php withphp thisphp packagephp inphp thephp filephp LICENSEphp.txtphp.
php php*php Itphp isphp alsophp availablephp throughphp thephp worldphp-widephp-webphp atphp thisphp URLphp:
php php*php httpphp:php/php/frameworkphp.zendphp.comphp/licensephp/newphp-bsd
php php*php Ifphp youphp didphp notphp receivephp aphp copyphp ofphp thephp licensephp andphp arephp unablephp to
php php*php obtainphp itphp throughphp thephp worldphp-widephp-webphp,php pleasephp sendphp anphp email
php php*php tophp licensephp@zendphp.comphp sophp wephp canphp sendphp youphp aphp copyphp immediatelyphp.
php php*
php php*php php@categoryphp php php Zend
php php*php php@packagephp php php php Zendphp_Controller
php php*php php@copyrightphp php Copyrightphp php(cphp)php php2php0php0php5php-php2php0php1php0php Zendphp Technologiesphp USAphp Incphp.php php(httpphp:php/php/wwwphp.zendphp.comphp)
php php*php php@licensephp php php php httpphp:php/php/frameworkphp.zendphp.comphp/licensephp/newphp-bsdphp php php php php Newphp BSDphp License
php php*php php@versionphp php php php php$Idphp:php Actionphp.phpphp php2php3php4php8php6php php2php0php1php0php-php1php2php-php1php0php php0php4php:php0php5php:php3php0Zphp mjhphp_caphp php$
php php*php/

php/php*php*
php php*php php@seephp Zendphp_Controllerphp_Actionphp_HelperBroker
php php*php/
requirephp_oncephp php'Zendphp/Controllerphp/Actionphp/HelperBrokerphp.phpphp'php;

php/php*php*
php php*php php@seephp Zendphp_Controllerphp_Actionphp_Interface
php php*php/
requirephp_oncephp php'Zendphp/Controllerphp/Actionphp/Interfacephp.phpphp'php;

php/php*php*
php php*php php@seephp Zendphp_Controllerphp_Front
php php*php/
requirephp_oncephp php'Zendphp/Controllerphp/Frontphp.phpphp'php;

php/php*php*
php php*php php@categoryphp php php Zend
php php*php php@packagephp php php php Zendphp_Controller
php php*php php@copyrightphp php Copyrightphp php(cphp)php php2php0php0php5php-php2php0php1php0php Zendphp Technologiesphp USAphp Incphp.php php(httpphp:php/php/wwwphp.zendphp.comphp)
php php*php php@licensephp php php php httpphp:php/php/frameworkphp.zendphp.comphp/licensephp/newphp-bsdphp php php php php Newphp BSDphp License
php php*php/
abstractphp classphp Zendphp_Controllerphp_Actionphp implementsphp Zendphp_Controllerphp_Actionphp_Interface
php{
php php php php php/php*php*
php php php php php php*php php@varphp arrayphp ofphp existingphp classphp methods
php php php php php php*php/
php php php php protectedphp php$php_classMethodsphp;

php php php php php/php*php*
php php php php php php*php Wordphp delimitersphp php(usedphp forphp normalizingphp viewphp scriptphp pathsphp)
php php php php php php*php php@varphp array
php php php php php php*php/
php php php php protectedphp php$php_delimitersphp;

php php php php php/php*php*
php php php php php php*php Arrayphp ofphp argumentsphp providedphp tophp thephp constructorphp,php minusphp the
php php php php php php*php php{php@linkphp php$php_requestphp Requestphp objectphp}php.
php php php php php php*php php@varphp array
php php php php php php*php/
php php php php protectedphp php$php_invokeArgsphp php=php arrayphp(php)php;

php php php php php/php*php*
php php php php php php*php Frontphp controllerphp instance
php php php php php php*php php@varphp Zendphp_Controllerphp_Front
php php php php php php*php/
php php php php protectedphp php$php_frontControllerphp;

php php php php php/php*php*
php php php php php php*php Zendphp_Controllerphp_Requestphp_Abstractphp objectphp wrappingphp thephp requestphp environment
php php php php php php*php php@varphp Zendphp_Controllerphp_Requestphp_Abstract
php php php php php php*php/
php php php php protectedphp php$php_requestphp php=php nullphp;

php php php php php/php*php*
php php php php php php*php Zendphp_Controllerphp_Responsephp_Abstractphp objectphp wrappingphp thephp response
php php php php php php*php php@varphp Zendphp_Controllerphp_Responsephp_Abstract
php php php php php php*php/
php php php php protectedphp php$php_responsephp php=php nullphp;

php php php php php/php*php*
php php php php php php*php Viewphp scriptphp suffixphp;php defaultsphp tophp php'phtmlphp'
php php php php php php*php php@seephp php{renderphp(php)php}
php php php php php php*php php@varphp string
php php php php php php*php/
php php php php publicphp php$viewSuffixphp php=php php'phtmlphp'php;

php php php php php/php*php*
php php php php php php*php Viewphp object
php php php php php php*php php@varphp Zendphp_Viewphp_Interface
php php php php php php*php/
php php php php publicphp php$viewphp;

php php php php php/php*php*
php php php php php php*php Helperphp Brokerphp tophp assistphp inphp routingphp helpphp requestsphp tophp thephp properphp object
php php php php php php*
php php php php php php*php php@varphp Zendphp_Controllerphp_Actionphp_HelperBroker
php php php php php php*php/
php php php php protectedphp php$php_helperphp php=php nullphp;

php php php php php/php*php*
php php php php php php*php Classphp constructor
php php php php php php*
php php php php php php*php Thephp requestphp andphp responsephp objectsphp shouldphp bephp registeredphp withphp the
php php php php php php*php controllerphp,php asphp shouldphp bephp anyphp additionalphp optionalphp argumentsphp;php thesephp willphp be
php php php php php php*php availablephp viaphp php{php@linkphp getRequestphp(php)php}php,php php{php@linkphp getResponsephp(php)php}php,php and
php php php php php php*php php{php@linkphp getInvokeArgsphp(php)php}php,php respectivelyphp.
php php php php php php*
php php php php php php*php Whenphp overridingphp thephp constructorphp,php pleasephp considerphp thisphp usagephp asphp aphp best
php php php php php php*php practicephp andphp ensurephp thatphp eachphp isphp registeredphp appropriatelyphp;php thephp easiest
php php php php php php*php wayphp tophp dophp sophp isphp tophp simplyphp callphp parentphp:php:php_php_constructphp(php$requestphp,php php$responsephp,
php php php php php php*php php$invokeArgsphp)php.
php php php php php php*
php php php php php php*php Afterphp thephp requestphp,php responsephp,php andphp invokeArgsphp arephp setphp,php the
php php php php php php*php php{php@linkphp php$php_helperphp helperphp brokerphp}php isphp initializedphp.
php php php php php php*
php php php php php php*php Finallyphp,php php{php@linkphp initphp(php)php}php isphp calledphp asphp thephp finalphp actionphp of
php php php php php php*php instantiationphp,php andphp mayphp bephp safelyphp overriddenphp tophp performphp initialization
php php php php php php*php tasksphp;php asphp aphp generalphp rulephp,php overridephp php{php@linkphp initphp(php)php}php insteadphp ofphp the
php php php php php php*php constructorphp tophp customizephp anphp actionphp controllerphp'sphp instantiationphp.
php php php php php php*
php php php php php php*php php@paramphp Zendphp_Controllerphp_Requestphp_Abstractphp php$request
php php php php php php*php php@paramphp Zendphp_Controllerphp_Responsephp_Abstractphp php$response
php php php php php php*php php@paramphp arrayphp php$invokeArgsphp Anyphp additionalphp invocationphp arguments
php php php php php php*php php@returnphp void
php php php php php php*php/
php php php php publicphp functionphp php_php_constructphp(Zendphp_Controllerphp_Requestphp_Abstractphp php$requestphp,php Zendphp_Controllerphp_Responsephp_Abstractphp php$responsephp,php arrayphp php$invokeArgsphp php=php arrayphp(php)php)
php php php php php{
php php php php php php php php php$thisphp-php>setRequestphp(php$requestphp)
php php php php php php php php php php php php php php-php>setResponsephp(php$responsephp)
php php php php php php php php php php php php php php-php>php_setInvokeArgsphp(php$invokeArgsphp)php;
php php php php php php php php php$thisphp-php>php_helperphp php=php newphp Zendphp_Controllerphp_Actionphp_HelperBrokerphp(php$thisphp)php;
php php php php php php php php php$thisphp-php>initphp(php)php;
php php php php php}

php php php php php/php*php*
php php php php php php*php Initializephp object
php php php php php php*
php php php php php php*php Calledphp fromphp php{php@linkphp php_php_constructphp(php)php}php asphp finalphp stepphp ofphp objectphp instantiationphp.
php php php php php php*
php php php php php php*php php@returnphp void
php php php php php php*php/
php php php php publicphp functionphp initphp(php)
php php php php php{
php php php php php}

php php php php php/php*php*
php php php php php php*php Initializephp Viewphp object
php php php php php php*
php php php php php php*php Initializesphp php{php@linkphp php$viewphp}php ifphp notphp otherwisephp aphp Zendphp_Viewphp_Interfacephp.
php php php php php php*
php php php php php php*php Ifphp php{php@linkphp php$viewphp}php isphp notphp otherwisephp setphp,php instantiatesphp aphp newphp Zendphp_View
php php php php php php*php objectphp,php usingphp thephp php'viewsphp'php subdirectoryphp atphp thephp samephp levelphp asphp the
php php php php php php*php controllerphp directoryphp forphp thephp currentphp modulephp asphp thephp basephp directoryphp.
php php php php php php*php Itphp usesphp thisphp tophp setphp thephp followingphp:
php php php php php php*php php-php scriptphp pathphp php=php viewsphp/scriptsphp/
php php php php php php*php php-php helperphp pathphp php=php viewsphp/helpersphp/
php php php php php php*php php-php filterphp pathphp php=php viewsphp/filtersphp/
php php php php php php*
php php php php php php*php php@returnphp Zendphp_Viewphp_Interface
php php php php php php*php php@throwsphp Zendphp_Controllerphp_Exceptionphp ifphp basephp viewphp directoryphp doesphp notphp exist
php php php php php php*php/
php php php php publicphp functionphp initViewphp(php)
php php php php php{
php php php php php php php php ifphp php(php!php$thisphp-php>getInvokeArgphp(php'noViewRendererphp'php)php php&php&php php$thisphp-php>php_helperphp-php>hasHelperphp(php'viewRendererphp'php)php)php php{
php php php php php php php php php php php php returnphp php$thisphp-php>viewphp;
php php php php php php php php php}

php php php php php php php php requirephp_oncephp php'Zendphp/Viewphp/Interfacephp.phpphp'php;
php php php php php php php php ifphp php(issetphp(php$thisphp-php>viewphp)php php&php&php php(php$thisphp-php>viewphp instanceofphp Zendphp_Viewphp_Interfacephp)php)php php{
php php php php php php php php php php php php returnphp php$thisphp-php>viewphp;
php php php php php php php php php}

php php php php php php php php php$requestphp php=php php$thisphp-php>getRequestphp(php)php;
php php php php php php php php php$modulephp php php=php php$requestphp-php>getModuleNamephp(php)php;
php php php php php php php php php$dirsphp php php php php=php php$thisphp-php>getFrontControllerphp(php)php-php>getControllerDirectoryphp(php)php;
php php php php php php php php ifphp php(emptyphp(php$modulephp)php php|php|php php!issetphp(php$dirsphp[php$modulephp]php)php)php php{
php php php php php php php php php php php php php$modulephp php=php php$thisphp-php>getFrontControllerphp(php)php-php>getDispatcherphp(php)php-php>getDefaultModulephp(php)php;
php php php php php php php php php}
php php php php php php php php php$baseDirphp php=php dirnamephp(php$dirsphp[php$modulephp]php)php php.php DIRECTORYphp_SEPARATORphp php.php php'viewsphp'php;
php php php php php php php php ifphp php(php!filephp_existsphp(php$baseDirphp)php php|php|php php!isphp_dirphp(php$baseDirphp)php)php php{
php php php php php php php php php php php php requirephp_oncephp php'Zendphp/Controllerphp/Exceptionphp.phpphp'php;
php php php php php php php php php php php php throwphp newphp Zendphp_Controllerphp_Exceptionphp(php'Missingphp basephp viewphp directoryphp php(php"php'php php.php php$baseDirphp php.php php'php"php)php'php)php;
php php php php php php php php php}

php php php php php php php php requirephp_oncephp php'Zendphp/Viewphp.phpphp'php;
php php php php php php php php php$thisphp-php>viewphp php=php newphp Zendphp_Viewphp(arrayphp(php'basePathphp'php php=php>php php$baseDirphp)php)php;

php php php php php php php php returnphp php$thisphp-php>viewphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Renderphp aphp view
php php php php php php*
php php php php php php*php Rendersphp aphp viewphp.php Byphp defaultphp,php viewsphp arephp foundphp inphp thephp viewphp scriptphp pathphp as
php php php php php php*php php<controllerphp>php/php<actionphp>php.phtmlphp.php Youphp mayphp changephp thephp scriptphp suffixphp by
php php php php php php*php resettingphp php{php@linkphp php$viewSuffixphp}php.php Youphp mayphp omitphp thephp controllerphp directory
php php php php php php*php prefixphp byphp specifyingphp booleanphp truephp forphp php$noControllerphp.
php php php php php php*
php php php php php php*php Byphp defaultphp,php thephp renderedphp contentsphp arephp appendedphp tophp thephp responsephp.php Youphp may
php php php php php php*php specifyphp thephp namedphp bodyphp contentphp segmentphp tophp setphp byphp specifyingphp aphp php$namephp.
php php php php php php*
php php php php php php*php php@seephp Zendphp_Controllerphp_Responsephp_Abstractphp:php:appendBodyphp(php)
php php php php php php*php php@paramphp php stringphp|nullphp php$actionphp Defaultsphp tophp actionphp registeredphp inphp requestphp object
php php php php php php*php php@paramphp php stringphp|nullphp php$namephp Responsephp objectphp namedphp pathphp segmentphp tophp usephp;php defaultsphp tophp null
php php php php php php*php php@paramphp php boolphp php$noControllerphp php Defaultsphp tophp falsephp;php iphp.ephp.php usephp controllerphp namephp asphp subdirphp inphp whichphp tophp searchphp forphp viewphp script
php php php php php php*php php@returnphp void
php php php php php php*php/
php php php php publicphp functionphp renderphp(php$actionphp php=php nullphp,php php$namephp php=php nullphp,php php$noControllerphp php=php falsephp)
php php php php php{
php php php php php php php php ifphp php(php!php$thisphp-php>getInvokeArgphp(php'noViewRendererphp'php)php php&php&php php$thisphp-php>php_helperphp-php>hasHelperphp(php'viewRendererphp'php)php)php php{
php php php php php php php php php php php php returnphp php$thisphp-php>php_helperphp-php>viewRendererphp-php>renderphp(php$actionphp,php php$namephp,php php$noControllerphp)php;
php php php php php php php php php}

php php php php php php php php php$viewphp php php php=php php$thisphp-php>initViewphp(php)php;
php php php php php php php php php$scriptphp php=php php$thisphp-php>getViewScriptphp(php$actionphp,php php$noControllerphp)php;

php php php php php php php php php$thisphp-php>getResponsephp(php)php-php>appendBodyphp(
php php php php php php php php php php php php php$viewphp-php>renderphp(php$scriptphp)php,
php php php php php php php php php php php php php$name
php php php php php php php php php)php;
php php php php php}

php php php php php/php*php*
php php php php php php*php Renderphp aphp givenphp viewphp script
php php php php php php*
php php php php php php*php Similarphp tophp php{php@linkphp renderphp(php)php}php,php thisphp methodphp rendersphp aphp viewphp scriptphp.php Unlikephp renderphp(php)php,
php php php php php php*php howeverphp,php itphp doesphp notphp autodeterminephp thephp viewphp scriptphp viaphp php{php@linkphp getViewScriptphp(php)php}php,
php php php php php php*php butphp insteadphp rendersphp thephp scriptphp passedphp tophp itphp.php Usephp thisphp ifphp youphp knowphp the
php php php php php php*php exactphp viewphp scriptphp namephp andphp pathphp youphp wishphp tophp usephp,php orphp ifphp usingphp pathsphp thatphp dophp not
php php php php php php*php conformphp tophp thephp specphp definedphp withphp getViewScriptphp(php)php.
php php php php php php*
php php php php php php*php Byphp defaultphp,php thephp renderedphp contentsphp arephp appendedphp tophp thephp responsephp.php Youphp may
php php php php php php*php specifyphp thephp namedphp bodyphp contentphp segmentphp tophp setphp byphp specifyingphp aphp php$namephp.
php php php php php php*
php php php php php php*php php@paramphp php stringphp php$script
php php php php php php*php php@paramphp php stringphp php$name
php php php php php php*php php@returnphp void
php php php php php php*php/
php php php php publicphp functionphp renderScriptphp(php$scriptphp,php php$namephp php=php nullphp)
php php php php php{
php php php php php php php php ifphp php(php!php$thisphp-php>getInvokeArgphp(php'noViewRendererphp'php)php php&php&php php$thisphp-php>php_helperphp-php>hasHelperphp(php'viewRendererphp'php)php)php php{
php php php php php php php php php php php php returnphp php$thisphp-php>php_helperphp-php>viewRendererphp-php>renderScriptphp(php$scriptphp,php php$namephp)php;
php php php php php php php php php}

php php php php php php php php php$viewphp php=php php$thisphp-php>initViewphp(php)php;
php php php php php php php php php$thisphp-php>getResponsephp(php)php-php>appendBodyphp(
php php php php php php php php php php php php php$viewphp-php>renderphp(php$scriptphp)php,
php php php php php php php php php php php php php$name
php php php php php php php php php)php;
php php php php php}

php php php php php/php*php*
php php php php php php*php Constructphp viewphp scriptphp path
php php php php php php*
php php php php php php*php Usedphp byphp renderphp(php)php tophp determinephp thephp pathphp tophp thephp viewphp scriptphp.
php php php php php php*
php php php php php php*php php@paramphp php stringphp php$actionphp Defaultsphp tophp actionphp registeredphp inphp requestphp object
php php php php php php*php php@paramphp php boolphp php$noControllerphp php Defaultsphp tophp falsephp;php iphp.ephp.php usephp controllerphp namephp asphp subdirphp inphp whichphp tophp searchphp forphp viewphp script
php php php php php php*php php@returnphp string
php php php php php php*php php@throwsphp Zendphp_Controllerphp_Exceptionphp withphp badphp php$action
php php php php php php*php/
php php php php publicphp functionphp getViewScriptphp(php$actionphp php=php nullphp,php php$noControllerphp php=php nullphp)
php php php php php{
php php php php php php php php ifphp php(php!php$thisphp-php>getInvokeArgphp(php'noViewRendererphp'php)php php&php&php php$thisphp-php>php_helperphp-php>hasHelperphp(php'viewRendererphp'php)php)php php{
php php php php php php php php php php php php php$viewRendererphp php=php php$thisphp-php>php_helperphp-php>getHelperphp(php'viewRendererphp'php)php;
php php php php php php php php php php php php ifphp php(nullphp php!php=php=php php$noControllerphp)php php{
php php php php php php php php php php php php php php php php php$viewRendererphp-php>setNoControllerphp(php$noControllerphp)php;
php php php php php php php php php php php php php}
php php php php php php php php php php php php returnphp php$viewRendererphp-php>getViewScriptphp(php$actionphp)php;
php php php php php php php php php}

php php php php php php php php php$requestphp php=php php$thisphp-php>getRequestphp(php)php;
php php php php php php php php ifphp php(nullphp php=php=php=php php$actionphp)php php{
php php php php php php php php php php php php php$actionphp php=php php$requestphp-php>getActionNamephp(php)php;
php php php php php php php php php}php elseifphp php(php!isphp_stringphp(php$actionphp)php)php php{
php php php php php php php php php php php php requirephp_oncephp php'Zendphp/Controllerphp/Exceptionphp.phpphp'php;
php php php php php php php php php php php php throwphp newphp Zendphp_Controllerphp_Exceptionphp(php'Invalidphp actionphp specifierphp forphp viewphp renderphp'php)php;
php php php php php php php php php}

php php php php php php php php ifphp php(nullphp php=php=php=php php$thisphp-php>php_delimitersphp)php php{
php php php php php php php php php php php php php$dispatcherphp php=php Zendphp_Controllerphp_Frontphp:php:getInstancephp(php)php-php>getDispatcherphp(php)php;
php php php php php php php php php php php php php$wordDelimitersphp php=php php$dispatcherphp-php>getWordDelimiterphp(php)php;
php php php php php php php php php php php php php$pathDelimitersphp php=php php$dispatcherphp-php>getPathDelimiterphp(php)php;
php php php php php php php php php php php php php$thisphp-php>php_delimitersphp php=php arrayphp_uniquephp(arrayphp_mergephp(php$wordDelimitersphp,php php(arrayphp)php php$pathDelimitersphp)php)php;
php php php php php php php php php}

php php php php php php php php php$actionphp php=php strphp_replacephp(php$thisphp-php>php_delimitersphp,php php'php-php'php,php php$actionphp)php;
php php php php php php php php php$scriptphp php=php php$actionphp php.php php'php.php'php php.php php$thisphp-php>viewSuffixphp;

php php php php php php php php ifphp php(php!php$noControllerphp)php php{
php php php php php php php php php php php php php$controllerphp php=php php$requestphp-php>getControllerNamephp(php)php;
php php php php php php php php php php php php php$controllerphp php=php strphp_replacephp(php$thisphp-php>php_delimitersphp,php php'php-php'php,php php$controllerphp)php;
php php php php php php php php php php php php php$scriptphp php=php php$controllerphp php.php DIRECTORYphp_SEPARATORphp php.php php$scriptphp;
php php php php php php php php php}

php php php php php php php php returnphp php$scriptphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Returnphp thephp Requestphp object
php php php php php php*
php php php php php php*php php@returnphp Zendphp_Controllerphp_Requestphp_Abstract
php php php php php php*php/
php php php php publicphp functionphp getRequestphp(php)
php php php php php{
php php php php php php php php returnphp php$thisphp-php>php_requestphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Setphp thephp Requestphp object
php php php php php php*
php php php php php php*php php@paramphp Zendphp_Controllerphp_Requestphp_Abstractphp php$request
php php php php php php*php php@returnphp Zendphp_Controllerphp_Action
php php php php php php*php/
php php php php publicphp functionphp setRequestphp(Zendphp_Controllerphp_Requestphp_Abstractphp php$requestphp)
php php php php php{
php php php php php php php php php$thisphp-php>php_requestphp php=php php$requestphp;
php php php php php php php php returnphp php$thisphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Returnphp thephp Responsephp object
php php php php php php*
php php php php php php*php php@returnphp Zendphp_Controllerphp_Responsephp_Abstract
php php php php php php*php/
php php php php publicphp functionphp getResponsephp(php)
php php php php php{
php php php php php php php php returnphp php$thisphp-php>php_responsephp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Setphp thephp Responsephp object
php php php php php php*
php php php php php php*php php@paramphp Zendphp_Controllerphp_Responsephp_Abstractphp php$response
php php php php php php*php php@returnphp Zendphp_Controllerphp_Action
php php php php php php*php/
php php php php publicphp functionphp setResponsephp(Zendphp_Controllerphp_Responsephp_Abstractphp php$responsephp)
php php php php php{
php php php php php php php php php$thisphp-php>php_responsephp php=php php$responsephp;
php php php php php php php php returnphp php$thisphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Setphp invocationphp arguments
php php php php php php*
php php php php php php*php php@paramphp arrayphp php$args
php php php php php php*php php@returnphp Zendphp_Controllerphp_Action
php php php php php php*php/
php php php php protectedphp functionphp php_setInvokeArgsphp(arrayphp php$argsphp php=php arrayphp(php)php)
php php php php php{
php php php php php php php php php$thisphp-php>php_invokeArgsphp php=php php$argsphp;
php php php php php php php php returnphp php$thisphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Returnphp thephp arrayphp ofphp constructorphp argumentsphp php(minusphp thephp Requestphp objectphp)
php php php php php php*
php php php php php php*php php@returnphp array
php php php php php php*php/
php php php php publicphp functionphp getInvokeArgsphp(php)
php php php php php{
php php php php php php php php returnphp php$thisphp-php>php_invokeArgsphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Returnphp aphp singlephp invocationphp argument
php php php php php php*
php php php php php php*php php@paramphp stringphp php$key
php php php php php php*php php@returnphp mixed
php php php php php php*php/
php php php php publicphp functionphp getInvokeArgphp(php$keyphp)
php php php php php{
php php php php php php php php ifphp php(issetphp(php$thisphp-php>php_invokeArgsphp[php$keyphp]php)php)php php{
php php php php php php php php php php php php returnphp php$thisphp-php>php_invokeArgsphp[php$keyphp]php;
php php php php php php php php php}

php php php php php php php php returnphp nullphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Getphp aphp helperphp byphp name
php php php php php php*
php php php php php php*php php@paramphp php stringphp php$helperName
php php php php php php*php php@returnphp Zendphp_Controllerphp_Actionphp_Helperphp_Abstract
php php php php php php*php/
php php php php publicphp functionphp getHelperphp(php$helperNamephp)
php php php php php{
php php php php php php php php returnphp php$thisphp-php>php_helperphp-php>php{php$helperNamephp}php;
php php php php php}

php php php php php/php*php*
php php php php php php*php Getphp aphp clonephp ofphp aphp helperphp byphp name
php php php php php php*
php php php php php php*php php@paramphp php stringphp php$helperName
php php php php php php*php php@returnphp Zendphp_Controllerphp_Actionphp_Helperphp_Abstract
php php php php php php*php/
php php php php publicphp functionphp getHelperCopyphp(php$helperNamephp)
php php php php php{
php php php php php php php php returnphp clonephp php$thisphp-php>php_helperphp-php>php{php$helperNamephp}php;
php php php php php}

php php php php php/php*php*
php php php php php php*php Setphp thephp frontphp controllerphp instance
php php php php php php*
php php php php php php*php php@paramphp Zendphp_Controllerphp_Frontphp php$front
php php php php php php*php php@returnphp Zendphp_Controllerphp_Action
php php php php php php*php/
php php php php publicphp functionphp setFrontControllerphp(Zendphp_Controllerphp_Frontphp php$frontphp)
php php php php php{
php php php php php php php php php$thisphp-php>php_frontControllerphp php=php php$frontphp;
php php php php php php php php returnphp php$thisphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Retrievephp Frontphp Controller
php php php php php php*
php php php php php php*php php@returnphp Zendphp_Controllerphp_Front
php php php php php php*php/
php php php php publicphp functionphp getFrontControllerphp(php)
php php php php php{
php php php php php php php php php/php/php Usedphp cachephp versionphp ifphp found
php php php php php php php php ifphp php(nullphp php!php=php=php php$thisphp-php>php_frontControllerphp)php php{
php php php php php php php php php php php php returnphp php$thisphp-php>php_frontControllerphp;
php php php php php php php php php}

php php php php php php php php php/php/php Grabphp singletonphp instancephp,php ifphp classphp hasphp beenphp loaded
php php php php php php php php ifphp php(classphp_existsphp(php'Zendphp_Controllerphp_Frontphp'php)php)php php{
php php php php php php php php php php php php php$thisphp-php>php_frontControllerphp php=php Zendphp_Controllerphp_Frontphp:php:getInstancephp(php)php;
php php php php php php php php php php php php returnphp php$thisphp-php>php_frontControllerphp;
php php php php php php php php php}

php php php php php php php php php/php/php Throwphp exceptionphp inphp allphp otherphp cases
php php php php php php php php requirephp_oncephp php'Zendphp/Controllerphp/Exceptionphp.phpphp'php;
php php php php php php php php throwphp newphp Zendphp_Controllerphp_Exceptionphp(php'Frontphp controllerphp classphp hasphp notphp beenphp loadedphp'php)php;
php php php php php}

php php php php php/php*php*
php php php php php php*php Prephp-dispatchphp routines
php php php php php php*
php php php php php php*php Calledphp beforephp actionphp methodphp.php Ifphp usingphp classphp with
php php php php php php*php php{php@linkphp Zendphp_Controllerphp_Frontphp}php,php itphp mayphp modifyphp the
php php php php php php*php php{php@linkphp php$php_requestphp Requestphp objectphp}php andphp resetphp itsphp dispatchedphp flagphp inphp order
php php php php php php*php tophp skipphp processingphp thephp currentphp actionphp.
php php php php php php*
php php php php php php*php php@returnphp void
php php php php php php*php/
php php php php publicphp functionphp preDispatchphp(php)
php php php php php{
php php php php php}

php php php php php/php*php*
php php php php php php*php Postphp-dispatchphp routines
php php php php php php*
php php php php php php*php Calledphp afterphp actionphp methodphp executionphp.php Ifphp usingphp classphp with
php php php php php php*php php{php@linkphp Zendphp_Controllerphp_Frontphp}php,php itphp mayphp modifyphp the
php php php php php php*php php{php@linkphp php$php_requestphp Requestphp objectphp}php andphp resetphp itsphp dispatchedphp flagphp inphp order
php php php php php php*php tophp processphp anphp additionalphp actionphp.
php php php php php php*
php php php php php php*php Commonphp usagesphp forphp postDispatchphp(php)php includephp renderingphp contentphp inphp aphp sitewide
php php php php php php*php templatephp,php linkphp urlphp correctionphp,php settingphp headersphp,php etcphp.
php php php php php php*
php php php php php php*php php@returnphp void
php php php php php php*php/
php php php php publicphp functionphp postDispatchphp(php)
php php php php php{
php php php php php}

php php php php php/php*php*
php php php php php php*php Proxyphp forphp undefinedphp methodsphp.php php Defaultphp behaviorphp isphp tophp throwphp an
php php php php php php*php exceptionphp onphp undefinedphp methodsphp,php howeverphp thisphp functionphp canphp be
php php php php php php*php overriddenphp tophp implementphp magicphp php(dynamicphp)php actionsphp,php orphp providephp runphp-time
php php php php php php*php dispatchingphp.
php php php php php php*
php php php php php php*php php@paramphp php stringphp php$methodName
php php php php php php*php php@paramphp php arrayphp php$args
php php php php php php*php php@returnphp void
php php php php php php*php php@throwsphp Zendphp_Controllerphp_Actionphp_Exception
php php php php php php*php/
php php php php publicphp functionphp php_php_callphp(php$methodNamephp,php php$argsphp)
php php php php php{
php php php php php php php php requirephp_oncephp php'Zendphp/Controllerphp/Actionphp/Exceptionphp.phpphp'php;
php php php php php php php php ifphp php(php'Actionphp'php php=php=php substrphp(php$methodNamephp,php php-php6php)php)php php{
php php php php php php php php php php php php php$actionphp php=php substrphp(php$methodNamephp,php php0php,php strlenphp(php$methodNamephp)php php-php php6php)php;
php php php php php php php php php php php php throwphp newphp Zendphp_Controllerphp_Actionphp_Exceptionphp(sprintfphp(php'Actionphp php"php%sphp"php doesphp notphp existphp andphp wasphp notphp trappedphp inphp php_php_callphp(php)php'php,php php$actionphp)php,php php4php0php4php)php;
php php php php php php php php php}

php php php php php php php php throwphp newphp Zendphp_Controllerphp_Actionphp_Exceptionphp(sprintfphp(php'Methodphp php"php%sphp"php doesphp notphp existphp andphp wasphp notphp trappedphp inphp php_php_callphp(php)php'php,php php$methodNamephp)php,php php5php0php0php)php;
php php php php php}

php php php php php/php*php*
php php php php php php*php Dispatchphp thephp requestedphp action
php php php php php php*
php php php php php php*php php@paramphp stringphp php$actionphp Methodphp namephp ofphp action
php php php php php php*php php@returnphp void
php php php php php php*php/
php php php php publicphp functionphp dispatchphp(php$actionphp)
php php php php php{
php php php php php php php php php/php/php Notifyphp helpersphp ofphp actionphp preDispatchphp state
php php php php php php php php php$thisphp-php>php_helperphp-php>notifyPreDispatchphp(php)php;

php php php php php php php php php$thisphp-php>preDispatchphp(php)php;
php php php php php php php php ifphp php(php$thisphp-php>getRequestphp(php)php-php>isDispatchedphp(php)php)php php{
php php php php php php php php php php php php ifphp php(nullphp php=php=php=php php$thisphp-php>php_classMethodsphp)php php{
php php php php php php php php php php php php php php php php php$thisphp-php>php_classMethodsphp php=php getphp_classphp_methodsphp(php$thisphp)php;
php php php php php php php php php php php php php}

php php php php php php php php php php php php php/php/php preDispatchphp(php)php didnphp'tphp changephp thephp actionphp,php sophp wephp canphp continue
php php php php php php php php php php php php ifphp php(php$thisphp-php>getInvokeArgphp(php'useCaseSensitiveActionsphp'php)php php|php|php inphp_arrayphp(php$actionphp,php php$thisphp-php>php_classMethodsphp)php)php php{
php php php php php php php php php php php php php php php php ifphp php(php$thisphp-php>getInvokeArgphp(php'useCaseSensitiveActionsphp'php)php)php php{
php php php php php php php php php php php php php php php php php php php php triggerphp_errorphp(php'Usingphp casephp sensitivephp actionsphp withoutphp wordphp separatorsphp isphp deprecatedphp;php pleasephp dophp notphp relyphp onphp thisphp php"featurephp"php'php)php;
php php php php php php php php php php php php php php php php php}
php php php php php php php php php php php php php php php php php$thisphp-php>php$actionphp(php)php;
php php php php php php php php php php php php php}php elsephp php{
php php php php php php php php php php php php php php php php php$thisphp-php>php_php_callphp(php$actionphp,php arrayphp(php)php)php;
php php php php php php php php php php php php php}
php php php php php php php php php php php php php$thisphp-php>postDispatchphp(php)php;
php php php php php php php php php}

php php php php php php php php php/php/php whatsphp actuallyphp importantphp herephp isphp thatphp thisphp actionphp controllerphp is
php php php php php php php php php/php/php shuttingphp downphp,php regardlessphp ofphp dispatchingphp;php notifyphp thephp helpersphp ofphp this
php php php php php php php php php/php/php state
php php php php php php php php php$thisphp-php>php_helperphp-php>notifyPostDispatchphp(php)php;
php php php php php}

php php php php php/php*php*
php php php php php php*php Callphp thephp actionphp specifiedphp inphp thephp requestphp objectphp,php andphp returnphp aphp response
php php php php php php*
php php php php php php*php Notphp usedphp inphp thephp Actionphp Controllerphp implementationphp,php butphp leftphp forphp usagephp in
php php php php php php*php Pagephp Controllerphp implementationsphp.php Dispatchesphp aphp methodphp basedphp onphp the
php php php php php php*php requestphp.
php php php php php php*
php php php php php php*php Returnsphp aphp Zendphp_Controllerphp_Responsephp_Abstractphp objectphp,php instantiatingphp one
php php php php php php*php priorphp tophp executionphp ifphp nonephp existsphp inphp thephp controllerphp.
php php php php php php*
php php php php php php*php php{php@linkphp preDispatchphp(php)php}php isphp calledphp priorphp tophp thephp actionphp,
php php php php php php*php php{php@linkphp postDispatchphp(php)php}php isphp calledphp followingphp itphp.
php php php php php php*
php php php php php php*php php@paramphp nullphp|Zendphp_Controllerphp_Requestphp_Abstractphp php$requestphp Optionalphp request
php php php php php php*php objectphp tophp use
php php php php php php*php php@paramphp nullphp|Zendphp_Controllerphp_Responsephp_Abstractphp php$responsephp Optionalphp response
php php php php php php*php objectphp tophp use
php php php php php php*php php@returnphp Zendphp_Controllerphp_Responsephp_Abstract
php php php php php php*php/
php php php php publicphp functionphp runphp(Zendphp_Controllerphp_Requestphp_Abstractphp php$requestphp php=php nullphp,php Zendphp_Controllerphp_Responsephp_Abstractphp php$responsephp php=php nullphp)
php php php php php{
php php php php php php php php ifphp php(nullphp php!php=php=php php$requestphp)php php{
php php php php php php php php php php php php php$thisphp-php>setRequestphp(php$requestphp)php;
php php php php php php php php php}php elsephp php{
php php php php php php php php php php php php php$requestphp php=php php$thisphp-php>getRequestphp(php)php;
php php php php php php php php php}

php php php php php php php php ifphp php(nullphp php!php=php=php php$responsephp)php php{
php php php php php php php php php php php php php$thisphp-php>setResponsephp(php$responsephp)php;
php php php php php php php php php}

php php php php php php php php php$actionphp php=php php$requestphp-php>getActionNamephp(php)php;
php php php php php php php php ifphp php(emptyphp(php$actionphp)php)php php{
php php php php php php php php php php php php php$actionphp php=php php'indexphp'php;
php php php php php php php php php}
php php php php php php php php php$actionphp php=php php$actionphp php.php php'Actionphp'php;

php php php php php php php php php$requestphp-php>setDispatchedphp(truephp)php;
php php php php php php php php php$thisphp-php>dispatchphp(php$actionphp)php;

php php php php php php php php returnphp php$thisphp-php>getResponsephp(php)php;
php php php php php}

php php php php php/php*php*
php php php php php php*php Getsphp aphp parameterphp fromphp thephp php{php@linkphp php$php_requestphp Requestphp objectphp}php.php php Ifphp the
php php php php php php*php parameterphp doesphp notphp existphp,php NULLphp willphp bephp returnedphp.
php php php php php php*
php php php php php php*php Ifphp thephp parameterphp doesphp notphp existphp andphp php$defaultphp isphp setphp,php then
php php php php php php*php php$defaultphp willphp bephp returnedphp insteadphp ofphp NULLphp.
php php php php php php*
php php php php php php*php php@paramphp stringphp php$paramName
php php php php php php*php php@paramphp mixedphp php$default
php php php php php php*php php@returnphp mixed
php php php php php php*php/
php php php php protectedphp functionphp php_getParamphp(php$paramNamephp,php php$defaultphp php=php nullphp)
php php php php php{
php php php php php php php php php$valuephp php=php php$thisphp-php>getRequestphp(php)php-php>getParamphp(php$paramNamephp)php;
php php php php php php php php php ifphp php(php(nullphp php=php=php=php php$valuephp php|php|php php'php'php php=php=php=php php$valuephp)php php&php&php php(nullphp php!php=php=php php$defaultphp)php)php php{
php php php php php php php php php php php php php$valuephp php=php php$defaultphp;
php php php php php php php php php}

php php php php php php php php returnphp php$valuephp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Setphp aphp parameterphp inphp thephp php{php@linkphp php$php_requestphp Requestphp objectphp}php.
php php php php php php*
php php php php php php*php php@paramphp stringphp php$paramName
php php php php php php*php php@paramphp mixedphp php$value
php php php php php php*php php@returnphp Zendphp_Controllerphp_Action
php php php php php php*php/
php php php php protectedphp functionphp php_setParamphp(php$paramNamephp,php php$valuephp)
php php php php php{
php php php php php php php php php$thisphp-php>getRequestphp(php)php-php>setParamphp(php$paramNamephp,php php$valuephp)php;

php php php php php php php php returnphp php$thisphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Determinephp whetherphp aphp givenphp parameterphp existsphp inphp the
php php php php php php*php php{php@linkphp php$php_requestphp Requestphp objectphp}php.
php php php php php php*
php php php php php php*php php@paramphp stringphp php$paramName
php php php php php php*php php@returnphp boolean
php php php php php php*php/
php php php php protectedphp functionphp php_hasParamphp(php$paramNamephp)
php php php php php{
php php php php php php php php returnphp nullphp php!php=php=php php$thisphp-php>getRequestphp(php)php-php>getParamphp(php$paramNamephp)php;
php php php php php}

php php php php php/php*php*
php php php php php php*php Returnphp allphp parametersphp inphp thephp php{php@linkphp php$php_requestphp Requestphp objectphp}
php php php php php php*php asphp anphp associativephp arrayphp.
php php php php php php*
php php php php php php*php php@returnphp array
php php php php php php*php/
php php php php protectedphp functionphp php_getAllParamsphp(php)
php php php php php{
php php php php php php php php returnphp php$thisphp-php>getRequestphp(php)php-php>getParamsphp(php)php;
php php php php php}


php php php php php/php*php*
php php php php php php*php Forwardphp tophp anotherphp controllerphp/actionphp.
php php php php php php*
php php php php php php*php Itphp isphp importantphp tophp supplyphp thephp unformattedphp namesphp,php iphp.ephp.php php"articlephp"
php php php php php php*php ratherphp thanphp php"ArticleControllerphp"php.php php Thephp dispatcherphp willphp dophp the
php php php php php php*php appropriatephp formattingphp whenphp thephp requestphp isphp receivedphp.
php php php php php php*
php php php php php php*php Ifphp onlyphp anphp actionphp namephp isphp providedphp,php forwardsphp tophp thatphp actionphp inphp this
php php php php php php*php controllerphp.
php php php php php php*
php php php php php php*php Ifphp anphp actionphp andphp controllerphp arephp specifiedphp,php forwardsphp tophp thatphp actionphp and
php php php php php php*php controllerphp inphp thisphp modulephp.
php php php php php php*
php php php php php php*php Specifyingphp anphp actionphp,php controllerphp,php andphp modulephp isphp thephp mostphp specificphp wayphp to
php php php php php php*php forwardphp.
php php php php php php*
php php php php php php*php Aphp fourthphp argumentphp,php php$paramsphp,php willphp bephp usedphp tophp setphp thephp requestphp parametersphp.
php php php php php php*php Ifphp eitherphp thephp controllerphp orphp modulephp arephp unnecessaryphp forphp forwardingphp,
php php php php php php*php simplyphp passphp nullphp valuesphp forphp themphp beforephp specifyingphp thephp parametersphp.
php php php php php php*
php php php php php php*php php@paramphp stringphp php$action
php php php php php php*php php@paramphp stringphp php$controller
php php php php php php*php php@paramphp stringphp php$module
php php php php php php*php php@paramphp arrayphp php$params
php php php php php php*php php@returnphp void
php php php php php php*php/
php php php php finalphp protectedphp functionphp php_forwardphp(php$actionphp,php php$controllerphp php=php nullphp,php php$modulephp php=php nullphp,php arrayphp php$paramsphp php=php nullphp)
php php php php php{
php php php php php php php php php$requestphp php=php php$thisphp-php>getRequestphp(php)php;

php php php php php php php php ifphp php(nullphp php!php=php=php php$paramsphp)php php{
php php php php php php php php php php php php php$requestphp-php>setParamsphp(php$paramsphp)php;
php php php php php php php php php}

php php php php php php php php ifphp php(nullphp php!php=php=php php$controllerphp)php php{
php php php php php php php php php php php php php$requestphp-php>setControllerNamephp(php$controllerphp)php;

php php php php php php php php php php php php php/php/php Modulephp shouldphp onlyphp bephp resetphp ifphp controllerphp hasphp beenphp specified
php php php php php php php php php php php php ifphp php(nullphp php!php=php=php php$modulephp)php php{
php php php php php php php php php php php php php php php php php$requestphp-php>setModuleNamephp(php$modulephp)php;
php php php php php php php php php php php php php}
php php php php php php php php php}

php php php php php php php php php$requestphp-php>setActionNamephp(php$actionphp)
php php php php php php php php php php php php php php php php php-php>setDispatchedphp(falsephp)php;
php php php php php}

php php php php php/php*php*
php php php php php php*php Redirectphp tophp anotherphp URL
php php php php php php*
php php php php php php*php Proxiesphp tophp php{php@linkphp Zendphp_Controllerphp_Actionphp_Helperphp_Redirectorphp:php:gotoUrlphp(php)php}php.
php php php php php php*
php php php php php php*php php@paramphp stringphp php$url
php php php php php php*php php@paramphp arrayphp php$optionsphp Optionsphp tophp bephp usedphp whenphp redirecting
php php php php php php*php php@returnphp void
php php php php php php*php/
php php php php protectedphp functionphp php_redirectphp(php$urlphp,php arrayphp php$optionsphp php=php arrayphp(php)php)
php php php php php{
php php php php php php php php php$thisphp-php>php_helperphp-php>redirectorphp-php>gotoUrlphp(php$urlphp,php php$optionsphp)php;
php php php php php}
php}
