<php?php
php/php*php*
php php*php Zendphp Framework
php php*
php php*php LICENSE
php php*
php php*php Thisphp sourcephp filephp isphp subjectphp tophp thephp newphp BSDphp licensephp thatphp isphp bundled
php php*php withphp thisphp packagephp inphp thephp filephp LICENSEphp.txtphp.
php php*php Itphp isphp alsophp availablephp throughphp thephp worldphp-widephp-webphp atphp thisphp URLphp:
php php*php httpphp:php/php/frameworkphp.zendphp.comphp/licensephp/newphp-bsd
php php*php Ifphp youphp didphp notphp receivephp aphp copyphp ofphp thephp licensephp andphp arephp unablephp to
php php*php obtainphp itphp throughphp thephp worldphp-widephp-webphp,php pleasephp sendphp anphp email
php php*php tophp licensephp@zendphp.comphp sophp wephp canphp sendphp youphp aphp copyphp immediatelyphp.
php php*
php php*php php@categoryphp php php Zend
php php*php php@packagephp php php php Zendphp_Db
php php*php php@subpackagephp Select
php php*php php@copyrightphp php Copyrightphp php(cphp)php php2php0php0php5php-php2php0php1php0php Zendphp Technologiesphp USAphp Incphp.php php(httpphp:php/php/wwwphp.zendphp.comphp)
php php*php php@licensephp php php php httpphp:php/php/frameworkphp.zendphp.comphp/licensephp/newphp-bsdphp php php php php Newphp BSDphp License
php php*php php@versionphp php php php php$Idphp:php Selectphp.phpphp php2php3php5php1php6php php2php0php1php0php-php1php2php-php1php6php php1php3php:php2php6php:php1php1Zphp bittarmanphp php$
php php*php/


php/php*php*
php php*php php@seephp Zendphp_Dbphp_Adapterphp_Abstract
php php*php/
requirephp_oncephp php'Zendphp/Dbphp/Adapterphp/Abstractphp.phpphp'php;

php/php*php*
php php*php php@seephp Zendphp_Dbphp_Expr
php php*php/
requirephp_oncephp php'Zendphp/Dbphp/Exprphp.phpphp'php;


php/php*php*
php php*php Classphp forphp SQLphp SELECTphp generationphp andphp resultsphp.
php php*
php php*php php@categoryphp php php Zend
php php*php php@packagephp php php php Zendphp_Db
php php*php php@subpackagephp Select
php php*php php@copyrightphp php Copyrightphp php(cphp)php php2php0php0php5php-php2php0php1php0php Zendphp Technologiesphp USAphp Incphp.php php(httpphp:php/php/wwwphp.zendphp.comphp)
php php*php php@licensephp php php php httpphp:php/php/frameworkphp.zendphp.comphp/licensephp/newphp-bsdphp php php php php Newphp BSDphp License
php php*php/
classphp Zendphp_Dbphp_Select
php{

php php php php constphp DISTINCTphp php php php php php php php=php php'distinctphp'php;
php php php php constphp COLUMNSphp php php php php php php php php=php php'columnsphp'php;
php php php php constphp FROMphp php php php php php php php php php php php=php php'fromphp'php;
php php php php constphp UNIONphp php php php php php php php php php php=php php'unionphp'php;
php php php php constphp WHEREphp php php php php php php php php php php=php php'wherephp'php;
php php php php constphp GROUPphp php php php php php php php php php php=php php'groupphp'php;
php php php php constphp HAVINGphp php php php php php php php php php=php php'havingphp'php;
php php php php constphp ORDERphp php php php php php php php php php php=php php'orderphp'php;
php php php php constphp LIMITphp_COUNTphp php php php php=php php'limitcountphp'php;
php php php php constphp LIMITphp_OFFSETphp php php php=php php'limitoffsetphp'php;
php php php php constphp FORphp_UPDATEphp php php php php php=php php'forupdatephp'php;

php php php php constphp INNERphp_JOINphp php php php php php=php php'innerphp joinphp'php;
php php php php constphp LEFTphp_JOINphp php php php php php php=php php'leftphp joinphp'php;
php php php php constphp RIGHTphp_JOINphp php php php php php=php php'rightphp joinphp'php;
php php php php constphp FULLphp_JOINphp php php php php php php=php php'fullphp joinphp'php;
php php php php constphp CROSSphp_JOINphp php php php php php=php php'crossphp joinphp'php;
php php php php constphp NATURALphp_JOINphp php php php=php php'naturalphp joinphp'php;

php php php php constphp SQLphp_WILDCARDphp php php php=php php'php*php'php;
php php php php constphp SQLphp_SELECTphp php php php php php=php php'SELECTphp'php;
php php php php constphp SQLphp_UNIONphp php php php php php php=php php'UNIONphp'php;
php php php php constphp SQLphp_UNIONphp_ALLphp php php=php php'UNIONphp ALLphp'php;
php php php php constphp SQLphp_FROMphp php php php php php php php=php php'FROMphp'php;
php php php php constphp SQLphp_WHEREphp php php php php php php=php php'WHEREphp'php;
php php php php constphp SQLphp_DISTINCTphp php php php=php php'DISTINCTphp'php;
php php php php constphp SQLphp_GROUPphp_BYphp php php php=php php'GROUPphp BYphp'php;
php php php php constphp SQLphp_ORDERphp_BYphp php php php=php php'ORDERphp BYphp'php;
php php php php constphp SQLphp_HAVINGphp php php php php php=php php'HAVINGphp'php;
php php php php constphp SQLphp_FORphp_UPDATEphp php=php php'FORphp UPDATEphp'php;
php php php php constphp SQLphp_ANDphp php php php php php php php php=php php'ANDphp'php;
php php php php constphp SQLphp_ASphp php php php php php php php php php=php php'ASphp'php;
php php php php constphp SQLphp_ORphp php php php php php php php php php=php php'ORphp'php;
php php php php constphp SQLphp_ONphp php php php php php php php php php=php php'ONphp'php;
php php php php constphp SQLphp_ASCphp php php php php php php php php=php php'ASCphp'php;
php php php php constphp SQLphp_DESCphp php php php php php php php=php php'DESCphp'php;

php php php php php/php*php*
php php php php php php*php Bindphp variablesphp forphp query
php php php php php php*
php php php php php php*php php@varphp array
php php php php php php*php/
php php php php protectedphp php$php_bindphp php=php arrayphp(php)php;

php php php php php/php*php*
php php php php php php*php Zendphp_Dbphp_Adapterphp_Abstractphp objectphp.
php php php php php php*
php php php php php php*php php@varphp Zendphp_Dbphp_Adapterphp_Abstract
php php php php php php*php/
php php php php protectedphp php$php_adapterphp;

php php php php php/php*php*
php php php php php php*php Thephp initialphp valuesphp forphp thephp php$php_partsphp arrayphp.
php php php php php php*php NOTEphp:php Itphp isphp importantphp forphp thephp php'FORphp_UPDATEphp'php partphp tophp bephp lastphp tophp ensure
php php php php php php*php meximumphp compatibilityphp withphp databasephp adaptersphp.
php php php php php php*
php php php php php php*php php@varphp array
php php php php php php*php/
php php php php protectedphp staticphp php$php_partsInitphp php=php arrayphp(
php php php php php php php php selfphp:php:DISTINCTphp php php php php php=php>php falsephp,
php php php php php php php php selfphp:php:COLUMNSphp php php php php php php=php>php arrayphp(php)php,
php php php php php php php php selfphp:php:UNIONphp php php php php php php php php=php>php arrayphp(php)php,
php php php php php php php php selfphp:php:FROMphp php php php php php php php php php=php>php arrayphp(php)php,
php php php php php php php php selfphp:php:WHEREphp php php php php php php php php=php>php arrayphp(php)php,
php php php php php php php php selfphp:php:GROUPphp php php php php php php php php=php>php arrayphp(php)php,
php php php php php php php php selfphp:php:HAVINGphp php php php php php php php=php>php arrayphp(php)php,
php php php php php php php php selfphp:php:ORDERphp php php php php php php php php=php>php arrayphp(php)php,
php php php php php php php php selfphp:php:LIMITphp_COUNTphp php php=php>php nullphp,
php php php php php php php php selfphp:php:LIMITphp_OFFSETphp php=php>php nullphp,
php php php php php php php php selfphp:php:FORphp_UPDATEphp php php php=php>php false
php php php php php)php;

php php php php php/php*php*
php php php php php php*php Specifyphp legalphp joinphp typesphp.
php php php php php php*
php php php php php php*php php@varphp array
php php php php php php*php/
php php php php protectedphp staticphp php$php_joinTypesphp php=php arrayphp(
php php php php php php php php selfphp:php:INNERphp_JOINphp,
php php php php php php php php selfphp:php:LEFTphp_JOINphp,
php php php php php php php php selfphp:php:RIGHTphp_JOINphp,
php php php php php php php php selfphp:php:FULLphp_JOINphp,
php php php php php php php php selfphp:php:CROSSphp_JOINphp,
php php php php php php php php selfphp:php:NATURALphp_JOINphp,
php php php php php)php;

php php php php php/php*php*
php php php php php php*php Specifyphp legalphp unionphp typesphp.
php php php php php php*
php php php php php php*php php@varphp array
php php php php php php*php/
php php php php protectedphp staticphp php$php_unionTypesphp php=php arrayphp(
php php php php php php php php selfphp:php:SQLphp_UNIONphp,
php php php php php php php php selfphp:php:SQLphp_UNIONphp_ALL
php php php php php)php;

php php php php php/php*php*
php php php php php php*php Thephp componentphp partsphp ofphp aphp SELECTphp statementphp.
php php php php php php*php Initializedphp tophp thephp php$php_partsInitphp arrayphp inphp thephp constructorphp.
php php php php php php*
php php php php php php*php php@varphp array
php php php php php php*php/
php php php php protectedphp php$php_partsphp php=php arrayphp(php)php;

php php php php php/php*php*
php php php php php php*php Tracksphp whichphp columnsphp arephp beingphp selectphp fromphp eachphp tablephp andphp joinphp.
php php php php php php*
php php php php php php*php php@varphp array
php php php php php php*php/
php php php php protectedphp php$php_tableColsphp php=php arrayphp(php)php;

php php php php php/php*php*
php php php php php php*php Classphp constructor
php php php php php php*
php php php php php php*php php@paramphp Zendphp_Dbphp_Adapterphp_Abstractphp php$adapter
php php php php php php*php/
php php php php publicphp functionphp php_php_constructphp(Zendphp_Dbphp_Adapterphp_Abstractphp php$adapterphp)
php php php php php{
php php php php php php php php php$thisphp-php>php_adapterphp php=php php$adapterphp;
php php php php php php php php php$thisphp-php>php_partsphp php=php selfphp:php:php$php_partsInitphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Getphp bindphp variables
php php php php php php*
php php php php php php*php php@returnphp array
php php php php php php*php/
php php php php publicphp functionphp getBindphp(php)
php php php php php{
php php php php php php php php returnphp php$thisphp-php>php_bindphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Setphp bindphp variables
php php php php php php*
php php php php php php*php php@paramphp mixedphp php$bind
php php php php php php*php php@returnphp Zendphp_Dbphp_Select
php php php php php php*php/
php php php php publicphp functionphp bindphp(php$bindphp)
php php php php php{
php php php php php php php php php$thisphp-php>php_bindphp php=php php$bindphp;

php php php php php php php php returnphp php$thisphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Makesphp thephp queryphp SELECTphp DISTINCTphp.
php php php php php php*
php php php php php php*php php@paramphp boolphp php$flagphp Whetherphp orphp notphp thephp SELECTphp isphp DISTINCTphp php(defaultphp truephp)php.
php php php php php php*php php@returnphp Zendphp_Dbphp_Selectphp Thisphp Zendphp_Dbphp_Selectphp objectphp.
php php php php php php*php/
php php php php publicphp functionphp distinctphp(php$flagphp php=php truephp)
php php php php php{
php php php php php php php php php$thisphp-php>php_partsphp[selfphp:php:DISTINCTphp]php php=php php(boolphp)php php$flagphp;
php php php php php php php php returnphp php$thisphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Addsphp aphp FROMphp tablephp andphp optionalphp columnsphp tophp thephp queryphp.
php php php php php php*
php php php php php php*php Thephp firstphp parameterphp php$namephp canphp bephp aphp simplephp stringphp,php inphp whichphp casephp the
php php php php php php*php correlationphp namephp isphp generatedphp automaticallyphp.php php Ifphp youphp wantphp tophp specify
php php php php php php*php thephp correlationphp namephp,php thephp firstphp parameterphp mustphp bephp anphp associative
php php php php php php*php arrayphp inphp whichphp thephp keyphp isphp thephp correlationphp namephp,php andphp thephp valuephp is
php php php php php php*php thephp physicalphp tablephp namephp.php php Forphp examplephp,php arrayphp(php'aliasphp'php php=php>php php'tablephp'php)php.
php php php php php php*php Thephp correlationphp namephp isphp prependedphp tophp allphp columnsphp fetchedphp forphp this
php php php php php php*php tablephp.
php php php php php php*
php php php php php php*php Thephp secondphp parameterphp canphp bephp aphp singlephp stringphp orphp Zendphp_Dbphp_Exprphp objectphp,
php php php php php php*php orphp elsephp anphp arrayphp ofphp stringsphp orphp Zendphp_Dbphp_Exprphp objectsphp.
php php php php php php*
php php php php php php*php Thephp firstphp parameterphp canphp bephp nullphp orphp anphp emptyphp stringphp,php inphp whichphp case
php php php php php php*php nophp correlationphp namephp isphp generatedphp orphp prependedphp tophp thephp columnsphp named
php php php php php php*php inphp thephp secondphp parameterphp.
php php php php php php*
php php php php php php*php php@paramphp php arrayphp|stringphp|Zendphp_Dbphp_Exprphp php$namephp Thephp tablephp namephp orphp anphp associativephp array
php php php php php php*php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php relatingphp correlationphp namephp tophp tablephp namephp.
php php php php php php*php php@paramphp php arrayphp|stringphp|Zendphp_Dbphp_Exprphp php$colsphp Thephp columnsphp tophp selectphp fromphp thisphp tablephp.
php php php php php php*php php@paramphp php stringphp php$schemaphp Thephp schemaphp namephp tophp specifyphp,php ifphp anyphp.
php php php php php php*php php@returnphp Zendphp_Dbphp_Selectphp Thisphp Zendphp_Dbphp_Selectphp objectphp.
php php php php php php*php/
php php php php publicphp functionphp fromphp(php$namephp,php php$colsphp php=php php'php*php'php,php php$schemaphp php=php nullphp)
php php php php php{
php php php php php php php php returnphp php$thisphp-php>php_joinphp(selfphp:php:FROMphp,php php$namephp,php nullphp,php php$colsphp,php php$schemaphp)php;
php php php php php}

php php php php php/php*php*
php php php php php php*php Specifiesphp thephp columnsphp usedphp inphp thephp FROMphp clausephp.
php php php php php php*
php php php php php php*php Thephp parameterphp canphp bephp aphp singlephp stringphp orphp Zendphp_Dbphp_Exprphp objectphp,
php php php php php php*php orphp elsephp anphp arrayphp ofphp stringsphp orphp Zendphp_Dbphp_Exprphp objectsphp.
php php php php php php*
php php php php php php*php php@paramphp php arrayphp|stringphp|Zendphp_Dbphp_Exprphp php$colsphp Thephp columnsphp tophp selectphp fromphp thisphp tablephp.
php php php php php php*php php@paramphp php stringphp php$correlationNamephp Correlationphp namephp ofphp targetphp tablephp.php OPTIONAL
php php php php php php*php php@returnphp Zendphp_Dbphp_Selectphp Thisphp Zendphp_Dbphp_Selectphp objectphp.
php php php php php php*php/
php php php php publicphp functionphp columnsphp(php$colsphp php=php php'php*php'php,php php$correlationNamephp php=php nullphp)
php php php php php{
php php php php php php php php ifphp php(php$correlationNamephp php=php=php=php nullphp php&php&php countphp(php$thisphp-php>php_partsphp[selfphp:php:FROMphp]php)php)php php{
php php php php php php php php php php php php php$correlationNameKeysphp php=php arrayphp_keysphp(php$thisphp-php>php_partsphp[selfphp:php:FROMphp]php)php;
php php php php php php php php php php php php php$correlationNamephp php=php currentphp(php$correlationNameKeysphp)php;
php php php php php php php php php}

php php php php php php php php ifphp php(php!arrayphp_keyphp_existsphp(php$correlationNamephp,php php$thisphp-php>php_partsphp[selfphp:php:FROMphp]php)php)php php{
php php php php php php php php php php php php php/php*php*
php php php php php php php php php php php php php php*php php@seephp Zendphp_Dbphp_Selectphp_Exception
php php php php php php php php php php php php php php*php/
php php php php php php php php php php php php requirephp_oncephp php'Zendphp/Dbphp/Selectphp/Exceptionphp.phpphp'php;
php php php php php php php php php php php php throwphp newphp Zendphp_Dbphp_Selectphp_Exceptionphp(php"Nophp tablephp hasphp beenphp specifiedphp forphp thephp FROMphp clausephp"php)php;
php php php php php php php php php}

php php php php php php php php php$thisphp-php>php_tableColsphp(php$correlationNamephp,php php$colsphp)php;

php php php php php php php php returnphp php$thisphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Addsphp aphp UNIONphp clausephp tophp thephp queryphp.
php php php php php php*
php php php php php php*php Thephp firstphp parameterphp hasphp tophp bephp anphp arrayphp ofphp Zendphp_Dbphp_Selectphp or
php php php php php php*php sqlphp queryphp stringsphp.
php php php php php php*
php php php php php php*php php<codephp>
php php php php php php*php php$sqlphp1php php=php php$dbphp-php>selectphp(php)php;
php php php php php php*php php$sqlphp2php php=php php"SELECTphp php.php.php.php"php;
php php php php php php*php php$selectphp php=php php$dbphp-php>selectphp(php)
php php php php php php*php php php php php php php-php>unionphp(arrayphp(php$sqlphp1php,php php$sqlphp2php)php)
php php php php php php*php php php php php php php-php>orderphp(php"idphp"php)php;
php php php php php php*php <php/codephp>
php php php php php php*
php php php php php php*php php@paramphp php arrayphp php$selectphp Arrayphp ofphp selectphp clausesphp forphp thephp unionphp.
php php php php php php*php php@returnphp Zendphp_Dbphp_Selectphp Thisphp Zendphp_Dbphp_Selectphp objectphp.
php php php php php php*php/
php php php php publicphp functionphp unionphp(php$selectphp php=php arrayphp(php)php,php php$typephp php=php selfphp:php:SQLphp_UNIONphp)
php php php php php{
php php php php php php php php ifphp php(php!isphp_arrayphp(php$selectphp)php)php php{
php php php php php php php php php php php php requirephp_oncephp php'Zendphp/Dbphp/Selectphp/Exceptionphp.phpphp'php;
php php php php php php php php php php php php throwphp newphp Zendphp_Dbphp_Selectphp_Exceptionphp(
php php php php php php php php php php php php php php php php php"unionphp(php)php onlyphp acceptsphp anphp arrayphp ofphp Zendphp_Dbphp_Selectphp instancesphp ofphp sqlphp queryphp stringsphp.php"
php php php php php php php php php php php php php)php;
php php php php php php php php php}

php php php php php php php php ifphp php(php!inphp_arrayphp(php$typephp,php selfphp:php:php$php_unionTypesphp)php)php php{
php php php php php php php php php php php php requirephp_oncephp php'Zendphp/Dbphp/Selectphp/Exceptionphp.phpphp'php;
php php php php php php php php php php php php throwphp newphp Zendphp_Dbphp_Selectphp_Exceptionphp(php"Invalidphp unionphp typephp php'php{php$typephp}php'php"php)php;
php php php php php php php php php}

php php php php php php php php foreachphp php(php$selectphp asphp php$targetphp)php php{
php php php php php php php php php php php php php$thisphp-php>php_partsphp[selfphp:php:UNIONphp]php[php]php php=php arrayphp(php$targetphp,php php$typephp)php;
php php php php php php php php php}

php php php php php php php php returnphp php$thisphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Addsphp aphp JOINphp tablephp andphp columnsphp tophp thephp queryphp.
php php php php php php*
php php php php php php*php Thephp php$namephp andphp php$colsphp parametersphp followphp thephp samephp logic
php php php php php php*php asphp describedphp inphp thephp fromphp(php)php methodphp.
php php php php php php*
php php php php php php*php php@paramphp php arrayphp|stringphp|Zendphp_Dbphp_Exprphp php$namephp Thephp tablephp namephp.
php php php php php php*php php@paramphp php stringphp php$condphp Joinphp onphp thisphp conditionphp.
php php php php php php*php php@paramphp php arrayphp|stringphp php$colsphp Thephp columnsphp tophp selectphp fromphp thephp joinedphp tablephp.
php php php php php php*php php@paramphp php stringphp php$schemaphp Thephp databasephp namephp tophp specifyphp,php ifphp anyphp.
php php php php php php*php php@returnphp Zendphp_Dbphp_Selectphp Thisphp Zendphp_Dbphp_Selectphp objectphp.
php php php php php php*php/
php php php php publicphp functionphp joinphp(php$namephp,php php$condphp,php php$colsphp php=php selfphp:php:SQLphp_WILDCARDphp,php php$schemaphp php=php nullphp)
php php php php php{
php php php php php php php php returnphp php$thisphp-php>joinInnerphp(php$namephp,php php$condphp,php php$colsphp,php php$schemaphp)php;
php php php php php}

php php php php php/php*php*
php php php php php php*php Addphp anphp INNERphp JOINphp tablephp andphp columsphp tophp thephp query
php php php php php php*php Rowsphp inphp bothphp tablesphp arephp matchedphp accordingphp tophp thephp expression
php php php php php php*php inphp thephp php$condphp argumentphp.php php Thephp resultphp setphp isphp comprised
php php php php php php*php ofphp allphp casesphp wherephp rowsphp fromphp thephp leftphp tablephp match
php php php php php php*php rowsphp fromphp thephp rightphp tablephp.
php php php php php php*
php php php php php php*php Thephp php$namephp andphp php$colsphp parametersphp followphp thephp samephp logic
php php php php php php*php asphp describedphp inphp thephp fromphp(php)php methodphp.
php php php php php php*
php php php php php php*php php@paramphp php arrayphp|stringphp|Zendphp_Dbphp_Exprphp php$namephp Thephp tablephp namephp.
php php php php php php*php php@paramphp php stringphp php$condphp Joinphp onphp thisphp conditionphp.
php php php php php php*php php@paramphp php arrayphp|stringphp php$colsphp Thephp columnsphp tophp selectphp fromphp thephp joinedphp tablephp.
php php php php php php*php php@paramphp php stringphp php$schemaphp Thephp databasephp namephp tophp specifyphp,php ifphp anyphp.
php php php php php php*php php@returnphp Zendphp_Dbphp_Selectphp Thisphp Zendphp_Dbphp_Selectphp objectphp.
php php php php php php*php/
php php php php publicphp functionphp joinInnerphp(php$namephp,php php$condphp,php php$colsphp php=php selfphp:php:SQLphp_WILDCARDphp,php php$schemaphp php=php nullphp)
php php php php php{
php php php php php php php php returnphp php$thisphp-php>php_joinphp(selfphp:php:INNERphp_JOINphp,php php$namephp,php php$condphp,php php$colsphp,php php$schemaphp)php;
php php php php php}

php php php php php/php*php*
php php php php php php*php Addphp aphp LEFTphp OUTERphp JOINphp tablephp andphp columsphp tophp thephp query
php php php php php php*php Allphp rowsphp fromphp thephp leftphp operandphp tablephp arephp includedphp,
php php php php php php*php matchingphp rowsphp fromphp thephp rightphp operandphp tablephp includedphp,
php php php php php php*php andphp thephp columnsphp fromphp thephp rightphp operandphp tablephp arephp filled
php php php php php php*php withphp NULLsphp ifphp nophp rowphp existsphp matchingphp thephp leftphp tablephp.
php php php php php php*
php php php php php php*php Thephp php$namephp andphp php$colsphp parametersphp followphp thephp samephp logic
php php php php php php*php asphp describedphp inphp thephp fromphp(php)php methodphp.
php php php php php php*
php php php php php php*php php@paramphp php arrayphp|stringphp|Zendphp_Dbphp_Exprphp php$namephp Thephp tablephp namephp.
php php php php php php*php php@paramphp php stringphp php$condphp Joinphp onphp thisphp conditionphp.
php php php php php php*php php@paramphp php arrayphp|stringphp php$colsphp Thephp columnsphp tophp selectphp fromphp thephp joinedphp tablephp.
php php php php php php*php php@paramphp php stringphp php$schemaphp Thephp databasephp namephp tophp specifyphp,php ifphp anyphp.
php php php php php php*php php@returnphp Zendphp_Dbphp_Selectphp Thisphp Zendphp_Dbphp_Selectphp objectphp.
php php php php php php*php/
php php php php publicphp functionphp joinLeftphp(php$namephp,php php$condphp,php php$colsphp php=php selfphp:php:SQLphp_WILDCARDphp,php php$schemaphp php=php nullphp)
php php php php php{
php php php php php php php php returnphp php$thisphp-php>php_joinphp(selfphp:php:LEFTphp_JOINphp,php php$namephp,php php$condphp,php php$colsphp,php php$schemaphp)php;
php php php php php}

php php php php php/php*php*
php php php php php php*php Addphp aphp RIGHTphp OUTERphp JOINphp tablephp andphp columsphp tophp thephp queryphp.
php php php php php php*php Rightphp outerphp joinphp isphp thephp complementphp ofphp leftphp outerphp joinphp.
php php php php php php*php Allphp rowsphp fromphp thephp rightphp operandphp tablephp arephp includedphp,
php php php php php php*php matchingphp rowsphp fromphp thephp leftphp operandphp tablephp includedphp,
php php php php php php*php andphp thephp columnsphp fromphp thephp leftphp operandphp tablephp arephp filled
php php php php php php*php withphp NULLsphp ifphp nophp rowphp existsphp matchingphp thephp rightphp tablephp.
php php php php php php*
php php php php php php*php Thephp php$namephp andphp php$colsphp parametersphp followphp thephp samephp logic
php php php php php php*php asphp describedphp inphp thephp fromphp(php)php methodphp.
php php php php php php*
php php php php php php*php php@paramphp php arrayphp|stringphp|Zendphp_Dbphp_Exprphp php$namephp Thephp tablephp namephp.
php php php php php php*php php@paramphp php stringphp php$condphp Joinphp onphp thisphp conditionphp.
php php php php php php*php php@paramphp php arrayphp|stringphp php$colsphp Thephp columnsphp tophp selectphp fromphp thephp joinedphp tablephp.
php php php php php php*php php@paramphp php stringphp php$schemaphp Thephp databasephp namephp tophp specifyphp,php ifphp anyphp.
php php php php php php*php php@returnphp Zendphp_Dbphp_Selectphp Thisphp Zendphp_Dbphp_Selectphp objectphp.
php php php php php php*php/
php php php php publicphp functionphp joinRightphp(php$namephp,php php$condphp,php php$colsphp php=php selfphp:php:SQLphp_WILDCARDphp,php php$schemaphp php=php nullphp)
php php php php php{
php php php php php php php php returnphp php$thisphp-php>php_joinphp(selfphp:php:RIGHTphp_JOINphp,php php$namephp,php php$condphp,php php$colsphp,php php$schemaphp)php;
php php php php php}

php php php php php/php*php*
php php php php php php*php Addphp aphp FULLphp OUTERphp JOINphp tablephp andphp columsphp tophp thephp queryphp.
php php php php php php*php Aphp fullphp outerphp joinphp isphp likephp combiningphp aphp leftphp outerphp join
php php php php php php*php andphp aphp rightphp outerphp joinphp.php php Allphp rowsphp fromphp bothphp tablesphp are
php php php php php php*php includedphp,php pairedphp withphp eachphp otherphp onphp thephp samephp rowphp ofphp the
php php php php php php*php resultphp setphp ifphp theyphp satisfyphp thephp joinphp conditionphp,php andphp otherwise
php php php php php php*php pairedphp withphp NULLsphp inphp placephp ofphp columnsphp fromphp thephp otherphp tablephp.
php php php php php php*
php php php php php php*php Thephp php$namephp andphp php$colsphp parametersphp followphp thephp samephp logic
php php php php php php*php asphp describedphp inphp thephp fromphp(php)php methodphp.
php php php php php php*
php php php php php php*php php@paramphp php arrayphp|stringphp|Zendphp_Dbphp_Exprphp php$namephp Thephp tablephp namephp.
php php php php php php*php php@paramphp php stringphp php$condphp Joinphp onphp thisphp conditionphp.
php php php php php php*php php@paramphp php arrayphp|stringphp php$colsphp Thephp columnsphp tophp selectphp fromphp thephp joinedphp tablephp.
php php php php php php*php php@paramphp php stringphp php$schemaphp Thephp databasephp namephp tophp specifyphp,php ifphp anyphp.
php php php php php php*php php@returnphp Zendphp_Dbphp_Selectphp Thisphp Zendphp_Dbphp_Selectphp objectphp.
php php php php php php*php/
php php php php publicphp functionphp joinFullphp(php$namephp,php php$condphp,php php$colsphp php=php selfphp:php:SQLphp_WILDCARDphp,php php$schemaphp php=php nullphp)
php php php php php{
php php php php php php php php returnphp php$thisphp-php>php_joinphp(selfphp:php:FULLphp_JOINphp,php php$namephp,php php$condphp,php php$colsphp,php php$schemaphp)php;
php php php php php}

php php php php php/php*php*
php php php php php php*php Addphp aphp CROSSphp JOINphp tablephp andphp columsphp tophp thephp queryphp.
php php php php php php*php Aphp crossphp joinphp isphp aphp cartesianphp productphp;php therephp isphp nophp joinphp conditionphp.
php php php php php php*
php php php php php php*php Thephp php$namephp andphp php$colsphp parametersphp followphp thephp samephp logic
php php php php php php*php asphp describedphp inphp thephp fromphp(php)php methodphp.
php php php php php php*
php php php php php php*php php@paramphp php arrayphp|stringphp|Zendphp_Dbphp_Exprphp php$namephp Thephp tablephp namephp.
php php php php php php*php php@paramphp php arrayphp|stringphp php$colsphp Thephp columnsphp tophp selectphp fromphp thephp joinedphp tablephp.
php php php php php php*php php@paramphp php stringphp php$schemaphp Thephp databasephp namephp tophp specifyphp,php ifphp anyphp.
php php php php php php*php php@returnphp Zendphp_Dbphp_Selectphp Thisphp Zendphp_Dbphp_Selectphp objectphp.
php php php php php php*php/
php php php php publicphp functionphp joinCrossphp(php$namephp,php php$colsphp php=php selfphp:php:SQLphp_WILDCARDphp,php php$schemaphp php=php nullphp)
php php php php php{
php php php php php php php php returnphp php$thisphp-php>php_joinphp(selfphp:php:CROSSphp_JOINphp,php php$namephp,php nullphp,php php$colsphp,php php$schemaphp)php;
php php php php php}

php php php php php/php*php*
php php php php php php*php Addphp aphp NATURALphp JOINphp tablephp andphp columsphp tophp thephp queryphp.
php php php php php php*php Aphp naturalphp joinphp assumesphp anphp equiphp-joinphp acrossphp anyphp columnphp(sphp)
php php php php php php*php thatphp appearphp withphp thephp samephp namephp inphp bothphp tablesphp.
php php php php php php*php Onlyphp naturalphp innerphp joinsphp arephp supportedphp byphp thisphp APIphp,
php php php php php php*php evenphp thoughphp SQLphp permitsphp naturalphp outerphp joinsphp asphp wellphp.
php php php php php php*
php php php php php php*php Thephp php$namephp andphp php$colsphp parametersphp followphp thephp samephp logic
php php php php php php*php asphp describedphp inphp thephp fromphp(php)php methodphp.
php php php php php php*
php php php php php php*php php@paramphp php arrayphp|stringphp|Zendphp_Dbphp_Exprphp php$namephp Thephp tablephp namephp.
php php php php php php*php php@paramphp php arrayphp|stringphp php$colsphp Thephp columnsphp tophp selectphp fromphp thephp joinedphp tablephp.
php php php php php php*php php@paramphp php stringphp php$schemaphp Thephp databasephp namephp tophp specifyphp,php ifphp anyphp.
php php php php php php*php php@returnphp Zendphp_Dbphp_Selectphp Thisphp Zendphp_Dbphp_Selectphp objectphp.
php php php php php php*php/
php php php php publicphp functionphp joinNaturalphp(php$namephp,php php$colsphp php=php selfphp:php:SQLphp_WILDCARDphp,php php$schemaphp php=php nullphp)
php php php php php{
php php php php php php php php returnphp php$thisphp-php>php_joinphp(selfphp:php:NATURALphp_JOINphp,php php$namephp,php nullphp,php php$colsphp,php php$schemaphp)php;
php php php php php}

php php php php php/php*php*
php php php php php php*php Addsphp aphp WHEREphp conditionphp tophp thephp queryphp byphp ANDphp.
php php php php php php*
php php php php php php*php Ifphp aphp valuephp isphp passedphp asphp thephp secondphp paramphp,php itphp willphp bephp quoted
php php php php php php*php andphp replacedphp intophp thephp conditionphp whereverphp aphp questionphp-mark
php php php php php php*php appearsphp.php Arrayphp valuesphp arephp quotedphp andphp commaphp-separatedphp.
php php php php php php*
php php php php php php*php php<codephp>
php php php php php php*php php/php/php simplestphp butphp nonphp-secure
php php php php php php*php php$selectphp-php>wherephp(php"idphp php=php php$idphp"php)php;
php php php php php php*
php php php php php php*php php/php/php securephp php(IDphp isphp quotedphp butphp matchedphp anywayphp)
php php php php php php*php php$selectphp-php>wherephp(php'idphp php=php php?php'php,php php$idphp)php;
php php php php php php*
php php php php php php*php php/php/php alternativelyphp,php withphp namedphp binding
php php php php php php*php php$selectphp-php>wherephp(php'idphp php=php php:idphp'php)php;
php php php php php php*php <php/codephp>
php php php php php php*
php php php php php php*php Notephp thatphp itphp isphp morephp correctphp tophp usephp namedphp bindingsphp inphp your
php php php php php php*php queriesphp forphp valuesphp otherphp thanphp stringsphp.php Whenphp youphp usephp named
php php php php php php*php bindingsphp,php donphp'tphp forgetphp tophp passphp thephp valuesphp whenphp actually
php php php php php php*php makingphp aphp queryphp:
php php php php php php*
php php php php php php*php php<codephp>
php php php php php php*php php$dbphp-php>fetchAllphp(php$selectphp,php arrayphp(php'idphp'php php=php>php php5php)php)php;
php php php php php php*php <php/codephp>
php php php php php php*
php php php php php php*php php@paramphp stringphp php php php$condphp php Thephp WHEREphp conditionphp.
php php php php php php*php php@paramphp mixedphp php php php php$valuephp OPTIONALphp Thephp valuephp tophp quotephp intophp thephp conditionphp.
php php php php php php*php php@paramphp intphp php php php php php php$typephp php OPTIONALphp Thephp typephp ofphp thephp givenphp value
php php php php php php*php php@returnphp Zendphp_Dbphp_Selectphp Thisphp Zendphp_Dbphp_Selectphp objectphp.
php php php php php php*php/
php php php php publicphp functionphp wherephp(php$condphp,php php$valuephp php=php nullphp,php php$typephp php=php nullphp)
php php php php php{
php php php php php php php php php$thisphp-php>php_partsphp[selfphp:php:WHEREphp]php[php]php php=php php$thisphp-php>php_wherephp(php$condphp,php php$valuephp,php php$typephp,php truephp)php;

php php php php php php php php returnphp php$thisphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Addsphp aphp WHEREphp conditionphp tophp thephp queryphp byphp ORphp.
php php php php php php*
php php php php php php*php Otherwisephp identicalphp tophp wherephp(php)php.
php php php php php php*
php php php php php php*php php@paramphp stringphp php php php$condphp php Thephp WHEREphp conditionphp.
php php php php php php*php php@paramphp mixedphp php php php php$valuephp OPTIONALphp Thephp valuephp tophp quotephp intophp thephp conditionphp.
php php php php php php*php php@paramphp intphp php php php php php php$typephp php OPTIONALphp Thephp typephp ofphp thephp givenphp value
php php php php php php*php php@returnphp Zendphp_Dbphp_Selectphp Thisphp Zendphp_Dbphp_Selectphp objectphp.
php php php php php php*
php php php php php php*php php@seephp wherephp(php)
php php php php php php*php/
php php php php publicphp functionphp orWherephp(php$condphp,php php$valuephp php=php nullphp,php php$typephp php=php nullphp)
php php php php php{
php php php php php php php php php$thisphp-php>php_partsphp[selfphp:php:WHEREphp]php[php]php php=php php$thisphp-php>php_wherephp(php$condphp,php php$valuephp,php php$typephp,php falsephp)php;

php php php php php php php php returnphp php$thisphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Addsphp groupingphp tophp thephp queryphp.
php php php php php php*
php php php php php php*php php@paramphp php arrayphp|stringphp php$specphp Thephp columnphp(sphp)php tophp groupphp byphp.
php php php php php php*php php@returnphp Zendphp_Dbphp_Selectphp Thisphp Zendphp_Dbphp_Selectphp objectphp.
php php php php php php*php/
php php php php publicphp functionphp groupphp(php$specphp)
php php php php php{
php php php php php php php php ifphp php(php!isphp_arrayphp(php$specphp)php)php php{
php php php php php php php php php php php php php$specphp php=php arrayphp(php$specphp)php;
php php php php php php php php php}

php php php php php php php php foreachphp php(php$specphp asphp php$valphp)php php{
php php php php php php php php php php php php ifphp php(pregphp_matchphp(php'php/php\php(php.php*php\php)php/php'php,php php(stringphp)php php$valphp)php)php php{
php php php php php php php php php php php php php php php php php$valphp php=php newphp Zendphp_Dbphp_Exprphp(php$valphp)php;
php php php php php php php php php php php php php}
php php php php php php php php php php php php php$thisphp-php>php_partsphp[selfphp:php:GROUPphp]php[php]php php=php php$valphp;
php php php php php php php php php}

php php php php php php php php returnphp php$thisphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Addsphp aphp HAVINGphp conditionphp tophp thephp queryphp byphp ANDphp.
php php php php php php*
php php php php php php*php Ifphp aphp valuephp isphp passedphp asphp thephp secondphp paramphp,php itphp willphp bephp quoted
php php php php php php*php andphp replacedphp intophp thephp conditionphp whereverphp aphp questionphp-mark
php php php php php php*php appearsphp.php Seephp php{php@linkphp wherephp(php)php}php forphp anphp example
php php php php php php*
php php php php php php*php php@paramphp stringphp php$condphp Thephp HAVINGphp conditionphp.
php php php php php php*php php@paramphp mixedphp php php php php$valuephp OPTIONALphp Thephp valuephp tophp quotephp intophp thephp conditionphp.
php php php php php php*php php@paramphp intphp php php php php php php$typephp php OPTIONALphp Thephp typephp ofphp thephp givenphp value
php php php php php php*php php@returnphp Zendphp_Dbphp_Selectphp Thisphp Zendphp_Dbphp_Selectphp objectphp.
php php php php php php*php/
php php php php publicphp functionphp havingphp(php$condphp,php php$valuephp php=php nullphp,php php$typephp php=php nullphp)
php php php php php{
php php php php php php php php ifphp php(php$valuephp php!php=php=php nullphp)php php{
php php php php php php php php php php php php php$condphp php=php php$thisphp-php>php_adapterphp-php>quoteIntophp(php$condphp,php php$valuephp,php php$typephp)php;
php php php php php php php php php}

php php php php php php php php ifphp php(php$thisphp-php>php_partsphp[selfphp:php:HAVINGphp]php)php php{
php php php php php php php php php php php php php$thisphp-php>php_partsphp[selfphp:php:HAVINGphp]php[php]php php=php selfphp:php:SQLphp_ANDphp php.php php"php php(php$condphp)php"php;
php php php php php php php php php}php elsephp php{
php php php php php php php php php php php php php$thisphp-php>php_partsphp[selfphp:php:HAVINGphp]php[php]php php=php php"php(php$condphp)php"php;
php php php php php php php php php}

php php php php php php php php returnphp php$thisphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Addsphp aphp HAVINGphp conditionphp tophp thephp queryphp byphp ORphp.
php php php php php php*
php php php php php php*php Otherwisephp identicalphp tophp orHavingphp(php)php.
php php php php php php*
php php php php php php*php php@paramphp stringphp php$condphp Thephp HAVINGphp conditionphp.
php php php php php php*php php@paramphp mixedphp php php php php$valuephp OPTIONALphp Thephp valuephp tophp quotephp intophp thephp conditionphp.
php php php php php php*php php@paramphp intphp php php php php php php$typephp php OPTIONALphp Thephp typephp ofphp thephp givenphp value
php php php php php php*php php@returnphp Zendphp_Dbphp_Selectphp Thisphp Zendphp_Dbphp_Selectphp objectphp.
php php php php php php*
php php php php php php*php php@seephp havingphp(php)
php php php php php php*php/
php php php php publicphp functionphp orHavingphp(php$condphp,php php$valuephp php=php nullphp,php php$typephp php=php nullphp)
php php php php php{
php php php php php php php php ifphp php(php$valuephp php!php=php=php nullphp)php php{
php php php php php php php php php php php php php$condphp php=php php$thisphp-php>php_adapterphp-php>quoteIntophp(php$condphp,php php$valuephp,php php$typephp)php;
php php php php php php php php php}

php php php php php php php php ifphp php(php$thisphp-php>php_partsphp[selfphp:php:HAVINGphp]php)php php{
php php php php php php php php php php php php php$thisphp-php>php_partsphp[selfphp:php:HAVINGphp]php[php]php php=php selfphp:php:SQLphp_ORphp php.php php"php php(php$condphp)php"php;
php php php php php php php php php}php elsephp php{
php php php php php php php php php php php php php$thisphp-php>php_partsphp[selfphp:php:HAVINGphp]php[php]php php=php php"php(php$condphp)php"php;
php php php php php php php php php}

php php php php php php php php returnphp php$thisphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Addsphp aphp rowphp orderphp tophp thephp queryphp.
php php php php php php*
php php php php php php*php php@paramphp mixedphp php$specphp Thephp columnphp(sphp)php andphp directionphp tophp orderphp byphp.
php php php php php php*php php@returnphp Zendphp_Dbphp_Selectphp Thisphp Zendphp_Dbphp_Selectphp objectphp.
php php php php php php*php/
php php php php publicphp functionphp orderphp(php$specphp)
php php php php php{
php php php php php php php php ifphp php(php!isphp_arrayphp(php$specphp)php)php php{
php php php php php php php php php php php php php$specphp php=php arrayphp(php$specphp)php;
php php php php php php php php php}

php php php php php php php php php/php/php forcephp php'ASCphp'php orphp php'DESCphp'php onphp eachphp orderphp specphp,php defaultphp isphp ASCphp.
php php php php php php php php foreachphp php(php$specphp asphp php$valphp)php php{
php php php php php php php php php php php php ifphp php(php$valphp instanceofphp Zendphp_Dbphp_Exprphp)php php{
php php php php php php php php php php php php php php php php php$exprphp php=php php$valphp-php>php_php_toStringphp(php)php;
php php php php php php php php php php php php php php php php ifphp php(emptyphp(php$exprphp)php)php php{
php php php php php php php php php php php php php php php php php php php php continuephp;
php php php php php php php php php php php php php php php php php}
php php php php php php php php php php php php php php php php php$thisphp-php>php_partsphp[selfphp:php:ORDERphp]php[php]php php=php php$valphp;
php php php php php php php php php php php php php}php elsephp php{
php php php php php php php php php php php php php php php php ifphp php(emptyphp(php$valphp)php)php php{
php php php php php php php php php php php php php php php php php php php php continuephp;
php php php php php php php php php php php php php php php php php}
php php php php php php php php php php php php php php php php php$directionphp php=php selfphp:php:SQLphp_ASCphp;
php php php php php php php php php php php php php php php php ifphp php(pregphp_matchphp(php'php/php(php.php*php\Wphp)php(php'php php.php selfphp:php:SQLphp_ASCphp php.php php'php|php'php php.php selfphp:php:SQLphp_DESCphp php.php php'php)php\bphp/siphp'php,php php$valphp,php php$matchesphp)php)php php{
php php php php php php php php php php php php php php php php php php php php php$valphp php=php trimphp(php$matchesphp[php1php]php)php;
php php php php php php php php php php php php php php php php php php php php php$directionphp php=php php$matchesphp[php2php]php;
php php php php php php php php php php php php php php php php php}
php php php php php php php php php php php php php php php php ifphp php(pregphp_matchphp(php'php/php\php(php.php*php\php)php/php'php,php php$valphp)php)php php{
php php php php php php php php php php php php php php php php php php php php php$valphp php=php newphp Zendphp_Dbphp_Exprphp(php$valphp)php;
php php php php php php php php php php php php php php php php php}
php php php php php php php php php php php php php php php php php$thisphp-php>php_partsphp[selfphp:php:ORDERphp]php[php]php php=php arrayphp(php$valphp,php php$directionphp)php;
php php php php php php php php php php php php php}
php php php php php php php php php}

php php php php php php php php returnphp php$thisphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Setsphp aphp limitphp countphp andphp offsetphp tophp thephp queryphp.
php php php php php php*
php php php php php php*php php@paramphp intphp php$countphp OPTIONALphp Thephp numberphp ofphp rowsphp tophp returnphp.
php php php php php php*php php@paramphp intphp php$offsetphp OPTIONALphp Startphp returningphp afterphp thisphp manyphp rowsphp.
php php php php php php*php php@returnphp Zendphp_Dbphp_Selectphp Thisphp Zendphp_Dbphp_Selectphp objectphp.
php php php php php php*php/
php php php php publicphp functionphp limitphp(php$countphp php=php nullphp,php php$offsetphp php=php nullphp)
php php php php php{
php php php php php php php php php$thisphp-php>php_partsphp[selfphp:php:LIMITphp_COUNTphp]php php php=php php(intphp)php php$countphp;
php php php php php php php php php$thisphp-php>php_partsphp[selfphp:php:LIMITphp_OFFSETphp]php php=php php(intphp)php php$offsetphp;
php php php php php php php php returnphp php$thisphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Setsphp thephp limitphp andphp countphp byphp pagephp numberphp.
php php php php php php*
php php php php php php*php php@paramphp intphp php$pagephp Limitphp resultsphp tophp thisphp pagephp numberphp.
php php php php php php*php php@paramphp intphp php$rowCountphp Usephp thisphp manyphp rowsphp perphp pagephp.
php php php php php php*php php@returnphp Zendphp_Dbphp_Selectphp Thisphp Zendphp_Dbphp_Selectphp objectphp.
php php php php php php*php/
php php php php publicphp functionphp limitPagephp(php$pagephp,php php$rowCountphp)
php php php php php{
php php php php php php php php php$pagephp php php php php php=php php(php$pagephp php>php php0php)php php php php php php?php php$pagephp php php php php php:php php1php;
php php php php php php php php php$rowCountphp php=php php(php$rowCountphp php>php php0php)php php?php php$rowCountphp php:php php1php;
php php php php php php php php php$thisphp-php>php_partsphp[selfphp:php:LIMITphp_COUNTphp]php php php=php php(intphp)php php$rowCountphp;
php php php php php php php php php$thisphp-php>php_partsphp[selfphp:php:LIMITphp_OFFSETphp]php php=php php(intphp)php php$rowCountphp php*php php(php$pagephp php-php php1php)php;
php php php php php php php php returnphp php$thisphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Makesphp thephp queryphp SELECTphp FORphp UPDATEphp.
php php php php php php*
php php php php php php*php php@paramphp boolphp php$flagphp Whetherphp orphp notphp thephp SELECTphp isphp FORphp UPDATEphp php(defaultphp truephp)php.
php php php php php php*php php@returnphp Zendphp_Dbphp_Selectphp Thisphp Zendphp_Dbphp_Selectphp objectphp.
php php php php php php*php/
php php php php publicphp functionphp forUpdatephp(php$flagphp php=php truephp)
php php php php php{
php php php php php php php php php$thisphp-php>php_partsphp[selfphp:php:FORphp_UPDATEphp]php php=php php(boolphp)php php$flagphp;
php php php php php php php php returnphp php$thisphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Getphp partphp ofphp thephp structuredphp informationphp forphp thephp currectphp queryphp.
php php php php php php*
php php php php php php*php php@paramphp stringphp php$part
php php php php php php*php php@returnphp mixed
php php php php php php*php php@throwsphp Zendphp_Dbphp_Selectphp_Exception
php php php php php php*php/
php php php php publicphp functionphp getPartphp(php$partphp)
php php php php php{
php php php php php php php php php$partphp php=php strtolowerphp(php$partphp)php;
php php php php php php php php ifphp php(php!arrayphp_keyphp_existsphp(php$partphp,php php$thisphp-php>php_partsphp)php)php php{
php php php php php php php php php php php php requirephp_oncephp php'Zendphp/Dbphp/Selectphp/Exceptionphp.phpphp'php;
php php php php php php php php php php php php throwphp newphp Zendphp_Dbphp_Selectphp_Exceptionphp(php"Invalidphp Selectphp partphp php'php$partphp'php"php)php;
php php php php php php php php php}
php php php php php php php php returnphp php$thisphp-php>php_partsphp[php$partphp]php;
php php php php php}

php php php php php/php*php*
php php php php php php*php Executesphp thephp currentphp selectphp objectphp andphp returnsphp thephp result
php php php php php php*
php php php php php php*php php@paramphp integerphp php$fetchModephp OPTIONAL
php php php php php php*php php@paramphp php mixedphp php php$bindphp Anphp arrayphp ofphp dataphp tophp bindphp tophp thephp placeholdersphp.
php php php php php php*php php@returnphp PDOphp_Statementphp|Zendphp_Dbphp_Statement
php php php php php php*php/
php php php php publicphp functionphp queryphp(php$fetchModephp php=php nullphp,php php$bindphp php=php arrayphp(php)php)
php php php php php{
php php php php php php php php ifphp php(php!emptyphp(php$bindphp)php)php php{
php php php php php php php php php php php php php$thisphp-php>bindphp(php$bindphp)php;
php php php php php php php php php}

php php php php php php php php php$stmtphp php=php php$thisphp-php>php_adapterphp-php>queryphp(php$thisphp)php;
php php php php php php php php ifphp php(php$fetchModephp php=php=php nullphp)php php{
php php php php php php php php php php php php php$fetchModephp php=php php$thisphp-php>php_adapterphp-php>getFetchModephp(php)php;
php php php php php php php php php}
php php php php php php php php php$stmtphp-php>setFetchModephp(php$fetchModephp)php;
php php php php php php php php returnphp php$stmtphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Convertsphp thisphp objectphp tophp anphp SQLphp SELECTphp stringphp.
php php php php php php*
php php php php php php*php php@returnphp stringphp|nullphp Thisphp objectphp asphp aphp SELECTphp stringphp.php php(orphp nullphp ifphp aphp stringphp cannotphp bephp producedphp.php)
php php php php php php*php/
php php php php publicphp functionphp assemblephp(php)
php php php php php{
php php php php php php php php php$sqlphp php=php selfphp:php:SQLphp_SELECTphp;
php php php php php php php php foreachphp php(arrayphp_keysphp(selfphp:php:php$php_partsInitphp)php asphp php$partphp)php php{
php php php php php php php php php php php php php$methodphp php=php php'php_renderphp'php php.php ucfirstphp(php$partphp)php;
php php php php php php php php php php php php ifphp php(methodphp_existsphp(php$thisphp,php php$methodphp)php)php php{
php php php php php php php php php php php php php php php php php$sqlphp php=php php$thisphp-php>php$methodphp(php$sqlphp)php;
php php php php php php php php php php php php php}
php php php php php php php php php}
php php php php php php php php returnphp php$sqlphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Clearphp partsphp ofphp thephp Selectphp objectphp,php orphp anphp individualphp partphp.
php php php php php php*
php php php php php php*php php@paramphp stringphp php$partphp OPTIONAL
php php php php php php*php php@returnphp Zendphp_Dbphp_Select
php php php php php php*php/
php php php php publicphp functionphp resetphp(php$partphp php=php nullphp)
php php php php php{
php php php php php php php php ifphp php(php$partphp php=php=php nullphp)php php{
php php php php php php php php php php php php php$thisphp-php>php_partsphp php=php selfphp:php:php$php_partsInitphp;
php php php php php php php php php}php elsephp ifphp php(arrayphp_keyphp_existsphp(php$partphp,php selfphp:php:php$php_partsInitphp)php)php php{
php php php php php php php php php php php php php$thisphp-php>php_partsphp[php$partphp]php php=php selfphp:php:php$php_partsInitphp[php$partphp]php;
php php php php php php php php php}
php php php php php php php php returnphp php$thisphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Getsphp thephp Zendphp_Dbphp_Adapterphp_Abstractphp forphp this
php php php php php php*php particularphp Zendphp_Dbphp_Selectphp objectphp.
php php php php php php*
php php php php php php*php php@returnphp Zendphp_Dbphp_Adapterphp_Abstract
php php php php php php*php/
php php php php publicphp functionphp getAdapterphp(php)
php php php php php{
php php php php php php php php returnphp php$thisphp-php>php_adapterphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Populatephp thephp php{php@linkphp php$php_partsphp}php php'joinphp'php key
php php php php php php*
php php php php php php*php Doesphp thephp dirtyphp workphp ofphp populatingphp thephp joinphp keyphp.
php php php php php php*
php php php php php php*php Thephp php$namephp andphp php$colsphp parametersphp followphp thephp samephp logic
php php php php php php*php asphp describedphp inphp thephp fromphp(php)php methodphp.
php php php php php php*
php php php php php php*php php@paramphp php nullphp|stringphp php$typephp Typephp ofphp joinphp;php innerphp,php leftphp,php andphp nullphp arephp currentlyphp supported
php php php php php php*php php@paramphp php arrayphp|stringphp|Zendphp_Dbphp_Exprphp php$namephp Tablephp name
php php php php php php*php php@paramphp php stringphp php$condphp Joinphp onphp thisphp condition
php php php php php php*php php@paramphp php arrayphp|stringphp php$colsphp Thephp columnsphp tophp selectphp fromphp thephp joinedphp table
php php php php php php*php php@paramphp php stringphp php$schemaphp Thephp databasephp namephp tophp specifyphp,php ifphp anyphp.
php php php php php php*php php@returnphp Zendphp_Dbphp_Selectphp Thisphp Zendphp_Dbphp_Selectphp object
php php php php php php*php php@throwsphp Zendphp_Dbphp_Selectphp_Exception
php php php php php php*php/
php php php php protectedphp functionphp php_joinphp(php$typephp,php php$namephp,php php$condphp,php php$colsphp,php php$schemaphp php=php nullphp)
php php php php php{
php php php php php php php php ifphp php(php!inphp_arrayphp(php$typephp,php selfphp:php:php$php_joinTypesphp)php php&php&php php$typephp php!php=php selfphp:php:FROMphp)php php{
php php php php php php php php php php php php php/php*php*
php php php php php php php php php php php php php php*php php@seephp Zendphp_Dbphp_Selectphp_Exception
php php php php php php php php php php php php php php*php/
php php php php php php php php php php php php requirephp_oncephp php'Zendphp/Dbphp/Selectphp/Exceptionphp.phpphp'php;
php php php php php php php php php php php php throwphp newphp Zendphp_Dbphp_Selectphp_Exceptionphp(php"Invalidphp joinphp typephp php'php$typephp'php"php)php;
php php php php php php php php php}

php php php php php php php php ifphp php(countphp(php$thisphp-php>php_partsphp[selfphp:php:UNIONphp]php)php)php php{
php php php php php php php php php php php php requirephp_oncephp php'Zendphp/Dbphp/Selectphp/Exceptionphp.phpphp'php;
php php php php php php php php php php php php throwphp newphp Zendphp_Dbphp_Selectphp_Exceptionphp(php"Invalidphp usephp ofphp tablephp withphp php"php php.php selfphp:php:SQLphp_UNIONphp)php;
php php php php php php php php php}

php php php php php php php php ifphp php(emptyphp(php$namephp)php)php php{
php php php php php php php php php php php php php$correlationNamephp php=php php$tableNamephp php=php php'php'php;
php php php php php php php php php}php elsephp ifphp php(isphp_arrayphp(php$namephp)php)php php{
php php php php php php php php php php php php php/php/php Mustphp bephp arrayphp(php$correlationNamephp php=php>php php$tableNamephp)php orphp arrayphp(php$identphp,php php.php.php.php)
php php php php php php php php php php php php foreachphp php(php$namephp asphp php$php_correlationNamephp php=php>php php$php_tableNamephp)php php{
php php php php php php php php php php php php php php php php ifphp php(isphp_stringphp(php$php_correlationNamephp)php)php php{
php php php php php php php php php php php php php php php php php php php php php/php/php Wephp assumephp thephp keyphp isphp thephp correlationphp namephp andphp valuephp isphp thephp tablephp name
php php php php php php php php php php php php php php php php php php php php php$tableNamephp php=php php$php_tableNamephp;
php php php php php php php php php php php php php php php php php php php php php$correlationNamephp php=php php$php_correlationNamephp;
php php php php php php php php php php php php php php php php php}php elsephp php{
php php php php php php php php php php php php php php php php php php php php php/php/php Wephp assumephp justphp anphp arrayphp ofphp identifiersphp,php withphp nophp correlationphp name
php php php php php php php php php php php php php php php php php php php php php$tableNamephp php=php php$php_tableNamephp;
php php php php php php php php php php php php php php php php php php php php php$correlationNamephp php=php php$thisphp-php>php_uniqueCorrelationphp(php$tableNamephp)php;
php php php php php php php php php php php php php php php php php}
php php php php php php php php php php php php php php php php breakphp;
php php php php php php php php php php php php php}
php php php php php php php php php}php elsephp ifphp php(php$namephp instanceofphp Zendphp_Dbphp_Exprphp|php|php php$namephp instanceofphp Zendphp_Dbphp_Selectphp)php php{
php php php php php php php php php php php php php$tableNamephp php=php php$namephp;
php php php php php php php php php php php php php$correlationNamephp php=php php$thisphp-php>php_uniqueCorrelationphp(php'tphp'php)php;
php php php php php php php php php}php elsephp ifphp php(pregphp_matchphp(php'php/php^php(php.php+php)php\sphp+ASphp\sphp+php(php.php+php)php$php/iphp'php,php php$namephp,php php$mphp)php)php php{
php php php php php php php php php php php php php$tableNamephp php=php php$mphp[php1php]php;
php php php php php php php php php php php php php$correlationNamephp php=php php$mphp[php2php]php;
php php php php php php php php php}php elsephp php{
php php php php php php php php php php php php php$tableNamephp php=php php$namephp;
php php php php php php php php php php php php php$correlationNamephp php=php php$thisphp-php>php_uniqueCorrelationphp(php$tableNamephp)php;
php php php php php php php php php}

php php php php php php php php php/php/php Schemaphp fromphp tablephp namephp overridesphp schemaphp argument
php php php php php php php php ifphp php(php!isphp_objectphp(php$tableNamephp)php php&php&php falsephp php!php=php=php strposphp(php$tableNamephp,php php'php.php'php)php)php php{
php php php php php php php php php php php php listphp(php$schemaphp,php php$tableNamephp)php php=php explodephp(php'php.php'php,php php$tableNamephp)php;
php php php php php php php php php}

php php php php php php php php php$lastFromCorrelationNamephp php=php nullphp;
php php php php php php php php ifphp php(php!emptyphp(php$correlationNamephp)php)php php{
php php php php php php php php php php php php ifphp php(arrayphp_keyphp_existsphp(php$correlationNamephp,php php$thisphp-php>php_partsphp[selfphp:php:FROMphp]php)php)php php{
php php php php php php php php php php php php php php php php php/php*php*
php php php php php php php php php php php php php php php php php php*php php@seephp Zendphp_Dbphp_Selectphp_Exception
php php php php php php php php php php php php php php php php php php*php/
php php php php php php php php php php php php php php php php requirephp_oncephp php'Zendphp/Dbphp/Selectphp/Exceptionphp.phpphp'php;
php php php php php php php php php php php php php php php php throwphp newphp Zendphp_Dbphp_Selectphp_Exceptionphp(php"Youphp cannotphp definephp aphp correlationphp namephp php'php$correlationNamephp'php morephp thanphp oncephp"php)php;
php php php php php php php php php php php php php}

php php php php php php php php php php php php ifphp php(php$typephp php=php=php selfphp:php:FROMphp)php php{
php php php php php php php php php php php php php php php php php/php/php appendphp thisphp fromphp afterphp thephp lastphp fromphp joinType
php php php php php php php php php php php php php php php php php$tmpFromPartsphp php=php php$thisphp-php>php_partsphp[selfphp:php:FROMphp]php;
php php php php php php php php php php php php php php php php php$thisphp-php>php_partsphp[selfphp:php:FROMphp]php php=php arrayphp(php)php;
php php php php php php php php php php php php php php php php php/php/php movephp allphp thephp fromsphp ontophp thephp stack
php php php php php php php php php php php php php php php php whilephp php(php$tmpFromPartsphp)php php{
php php php php php php php php php php php php php php php php php php php php php$currentCorrelationNamephp php=php keyphp(php$tmpFromPartsphp)php;
php php php php php php php php php php php php php php php php php php php php ifphp php(php$tmpFromPartsphp[php$currentCorrelationNamephp]php[php'joinTypephp'php]php php!php=php selfphp:php:FROMphp)php php{
php php php php php php php php php php php php php php php php php php php php php php php php breakphp;
php php php php php php php php php php php php php php php php php php php php php}
php php php php php php php php php php php php php php php php php php php php php$lastFromCorrelationNamephp php=php php$currentCorrelationNamephp;
php php php php php php php php php php php php php php php php php php php php php$thisphp-php>php_partsphp[selfphp:php:FROMphp]php[php$currentCorrelationNamephp]php php=php arrayphp_shiftphp(php$tmpFromPartsphp)php;
php php php php php php php php php php php php php php php php php}
php php php php php php php php php php php php php}php elsephp php{
php php php php php php php php php php php php php php php php php$tmpFromPartsphp php=php arrayphp(php)php;
php php php php php php php php php php php php php}
php php php php php php php php php php php php php$thisphp-php>php_partsphp[selfphp:php:FROMphp]php[php$correlationNamephp]php php=php arrayphp(
php php php php php php php php php php php php php php php php php'joinTypephp'php php php php php php php=php>php php$typephp,
php php php php php php php php php php php php php php php php php'schemaphp'php php php php php php php php php=php>php php$schemaphp,
php php php php php php php php php php php php php php php php php'tableNamephp'php php php php php php=php>php php$tableNamephp,
php php php php php php php php php php php php php php php php php'joinConditionphp'php php=php>php php$cond
php php php php php php php php php php php php php php php php php)php;
php php php php php php php php php php php php whilephp php(php$tmpFromPartsphp)php php{
php php php php php php php php php php php php php php php php php$currentCorrelationNamephp php=php keyphp(php$tmpFromPartsphp)php;
php php php php php php php php php php php php php php php php php$thisphp-php>php_partsphp[selfphp:php:FROMphp]php[php$currentCorrelationNamephp]php php=php arrayphp_shiftphp(php$tmpFromPartsphp)php;
php php php php php php php php php php php php php}
php php php php php php php php php}

php php php php php php php php php/php/php addphp tophp thephp columnsphp fromphp thisphp joinedphp table
php php php php php php php php ifphp php(php$typephp php=php=php selfphp:php:FROMphp php&php&php php$lastFromCorrelationNamephp php=php=php nullphp)php php{
php php php php php php php php php php php php php$lastFromCorrelationNamephp php=php truephp;
php php php php php php php php php}
php php php php php php php php php$thisphp-php>php_tableColsphp(php$correlationNamephp,php php$colsphp,php php$lastFromCorrelationNamephp)php;

php php php php php php php php returnphp php$thisphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Handlephp JOINphp.php.php.php USINGphp.php.php.php syntax
php php php php php php*
php php php php php php*php Thisphp isphp functionalityphp identicalphp tophp thephp existingphp JOINphp methodsphp,php however
php php php php php php*php thephp joinphp conditionphp canphp bephp passedphp asphp aphp singlephp columnphp namephp.php Thisphp method
php php php php php php*php thenphp completesphp thephp ONphp conditionphp byphp usingphp thephp samephp fieldphp forphp thephp FROM
php php php php php php*php tablephp andphp thephp JOINphp tablephp.
php php php php php php*
php php php php php php*php php<codephp>
php php php php php php*php php$selectphp php=php php$dbphp-php>selectphp(php)php-php>fromphp(php'tablephp1php'php)
php php php php php php*php php php php php php php php php php php php php php php php php php php php php php php php php-php>joinUsingphp(php'tablephp2php'php,php php'columnphp1php'php)php;
php php php php php php*
php php php php php php*php php/php/php SELECTphp php*php FROMphp tablephp1php JOINphp tablephp2php ONphp tablephp1php.columnphp1php php=php tablephp2php.columnphp2
php php php php php php*php <php/codephp>
php php php php php php*
php php php php php php*php Thesephp joinsphp arephp calledphp byphp thephp developerphp simplyphp byphp addingphp php'Usingphp'php tophp the
php php php php php php*php methodphp namephp.php Ephp.gphp.
php php php php php php*php php*php joinUsing
php php php php php php*php php*php joinInnerUsing
php php php php php php*php php*php joinFullUsing
php php php php php php*php php*php joinRightUsing
php php php php php php*php php*php joinLeftUsing
php php php php php php*
php php php php php php*php php@returnphp Zendphp_Dbphp_Selectphp Thisphp Zendphp_Dbphp_Selectphp objectphp.
php php php php php php*php/
php php php php publicphp functionphp php_joinUsingphp(php$typephp,php php$namephp,php php$condphp,php php$colsphp php=php php'php*php'php,php php$schemaphp php=php nullphp)
php php php php php{
php php php php php php php php ifphp php(emptyphp(php$thisphp-php>php_partsphp[selfphp:php:FROMphp]php)php)php php{
php php php php php php php php php php php php requirephp_oncephp php'Zendphp/Dbphp/Selectphp/Exceptionphp.phpphp'php;
php php php php php php php php php php php php throwphp newphp Zendphp_Dbphp_Selectphp_Exceptionphp(php"Youphp canphp onlyphp performphp aphp joinUsingphp afterphp specifyingphp aphp FROMphp tablephp"php)php;
php php php php php php php php php}

php php php php php php php php php$joinphp php php=php php$thisphp-php>php_adapterphp-php>quoteIdentifierphp(keyphp(php$thisphp-php>php_partsphp[selfphp:php:FROMphp]php)php,php truephp)php;
php php php php php php php php php$fromphp php php=php php$thisphp-php>php_adapterphp-php>quoteIdentifierphp(php$thisphp-php>php_uniqueCorrelationphp(php$namephp)php,php truephp)php;

php php php php php php php php php$condphp1php php=php php$fromphp php.php php'php.php'php php.php php$condphp;
php php php php php php php php php$condphp2php php=php php$joinphp php.php php'php.php'php php.php php$condphp;
php php php php php php php php php$condphp php php=php php$condphp1php php.php php'php php=php php'php php.php php$condphp2php;

php php php php php php php php returnphp php$thisphp-php>php_joinphp(php$typephp,php php$namephp,php php$condphp,php php$colsphp,php php$schemaphp)php;
php php php php php}

php php php php php/php*php*
php php php php php php*php Generatephp aphp uniquephp correlationphp name
php php php php php php*
php php php php php php*php php@paramphp stringphp|arrayphp php$namephp Aphp qualifiedphp identifierphp.
php php php php php php*php php@returnphp stringphp Aphp uniquephp correlationphp namephp.
php php php php php php*php/
php php php php privatephp functionphp php_uniqueCorrelationphp(php$namephp)
php php php php php{
php php php php php php php php ifphp php(isphp_arrayphp(php$namephp)php)php php{
php php php php php php php php php php php php php$cphp php=php endphp(php$namephp)php;
php php php php php php php php php}php elsephp php{
php php php php php php php php php php php php php/php/php Extractphp justphp thephp lastphp namephp ofphp aphp qualifiedphp tablephp name
php php php php php php php php php php php php php$dotphp php=php strrposphp(php$namephp,php'php.php'php)php;
php php php php php php php php php php php php php$cphp php=php php(php$dotphp php=php=php=php falsephp)php php?php php$namephp php:php substrphp(php$namephp,php php$dotphp+php1php)php;
php php php php php php php php php}
php php php php php php php php forphp php(php$iphp php=php php2php;php arrayphp_keyphp_existsphp(php$cphp,php php$thisphp-php>php_partsphp[selfphp:php:FROMphp]php)php;php php+php+php$iphp)php php{
php php php php php php php php php php php php php$cphp php=php php$namephp php.php php'php_php'php php.php php(stringphp)php php$iphp;
php php php php php php php php php}
php php php php php php php php returnphp php$cphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Addsphp tophp thephp internalphp tablephp-tophp-columnphp mappingphp arrayphp.
php php php php php php*
php php php php php php*php php@paramphp php stringphp php$tblphp Thephp tablephp/joinphp thephp columnsphp comephp fromphp.
php php php php php php*php php@paramphp php arrayphp|stringphp php$colsphp Thephp listphp ofphp columnsphp;php preferablyphp as
php php php php php php*php anphp arrayphp,php butphp possiblyphp asphp aphp stringphp containingphp onephp columnphp.
php php php php php php*php php@paramphp php boolphp|stringphp Truephp ifphp itphp shouldphp bephp prependedphp,php aphp correlationphp namephp ifphp itphp shouldphp bephp inserted
php php php php php php*php php@returnphp void
php php php php php php*php/
php php php php protectedphp functionphp php_tableColsphp(php$correlationNamephp,php php$colsphp,php php$afterCorrelationNamephp php=php nullphp)
php php php php php{
php php php php php php php php ifphp php(php!isphp_arrayphp(php$colsphp)php)php php{
php php php php php php php php php php php php php$colsphp php=php arrayphp(php$colsphp)php;
php php php php php php php php php}

php php php php php php php php ifphp php(php$correlationNamephp php=php=php nullphp)php php{
php php php php php php php php php php php php php$correlationNamephp php=php php'php'php;
php php php php php php php php php}

php php php php php php php php php$columnValuesphp php=php arrayphp(php)php;

php php php php php php php php foreachphp php(arrayphp_filterphp(php$colsphp)php asphp php$aliasphp php=php>php php$colphp)php php{
php php php php php php php php php php php php php$currentCorrelationNamephp php=php php$correlationNamephp;
php php php php php php php php php php php php ifphp php(isphp_stringphp(php$colphp)php)php php{
php php php php php php php php php php php php php php php php php/php/php Checkphp forphp aphp columnphp matchingphp php"php<columnphp>php ASphp php<aliasphp>php"php andphp extractphp thephp aliasphp name
php php php php php php php php php php php php php php php php ifphp php(pregphp_matchphp(php'php/php^php(php.php+php)php\sphp+php'php php.php selfphp:php:SQLphp_ASphp php.php php'php\sphp+php(php.php+php)php$php/iphp'php,php php$colphp,php php$mphp)php)php php{
php php php php php php php php php php php php php php php php php php php php php$colphp php=php php$mphp[php1php]php;
php php php php php php php php php php php php php php php php php php php php php$aliasphp php=php php$mphp[php2php]php;
php php php php php php php php php php php php php php php php php}
php php php php php php php php php php php php php php php php php/php/php Checkphp forphp columnsphp thatphp lookphp likephp functionsphp andphp convertphp tophp Zendphp_Dbphp_Expr
php php php php php php php php php php php php php php php php ifphp php(pregphp_matchphp(php'php/php\php(php.php*php\php)php/php'php,php php$colphp)php)php php{
php php php php php php php php php php php php php php php php php php php php php$colphp php=php newphp Zendphp_Dbphp_Exprphp(php$colphp)php;
php php php php php php php php php php php php php php php php php}php elseifphp php(pregphp_matchphp(php'php/php(php.php+php)php\php.php(php.php+php)php/php'php,php php$colphp,php php$mphp)php)php php{
php php php php php php php php php php php php php php php php php php php php php$currentCorrelationNamephp php=php php$mphp[php1php]php;
php php php php php php php php php php php php php php php php php php php php php$colphp php=php php$mphp[php2php]php;
php php php php php php php php php php php php php php php php php}
php php php php php php php php php php php php php}
php php php php php php php php php php php php php$columnValuesphp[php]php php=php arrayphp(php$currentCorrelationNamephp,php php$colphp,php isphp_stringphp(php$aliasphp)php php?php php$aliasphp php:php nullphp)php;
php php php php php php php php php}

php php php php php php php php ifphp php(php$columnValuesphp)php php{

php php php php php php php php php php php php php/php/php shouldphp wephp attemptphp tophp prependphp orphp insertphp thesephp valuesphp?
php php php php php php php php php php php php ifphp php(php$afterCorrelationNamephp php=php=php=php truephp php|php|php isphp_stringphp(php$afterCorrelationNamephp)php)php php{
php php php php php php php php php php php php php php php php php$tmpColumnsphp php=php php$thisphp-php>php_partsphp[selfphp:php:COLUMNSphp]php;
php php php php php php php php php php php php php php php php php$thisphp-php>php_partsphp[selfphp:php:COLUMNSphp]php php=php arrayphp(php)php;
php php php php php php php php php php php php php}php elsephp php{
php php php php php php php php php php php php php php php php php$tmpColumnsphp php=php arrayphp(php)php;
php php php php php php php php php php php php php}

php php php php php php php php php php php php php/php/php findphp thephp correlationphp namephp tophp insertphp after
php php php php php php php php php php php php ifphp php(isphp_stringphp(php$afterCorrelationNamephp)php)php php{
php php php php php php php php php php php php php php php php whilephp php(php$tmpColumnsphp)php php{
php php php php php php php php php php php php php php php php php php php php php$thisphp-php>php_partsphp[selfphp:php:COLUMNSphp]php[php]php php=php php$currentColumnphp php=php arrayphp_shiftphp(php$tmpColumnsphp)php;
php php php php php php php php php php php php php php php php php php php php ifphp php(php$currentColumnphp[php0php]php php=php=php php$afterCorrelationNamephp)php php{
php php php php php php php php php php php php php php php php php php php php php php php php breakphp;
php php php php php php php php php php php php php php php php php php php php php}
php php php php php php php php php php php php php php php php php}
php php php php php php php php php php php php php}

php php php php php php php php php php php php php/php/php applyphp currentphp valuesphp tophp currentphp stack
php php php php php php php php php php php php foreachphp php(php$columnValuesphp asphp php$columnValuephp)php php{
php php php php php php php php php php php php php php php php arrayphp_pushphp(php$thisphp-php>php_partsphp[selfphp:php:COLUMNSphp]php,php php$columnValuephp)php;
php php php php php php php php php php php php php}

php php php php php php php php php php php php php/php/php finishphp ensuringphp thatphp allphp previousphp valuesphp arephp appliedphp php(ifphp theyphp existphp)
php php php php php php php php php php php php whilephp php(php$tmpColumnsphp)php php{
php php php php php php php php php php php php php php php php arrayphp_pushphp(php$thisphp-php>php_partsphp[selfphp:php:COLUMNSphp]php,php arrayphp_shiftphp(php$tmpColumnsphp)php)php;
php php php php php php php php php php php php php}
php php php php php php php php php}
php php php php php}

php php php php php/php*php*
php php php php php php*php Internalphp functionphp forphp creatingphp thephp wherephp clause
php php php php php php*
php php php php php php*php php@paramphp stringphp php php php$condition
php php php php php php*php php@paramphp mixedphp php php php php$valuephp php optional
php php php php php php*php php@paramphp stringphp php php php$typephp php php optional
php php php php php php*php php@paramphp booleanphp php php$boolphp php truephp php=php ANDphp,php falsephp php=php OR
php php php php php php*php php@returnphp stringphp php clause
php php php php php php*php/
php php php php protectedphp functionphp php_wherephp(php$conditionphp,php php$valuephp php=php nullphp,php php$typephp php=php nullphp,php php$boolphp php=php truephp)
php php php php php{
php php php php php php php php ifphp php(countphp(php$thisphp-php>php_partsphp[selfphp:php:UNIONphp]php)php)php php{
php php php php php php php php php php php php requirephp_oncephp php'Zendphp/Dbphp/Selectphp/Exceptionphp.phpphp'php;
php php php php php php php php php php php php throwphp newphp Zendphp_Dbphp_Selectphp_Exceptionphp(php"Invalidphp usephp ofphp wherephp clausephp withphp php"php php.php selfphp:php:SQLphp_UNIONphp)php;
php php php php php php php php php}

php php php php php php php php ifphp php(php$valuephp php!php=php=php nullphp)php php{
php php php php php php php php php php php php php$conditionphp php=php php$thisphp-php>php_adapterphp-php>quoteIntophp(php$conditionphp,php php$valuephp,php php$typephp)php;
php php php php php php php php php}

php php php php php php php php php$condphp php=php php"php"php;
php php php php php php php php ifphp php(php$thisphp-php>php_partsphp[selfphp:php:WHEREphp]php)php php{
php php php php php php php php php php php php ifphp php(php$boolphp php=php=php=php truephp)php php{
php php php php php php php php php php php php php php php php php$condphp php=php selfphp:php:SQLphp_ANDphp php.php php'php php'php;
php php php php php php php php php php php php php}php elsephp php{
php php php php php php php php php php php php php php php php php$condphp php=php selfphp:php:SQLphp_ORphp php.php php'php php'php;
php php php php php php php php php php php php php}
php php php php php php php php php}

php php php php php php php php returnphp php$condphp php.php php"php(php$conditionphp)php"php;
php php php php php}

php php php php php/php*php*
php php php php php php*php php@returnphp array
php php php php php php*php/
php php php php protectedphp functionphp php_getDummyTablephp(php)
php php php php php{
php php php php php php php php returnphp arrayphp(php)php;
php php php php php}

php php php php php/php*php*
php php php php php php*php Returnphp aphp quotedphp schemaphp name
php php php php php php*
php php php php php php*php php@paramphp stringphp php php php$schemaphp php Thephp schemaphp namephp OPTIONAL
php php php php php php*php php@returnphp stringphp|null
php php php php php php*php/
php php php php protectedphp functionphp php_getQuotedSchemaphp(php$schemaphp php=php nullphp)
php php php php php{
php php php php php php php php ifphp php(php$schemaphp php=php=php=php nullphp)php php{
php php php php php php php php php php php php returnphp nullphp;
php php php php php php php php php}
php php php php php php php php returnphp php$thisphp-php>php_adapterphp-php>quoteIdentifierphp(php$schemaphp,php truephp)php php.php php'php.php'php;
php php php php php}

php php php php php/php*php*
php php php php php php*php Returnphp aphp quotedphp tablephp name
php php php php php php*
php php php php php php*php php@paramphp stringphp php php php$tableNamephp php php php php php php php Thephp tablephp name
php php php php php php*php php@paramphp stringphp php php php$correlationNamephp php Thephp correlationphp namephp OPTIONAL
php php php php php php*php php@returnphp string
php php php php php php*php/
php php php php protectedphp functionphp php_getQuotedTablephp(php$tableNamephp,php php$correlationNamephp php=php nullphp)
php php php php php{
php php php php php php php php returnphp php$thisphp-php>php_adapterphp-php>quoteTableAsphp(php$tableNamephp,php php$correlationNamephp,php truephp)php;
php php php php php}

php php php php php/php*php*
php php php php php php*php Renderphp DISTINCTphp clause
php php php php php php*
php php php php php php*php php@paramphp stringphp php php php$sqlphp SQLphp query
php php php php php php*php php@returnphp string
php php php php php php*php/
php php php php protectedphp functionphp php_renderDistinctphp(php$sqlphp)
php php php php php{
php php php php php php php php ifphp php(php$thisphp-php>php_partsphp[selfphp:php:DISTINCTphp]php)php php{
php php php php php php php php php php php php php$sqlphp php.php=php php'php php'php php.php selfphp:php:SQLphp_DISTINCTphp;
php php php php php php php php php}

php php php php php php php php returnphp php$sqlphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Renderphp DISTINCTphp clause
php php php php php php*
php php php php php php*php php@paramphp stringphp php php php$sqlphp SQLphp query
php php php php php php*php php@returnphp stringphp|null
php php php php php php*php/
php php php php protectedphp functionphp php_renderColumnsphp(php$sqlphp)
php php php php php{
php php php php php php php php ifphp php(php!countphp(php$thisphp-php>php_partsphp[selfphp:php:COLUMNSphp]php)php)php php{
php php php php php php php php php php php php returnphp nullphp;
php php php php php php php php php}

php php php php php php php php php$columnsphp php=php arrayphp(php)php;
php php php php php php php php foreachphp php(php$thisphp-php>php_partsphp[selfphp:php:COLUMNSphp]php asphp php$columnEntryphp)php php{
php php php php php php php php php php php php listphp(php$correlationNamephp,php php$columnphp,php php$aliasphp)php php=php php$columnEntryphp;
php php php php php php php php php php php php ifphp php(php$columnphp instanceofphp Zendphp_Dbphp_Exprphp)php php{
php php php php php php php php php php php php php php php php php$columnsphp[php]php php=php php$thisphp-php>php_adapterphp-php>quoteColumnAsphp(php$columnphp,php php$aliasphp,php truephp)php;
php php php php php php php php php php php php php}php elsephp php{
php php php php php php php php php php php php php php php php ifphp php(php$columnphp php=php=php selfphp:php:SQLphp_WILDCARDphp)php php{
php php php php php php php php php php php php php php php php php php php php php$columnphp php=php newphp Zendphp_Dbphp_Exprphp(selfphp:php:SQLphp_WILDCARDphp)php;
php php php php php php php php php php php php php php php php php php php php php$aliasphp php=php nullphp;
php php php php php php php php php php php php php php php php php}
php php php php php php php php php php php php php php php php ifphp php(emptyphp(php$correlationNamephp)php)php php{
php php php php php php php php php php php php php php php php php php php php php$columnsphp[php]php php=php php$thisphp-php>php_adapterphp-php>quoteColumnAsphp(php$columnphp,php php$aliasphp,php truephp)php;
php php php php php php php php php php php php php php php php php}php elsephp php{
php php php php php php php php php php php php php php php php php php php php php$columnsphp[php]php php=php php$thisphp-php>php_adapterphp-php>quoteColumnAsphp(arrayphp(php$correlationNamephp,php php$columnphp)php,php php$aliasphp,php truephp)php;
php php php php php php php php php php php php php php php php php}
php php php php php php php php php php php php php}
php php php php php php php php php}

php php php php php php php php returnphp php$sqlphp php.php=php php'php php'php php.php implodephp(php'php,php php'php,php php$columnsphp)php;
php php php php php}

php php php php php/php*php*
php php php php php php*php Renderphp FROMphp clause
php php php php php php*
php php php php php php*php php@paramphp stringphp php php php$sqlphp SQLphp query
php php php php php php*php php@returnphp string
php php php php php php*php/
php php php php protectedphp functionphp php_renderFromphp(php$sqlphp)
php php php php php{
php php php php php php php php php/php*
php php php php php php php php php php*php Ifphp nophp tablephp specifiedphp,php usephp RDBMSphp-dependentphp solution
php php php php php php php php php php*php forphp tablephp-lessphp queryphp.php php ephp.gphp.php DUALphp inphp Oraclephp.
php php php php php php php php php php*php/
php php php php php php php php ifphp php(emptyphp(php$thisphp-php>php_partsphp[selfphp:php:FROMphp]php)php)php php{
php php php php php php php php php php php php php$thisphp-php>php_partsphp[selfphp:php:FROMphp]php php=php php$thisphp-php>php_getDummyTablephp(php)php;
php php php php php php php php php}

php php php php php php php php php$fromphp php=php arrayphp(php)php;

php php php php php php php php foreachphp php(php$thisphp-php>php_partsphp[selfphp:php:FROMphp]php asphp php$correlationNamephp php=php>php php$tablephp)php php{
php php php php php php php php php php php php php$tmpphp php=php php'php'php;

php php php php php php php php php php php php php$joinTypephp php=php php(php$tablephp[php'joinTypephp'php]php php=php=php selfphp:php:FROMphp)php php?php selfphp:php:INNERphp_JOINphp php:php php$tablephp[php'joinTypephp'php]php;

php php php php php php php php php php php php php/php/php Addphp joinphp clausephp php(ifphp applicablephp)
php php php php php php php php php php php php ifphp php(php!php emptyphp(php$fromphp)php)php php{
php php php php php php php php php php php php php php php php php$tmpphp php.php=php php'php php'php php.php strtoupperphp(php$joinTypephp)php php.php php'php php'php;
php php php php php php php php php php php php php}

php php php php php php php php php php php php php$tmpphp php.php=php php$thisphp-php>php_getQuotedSchemaphp(php$tablephp[php'schemaphp'php]php)php;
php php php php php php php php php php php php php$tmpphp php.php=php php$thisphp-php>php_getQuotedTablephp(php$tablephp[php'tableNamephp'php]php,php php$correlationNamephp)php;

php php php php php php php php php php php php php/php/php Addphp joinphp conditionsphp php(ifphp applicablephp)
php php php php php php php php php php php php ifphp php(php!emptyphp(php$fromphp)php php&php&php php!php emptyphp(php$tablephp[php'joinConditionphp'php]php)php)php php{
php php php php php php php php php php php php php php php php php$tmpphp php.php=php php'php php'php php.php selfphp:php:SQLphp_ONphp php.php php'php php'php php.php php$tablephp[php'joinConditionphp'php]php;
php php php php php php php php php php php php php}

php php php php php php php php php php php php php/php/php Addphp thephp tablephp namephp andphp conditionphp addphp tophp thephp list
php php php php php php php php php php php php php$fromphp[php]php php=php php$tmpphp;
php php php php php php php php php}

php php php php php php php php php/php/php Addphp thephp listphp ofphp allphp joins
php php php php php php php php ifphp php(php!emptyphp(php$fromphp)php)php php{
php php php php php php php php php php php php php$sqlphp php.php=php php'php php'php php.php selfphp:php:SQLphp_FROMphp php.php php'php php'php php.php implodephp(php"php\nphp"php,php php$fromphp)php;
php php php php php php php php php}

php php php php php php php php returnphp php$sqlphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Renderphp UNIONphp query
php php php php php php*
php php php php php php*php php@paramphp stringphp php php php$sqlphp SQLphp query
php php php php php php*php php@returnphp string
php php php php php php*php/
php php php php protectedphp functionphp php_renderUnionphp(php$sqlphp)
php php php php php{
php php php php php php php php ifphp php(php$thisphp-php>php_partsphp[selfphp:php:UNIONphp]php)php php{
php php php php php php php php php php php php php$partsphp php=php countphp(php$thisphp-php>php_partsphp[selfphp:php:UNIONphp]php)php;
php php php php php php php php php php php php foreachphp php(php$thisphp-php>php_partsphp[selfphp:php:UNIONphp]php asphp php$cntphp php=php>php php$unionphp)php php{
php php php php php php php php php php php php php php php php listphp(php$targetphp,php php$typephp)php php=php php$unionphp;
php php php php php php php php php php php php php php php php ifphp php(php$targetphp instanceofphp Zendphp_Dbphp_Selectphp)php php{
php php php php php php php php php php php php php php php php php php php php php$targetphp php=php php$targetphp-php>assemblephp(php)php;
php php php php php php php php php php php php php php php php php}
php php php php php php php php php php php php php php php php php$sqlphp php.php=php php$targetphp;
php php php php php php php php php php php php php php php php ifphp php(php$cntphp <php php$partsphp php-php php1php)php php{
php php php php php php php php php php php php php php php php php php php php php$sqlphp php.php=php php'php php'php php.php php$typephp php.php php'php php'php;
php php php php php php php php php php php php php php php php php}
php php php php php php php php php php php php php}
php php php php php php php php php}

php php php php php php php php returnphp php$sqlphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Renderphp WHEREphp clause
php php php php php php*
php php php php php php*php php@paramphp stringphp php php php$sqlphp SQLphp query
php php php php php php*php php@returnphp string
php php php php php php*php/
php php php php protectedphp functionphp php_renderWherephp(php$sqlphp)
php php php php php{
php php php php php php php php ifphp php(php$thisphp-php>php_partsphp[selfphp:php:FROMphp]php php&php&php php$thisphp-php>php_partsphp[selfphp:php:WHEREphp]php)php php{
php php php php php php php php php php php php php$sqlphp php.php=php php'php php'php php.php selfphp:php:SQLphp_WHEREphp php.php php'php php'php php.php php implodephp(php'php php'php,php php$thisphp-php>php_partsphp[selfphp:php:WHEREphp]php)php;
php php php php php php php php php}

php php php php php php php php returnphp php$sqlphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Renderphp GROUPphp clause
php php php php php php*
php php php php php php*php php@paramphp stringphp php php php$sqlphp SQLphp query
php php php php php php*php php@returnphp string
php php php php php php*php/
php php php php protectedphp functionphp php_renderGroupphp(php$sqlphp)
php php php php php{
php php php php php php php php ifphp php(php$thisphp-php>php_partsphp[selfphp:php:FROMphp]php php&php&php php$thisphp-php>php_partsphp[selfphp:php:GROUPphp]php)php php{
php php php php php php php php php php php php php$groupphp php=php arrayphp(php)php;
php php php php php php php php php php php php foreachphp php(php$thisphp-php>php_partsphp[selfphp:php:GROUPphp]php asphp php$termphp)php php{
php php php php php php php php php php php php php php php php php$groupphp[php]php php=php php$thisphp-php>php_adapterphp-php>quoteIdentifierphp(php$termphp,php truephp)php;
php php php php php php php php php php php php php}
php php php php php php php php php php php php php$sqlphp php.php=php php'php php'php php.php selfphp:php:SQLphp_GROUPphp_BYphp php.php php'php php'php php.php implodephp(php"php,php\nphp\tphp"php,php php$groupphp)php;
php php php php php php php php php}

php php php php php php php php returnphp php$sqlphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Renderphp HAVINGphp clause
php php php php php php*
php php php php php php*php php@paramphp stringphp php php php$sqlphp SQLphp query
php php php php php php*php php@returnphp string
php php php php php php*php/
php php php php protectedphp functionphp php_renderHavingphp(php$sqlphp)
php php php php php{
php php php php php php php php ifphp php(php$thisphp-php>php_partsphp[selfphp:php:FROMphp]php php&php&php php$thisphp-php>php_partsphp[selfphp:php:HAVINGphp]php)php php{
php php php php php php php php php php php php php$sqlphp php.php=php php'php php'php php.php selfphp:php:SQLphp_HAVINGphp php.php php'php php'php php.php implodephp(php'php php'php,php php$thisphp-php>php_partsphp[selfphp:php:HAVINGphp]php)php;
php php php php php php php php php}

php php php php php php php php returnphp php$sqlphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Renderphp ORDERphp clause
php php php php php php*
php php php php php php*php php@paramphp stringphp php php php$sqlphp SQLphp query
php php php php php php*php php@returnphp string
php php php php php php*php/
php php php php protectedphp functionphp php_renderOrderphp(php$sqlphp)
php php php php php{
php php php php php php php php ifphp php(php$thisphp-php>php_partsphp[selfphp:php:ORDERphp]php)php php{
php php php php php php php php php php php php php$orderphp php=php arrayphp(php)php;
php php php php php php php php php php php php foreachphp php(php$thisphp-php>php_partsphp[selfphp:php:ORDERphp]php asphp php$termphp)php php{
php php php php php php php php php php php php php php php php ifphp php(isphp_arrayphp(php$termphp)php)php php{
php php php php php php php php php php php php php php php php php php php php ifphp(isphp_numericphp(php$termphp[php0php]php)php php&php&php strvalphp(intvalphp(php$termphp[php0php]php)php)php php=php=php php$termphp[php0php]php)php php{
php php php php php php php php php php php php php php php php php php php php php php php php php$orderphp[php]php php=php php(intphp)trimphp(php$termphp[php0php]php)php php.php php'php php'php php.php php$termphp[php1php]php;
php php php php php php php php php php php php php php php php php php php php php}php elsephp php{
php php php php php php php php php php php php php php php php php php php php php php php php php$orderphp[php]php php=php php$thisphp-php>php_adapterphp-php>quoteIdentifierphp(php$termphp[php0php]php,php truephp)php php.php php'php php'php php.php php$termphp[php1php]php;
php php php php php php php php php php php php php php php php php php php php php}
php php php php php php php php php php php php php php php php php}php elsephp ifphp php(isphp_numericphp(php$termphp)php php&php&php strvalphp(intvalphp(php$termphp)php)php php=php=php php$termphp)php php{
php php php php php php php php php php php php php php php php php php php php php$orderphp[php]php php=php php(intphp)trimphp(php$termphp)php;
php php php php php php php php php php php php php php php php php}php elsephp php{
php php php php php php php php php php php php php php php php php php php php php$orderphp[php]php php=php php$thisphp-php>php_adapterphp-php>quoteIdentifierphp(php$termphp,php truephp)php;
php php php php php php php php php php php php php php php php php}
php php php php php php php php php php php php php}
php php php php php php php php php php php php php$sqlphp php.php=php php'php php'php php.php selfphp:php:SQLphp_ORDERphp_BYphp php.php php'php php'php php.php implodephp(php'php,php php'php,php php$orderphp)php;
php php php php php php php php php}

php php php php php php php php returnphp php$sqlphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Renderphp LIMITphp OFFSETphp clause
php php php php php php*
php php php php php php*php php@paramphp stringphp php php php$sqlphp SQLphp query
php php php php php php*php php@returnphp string
php php php php php php*php/
php php php php protectedphp functionphp php_renderLimitoffsetphp(php$sqlphp)
php php php php php{
php php php php php php php php php$countphp php=php php0php;
php php php php php php php php php$offsetphp php=php php0php;

php php php php php php php php ifphp php(php!emptyphp(php$thisphp-php>php_partsphp[selfphp:php:LIMITphp_OFFSETphp]php)php)php php{
php php php php php php php php php php php php php$offsetphp php=php php(intphp)php php$thisphp-php>php_partsphp[selfphp:php:LIMITphp_OFFSETphp]php;
php php php php php php php php php php php php php$countphp php=php PHPphp_INTphp_MAXphp;
php php php php php php php php php}

php php php php php php php php ifphp php(php!emptyphp(php$thisphp-php>php_partsphp[selfphp:php:LIMITphp_COUNTphp]php)php)php php{
php php php php php php php php php php php php php$countphp php=php php(intphp)php php$thisphp-php>php_partsphp[selfphp:php:LIMITphp_COUNTphp]php;
php php php php php php php php php}

php php php php php php php php php/php*
php php php php php php php php php php*php Addphp limitsphp clause
php php php php php php php php php php*php/
php php php php php php php php ifphp php(php$countphp php>php php0php)php php{
php php php php php php php php php php php php php$sqlphp php=php trimphp(php$thisphp-php>php_adapterphp-php>limitphp(php$sqlphp,php php$countphp,php php$offsetphp)php)php;
php php php php php php php php php}

php php php php php php php php returnphp php$sqlphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Renderphp FORphp UPDATEphp clause
php php php php php php*
php php php php php php*php php@paramphp stringphp php php php$sqlphp SQLphp query
php php php php php php*php php@returnphp string
php php php php php php*php/
php php php php protectedphp functionphp php_renderForupdatephp(php$sqlphp)
php php php php php{
php php php php php php php php ifphp php(php$thisphp-php>php_partsphp[selfphp:php:FORphp_UPDATEphp]php)php php{
php php php php php php php php php php php php php$sqlphp php.php=php php'php php'php php.php selfphp:php:SQLphp_FORphp_UPDATEphp;
php php php php php php php php php}

php php php php php php php php returnphp php$sqlphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Turnphp magicphp functionphp callsphp intophp nonphp-magicphp functionphp calls
php php php php php php*php forphp joinUsingphp syntax
php php php php php php*
php php php php php php*php php@paramphp stringphp php$method
php php php php php php*php php@paramphp arrayphp php$argsphp OPTIONALphp Zendphp_Dbphp_Tablephp_Selectphp queryphp modifier
php php php php php php*php php@returnphp Zendphp_Dbphp_Select
php php php php php php*php php@throwsphp Zendphp_Dbphp_Selectphp_Exceptionphp Ifphp anphp invalidphp methodphp isphp calledphp.
php php php php php php*php/
php php php php publicphp functionphp php_php_callphp(php$methodphp,php arrayphp php$argsphp)
php php php php php{
php php php php php php php php php$matchesphp php=php arrayphp(php)php;

php php php php php php php php php/php*php*
php php php php php php php php php php*php Recognizephp methodsphp forphp Hasphp-Manyphp casesphp:
php php php php php php php php php php*php findParentphp<Classphp>php(php)
php php php php php php php php php php*php findParentphp<Classphp>Byphp<Rulephp>php(php)
php php php php php php php php php php*php Usephp thephp nonphp-greedyphp patternphp repeatphp modifierphp ephp.gphp.php php\wphp+php?
php php php php php php php php php php*php/
php php php php php php php php ifphp php(pregphp_matchphp(php'php/php^joinphp(php[aphp-zAphp-Zphp]php*php?php)Usingphp$php/php'php,php php$methodphp,php php$matchesphp)php)php php{
php php php php php php php php php php php php php$typephp php=php strtolowerphp(php$matchesphp[php1php]php)php;
php php php php php php php php php php php php ifphp php(php$typephp)php php{
php php php php php php php php php php php php php php php php php$typephp php.php=php php'php joinphp'php;
php php php php php php php php php php php php php php php php ifphp php(php!inphp_arrayphp(php$typephp,php selfphp:php:php$php_joinTypesphp)php)php php{
php php php php php php php php php php php php php php php php php php php php requirephp_oncephp php'Zendphp/Dbphp/Selectphp/Exceptionphp.phpphp'php;
php php php php php php php php php php php php php php php php php php php php throwphp newphp Zendphp_Dbphp_Selectphp_Exceptionphp(php"Unrecognizedphp methodphp php'php$methodphp(php)php'php"php)php;
php php php php php php php php php php php php php php php php php}
php php php php php php php php php php php php php php php php ifphp php(inphp_arrayphp(php$typephp,php arrayphp(selfphp:php:CROSSphp_JOINphp,php selfphp:php:NATURALphp_JOINphp)php)php)php php{
php php php php php php php php php php php php php php php php php php php php requirephp_oncephp php'Zendphp/Dbphp/Selectphp/Exceptionphp.phpphp'php;
php php php php php php php php php php php php php php php php php php php php throwphp newphp Zendphp_Dbphp_Selectphp_Exceptionphp(php"Cannotphp performphp aphp joinUsingphp withphp methodphp php'php$methodphp(php)php'php"php)php;
php php php php php php php php php php php php php php php php php}
php php php php php php php php php php php php php}php elsephp php{
php php php php php php php php php php php php php php php php php$typephp php=php selfphp:php:INNERphp_JOINphp;
php php php php php php php php php php php php php}
php php php php php php php php php php php php arrayphp_unshiftphp(php$argsphp,php php$typephp)php;
php php php php php php php php php php php php returnphp callphp_userphp_funcphp_arrayphp(arrayphp(php$thisphp,php php'php_joinUsingphp'php)php,php php$argsphp)php;
php php php php php php php php php}

php php php php php php php php requirephp_oncephp php'Zendphp/Dbphp/Selectphp/Exceptionphp.phpphp'php;
php php php php php php php php throwphp newphp Zendphp_Dbphp_Selectphp_Exceptionphp(php"Unrecognizedphp methodphp php'php$methodphp(php)php'php"php)php;
php php php php php}

php php php php php/php*php*
php php php php php php*php Implementsphp magicphp methodphp.
php php php php php php*
php php php php php php*php php@returnphp stringphp Thisphp objectphp asphp aphp SELECTphp stringphp.
php php php php php php*php/
php php php php publicphp functionphp php_php_toStringphp(php)
php php php php php{
php php php php php php php php tryphp php{
php php php php php php php php php php php php php$sqlphp php=php php$thisphp-php>assemblephp(php)php;
php php php php php php php php php}php catchphp php(Exceptionphp php$ephp)php php{
php php php php php php php php php php php php triggerphp_errorphp(php$ephp-php>getMessagephp(php)php,php Ephp_USERphp_WARNINGphp)php;
php php php php php php php php php php php php php$sqlphp php=php php'php'php;
php php php php php php php php php}
php php php php php php php php returnphp php(stringphp)php$sqlphp;
php php php php php}

php}
