<php?php
php/php*php*
php php*php Zendphp Framework
php php*
php php*php LICENSE
php php*
php php*php Thisphp sourcephp filephp isphp subjectphp tophp thephp newphp BSDphp licensephp thatphp isphp bundled
php php*php withphp thisphp packagephp inphp thephp filephp LICENSEphp.txtphp.
php php*php Itphp isphp alsophp availablephp throughphp thephp worldphp-widephp-webphp atphp thisphp URLphp:
php php*php httpphp:php/php/frameworkphp.zendphp.comphp/licensephp/newphp-bsd
php php*php Ifphp youphp didphp notphp receivephp aphp copyphp ofphp thephp licensephp andphp arephp unablephp to
php php*php obtainphp itphp throughphp thephp worldphp-widephp-webphp,php pleasephp sendphp anphp email
php php*php tophp licensephp@zendphp.comphp sophp wephp canphp sendphp youphp aphp copyphp immediatelyphp.
php php*
php php*php php@categoryphp php php Zend
php php*php php@packagephp php php php Zendphp_Db
php php*php php@subpackagephp Adapter
php php*php php@copyrightphp php Copyrightphp php(cphp)php php2php0php0php5php-php2php0php1php0php Zendphp Technologiesphp USAphp Incphp.php php(httpphp:php/php/wwwphp.zendphp.comphp)
php php*php php@licensephp php php php httpphp:php/php/frameworkphp.zendphp.comphp/licensephp/newphp-bsdphp php php php php Newphp BSDphp License
php php*php php@versionphp php php php php$Idphp:php Ibmphp.phpphp php2php0php0php9php6php php2php0php1php0php-php0php1php-php0php6php php0php2php:php0php5php:php0php9Zphp bkarwinphp php$
php php*php/


php/php*php*php php@seephp Zendphp_Dbphp_Adapterphp_Pdophp_Abstractphp php*php/
requirephp_oncephp php'Zendphp/Dbphp/Adapterphp/Pdophp/Abstractphp.phpphp'php;

php/php*php*php php@seephp Zendphp_Dbphp_Abstractphp_Pdophp_Ibmphp_Dbphp2php php*php/
requirephp_oncephp php'Zendphp/Dbphp/Adapterphp/Pdophp/Ibmphp/Dbphp2php.phpphp'php;

php/php*php*php php@seephp Zendphp_Dbphp_Abstractphp_Pdophp_Ibmphp_Idsphp php*php/
requirephp_oncephp php'Zendphp/Dbphp/Adapterphp/Pdophp/Ibmphp/Idsphp.phpphp'php;

php/php*php*php php@seephp Zendphp_Dbphp_Statementphp_Pdophp_Ibmphp php*php/
requirephp_oncephp php'Zendphp/Dbphp/Statementphp/Pdophp/Ibmphp.phpphp'php;


php/php*php*
php php*php php@categoryphp php php Zend
php php*php php@packagephp php php php Zendphp_Db
php php*php php@subpackagephp Adapter
php php*php php@copyrightphp php Copyrightphp php(cphp)php php2php0php0php5php-php2php0php1php0php Zendphp Technologiesphp USAphp Incphp.php php(httpphp:php/php/wwwphp.zendphp.comphp)
php php*php php@licensephp php php php httpphp:php/php/frameworkphp.zendphp.comphp/licensephp/newphp-bsdphp php php php php Newphp BSDphp License
php php*php/
classphp Zendphp_Dbphp_Adapterphp_Pdophp_Ibmphp extendsphp Zendphp_Dbphp_Adapterphp_Pdophp_Abstract
php{
php php php php php/php*php*
php php php php php php*php PDOphp typephp.
php php php php php php*
php php php php php php*php php@varphp string
php php php php php php*php/
php php php php protectedphp php$php_pdoTypephp php=php php'ibmphp'php;

php php php php php/php*php*
php php php php php php*php Thephp IBMphp dataphp serverphp connectedphp to
php php php php php php*
php php php php php php*php php@varphp string
php php php php php php*php/
php php php php protectedphp php$php_serverTypephp php=php nullphp;

php php php php php/php*php*
php php php php php php*php Keysphp arephp UPPERCASEphp SQLphp datatypesphp orphp thephp constants
php php php php php php*php Zendphp_Dbphp:php:INTphp_TYPEphp,php Zendphp_Dbphp:php:BIGINTphp_TYPEphp,php orphp Zendphp_Dbphp:php:FLOATphp_TYPEphp.
php php php php php php*
php php php php php php*php Valuesphp arephp:
php php php php php php*php php0php php=php php3php2php-bitphp integer
php php php php php php*php php1php php=php php6php4php-bitphp integer
php php php php php php*php php2php php=php floatphp orphp decimal
php php php php php php*
php php php php php php*php php@varphp arrayphp Associativephp arrayphp ofphp datatypesphp tophp valuesphp php0php,php php1php,php orphp php2php.
php php php php php php*php/
php php php php protectedphp php$php_numericDataTypesphp php=php arrayphp(
php php php php php php php php php php php php php php php php php php php php php php php php Zendphp_Dbphp:php:INTphp_TYPEphp php php php php=php>php Zendphp_Dbphp:php:INTphp_TYPEphp,
php php php php php php php php php php php php php php php php php php php php php php php php Zendphp_Dbphp:php:BIGINTphp_TYPEphp php=php>php Zendphp_Dbphp:php:BIGINTphp_TYPEphp,
php php php php php php php php php php php php php php php php php php php php php php php php Zendphp_Dbphp:php:FLOATphp_TYPEphp php php=php>php Zendphp_Dbphp:php:FLOATphp_TYPEphp,
php php php php php php php php php php php php php php php php php php php php php php php php php'INTEGERphp'php php php php php php php php php php php php php=php>php Zendphp_Dbphp:php:INTphp_TYPEphp,
php php php php php php php php php php php php php php php php php php php php php php php php php'SMALLINTphp'php php php php php php php php php php php php=php>php Zendphp_Dbphp:php:INTphp_TYPEphp,
php php php php php php php php php php php php php php php php php php php php php php php php php'BIGINTphp'php php php php php php php php php php php php php php=php>php Zendphp_Dbphp:php:BIGINTphp_TYPEphp,
php php php php php php php php php php php php php php php php php php php php php php php php php'DECIMALphp'php php php php php php php php php php php php php=php>php Zendphp_Dbphp:php:FLOATphp_TYPEphp,
php php php php php php php php php php php php php php php php php php php php php php php php php'DECphp'php php php php php php php php php php php php php php php php php=php>php Zendphp_Dbphp:php:FLOATphp_TYPEphp,
php php php php php php php php php php php php php php php php php php php php php php php php php'REALphp'php php php php php php php php php php php php php php php php=php>php Zendphp_Dbphp:php:FLOATphp_TYPEphp,
php php php php php php php php php php php php php php php php php php php php php php php php php'NUMERICphp'php php php php php php php php php php php php php=php>php Zendphp_Dbphp:php:FLOATphp_TYPEphp,
php php php php php php php php php php php php php php php php php php php php php php php php php'DOUBLEphp PRECISIONphp'php php php php=php>php Zendphp_Dbphp:php:FLOATphp_TYPEphp,
php php php php php php php php php php php php php php php php php php php php php php php php php'FLOATphp'php php php php php php php php php php php php php php php=php>php Zendphp_Dbphp:php:FLOATphp_TYPE
php php php php php php php php php php php php php php php php php php php php php php php php php)php;

php php php php php/php*php*
php php php php php php*php Createsphp aphp PDOphp objectphp andphp connectsphp tophp thephp databasephp.
php php php php php php*
php php php php php php*php Thephp IBMphp dataphp serverphp isphp setphp.
php php php php php php*php Currentphp optionsphp arephp DBphp2php orphp IDS
php php php php php php*php php@todophp alsophp differentiatephp betweenphp zphp/OSphp andphp iphp/php5
php php php php php php*
php php php php php php*php php@returnphp void
php php php php php php*php php@throwsphp Zendphp_Dbphp_Adapterphp_Exception
php php php php php php*php/
php php php php publicphp functionphp php_connectphp(php)
php php php php php{
php php php php php php php php ifphp php(php$thisphp-php>php_connectionphp)php php{
php php php php php php php php php php php php returnphp;
php php php php php php php php php}
php php php php php php php php parentphp:php:php_connectphp(php)php;

php php php php php php php php php$thisphp-php>getConnectionphp(php)php-php>setAttributephp(Zendphp_Dbphp:php:ATTRphp_STRINGIFYphp_FETCHESphp,php truephp)php;

php php php php php php php php tryphp php{
php php php php php php php php php php php php ifphp php(php$thisphp-php>php_serverTypephp php=php=php=php nullphp)php php{
php php php php php php php php php php php php php php php php php$serverphp php=php substrphp(php$thisphp-php>getConnectionphp(php)php-php>getAttributephp(PDOphp:php:ATTRphp_SERVERphp_INFOphp)php,php php0php,php php3php)php;

php php php php php php php php php php php php php php php php switchphp php(php$serverphp)php php{
php php php php php php php php php php php php php php php php php php php php casephp php'DBphp2php'php:
php php php php php php php php php php php php php php php php php php php php php php php php php$thisphp-php>php_serverTypephp php=php newphp Zendphp_Dbphp_Adapterphp_Pdophp_Ibmphp_Dbphp2php(php$thisphp)php;

php php php php php php php php php php php php php php php php php php php php php php php php php/php/php Addphp DBphp2php-specificphp numericphp types
php php php php php php php php php php php php php php php php php php php php php php php php php$thisphp-php>php_numericDataTypesphp[php'DECFLOATphp'php]php php=php Zendphp_Dbphp:php:FLOATphp_TYPEphp;
php php php php php php php php php php php php php php php php php php php php php php php php php$thisphp-php>php_numericDataTypesphp[php'DOUBLEphp'php]php php php php=php Zendphp_Dbphp:php:FLOATphp_TYPEphp;
php php php php php php php php php php php php php php php php php php php php php php php php php$thisphp-php>php_numericDataTypesphp[php'NUMphp'php]php php php php php php php=php Zendphp_Dbphp:php:FLOATphp_TYPEphp;

php php php php php php php php php php php php php php php php php php php php php php php php breakphp;
php php php php php php php php php php php php php php php php php php php php casephp php'IDSphp'php:
php php php php php php php php php php php php php php php php php php php php php php php php php$thisphp-php>php_serverTypephp php=php newphp Zendphp_Dbphp_Adapterphp_Pdophp_Ibmphp_Idsphp(php$thisphp)php;

php php php php php php php php php php php php php php php php php php php php php php php php php/php/php Addphp IDSphp-specificphp numericphp types
php php php php php php php php php php php php php php php php php php php php php php php php php$thisphp-php>php_numericDataTypesphp[php'SERIALphp'php]php php php php php php php php=php Zendphp_Dbphp:php:INTphp_TYPEphp;
php php php php php php php php php php php php php php php php php php php php php php php php php$thisphp-php>php_numericDataTypesphp[php'SERIALphp8php'php]php php php php php php php=php Zendphp_Dbphp:php:BIGINTphp_TYPEphp;
php php php php php php php php php php php php php php php php php php php php php php php php php$thisphp-php>php_numericDataTypesphp[php'INTphp8php'php]php php php php php php php php php php=php Zendphp_Dbphp:php:BIGINTphp_TYPEphp;
php php php php php php php php php php php php php php php php php php php php php php php php php$thisphp-php>php_numericDataTypesphp[php'SMALLFLOATphp'php]php php php php=php Zendphp_Dbphp:php:FLOATphp_TYPEphp;
php php php php php php php php php php php php php php php php php php php php php php php php php$thisphp-php>php_numericDataTypesphp[php'MONEYphp'php]php php php php php php php php php=php Zendphp_Dbphp:php:FLOATphp_TYPEphp;

php php php php php php php php php php php php php php php php php php php php php php php php breakphp;
php php php php php php php php php php php php php php php php php php php php php}
php php php php php php php php php php php php php}
php php php php php php php php php}php catchphp php(PDOExceptionphp php$ephp)php php{
php php php php php php php php php php php php php/php*php*php php@seephp Zendphp_Dbphp_Adapterphp_Exceptionphp php*php/
php php php php php php php php php php php php requirephp_oncephp php'Zendphp/Dbphp/Adapterphp/Exceptionphp.phpphp'php;
php php php php php php php php php php php php php$errorphp php=php strposphp(php$ephp-php>getMessagephp(php)php,php php'driverphp doesphp notphp supportphp thatphp attributephp'php)php;
php php php php php php php php php php php php ifphp php(php$errorphp)php php{
php php php php php php php php php php php php php php php php throwphp newphp Zendphp_Dbphp_Adapterphp_Exceptionphp(php"PDOphp_IBMphp driverphp extensionphp isphp downlevelphp.php php Pleasephp usephp driverphp releasephp versionphp php1php.php2php.php1php orphp laterphp"php,php php0php,php php$ephp)php;
php php php php php php php php php php php php php}php elsephp php{
php php php php php php php php php php php php php php php php throwphp newphp Zendphp_Dbphp_Adapterphp_Exceptionphp(php$ephp-php>getMessagephp(php)php,php php$ephp-php>getCodephp(php)php,php php$ephp)php;
php php php php php php php php php php php php php}
php php php php php php php php php}
php php php php php}

php php php php php/php*php*
php php php php php php*php Createsphp aphp PDOphp DSNphp forphp thephp adapterphp fromphp php$thisphp-php>php_configphp settingsphp.
php php php php php php*
php php php php php php*php php@returnphp string
php php php php php php*php/
php php php php protectedphp functionphp php_dsnphp(php)
php php php php php{
php php php php php php php php php$thisphp-php>php_checkRequiredOptionsphp(php$thisphp-php>php_configphp)php;

php php php php php php php php php/php/php checkphp ifphp usingphp fullphp connectionphp string
php php php php php php php php ifphp php(arrayphp_keyphp_existsphp(php'hostphp'php,php php$thisphp-php>php_configphp)php)php php{
php php php php php php php php php php php php php$dsnphp php=php php'php;DATABASEphp=php'php php.php php$thisphp-php>php_configphp[php'dbnamephp'php]
php php php php php php php php php php php php php.php php'php;HOSTNAMEphp=php'php php.php php$thisphp-php>php_configphp[php'hostphp'php]
php php php php php php php php php php php php php.php php'php;PORTphp=php'php php php php php php.php php$thisphp-php>php_configphp[php'portphp'php]
php php php php php php php php php php php php php/php/php PDOphp_IBMphp supportsphp onlyphp DBphp2php TCPIPphp protocol
php php php php php php php php php php php php php.php php'php;PROTOCOLphp=php'php php.php php'TCPIPphp;php'php;
php php php php php php php php php}php elsephp php{
php php php php php php php php php php php php php/php/php cataloguedphp connection
php php php php php php php php php php php php php$dsnphp php=php php$thisphp-php>php_configphp[php'dbnamephp'php]php;
php php php php php php php php php}
php php php php php php php php returnphp php$thisphp-php>php_pdoTypephp php.php php'php:php php'php php.php php$dsnphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Checksphp requiredphp options
php php php php php php*
php php php php php php*php php@paramphp php arrayphp php$config
php php php php php php*php php@throwsphp Zendphp_Dbphp_Adapterphp_Exception
php php php php php php*php php@returnphp void
php php php php php php*php/
php php php php protectedphp functionphp php_checkRequiredOptionsphp(arrayphp php$configphp)
php php php php php{
php php php php php php php php parentphp:php:php_checkRequiredOptionsphp(php$configphp)php;

php php php php php php php php ifphp php(arrayphp_keyphp_existsphp(php'hostphp'php,php php$thisphp-php>php_configphp)php php&php&
php php php php php php php php php!arrayphp_keyphp_existsphp(php'portphp'php,php php$configphp)php)php php{
php php php php php php php php php php php php php/php*php*php php@seephp Zendphp_Dbphp_Adapterphp_Exceptionphp php*php/
php php php php php php php php php php php php requirephp_oncephp php'Zendphp/Dbphp/Adapterphp/Exceptionphp.phpphp'php;
php php php php php php php php php php php php throwphp newphp Zendphp_Dbphp_Adapterphp_Exceptionphp(php"Configurationphp mustphp havephp aphp keyphp forphp php'portphp'php whenphp php'hostphp'php isphp specifiedphp"php)php;
php php php php php php php php php}
php php php php php}

php php php php php/php*php*
php php php php php php*php Preparesphp anphp SQLphp statementphp.
php php php php php php*
php php php php php php*php php@paramphp stringphp php$sqlphp Thephp SQLphp statementphp withphp placeholdersphp.
php php php php php php*php php@paramphp arrayphp php$bindphp Anphp arrayphp ofphp dataphp tophp bindphp tophp thephp placeholdersphp.
php php php php php php*php php@returnphp PDOStatement
php php php php php php*php/
php php php php publicphp functionphp preparephp(php$sqlphp)
php php php php php{
php php php php php php php php php$thisphp-php>php_connectphp(php)php;
php php php php php php php php php$stmtClassphp php=php php$thisphp-php>php_defaultStmtClassphp;
php php php php php php php php php$stmtphp php=php newphp php$stmtClassphp(php$thisphp,php php$sqlphp)php;
php php php php php php php php php$stmtphp-php>setFetchModephp(php$thisphp-php>php_fetchModephp)php;
php php php php php php php php returnphp php$stmtphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Returnsphp aphp listphp ofphp thephp tablesphp inphp thephp databasephp.
php php php php php php*
php php php php php php*php php@returnphp array
php php php php php php*php/
php php php php publicphp functionphp listTablesphp(php)
php php php php php{
php php php php php php php php php$thisphp-php>php_connectphp(php)php;
php php php php php php php php returnphp php$thisphp-php>php_serverTypephp-php>listTablesphp(php)php;
php php php php php}

php php php php php/php*php*
php php php php php php*php Returnsphp thephp columnphp descriptionsphp forphp aphp tablephp.
php php php php php php*
php php php php php php*php Thephp returnphp valuephp isphp anphp associativephp arrayphp keyedphp byphp thephp columnphp namephp,
php php php php php php*php asphp returnedphp byphp thephp RDBMSphp.
php php php php php php*
php php php php php php*php Thephp valuephp ofphp eachphp arrayphp elementphp isphp anphp associativephp array
php php php php php php*php withphp thephp followingphp keysphp:
php php php php php php*
php php php php php php*php SCHEMAphp_NAMEphp php php php php php php=php>php stringphp;php namephp ofphp databasephp orphp schema
php php php php php php*php TABLEphp_NAMEphp php php php php php php php=php>php stringphp;
php php php php php php*php COLUMNphp_NAMEphp php php php php php php=php>php stringphp;php columnphp name
php php php php php php*php COLUMNphp_POSITIONphp php php=php>php numberphp;php ordinalphp positionphp ofphp columnphp inphp table
php php php php php php*php DATAphp_TYPEphp php php php php php php php php=php>php stringphp;php SQLphp datatypephp namephp ofphp column
php php php php php php*php DEFAULTphp php php php php php php php php php php=php>php stringphp;php defaultphp expressionphp ofphp columnphp,php nullphp ifphp none
php php php php php php*php NULLABLEphp php php php php php php php php php=php>php booleanphp;php truephp ifphp columnphp canphp havephp nulls
php php php php php php*php LENGTHphp php php php php php php php php php php php=php>php numberphp;php lengthphp ofphp CHARphp/VARCHAR
php php php php php php*php SCALEphp php php php php php php php php php php php php=php>php numberphp;php scalephp ofphp NUMERICphp/DECIMAL
php php php php php php*php PRECISIONphp php php php php php php php php=php>php numberphp;php precisionphp ofphp NUMERICphp/DECIMAL
php php php php php php*php UNSIGNEDphp php php php php php php php php php=php>php booleanphp;php unsignedphp propertyphp ofphp anphp integerphp type
php php php php php php*php PRIMARYphp php php php php php php php php php php=php>php booleanphp;php truephp ifphp columnphp isphp partphp ofphp thephp primaryphp key
php php php php php php*php PRIMARYphp_POSITIONphp php=php>php integerphp;php positionphp ofphp columnphp inphp primaryphp key
php php php php php php*
php php php php php php*php php@todophp Discoverphp integerphp unsignedphp propertyphp.
php php php php php php*
php php php php php php*php php@paramphp stringphp php$tableName
php php php php php php*php php@paramphp stringphp php$schemaNamephp OPTIONAL
php php php php php php*php php@returnphp array
php php php php php php*php/
php php php php publicphp functionphp describeTablephp(php$tableNamephp,php php$schemaNamephp php=php nullphp)
php php php php php{
php php php php php php php php php$thisphp-php>php_connectphp(php)php;
php php php php php php php php returnphp php$thisphp-php>php_serverTypephp-php>describeTablephp(php$tableNamephp,php php$schemaNamephp)php;
php php php php php}

php php php php php/php*php*
php php php php php php*php Insertsphp aphp tablephp rowphp withphp specifiedphp dataphp.
php php php php php php*php Specialphp handlingphp forphp PDOphp_IBM
php php php php php php*php removephp emptyphp slots
php php php php php php*
php php php php php php*php php@paramphp mixedphp php$tablephp Thephp tablephp tophp insertphp dataphp intophp.
php php php php php php*php php@paramphp arrayphp php$bindphp Columnphp-valuephp pairsphp.
php php php php php php*php php@returnphp intphp Thephp numberphp ofphp affectedphp rowsphp.
php php php php php php*php/
php php php php publicphp functionphp insertphp(php$tablephp,php arrayphp php$bindphp)
php php php php php{
php php php php php php php php php$thisphp-php>php_connectphp(php)php;
php php php php php php php php php$newbindphp php=php arrayphp(php)php;
php php php php php php php php ifphp php(isphp_arrayphp(php$bindphp)php)php php{
php php php php php php php php php php php php foreachphp php(php$bindphp asphp php$namephp php=php>php php$valuephp)php php{
php php php php php php php php php php php php php php php php ifphp(php$valuephp php!php=php=php nullphp)php php{
php php php php php php php php php php php php php php php php php php php php php$newbindphp[php$namephp]php php=php php$valuephp;
php php php php php php php php php php php php php php php php php}
php php php php php php php php php php php php php}
php php php php php php php php php}

php php php php php php php php returnphp parentphp:php:insertphp(php$tablephp,php php$newbindphp)php;
php php php php php}

php php php php php/php*php*
php php php php php php*php Addsphp anphp adapterphp-specificphp LIMITphp clausephp tophp thephp SELECTphp statementphp.
php php php php php php*
php php php php php php*php php@paramphp stringphp php$sql
php php php php php php*php php@paramphp integerphp php$count
php php php php php php*php php@paramphp integerphp php$offsetphp OPTIONAL
php php php php php php*php php@returnphp string
php php php php php php*php/
php php php php publicphp functionphp limitphp(php$sqlphp,php php$countphp,php php$offsetphp php=php php0php)
php php php php php{
php php php php php php php php$thisphp-php>php_connectphp(php)php;
php php php php php php php returnphp php$thisphp-php>php_serverTypephp-php>limitphp(php$sqlphp,php php$countphp,php php$offsetphp)php;
php php php php php}

php php php php php/php*php*
php php php php php php*php Getsphp thephp lastphp IDphp generatedphp automaticallyphp byphp anphp IDENTITYphp/AUTOINCREMENT
php php php php php php*php columnphp.
php php php php php php*
php php php php php php*php php@paramphp stringphp php$tableNamephp OPTIONAL
php php php php php php*php php@paramphp stringphp php$primaryKeyphp OPTIONAL
php php php php php php*php php@returnphp integer
php php php php php php*php/
php php php php publicphp functionphp lastInsertIdphp(php$tableNamephp php=php nullphp,php php$primaryKeyphp php=php nullphp)
php php php php php{
php php php php php php php php php$thisphp-php>php_connectphp(php)php;

php php php php php php php php php ifphp php(php$tableNamephp php!php=php=php nullphp)php php{
php php php php php php php php php php php php php$sequenceNamephp php=php php$tableNamephp;
php php php php php php php php php php php php ifphp php(php$primaryKeyphp)php php{
php php php php php php php php php php php php php php php php php$sequenceNamephp php.php=php php"php_php$primaryKeyphp"php;
php php php php php php php php php php php php php}
php php php php php php php php php php php php php$sequenceNamephp php.php=php php'php_seqphp'php;
php php php php php php php php php php php php returnphp php$thisphp-php>lastSequenceIdphp(php$sequenceNamephp)php;
php php php php php php php php php}

php php php php php php php php php$idphp php=php php$thisphp-php>getConnectionphp(php)php-php>lastInsertIdphp(php)php;

php php php php php php php php returnphp php$idphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Returnphp thephp mostphp recentphp valuephp fromphp thephp specifiedphp sequencephp inphp thephp databasephp.
php php php php php php*
php php php php php php*php php@paramphp stringphp php$sequenceName
php php php php php php*php php@returnphp integer
php php php php php php*php/
php php php php publicphp functionphp lastSequenceIdphp(php$sequenceNamephp)
php php php php php{
php php php php php php php php php$thisphp-php>php_connectphp(php)php;
php php php php php php php php returnphp php$thisphp-php>php_serverTypephp-php>lastSequenceIdphp(php$sequenceNamephp)php;
php php php php php}

php php php php php/php*php*
php php php php php php*php Generatephp aphp newphp valuephp fromphp thephp specifiedphp sequencephp inphp thephp databasephp,
php php php php php php*php andphp returnphp itphp.
php php php php php php*
php php php php php php*php php@paramphp stringphp php$sequenceName
php php php php php php*php php@returnphp integer
php php php php php php*php/
php php php php publicphp functionphp nextSequenceIdphp(php$sequenceNamephp)
php php php php php{
php php php php php php php php php$thisphp-php>php_connectphp(php)php;
php php php php php php php php returnphp php$thisphp-php>php_serverTypephp-php>nextSequenceIdphp(php$sequenceNamephp)php;
php php php php php}

php php php php php/php*php*
php php php php php php*php Retrievephp serverphp versionphp inphp PHPphp style
php php php php php php*php Pdophp_Idmphp doesnphp'tphp supportphp getAttributephp(PDOphp:php:ATTRphp_SERVERphp_VERSIONphp)
php php php php php php*php php@returnphp string
php php php php php php*php/
php php php php publicphp functionphp getServerVersionphp(php)
php php php php php{
php php php php php php php php tryphp php{
php php php php php php php php php php php php php$stmtphp php=php php$thisphp-php>queryphp(php'SELECTphp servicephp_levelphp,php fixpackphp_numphp FROMphp TABLEphp php(sysprocphp.envphp_getphp_instphp_infophp(php)php)php asphp INSTANCEINFOphp'php)php;
php php php php php php php php php php php php php$resultphp php=php php$stmtphp-php>fetchAllphp(Zendphp_Dbphp:php:FETCHphp_NUMphp)php;
php php php php php php php php php php php php ifphp php(countphp(php$resultphp)php)php php{
php php php php php php php php php php php php php php php php php$matchesphp php=php nullphp;
php php php php php php php php php php php php php php php php ifphp php(pregphp_matchphp(php'php/php(php(php?php:php[php0php-php9php]php{php1php,php2php}php\php.php)php{php1php,php3php}php[php0php-php9php]php{php1php,php2php}php)php/php'php,php php$resultphp[php0php]php[php0php]php,php php$matchesphp)php)php php{
php php php php php php php php php php php php php php php php php php php php returnphp php$matchesphp[php1php]php;
php php php php php php php php php php php php php php php php php}php elsephp php{
php php php php php php php php php php php php php php php php php php php php returnphp nullphp;
php php php php php php php php php php php php php php php php php}
php php php php php php php php php php php php php}
php php php php php php php php php php php php returnphp nullphp;
php php php php php php php php php}php catchphp php(PDOExceptionphp php$ephp)php php{
php php php php php php php php php php php php returnphp nullphp;
php php php php php php php php php}
php php php php php}
php}
