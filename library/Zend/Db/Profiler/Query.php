<php?php
php/php*php*
php php*php Zendphp Framework
php php*
php php*php LICENSE
php php*
php php*php Thisphp sourcephp filephp isphp subjectphp tophp thephp newphp BSDphp licensephp thatphp isphp bundled
php php*php withphp thisphp packagephp inphp thephp filephp LICENSEphp.txtphp.
php php*php Itphp isphp alsophp availablephp throughphp thephp worldphp-widephp-webphp atphp thisphp URLphp:
php php*php httpphp:php/php/frameworkphp.zendphp.comphp/licensephp/newphp-bsd
php php*php Ifphp youphp didphp notphp receivephp aphp copyphp ofphp thephp licensephp andphp arephp unablephp to
php php*php obtainphp itphp throughphp thephp worldphp-widephp-webphp,php pleasephp sendphp anphp email
php php*php tophp licensephp@zendphp.comphp sophp wephp canphp sendphp youphp aphp copyphp immediatelyphp.
php php*
php php*php php@categoryphp php php Zend
php php*php php@packagephp php php php Zendphp_Db
php php*php php@subpackagephp Profiler
php php*php php@copyrightphp php Copyrightphp php(cphp)php php2php0php0php5php-php2php0php1php0php Zendphp Technologiesphp USAphp Incphp.php php(httpphp:php/php/wwwphp.zendphp.comphp)
php php*php php@licensephp php php php httpphp:php/php/frameworkphp.zendphp.comphp/licensephp/newphp-bsdphp php php php php Newphp BSDphp License
php php*php php@versionphp php php php php$Idphp:php Queryphp.phpphp php2php3php3php8php2php php2php0php1php0php-php1php1php-php1php8php php2php2php:php5php0php:php5php0Zphp bittarmanphp php$
php php*php/


php/php*php*
php php*php php@categoryphp php php Zend
php php*php php@packagephp php php php Zendphp_Db
php php*php php@subpackagephp Profiler
php php*php php@copyrightphp php Copyrightphp php(cphp)php php2php0php0php5php-php2php0php1php0php Zendphp Technologiesphp USAphp Incphp.php php(httpphp:php/php/wwwphp.zendphp.comphp)
php php*php php@licensephp php php php httpphp:php/php/frameworkphp.zendphp.comphp/licensephp/newphp-bsdphp php php php php Newphp BSDphp License
php php*php/
classphp Zendphp_Dbphp_Profilerphp_Query
php{

php php php php php/php*php*
php php php php php php*php SQLphp queryphp stringphp orphp userphp commentphp,php setphp byphp php$queryphp argumentphp inphp constructorphp.
php php php php php php*
php php php php php php*php php@varphp string
php php php php php php*php/
php php php php protectedphp php$php_queryphp php=php php'php'php;

php php php php php/php*php*
php php php php php php*php Onephp ofphp thephp Zendphp_Dbphp_Profilerphp constantsphp forphp queryphp typephp,php setphp byphp php$queryTypephp argumentphp inphp constructorphp.
php php php php php php*
php php php php php php*php php@varphp integer
php php php php php php*php/
php php php php protectedphp php$php_queryTypephp php=php php0php;

php php php php php/php*php*
php php php php php php*php Unixphp timestampphp withphp microsecondsphp whenphp instantiatedphp.
php php php php php php*
php php php php php php*php php@varphp float
php php php php php php*php/
php php php php protectedphp php$php_startedMicrotimephp php=php nullphp;

php php php php php/php*php*
php php php php php php*php Unixphp timestampphp withphp microsecondsphp whenphp selfphp:php:queryEndphp(php)php wasphp calledphp.
php php php php php php*
php php php php php php*php php@varphp integer
php php php php php php*php/
php php php php protectedphp php$php_endedMicrotimephp php=php nullphp;

php php php php php/php*php*
php php php php php php*php php@varphp array
php php php php php php*php/
php php php php protectedphp php$php_boundParamsphp php=php arrayphp(php)php;

php php php php php/php*php*
php php php php php php*php php@varphp array
php php php php php php*php/

php php php php php/php*php*
php php php php php php*php Classphp constructorphp.php php Aphp queryphp isphp aboutphp tophp bephp startedphp,php savephp thephp queryphp textphp php(php$queryphp)php andphp its
php php php php php php*php typephp php(onephp ofphp thephp Zendphp_Dbphp_Profilerphp:php:php*php constantsphp)php.
php php php php php php*
php php php php php php*php php@paramphp php stringphp php php$query
php php php php php php*php php@paramphp php integerphp php$queryType
php php php php php php*php php@returnphp void
php php php php php php*php/
php php php php publicphp functionphp php_php_constructphp(php$queryphp,php php$queryTypephp)
php php php php php{
php php php php php php php php php$thisphp-php>php_queryphp php=php php$queryphp;
php php php php php php php php php$thisphp-php>php_queryTypephp php=php php$queryTypephp;
php php php php php php php php php/php/php byphp defaultphp,php andphp forphp backwardphp-compatibilityphp,php startphp thephp clickphp ticking
php php php php php php php php php$thisphp-php>startphp(php)php;
php php php php php}

php php php php php/php*php*
php php php php php php*php Clonephp handlerphp forphp thephp queryphp objectphp.
php php php php php php*php php@returnphp void
php php php php php php*php/
php php php php publicphp functionphp php_php_clonephp(php)
php php php php php{
php php php php php php php php php$thisphp-php>php_boundParamsphp php=php arrayphp(php)php;
php php php php php php php php php$thisphp-php>php_endedMicrotimephp php=php nullphp;
php php php php php php php php php$thisphp-php>startphp(php)php;
php php php php php}

php php php php php/php*php*
php php php php php php*php Startsphp thephp elapsedphp timephp clickphp tickingphp.
php php php php php php*php Thisphp canphp bephp calledphp subsequentphp tophp objectphp creationphp,
php php php php php php*php tophp restartphp thephp clockphp.php php Forphp instancephp,php thisphp isphp useful
php php php php php php*php rightphp beforephp executingphp aphp preparedphp queryphp.
php php php php php php*
php php php php php php*php php@returnphp void
php php php php php php*php/
php php php php publicphp functionphp startphp(php)
php php php php php{
php php php php php php php php php$thisphp-php>php_startedMicrotimephp php=php microtimephp(truephp)php;
php php php php php}

php php php php php/php*php*
php php php php php php*php Endsphp thephp queryphp andphp recordsphp thephp timephp sophp thatphp thephp elapsedphp timephp canphp bephp determinedphp laterphp.
php php php php php php*
php php php php php php*php php@returnphp void
php php php php php php*php/
php php php php publicphp functionphp endphp(php)
php php php php php{
php php php php php php php php php$thisphp-php>php_endedMicrotimephp php=php microtimephp(truephp)php;
php php php php php}

php php php php php/php*php*
php php php php php php*php Returnsphp truephp ifphp andphp onlyphp ifphp thephp queryphp hasphp endedphp.
php php php php php php*
php php php php php php*php php@returnphp boolean
php php php php php php*php/
php php php php publicphp functionphp hasEndedphp(php)
php php php php php{
php php php php php php php php returnphp php$thisphp-php>php_endedMicrotimephp php!php=php=php nullphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Getphp thephp originalphp SQLphp textphp ofphp thephp queryphp.
php php php php php php*
php php php php php php*php php@returnphp string
php php php php php php*php/
php php php php publicphp functionphp getQueryphp(php)
php php php php php{
php php php php php php php php returnphp php$thisphp-php>php_queryphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Getphp thephp typephp ofphp thisphp queryphp php(onephp ofphp thephp Zendphp_Dbphp_Profilerphp:php:php*php constantsphp)
php php php php php php*
php php php php php php*php php@returnphp integer
php php php php php php*php/
php php php php publicphp functionphp getQueryTypephp(php)
php php php php php{
php php php php php php php php returnphp php$thisphp-php>php_queryTypephp;
php php php php php}

php php php php php/php*php*
php php php php php php*php php@paramphp stringphp php$param
php php php php php php*php php@paramphp mixedphp php$variable
php php php php php php*php php@returnphp void
php php php php php php*php/
php php php php publicphp functionphp bindParamphp(php$paramphp,php php$variablephp)
php php php php php{
php php php php php php php php php$thisphp-php>php_boundParamsphp[php$paramphp]php php=php php$variablephp;
php php php php php}

php php php php php/php*php*
php php php php php php*php php@paramphp arrayphp php$param
php php php php php php*php php@returnphp void
php php php php php php*php/
php php php php publicphp functionphp bindParamsphp(arrayphp php$paramsphp)
php php php php php{
php php php php php php php php ifphp php(arrayphp_keyphp_existsphp(php0php,php php$paramsphp)php)php php{
php php php php php php php php php php php php arrayphp_unshiftphp(php$paramsphp,php nullphp)php;
php php php php php php php php php php php php unsetphp(php$paramsphp[php0php]php)php;
php php php php php php php php php}
php php php php php php php php foreachphp php(php$paramsphp asphp php$paramphp php=php>php php$valuephp)php php{
php php php php php php php php php php php php php$thisphp-php>bindParamphp(php$paramphp,php php$valuephp)php;
php php php php php php php php php}
php php php php php}

php php php php php/php*php*
php php php php php php*php php@returnphp array
php php php php php php*php/
php php php php publicphp functionphp getQueryParamsphp(php)
php php php php php{
php php php php php php php php returnphp php$thisphp-php>php_boundParamsphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Getphp thephp elapsedphp timephp php(inphp secondsphp)php thatphp thephp queryphp ranphp.
php php php php php php*php Ifphp thephp queryphp hasphp notphp yetphp endedphp,php falsephp isphp returnedphp.
php php php php php php*
php php php php php php*php php@returnphp floatphp|false
php php php php php php*php/
php php php php publicphp functionphp getElapsedSecsphp(php)
php php php php php{
php php php php php php php php ifphp php(nullphp php=php=php=php php$thisphp-php>php_endedMicrotimephp)php php{
php php php php php php php php php php php php returnphp falsephp;
php php php php php php php php php}

php php php php php php php php returnphp php$thisphp-php>php_endedMicrotimephp php-php php$thisphp-php>php_startedMicrotimephp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Getphp thephp timephp php(inphp secondsphp)php whenphp thephp profilerphp startedphp runningphp.
php php php php php php*
php php php php php php*php php@returnphp boolphp|float
php php php php php php*php/
php php php php publicphp functionphp getStartedMicrotimephp(php)
php php php php php{
php php php php php php php php ifphp(nullphp php=php=php=php php$thisphp-php>php_startedMicrotimephp)php php{
php php php php php php php php php php php php returnphp falsephp;
php php php php php php php php php}

php php php php php php php php returnphp php$thisphp-php>php_startedMicrotimephp;
php php php php php}
php}

