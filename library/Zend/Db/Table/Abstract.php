<php?php
php/php*php*
php php*php Zendphp Framework
php php*
php php*php LICENSE
php php*
php php*php Thisphp sourcephp filephp isphp subjectphp tophp thephp newphp BSDphp licensephp thatphp isphp bundled
php php*php withphp thisphp packagephp inphp thephp filephp LICENSEphp.txtphp.
php php*php Itphp isphp alsophp availablephp throughphp thephp worldphp-widephp-webphp atphp thisphp URLphp:
php php*php httpphp:php/php/frameworkphp.zendphp.comphp/licensephp/newphp-bsd
php php*php Ifphp youphp didphp notphp receivephp aphp copyphp ofphp thephp licensephp andphp arephp unablephp to
php php*php obtainphp itphp throughphp thephp worldphp-widephp-webphp,php pleasephp sendphp anphp email
php php*php tophp licensephp@zendphp.comphp sophp wephp canphp sendphp youphp aphp copyphp immediatelyphp.
php php*
php php*php php@categoryphp php php Zend
php php*php php@packagephp php php php Zendphp_Db
php php*php php@subpackagephp Table
php php*php php@copyrightphp php Copyrightphp php(cphp)php php2php0php0php5php-php2php0php1php0php Zendphp Technologiesphp USAphp Incphp.php php(httpphp:php/php/wwwphp.zendphp.comphp)
php php*php php@licensephp php php php httpphp:php/php/frameworkphp.zendphp.comphp/licensephp/newphp-bsdphp php php php php Newphp BSDphp License
php php*php php@versionphp php php php php$Idphp:php Abstractphp.phpphp php2php3php5php7php8php php2php0php1php0php-php1php2php-php2php4php php1php6php:php3php1php:php4php5Zphp ramonphp php$
php php*php/

php/php*php*
php php*php php@seephp Zendphp_Dbphp_Adapterphp_Abstract
php php*php/
requirephp_oncephp php'Zendphp/Dbphp/Adapterphp/Abstractphp.phpphp'php;

php/php*php*
php php*php php@seephp Zendphp_Dbphp_Adapterphp_Abstract
php php*php/
requirephp_oncephp php'Zendphp/Dbphp/Selectphp.phpphp'php;

php/php*php*
php php*php php@seephp Zendphp_Db
php php*php/
requirephp_oncephp php'Zendphp/Dbphp.phpphp'php;

php/php*php*
php php*php Classphp forphp SQLphp tablephp interfacephp.
php php*
php php*php php@categoryphp php php Zend
php php*php php@packagephp php php php Zendphp_Db
php php*php php@subpackagephp Table
php php*php php@copyrightphp php Copyrightphp php(cphp)php php2php0php0php5php-php2php0php1php0php Zendphp Technologiesphp USAphp Incphp.php php(httpphp:php/php/wwwphp.zendphp.comphp)
php php*php php@licensephp php php php httpphp:php/php/frameworkphp.zendphp.comphp/licensephp/newphp-bsdphp php php php php Newphp BSDphp License
php php*php/
abstractphp classphp Zendphp_Dbphp_Tablephp_Abstract
php{

php php php php constphp ADAPTERphp php php php php php php php php php php=php php'dbphp'php;
php php php php constphp DEFINITIONphp php php php php php php php php=php php'definitionphp'php;
php php php php constphp DEFINITIONphp_CONFIGphp_NAMEphp php=php php'definitionConfigNamephp'php;
php php php php constphp SCHEMAphp php php php php php php php php php php php=php php'schemaphp'php;
php php php php constphp NAMEphp php php php php php php php php php php php php php=php php'namephp'php;
php php php php constphp PRIMARYphp php php php php php php php php php php=php php'primaryphp'php;
php php php php constphp COLSphp php php php php php php php php php php php php php=php php'colsphp'php;
php php php php constphp METADATAphp php php php php php php php php php=php php'metadataphp'php;
php php php php constphp METADATAphp_CACHEphp php php php=php php'metadataCachephp'php;
php php php php constphp METADATAphp_CACHEphp_INphp_CLASSphp php=php php'metadataCacheInClassphp'php;
php php php php constphp ROWphp_CLASSphp php php php php php php php php=php php'rowClassphp'php;
php php php php constphp ROWSETphp_CLASSphp php php php php php=php php'rowsetClassphp'php;
php php php php constphp REFERENCEphp_MAPphp php php php php=php php'referenceMapphp'php;
php php php php constphp DEPENDENTphp_TABLESphp php=php php'dependentTablesphp'php;
php php php php constphp SEQUENCEphp php php php php php php php php php=php php'sequencephp'php;

php php php php constphp COLUMNSphp php php php php php php php php php php=php php'columnsphp'php;
php php php php constphp REFphp_TABLEphp_CLASSphp php php=php php'refTableClassphp'php;
php php php php constphp REFphp_COLUMNSphp php php php php php php=php php'refColumnsphp'php;
php php php php constphp ONphp_DELETEphp php php php php php php php php=php php'onDeletephp'php;
php php php php constphp ONphp_UPDATEphp php php php php php php php php=php php'onUpdatephp'php;

php php php php constphp CASCADEphp php php php php php php php php php php=php php'cascadephp'php;
php php php php constphp RESTRICTphp php php php php php php php php php=php php'restrictphp'php;
php php php php constphp SETphp_NULLphp php php php php php php php php php=php php'setNullphp'php;

php php php php constphp DEFAULTphp_NONEphp php php php php php=php php'defaultNonephp'php;
php php php php constphp DEFAULTphp_CLASSphp php php php php=php php'defaultClassphp'php;
php php php php constphp DEFAULTphp_DBphp php php php php php php php=php php'defaultDbphp'php;

php php php php constphp SELECTphp_WITHphp_FROMphp_PARTphp php php php php=php truephp;
php php php php constphp SELECTphp_WITHOUTphp_FROMphp_PARTphp php=php falsephp;

php php php php php/php*php*
php php php php php php*php Defaultphp Zendphp_Dbphp_Adapterphp_Abstractphp objectphp.
php php php php php php*
php php php php php php*php php@varphp Zendphp_Dbphp_Adapterphp_Abstract
php php php php php php*php/
php php php php protectedphp staticphp php$php_defaultDbphp;

php php php php php/php*php*
php php php php php php*php Optionalphp Zendphp_Dbphp_Tablephp_Definitionphp object
php php php php php php*
php php php php php php*php php@varphp unknownphp_type
php php php php php php*php/
php php php php protectedphp php$php_definitionphp php=php nullphp;

php php php php php/php*php*
php php php php php php*php Optionalphp definitionphp configphp namephp usedphp inphp concretephp implementation
php php php php php php*
php php php php php php*php php@varphp string
php php php php php php*php/
php php php php protectedphp php$php_definitionConfigNamephp php=php nullphp;

php php php php php/php*php*
php php php php php php*php Defaultphp cachephp forphp informationphp providedphp byphp thephp adapterphp'sphp describeTablephp(php)php methodphp.
php php php php php php*
php php php php php php*php php@varphp Zendphp_Cachephp_Core
php php php php php php*php/
php php php php protectedphp staticphp php$php_defaultMetadataCachephp php=php nullphp;

php php php php php/php*php*
php php php php php php*php Zendphp_Dbphp_Adapterphp_Abstractphp objectphp.
php php php php php php*
php php php php php php*php php@varphp Zendphp_Dbphp_Adapterphp_Abstract
php php php php php php*php/
php php php php protectedphp php$php_dbphp;

php php php php php/php*php*
php php php php php php*php Thephp schemaphp namephp php(defaultphp nullphp meansphp currentphp schemaphp)
php php php php php php*
php php php php php php*php php@varphp array
php php php php php php*php/
php php php php protectedphp php$php_schemaphp php=php nullphp;

php php php php php/php*php*
php php php php php php*php Thephp tablephp namephp.
php php php php php php*
php php php php php php*php php@varphp string
php php php php php php*php/
php php php php protectedphp php$php_namephp php=php nullphp;

php php php php php/php*php*
php php php php php php*php Thephp tablephp columnphp namesphp derivedphp fromphp Zendphp_Dbphp_Adapterphp_Abstractphp:php:describeTablephp(php)php.
php php php php php php*
php php php php php php*php php@varphp array
php php php php php php*php/
php php php php protectedphp php$php_colsphp;

php php php php php/php*php*
php php php php php php*php Thephp primaryphp keyphp columnphp orphp columnsphp.
php php php php php php*php Aphp compoundphp keyphp shouldphp bephp declaredphp asphp anphp arrayphp.
php php php php php php*php Youphp mayphp declarephp aphp singlephp-columnphp primaryphp key
php php php php php php*php asphp aphp stringphp.
php php php php php php*
php php php php php php*php php@varphp mixed
php php php php php php*php/
php php php php protectedphp php$php_primaryphp php=php nullphp;

php php php php php/php*php*
php php php php php php*php Ifphp yourphp primaryphp keyphp isphp aphp compoundphp keyphp,php andphp onephp ofphp thephp columnsphp uses
php php php php php php*php anphp autophp-incrementphp orphp sequencephp-generatedphp valuephp,php setphp php_identity
php php php php php php*php tophp thephp ordinalphp indexphp inphp thephp php$php_primaryphp arrayphp forphp thatphp columnphp.
php php php php php php*php Notephp thisphp indexphp isphp thephp positionphp ofphp thephp columnphp inphp thephp primaryphp keyphp,
php php php php php php*php notphp thephp positionphp ofphp thephp columnphp inphp thephp tablephp.php php Thephp primaryphp key
php php php php php php*php arrayphp isphp php1php-basedphp.
php php php php php php*
php php php php php php*php php@varphp integer
php php php php php php*php/
php php php php protectedphp php$php_identityphp php=php php1php;

php php php php php/php*php*
php php php php php php*php Definephp thephp logicphp forphp newphp valuesphp inphp thephp primaryphp keyphp.
php php php php php php*php Mayphp bephp aphp stringphp,php booleanphp truephp,php orphp booleanphp falsephp.
php php php php php php*
php php php php php php*php php@varphp mixed
php php php php php php*php/
php php php php protectedphp php$php_sequencephp php=php truephp;

php php php php php/php*php*
php php php php php php*php Informationphp providedphp byphp thephp adapterphp'sphp describeTablephp(php)php methodphp.
php php php php php php*
php php php php php php*php php@varphp array
php php php php php php*php/
php php php php protectedphp php$php_metadataphp php=php arrayphp(php)php;

php php php php php/php*php*
php php php php php php*php Cachephp forphp informationphp providedphp byphp thephp adapterphp'sphp describeTablephp(php)php methodphp.
php php php php php php*
php php php php php php*php php@varphp Zendphp_Cachephp_Core
php php php php php php*php/
php php php php protectedphp php$php_metadataCachephp php=php nullphp;

php php php php php/php*php*
php php php php php php*php Flagphp:php whetherphp orphp notphp tophp cachephp metadataphp inphp thephp class
php php php php php php*php php@varphp bool
php php php php php php*php/
php php php php protectedphp php$php_metadataCacheInClassphp php=php truephp;

php php php php php/php*php*
php php php php php php*php Classnamephp forphp row
php php php php php php*
php php php php php php*php php@varphp string
php php php php php php*php/
php php php php protectedphp php$php_rowClassphp php=php php'Zendphp_Dbphp_Tablephp_Rowphp'php;

php php php php php/php*php*
php php php php php php*php Classnamephp forphp rowset
php php php php php php*
php php php php php php*php php@varphp string
php php php php php php*php/
php php php php protectedphp php$php_rowsetClassphp php=php php'Zendphp_Dbphp_Tablephp_Rowsetphp'php;

php php php php php/php*php*
php php php php php php*php Associativephp arrayphp mapphp ofphp declarativephp referentialphp integrityphp rulesphp.
php php php php php php*php Thisphp arrayphp hasphp onephp entryphp perphp foreignphp keyphp inphp thephp currentphp tablephp.
php php php php php php*php Eachphp keyphp isphp aphp mnemonicphp namephp forphp onephp referencephp rulephp.
php php php php php php*
php php php php php php*php Eachphp valuephp isphp alsophp anphp associativephp arrayphp,php withphp thephp followingphp keysphp:
php php php php php php*php php-php columnsphp php php php php php php php=php arrayphp ofphp namesphp ofphp columnphp(sphp)php inphp thephp childphp tablephp.
php php php php php php*php php-php refTableClassphp php=php classphp namephp ofphp thephp parentphp tablephp.
php php php php php php*php php-php refColumnsphp php php php php=php arrayphp ofphp namesphp ofphp columnphp(sphp)php inphp thephp parentphp tablephp,
php php php php php php*php php php php php php php php php php php php php php php php php php php inphp thephp samephp orderphp asphp thosephp inphp thephp php'columnsphp'php entryphp.
php php php php php php*php php-php onDeletephp php php php php php php=php php"cascadephp"php meansphp thatphp aphp deletephp inphp thephp parentphp tablephp also
php php php php php php*php php php php php php php php php php php php php php php php php php php causesphp aphp deletephp ofphp referencingphp rowsphp inphp thephp childphp tablephp.
php php php php php php*php php-php onUpdatephp php php php php php php=php php"cascadephp"php meansphp thatphp anphp updatephp ofphp primaryphp keyphp valuesphp in
php php php php php php*php php php php php php php php php php php php php php php php php php php thephp parentphp tablephp alsophp causesphp anphp updatephp ofphp referencing
php php php php php php*php php php php php php php php php php php php php php php php php php php rowsphp inphp thephp childphp tablephp.
php php php php php php*
php php php php php php*php php@varphp array
php php php php php php*php/
php php php php protectedphp php$php_referenceMapphp php=php arrayphp(php)php;

php php php php php/php*php*
php php php php php php*php Simplephp arrayphp ofphp classphp namesphp ofphp tablesphp thatphp arephp php"childrenphp"php ofphp thephp current
php php php php php php*php tablephp,php inphp otherphp wordsphp tablesphp thatphp containphp aphp foreignphp keyphp tophp thisphp onephp.
php php php php php php*php Arrayphp elementsphp arephp notphp tablephp namesphp;php theyphp arephp classphp namesphp ofphp classesphp that
php php php php php php*php extendphp Zendphp_Dbphp_Tablephp_Abstractphp.
php php php php php php*
php php php php php php*php php@varphp array
php php php php php php*php/
php php php php protectedphp php$php_dependentTablesphp php=php arrayphp(php)php;


php php php php protectedphp php$php_defaultSourcephp php=php selfphp:php:DEFAULTphp_NONEphp;
php php php php protectedphp php$php_defaultValuesphp php=php arrayphp(php)php;

php php php php php/php*php*
php php php php php php*php Constructorphp.
php php php php php php*
php php php php php php*php Supportedphp paramsphp forphp php$configphp arephp:
php php php php php php*php php-php dbphp php php php php php php php php php php php php php php=php userphp-suppliedphp instancephp ofphp databasephp connectorphp,
php php php php php php*php php php php php php php php php php php php php php php php php php php php php orphp keyphp namephp ofphp registryphp instancephp.
php php php php php php*php php-php namephp php php php php php php php php php php php php=php tablephp namephp.
php php php php php php*php php-php primaryphp php php php php php php php php php=php stringphp orphp arrayphp ofphp primaryphp keyphp(sphp)php.
php php php php php php*php php-php rowClassphp php php php php php php php php=php rowphp classphp namephp.
php php php php php php*php php-php rowsetClassphp php php php php php=php rowsetphp classphp namephp.
php php php php php php*php php-php referenceMapphp php php php php=php arrayphp structurephp tophp declarephp relationship
php php php php php php*php php php php php php php php php php php php php php php php php php php php php tophp parentphp tablesphp.
php php php php php php*php php-php dependentTablesphp php=php arrayphp ofphp childphp tablesphp.
php php php php php php*php php-php metadataCachephp php php php=php cachephp forphp informationphp fromphp adapterphp describeTablephp(php)php.
php php php php php php*
php php php php php php*php php@paramphp php mixedphp php$configphp Arrayphp ofphp userphp-specifiedphp configphp optionsphp,php orphp justphp thephp Dbphp Adapterphp.
php php php php php php*php php@returnphp void
php php php php php php*php/
php php php php publicphp functionphp php_php_constructphp(php$configphp php=php arrayphp(php)php)
php php php php php{
php php php php php php php php php/php*php*
php php php php php php php php php php*php Allowphp aphp scalarphp argumentphp tophp bephp thephp Adapterphp objectphp orphp Registryphp keyphp.
php php php php php php php php php php*php/
php php php php php php php php ifphp php(php!isphp_arrayphp(php$configphp)php)php php{
php php php php php php php php php php php php php$configphp php=php arrayphp(selfphp:php:ADAPTERphp php=php>php php$configphp)php;
php php php php php php php php php}

php php php php php php php php ifphp php(php$configphp)php php{
php php php php php php php php php php php php php$thisphp-php>setOptionsphp(php$configphp)php;
php php php php php php php php php}

php php php php php php php php php$thisphp-php>php_setupphp(php)php;
php php php php php php php php php$thisphp-php>initphp(php)php;
php php php php php}

php php php php php/php*php*
php php php php php php*php setOptionsphp(php)
php php php php php php*
php php php php php php*php php@paramphp arrayphp php$options
php php php php php php*php php@returnphp Zendphp_Dbphp_Tablephp_Abstract
php php php php php php*php/
php php php php publicphp functionphp setOptionsphp(Arrayphp php$optionsphp)
php php php php php{
php php php php php php php php foreachphp php(php$optionsphp asphp php$keyphp php=php>php php$valuephp)php php{
php php php php php php php php php php php php switchphp php(php$keyphp)php php{
php php php php php php php php php php php php php php php php casephp selfphp:php:ADAPTERphp:
php php php php php php php php php php php php php php php php php php php php php$thisphp-php>php_setAdapterphp(php$valuephp)php;
php php php php php php php php php php php php php php php php php php php php breakphp;
php php php php php php php php php php php php php php php php casephp selfphp:php:DEFINITIONphp:
php php php php php php php php php php php php php php php php php php php php php$thisphp-php>setDefinitionphp(php$valuephp)php;
php php php php php php php php php php php php php php php php php php php php breakphp;
php php php php php php php php php php php php php php php php casephp selfphp:php:DEFINITIONphp_CONFIGphp_NAMEphp:
php php php php php php php php php php php php php php php php php php php php php$thisphp-php>setDefinitionConfigNamephp(php$valuephp)php;
php php php php php php php php php php php php php php php php php php php php breakphp;
php php php php php php php php php php php php php php php php casephp selfphp:php:SCHEMAphp:
php php php php php php php php php php php php php php php php php php php php php$thisphp-php>php_schemaphp php=php php(stringphp)php php$valuephp;
php php php php php php php php php php php php php php php php php php php php breakphp;
php php php php php php php php php php php php php php php php casephp selfphp:php:NAMEphp:
php php php php php php php php php php php php php php php php php php php php php$thisphp-php>php_namephp php=php php(stringphp)php php$valuephp;
php php php php php php php php php php php php php php php php php php php php breakphp;
php php php php php php php php php php php php php php php php casephp selfphp:php:PRIMARYphp:
php php php php php php php php php php php php php php php php php php php php php$thisphp-php>php_primaryphp php=php php(arrayphp)php php$valuephp;
php php php php php php php php php php php php php php php php php php php php breakphp;
php php php php php php php php php php php php php php php php casephp selfphp:php:ROWphp_CLASSphp:
php php php php php php php php php php php php php php php php php php php php php$thisphp-php>setRowClassphp(php$valuephp)php;
php php php php php php php php php php php php php php php php php php php php breakphp;
php php php php php php php php php php php php php php php php casephp selfphp:php:ROWSETphp_CLASSphp:
php php php php php php php php php php php php php php php php php php php php php$thisphp-php>setRowsetClassphp(php$valuephp)php;
php php php php php php php php php php php php php php php php php php php php breakphp;
php php php php php php php php php php php php php php php php casephp selfphp:php:REFERENCEphp_MAPphp:
php php php php php php php php php php php php php php php php php php php php php$thisphp-php>setReferencesphp(php$valuephp)php;
php php php php php php php php php php php php php php php php php php php php breakphp;
php php php php php php php php php php php php php php php php casephp selfphp:php:DEPENDENTphp_TABLESphp:
php php php php php php php php php php php php php php php php php php php php php$thisphp-php>setDependentTablesphp(php$valuephp)php;
php php php php php php php php php php php php php php php php php php php php breakphp;
php php php php php php php php php php php php php php php php casephp selfphp:php:METADATAphp_CACHEphp:
php php php php php php php php php php php php php php php php php php php php php$thisphp-php>php_setMetadataCachephp(php$valuephp)php;
php php php php php php php php php php php php php php php php php php php php breakphp;
php php php php php php php php php php php php php php php php casephp selfphp:php:METADATAphp_CACHEphp_INphp_CLASSphp:
php php php php php php php php php php php php php php php php php php php php php$thisphp-php>setMetadataCacheInClassphp(php$valuephp)php;
php php php php php php php php php php php php php php php php php php php php breakphp;
php php php php php php php php php php php php php php php php casephp selfphp:php:SEQUENCEphp:
php php php php php php php php php php php php php php php php php php php php php$thisphp-php>php_setSequencephp(php$valuephp)php;
php php php php php php php php php php php php php php php php php php php php breakphp;
php php php php php php php php php php php php php php php php defaultphp:
php php php php php php php php php php php php php php php php php php php php php/php/php ignorephp unrecognizedphp configurationphp directive
php php php php php php php php php php php php php php php php php php php php breakphp;
php php php php php php php php php php php php php}
php php php php php php php php php}

php php php php php php php php returnphp php$thisphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php setDefinitionphp(php)
php php php php php php*
php php php php php php*php php@paramphp Zendphp_Dbphp_Tablephp_Definitionphp php$definition
php php php php php php*php php@returnphp Zendphp_Dbphp_Tablephp_Abstract
php php php php php php*php/
php php php php publicphp functionphp setDefinitionphp(Zendphp_Dbphp_Tablephp_Definitionphp php$definitionphp)
php php php php php{
php php php php php php php php php$thisphp-php>php_definitionphp php=php php$definitionphp;
php php php php php php php php returnphp php$thisphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php getDefinitionphp(php)
php php php php php php*
php php php php php php*php php@returnphp Zendphp_Dbphp_Tablephp_Definitionphp|null
php php php php php php*php/
php php php php publicphp functionphp getDefinitionphp(php)
php php php php php{
php php php php php php php php returnphp php$thisphp-php>php_definitionphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php setDefinitionConfigNamephp(php)
php php php php php php*
php php php php php php*php php@paramphp stringphp php$definition
php php php php php php*php php@returnphp Zendphp_Dbphp_Tablephp_Abstract
php php php php php php*php/
php php php php publicphp functionphp setDefinitionConfigNamephp(php$definitionConfigNamephp)
php php php php php{
php php php php php php php php php$thisphp-php>php_definitionConfigNamephp php=php php$definitionConfigNamephp;
php php php php php php php php returnphp php$thisphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php getDefinitionConfigNamephp(php)
php php php php php php*
php php php php php php*php php@returnphp string
php php php php php php*php/
php php php php publicphp functionphp getDefinitionConfigNamephp(php)
php php php php php{
php php php php php php php php returnphp php$thisphp-php>php_definitionConfigNamephp;
php php php php php}

php php php php php/php*php*
php php php php php php*php php@paramphp php stringphp php$classname
php php php php php php*php php@returnphp Zendphp_Dbphp_Tablephp_Abstractphp Providesphp aphp fluentphp interface
php php php php php php*php/
php php php php publicphp functionphp setRowClassphp(php$classnamephp)
php php php php php{
php php php php php php php php php$thisphp-php>php_rowClassphp php=php php(stringphp)php php$classnamephp;

php php php php php php php php returnphp php$thisphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php php@returnphp string
php php php php php php*php/
php php php php publicphp functionphp getRowClassphp(php)
php php php php php{
php php php php php php php php returnphp php$thisphp-php>php_rowClassphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php php@paramphp php stringphp php$classname
php php php php php php*php php@returnphp Zendphp_Dbphp_Tablephp_Abstractphp Providesphp aphp fluentphp interface
php php php php php php*php/
php php php php publicphp functionphp setRowsetClassphp(php$classnamephp)
php php php php php{
php php php php php php php php php$thisphp-php>php_rowsetClassphp php=php php(stringphp)php php$classnamephp;

php php php php php php php php returnphp php$thisphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php php@returnphp string
php php php php php php*php/
php php php php publicphp functionphp getRowsetClassphp(php)
php php php php php{
php php php php php php php php returnphp php$thisphp-php>php_rowsetClassphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Addphp aphp referencephp tophp thephp referencephp map
php php php php php php*
php php php php php php*php php@paramphp stringphp php$ruleKey
php php php php php php*php php@paramphp stringphp|arrayphp php$columns
php php php php php php*php php@paramphp stringphp php$refTableClass
php php php php php php*php php@paramphp stringphp|arrayphp php$refColumns
php php php php php php*php php@paramphp stringphp php$onDelete
php php php php php php*php php@paramphp stringphp php$onUpdate
php php php php php php*php php@returnphp Zendphp_Dbphp_Tablephp_Abstract
php php php php php php*php/
php php php php publicphp functionphp addReferencephp(php$ruleKeyphp,php php$columnsphp,php php$refTableClassphp,php php$refColumnsphp,
php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php$onDeletephp php=php nullphp,php php$onUpdatephp php=php nullphp)
php php php php php{
php php php php php php php php php$referencephp php=php arrayphp(selfphp:php:COLUMNSphp php php php php php php php php php=php>php php(arrayphp)php php$columnsphp,
php php php php php php php php php php php php php php php php php php php php php php php php php php php selfphp:php:REFphp_TABLEphp_CLASSphp php=php>php php$refTableClassphp,
php php php php php php php php php php php php php php php php php php php php php php php php php php php selfphp:php:REFphp_COLUMNSphp php php php php php=php>php php(arrayphp)php php$refColumnsphp)php;

php php php php php php php php ifphp php(php!emptyphp(php$onDeletephp)php)php php{
php php php php php php php php php php php php php$referencephp[selfphp:php:ONphp_DELETEphp]php php=php php$onDeletephp;
php php php php php php php php php}

php php php php php php php php ifphp php(php!emptyphp(php$onUpdatephp)php)php php{
php php php php php php php php php php php php php$referencephp[selfphp:php:ONphp_UPDATEphp]php php=php php$onUpdatephp;
php php php php php php php php php}

php php php php php php php php php$thisphp-php>php_referenceMapphp[php$ruleKeyphp]php php=php php$referencephp;

php php php php php php php php returnphp php$thisphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php php@paramphp arrayphp php$referenceMap
php php php php php php*php php@returnphp Zendphp_Dbphp_Tablephp_Abstractphp Providesphp aphp fluentphp interface
php php php php php php*php/
php php php php publicphp functionphp setReferencesphp(arrayphp php$referenceMapphp)
php php php php php{
php php php php php php php php php$thisphp-php>php_referenceMapphp php=php php$referenceMapphp;

php php php php php php php php returnphp php$thisphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php php@paramphp stringphp php$tableClassname
php php php php php php*php php@paramphp stringphp php$ruleKeyphp OPTIONAL
php php php php php php*php php@returnphp array
php php php php php php*php php@throwsphp Zendphp_Dbphp_Tablephp_Exception
php php php php php php*php/
php php php php publicphp functionphp getReferencephp(php$tableClassnamephp,php php$ruleKeyphp php=php nullphp)
php php php php php{
php php php php php php php php php$thisClassphp php=php getphp_classphp(php$thisphp)php;
php php php php php php php php ifphp php(php$thisClassphp php=php=php=php php'Zendphp_Dbphp_Tablephp'php)php php{
php php php php php php php php php php php php php$thisClassphp php=php php$thisphp-php>php_definitionConfigNamephp;
php php php php php php php php php}
php php php php php php php php php$refMapphp php=php php$thisphp-php>php_getReferenceMapNormalizedphp(php)php;
php php php php php php php php ifphp php(php$ruleKeyphp php!php=php=php nullphp)php php{
php php php php php php php php php php php php ifphp php(php!issetphp(php$refMapphp[php$ruleKeyphp]php)php)php php{
php php php php php php php php php php php php php php php php requirephp_oncephp php"Zendphp/Dbphp/Tablephp/Exceptionphp.phpphp"php;
php php php php php php php php php php php php php php php php throwphp newphp Zendphp_Dbphp_Tablephp_Exceptionphp(php"Nophp referencephp rulephp php\php"php$ruleKeyphp\php"php fromphp tablephp php$thisClassphp tophp tablephp php$tableClassnamephp"php)php;
php php php php php php php php php php php php php}
php php php php php php php php php php php php ifphp php(php$refMapphp[php$ruleKeyphp]php[selfphp:php:REFphp_TABLEphp_CLASSphp]php php!php=php php$tableClassnamephp)php php{
php php php php php php php php php php php php php php php php requirephp_oncephp php"Zendphp/Dbphp/Tablephp/Exceptionphp.phpphp"php;
php php php php php php php php php php php php php php php php throwphp newphp Zendphp_Dbphp_Tablephp_Exceptionphp(php"Referencephp rulephp php\php"php$ruleKeyphp\php"php doesphp notphp referencephp tablephp php$tableClassnamephp"php)php;
php php php php php php php php php php php php php}
php php php php php php php php php php php php returnphp php$refMapphp[php$ruleKeyphp]php;
php php php php php php php php php}
php php php php php php php php foreachphp php(php$refMapphp asphp php$referencephp)php php{
php php php php php php php php php php php php ifphp php(php$referencephp[selfphp:php:REFphp_TABLEphp_CLASSphp]php php=php=php php$tableClassnamephp)php php{
php php php php php php php php php php php php php php php php returnphp php$referencephp;
php php php php php php php php php php php php php}
php php php php php php php php php}
php php php php php php php php requirephp_oncephp php"Zendphp/Dbphp/Tablephp/Exceptionphp.phpphp"php;
php php php php php php php php throwphp newphp Zendphp_Dbphp_Tablephp_Exceptionphp(php"Nophp referencephp fromphp tablephp php$thisClassphp tophp tablephp php$tableClassnamephp"php)php;
php php php php php}

php php php php php/php*php*
php php php php php php*php php@paramphp php arrayphp php$dependentTables
php php php php php php*php php@returnphp Zendphp_Dbphp_Tablephp_Abstractphp Providesphp aphp fluentphp interface
php php php php php php*php/
php php php php publicphp functionphp setDependentTablesphp(arrayphp php$dependentTablesphp)
php php php php php{
php php php php php php php php php$thisphp-php>php_dependentTablesphp php=php php$dependentTablesphp;

php php php php php php php php returnphp php$thisphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php php@returnphp array
php php php php php php*php/
php php php php publicphp functionphp getDependentTablesphp(php)
php php php php php{
php php php php php php php php returnphp php$thisphp-php>php_dependentTablesphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php setphp thephp defaultSourcephp propertyphp php-php thisphp tellsphp thephp tablephp classphp wherephp tophp findphp defaultphp values
php php php php php php*
php php php php php php*php php@paramphp stringphp php$defaultSource
php php php php php php*php php@returnphp Zendphp_Dbphp_Tablephp_Abstract
php php php php php php*php/
php php php php publicphp functionphp setDefaultSourcephp(php$defaultSourcephp php=php selfphp:php:DEFAULTphp_NONEphp)
php php php php php{
php php php php php php php php ifphp php(php!inphp_arrayphp(php$defaultSourcephp,php arrayphp(selfphp:php:DEFAULTphp_CLASSphp,php selfphp:php:DEFAULTphp_DBphp,php selfphp:php:DEFAULTphp_NONEphp)php)php)php php{
php php php php php php php php php php php php php$defaultSourcephp php=php selfphp:php:DEFAULTphp_NONEphp;
php php php php php php php php php}

php php php php php php php php php$thisphp-php>php_defaultSourcephp php=php php$defaultSourcephp;
php php php php php php php php returnphp php$thisphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php returnsphp thephp defaultphp sourcephp flagphp thatphp determinesphp wherephp defaultSourcesphp comephp from
php php php php php php*
php php php php php php*php php@returnphp unknown
php php php php php php*php/
php php php php publicphp functionphp getDefaultSourcephp(php)
php php php php php{
php php php php php php php php returnphp php$thisphp-php>php_defaultSourcephp;
php php php php php}

php php php php php/php*php*
php php php php php php*php setphp thephp defaultphp valuesphp forphp thephp tablephp class
php php php php php php*
php php php php php php*php php@paramphp arrayphp php$defaultValues
php php php php php php*php php@returnphp Zendphp_Dbphp_Tablephp_Abstract
php php php php php php*php/
php php php php publicphp functionphp setDefaultValuesphp(Arrayphp php$defaultValuesphp)
php php php php php{
php php php php php php php php foreachphp php(php$defaultValuesphp asphp php$defaultNamephp php=php>php php$defaultValuephp)php php{
php php php php php php php php php php php php ifphp php(arrayphp_keyphp_existsphp(php$defaultNamephp,php php$thisphp-php>php_metadataphp)php)php php{
php php php php php php php php php php php php php php php php php$thisphp-php>php_defaultValuesphp[php$defaultNamephp]php php=php php$defaultValuephp;
php php php php php php php php php php php php php}
php php php php php php php php php}
php php php php php php php php returnphp php$thisphp;
php php php php php}

php php php php publicphp functionphp getDefaultValuesphp(php)
php php php php php{
php php php php php php php php returnphp php$thisphp-php>php_defaultValuesphp;
php php php php php}


php php php php php/php*php*
php php php php php php*php Setsphp thephp defaultphp Zendphp_Dbphp_Adapterphp_Abstractphp forphp allphp Zendphp_Dbphp_Tablephp objectsphp.
php php php php php php*
php php php php php php*php php@paramphp php mixedphp php$dbphp Eitherphp anphp Adapterphp objectphp,php orphp aphp stringphp namingphp aphp Registryphp key
php php php php php php*php php@returnphp void
php php php php php php*php/
php php php php publicphp staticphp functionphp setDefaultAdapterphp(php$dbphp php=php nullphp)
php php php php php{
php php php php php php php php selfphp:php:php$php_defaultDbphp php=php selfphp:php:php_setupAdapterphp(php$dbphp)php;
php php php php php}

php php php php php/php*php*
php php php php php php*php Getsphp thephp defaultphp Zendphp_Dbphp_Adapterphp_Abstractphp forphp allphp Zendphp_Dbphp_Tablephp objectsphp.
php php php php php php*
php php php php php php*php php@returnphp Zendphp_Dbphp_Adapterphp_Abstractphp orphp null
php php php php php php*php/
php php php php publicphp staticphp functionphp getDefaultAdapterphp(php)
php php php php php{
php php php php php php php php returnphp selfphp:php:php$php_defaultDbphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php php@paramphp php mixedphp php$dbphp Eitherphp anphp Adapterphp objectphp,php orphp aphp stringphp namingphp aphp Registryphp key
php php php php php php*php php@returnphp Zendphp_Dbphp_Tablephp_Abstractphp Providesphp aphp fluentphp interface
php php php php php php*php/
php php php php protectedphp functionphp php_setAdapterphp(php$dbphp)
php php php php php{
php php php php php php php php php$thisphp-php>php_dbphp php=php selfphp:php:php_setupAdapterphp(php$dbphp)php;
php php php php php php php php returnphp php$thisphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Getsphp thephp Zendphp_Dbphp_Adapterphp_Abstractphp forphp thisphp particularphp Zendphp_Dbphp_Tablephp objectphp.
php php php php php php*
php php php php php php*php php@returnphp Zendphp_Dbphp_Adapterphp_Abstract
php php php php php php*php/
php php php php publicphp functionphp getAdapterphp(php)
php php php php php{
php php php php php php php php returnphp php$thisphp-php>php_dbphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php php@paramphp php mixedphp php$dbphp Eitherphp anphp Adapterphp objectphp,php orphp aphp stringphp namingphp aphp Registryphp key
php php php php php php*php php@returnphp Zendphp_Dbphp_Adapterphp_Abstract
php php php php php php*php php@throwsphp Zendphp_Dbphp_Tablephp_Exception
php php php php php php*php/
php php php php protectedphp staticphp functionphp php_setupAdapterphp(php$dbphp)
php php php php php{
php php php php php php php php ifphp php(php$dbphp php=php=php=php nullphp)php php{
php php php php php php php php php php php php returnphp nullphp;
php php php php php php php php php}
php php php php php php php php ifphp php(isphp_stringphp(php$dbphp)php)php php{
php php php php php php php php php php php php requirephp_oncephp php'Zendphp/Registryphp.phpphp'php;
php php php php php php php php php php php php php$dbphp php=php Zendphp_Registryphp:php:getphp(php$dbphp)php;
php php php php php php php php php}
php php php php php php php php ifphp php(php!php$dbphp instanceofphp Zendphp_Dbphp_Adapterphp_Abstractphp)php php{
php php php php php php php php php php php php requirephp_oncephp php'Zendphp/Dbphp/Tablephp/Exceptionphp.phpphp'php;
php php php php php php php php php php php php throwphp newphp Zendphp_Dbphp_Tablephp_Exceptionphp(php'Argumentphp mustphp bephp ofphp typephp Zendphp_Dbphp_Adapterphp_Abstractphp,php orphp aphp Registryphp keyphp wherephp aphp Zendphp_Dbphp_Adapterphp_Abstractphp objectphp isphp storedphp'php)php;
php php php php php php php php php}
php php php php php php php php returnphp php$dbphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Setsphp thephp defaultphp metadataphp cachephp forphp informationphp returnedphp byphp Zendphp_Dbphp_Adapterphp_Abstractphp:php:describeTablephp(php)php.
php php php php php php*
php php php php php php*php Ifphp php$defaultMetadataCachephp isphp nullphp,php thenphp nophp metadataphp cachephp isphp usedphp byphp defaultphp.
php php php php php php*
php php php php php php*php php@paramphp php mixedphp php$metadataCachephp Eitherphp aphp Cachephp objectphp,php orphp aphp stringphp namingphp aphp Registryphp key
php php php php php php*php php@returnphp void
php php php php php php*php/
php php php php publicphp staticphp functionphp setDefaultMetadataCachephp(php$metadataCachephp php=php nullphp)
php php php php php{
php php php php php php php php selfphp:php:php$php_defaultMetadataCachephp php=php selfphp:php:php_setupMetadataCachephp(php$metadataCachephp)php;
php php php php php}

php php php php php/php*php*
php php php php php php*php Getsphp thephp defaultphp metadataphp cachephp forphp informationphp returnedphp byphp Zendphp_Dbphp_Adapterphp_Abstractphp:php:describeTablephp(php)php.
php php php php php php*
php php php php php php*php php@returnphp Zendphp_Cachephp_Corephp orphp null
php php php php php php*php/
php php php php publicphp staticphp functionphp getDefaultMetadataCachephp(php)
php php php php php{
php php php php php php php php returnphp selfphp:php:php$php_defaultMetadataCachephp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Setsphp thephp metadataphp cachephp forphp informationphp returnedphp byphp Zendphp_Dbphp_Adapterphp_Abstractphp:php:describeTablephp(php)php.
php php php php php php*
php php php php php php*php Ifphp php$metadataCachephp isphp nullphp,php thenphp nophp metadataphp cachephp isphp usedphp.php Sincephp therephp isphp nophp opportunityphp tophp reloadphp metadata
php php php php php php*php afterphp instantiationphp,php thisphp methodphp needphp notphp bephp publicphp,php particularlyphp becausephp thatphp itphp wouldphp havephp nophp effect
php php php php php php*php resultsphp inphp unnecessaryphp APIphp complexityphp.php Tophp configurephp thephp metadataphp cachephp,php usephp thephp metadataCachephp configuration
php php php php php php*php optionphp forphp thephp classphp constructorphp uponphp instantiationphp.
php php php php php php*
php php php php php php*php php@paramphp php mixedphp php$metadataCachephp Eitherphp aphp Cachephp objectphp,php orphp aphp stringphp namingphp aphp Registryphp key
php php php php php php*php php@returnphp Zendphp_Dbphp_Tablephp_Abstractphp Providesphp aphp fluentphp interface
php php php php php php*php/
php php php php protectedphp functionphp php_setMetadataCachephp(php$metadataCachephp)
php php php php php{
php php php php php php php php php$thisphp-php>php_metadataCachephp php=php selfphp:php:php_setupMetadataCachephp(php$metadataCachephp)php;
php php php php php php php php returnphp php$thisphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Getsphp thephp metadataphp cachephp forphp informationphp returnedphp byphp Zendphp_Dbphp_Adapterphp_Abstractphp:php:describeTablephp(php)php.
php php php php php php*
php php php php php php*php php@returnphp Zendphp_Cachephp_Corephp orphp null
php php php php php php*php/
php php php php publicphp functionphp getMetadataCachephp(php)
php php php php php{
php php php php php php php php returnphp php$thisphp-php>php_metadataCachephp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Indicatephp whetherphp metadataphp shouldphp bephp cachedphp inphp thephp classphp forphp thephp duration
php php php php php php*php ofphp thephp instance
php php php php php php*
php php php php php php*php php@paramphp php boolphp php$flag
php php php php php php*php php@returnphp Zendphp_Dbphp_Tablephp_Abstract
php php php php php php*php/
php php php php publicphp functionphp setMetadataCacheInClassphp(php$flagphp)
php php php php php{
php php php php php php php php php$thisphp-php>php_metadataCacheInClassphp php=php php(boolphp)php php$flagphp;
php php php php php php php php returnphp php$thisphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Retrievephp flagphp indicatingphp ifphp metadataphp shouldphp bephp cachedphp forphp durationphp of
php php php php php php*php instance
php php php php php php*
php php php php php php*php php@returnphp bool
php php php php php php*php/
php php php php publicphp functionphp metadataCacheInClassphp(php)
php php php php php{
php php php php php php php php returnphp php$thisphp-php>php_metadataCacheInClassphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php php@paramphp mixedphp php$metadataCachephp Eitherphp aphp Cachephp objectphp,php orphp aphp stringphp namingphp aphp Registryphp key
php php php php php php*php php@returnphp Zendphp_Cachephp_Core
php php php php php php*php php@throwsphp Zendphp_Dbphp_Tablephp_Exception
php php php php php php*php/
php php php php protectedphp staticphp functionphp php_setupMetadataCachephp(php$metadataCachephp)
php php php php php{
php php php php php php php php ifphp php(php$metadataCachephp php=php=php=php nullphp)php php{
php php php php php php php php php php php php returnphp nullphp;
php php php php php php php php php}
php php php php php php php php ifphp php(isphp_stringphp(php$metadataCachephp)php)php php{
php php php php php php php php php php php php requirephp_oncephp php'Zendphp/Registryphp.phpphp'php;
php php php php php php php php php php php php php$metadataCachephp php=php Zendphp_Registryphp:php:getphp(php$metadataCachephp)php;
php php php php php php php php php}
php php php php php php php php ifphp php(php!php$metadataCachephp instanceofphp Zendphp_Cachephp_Corephp)php php{
php php php php php php php php php php php php requirephp_oncephp php'Zendphp/Dbphp/Tablephp/Exceptionphp.phpphp'php;
php php php php php php php php php php php php throwphp newphp Zendphp_Dbphp_Tablephp_Exceptionphp(php'Argumentphp mustphp bephp ofphp typephp Zendphp_Cachephp_Corephp,php orphp aphp Registryphp keyphp wherephp aphp Zendphp_Cachephp_Corephp objectphp isphp storedphp'php)php;
php php php php php php php php php}
php php php php php php php php returnphp php$metadataCachephp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Setsphp thephp sequencephp memberphp,php whichphp definesphp thephp behaviorphp forphp generating
php php php php php php*php primaryphp keyphp valuesphp inphp newphp rowsphp.
php php php php php php*php php-php Ifphp thisphp isphp aphp stringphp,php thenphp thephp stringphp namesphp thephp sequencephp objectphp.
php php php php php php*php php-php Ifphp thisphp isphp booleanphp truephp,php thenphp thephp keyphp usesphp anphp autophp-incrementing
php php php php php php*php php php orphp identityphp mechanismphp.
php php php php php php*php php-php Ifphp thisphp isphp booleanphp falsephp,php thenphp thephp keyphp isphp userphp-definedphp.
php php php php php php*php php php Usephp thisphp forphp naturalphp keysphp,php forphp examplephp.
php php php php php php*
php php php php php php*php php@paramphp mixedphp php$sequence
php php php php php php*php php@returnphp Zendphp_Dbphp_Tablephp_Adapterphp_Abstractphp Providesphp aphp fluentphp interface
php php php php php php*php/
php php php php protectedphp functionphp php_setSequencephp(php$sequencephp)
php php php php php{
php php php php php php php php php$thisphp-php>php_sequencephp php=php php$sequencephp;

php php php php php php php php returnphp php$thisphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Turnkeyphp forphp initializationphp ofphp aphp tablephp objectphp.
php php php php php php*php Callsphp otherphp protectedphp methodsphp forphp individualphp tasksphp,php tophp makephp itphp easier
php php php php php php*php forphp aphp subclassphp tophp overridephp partphp ofphp thephp setupphp logicphp.
php php php php php php*
php php php php php php*php php@returnphp void
php php php php php php*php/
php php php php protectedphp functionphp php_setupphp(php)
php php php php php{
php php php php php php php php php$thisphp-php>php_setupDatabaseAdapterphp(php)php;
php php php php php php php php php$thisphp-php>php_setupTableNamephp(php)php;
php php php php php}

php php php php php/php*php*
php php php php php php*php Initializephp databasephp adapterphp.
php php php php php php*
php php php php php php*php php@returnphp void
php php php php php php*php/
php php php php protectedphp functionphp php_setupDatabaseAdapterphp(php)
php php php php php{
php php php php php php php php ifphp php(php!php php$thisphp-php>php_dbphp)php php{
php php php php php php php php php php php php php$thisphp-php>php_dbphp php=php selfphp:php:getDefaultAdapterphp(php)php;
php php php php php php php php php php php php ifphp php(php!php$thisphp-php>php_dbphp instanceofphp Zendphp_Dbphp_Adapterphp_Abstractphp)php php{
php php php php php php php php php php php php php php php php requirephp_oncephp php'Zendphp/Dbphp/Tablephp/Exceptionphp.phpphp'php;
php php php php php php php php php php php php php php php php throwphp newphp Zendphp_Dbphp_Tablephp_Exceptionphp(php'Nophp adapterphp foundphp forphp php'php php.php getphp_classphp(php$thisphp)php)php;
php php php php php php php php php php php php php}
php php php php php php php php php}
php php php php php}

php php php php php/php*php*
php php php php php php*php Initializephp tablephp andphp schemaphp namesphp.
php php php php php php*
php php php php php php*php Ifphp thephp tablephp namephp isphp notphp setphp inphp thephp classphp definitionphp,
php php php php php php*php usephp thephp classphp namephp itselfphp asphp thephp tablephp namephp.
php php php php php php*
php php php php php php*php Aphp schemaphp namephp providedphp withphp thephp tablephp namephp php(ephp.gphp.php,php php"schemaphp.tablephp"php)php overrides
php php php php php php*php anyphp existingphp valuephp forphp php$thisphp-php>php_schemaphp.
php php php php php php*
php php php php php php*php php@returnphp void
php php php php php php*php/
php php php php protectedphp functionphp php_setupTableNamephp(php)
php php php php php{
php php php php php php php php ifphp php(php!php php$thisphp-php>php_namephp)php php{
php php php php php php php php php php php php php$thisphp-php>php_namephp php=php getphp_classphp(php$thisphp)php;
php php php php php php php php php}php elsephp ifphp php(strposphp(php$thisphp-php>php_namephp,php php'php.php'php)php)php php{
php php php php php php php php php php php php listphp(php$thisphp-php>php_schemaphp,php php$thisphp-php>php_namephp)php php=php explodephp(php'php.php'php,php php$thisphp-php>php_namephp)php;
php php php php php php php php php}
php php php php php}

php php php php php/php*php*
php php php php php php*php Initializesphp metadataphp.
php php php php php php*
php php php php php php*php Ifphp metadataphp cannotphp bephp loadedphp fromphp cachephp,php adapterphp'sphp describeTablephp(php)php methodphp isphp calledphp tophp discoverphp metadata
php php php php php php*php informationphp.php Returnsphp truephp ifphp andphp onlyphp ifphp thephp metadataphp arephp loadedphp fromphp cachephp.
php php php php php php*
php php php php php php*php php@returnphp boolean
php php php php php php*php php@throwsphp Zendphp_Dbphp_Tablephp_Exception
php php php php php php*php/
php php php php protectedphp functionphp php_setupMetadataphp(php)
php php php php php{
php php php php php php php php ifphp php(php$thisphp-php>metadataCacheInClassphp(php)php php&php&php php(countphp(php$thisphp-php>php_metadataphp)php php>php php0php)php)php php{
php php php php php php php php php php php php returnphp truephp;
php php php php php php php php php}

php php php php php php php php php/php/php Assumephp thatphp metadataphp willphp bephp loadedphp fromphp cache
php php php php php php php php php$isMetadataFromCachephp php=php truephp;

php php php php php php php php php/php/php Ifphp php$thisphp hasphp nophp metadataphp cachephp butphp thephp classphp hasphp aphp defaultphp metadataphp cache
php php php php php php php php ifphp php(nullphp php=php=php=php php$thisphp-php>php_metadataCachephp php&php&php nullphp php!php=php=php selfphp:php:php$php_defaultMetadataCachephp)php php{
php php php php php php php php php php php php php/php/php Makephp php$thisphp usephp thephp defaultphp metadataphp cachephp ofphp thephp class
php php php php php php php php php php php php php$thisphp-php>php_setMetadataCachephp(selfphp:php:php$php_defaultMetadataCachephp)php;
php php php php php php php php php}

php php php php php php php php php/php/php Ifphp php$thisphp hasphp aphp metadataphp cache
php php php php php php php php ifphp php(nullphp php!php=php=php php$thisphp-php>php_metadataCachephp)php php{
php php php php php php php php php php php php php/php/php Definephp thephp cachephp identifierphp wherephp thephp metadataphp arephp saved

php php php php php php php php php php php php php/php/getphp dbphp configuration
php php php php php php php php php php php php php$dbConfigphp php=php php$thisphp-php>php_dbphp-php>getConfigphp(php)php;

php php php php php php php php php php php php php$portphp php=php issetphp(php$dbConfigphp[php'optionsphp'php]php[php'portphp'php]php)
php php php php php php php php php php php php php php php php php php php?php php'php:php'php.php$dbConfigphp[php'optionsphp'php]php[php'portphp'php]
php php php php php php php php php php php php php php php php php php php:php php(issetphp(php$dbConfigphp[php'portphp'php]php)
php php php php php php php php php php php php php php php php php php php?php php'php:php'php.php$dbConfigphp[php'portphp'php]
php php php php php php php php php php php php php php php php php php php:php nullphp)php;

php php php php php php php php php php php php php$hostphp php=php issetphp(php$dbConfigphp[php'optionsphp'php]php[php'hostphp'php]php)
php php php php php php php php php php php php php php php php php php php?php php'php:php'php.php$dbConfigphp[php'optionsphp'php]php[php'hostphp'php]
php php php php php php php php php php php php php php php php php php php:php php(issetphp(php$dbConfigphp[php'hostphp'php]php)
php php php php php php php php php php php php php php php php php php php?php php'php:php'php.php$dbConfigphp[php'hostphp'php]
php php php php php php php php php php php php php php php php php php php:php nullphp)php;

php php php php php php php php php php php php php/php/php Definephp thephp cachephp identifierphp wherephp thephp metadataphp arephp saved
php php php php php php php php php php php php php$cacheIdphp php=php mdphp5php(php php/php/php portphp:hostphp/dbnamephp:schemaphp.tablephp php(basedphp onphp availabiltyphp)
php php php php php php php php php php php php php php php php php php php php php$portphp php.php php$hostphp php.php php'php/php'php.php php$dbConfigphp[php'dbnamephp'php]php php.php php'php:php'
php php php php php php php php php php php php php php php php php php php.php php$thisphp-php>php_schemaphp.php php'php.php'php php.php php$thisphp-php>php_name
php php php php php php php php php php php php php)php;
php php php php php php php php php}

php php php php php php php php php/php/php Ifphp php$thisphp hasphp nophp metadataphp cachephp orphp metadataphp cachephp misses
php php php php php php php php ifphp php(nullphp php=php=php=php php$thisphp-php>php_metadataCachephp php|php|php php!php(php$metadataphp php=php php$thisphp-php>php_metadataCachephp-php>loadphp(php$cacheIdphp)php)php)php php{
php php php php php php php php php php php php php/php/php Metadataphp arephp notphp loadedphp fromphp cache
php php php php php php php php php php php php php$isMetadataFromCachephp php=php falsephp;
php php php php php php php php php php php php php/php/php Fetchphp metadataphp fromphp thephp adapterphp'sphp describeTablephp(php)php method
php php php php php php php php php php php php php$metadataphp php=php php$thisphp-php>php_dbphp-php>describeTablephp(php$thisphp-php>php_namephp,php php$thisphp-php>php_schemaphp)php;
php php php php php php php php php php php php php/php/php Ifphp php$thisphp hasphp aphp metadataphp cachephp,php thenphp cachephp thephp metadata
php php php php php php php php php php php php ifphp php(nullphp php!php=php=php php$thisphp-php>php_metadataCachephp php&php&php php!php$thisphp-php>php_metadataCachephp-php>savephp(php$metadataphp,php php$cacheIdphp)php)php php{
php php php php php php php php php php php php php php php php triggerphp_errorphp(php'Failedphp savingphp metadataphp tophp metadataCachephp'php,php Ephp_USERphp_NOTICEphp)php;
php php php php php php php php php php php php php}
php php php php php php php php php}

php php php php php php php php php/php/php Assignphp thephp metadataphp tophp php$this
php php php php php php php php php$thisphp-php>php_metadataphp php=php php$metadataphp;

php php php php php php php php php/php/php Returnphp whetherphp thephp metadataphp werephp loadedphp fromphp cache
php php php php php php php php returnphp php$isMetadataFromCachephp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Retrievephp tablephp columns
php php php php php php*
php php php php php php*php php@returnphp array
php php php php php php*php/
php php php php protectedphp functionphp php_getColsphp(php)
php php php php php{
php php php php php php php php ifphp php(nullphp php=php=php=php php$thisphp-php>php_colsphp)php php{
php php php php php php php php php php php php php$thisphp-php>php_setupMetadataphp(php)php;
php php php php php php php php php php php php php$thisphp-php>php_colsphp php=php arrayphp_keysphp(php$thisphp-php>php_metadataphp)php;
php php php php php php php php php}
php php php php php php php php returnphp php$thisphp-php>php_colsphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Initializephp primaryphp keyphp fromphp metadataphp.
php php php php php php*php Ifphp php$php_primaryphp isphp notphp definedphp,php discoverphp primaryphp keys
php php php php php php*php fromphp thephp informationphp returnedphp byphp describeTablephp(php)php.
php php php php php php*
php php php php php php*php php@returnphp void
php php php php php php*php php@throwsphp Zendphp_Dbphp_Tablephp_Exception
php php php php php php*php/
php php php php protectedphp functionphp php_setupPrimaryKeyphp(php)
php php php php php{
php php php php php php php php ifphp php(php!php$thisphp-php>php_primaryphp)php php{
php php php php php php php php php php php php php$thisphp-php>php_setupMetadataphp(php)php;
php php php php php php php php php php php php php$thisphp-php>php_primaryphp php=php arrayphp(php)php;
php php php php php php php php php php php php foreachphp php(php$thisphp-php>php_metadataphp asphp php$colphp)php php{
php php php php php php php php php php php php php php php php ifphp php(php$colphp[php'PRIMARYphp'php]php)php php{
php php php php php php php php php php php php php php php php php php php php php$thisphp-php>php_primaryphp[php php$colphp[php'PRIMARYphp_POSITIONphp'php]php php]php php=php php$colphp[php'COLUMNphp_NAMEphp'php]php;
php php php php php php php php php php php php php php php php php php php php ifphp php(php$colphp[php'IDENTITYphp'php]php)php php{
php php php php php php php php php php php php php php php php php php php php php php php php php$thisphp-php>php_identityphp php=php php$colphp[php'PRIMARYphp_POSITIONphp'php]php;
php php php php php php php php php php php php php php php php php php php php php}
php php php php php php php php php php php php php php php php php}
php php php php php php php php php php php php php}
php php php php php php php php php php php php php/php/php ifphp nophp primaryphp keyphp wasphp specifiedphp andphp nonephp wasphp foundphp inphp thephp metadata
php php php php php php php php php php php php php/php/php thenphp throwphp anphp exceptionphp.
php php php php php php php php php php php php ifphp php(emptyphp(php$thisphp-php>php_primaryphp)php)php php{
php php php php php php php php php php php php php php php php requirephp_oncephp php'Zendphp/Dbphp/Tablephp/Exceptionphp.phpphp'php;
php php php php php php php php php php php php php php php php throwphp newphp Zendphp_Dbphp_Tablephp_Exceptionphp(php'Aphp tablephp mustphp havephp aphp primaryphp keyphp,php butphp nonephp wasphp foundphp'php)php;
php php php php php php php php php php php php php}
php php php php php php php php php}php elsephp ifphp php(php!isphp_arrayphp(php$thisphp-php>php_primaryphp)php)php php{
php php php php php php php php php php php php php$thisphp-php>php_primaryphp php=php arrayphp(php1php php=php>php php$thisphp-php>php_primaryphp)php;
php php php php php php php php php}php elsephp ifphp php(issetphp(php$thisphp-php>php_primaryphp[php0php]php)php)php php{
php php php php php php php php php php php php arrayphp_unshiftphp(php$thisphp-php>php_primaryphp,php nullphp)php;
php php php php php php php php php php php php unsetphp(php$thisphp-php>php_primaryphp[php0php]php)php;
php php php php php php php php php}

php php php php php php php php php$colsphp php=php php$thisphp-php>php_getColsphp(php)php;
php php php php php php php php ifphp php(php!php arrayphp_intersectphp(php(arrayphp)php php$thisphp-php>php_primaryphp,php php$colsphp)php php=php=php php(arrayphp)php php$thisphp-php>php_primaryphp)php php{
php php php php php php php php php php php php requirephp_oncephp php'Zendphp/Dbphp/Tablephp/Exceptionphp.phpphp'php;
php php php php php php php php php php php php throwphp newphp Zendphp_Dbphp_Tablephp_Exceptionphp(php"Primaryphp keyphp columnphp(sphp)php php(php"
php php php php php php php php php php php php php php php php php.php implodephp(php'php,php'php,php php(arrayphp)php php$thisphp-php>php_primaryphp)
php php php php php php php php php php php php php php php php php.php php"php)php arephp notphp columnsphp inphp thisphp tablephp php(php"
php php php php php php php php php php php php php php php php php.php implodephp(php'php,php'php,php php$colsphp)
php php php php php php php php php php php php php php php php php.php php"php)php"php)php;
php php php php php php php php php}

php php php php php php php php php$primaryphp php php php php=php php(arrayphp)php php$thisphp-php>php_primaryphp;
php php php php php php php php php$pkIdentityphp php=php php$primaryphp[php(intphp)php php$thisphp-php>php_identityphp]php;

php php php php php php php php php/php*php*
php php php php php php php php php php*php Specialphp casephp forphp PostgreSQLphp:php aphp SERIALphp keyphp implicitlyphp usesphp aphp sequence
php php php php php php php php php php*php objectphp whosephp namephp isphp php"php<tablephp>php_php<columnphp>php_seqphp"php.
php php php php php php php php php php*php/
php php php php php php php php ifphp php(php$thisphp-php>php_sequencephp php=php=php=php truephp php&php&php php$thisphp-php>php_dbphp instanceofphp Zendphp_Dbphp_Adapterphp_Pdophp_Pgsqlphp)php php{
php php php php php php php php php php php php php$thisphp-php>php_sequencephp php=php php$thisphp-php>php_dbphp-php>quoteIdentifierphp(php"php{php$thisphp-php>php_namephp}php_php{php$pkIdentityphp}php_seqphp"php)php;
php php php php php php php php php php php php ifphp php(php$thisphp-php>php_schemaphp)php php{
php php php php php php php php php php php php php php php php php$thisphp-php>php_sequencephp php=php php$thisphp-php>php_dbphp-php>quoteIdentifierphp(php$thisphp-php>php_schemaphp)php php.php php'php.php'php php.php php$thisphp-php>php_sequencephp;
php php php php php php php php php php php php php}
php php php php php php php php php}
php php php php php}

php php php php php/php*php*
php php php php php php*php Returnsphp aphp normalizedphp versionphp ofphp thephp referencephp map
php php php php php php*
php php php php php php*php php@returnphp array
php php php php php php*php/
php php php php protectedphp functionphp php_getReferenceMapNormalizedphp(php)
php php php php php{
php php php php php php php php php$referenceMapNormalizedphp php=php arrayphp(php)php;

php php php php php php php php foreachphp php(php$thisphp-php>php_referenceMapphp asphp php$rulephp php=php>php php$mapphp)php php{

php php php php php php php php php php php php php$referenceMapNormalizedphp[php$rulephp]php php=php arrayphp(php)php;

php php php php php php php php php php php php foreachphp php(php$mapphp asphp php$keyphp php=php>php php$valuephp)php php{
php php php php php php php php php php php php php php php php switchphp php(php$keyphp)php php{

php php php php php php php php php php php php php php php php php php php php php/php/php normalizephp COLUMNSphp andphp REFphp_COLUMNSphp tophp arrays
php php php php php php php php php php php php php php php php php php php php casephp selfphp:php:COLUMNSphp:
php php php php php php php php php php php php php php php php php php php php casephp selfphp:php:REFphp_COLUMNSphp:
php php php php php php php php php php php php php php php php php php php php php php php php ifphp php(php!isphp_arrayphp(php$valuephp)php)php php{
php php php php php php php php php php php php php php php php php php php php php php php php php php php php php$referenceMapNormalizedphp[php$rulephp]php[php$keyphp]php php=php arrayphp(php$valuephp)php;
php php php php php php php php php php php php php php php php php php php php php php php php php}php elsephp php{
php php php php php php php php php php php php php php php php php php php php php php php php php php php php php$referenceMapNormalizedphp[php$rulephp]php[php$keyphp]php php=php php$valuephp;
php php php php php php php php php php php php php php php php php php php php php php php php php}
php php php php php php php php php php php php php php php php php php php php php php php php breakphp;

php php php php php php php php php php php php php php php php php php php php php/php/php otherphp valuesphp arephp copiedphp asphp-is
php php php php php php php php php php php php php php php php php php php php defaultphp:
php php php php php php php php php php php php php php php php php php php php php php php php php$referenceMapNormalizedphp[php$rulephp]php[php$keyphp]php php=php php$valuephp;
php php php php php php php php php php php php php php php php php php php php php php php php breakphp;
php php php php php php php php php php php php php php php php php}
php php php php php php php php php php php php php}
php php php php php php php php php}

php php php php php php php php returnphp php$referenceMapNormalizedphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Initializephp object
php php php php php php*
php php php php php php*php Calledphp fromphp php{php@linkphp php_php_constructphp(php)php}php asphp finalphp stepphp ofphp objectphp instantiationphp.
php php php php php php*
php php php php php php*php php@returnphp void
php php php php php php*php/
php php php php publicphp functionphp initphp(php)
php php php php php{
php php php php php}

php php php php php/php*php*
php php php php php php*php Returnsphp tablephp informationphp.
php php php php php php*
php php php php php php*php Youphp canphp electphp tophp returnphp onlyphp aphp partphp ofphp thisphp informationphp byphp supplyingphp itsphp keyphp namephp,
php php php php php php*php otherwisephp allphp informationphp isphp returnedphp asphp anphp arrayphp.
php php php php php php*
php php php php php php*php php@paramphp php stringphp php$keyphp Thephp specificphp infophp partphp tophp returnphp OPTIONAL
php php php php php php*php php@returnphp mixed
php php php php php php*php/
php php php php publicphp functionphp infophp(php$keyphp php=php nullphp)
php php php php php{
php php php php php php php php php$thisphp-php>php_setupPrimaryKeyphp(php)php;

php php php php php php php php php$infophp php=php arrayphp(
php php php php php php php php php php php php selfphp:php:SCHEMAphp php php php php php php php php php php php=php>php php$thisphp-php>php_schemaphp,
php php php php php php php php php php php php selfphp:php:NAMEphp php php php php php php php php php php php php php=php>php php$thisphp-php>php_namephp,
php php php php php php php php php php php php selfphp:php:COLSphp php php php php php php php php php php php php php=php>php php$thisphp-php>php_getColsphp(php)php,
php php php php php php php php php php php php selfphp:php:PRIMARYphp php php php php php php php php php php=php>php php(arrayphp)php php$thisphp-php>php_primaryphp,
php php php php php php php php php php php php selfphp:php:METADATAphp php php php php php php php php php=php>php php$thisphp-php>php_metadataphp,
php php php php php php php php php php php php selfphp:php:ROWphp_CLASSphp php php php php php php php php=php>php php$thisphp-php>getRowClassphp(php)php,
php php php php php php php php php php php php selfphp:php:ROWSETphp_CLASSphp php php php php php=php>php php$thisphp-php>getRowsetClassphp(php)php,
php php php php php php php php php php php php selfphp:php:REFERENCEphp_MAPphp php php php php=php>php php$thisphp-php>php_referenceMapphp,
php php php php php php php php php php php php selfphp:php:DEPENDENTphp_TABLESphp php=php>php php$thisphp-php>php_dependentTablesphp,
php php php php php php php php php php php php selfphp:php:SEQUENCEphp php php php php php php php php php=php>php php$thisphp-php>php_sequence
php php php php php php php php php)php;

php php php php php php php php ifphp php(php$keyphp php=php=php=php nullphp)php php{
php php php php php php php php php php php php returnphp php$infophp;
php php php php php php php php php}

php php php php php php php php ifphp php(php!arrayphp_keyphp_existsphp(php$keyphp,php php$infophp)php)php php{
php php php php php php php php php php php php requirephp_oncephp php'Zendphp/Dbphp/Tablephp/Exceptionphp.phpphp'php;
php php php php php php php php php php php php throwphp newphp Zendphp_Dbphp_Tablephp_Exceptionphp(php'Therephp isphp nophp tablephp informationphp forphp thephp keyphp php"php'php php.php php$keyphp php.php php'php"php'php)php;
php php php php php php php php php}

php php php php php php php php returnphp php$infophp[php$keyphp]php;
php php php php php}

php php php php php/php*php*
php php php php php php*php Returnsphp anphp instancephp ofphp aphp Zendphp_Dbphp_Tablephp_Selectphp objectphp.
php php php php php php*
php php php php php php*php php@paramphp boolphp php$withFromPartphp Whetherphp orphp notphp tophp includephp thephp fromphp partphp ofphp thephp selectphp basedphp onphp thephp table
php php php php php php*php php@returnphp Zendphp_Dbphp_Tablephp_Select
php php php php php php*php/
php php php php publicphp functionphp selectphp(php$withFromPartphp php=php selfphp:php:SELECTphp_WITHOUTphp_FROMphp_PARTphp)
php php php php php{
php php php php php php php php requirephp_oncephp php'Zendphp/Dbphp/Tablephp/Selectphp.phpphp'php;
php php php php php php php php php$selectphp php=php newphp Zendphp_Dbphp_Tablephp_Selectphp(php$thisphp)php;
php php php php php php php php ifphp php(php$withFromPartphp php=php=php selfphp:php:SELECTphp_WITHphp_FROMphp_PARTphp)php php{
php php php php php php php php php php php php php$selectphp-php>fromphp(php$thisphp-php>infophp(selfphp:php:NAMEphp)php,php Zendphp_Dbphp_Tablephp_Selectphp:php:SQLphp_WILDCARDphp,php php$thisphp-php>infophp(selfphp:php:SCHEMAphp)php)php;
php php php php php php php php php}
php php php php php php php php returnphp php$selectphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Insertsphp aphp newphp rowphp.
php php php php php php*
php php php php php php*php php@paramphp php arrayphp php php$dataphp php Columnphp-valuephp pairsphp.
php php php php php php*php php@returnphp mixedphp php php php php php php php php Thephp primaryphp keyphp ofphp thephp rowphp insertedphp.
php php php php php php*php/
php php php php publicphp functionphp insertphp(arrayphp php$dataphp)
php php php php php{
php php php php php php php php php$thisphp-php>php_setupPrimaryKeyphp(php)php;

php php php php php php php php php/php*php*
php php php php php php php php php php*php Zendphp_Dbphp_Tablephp assumesphp thatphp ifphp youphp havephp aphp compoundphp primaryphp key
php php php php php php php php php php*php andphp onephp ofphp thephp columnsphp inphp thephp keyphp usesphp aphp sequencephp,
php php php php php php php php php php*php itphp'sphp thephp php_firstphp_php columnphp inphp thephp compoundphp keyphp.
php php php php php php php php php php*php/
php php php php php php php php php$primaryphp php=php php(arrayphp)php php$thisphp-php>php_primaryphp;
php php php php php php php php php$pkIdentityphp php=php php$primaryphp[php(intphp)php$thisphp-php>php_identityphp]php;

php php php php php php php php php/php*php*
php php php php php php php php php php*php Ifphp thisphp tablephp usesphp aphp databasephp sequencephp objectphp andphp thephp dataphp doesphp not
php php php php php php php php php php*php specifyphp aphp valuephp,php thenphp getphp thephp nextphp IDphp fromphp thephp sequencephp andphp addphp it
php php php php php php php php php php*php tophp thephp rowphp.php php Wephp assumephp thatphp onlyphp thephp firstphp columnphp inphp aphp compound
php php php php php php php php php php*php primaryphp keyphp takesphp aphp valuephp fromphp aphp sequencephp.
php php php php php php php php php php*php/
php php php php php php php php ifphp php(isphp_stringphp(php$thisphp-php>php_sequencephp)php php&php&php php!issetphp(php$dataphp[php$pkIdentityphp]php)php)php php{
php php php php php php php php php php php php php$dataphp[php$pkIdentityphp]php php=php php$thisphp-php>php_dbphp-php>nextSequenceIdphp(php$thisphp-php>php_sequencephp)php;
php php php php php php php php php}

php php php php php php php php php/php*php*
php php php php php php php php php php*php Ifphp thephp primaryphp keyphp canphp bephp generatedphp automaticallyphp,php andphp nophp valuephp was
php php php php php php php php php php*php specifiedphp inphp thephp userphp-suppliedphp dataphp,php thenphp omitphp itphp fromphp thephp tuplephp.
php php php php php php php php php php*php/
php php php php php php php php ifphp php(arrayphp_keyphp_existsphp(php$pkIdentityphp,php php$dataphp)php php&php&php php$dataphp[php$pkIdentityphp]php php=php=php=php nullphp)php php{
php php php php php php php php php php php php unsetphp(php$dataphp[php$pkIdentityphp]php)php;
php php php php php php php php php}

php php php php php php php php php/php*php*
php php php php php php php php php php*php INSERTphp thephp newphp rowphp.
php php php php php php php php php php*php/
php php php php php php php php php$tableSpecphp php=php php(php$thisphp-php>php_schemaphp php?php php$thisphp-php>php_schemaphp php.php php'php.php'php php:php php'php'php)php php.php php$thisphp-php>php_namephp;
php php php php php php php php php$thisphp-php>php_dbphp-php>insertphp(php$tableSpecphp,php php$dataphp)php;

php php php php php php php php php/php*php*
php php php php php php php php php php*php Fetchphp thephp mostphp recentphp IDphp generatedphp byphp anphp autophp-increment
php php php php php php php php php php*php orphp IDENTITYphp columnphp,php unlessphp thephp userphp hasphp specifiedphp aphp valuephp,
php php php php php php php php php php*php overridingphp thephp autophp-incrementphp mechanismphp.
php php php php php php php php php php*php/
php php php php php php php php ifphp php(php$thisphp-php>php_sequencephp php=php=php=php truephp php&php&php php!issetphp(php$dataphp[php$pkIdentityphp]php)php)php php{
php php php php php php php php php php php php php$dataphp[php$pkIdentityphp]php php=php php$thisphp-php>php_dbphp-php>lastInsertIdphp(php)php;
php php php php php php php php php}

php php php php php php php php php/php*php*
php php php php php php php php php php*php Returnphp thephp primaryphp keyphp valuephp ifphp thephp PKphp isphp aphp singlephp columnphp,
php php php php php php php php php php*php elsephp returnphp anphp associativephp arrayphp ofphp thephp PKphp columnphp/valuephp pairsphp.
php php php php php php php php php php*php/
php php php php php php php php php$pkDataphp php=php arrayphp_intersectphp_keyphp(php$dataphp,php arrayphp_flipphp(php$primaryphp)php)php;
php php php php php php php php ifphp php(countphp(php$primaryphp)php php=php=php php1php)php php{
php php php php php php php php php php php php resetphp(php$pkDataphp)php;
php php php php php php php php php php php php returnphp currentphp(php$pkDataphp)php;
php php php php php php php php php}

php php php php php php php php returnphp php$pkDataphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Checkphp ifphp thephp providedphp columnphp isphp anphp identityphp ofphp thephp table
php php php php php php*
php php php php php php*php php@paramphp php stringphp php$column
php php php php php php*php php@throwsphp Zendphp_Dbphp_Tablephp_Exception
php php php php php php*php php@returnphp boolean
php php php php php php*php/
php php php php publicphp functionphp isIdentityphp(php$columnphp)
php php php php php{
php php php php php php php php php$thisphp-php>php_setupPrimaryKeyphp(php)php;

php php php php php php php php ifphp php(php!issetphp(php$thisphp-php>php_metadataphp[php$columnphp]php)php)php php{
php php php php php php php php php php php php php/php*php*
php php php php php php php php php php php php php php*php php@seephp Zendphp_Dbphp_Tablephp_Exception
php php php php php php php php php php php php php php*php/
php php php php php php php php php php php php requirephp_oncephp php'Zendphp/Dbphp/Tablephp/Exceptionphp.phpphp'php;

php php php php php php php php php php php php throwphp newphp Zendphp_Dbphp_Tablephp_Exceptionphp(php'Columnphp php"php'php php.php php$columnphp php.php php'php"php notphp foundphp inphp tablephp.php'php)php;
php php php php php php php php php}

php php php php php php php php returnphp php(boolphp)php php$thisphp-php>php_metadataphp[php$columnphp]php[php'IDENTITYphp'php]php;
php php php php php}

php php php php php/php*php*
php php php php php php*php Updatesphp existingphp rowsphp.
php php php php php php*
php php php php php php*php php@paramphp php arrayphp php php php php php php php php$dataphp php Columnphp-valuephp pairsphp.
php php php php php php*php php@paramphp php arrayphp|stringphp php$wherephp Anphp SQLphp WHEREphp clausephp,php orphp anphp arrayphp ofphp SQLphp WHEREphp clausesphp.
php php php php php php*php php@returnphp intphp php php php php php php php php php Thephp numberphp ofphp rowsphp updatedphp.
php php php php php php*php/
php php php php publicphp functionphp updatephp(arrayphp php$dataphp,php php$wherephp)
php php php php php{
php php php php php php php php php$tableSpecphp php=php php(php$thisphp-php>php_schemaphp php?php php$thisphp-php>php_schemaphp php.php php'php.php'php php:php php'php'php)php php.php php$thisphp-php>php_namephp;
php php php php php php php php returnphp php$thisphp-php>php_dbphp-php>updatephp(php$tableSpecphp,php php$dataphp,php php$wherephp)php;
php php php php php}

php php php php php/php*php*
php php php php php php*php Calledphp byphp aphp rowphp objectphp forphp thephp parentphp tablephp'sphp classphp duringphp savephp(php)php methodphp.
php php php php php php*
php php php php php php*php php@paramphp php stringphp php$parentTableClassname
php php php php php php*php php@paramphp php arrayphp php php$oldPrimaryKey
php php php php php php*php php@paramphp php arrayphp php php$newPrimaryKey
php php php php php php*php php@returnphp int
php php php php php php*php/
php php php php publicphp functionphp php_cascadeUpdatephp(php$parentTableClassnamephp,php arrayphp php$oldPrimaryKeyphp,php arrayphp php$newPrimaryKeyphp)
php php php php php{
php php php php php php php php php$thisphp-php>php_setupMetadataphp(php)php;
php php php php php php php php php$rowsAffectedphp php=php php0php;
php php php php php php php php foreachphp php(php$thisphp-php>php_getReferenceMapNormalizedphp(php)php asphp php$mapphp)php php{
php php php php php php php php php php php php ifphp php(php$mapphp[selfphp:php:REFphp_TABLEphp_CLASSphp]php php=php=php php$parentTableClassnamephp php&php&php issetphp(php$mapphp[selfphp:php:ONphp_UPDATEphp]php)php)php php{
php php php php php php php php php php php php php php php php switchphp php(php$mapphp[selfphp:php:ONphp_UPDATEphp]php)php php{
php php php php php php php php php php php php php php php php php php php php casephp selfphp:php:CASCADEphp:
php php php php php php php php php php php php php php php php php php php php php php php php php$newRefsphp php=php arrayphp(php)php;
php php php php php php php php php php php php php php php php php php php php php php php php php$wherephp php=php arrayphp(php)php;
php php php php php php php php php php php php php php php php php php php php php php php php forphp php(php$iphp php=php php0php;php php$iphp <php countphp(php$mapphp[selfphp:php:COLUMNSphp]php)php;php php+php+php$iphp)php php{
php php php php php php php php php php php php php php php php php php php php php php php php php php php php php$colphp php=php php$thisphp-php>php_dbphp-php>foldCasephp(php$mapphp[selfphp:php:COLUMNSphp]php[php$iphp]php)php;
php php php php php php php php php php php php php php php php php php php php php php php php php php php php php$refColphp php=php php$thisphp-php>php_dbphp-php>foldCasephp(php$mapphp[selfphp:php:REFphp_COLUMNSphp]php[php$iphp]php)php;
php php php php php php php php php php php php php php php php php php php php php php php php php php php php ifphp php(arrayphp_keyphp_existsphp(php$refColphp,php php$newPrimaryKeyphp)php)php php{
php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php$newRefsphp[php$colphp]php php=php php$newPrimaryKeyphp[php$refColphp]php;
php php php php php php php php php php php php php php php php php php php php php php php php php php php php php}
php php php php php php php php php php php php php php php php php php php php php php php php php php php php php$typephp php=php php$thisphp-php>php_metadataphp[php$colphp]php[php'DATAphp_TYPEphp'php]php;
php php php php php php php php php php php php php php php php php php php php php php php php php php php php php$wherephp[php]php php=php php$thisphp-php>php_dbphp-php>quoteIntophp(
php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php$thisphp-php>php_dbphp-php>quoteIdentifierphp(php$colphp,php truephp)php php.php php'php php=php php?php'php,
php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php$oldPrimaryKeyphp[php$refColphp]php,php php$typephp)php;
php php php php php php php php php php php php php php php php php php php php php php php php php}
php php php php php php php php php php php php php php php php php php php php php php php php php$rowsAffectedphp php+php=php php$thisphp-php>updatephp(php$newRefsphp,php php$wherephp)php;
php php php php php php php php php php php php php php php php php php php php php php php php breakphp;
php php php php php php php php php php php php php php php php php php php php defaultphp:
php php php php php php php php php php php php php php php php php php php php php php php php php/php/php nophp action
php php php php php php php php php php php php php php php php php php php php php php php php breakphp;
php php php php php php php php php php php php php php php php php}
php php php php php php php php php php php php php}
php php php php php php php php php}
php php php php php php php php returnphp php$rowsAffectedphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Deletesphp existingphp rowsphp.
php php php php php php*
php php php php php php*php php@paramphp php arrayphp|stringphp php$wherephp SQLphp WHEREphp clausephp(sphp)php.
php php php php php php*php php@returnphp intphp php php php php php php php php php Thephp numberphp ofphp rowsphp deletedphp.
php php php php php php*php/
php php php php publicphp functionphp deletephp(php$wherephp)
php php php php php{
php php php php php php php php php$tableSpecphp php=php php(php$thisphp-php>php_schemaphp php?php php$thisphp-php>php_schemaphp php.php php'php.php'php php:php php'php'php)php php.php php$thisphp-php>php_namephp;
php php php php php php php php returnphp php$thisphp-php>php_dbphp-php>deletephp(php$tableSpecphp,php php$wherephp)php;
php php php php php}

php php php php php/php*php*
php php php php php php*php Calledphp byphp parentphp tablephp'sphp classphp duringphp deletephp(php)php methodphp.
php php php php php php*
php php php php php php*php php@paramphp php stringphp php$parentTableClassname
php php php php php php*php php@paramphp php arrayphp php php$primaryKey
php php php php php php*php php@returnphp intphp php php php Numberphp ofphp affectedphp rows
php php php php php php*php/
php php php php publicphp functionphp php_cascadeDeletephp(php$parentTableClassnamephp,php arrayphp php$primaryKeyphp)
php php php php php{
php php php php php php php php php$thisphp-php>php_setupMetadataphp(php)php;
php php php php php php php php php$rowsAffectedphp php=php php0php;
php php php php php php php php foreachphp php(php$thisphp-php>php_getReferenceMapNormalizedphp(php)php asphp php$mapphp)php php{
php php php php php php php php php php php php ifphp php(php$mapphp[selfphp:php:REFphp_TABLEphp_CLASSphp]php php=php=php php$parentTableClassnamephp php&php&php issetphp(php$mapphp[selfphp:php:ONphp_DELETEphp]php)php)php php{
php php php php php php php php php php php php php php php php switchphp php(php$mapphp[selfphp:php:ONphp_DELETEphp]php)php php{
php php php php php php php php php php php php php php php php php php php php casephp selfphp:php:CASCADEphp:
php php php php php php php php php php php php php php php php php php php php php php php php php$wherephp php=php arrayphp(php)php;
php php php php php php php php php php php php php php php php php php php php php php php php forphp php(php$iphp php=php php0php;php php$iphp <php countphp(php$mapphp[selfphp:php:COLUMNSphp]php)php;php php+php+php$iphp)php php{
php php php php php php php php php php php php php php php php php php php php php php php php php php php php php$colphp php=php php$thisphp-php>php_dbphp-php>foldCasephp(php$mapphp[selfphp:php:COLUMNSphp]php[php$iphp]php)php;
php php php php php php php php php php php php php php php php php php php php php php php php php php php php php$refColphp php=php php$thisphp-php>php_dbphp-php>foldCasephp(php$mapphp[selfphp:php:REFphp_COLUMNSphp]php[php$iphp]php)php;
php php php php php php php php php php php php php php php php php php php php php php php php php php php php php$typephp php=php php$thisphp-php>php_metadataphp[php$colphp]php[php'DATAphp_TYPEphp'php]php;
php php php php php php php php php php php php php php php php php php php php php php php php php php php php php$wherephp[php]php php=php php$thisphp-php>php_dbphp-php>quoteIntophp(
php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php$thisphp-php>php_dbphp-php>quoteIdentifierphp(php$colphp,php truephp)php php.php php'php php=php php?php'php,
php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php$primaryKeyphp[php$refColphp]php,php php$typephp)php;
php php php php php php php php php php php php php php php php php php php php php php php php php}
php php php php php php php php php php php php php php php php php php php php php php php php php$rowsAffectedphp php+php=php php$thisphp-php>deletephp(php$wherephp)php;
php php php php php php php php php php php php php php php php php php php php php php php php breakphp;
php php php php php php php php php php php php php php php php php php php php defaultphp:
php php php php php php php php php php php php php php php php php php php php php php php php php/php/php nophp action
php php php php php php php php php php php php php php php php php php php php php php php php breakphp;
php php php php php php php php php php php php php php php php php}
php php php php php php php php php php php php php}
php php php php php php php php php}
php php php php php php php php returnphp php$rowsAffectedphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Fetchesphp rowsphp byphp primaryphp keyphp.php php Thephp argumentphp specifiesphp onephp orphp morephp primary
php php php php php php*php keyphp valuephp(sphp)php.php php Tophp findphp multiplephp rowsphp byphp primaryphp keyphp,php thephp argumentphp must
php php php php php php*php bephp anphp arrayphp.
php php php php php php*
php php php php php php*php Thisphp methodphp acceptsphp aphp variablephp numberphp ofphp argumentsphp.php php Ifphp thephp tablephp hasphp a
php php php php php php*php multiphp-columnphp primaryphp keyphp,php thephp numberphp ofphp argumentsphp mustphp bephp thephp samephp as
php php php php php php*php thephp numberphp ofphp columnsphp inphp thephp primaryphp keyphp.php php Tophp findphp multiplephp rowsphp inphp a
php php php php php php*php tablephp withphp aphp multiphp-columnphp primaryphp keyphp,php eachphp argumentphp mustphp bephp anphp array
php php php php php php*php withphp thephp samephp numberphp ofphp elementsphp.
php php php php php php*
php php php php php php*php Thephp findphp(php)php methodphp alwaysphp returnsphp aphp Rowsetphp objectphp,php evenphp ifphp onlyphp onephp row
php php php php php php*php wasphp foundphp.
php php php php php php*
php php php php php php*php php@paramphp php mixedphp php$keyphp Thephp valuephp(sphp)php ofphp thephp primaryphp keysphp.
php php php php php php*php php@returnphp Zendphp_Dbphp_Tablephp_Rowsetphp_Abstractphp Rowphp(sphp)php matchingphp thephp criteriaphp.
php php php php php php*php php@throwsphp Zendphp_Dbphp_Tablephp_Exception
php php php php php php*php/
php php php php publicphp functionphp findphp(php)
php php php php php{
php php php php php php php php php$thisphp-php>php_setupPrimaryKeyphp(php)php;
php php php php php php php php php$argsphp php=php funcphp_getphp_argsphp(php)php;
php php php php php php php php php$keyNamesphp php=php arrayphp_valuesphp(php(arrayphp)php php$thisphp-php>php_primaryphp)php;

php php php php php php php php ifphp php(countphp(php$argsphp)php <php countphp(php$keyNamesphp)php)php php{
php php php php php php php php php php php php requirephp_oncephp php'Zendphp/Dbphp/Tablephp/Exceptionphp.phpphp'php;
php php php php php php php php php php php php throwphp newphp Zendphp_Dbphp_Tablephp_Exceptionphp(php"Toophp fewphp columnsphp forphp thephp primaryphp keyphp"php)php;
php php php php php php php php php}

php php php php php php php php ifphp php(countphp(php$argsphp)php php>php countphp(php$keyNamesphp)php)php php{
php php php php php php php php php php php php requirephp_oncephp php'Zendphp/Dbphp/Tablephp/Exceptionphp.phpphp'php;
php php php php php php php php php php php php throwphp newphp Zendphp_Dbphp_Tablephp_Exceptionphp(php"Toophp manyphp columnsphp forphp thephp primaryphp keyphp"php)php;
php php php php php php php php php}

php php php php php php php php php$whereListphp php=php arrayphp(php)php;
php php php php php php php php php$numberTermsphp php=php php0php;
php php php php php php php php foreachphp php(php$argsphp asphp php$keyPositionphp php=php>php php$keyValuesphp)php php{
php php php php php php php php php php php php php$keyValuesCountphp php=php countphp(php$keyValuesphp)php;
php php php php php php php php php php php php php/php/php Coercephp thephp valuesphp tophp anphp arrayphp.
php php php php php php php php php php php php php/php/php Donphp'tphp simplyphp typecastphp tophp arrayphp,php becausephp thephp values
php php php php php php php php php php php php php/php/php mightphp bephp Zendphp_Dbphp_Exprphp objectsphp.
php php php php php php php php php php php php ifphp php(php!isphp_arrayphp(php$keyValuesphp)php)php php{
php php php php php php php php php php php php php php php php php$keyValuesphp php=php arrayphp(php$keyValuesphp)php;
php php php php php php php php php php php php php}
php php php php php php php php php php php php ifphp php(php$numberTermsphp php=php=php php0php)php php{
php php php php php php php php php php php php php php php php php$numberTermsphp php=php php$keyValuesCountphp;
php php php php php php php php php php php php php}php elsephp ifphp php(php$keyValuesCountphp php!php=php php$numberTermsphp)php php{
php php php php php php php php php php php php php php php php requirephp_oncephp php'Zendphp/Dbphp/Tablephp/Exceptionphp.phpphp'php;
php php php php php php php php php php php php php php php php throwphp newphp Zendphp_Dbphp_Tablephp_Exceptionphp(php"Missingphp valuephp(sphp)php forphp thephp primaryphp keyphp"php)php;
php php php php php php php php php php php php php}
php php php php php php php php php php php php php$keyValuesphp php=php arrayphp_valuesphp(php$keyValuesphp)php;
php php php php php php php php php php php php forphp php(php$iphp php=php php0php;php php$iphp <php php$keyValuesCountphp;php php+php+php$iphp)php php{
php php php php php php php php php php php php php php php php ifphp php(php!issetphp(php$whereListphp[php$iphp]php)php)php php{
php php php php php php php php php php php php php php php php php php php php php$whereListphp[php$iphp]php php=php arrayphp(php)php;
php php php php php php php php php php php php php php php php php}
php php php php php php php php php php php php php php php php php$whereListphp[php$iphp]php[php$keyPositionphp]php php=php php$keyValuesphp[php$iphp]php;
php php php php php php php php php php php php php}
php php php php php php php php php}

php php php php php php php php php$whereClausephp php=php nullphp;
php php php php php php php php ifphp php(countphp(php$whereListphp)php)php php{
php php php php php php php php php php php php php$whereOrTermsphp php=php arrayphp(php)php;
php php php php php php php php php php php php php$tableNamephp php=php php$thisphp-php>php_dbphp-php>quoteTableAsphp(php$thisphp-php>php_namephp,php nullphp,php truephp)php;
php php php php php php php php php php php php foreachphp php(php$whereListphp asphp php$keyValueSetsphp)php php{
php php php php php php php php php php php php php php php php php$whereAndTermsphp php=php arrayphp(php)php;
php php php php php php php php php php php php php php php php foreachphp php(php$keyValueSetsphp asphp php$keyPositionphp php=php>php php$keyValuephp)php php{
php php php php php php php php php php php php php php php php php php php php php$typephp php=php php$thisphp-php>php_metadataphp[php$keyNamesphp[php$keyPositionphp]php]php[php'DATAphp_TYPEphp'php]php;
php php php php php php php php php php php php php php php php php php php php php$columnNamephp php=php php$thisphp-php>php_dbphp-php>quoteIdentifierphp(php$keyNamesphp[php$keyPositionphp]php,php truephp)php;
php php php php php php php php php php php php php php php php php php php php php$whereAndTermsphp[php]php php=php php$thisphp-php>php_dbphp-php>quoteIntophp(
php php php php php php php php php php php php php php php php php php php php php php php php php$tableNamephp php.php php'php.php'php php.php php$columnNamephp php.php php'php php=php php?php'php,
php php php php php php php php php php php php php php php php php php php php php php php php php$keyValuephp,php php$typephp)php;
php php php php php php php php php php php php php php php php php}
php php php php php php php php php php php php php php php php php$whereOrTermsphp[php]php php=php php'php(php'php php.php implodephp(php'php ANDphp php'php,php php$whereAndTermsphp)php php.php php'php)php'php;
php php php php php php php php php php php php php}
php php php php php php php php php php php php php$whereClausephp php=php php'php(php'php php.php implodephp(php'php ORphp php'php,php php$whereOrTermsphp)php php.php php'php)php'php;
php php php php php php php php php}

php php php php php php php php php/php/php issuephp ZFphp-php5php7php7php5php php(emptyphp wherephp clausephp shouldphp returnphp emptyphp rowsetphp)
php php php php php php php php ifphp php(php$whereClausephp php=php=php nullphp)php php{
php php php php php php php php php php php php php$rowsetClassphp php=php php$thisphp-php>getRowsetClassphp(php)php;
php php php php php php php php php php php php ifphp php(php!classphp_existsphp(php$rowsetClassphp)php)php php{
php php php php php php php php php php php php php php php php requirephp_oncephp php'Zendphp/Loaderphp.phpphp'php;
php php php php php php php php php php php php php php php php Zendphp_Loaderphp:php:loadClassphp(php$rowsetClassphp)php;
php php php php php php php php php php php php php}
php php php php php php php php php php php php returnphp newphp php$rowsetClassphp(arrayphp(php'tablephp'php php=php>php php$thisphp,php php'rowClassphp'php php=php>php php$thisphp-php>getRowClassphp(php)php,php php'storedphp'php php=php>php truephp)php)php;
php php php php php php php php php}

php php php php php php php php returnphp php$thisphp-php>fetchAllphp(php$whereClausephp)php;
php php php php php}

php php php php php/php*php*
php php php php php php*php Fetchesphp allphp rowsphp.
php php php php php php*
php php php php php php*php Honorsphp thephp Zendphp_Dbphp_Adapterphp fetchphp modephp.
php php php php php php*
php php php php php php*php php@paramphp stringphp|arrayphp|Zendphp_Dbphp_Tablephp_Selectphp php$wherephp php OPTIONALphp Anphp SQLphp WHEREphp clausephp orphp Zendphp_Dbphp_Tablephp_Selectphp objectphp.
php php php php php php*php php@paramphp stringphp|arrayphp php php php php php php php php php php php php php php php php php php php php php php$orderphp php OPTIONALphp Anphp SQLphp ORDERphp clausephp.
php php php php php php*php php@paramphp intphp php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php$countphp php OPTIONALphp Anphp SQLphp LIMITphp countphp.
php php php php php php*php php@paramphp intphp php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php$offsetphp OPTIONALphp Anphp SQLphp LIMITphp offsetphp.
php php php php php php*php php@returnphp Zendphp_Dbphp_Tablephp_Rowsetphp_Abstractphp Thephp rowphp resultsphp perphp thephp Zendphp_Dbphp_Adapterphp fetchphp modephp.
php php php php php php*php/
php php php php publicphp functionphp fetchAllphp(php$wherephp php=php nullphp,php php$orderphp php=php nullphp,php php$countphp php=php nullphp,php php$offsetphp php=php nullphp)
php php php php php{
php php php php php php php php ifphp php(php!php(php$wherephp instanceofphp Zendphp_Dbphp_Tablephp_Selectphp)php)php php{
php php php php php php php php php php php php php$selectphp php=php php$thisphp-php>selectphp(php)php;

php php php php php php php php php php php php ifphp php(php$wherephp php!php=php=php nullphp)php php{
php php php php php php php php php php php php php php php php php$thisphp-php>php_wherephp(php$selectphp,php php$wherephp)php;
php php php php php php php php php php php php php}

php php php php php php php php php php php php ifphp php(php$orderphp php!php=php=php nullphp)php php{
php php php php php php php php php php php php php php php php php$thisphp-php>php_orderphp(php$selectphp,php php$orderphp)php;
php php php php php php php php php php php php php}

php php php php php php php php php php php php ifphp php(php$countphp php!php=php=php nullphp php|php|php php$offsetphp php!php=php=php nullphp)php php{
php php php php php php php php php php php php php php php php php$selectphp-php>limitphp(php$countphp,php php$offsetphp)php;
php php php php php php php php php php php php php}

php php php php php php php php php}php elsephp php{
php php php php php php php php php php php php php$selectphp php=php php$wherephp;
php php php php php php php php php}

php php php php php php php php php$rowsphp php=php php$thisphp-php>php_fetchphp(php$selectphp)php;

php php php php php php php php php$dataphp php php=php arrayphp(
php php php php php php php php php php php php php'tablephp'php php php php php=php>php php$thisphp,
php php php php php php php php php php php php php'dataphp'php php php php php php=php>php php$rowsphp,
php php php php php php php php php php php php php'readOnlyphp'php php=php>php php$selectphp-php>isReadOnlyphp(php)php,
php php php php php php php php php php php php php'rowClassphp'php php=php>php php$thisphp-php>getRowClassphp(php)php,
php php php php php php php php php php php php php'storedphp'php php php php=php>php true
php php php php php php php php php)php;

php php php php php php php php php$rowsetClassphp php=php php$thisphp-php>getRowsetClassphp(php)php;
php php php php php php php php ifphp php(php!classphp_existsphp(php$rowsetClassphp)php)php php{
php php php php php php php php php php php php requirephp_oncephp php'Zendphp/Loaderphp.phpphp'php;
php php php php php php php php php php php php Zendphp_Loaderphp:php:loadClassphp(php$rowsetClassphp)php;
php php php php php php php php php}
php php php php php php php php returnphp newphp php$rowsetClassphp(php$dataphp)php;
php php php php php}

php php php php php/php*php*
php php php php php php*php Fetchesphp onephp rowphp inphp anphp objectphp ofphp typephp Zendphp_Dbphp_Tablephp_Rowphp_Abstractphp,
php php php php php php*php orphp returnsphp nullphp ifphp nophp rowphp matchesphp thephp specifiedphp criteriaphp.
php php php php php php*
php php php php php php*php php@paramphp stringphp|arrayphp|Zendphp_Dbphp_Tablephp_Selectphp php$wherephp php OPTIONALphp Anphp SQLphp WHEREphp clausephp orphp Zendphp_Dbphp_Tablephp_Selectphp objectphp.
php php php php php php*php php@paramphp stringphp|arrayphp php php php php php php php php php php php php php php php php php php php php php php$orderphp php OPTIONALphp Anphp SQLphp ORDERphp clausephp.
php php php php php php*php php@returnphp Zendphp_Dbphp_Tablephp_Rowphp_Abstractphp|nullphp Thephp rowphp resultsphp perphp the
php php php php php php*php php php php php Zendphp_Dbphp_Adapterphp fetchphp modephp,php orphp nullphp ifphp nophp rowphp foundphp.
php php php php php php*php/
php php php php publicphp functionphp fetchRowphp(php$wherephp php=php nullphp,php php$orderphp php=php nullphp)
php php php php php{
php php php php php php php php ifphp php(php!php(php$wherephp instanceofphp Zendphp_Dbphp_Tablephp_Selectphp)php)php php{
php php php php php php php php php php php php php$selectphp php=php php$thisphp-php>selectphp(php)php;

php php php php php php php php php php php php ifphp php(php$wherephp php!php=php=php nullphp)php php{
php php php php php php php php php php php php php php php php php$thisphp-php>php_wherephp(php$selectphp,php php$wherephp)php;
php php php php php php php php php php php php php}

php php php php php php php php php php php php ifphp php(php$orderphp php!php=php=php nullphp)php php{
php php php php php php php php php php php php php php php php php$thisphp-php>php_orderphp(php$selectphp,php php$orderphp)php;
php php php php php php php php php php php php php}

php php php php php php php php php php php php php$selectphp-php>limitphp(php1php)php;

php php php php php php php php php}php elsephp php{
php php php php php php php php php php php php php$selectphp php=php php$wherephp-php>limitphp(php1php)php;
php php php php php php php php php}

php php php php php php php php php$rowsphp php=php php$thisphp-php>php_fetchphp(php$selectphp)php;

php php php php php php php php ifphp php(countphp(php$rowsphp)php php=php=php php0php)php php{
php php php php php php php php php php php php returnphp nullphp;
php php php php php php php php php}

php php php php php php php php php$dataphp php=php arrayphp(
php php php php php php php php php php php php php'tablephp'php php php php=php>php php$thisphp,
php php php php php php php php php php php php php'dataphp'php php php php php php=php>php php$rowsphp[php0php]php,
php php php php php php php php php php php php php'readOnlyphp'php php=php>php php$selectphp-php>isReadOnlyphp(php)php,
php php php php php php php php php php php php php'storedphp'php php php=php>php true
php php php php php php php php php)php;

php php php php php php php php php$rowClassphp php=php php$thisphp-php>getRowClassphp(php)php;
php php php php php php php php ifphp php(php!classphp_existsphp(php$rowClassphp)php)php php{
php php php php php php php php php php php php requirephp_oncephp php'Zendphp/Loaderphp.phpphp'php;
php php php php php php php php php php php php Zendphp_Loaderphp:php:loadClassphp(php$rowClassphp)php;
php php php php php php php php php}
php php php php php php php php returnphp newphp php$rowClassphp(php$dataphp)php;
php php php php php}

php php php php php/php*php*
php php php php php php*php Fetchesphp aphp newphp blankphp rowphp php(notphp fromphp thephp databasephp)php.
php php php php php php*
php php php php php php*php php@returnphp Zendphp_Dbphp_Tablephp_Rowphp_Abstract
php php php php php php*php php@deprecatedphp sincephp php0php.php9php.php3php php-php usephp createRowphp(php)php insteadphp.
php php php php php php*php/
php php php php publicphp functionphp fetchNewphp(php)
php php php php php{
php php php php php php php php returnphp php$thisphp-php>createRowphp(php)php;
php php php php php}

php php php php php/php*php*
php php php php php php*php Fetchesphp aphp newphp blankphp rowphp php(notphp fromphp thephp databasephp)php.
php php php php php php*
php php php php php php*php php@paramphp php arrayphp php$dataphp OPTIONALphp dataphp tophp populatephp inphp thephp newphp rowphp.
php php php php php php*php php@paramphp php stringphp php$defaultSourcephp OPTIONALphp flagphp tophp forcephp defaultphp valuesphp intophp newphp row
php php php php php php*php php@returnphp Zendphp_Dbphp_Tablephp_Rowphp_Abstract
php php php php php php*php/
php php php php publicphp functionphp createRowphp(arrayphp php$dataphp php=php arrayphp(php)php,php php$defaultSourcephp php=php nullphp)
php php php php php{
php php php php php php php php php$colsphp php php php php php=php php$thisphp-php>php_getColsphp(php)php;
php php php php php php php php php$defaultsphp php=php arrayphp_combinephp(php$colsphp,php arrayphp_fillphp(php0php,php countphp(php$colsphp)php,php nullphp)php)php;

php php php php php php php php php/php/php nothingphp providedphp atphp callphp-timephp,php takephp thephp classphp value
php php php php php php php php ifphp php(php$defaultSourcephp php=php=php nullphp)php php{
php php php php php php php php php php php php php$defaultSourcephp php=php php$thisphp-php>php_defaultSourcephp;
php php php php php php php php php}

php php php php php php php php ifphp php(php!inphp_arrayphp(php$defaultSourcephp,php arrayphp(selfphp:php:DEFAULTphp_CLASSphp,php selfphp:php:DEFAULTphp_DBphp,php selfphp:php:DEFAULTphp_NONEphp)php)php)php php{
php php php php php php php php php php php php php$defaultSourcephp php=php selfphp:php:DEFAULTphp_NONEphp;
php php php php php php php php php}

php php php php php php php php ifphp php(php$defaultSourcephp php=php=php selfphp:php:DEFAULTphp_DBphp)php php{
php php php php php php php php php php php php foreachphp php(php$thisphp-php>php_metadataphp asphp php$metadataNamephp php=php>php php$metadataphp)php php{
php php php php php php php php php php php php php php php php ifphp php(php(php$metadataphp[php'DEFAULTphp'php]php php!php=php nullphp)php php&php&
php php php php php php php php php php php php php php php php php php php php php(php$metadataphp[php'NULLABLEphp'php]php php!php=php=php truephp php|php|php php(php$metadataphp[php'NULLABLEphp'php]php php=php=php=php truephp php&php&php issetphp(php$thisphp-php>php_defaultValuesphp[php$metadataNamephp]php)php php&php&php php$thisphp-php>php_defaultValuesphp[php$metadataNamephp]php php=php=php=php truephp)php)php php&php&
php php php php php php php php php php php php php php php php php php php php php(php!php(issetphp(php$thisphp-php>php_defaultValuesphp[php$metadataNamephp]php)php php&php&php php$thisphp-php>php_defaultValuesphp[php$metadataNamephp]php php=php=php=php falsephp)php)php)php php{
php php php php php php php php php php php php php php php php php php php php php$defaultsphp[php$metadataNamephp]php php=php php$metadataphp[php'DEFAULTphp'php]php;
php php php php php php php php php php php php php php php php php}
php php php php php php php php php php php php php}
php php php php php php php php php}php elseifphp php(php$defaultSourcephp php=php=php selfphp:php:DEFAULTphp_CLASSphp php&php&php php$thisphp-php>php_defaultValuesphp)php php{
php php php php php php php php php php php php foreachphp php(php$thisphp-php>php_defaultValuesphp asphp php$defaultNamephp php=php>php php$defaultValuephp)php php{
php php php php php php php php php php php php php php php php ifphp php(arrayphp_keyphp_existsphp(php$defaultNamephp,php php$defaultsphp)php)php php{
php php php php php php php php php php php php php php php php php php php php php$defaultsphp[php$defaultNamephp]php php=php php$defaultValuephp;
php php php php php php php php php php php php php php php php php}
php php php php php php php php php php php php php}
php php php php php php php php php}

php php php php php php php php php$configphp php=php arrayphp(
php php php php php php php php php php php php php'tablephp'php php php php php=php>php php$thisphp,
php php php php php php php php php php php php php'dataphp'php php php php php php=php>php php$defaultsphp,
php php php php php php php php php php php php php'readOnlyphp'php php=php>php falsephp,
php php php php php php php php php php php php php'storedphp'php php php php=php>php false
php php php php php php php php php)php;

php php php php php php php php php$rowClassphp php=php php$thisphp-php>getRowClassphp(php)php;
php php php php php php php php ifphp php(php!classphp_existsphp(php$rowClassphp)php)php php{
php php php php php php php php php php php php requirephp_oncephp php'Zendphp/Loaderphp.phpphp'php;
php php php php php php php php php php php php Zendphp_Loaderphp:php:loadClassphp(php$rowClassphp)php;
php php php php php php php php php}
php php php php php php php php php$rowphp php=php newphp php$rowClassphp(php$configphp)php;
php php php php php php php php php$rowphp-php>setFromArrayphp(php$dataphp)php;
php php php php php php php php returnphp php$rowphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Generatephp WHEREphp clausephp fromphp userphp-suppliedphp stringphp orphp array
php php php php php php*
php php php php php php*php php@paramphp php stringphp|arrayphp php$wherephp php OPTIONALphp Anphp SQLphp WHEREphp clausephp.
php php php php php php*php php@returnphp Zendphp_Dbphp_Tablephp_Select
php php php php php php*php/
php php php php protectedphp functionphp php_wherephp(Zendphp_Dbphp_Tablephp_Selectphp php$selectphp,php php$wherephp)
php php php php php{
php php php php php php php php php$wherephp php=php php(arrayphp)php php$wherephp;

php php php php php php php php foreachphp php(php$wherephp asphp php$keyphp php=php>php php$valphp)php php{
php php php php php php php php php php php php php/php/php isphp php$keyphp anphp intphp?
php php php php php php php php php php php php ifphp php(isphp_intphp(php$keyphp)php)php php{
php php php php php php php php php php php php php php php php php/php/php php$valphp isphp thephp fullphp condition
php php php php php php php php php php php php php php php php php$selectphp-php>wherephp(php$valphp)php;
php php php php php php php php php php php php php}php elsephp php{
php php php php php php php php php php php php php php php php php/php/php php$keyphp isphp thephp conditionphp withphp placeholderphp,
php php php php php php php php php php php php php php php php php/php/php andphp php$valphp isphp quotedphp intophp thephp condition
php php php php php php php php php php php php php php php php php$selectphp-php>wherephp(php$keyphp,php php$valphp)php;
php php php php php php php php php php php php php}
php php php php php php php php php}

php php php php php php php php returnphp php$selectphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Generatephp ORDERphp clausephp fromphp userphp-suppliedphp stringphp orphp array
php php php php php php*
php php php php php php*php php@paramphp php stringphp|arrayphp php$orderphp php OPTIONALphp Anphp SQLphp ORDERphp clausephp.
php php php php php php*php php@returnphp Zendphp_Dbphp_Tablephp_Select
php php php php php php*php/
php php php php protectedphp functionphp php_orderphp(Zendphp_Dbphp_Tablephp_Selectphp php$selectphp,php php$orderphp)
php php php php php{
php php php php php php php php ifphp php(php!isphp_arrayphp(php$orderphp)php)php php{
php php php php php php php php php php php php php$orderphp php=php arrayphp(php$orderphp)php;
php php php php php php php php php}

php php php php php php php php foreachphp php(php$orderphp asphp php$valphp)php php{
php php php php php php php php php php php php php$selectphp-php>orderphp(php$valphp)php;
php php php php php php php php php}

php php php php php php php php returnphp php$selectphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Supportphp methodphp forphp fetchingphp rowsphp.
php php php php php php*
php php php php php php*php php@paramphp php Zendphp_Dbphp_Tablephp_Selectphp php$selectphp php queryphp optionsphp.
php php php php php php*php php@returnphp arrayphp Anphp arrayphp containingphp thephp rowphp resultsphp inphp FETCHphp_ASSOCphp modephp.
php php php php php php*php/
php php php php protectedphp functionphp php_fetchphp(Zendphp_Dbphp_Tablephp_Selectphp php$selectphp)
php php php php php{
php php php php php php php php php$stmtphp php=php php$thisphp-php>php_dbphp-php>queryphp(php$selectphp)php;
php php php php php php php php php$dataphp php=php php$stmtphp-php>fetchAllphp(Zendphp_Dbphp:php:FETCHphp_ASSOCphp)php;
php php php php php php php php returnphp php$dataphp;
php php php php php}

php}
