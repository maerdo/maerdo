<php?php
php/php*php*
php php*php Zendphp Framework
php php*
php php*php LICENSE
php php*
php php*php Thisphp sourcephp filephp isphp subjectphp tophp thephp newphp BSDphp licensephp thatphp isphp bundled
php php*php withphp thisphp packagephp inphp thephp filephp LICENSEphp.txtphp.
php php*php Itphp isphp alsophp availablephp throughphp thephp worldphp-widephp-webphp atphp thisphp URLphp:
php php*php httpphp:php/php/frameworkphp.zendphp.comphp/licensephp/newphp-bsd
php php*php Ifphp youphp didphp notphp receivephp aphp copyphp ofphp thephp licensephp andphp arephp unablephp to
php php*php obtainphp itphp throughphp thephp worldphp-widephp-webphp,php pleasephp sendphp anphp email
php php*php tophp licensephp@zendphp.comphp sophp wephp canphp sendphp youphp aphp copyphp immediatelyphp.
php php*
php php*php php@categoryphp php php Zend
php php*php php@packagephp php php php Zendphp_Cache
php php*php php@copyrightphp php Copyrightphp php(cphp)php php2php0php0php5php-php2php0php1php0php Zendphp Technologiesphp USAphp Incphp.php php(httpphp:php/php/wwwphp.zendphp.comphp)
php php*php php@licensephp php php php httpphp:php/php/frameworkphp.zendphp.comphp/licensephp/newphp-bsdphp php php php php Newphp BSDphp License
php php*php php@versionphp php php php php$Idphp:php Managerphp.phpphp php2php2php7php2php7php php2php0php1php0php-php0php7php-php3php0php php1php2php:php3php6php:php0php0Zphp mabephp php$
php php*php/

php/php*php*php php@seephp Zendphp_Cachephp_Exceptionphp php*php/
requirephp_oncephp php'Zendphp/Cachephp/Exceptionphp.phpphp'php;

php/php*php*php php@seephp Zendphp_Cachephp php*php/
requirephp_oncephp php'Zendphp/Cachephp.phpphp'php;

php/php*php*
php php*php php@categoryphp php php Zend
php php*php php@packagephp php php php Zendphp_Cache
php php*php php@copyrightphp php Copyrightphp php(cphp)php php2php0php0php5php-php2php0php1php0php Zendphp Technologiesphp USAphp Incphp.php php(httpphp:php/php/wwwphp.zendphp.comphp)
php php*php php@licensephp php php php httpphp:php/php/frameworkphp.zendphp.comphp/licensephp/newphp-bsdphp php php php php Newphp BSDphp License
php php*php/
classphp Zendphp_Cachephp_Manager
php{
php php php php php/php*php*
php php php php php php*php Constantphp holdingphp reservedphp namephp forphp defaultphp Pagephp Cache
php php php php php php*php/
php php php php constphp PAGECACHEphp php=php php'pagephp'php;

php php php php php/php*php*
php php php php php php*php Constantphp holdingphp reservedphp namephp forphp defaultphp Pagephp Tagphp Cache
php php php php php php*php/
php php php php constphp PAGETAGCACHEphp php=php php'pagetagphp'php;

php php php php php/php*php*
php php php php php php*php Arrayphp ofphp cachesphp storedphp byphp thephp Cachephp Managerphp instance
php php php php php php*
php php php php php php*php php@varphp array
php php php php php php*php/
php php php php protectedphp php$php_cachesphp php=php arrayphp(php)php;

php php php php php/php*php*
php php php php php php*php Arrayphp ofphp readyphp madephp configurationphp templatesphp forphp lazy
php php php php php php*php loadingphp cachesphp.
php php php php php php*
php php php php php php*php php@varphp array
php php php php php php*php/
php php php php protectedphp php$php_optionTemplatesphp php=php arrayphp(
php php php php php php php php php/php/php Simplephp Commonphp Default
php php php php php php php php php'defaultphp'php php=php>php arrayphp(
php php php php php php php php php php php php php'frontendphp'php php=php>php arrayphp(
php php php php php php php php php php php php php php php php php'namephp'php php php php php=php>php php'Corephp'php,
php php php php php php php php php php php php php php php php php'optionsphp'php php=php>php arrayphp(
php php php php php php php php php php php php php php php php php php php php php'automaticphp_serializationphp'php php=php>php truephp,
php php php php php php php php php php php php php php php php php)php,
php php php php php php php php php php php php php)php,
php php php php php php php php php php php php php'backendphp'php php=php>php arrayphp(
php php php php php php php php php php php php php php php php php'namephp'php php php php php=php>php php'Filephp'php,
php php php php php php php php php php php php php php php php php'optionsphp'php php=php>php arrayphp(
php php php php php php php php php php php php php php php php php php php php php/php/php usephp systemphp tempphp dirphp byphp defaultphp ofphp filephp backend
php php php php php php php php php php php php php php php php php php php php php/php/php php'cachephp_dirphp'php php=php>php php'php.php.php/cachephp'php,
php php php php php php php php php php php php php php php php php)php,
php php php php php php php php php php php php php)php,
php php php php php php php php php)php,

php php php php php php php php php/php/php Staticphp Pagephp HTMLphp Cache
php php php php php php php php php'pagephp'php php=php>php arrayphp(
php php php php php php php php php php php php php'frontendphp'php php=php>php arrayphp(
php php php php php php php php php php php php php php php php php'namephp'php php php php php=php>php php'Capturephp'php,
php php php php php php php php php php php php php php php php php'optionsphp'php php=php>php arrayphp(
php php php php php php php php php php php php php php php php php php php php php'ignorephp_userphp_abortphp'php php=php>php truephp,
php php php php php php php php php php php php php php php php php)php,
php php php php php php php php php php php php php)php,
php php php php php php php php php php php php php'backendphp'php php=php>php arrayphp(
php php php php php php php php php php php php php php php php php'namephp'php php php php php=php>php php'Staticphp'php,
php php php php php php php php php php php php php php php php php'optionsphp'php php=php>php arrayphp(
php php php php php php php php php php php php php php php php php php php php php'publicphp_dirphp'php php=php>php php'php.php.php/publicphp'php,
php php php php php php php php php php php php php php php php php)php,
php php php php php php php php php php php php php)php,
php php php php php php php php php)php,

php php php php php php php php php/php/php Tagphp Cache
php php php php php php php php php'pagetagphp'php php=php>php arrayphp(
php php php php php php php php php php php php php'frontendphp'php php=php>php arrayphp(
php php php php php php php php php php php php php php php php php'namephp'php php php php php=php>php php'Corephp'php,
php php php php php php php php php php php php php php php php php'optionsphp'php php=php>php arrayphp(
php php php php php php php php php php php php php php php php php php php php php'automaticphp_serializationphp'php php=php>php truephp,
php php php php php php php php php php php php php php php php php php php php php'lifetimephp'php php=php>php null
php php php php php php php php php php php php php php php php php)php,
php php php php php php php php php php php php php)php,
php php php php php php php php php php php php php'backendphp'php php=php>php arrayphp(
php php php php php php php php php php php php php php php php php'namephp'php php php php php=php>php php'Filephp'php,
php php php php php php php php php php php php php php php php php'optionsphp'php php=php>php arrayphp(
php php php php php php php php php php php php php php php php php php php php php/php/php usephp systemphp tempphp dirphp byphp defaultphp ofphp filephp backend
php php php php php php php php php php php php php php php php php php php php php/php/php php'cachephp_dirphp'php php=php>php php'php.php.php/cachephp'php,
php php php php php php php php php php php php php php php php php php php php php/php/php usephp defaultphp umaskphp ofphp filephp backend
php php php php php php php php php php php php php php php php php php php php php/php/php php'cachephp_filephp_umaskphp'php php=php>php php0php6php4php4
php php php php php php php php php php php php php php php php php)php,
php php php php php php php php php php php php php)php,
php php php php php php php php php)php,
php php php php php)php;

php php php php php/php*php*
php php php php php php*php Setphp aphp newphp cachephp forphp thephp Cachephp Managerphp tophp contain
php php php php php php*
php php php php php php*php php@paramphp php stringphp php$name
php php php php php php*php php@paramphp php Zendphp_Cachephp_Corephp php$cache
php php php php php php*php php@returnphp Zendphp_Cachephp_Manager
php php php php php php*php/
php php php php publicphp functionphp setCachephp(php$namephp,php Zendphp_Cachephp_Corephp php$cachephp)
php php php php php{
php php php php php php php php php$thisphp-php>php_cachesphp[php$namephp]php php=php php$cachephp;
php php php php php php php php returnphp php$thisphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Checkphp ifphp thephp Cachephp Managerphp containsphp thephp namedphp cachephp objectphp,php orphp aphp named
php php php php php php*php configurationphp templatephp tophp lazyphp loadphp thephp cachephp object
php php php php php php*
php php php php php php*php php@paramphp stringphp php$name
php php php php php php*php php@returnphp bool
php php php php php php*php/
php php php php publicphp functionphp hasCachephp(php$namephp)
php php php php php{
php php php php php php php php ifphp php(issetphp(php$thisphp-php>php_cachesphp[php$namephp]php)
php php php php php php php php php php php php php|php|php php$thisphp-php>hasCacheTemplatephp(php$namephp)
php php php php php php php php php)php php{
php php php php php php php php php php php php returnphp truephp;
php php php php php php php php php}
php php php php php php php php returnphp falsephp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Fetchphp thephp namedphp cachephp objectphp,php orphp instantiatephp andphp returnphp aphp cachephp object
php php php php php php*php usingphp aphp namedphp configurationphp template
php php php php php php*
php php php php php php*php php@paramphp php stringphp php$name
php php php php php php*php php@returnphp Zendphp_Cachephp_Core
php php php php php php*php/
php php php php publicphp functionphp getCachephp(php$namephp)
php php php php php{
php php php php php php php php ifphp php(issetphp(php$thisphp-php>php_cachesphp[php$namephp]php)php)php php{
php php php php php php php php php php php php returnphp php$thisphp-php>php_cachesphp[php$namephp]php;
php php php php php php php php php}
php php php php php php php php ifphp php(issetphp(php$thisphp-php>php_optionTemplatesphp[php$namephp]php)php)php php{
php php php php php php php php php php php php ifphp php(php$namephp php=php=php selfphp:php:PAGECACHE
php php php php php php php php php php php php php php php php php&php&php php(php!issetphp(php$thisphp-php>php_optionTemplatesphp[php$namephp]php[php'backendphp'php]php[php'optionsphp'php]php[php'tagphp_cachephp'php]php)
php php php php php php php php php php php php php php php php php|php|php php!php$thisphp-php>php_optionTemplatesphp[php$namephp]php[php'backendphp'php]php[php'optionsphp'php]php[php'tagphp_cachephp'php]php instanceofphp Zendphp_Cachephp_Corephp)
php php php php php php php php php php php php php)php php{
php php php php php php php php php php php php php php php php php$thisphp-php>php_optionTemplatesphp[php$namephp]php[php'backendphp'php]php[php'optionsphp'php]php[php'tagphp_cachephp'php]
php php php php php php php php php php php php php php php php php php php php php=php php$thisphp-php>getCachephp(selfphp:php:PAGETAGCACHEphp)php;
php php php php php php php php php php php php php}

php php php php php php php php php php php php php$thisphp-php>php_cachesphp[php$namephp]php php=php Zendphp_Cachephp:php:factoryphp(
php php php php php php php php php php php php php php php php php$thisphp-php>php_optionTemplatesphp[php$namephp]php[php'frontendphp'php]php[php'namephp'php]php,
php php php php php php php php php php php php php php php php php$thisphp-php>php_optionTemplatesphp[php$namephp]php[php'backendphp'php]php[php'namephp'php]php,
php php php php php php php php php php php php php php php php issetphp(php$thisphp-php>php_optionTemplatesphp[php$namephp]php[php'frontendphp'php]php[php'optionsphp'php]php)php php?php php$thisphp-php>php_optionTemplatesphp[php$namephp]php[php'frontendphp'php]php[php'optionsphp'php]php php:php arrayphp(php)php,
php php php php php php php php php php php php php php php php issetphp(php$thisphp-php>php_optionTemplatesphp[php$namephp]php[php'backendphp'php]php[php'optionsphp'php]php)php php?php php$thisphp-php>php_optionTemplatesphp[php$namephp]php[php'backendphp'php]php[php'optionsphp'php]php php:php arrayphp(php)php,
php php php php php php php php php php php php php php php php issetphp(php$thisphp-php>php_optionTemplatesphp[php$namephp]php[php'frontendphp'php]php[php'customFrontendNamingphp'php]php)php php?php php$thisphp-php>php_optionTemplatesphp[php$namephp]php[php'frontendphp'php]php[php'customFrontendNamingphp'php]php php:php falsephp,
php php php php php php php php php php php php php php php php issetphp(php$thisphp-php>php_optionTemplatesphp[php$namephp]php[php'backendphp'php]php[php'customBackendNamingphp'php]php)php php?php php$thisphp-php>php_optionTemplatesphp[php$namephp]php[php'backendphp'php]php[php'customBackendNamingphp'php]php php:php falsephp,
php php php php php php php php php php php php php php php php issetphp(php$thisphp-php>php_optionTemplatesphp[php$namephp]php[php'frontendBackendAutoloadphp'php]php)php php?php php$thisphp-php>php_optionTemplatesphp[php$namephp]php[php'frontendBackendAutoloadphp'php]php php:php false
php php php php php php php php php php php php php)php;

php php php php php php php php php php php php returnphp php$thisphp-php>php_cachesphp[php$namephp]php;
php php php php php php php php php}
php php php php php}

php php php php php/php*php*
php php php php php php*php Fetchphp allphp availablephp caches
php php php php php php*
php php php php php php*php php@returnphp arrayphp Anphp arrayphp ofphp allphp availablephp cachesphp withphp itphp'sphp namesphp asphp key
php php php php php php*php/
php php php php publicphp functionphp getCachesphp(php)
php php php php php{
php php php php php php php php php$cachesphp php=php php$thisphp-php>php_cachesphp;
php php php php php php php php foreachphp php(php$thisphp-php>php_optionTemplatesphp asphp php$namephp php=php>php php$tmpphp)php php{
php php php php php php php php php php php php ifphp php(php!issetphp(php$cachesphp[php$namephp]php)php)php php{
php php php php php php php php php php php php php php php php php$cachesphp[php$namephp]php php=php php$thisphp-php>getCachephp(php$namephp)php;
php php php php php php php php php php php php php}
php php php php php php php php php}
php php php php php php php php returnphp php$cachesphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Setphp aphp namedphp configurationphp templatephp fromphp whichphp aphp cachephp objectphp canphp later
php php php php php php*php bephp lazyphp loaded
php php php php php php*
php php php php php php*php php@paramphp php stringphp php$name
php php php php php php*php php@paramphp php arrayphp php$options
php php php php php php*php php@returnphp Zendphp_Cachephp_Manager
php php php php php php*php/
php php php php publicphp functionphp setCacheTemplatephp(php$namephp,php php$optionsphp)
php php php php php{
php php php php php php php php ifphp php(php$optionsphp instanceofphp Zendphp_Configphp)php php{
php php php php php php php php php php php php php$optionsphp php=php php$optionsphp-php>toArrayphp(php)php;
php php php php php php php php php}php elseifphp php(php!isphp_arrayphp(php$optionsphp)php)php php{
php php php php php php php php php php php php requirephp_oncephp php'Zendphp/Cachephp/Exceptionphp.phpphp'php;
php php php php php php php php php php php php throwphp newphp Zendphp_Cachephp_Exceptionphp(php'Optionsphp passedphp mustphp bephp inphp'
php php php php php php php php php php php php php php php php php.php php'php anphp associativephp arrayphp orphp instancephp ofphp Zendphp_Configphp'php)php;
php php php php php php php php php}
php php php php php php php php php$thisphp-php>php_optionTemplatesphp[php$namephp]php php=php php$optionsphp;
php php php php php php php php returnphp php$thisphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Checkphp ifphp thephp namedphp configurationphp template
php php php php php php*
php php php php php php*php php@paramphp php stringphp php$name
php php php php php php*php php@returnphp bool
php php php php php php*php/
php php php php publicphp functionphp hasCacheTemplatephp(php$namephp)
php php php php php{
php php php php php php php php ifphp php(issetphp(php$thisphp-php>php_optionTemplatesphp[php$namephp]php)php)php php{
php php php php php php php php php php php php returnphp truephp;
php php php php php php php php php}
php php php php php php php php returnphp falsephp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Getphp thephp namedphp configurationphp template
php php php php php php*
php php php php php php*php php@paramphp php stringphp php$name
php php php php php php*php php@returnphp array
php php php php php php*php/
php php php php publicphp functionphp getCacheTemplatephp(php$namephp)
php php php php php{
php php php php php php php php ifphp php(issetphp(php$thisphp-php>php_optionTemplatesphp[php$namephp]php)php)php php{
php php php php php php php php php php php php returnphp php$thisphp-php>php_optionTemplatesphp[php$namephp]php;
php php php php php php php php php}
php php php php php}

php php php php php/php*php*
php php php php php php*php Passphp anphp arrayphp containingphp changesphp tophp bephp appliedphp tophp aphp named
php php php php php php*php configuration
php php php php php php*php template
php php php php php php*
php php php php php php*php php@paramphp php stringphp php$name
php php php php php php*php php@paramphp php arrayphp php$options
php php php php php php*php php@returnphp Zendphp_Cachephp_Manager
php php php php php php*php php@throwsphp Zendphp_Cachephp_Exceptionphp forphp invalidphp optionsphp formatphp orphp ifphp optionphp templatesphp dophp notphp havephp php$name
php php php php php php*php/
php php php php publicphp functionphp setTemplateOptionsphp(php$namephp,php php$optionsphp)
php php php php php{
php php php php php php php php ifphp php(php$optionsphp instanceofphp Zendphp_Configphp)php php{
php php php php php php php php php php php php php$optionsphp php=php php$optionsphp-php>toArrayphp(php)php;
php php php php php php php php php}php elseifphp php(php!isphp_arrayphp(php$optionsphp)php)php php{
php php php php php php php php php php php php requirephp_oncephp php'Zendphp/Cachephp/Exceptionphp.phpphp'php;
php php php php php php php php php php php php throwphp newphp Zendphp_Cachephp_Exceptionphp(php'Optionsphp passedphp mustphp bephp inphp'
php php php php php php php php php php php php php php php php php.php php'php anphp associativephp arrayphp orphp instancephp ofphp Zendphp_Configphp'php)php;
php php php php php php php php php}
php php php php php php php php ifphp php(php!issetphp(php$thisphp-php>php_optionTemplatesphp[php$namephp]php)php)php php{
php php php php php php php php php php php php throwphp newphp Zendphp_Cachephp_Exceptionphp(php'Aphp cachephp configurationphp templatephp'
php php php php php php php php php php php php php php php php php.php php'doesphp notphp existphp withphp thephp namephp php"php'php php.php php$namephp php.php php'php"php'php)php;
php php php php php php php php php}
php php php php php php php php php$thisphp-php>php_optionTemplatesphp[php$namephp]
php php php php php php php php php php php php php=php php$thisphp-php>php_mergeOptionsphp(php$thisphp-php>php_optionTemplatesphp[php$namephp]php,php php$optionsphp)php;
php php php php php php php php returnphp php$thisphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Simplephp methodphp tophp mergephp twophp configurationphp arrays
php php php php php php*
php php php php php php*php php@paramphp php arrayphp php$current
php php php php php php*php php@paramphp php arrayphp php$options
php php php php php php*php php@returnphp array
php php php php php php*php/
php php php php protectedphp functionphp php_mergeOptionsphp(arrayphp php$currentphp,php arrayphp php$optionsphp)
php php php php php{
php php php php php php php php ifphp php(issetphp(php$optionsphp[php'frontendphp'php]php[php'namephp'php]php)php)php php{
php php php php php php php php php php php php php$currentphp[php'frontendphp'php]php[php'namephp'php]php php=php php$optionsphp[php'frontendphp'php]php[php'namephp'php]php;
php php php php php php php php php}
php php php php php php php php ifphp php(issetphp(php$optionsphp[php'backendphp'php]php[php'namephp'php]php)php)php php{
php php php php php php php php php php php php php$currentphp[php'backendphp'php]php[php'namephp'php]php php=php php$optionsphp[php'backendphp'php]php[php'namephp'php]php;
php php php php php php php php php}
php php php php php php php php ifphp php(issetphp(php$optionsphp[php'frontendphp'php]php[php'optionsphp'php]php)php)php php{
php php php php php php php php php php php php foreachphp php(php$optionsphp[php'frontendphp'php]php[php'optionsphp'php]php asphp php$keyphp=php>php$valuephp)php php{
php php php php php php php php php php php php php php php php php$currentphp[php'frontendphp'php]php[php'optionsphp'php]php[php$keyphp]php php=php php$valuephp;
php php php php php php php php php php php php php}
php php php php php php php php php}
php php php php php php php php ifphp php(issetphp(php$optionsphp[php'backendphp'php]php[php'optionsphp'php]php)php)php php{
php php php php php php php php php php php php foreachphp php(php$optionsphp[php'backendphp'php]php[php'optionsphp'php]php asphp php$keyphp=php>php$valuephp)php php{
php php php php php php php php php php php php php php php php php$currentphp[php'backendphp'php]php[php'optionsphp'php]php[php$keyphp]php php=php php$valuephp;
php php php php php php php php php php php php php}
php php php php php php php php php}
php php php php php php php php returnphp php$currentphp;
php php php php php}
php}
