<php?php
php/php*php*
php php*php Zendphp Framework
php php*
php php*php LICENSE
php php*
php php*php Thisphp sourcephp filephp isphp subjectphp tophp thephp newphp BSDphp licensephp thatphp isphp bundled
php php*php withphp thisphp packagephp inphp thephp filephp LICENSEphp.txtphp.
php php*php Itphp isphp alsophp availablephp throughphp thephp worldphp-widephp-webphp atphp thisphp URLphp:
php php*php httpphp:php/php/frameworkphp.zendphp.comphp/licensephp/newphp-bsd
php php*php Ifphp youphp didphp notphp receivephp aphp copyphp ofphp thephp licensephp andphp arephp unablephp to
php php*php obtainphp itphp throughphp thephp worldphp-widephp-webphp,php pleasephp sendphp anphp email
php php*php tophp licensephp@zendphp.comphp sophp wephp canphp sendphp youphp aphp copyphp immediatelyphp.
php php*
php php*php php@categoryphp php php Zend
php php*php php@packagephp php php php Zendphp_Cache
php php*php php@copyrightphp php Copyrightphp php(cphp)php php2php0php0php5php-php2php0php1php0php Zendphp Technologiesphp USAphp Incphp.php php(httpphp:php/php/wwwphp.zendphp.comphp)
php php*php php@licensephp php php php httpphp:php/php/frameworkphp.zendphp.comphp/licensephp/newphp-bsdphp php php php php Newphp BSDphp License
php php*php php@versionphp php php php php$Idphp:php Cachephp.phpphp php2php3php1php5php4php php2php0php1php0php-php1php0php-php1php8php php1php7php:php4php1php:php0php6Zphp mabephp php$
php php*php/


php/php*php*
php php*php php@packagephp php php php Zendphp_Cache
php php*php php@copyrightphp php Copyrightphp php(cphp)php php2php0php0php5php-php2php0php1php0php Zendphp Technologiesphp USAphp Incphp.php php(httpphp:php/php/wwwphp.zendphp.comphp)
php php*php php@licensephp php php php httpphp:php/php/frameworkphp.zendphp.comphp/licensephp/newphp-bsdphp php php php php Newphp BSDphp License
php php*php/
abstractphp classphp Zendphp_Cache
php{

php php php php php/php*php*
php php php php php php*php Standardphp frontends
php php php php php php*
php php php php php php*php php@varphp array
php php php php php php*php/
php php php php publicphp staticphp php$standardFrontendsphp php=php arrayphp(php'Corephp'php,php php'Outputphp'php,php php'Classphp'php,php php'Filephp'php,php php'Functionphp'php,php php'Pagephp'php)php;

php php php php php/php*php*
php php php php php php*php Standardphp backends
php php php php php php*
php php php php php php*php php@varphp array
php php php php php php*php/
php php php php publicphp staticphp php$standardBackendsphp php=php arrayphp(php'Filephp'php,php php'Sqlitephp'php,php php'Memcachedphp'php,php php'Libmemcachedphp'php,php php'Apcphp'php,php php'ZendPlatformphp'php,
php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php php'Xcachephp'php,php php'TwoLevelsphp'php,php php'ZendServerphp_Diskphp'php,php php'ZendServerphp_ShMemphp'php)php;

php php php php php/php*php*
php php php php php php*php Standardphp backendsphp whichphp implementphp thephp ExtendedInterface
php php php php php php*
php php php php php php*php php@varphp array
php php php php php php*php/
php php php php publicphp staticphp php$standardExtendedBackendsphp php=php arrayphp(php'Filephp'php,php php'Apcphp'php,php php'TwoLevelsphp'php,php php'Memcachedphp'php,php php'Libmemcachedphp'php,php php'Sqlitephp'php)php;

php php php php php/php*php*
php php php php php php*php Onlyphp forphp backwardphp compatibilityphp php(mayphp bephp removedphp inphp nextphp majorphp releasephp)
php php php php php php*
php php php php php php*php php@varphp array
php php php php php php*php php@deprecated
php php php php php php*php/
php php php php publicphp staticphp php$availableFrontendsphp php=php arrayphp(php'Corephp'php,php php'Outputphp'php,php php'Classphp'php,php php'Filephp'php,php php'Functionphp'php,php php'Pagephp'php)php;

php php php php php/php*php*
php php php php php php*php Onlyphp forphp backwardphp compatibilityphp php(mayphp bephp removedphp inphp nextphp majorphp releasephp)
php php php php php php*
php php php php php php*php php@varphp array
php php php php php php*php php@deprecated
php php php php php php*php/
php php php php publicphp staticphp php$availableBackendsphp php=php arrayphp(php'Filephp'php,php php'Sqlitephp'php,php php'Memcachedphp'php,php php'Libmemcachedphp'php,php php'Apcphp'php,php php'ZendPlatformphp'php,php php'Xcachephp'php,php php'TwoLevelsphp'php)php;

php php php php php/php*php*
php php php php php php*php Constsphp forphp cleanphp(php)php method
php php php php php php*php/
php php php php constphp CLEANINGphp_MODEphp_ALLphp php php php php php php php php php php php php php php=php php'allphp'php;
php php php php constphp CLEANINGphp_MODEphp_OLDphp php php php php php php php php php php php php php php=php php'oldphp'php;
php php php php constphp CLEANINGphp_MODEphp_MATCHINGphp_TAGphp php php php php php=php php'matchingTagphp'php;
php php php php constphp CLEANINGphp_MODEphp_NOTphp_MATCHINGphp_TAGphp php=php php'notMatchingTagphp'php;
php php php php constphp CLEANINGphp_MODEphp_MATCHINGphp_ANYphp_TAGphp php=php php'matchingAnyTagphp'php;

php php php php php/php*php*
php php php php php php*php Factory
php php php php php php*
php php php php php php*php php@paramphp mixedphp php php$frontendphp php php php php php php php frontendphp namephp php(stringphp)php orphp Zendphp_Cachephp_Frontendphp_php object
php php php php php php*php php@paramphp mixedphp php php$backendphp php php php php php php php php backendphp namephp php(stringphp)php orphp Zendphp_Cachephp_Backendphp_php object
php php php php php php*php php@paramphp arrayphp php php$frontendOptionsphp associativephp arrayphp ofphp optionsphp forphp thephp correspondingphp frontendphp constructor
php php php php php php*php php@paramphp arrayphp php php$backendOptionsphp php associativephp arrayphp ofphp optionsphp forphp thephp correspondingphp backendphp constructor
php php php php php php*php php@paramphp booleanphp php$customFrontendNamingphp ifphp truephp,php thephp frontendphp argumentphp isphp usedphp asphp aphp completephp classphp namephp php;php ifphp falsephp,php thephp frontendphp argumentphp isphp usedphp asphp thephp endphp ofphp php"Zendphp_Cachephp_Frontendphp_php[php.php.php.php]php"php classphp name
php php php php php php*php php@paramphp booleanphp php$customBackendNamingphp ifphp truephp,php thephp backendphp argumentphp isphp usedphp asphp aphp completephp classphp namephp php;php ifphp falsephp,php thephp backendphp argumentphp isphp usedphp asphp thephp endphp ofphp php"Zendphp_Cachephp_Backendphp_php[php.php.php.php]php"php classphp name
php php php php php php*php php@paramphp booleanphp php$autoloadphp ifphp truephp,php therephp willphp nophp requirephp_oncephp forphp backendphp andphp frontendphp php(usefulphp onlyphp forphp customphp backendsphp/frontendsphp)
php php php php php php*php php@throwsphp Zendphp_Cachephp_Exception
php php php php php php*php php@returnphp Zendphp_Cachephp_Corephp|Zendphp_Cachephp_Frontend
php php php php php php*php/
php php php php publicphp staticphp functionphp factoryphp(php$frontendphp,php php$backendphp,php php$frontendOptionsphp php=php arrayphp(php)php,php php$backendOptionsphp php=php arrayphp(php)php,php php$customFrontendNamingphp php=php falsephp,php php$customBackendNamingphp php=php falsephp,php php$autoloadphp php=php falsephp)
php php php php php{
php php php php php php php php ifphp php(isphp_stringphp(php$backendphp)php)php php{
php php php php php php php php php php php php php$backendObjectphp php=php selfphp:php:php_makeBackendphp(php$backendphp,php php$backendOptionsphp,php php$customBackendNamingphp,php php$autoloadphp)php;
php php php php php php php php php}php elsephp php{
php php php php php php php php php php php php ifphp php(php(isphp_objectphp(php$backendphp)php)php php&php&php php(inphp_arrayphp(php'Zendphp_Cachephp_Backendphp_Interfacephp'php,php classphp_implementsphp(php$backendphp)php)php)php)php php{
php php php php php php php php php php php php php php php php php$backendObjectphp php=php php$backendphp;
php php php php php php php php php php php php php}php elsephp php{
php php php php php php php php php php php php php php php php selfphp:php:throwExceptionphp(php'backendphp mustphp bephp aphp backendphp namephp php(stringphp)php orphp anphp objectphp whichphp implementsphp Zendphp_Cachephp_Backendphp_Interfacephp'php)php;
php php php php php php php php php php php php php}
php php php php php php php php php}
php php php php php php php php ifphp php(isphp_stringphp(php$frontendphp)php)php php{
php php php php php php php php php php php php php$frontendObjectphp php=php selfphp:php:php_makeFrontendphp(php$frontendphp,php php$frontendOptionsphp,php php$customFrontendNamingphp,php php$autoloadphp)php;
php php php php php php php php php}php elsephp php{
php php php php php php php php php php php php ifphp php(isphp_objectphp(php$frontendphp)php)php php{
php php php php php php php php php php php php php php php php php$frontendObjectphp php=php php$frontendphp;
php php php php php php php php php php php php php}php elsephp php{
php php php php php php php php php php php php php php php php selfphp:php:throwExceptionphp(php'frontendphp mustphp bephp aphp frontendphp namephp php(stringphp)php orphp anphp objectphp'php)php;
php php php php php php php php php php php php php}
php php php php php php php php php}
php php php php php php php php php$frontendObjectphp-php>setBackendphp(php$backendObjectphp)php;
php php php php php php php php returnphp php$frontendObjectphp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Backendphp Constructor
php php php php php php*
php php php php php php*php php@paramphp stringphp php php$backend
php php php php php php*php php@paramphp arrayphp php php php$backendOptions
php php php php php php*php php@paramphp booleanphp php$customBackendNaming
php php php php php php*php php@paramphp booleanphp php$autoload
php php php php php php*php php@returnphp Zendphp_Cachephp_Backend
php php php php php php*php/
php php php php publicphp staticphp functionphp php_makeBackendphp(php$backendphp,php php$backendOptionsphp,php php$customBackendNamingphp php=php falsephp,php php$autoloadphp php=php falsephp)
php php php php php{
php php php php php php php php ifphp php(php!php$customBackendNamingphp)php php{
php php php php php php php php php php php php php$backendphp php php=php selfphp:php:php_normalizeNamephp(php$backendphp)php;
php php php php php php php php php}
php php php php php php php php ifphp php(inphp_arrayphp(php$backendphp,php Zendphp_Cachephp:php:php$standardBackendsphp)php)php php{
php php php php php php php php php php php php php/php/php wephp usephp aphp standardphp backend
php php php php php php php php php php php php php$backendClassphp php=php php'Zendphp_Cachephp_Backendphp_php'php php.php php$backendphp;
php php php php php php php php php php php php php/php/php securityphp controlsphp arephp explicit
php php php php php php php php php php php php requirephp_oncephp strphp_replacephp(php'php_php'php,php DIRECTORYphp_SEPARATORphp,php php$backendClassphp)php php.php php'php.phpphp'php;
php php php php php php php php php}php elsephp php{
php php php php php php php php php php php php php/php/php wephp usephp aphp customphp backend
php php php php php php php php php php php php ifphp php(php!pregphp_matchphp(php'php~php^php[php\wphp]php+php$php~Dphp'php,php php$backendphp)php)php php{
php php php php php php php php php php php php php php php php Zendphp_Cachephp:php:throwExceptionphp(php"Invalidphp backendphp namephp php[php$backendphp]php"php)php;
php php php php php php php php php php php php php}
php php php php php php php php php php php php ifphp php(php!php$customBackendNamingphp)php php{
php php php php php php php php php php php php php php php php php/php/php wephp usephp thisphp booleanphp tophp avoidphp anphp APIphp break
php php php php php php php php php php php php php php php php php$backendClassphp php=php php'Zendphp_Cachephp_Backendphp_php'php php.php php$backendphp;
php php php php php php php php php php php php php}php elsephp php{
php php php php php php php php php php php php php php php php php$backendClassphp php=php php$backendphp;
php php php php php php php php php php php php php}
php php php php php php php php php php php php ifphp php(php!php$autoloadphp)php php{
php php php php php php php php php php php php php php php php php$filephp php=php strphp_replacephp(php'php_php'php,php DIRECTORYphp_SEPARATORphp,php php$backendClassphp)php php.php php'php.phpphp'php;
php php php php php php php php php php php php php php php php ifphp php(php!php(selfphp:php:php_isReadablephp(php$filephp)php)php)php php{
php php php php php php php php php php php php php php php php php php php php selfphp:php:throwExceptionphp(php"filephp php$filephp notphp foundphp inphp includephp_pathphp"php)php;
php php php php php php php php php php php php php php php php php}
php php php php php php php php php php php php php php php php requirephp_oncephp php$filephp;
php php php php php php php php php php php php php}
php php php php php php php php php}
php php php php php php php php returnphp newphp php$backendClassphp(php$backendOptionsphp)php;
php php php php php}

php php php php php/php*php*
php php php php php php*php Frontendphp Constructor
php php php php php php*
php php php php php php*php php@paramphp stringphp php php$frontend
php php php php php php*php php@paramphp arrayphp php php php$frontendOptions
php php php php php php*php php@paramphp booleanphp php$customFrontendNaming
php php php php php php*php php@paramphp booleanphp php$autoload
php php php php php php*php php@returnphp Zendphp_Cachephp_Corephp|Zendphp_Cachephp_Frontend
php php php php php php*php/
php php php php publicphp staticphp functionphp php_makeFrontendphp(php$frontendphp,php php$frontendOptionsphp php=php arrayphp(php)php,php php$customFrontendNamingphp php=php falsephp,php php$autoloadphp php=php falsephp)
php php php php php{
php php php php php php php php ifphp php(php!php$customFrontendNamingphp)php php{
php php php php php php php php php php php php php$frontendphp php=php selfphp:php:php_normalizeNamephp(php$frontendphp)php;
php php php php php php php php php}
php php php php php php php php ifphp php(inphp_arrayphp(php$frontendphp,php selfphp:php:php$standardFrontendsphp)php)php php{
php php php php php php php php php php php php php/php/php wephp usephp aphp standardphp frontend
php php php php php php php php php php php php php/php/php Forphp perfsphp reasonsphp,php withphp frontendphp php=php=php php'Corephp'php,php wephp canphp interactphp withphp thephp Corephp itself
php php php php php php php php php php php php php$frontendClassphp php=php php'Zendphp_Cachephp_php'php php.php php(php$frontendphp php!php=php php'Corephp'php php?php php'Frontendphp_php'php php:php php'php'php)php php.php php$frontendphp;
php php php php php php php php php php php php php/php/php securityphp controlsphp arephp explicit
php php php php php php php php php php php php requirephp_oncephp strphp_replacephp(php'php_php'php,php DIRECTORYphp_SEPARATORphp,php php$frontendClassphp)php php.php php'php.phpphp'php;
php php php php php php php php php}php elsephp php{
php php php php php php php php php php php php php/php/php wephp usephp aphp customphp frontend
php php php php php php php php php php php php ifphp php(php!pregphp_matchphp(php'php~php^php[php\wphp]php+php$php~Dphp'php,php php$frontendphp)php)php php{
php php php php php php php php php php php php php php php php Zendphp_Cachephp:php:throwExceptionphp(php"Invalidphp frontendphp namephp php[php$frontendphp]php"php)php;
php php php php php php php php php php php php php}
php php php php php php php php php php php php ifphp php(php!php$customFrontendNamingphp)php php{
php php php php php php php php php php php php php php php php php/php/php wephp usephp thisphp booleanphp tophp avoidphp anphp APIphp break
php php php php php php php php php php php php php php php php php$frontendClassphp php=php php'Zendphp_Cachephp_Frontendphp_php'php php.php php$frontendphp;
php php php php php php php php php php php php php}php elsephp php{
php php php php php php php php php php php php php php php php php$frontendClassphp php=php php$frontendphp;
php php php php php php php php php php php php php}
php php php php php php php php php php php php ifphp php(php!php$autoloadphp)php php{
php php php php php php php php php php php php php php php php php$filephp php=php strphp_replacephp(php'php_php'php,php DIRECTORYphp_SEPARATORphp,php php$frontendClassphp)php php.php php'php.phpphp'php;
php php php php php php php php php php php php php php php php ifphp php(php!php(selfphp:php:php_isReadablephp(php$filephp)php)php)php php{
php php php php php php php php php php php php php php php php php php php php selfphp:php:throwExceptionphp(php"filephp php$filephp notphp foundphp inphp includephp_pathphp"php)php;
php php php php php php php php php php php php php php php php php}
php php php php php php php php php php php php php php php php requirephp_oncephp php$filephp;
php php php php php php php php php php php php php}
php php php php php php php php php}
php php php php php php php php returnphp newphp php$frontendClassphp(php$frontendOptionsphp)php;
php php php php php}

php php php php php/php*php*
php php php php php php*php Throwphp anphp exception
php php php php php php*
php php php php php php*php Notephp php:php forphp perfphp reasonsphp,php thephp php"loadphp"php ofphp Zendphp/Cachephp/Exceptionphp isphp dynamic
php php php php php php*php php@paramphp php stringphp php$msgphp php Messagephp forphp thephp exception
php php php php php php*php php@throwsphp Zendphp_Cachephp_Exception
php php php php php php*php/
php php php php publicphp staticphp functionphp throwExceptionphp(php$msgphp,php Exceptionphp php$ephp php=php nullphp)
php php php php php{
php php php php php php php php php/php/php Forphp perfsphp reasonsphp,php wephp usephp thisphp dynamicphp inclusion
php php php php php php php php requirephp_oncephp php'Zendphp/Cachephp/Exceptionphp.phpphp'php;
php php php php php php php php throwphp newphp Zendphp_Cachephp_Exceptionphp(php$msgphp,php php0php,php php$ephp)php;
php php php php php}

php php php php php/php*php*
php php php php php php*php Normalizephp frontendphp andphp backendphp namesphp tophp allowphp multiplephp wordsphp TitleCased
php php php php php php*
php php php php php php*php php@paramphp php stringphp php$namephp php Namephp tophp normalize
php php php php php php*php php@returnphp string
php php php php php php*php/
php php php php protectedphp staticphp functionphp php_normalizeNamephp(php$namephp)
php php php php php{
php php php php php php php php php$namephp php=php ucfirstphp(strtolowerphp(php$namephp)php)php;
php php php php php php php php php$namephp php=php strphp_replacephp(arrayphp(php'php-php'php,php php'php_php'php,php php'php.php'php)php,php php'php php'php,php php$namephp)php;
php php php php php php php php php$namephp php=php ucwordsphp(php$namephp)php;
php php php php php php php php php$namephp php=php strphp_replacephp(php'php php'php,php php'php'php,php php$namephp)php;
php php php php php php php php ifphp php(striposphp(php$namephp,php php'ZendServerphp'php)php php=php=php=php php0php)php php{
php php php php php php php php php php php php php$namephp php=php php'ZendServerphp_php'php php.php substrphp(php$namephp,php strlenphp(php'ZendServerphp'php)php)php;
php php php php php php php php php}

php php php php php php php php returnphp php$namephp;
php php php php php}

php php php php php/php*php*
php php php php php php*php Returnsphp TRUEphp ifphp thephp php$filenamephp isphp readablephp,php orphp FALSEphp otherwisephp.
php php php php php php*php Thisphp functionphp usesphp thephp PHPphp includephp_pathphp,php wherephp PHPphp'sphp isphp_readablephp(php)
php php php php php php*php doesphp notphp.
php php php php php php*
php php php php php php*php Notephp php:php thisphp methodphp comesphp fromphp Zendphp_Loaderphp php(seephp php#ZFphp-php2php8php9php1php forphp detailsphp)
php php php php php php*
php php php php php php*php php@paramphp stringphp php php php$filename
php php php php php php*php php@returnphp boolean
php php php php php php*php/
php php php php privatephp staticphp functionphp php_isReadablephp(php$filenamephp)
php php php php php{
php php php php php php php php ifphp php(php!php$fhphp php=php php@fopenphp(php$filenamephp,php php'rphp'php,php truephp)php)php php{
php php php php php php php php php php php php returnphp falsephp;
php php php php php php php php php}
php php php php php php php php php@fclosephp(php$fhphp)php;
php php php php php php php php returnphp truephp;
php php php php php}

php}
